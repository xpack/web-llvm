---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `InstructionCombining.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="InstCombineInternal.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombineinternal-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/APInt.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AliasAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AssumptionCache.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BasicAliasAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/basicaliasanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ConstantFolding.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/constantfolding-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/GlobalsModRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/globalsmodref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/InstructionSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LastRunTrackingAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/lastruntrackinganalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LazyBlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/lazyblockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemoryBuiltins.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memorybuiltins-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/OptimizationRemarkEmitter.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ProfileSummaryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetFolder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targetfolder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetLibraryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/include/llvm/analysis/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/VectorUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DIBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/EHPersonalities.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/ehpersonalities-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GetElementPtrTypeIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/getelementptrtypeiterator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Metadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Operator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PassManager.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Use.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/use-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ValueHandle.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Compiler.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/DebugCounter.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debugcounter-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/KnownBits.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/knownbits-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/InstCombine/InstCombine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/instcombine/instcombine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="memory"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="string"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/InstructionWorklist.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/instructionworklist-h"
  isLocal="true" />
</IncludesList>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/aliasscopetracker">AliasScopeTracker</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a856d46e90d7159a88c175ceff667f40c">canonicalizeGEPOfConstGEPI8</a> (GetElementPtrInst &amp;GEP, GEPOperator &#42;Src, InstCombinerImpl &amp;IC)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a4904699fe3329a5027ccd76991b0c1e4">ClearSubclassDataAfterReassociation</a> (BinaryOperator &amp;I)</>}>
Conservatively clears subclassOptionalData after a reassociation or commutation. <a href="#a4904699fe3329a5027ccd76991b0c1e4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a45a945c85468ec7d17b48b0d4f612b7e">combineInstructionsOverFunction</a> (Function &amp;F, InstructionWorklist &amp;Worklist, AliasAnalysis &#42;AA, AssumptionCache &amp;AC, TargetLibraryInfo &amp;TLI, TargetTransformInfo &amp;TTI, DominatorTree &amp;DT, OptimizationRemarkEmitter &amp;ORE, BlockFrequencyInfo &#42;BFI, BranchProbabilityInfo &#42;BPI, ProfileSummaryInfo &#42;PSI, const InstCombineOptions &amp;Opts)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac39bd0ff6a3f194647bdcc7f46cfde61">DEBUG&#95;COUNTER</a> (VisitCounter, &quot;instcombine-visit&quot;, &quot;Controls which instructions are visited&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#ad12cb02e2ee53655e834dcb84cd57333">foldGEPOfPhi</a> (GetElementPtrInst &amp;GEP, PHINode &#42;PN, IRBuilderBase &amp;Builder)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a7b9a62f04a493cc8b8dadc64100578f8">foldOperationIntoSelectOperand</a> (Instruction &amp;I, SelectInst &#42;SI, Value &#42;NewOp, InstCombiner &amp;IC)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a16a66955e366f83c6e35d99511a33167">foldSelectGEP</a> (GetElementPtrInst &amp;GEP, InstCombiner::BuilderTy &amp;Builder)</>}>
Thread a GEP operation with constant indices through the constant true/false arms of a select. <a href="#a16a66955e366f83c6e35d99511a33167">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a></>}
  name={<><a href="#ac7754c95309ff1784b1e47b0001deeee">getBinOpsForFactorization</a> (Instruction::BinaryOps TopOpcode, BinaryOperator &#42;Op, Value &#42;&amp;LHS, Value &#42;&amp;RHS, BinaryOperator &#42;OtherOp)</>}>
This function predicates factorization using distributive laws. <a href="#ac7754c95309ff1784b1e47b0001deeee">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a5e80024df498e16b544d9c0d3f2d9eb4">getIdentityValue</a> (Instruction::BinaryOps Opcode, Value &#42;V)</>}>
This function returns identity value for given opcode, which can be used to factor patterns like (X &#42; 2) + X ==&gt; (X &#42; 2) + (X &#42; 1) ==&gt; X &#42; (2 + 1). <a href="#a5e80024df498e16b544d9c0d3f2d9eb4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/gepnowrapflags">GEPNoWrapFlags</a></>}
  name={<><a href="#afef6fefdb447008608fc826b31a49d28">getMergedGEPNoWrapFlags</a> (GEPOperator &amp;GEP1, GEPOperator &amp;GEP2)</>}>
Determine nowrap flags for (gep (gep p, x), y) to (gep p, (x + y)) transform. <a href="#afef6fefdb447008608fc826b31a49d28">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3bd26297d4422f25aaeacd40ffbbc478">hasNoSignedWrap</a> (BinaryOperator &amp;I)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ac7f3587a2e9b666879ee5067a9593253">hasNoUnsignedWrap</a> (BinaryOperator &amp;I)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a8a787de77e16e56d936abb2ad6ee4c8c">INITIALIZE&#95;PASS&#95;BEGIN</a> (InstructionCombiningPass, &quot;instcombine&quot;, &quot;Combine redundant instructions&quot;, false, false) INITIALIZE&#95;PASS&#95;END(InstructionCombiningPass</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a5d94ee8aaee00c42c11954aaa6022894">isAllocSiteRemovable</a> (Instruction &#42;AI, SmallVectorImpl&lt; WeakTrackingVH &gt; &amp;Users, const TargetLibraryInfo &amp;TLI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ae4125133d683a4652b396ec3b18cd92e">isCatchAll</a> (EHPersonality Personality, Constant &#42;TypeInfo)</>}>
Return &#39;true&#39; if the given typeinfo will match anything. <a href="#ae4125133d683a4652b396ec3b18cd92e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a04d581f6b1ca4d25c0c0a7e97404151c">isNeverEqualToUnescapedAlloc</a> (Value &#42;V, const TargetLibraryInfo &amp;TLI, Instruction &#42;AI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#abbd47852a13b73290f4625f20c9018d8">isRemovableWrite</a> (CallBase &amp;CB, Value &#42;UsedV, const TargetLibraryInfo &amp;TLI)</>}>
Given a call CB which uses an address UsedV, return true if we can prove the call&#39;s only possible effect is storing to V. <a href="#abbd47852a13b73290f4625f20c9018d8">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a04960b3b85873b5232f0d293f29946c1">isUsedWithinShuffleVector</a> (Value &#42;V)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a615b5564b60828081d3682b75710627c">leftDistributesOverRight</a> (Instruction::BinaryOps LOp, Instruction::BinaryOps ROp)</>}>
Return whether &quot;X LOp (Y ROp Z)&quot; is always equal to &quot;(X LOp Y) ROp (X LOp Z)&quot;. <a href="#a615b5564b60828081d3682b75710627c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af93581c21ffd5eccbb745274f226dbe7">maintainNoSignedWrap</a> (BinaryOperator &amp;I, Value &#42;B, Value &#42;C)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; std::pair&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &gt;</>}
  name={<><a href="#a6b7f636d0a933a4771be0a45870c4db8">matchSymmetricPhiNodesPair</a> (PHINode &#42;LHS, PHINode &#42;RHS)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9f7798eb98807e7ce804788b339a6978">rightDistributesOverLeft</a> (Instruction::BinaryOps LOp, Instruction::BinaryOps ROp)</>}>
Return whether &quot;(X LOp Y) ROp Z&quot; is always equal to &quot;(X ROp Z) LOp (Y ROp Z)&quot;. <a href="#a9f7798eb98807e7ce804788b339a6978">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a13d41ea63582902162e0efd8a78a5ad5">shorter&#95;filter</a> (const Value &#42;LHS, const Value &#42;RHS)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a48d49b8df95d21ba931f3642c1f5a30d">shouldCanonicalizeGEPToPtrAdd</a> (GetElementPtrInst &amp;GEP)</>}>
Return true if we should canonicalize the gep to an i8 ptradd. <a href="#a48d49b8df95d21ba931f3642c1f5a30d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a27dc41c474e5376ef7d1865735cfb3dd">shouldMergeGEPs</a> (GEPOperator &amp;GEP, GEPOperator &amp;Src)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a41c00c458f7416c93927bc2f332b3898">simplifyAssocCastAssoc</a> (BinaryOperator &#42;BinOp1, InstCombinerImpl &amp;IC)</>}>
Combine constant operands of associative operations either before or after a cast to eliminate one of the associative operations: (op (cast (op X, C2)), C1) --&gt; (cast (op X, op (C1, C2))) (op (cast (op X, C2)), C1) --&gt; (op (cast X), op (C1, C2)) <a href="#a41c00c458f7416c93927bc2f332b3898">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a45bde60377059fca310bb78e5d3a3ccb">simplifyInstructionWithPHI</a> (Instruction &amp;I, PHINode &#42;PN, Value &#42;InValue, BasicBlock &#42;InBB, const DataLayout &amp;DL, const SimplifyQuery SQ)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a89d0a81f215ecb18fe5e589fbe66dc1e">simplifyOperationIntoSelectOperand</a> (Instruction &amp;I, SelectInst &#42;SI, bool IsTrueArm)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a002b7ea3a854166ae7ffe9d0e3e994d7">simplifySwitchOnSelectUsingRanges</a> (SwitchInst &amp;SI, SelectInst &#42;Select, bool IsTrueArm)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aca7c31a6dcc095ed3c2831f6876c6dc0">SoleWriteToDeadLocal</a> (Instruction &#42;I, TargetLibraryInfo &amp;TLI)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> for case where the call writes to an otherwise dead alloca. <a href="#aca7c31a6dcc095ed3c2831f6876c6dc0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a0db1909b0671aaf6abdb3ca4f0ec06d0">STATISTIC</a> (NumWorklistIterations, &quot;Number of instruction combining iterations performed&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac6531727684f4aee04bb115319b8666e">STATISTIC</a> (NumOneIteration, &quot;Number of functions with one iteration&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ace247c3d1e258ace812aec8f664dc397">STATISTIC</a> (NumTwoIterations, &quot;Number of functions with two iterations&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a0631cbd33f8ac9b6831db4f5cad3d7df">STATISTIC</a> (NumThreeIterations, &quot;Number of functions with three iterations&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ad76ad3ad3fa67a6596dab86c03b0daa4">STATISTIC</a> (NumFourOrMoreIterations, &quot;Number of functions with four or more iterations&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a5b164a5173f35e1650cd742f1d59be03">STATISTIC</a> (NumCombined, &quot;Number of insts combined&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ab417760e8d796dad885df57792182b43">STATISTIC</a> (NumConstProp, &quot;Number of constant folds&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ad3ce7d230f0e3eee5bddf58166ba6521">STATISTIC</a> (NumDeadInst, &quot;Number of dead inst eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a91d560232cc5e31c09e47c942bbca401">STATISTIC</a> (NumSunkInst, &quot;Number of instructions sunk&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#acfd0bbcbc789bf86c6670e4de61edaba">STATISTIC</a> (NumExpand, &quot;Number of expansions&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aed48dea716c43ccc2be25745198180ca">STATISTIC</a> (NumFactor, &quot;Number of factorizations&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a6b287edafd0ce24fba1ca0841ef69c8b">STATISTIC</a> (NumReassoc, &quot;Number of reassociations&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#ab952034edc23ad21ab312e0baaea0d7e">tryFactorization</a> (BinaryOperator &amp;I, const SimplifyQuery &amp;SQ, InstCombiner::BuilderTy &amp;Builder, Instruction::BinaryOps InnerOpcode, Value &#42;A, Value &#42;B, Value &#42;C, Value &#42;D)</>}>
This tries to simplify binary operations by factorizing out common terms (e. <a href="#ab952034edc23ad21ab312e0baaea0d7e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a87ed771bf8f375c44d2c5451328d4637">tryToMoveFreeBeforeNullTest</a> (CallInst &amp;FI, const DataLayout &amp;DL)</>}>
Move the call to free before a NULL test. <a href="#a87ed771bf8f375c44d2c5451328d4637">More...</a>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#af2d52269f675e18b1f7e7cd3b4df6c47">EnableCodeSinking</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonvectorcombine-cpp/#ab582deb65d0ec7f41efa6d8579daf0e1">Combine</a> redundant</>}
  name={<><a href="#ac735dc0034fb289533e5dc1a10a6c9ce">false</a></>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a7d4d7e39548303ef4c1f5a0ed13a9c23">instcombine</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonvectorcombine-cpp/#ab582deb65d0ec7f41efa6d8579daf0e1">Combine</a> redundant</>}
  name={<><a href="#a9360db2a972441c49cdbbabb5b20cc27">instructions</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a296fa67782952394abb3c14137eef1c4">MaxArraySize</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#acdf26e07093ddfc79830643f176af525">MaxSinkNumUsers</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a3a08a0164a82ef4868072c7adf277c22">ShouldLowerDbgDeclare</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;instcombine&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### canonicalizeGEPOfConstGEPI8() {#a856d46e90d7159a88c175ceff667f40c}

<MemberDefinition
  prototype={<>static Instruction &#42; canonicalizeGEPOfConstGEPI8 (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &amp; GEP, <a href="/docs/api/classes/llvm/gepoperator">GEPOperator</a> &#42; Src, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC)</>}
  labels = {["static"]}>

Definition at line <a href="#l02412">2412</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### ClearSubclassDataAfterReassociation() {#a4904699fe3329a5027ccd76991b0c1e4}

<MemberDefinition
  prototype={<>static void ClearSubclassDataAfterReassociation (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp; I)</>}
  labels = {["static"]}>
Conservatively clears subclassOptionalData after a reassociation or commutation.

We preserve fast-math flags when applicable as they can be preserved.

Definition at line <a href="#l00327">327</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### combineInstructionsOverFunction() {#a45a945c85468ec7d17b48b0d4f612b7e}

<MemberDefinition
  prototype={<>static bool combineInstructionsOverFunction (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/classes/llvm/instructionworklist">InstructionWorklist</a> &amp; Worklist, <a href="/docs/api/namespaces/llvm/#ae457f1cf451ed893666c4a384e58f8e5">AliasAnalysis</a> &#42; AA, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &amp; AC, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp; TLI, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp; DT, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &amp; ORE, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42; BFI, <a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a> &#42; BPI, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42; PSI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/instcombineoptions">InstCombineOptions</a> &amp; Opts)</>}
  labels = {["static"]}>

Definition at line <a href="#l05508">5508</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### DEBUG&#95;COUNTER() {#ac39bd0ff6a3f194647bdcc7f46cfde61}

<MemberDefinition
  prototype={<>DEBUG&#95;COUNTER (VisitCounter, &quot;instcombine-visit&quot;, &quot;Controls which <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> are visited&quot;)</>}>

Definition at line <a href="#l00130">130</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### foldGEPOfPhi() {#ad12cb02e2ee53655e834dcb84cd57333}

<MemberDefinition
  prototype={<>static Instruction &#42; foldGEPOfPhi (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &amp; GEP, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; Builder)</>}
  labels = {["static"]}>

Definition at line <a href="#l02792">2792</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### foldOperationIntoSelectOperand() {#a7b9a62f04a493cc8b8dadc64100578f8}

<MemberDefinition
  prototype={<>static Value &#42; foldOperationIntoSelectOperand (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42; SI, <a href="/docs/api/classes/llvm/value">Value</a> &#42; NewOp, <a href="/docs/api/classes/llvm/instcombiner">InstCombiner</a> &amp; IC)</>}
  labels = {["static"]}>

Definition at line <a href="#l01678">1678</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### foldSelectGEP() {#a16a66955e366f83c6e35d99511a33167}

<MemberDefinition
  prototype={<>static Instruction &#42; foldSelectGEP (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &amp; GEP, InstCombiner::BuilderTy &amp; Builder)</>}
  labels = {["static"]}>
Thread a GEP operation with constant indices through the constant true/false arms of a select.

Definition at line <a href="#l02385">2385</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### getBinOpsForFactorization() {#ac7754c95309ff1784b1e47b0001deeee}

<MemberDefinition
  prototype={<>static Instruction::BinaryOps getBinOpsForFactorization (<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> TopOpcode, <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42; Op, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; LHS, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; RHS, <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42; OtherOp)</>}
  labels = {["static"]}>
This function predicates factorization using distributive laws.

By default, it just returns the &#39;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>&#39; inputs. But for special-cases like &#39;add(shl(X, 5), ...)&#39;, this function will have TopOpcode == Instruction::Add and <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = shl(X, 5). The &#39;shl&#39; is treated as the more general &#39;mul X, 32&#39; to allow more factorization opportunities.

Definition at line <a href="#l00646">646</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### getIdentityValue() {#a5e80024df498e16b544d9c0d3f2d9eb4}

<MemberDefinition
  prototype={<>static Value &#42; getIdentityValue (<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opcode, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V)</>}
  labels = {["static"]}>
This function returns identity value for given opcode, which can be used to factor patterns like (X &#42; 2) + X ==&gt; (X &#42; 2) + (X &#42; 1) ==&gt; X &#42; (2 + 1).

Definition at line <a href="#l00633">633</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### getMergedGEPNoWrapFlags() {#afef6fefdb447008608fc826b31a49d28}

<MemberDefinition
  prototype={<>static GEPNoWrapFlags getMergedGEPNoWrapFlags (<a href="/docs/api/classes/llvm/gepoperator">GEPOperator</a> &amp; GEP1, <a href="/docs/api/classes/llvm/gepoperator">GEPOperator</a> &amp; GEP2)</>}
  labels = {["static"]}>
Determine nowrap flags for (gep (gep p, x), y) to (gep p, (x + y)) transform.

Definition at line <a href="#l02378">2378</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### hasNoSignedWrap() {#a3bd26297d4422f25aaeacd40ffbbc478}

<MemberDefinition
  prototype={<>static bool hasNoSignedWrap (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp; I)</>}
  labels = {["static"]}>

Definition at line <a href="#l00319">319</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### hasNoUnsignedWrap() {#ac7f3587a2e9b666879ee5067a9593253}

<MemberDefinition
  prototype={<>static bool hasNoUnsignedWrap (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp; I)</>}
  labels = {["static"]}>

Definition at line <a href="#l00314">314</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS&#95;BEGIN() {#a8a787de77e16e56d936abb2ad6ee4c8c}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (<a href="/docs/api/classes/llvm/instructioncombiningpass">InstructionCombiningPass</a>, &quot;instcombine&quot;, &quot;Combine redundant instructions&quot;, false, false)</>}>

Definition at line <a href="#l05684">5684</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### isAllocSiteRemovable() {#a5d94ee8aaee00c42c11954aaa6022894}

<MemberDefinition
  prototype={<>static bool isAllocSiteRemovable (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; AI, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/weaktrackingvh">WeakTrackingVH</a> &gt; &amp; Users, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp; TLI)</>}
  labels = {["static"]}>

Definition at line <a href="#l03207">3207</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### isCatchAll() {#ae4125133d683a4652b396ec3b18cd92e}

<MemberDefinition
  prototype={<>static bool isCatchAll (<a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6a">EHPersonality</a> Personality, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; TypeInfo)</>}
  labels = {["static"]}>
Return &#39;true&#39; if the given typeinfo will match anything.

Definition at line <a href="#l04193">4193</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### isNeverEqualToUnescapedAlloc() {#a04d581f6b1ca4d25c0c0a7e97404151c}

<MemberDefinition
  prototype={<>static bool isNeverEqualToUnescapedAlloc (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp; TLI, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; AI)</>}
  labels = {["static"]}>

Definition at line <a href="#l03175">3175</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### isRemovableWrite() {#abbd47852a13b73290f4625f20c9018d8}

<MemberDefinition
  prototype={<>static bool isRemovableWrite (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp; CB, <a href="/docs/api/classes/llvm/value">Value</a> &#42; UsedV, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp; TLI)</>}
  labels = {["static"]}>
Given a call CB which uses an address UsedV, return true if we can prove the call&#39;s only possible effect is storing to V.

Definition at line <a href="#l03187">3187</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### isUsedWithinShuffleVector() {#a04960b3b85873b5232f0d293f29946c1}

<MemberDefinition
  prototype={<>static bool isUsedWithinShuffleVector (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V)</>}
  labels = {["static"]}>

Definition at line <a href="#l04712">4712</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### leftDistributesOverRight() {#a615b5564b60828081d3682b75710627c}

<MemberDefinition
  prototype={<>static bool leftDistributesOverRight (<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> LOp, <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> ROp)</>}
  labels = {["static"]}>
Return whether &quot;X LOp (Y ROp Z)&quot; is always equal to &quot;(X LOp Y) ROp (X LOp Z)&quot;.

Definition at line <a href="#l00597">597</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### maintainNoSignedWrap() {#af93581c21ffd5eccbb745274f226dbe7}

<MemberDefinition
  prototype={<>static bool maintainNoSignedWrap (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp; I, <a href="/docs/api/classes/llvm/value">Value</a> &#42; B, <a href="/docs/api/classes/llvm/value">Value</a> &#42; C)</>}
  labels = {["static"]}>

Definition at line <a href="#l00286">286</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### matchSymmetricPhiNodesPair() {#a6b7f636d0a933a4771be0a45870c4db8}

<MemberDefinition
  prototype={<>static std::optional&lt; std::pair&lt; Value &#42;, Value &#42; &gt; &gt; matchSymmetricPhiNodesPair (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; LHS, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; RHS)</>}
  labels = {["static"]}>

Definition at line <a href="#l01225">1225</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### rightDistributesOverLeft() {#a9f7798eb98807e7ce804788b339a6978}

<MemberDefinition
  prototype={<>static bool rightDistributesOverLeft (<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> LOp, <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> ROp)</>}
  labels = {["static"]}>
Return whether &quot;(X LOp Y) ROp Z&quot; is always equal to &quot;(X ROp Z) LOp (Y ROp Z)&quot;.

Definition at line <a href="#l00618">618</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### shorter&#95;filter() {#a13d41ea63582902162e0efd8a78a5ad5}

<MemberDefinition
  prototype={<>static bool shorter&#95;filter (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; LHS, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; RHS)</>}
  labels = {["static"]}>

Definition at line <a href="#l04222">4222</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### shouldCanonicalizeGEPToPtrAdd() {#a48d49b8df95d21ba931f3642c1f5a30d}

<MemberDefinition
  prototype={<>static bool shouldCanonicalizeGEPToPtrAdd (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &amp; GEP)</>}
  labels = {["static"]}>
Return true if we should canonicalize the gep to an i8 ptradd.

Definition at line <a href="#l02763">2763</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### shouldMergeGEPs() {#a27dc41c474e5376ef7d1865735cfb3dd}

<MemberDefinition
  prototype={<>static bool shouldMergeGEPs (<a href="/docs/api/classes/llvm/gepoperator">GEPOperator</a> &amp; GEP, <a href="/docs/api/classes/llvm/gepoperator">GEPOperator</a> &amp; Src)</>}
  labels = {["static"]}>

Definition at line <a href="#l02065">2065</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### simplifyAssocCastAssoc() {#a41c00c458f7416c93927bc2f332b3898}

<MemberDefinition
  prototype={<>static bool simplifyAssocCastAssoc (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42; BinOp1, <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp; IC)</>}
  labels = {["static"]}>
Combine constant operands of associative operations either before or after a cast to eliminate one of the associative operations: (op (cast (op X, C2)), C1) --&gt; (cast (op X, op (C1, C2))) (op (cast (op X, C2)), C1) --&gt; (op (cast X), op (C1, C2))

Definition at line <a href="#l00343">343</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### simplifyInstructionWithPHI() {#a45bde60377059fca310bb78e5d3a3ccb}

<MemberDefinition
  prototype={<>static Value &#42; simplifyInstructionWithPHI (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/classes/llvm/value">Value</a> &#42; InValue, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; InBB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> SQ)</>}
  labels = {["static"]}>

Definition at line <a href="#l01730">1730</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### simplifyOperationIntoSelectOperand() {#a89d0a81f215ecb18fe5e589fbe66dc1e}

<MemberDefinition
  prototype={<>static Value &#42; simplifyOperationIntoSelectOperand (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42; SI, bool IsTrueArm)</>}
  labels = {["static"]}>

Definition at line <a href="#l01656">1656</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### simplifySwitchOnSelectUsingRanges() {#a002b7ea3a854166ae7ffe9d0e3e994d7}

<MemberDefinition
  prototype={<>static Value &#42; simplifySwitchOnSelectUsingRanges (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &amp; SI, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42; Select, bool IsTrueArm)</>}
  labels = {["static"]}>

Definition at line <a href="#l03829">3829</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### SoleWriteToDeadLocal() {#aca7c31a6dcc095ed3c2831f6876c6dc0}

<MemberDefinition
  prototype={<>static bool SoleWriteToDeadLocal (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp; TLI)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> for case where the call writes to an otherwise dead alloca.

This shows up for unused out-params in idiomatic C/C++ code. Note that this helper <em>only</em> analyzes the write; doesn&#39;t check any other legality aspect.

Definition at line <a href="#l04796">4796</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a0db1909b0671aaf6abdb3ca4f0ec06d0}

<MemberDefinition
  prototype={<>STATISTIC (NumWorklistIterations, &quot;Number of instruction combining iterations performed&quot;)</>}>

Definition at line <a href="#l00115">115</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac6531727684f4aee04bb115319b8666e}

<MemberDefinition
  prototype={<>STATISTIC (NumOneIteration, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowermoduleldspass-cpp/#a8818b45f8c07ddce635268ec684dc61a">functions</a> with one iteration&quot;)</>}>

Definition at line <a href="#l00117">117</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ace247c3d1e258ace812aec8f664dc397}

<MemberDefinition
  prototype={<>STATISTIC (NumTwoIterations, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowermoduleldspass-cpp/#a8818b45f8c07ddce635268ec684dc61a">functions</a> with two iterations&quot;)</>}>

Definition at line <a href="#l00118">118</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a0631cbd33f8ac9b6831db4f5cad3d7df}

<MemberDefinition
  prototype={<>STATISTIC (NumThreeIterations, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowermoduleldspass-cpp/#a8818b45f8c07ddce635268ec684dc61a">functions</a> with three iterations&quot;)</>}>

Definition at line <a href="#l00119">119</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ad76ad3ad3fa67a6596dab86c03b0daa4}

<MemberDefinition
  prototype={<>STATISTIC (NumFourOrMoreIterations, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowermoduleldspass-cpp/#a8818b45f8c07ddce635268ec684dc61a">functions</a> with four or more iterations&quot;)</>}>

Definition at line <a href="#l00120">120</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a5b164a5173f35e1650cd742f1d59be03}

<MemberDefinition
  prototype={<>STATISTIC (NumCombined, &quot;Number of insts combined&quot;)</>}>

Definition at line <a href="#l00123">123</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ab417760e8d796dad885df57792182b43}

<MemberDefinition
  prototype={<>STATISTIC (NumConstProp, &quot;Number of constant folds&quot;)</>}>

Definition at line <a href="#l00124">124</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ad3ce7d230f0e3eee5bddf58166ba6521}

<MemberDefinition
  prototype={<>STATISTIC (NumDeadInst, &quot;Number of dead inst eliminated&quot;)</>}>

Definition at line <a href="#l00125">125</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a91d560232cc5e31c09e47c942bbca401}

<MemberDefinition
  prototype={<>STATISTIC (NumSunkInst, &quot;Number of <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> sunk&quot;)</>}>

Definition at line <a href="#l00126">126</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### STATISTIC() {#acfd0bbcbc789bf86c6670e4de61edaba}

<MemberDefinition
  prototype={<>STATISTIC (NumExpand, &quot;Number of expansions&quot;)</>}>

Definition at line <a href="#l00127">127</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aed48dea716c43ccc2be25745198180ca}

<MemberDefinition
  prototype={<>STATISTIC (NumFactor, &quot;Number of factorizations&quot;)</>}>

Definition at line <a href="#l00128">128</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a6b287edafd0ce24fba1ca0841ef69c8b}

<MemberDefinition
  prototype={<>STATISTIC (NumReassoc, &quot;Number of reassociations&quot;)</>}>

Definition at line <a href="#l00129">129</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### tryFactorization() {#ab952034edc23ad21ab312e0baaea0d7e}

<MemberDefinition
  prototype={<>static Value &#42; tryFactorization (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp; I, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp; SQ, InstCombiner::BuilderTy &amp; Builder, <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> InnerOpcode, <a href="/docs/api/classes/llvm/value">Value</a> &#42; A, <a href="/docs/api/classes/llvm/value">Value</a> &#42; B, <a href="/docs/api/classes/llvm/value">Value</a> &#42; C, <a href="/docs/api/classes/llvm/value">Value</a> &#42; D)</>}
  labels = {["static"]}>
This tries to simplify binary operations by factorizing out common terms (e.

g. &quot;(A&#42;B)+(A&#42;C)&quot; -&gt; &quot;A&#42;(B+C)&quot;).

Definition at line <a href="#l00674">674</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### tryToMoveFreeBeforeNullTest() {#a87ed771bf8f375c44d2c5451328d4637}

<MemberDefinition
  prototype={<>static Instruction &#42; tryToMoveFreeBeforeNullTest (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &amp; FI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Move the call to free before a NULL test.

<a href="/docs/api/namespaces/llvm/check">Check</a> if this free is accessed after its argument has been test against NULL (property 0). If yes, it is legal to move this call in its predecessor block.

The move is performed only if the block containing the call to free will be removed, i.e.:
<ul>
<li>it has only one predecessor P, and P has two successors</li>
<li>it contains the call, noops, and an unconditional branch</li>
<li>its successor is the same as its predecessor&#39;s successor</li>
</ul>


The profitability is out-of concern here and this function should be called only if the caller knows this transformation would be profitable (e.g., for code size).

Definition at line <a href="#l03463">3463</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### EnableCodeSinking {#af2d52269f675e18b1f7e7cd3b4df6c47}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableCodeSinking(&quot;instcombine-code-sinking&quot;, cl::desc(&quot;Enable code sinking&quot;), cl::init(true))</>}
  labels = {["static"]}>

Definition at line <a href="#l00134">134</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### false {#ac735dc0034fb289533e5dc1a10a6c9ce}

<MemberDefinition
  prototype="Combine redundant false">

Definition at line <a href="#l05696">5696</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### instcombine {#a7d4d7e39548303ef4c1f5a0ed13a9c23}

<MemberDefinition
  prototype="instcombine">

Definition at line <a href="#l05695">5695</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### instructions {#a9360db2a972441c49cdbbabb5b20cc27}

<MemberDefinition
  prototype="Combine redundant instructions">

Definition at line <a href="#l05696">5696</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### MaxArraySize {#a296fa67782952394abb3c14137eef1c4}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxArraySize(&quot;instcombine-maxarray-size&quot;, cl::init(1024), cl::desc(&quot;Maximum array size considered when doing a combine&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00142">142</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### MaxSinkNumUsers {#acdf26e07093ddfc79830643f176af525}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxSinkNumUsers(&quot;instcombine-max-sink-users&quot;, cl::init(32), cl::desc(&quot;Maximum number of undroppable users for instruction sinking&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00137">137</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

### ShouldLowerDbgDeclare {#a3a08a0164a82ef4868072c7adf277c22}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ShouldLowerDbgDeclare(&quot;instcombine-lower-dbg-declare&quot;, cl::Hidden, cl::init(true))</>}
  labels = {["static"]}>

Definition at line <a href="#l00152">152</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;instcombine&quot;</>}>

Definition at line <a href="#l00108">108</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instructioncombining-cpp">InstructionCombining.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===- InstructionCombining.cpp - Combine multiple instructions -----------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="normal"></Highlight><Highlight kind="comment">// InstructionCombining - Combine instructions to form fewer, simple</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="normal"></Highlight><Highlight kind="comment">// instructions.  This pass does not modify the CFG.  This pass is where</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="normal"></Highlight><Highlight kind="comment">// algebraic simplification happens.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This pass combines things like:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    %Y = add i32 %X, 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    %Z = add i32 %Y, 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="comment">// into:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    %Z = add i32 %X, 2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This is a simple worklist driven algorithm.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This pass guarantees that the following canonicalizations are performed on</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="comment">// the program:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    1 If a binary operator has a constant operand, it is moved to the RHS</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    2 Bitwise operators with constant operands are always grouped so that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="comment">//       shifts are performed first, then or&#39;s, then and&#39;s, then xor&#39;s.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    3 Compare instructions are converted from &lt;,&gt;,&lt;=,&gt;= to ==,!= if possible</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    4 All cmp instructions on boolean values are replaced with logical ops</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    5 add X, X is represented as (X&#42;2) =&gt; (X &lt;&lt; 1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    6 Multiplies with a power-of-two constant argument are transformed into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight><Highlight kind="comment">//       shifts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ... etc.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombineinternal-h">InstCombineInternal.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h">llvm/ADT/APInt.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h">llvm/Analysis/AliasAnalysis.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h">llvm/Analysis/AssumptionCache.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/basicaliasanalysis-h">llvm/Analysis/BasicAliasAnalysis.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h">llvm/Analysis/BlockFrequencyInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/cfg-h">llvm/Analysis/CFG.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/constantfolding-h">llvm/Analysis/ConstantFolding.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/globalsmodref-h">llvm/Analysis/GlobalsModRef.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h">llvm/Analysis/InstructionSimplify.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/lastruntrackinganalysis-h">llvm/Analysis/LastRunTrackingAnalysis.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/lazyblockfrequencyinfo-h">llvm/Analysis/LazyBlockFrequencyInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memorybuiltins-h">llvm/Analysis/MemoryBuiltins.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h">llvm/Analysis/ProfileSummaryInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targetfolder-h">llvm/Analysis/TargetFolder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/include/llvm/analysis/utils/local-h">llvm/Analysis/Utils/Local.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h">llvm/Analysis/VectorUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h">llvm/IR/CFG.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h">llvm/IR/DIBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/ehpersonalities-h">llvm/IR/EHPersonalities.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/getelementptrtypeiterator-h">llvm/IR/GetElementPtrTypeIterator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h">llvm/IR/Metadata.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h">llvm/IR/Operator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h">llvm/IR/PassManager.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/use-h">llvm/IR/Use.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h">llvm/IR/ValueHandle.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h">llvm/Support/Compiler.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debugcounter-h">llvm/Support/DebugCounter.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/knownbits-h">llvm/Support/KnownBits.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/instcombine/instcombine-h">llvm/Transforms/InstCombine/InstCombine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;algorithm&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cassert&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cstdint&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;memory&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;optional&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;string&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;utility&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;instcombine&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/instructionworklist-h">llvm/Transforms/Utils/InstructionWorklist.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;optional&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115" lineLink="#a0db1909b0671aaf6abdb3ca4f0ec06d0"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumWorklistIterations,</Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Number of instruction combining iterations performed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117" lineLink="#ac6531727684f4aee04bb115319b8666e"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumOneIteration, </Highlight><Highlight kind="stringliteral">&quot;Number of functions with one iteration&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118" lineLink="#ace247c3d1e258ace812aec8f664dc397"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumTwoIterations, </Highlight><Highlight kind="stringliteral">&quot;Number of functions with two iterations&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119" lineLink="#a0631cbd33f8ac9b6831db4f5cad3d7df"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumThreeIterations, </Highlight><Highlight kind="stringliteral">&quot;Number of functions with three iterations&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120" lineLink="#ad76ad3ad3fa67a6596dab86c03b0daa4"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumFourOrMoreIterations,</Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Number of functions with four or more iterations&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123" lineLink="#a5b164a5173f35e1650cd742f1d59be03"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumCombined , </Highlight><Highlight kind="stringliteral">&quot;Number of insts combined&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124" lineLink="#ab417760e8d796dad885df57792182b43"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumConstProp, </Highlight><Highlight kind="stringliteral">&quot;Number of constant folds&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125" lineLink="#ad3ce7d230f0e3eee5bddf58166ba6521"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumDeadInst , </Highlight><Highlight kind="stringliteral">&quot;Number of dead inst eliminated&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126" lineLink="#a91d560232cc5e31c09e47c942bbca401"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSunkInst , </Highlight><Highlight kind="stringliteral">&quot;Number of instructions sunk&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127" lineLink="#acfd0bbcbc789bf86c6670e4de61edaba"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumExpand,    </Highlight><Highlight kind="stringliteral">&quot;Number of expansions&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128" lineLink="#aed48dea716c43ccc2be25745198180ca"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumFactor   , </Highlight><Highlight kind="stringliteral">&quot;Number of factorizations&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129" lineLink="#a6b287edafd0ce24fba1ca0841ef69c8b"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumReassoc  , </Highlight><Highlight kind="stringliteral">&quot;Number of reassociations&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130" lineLink="#ac39bd0ff6a3f194647bdcc7f46cfde61"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/support/debugcounter-h/#a0a175e0c17c3f2a0570e919ab68da2a4">DEBUG&#95;COUNTER</a>(VisitCounter, </Highlight><Highlight kind="stringliteral">&quot;instcombine-visit&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><Highlight kind="normal">              </Highlight><Highlight kind="stringliteral">&quot;Controls which instructions are visited&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134" lineLink="#af2d52269f675e18b1f7e7cd3b4df6c47"><Highlight kind="normal"><a href="#af2d52269f675e18b1f7e7cd3b4df6c47">EnableCodeSinking</a>(</Highlight><Highlight kind="stringliteral">&quot;instcombine-code-sinking&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable code sinking&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="normal">                                              <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137" lineLink="#acdf26e07093ddfc79830643f176af525"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#acdf26e07093ddfc79830643f176af525">MaxSinkNumUsers</a>(</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;instcombine-max-sink-users&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(32),</Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Maximum number of undroppable users for instruction sinking&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a></Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142" lineLink="#a296fa67782952394abb3c14137eef1c4"><Highlight kind="normal"><a href="#a296fa67782952394abb3c14137eef1c4">MaxArraySize</a>(</Highlight><Highlight kind="stringliteral">&quot;instcombine-maxarray-size&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(1024),</Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal">             <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Maximum array size considered when doing a combine&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="normal"></Highlight><Highlight kind="comment">// FIXME: Remove this flag when it is no longer necessary to convert</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="normal"></Highlight><Highlight kind="comment">// llvm.dbg.declare to avoid inaccurate debug info. Setting this to false</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="normal"></Highlight><Highlight kind="comment">// increases variable availability at the cost of accuracy. Variables that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="normal"></Highlight><Highlight kind="comment">// cannot be promoted by mem2reg or SROA will be described as living in memory</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal"></Highlight><Highlight kind="comment">// for their entire lifetime. However, passes like DSE and instcombine can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><Highlight kind="normal"></Highlight><Highlight kind="comment">// delete stores to the alloca, leading to misleading and inaccurate debug</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal"></Highlight><Highlight kind="comment">// information. This flag can be removed when those passes are fixed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152" lineLink="#a3a08a0164a82ef4868072c7adf277c22"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a3a08a0164a82ef4868072c7adf277c22">ShouldLowerDbgDeclare</a>(</Highlight><Highlight kind="stringliteral">&quot;instcombine-lower-dbg-declare&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="normal">                                               <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="normal">std::optional&lt;Instruction &#42;&gt;</Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156" lineLink="/docs/api/classes/llvm/instcombiner/#aaeec6d7b5f74d07ed6e0e15fc652e327"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instcombiner/#aaeec6d7b5f74d07ed6e0e15fc652e327">InstCombiner::targetInstCombineIntrinsic</a>(<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Handle target specific intrinsics</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getCalledFunction()-&gt;isTargetIntrinsic()) &#123;</Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TTIForTargetIntrinsicsOnly.instCombineIntrinsic(&#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164" lineLink="/docs/api/classes/llvm/instcombiner/#adccadc34e77a7a0982a0832ce2419a00"><Highlight kind="normal">std::optional&lt;Value &#42;&gt; <a href="/docs/api/classes/llvm/instcombiner/#adccadc34e77a7a0982a0832ce2419a00">InstCombiner::targetSimplifyDemandedUseBitsIntrinsic</a>(</Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/classes/llvm/apint">APInt</a> DemandedMask, <a href="/docs/api/structs/llvm/knownbits">KnownBits</a> &amp;Known,</Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &amp;KnownBitsComputed) &#123;</Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Handle target specific intrinsics</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getCalledFunction()-&gt;isTargetIntrinsic()) &#123;</Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TTIForTargetIntrinsicsOnly.simplifyDemandedUseBitsIntrinsic(</Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><Highlight kind="normal">        &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, DemandedMask, Known, KnownBitsComputed);</Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175" lineLink="/docs/api/classes/llvm/instcombiner/#ac1539f8fc8167c5be0eb439a4c5187fc"><Highlight kind="normal">std::optional&lt;Value &#42;&gt; <a href="/docs/api/classes/llvm/instcombiner/#ac1539f8fc8167c5be0eb439a4c5187fc">InstCombiner::targetSimplifyDemandedVectorEltsIntrinsic</a>(</Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/classes/llvm/apint">APInt</a> DemandedElts, <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;PoisonElts,</Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;PoisonElts2, <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;PoisonElts3,</Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="normal">    std::function&lt;</Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal">(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/apint">APInt</a>, <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;)&gt;</Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><Highlight kind="normal">        SimplifyAndSetOp) &#123;</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Handle target specific intrinsics</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getCalledFunction()-&gt;isTargetIntrinsic()) &#123;</Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TTIForTargetIntrinsicsOnly.simplifyDemandedVectorEltsIntrinsic(</Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal">        &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, DemandedElts, PoisonElts, PoisonElts2, PoisonElts3,</Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal">        SimplifyAndSetOp);</Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189" lineLink="/docs/api/classes/llvm/instcombiner/#aed7a042bbe624a8dcfdfb66c8bf39777"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#aed7a042bbe624a8dcfdfb66c8bf39777">InstCombiner::isValidAddrSpaceCast</a>(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> FromAS, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ToAS)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Approved exception for TTI use: This queries a legality property of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// target, not an profitability heuristic. Ideally this should be part of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// DataLayout instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TTIForTargetIntrinsicsOnly.isValidAddrSpaceCast(FromAS, ToAS);</Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;InstCombinerImpl::EmitGEPOffset(<a href="/docs/api/classes/llvm/gepoperator">GEPOperator</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> RewriteGEP) &#123;</Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RewriteGEP)</Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a67aa349e8bb1aefc2a8a6ca18be9b87c">llvm::emitGEPOffset</a>(&amp;<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilderbase/insertpointguard">IRBuilderBase::InsertPointGuard</a> Guard(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>);</Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Inst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inst)</Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Inst);</Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = EmitGEPOffset(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If a non-trivial GEP has other uses, rewrite it to avoid duplicating</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the offset arithmetic.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inst &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasOneUse() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasAllConstantIndices() &amp;&amp;</Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal">      !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getSourceElementType()-&gt;isIntegerTy(8)) &#123;</Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(</Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><Highlight kind="normal">        &#42;Inst, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7be2e1490f01c049d748436f03760c5">getInt8Ty</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand(),</Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="normal">                                 <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNoWrapFlags()));</Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;Inst);</Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="comment">/// Legal integers and common types are considered desirable. This is used to</Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="comment">/// avoid creating instructions with types that may not be supported well by the</Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="comment">/// the backend.</Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="comment">/// NOTE: This treats i8, i16 and i32 specially because they are common</Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="comment">///       types in frontend languages.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InstCombinerImpl::isDesirableIntType(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>) &#123;</Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> 8:</Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> 16:</Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> 32:</Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.isLegalInteger(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>);</Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="comment">/// Return true if it is desirable to convert an integer computation from a</Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="comment">/// given bit width to a new bit width.</Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="comment">/// We don&#39;t want to convert from a legal or desirable type (like i8) to an</Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="comment">/// illegal type or from a smaller to a larger illegal type. A width of &#39;1&#39;</Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="comment">/// is always treated as a desirable type because i1 is a fundamental type in</Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="comment">/// IR, and there are many specialized optimizations for i1 types.</Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="comment">/// Common/desirable widths are equally treated as legal to convert to, in</Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="comment">/// order to open up more combining opportunities.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InstCombinerImpl::shouldChangeType(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> FromWidth,</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="normal">                                        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ToWidth)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> FromLegal = FromWidth == 1 || <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.isLegalInteger(FromWidth);</Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ToLegal = ToWidth == 1 || <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.isLegalInteger(ToWidth);</Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Convert to desirable widths even if they are not legal types.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only shrink types, to prevent infinite loops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ToWidth &lt; FromWidth &amp;&amp; isDesirableIntType(ToWidth))</Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this is a legal or desiable integer from type, and the result would be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// an illegal type, don&#39;t do the transformation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((FromLegal || isDesirableIntType(FromWidth)) &amp;&amp; !ToLegal)</Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Otherwise, if both are illegal, do not increase the size of the result. We</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// do allow things like i160 -&gt; i64, but not i64 -&gt; i160.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FromLegal &amp;&amp; !ToLegal &amp;&amp; ToWidth &gt; FromWidth)</Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><Highlight kind="comment">/// Return true if it is desirable to convert a computation from &#39;From&#39; to &#39;To&#39;.</Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="comment">/// We don&#39;t want to convert from a legal to an illegal type or from a smaller</Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="comment">/// to a larger illegal type. i1 is always treated as a legal type because it is</Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><Highlight kind="comment">/// a fundamental type in IR, and there are many specialized optimizations for</Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="comment">/// i1 types.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InstCombinerImpl::shouldChangeType(<a href="/docs/api/classes/llvm/type">Type</a> &#42;From, <a href="/docs/api/classes/llvm/type">Type</a> &#42;To)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: This could be extended to allow vectors. Datalayout changes might be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// needed to properly support that.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!From-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() || !To-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>())</Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> FromWidth = From-&gt;<a href="/docs/api/classes/llvm/type/#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>();</Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ToWidth = To-&gt;<a href="/docs/api/classes/llvm/type/#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>();</Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> shouldChangeType(FromWidth, ToWidth);</Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Return true, if No Signed Wrap should be maintained for I.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The No Signed Wrap flag can be kept if the operation &quot;B (I.getOpcode) C&quot;,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal"></Highlight><Highlight kind="comment">// where both B and C should be ConstantInts, results in a constant that does</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal"></Highlight><Highlight kind="comment">// not overflow. This function only handles the Add/Sub/Mul opcodes. For</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="normal"></Highlight><Highlight kind="comment">// all other opcodes, the function conservatively returns false.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286" lineLink="#af93581c21ffd5eccbb745274f226dbe7"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#af93581c21ffd5eccbb745274f226dbe7">maintainNoSignedWrap</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &#123;</Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OBO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;OverflowingBinaryOperator&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OBO || !OBO-&gt;hasNoSignedWrap())</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;BVal, &#42;CVal;</Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(BVal)) || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(CVal)))</Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We reason about Add/Sub/Mul Only.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Overflow = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Add:</Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><Highlight kind="normal">    (void)BVal-&gt;<a href="/docs/api/classes/llvm/apint/#a694293446a074c3d64270e7671bb5052">sadd&#95;ov</a>(&#42;CVal, Overflow);</Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Sub:</Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal">    (void)BVal-&gt;<a href="/docs/api/classes/llvm/apint/#ae324de5041feaf7eb8433221cdaca9aa">ssub&#95;ov</a>(&#42;CVal, Overflow);</Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Mul:</Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">    (void)BVal-&gt;<a href="/docs/api/classes/llvm/apint/#ac155d7c568fc1aba25723e77b6888908">smul&#95;ov</a>(&#42;CVal, Overflow);</Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Conservatively return false for other opcodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !Overflow;</Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314" lineLink="#ac7f3587a2e9b666879ee5067a9593253"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ac7f3587a2e9b666879ee5067a9593253">hasNoUnsignedWrap</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OBO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;OverflowingBinaryOperator&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OBO &amp;&amp; OBO-&gt;hasNoUnsignedWrap();</Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319" lineLink="#a3bd26297d4422f25aaeacd40ffbbc478"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a3bd26297d4422f25aaeacd40ffbbc478">hasNoSignedWrap</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OBO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;OverflowingBinaryOperator&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OBO &amp;&amp; OBO-&gt;hasNoSignedWrap();</Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><Highlight kind="comment">/// Conservatively clears subclassOptionalData after a reassociation or</Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="comment">/// commutation. We preserve fast-math flags when applicable as they can be</Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="comment">/// preserved.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327" lineLink="#a4904699fe3329a5027ccd76991b0c1e4"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a4904699fe3329a5027ccd76991b0c1e4">ClearSubclassDataAfterReassociation</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/fpmathoperator">FPMathOperator</a> &#42;FPMO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FPMathOperator&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FPMO) &#123;</Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.clearSubclassOptionalData();</Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/fastmathflags">FastMathFlags</a> FMF = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getFastMathFlags();</Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.clearSubclassOptionalData();</Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setFastMathFlags(FMF);</Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="comment">/// Combine constant operands of associative operations either before or after a</Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="comment">/// cast to eliminate one of the associative operations:</Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="comment">/// (op (cast (op X, C2)), C1) --&gt; (cast (op X, op (C1, C2)))</Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><Highlight kind="comment">/// (op (cast (op X, C2)), C1) --&gt; (op (cast X), op (C1, C2))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343" lineLink="#a41c00c458f7416c93927bc2f332b3898"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a41c00c458f7416c93927bc2f332b3898">simplifyAssocCastAssoc</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BinOp1,</Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><Highlight kind="normal">                                   <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC) &#123;</Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cast = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(BinOp1-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Cast || !Cast-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Enhance logic for other casts and remove this check.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CastOpcode = Cast-&gt;getOpcode();</Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CastOpcode != Instruction::ZExt)</Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Enhance logic for other BinOps and remove this check.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BinOp1-&gt;<a href="/docs/api/classes/llvm/instruction/#a2d0036d2d7b30f510927731ba7a4f4b9">isBitwiseLogicOp</a>())</Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AssocOpcode = BinOp1-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>();</Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BinOp2 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(Cast-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BinOp2 || !BinOp2-&gt;hasOneUse() || BinOp2-&gt;getOpcode() != AssocOpcode)</Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;C1, &#42;C2;</Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BinOp1-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(C1)) ||</Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BinOp2-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(C2)))</Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: This assumes a zext cast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Eg, if it was a trunc, we&#39;d cast C1 to the source type because casting C2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to the destination type might lose bits.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Fold the constants together in the destination type:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (op (cast (op X, C2)), C1) --&gt; (op (cast X), FoldedC)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = IC.<a href="/docs/api/classes/llvm/instcombiner/#a16262e69f9cdf5d2c9d5623c3b06af43">getDataLayout</a>();</Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestTy = C1-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CastC2 = <a href="/docs/api/namespaces/llvm/#a8bf77c90e2fb57af4d4d4aab084f7052">ConstantFoldCastOperand</a>(CastOpcode, C2, DestTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CastC2)</Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;FoldedC = <a href="/docs/api/namespaces/llvm/#a964455f36837281d37f2a44e2fcb4cca">ConstantFoldBinaryOpOperands</a>(AssocOpcode, C1, CastC2, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FoldedC)</Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><Highlight kind="normal">  IC.<a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(&#42;Cast, 0, BinOp2-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="normal">  IC.<a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(&#42;BinOp1, 1, FoldedC);</Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal">  BinOp1-&gt;<a href="/docs/api/classes/llvm/instruction/#ad4613def4002aa69721553e567ca4187">dropPoisonGeneratingFlags</a>();</Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="normal">  Cast-&gt;dropPoisonGeneratingFlags();</Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Simplifies IntToPtr/PtrToInt RoundTrip Cast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal"></Highlight><Highlight kind="comment">// inttoptr ( ptrtoint (x) ) --&gt; x</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;InstCombinerImpl::simplifyIntToPtrRoundTripCast(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Val) &#123;</Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IntToPtr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntToPtrInst&gt;</a>(Val);</Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntToPtr &amp;&amp; <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getTypeSizeInBits(IntToPtr-&gt;getDestTy()) ==</Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><Highlight kind="normal">                      <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getTypeSizeInBits(IntToPtr-&gt;getSrcTy())) &#123;</Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PtrToInt = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PtrToIntInst&gt;</a>(IntToPtr-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;CastTy = IntToPtr-&gt;getDestTy();</Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PtrToInt &amp;&amp;</Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal">        CastTy-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>() ==</Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="normal">            PtrToInt-&gt;getSrcTy()-&gt;getPointerAddressSpace() &amp;&amp;</Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getTypeSizeInBits(PtrToInt-&gt;getSrcTy()) ==</Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getTypeSizeInBits(PtrToInt-&gt;getDestTy()))</Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> PtrToInt-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="comment">/// This performs a few simplifications for operators that are associative or</Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="comment">/// commutative:</Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="comment">///  Commutative operators:</Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="comment">///  1 Order operands such that they are listed from right (least complex) to</Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="comment">///     left (most complex).  This puts constants before unary operators before</Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="comment">///     binary operators.</Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><Highlight kind="comment">///  Associative operators:</Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="comment">///  2 Transform: &quot;(A op B) op C&quot; ==&gt; &quot;A op (B op C)&quot; if &quot;B op C&quot; simplifies.</Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><Highlight kind="comment">///  3 Transform: &quot;A op (B op C)&quot; ==&gt; &quot;(A op B) op C&quot; if &quot;A op B&quot; simplifies.</Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="comment">///  Associative and commutative operators:</Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><Highlight kind="comment">///  4 Transform: &quot;(A op B) op C&quot; ==&gt; &quot;(C op A) op B&quot; if &quot;C op A&quot; simplifies.</Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="comment">///  5 Transform: &quot;A op (B op C)&quot; ==&gt; &quot;B op (C op A)&quot; if &quot;C op A&quot; simplifies.</Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="comment">///  6 Transform: &quot;(A op C1) op (B op C2)&quot; ==&gt; &quot;(A op B) op (C1 op C2)&quot;</Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="comment">///     if C1 and C2 are constants.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a225d5b1dcc0015e743f1dbbf348a9c36"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a225d5b1dcc0015e743f1dbbf348a9c36">InstCombinerImpl::SimplifyAssociativeOrCommutative</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opcode = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode();</Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">do</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Order operands such that they are listed from right (least complex) to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// left (most complex).  This puts constants before unary operators before</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// binary operators.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isCommutative() &amp;&amp; <a href="/docs/api/classes/llvm/instcombiner/#a2f79a062519c0854b4b97bbceac77997">getComplexity</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0)) &lt;</Highlight></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a2f79a062519c0854b4b97bbceac77997">getComplexity</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1)))</Highlight></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.swapOperands();</Highlight></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isCommutative()) &#123;</Highlight></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Pair = matchSymmetricPair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1))) &#123;</Highlight></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 0, Pair-&gt;first);</Highlight></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 1, Pair-&gt;second);</Highlight></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Op0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0));</Highlight></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Op1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1));</Highlight></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isAssociative()) &#123;</Highlight></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Transform: &quot;(A op B) op C&quot; ==&gt; &quot;A op (B op C)&quot; if &quot;B op C&quot; simplifies.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op0 &amp;&amp; Op0-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Opcode) &#123;</Highlight></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = Op0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = Op0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1);</Highlight></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Does &quot;B op C&quot; simplify?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(Opcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))) &#123;</Highlight></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// It simplifies to V.  Form &quot;A op V&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</Highlight></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 1, V);</Highlight></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><Highlight kind="normal">          </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsNUW = <a href="#ac7f3587a2e9b666879ee5067a9593253">hasNoUnsignedWrap</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="#ac7f3587a2e9b666879ee5067a9593253">hasNoUnsignedWrap</a>(&#42;Op0);</Highlight></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><Highlight kind="normal">          </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsNSW = <a href="#af93581c21ffd5eccbb745274f226dbe7">maintainNoSignedWrap</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &amp;&amp; <a href="#a3bd26297d4422f25aaeacd40ffbbc478">hasNoSignedWrap</a>(&#42;Op0);</Highlight></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Conservatively clear all optional flags since they may not be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// preserved by the reassociation. Reset nsw/nuw based on the above</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// analysis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><Highlight kind="normal">          <a href="#a4904699fe3329a5027ccd76991b0c1e4">ClearSubclassDataAfterReassociation</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Note: this is only valid because SimplifyBinOp doesn&#39;t look at</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// the operands to Op0.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsNUW)</Highlight></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setHasNoUnsignedWrap(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsNSW)</Highlight></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setHasNoSignedWrap(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><Highlight kind="normal">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><Highlight kind="normal">          ++NumReassoc;</Highlight></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Transform: &quot;A op (B op C)&quot; ==&gt; &quot;(A op B) op C&quot; if &quot;A op B&quot; simplifies.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op1 &amp;&amp; Op1-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Opcode) &#123;</Highlight></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0);</Highlight></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = Op1-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = Op1-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Does &quot;A op B&quot; simplify?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(Opcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))) &#123;</Highlight></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// It simplifies to V.  Form &quot;V op C&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 0, V);</Highlight></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 1, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Conservatively clear the optional flags, since they may not be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// preserved by the reassociation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><Highlight kind="normal">          <a href="#a4904699fe3329a5027ccd76991b0c1e4">ClearSubclassDataAfterReassociation</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><Highlight kind="normal">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><Highlight kind="normal">          ++NumReassoc;</Highlight></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isAssociative() &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isCommutative()) &#123;</Highlight></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a41c00c458f7416c93927bc2f332b3898">simplifyAssocCastAssoc</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">)) &#123;</Highlight></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><Highlight kind="normal">        ++NumReassoc;</Highlight></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Transform: &quot;(A op B) op C&quot; ==&gt; &quot;(C op A) op B&quot; if &quot;C op A&quot; simplifies.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op0 &amp;&amp; Op0-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Opcode) &#123;</Highlight></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = Op0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = Op0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1);</Highlight></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Does &quot;C op A&quot; simplify?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(Opcode, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))) &#123;</Highlight></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// It simplifies to V.  Form &quot;V op B&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 0, V);</Highlight></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 1, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Conservatively clear the optional flags, since they may not be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// preserved by the reassociation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><Highlight kind="normal">          <a href="#a4904699fe3329a5027ccd76991b0c1e4">ClearSubclassDataAfterReassociation</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><Highlight kind="normal">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><Highlight kind="normal">          ++NumReassoc;</Highlight></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Transform: &quot;A op (B op C)&quot; ==&gt; &quot;B op (C op A)&quot; if &quot;C op A&quot; simplifies.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op1 &amp;&amp; Op1-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Opcode) &#123;</Highlight></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0);</Highlight></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = Op1-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = Op1-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Does &quot;C op A&quot; simplify?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(Opcode, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))) &#123;</Highlight></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// It simplifies to V.  Form &quot;B op V&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 1, V);</Highlight></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Conservatively clear the optional flags, since they may not be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// preserved by the reassociation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><Highlight kind="normal">          <a href="#a4904699fe3329a5027ccd76991b0c1e4">ClearSubclassDataAfterReassociation</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><Highlight kind="normal">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><Highlight kind="normal">          ++NumReassoc;</Highlight></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Transform: &quot;(A op C1) op (B op C2)&quot; ==&gt; &quot;(A op B) op (C1 op C2)&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// if C1 and C2 are constants.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>;</Highlight></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;C1, &#42;C2, &#42;CRes;</Highlight></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op0 &amp;&amp; Op1 &amp;&amp;</Highlight></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><Highlight kind="normal">          Op0-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Opcode &amp;&amp; Op1-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Opcode &amp;&amp;</Highlight></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(C1)))) &amp;&amp;</Highlight></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op1, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(C2)))) &amp;&amp;</Highlight></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><Highlight kind="normal">          (CRes = <a href="/docs/api/namespaces/llvm/#a964455f36837281d37f2a44e2fcb4cca">ConstantFoldBinaryOpOperands</a>(Opcode, C1, C2, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>))) &#123;</Highlight></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsNUW = <a href="#ac7f3587a2e9b666879ee5067a9593253">hasNoUnsignedWrap</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><Highlight kind="normal">           <a href="#ac7f3587a2e9b666879ee5067a9593253">hasNoUnsignedWrap</a>(&#42;Op0) &amp;&amp;</Highlight></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><Highlight kind="normal">           <a href="#ac7f3587a2e9b666879ee5067a9593253">hasNoUnsignedWrap</a>(&#42;Op1);</Highlight></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><Highlight kind="normal">         <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;NewBO = (IsNUW &amp;&amp; Opcode == Instruction::Add) ?</Highlight></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><Highlight kind="normal">           <a href="/docs/api/classes/llvm/binaryoperator/#a8fbbce94455a0a2b51e1db3daf2faa2a">BinaryOperator::CreateNUW</a>(Opcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) :</Highlight></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><Highlight kind="normal">           <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(Opcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><Highlight kind="normal">         </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FPMathOperator&gt;</a>(NewBO)) &#123;</Highlight></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><Highlight kind="normal">           <a href="/docs/api/classes/llvm/fastmathflags">FastMathFlags</a> Flags = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getFastMathFlags() &amp;</Highlight></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><Highlight kind="normal">                                 Op0-&gt;<a href="/docs/api/classes/llvm/instruction/#a9a167f91db810097d281b1ed627f4575">getFastMathFlags</a>() &amp;</Highlight></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><Highlight kind="normal">                                 Op1-&gt;<a href="/docs/api/classes/llvm/instruction/#a9a167f91db810097d281b1ed627f4575">getFastMathFlags</a>();</Highlight></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><Highlight kind="normal">           NewBO-&gt;<a href="/docs/api/classes/llvm/instruction/#a5ca8aa62fa8b3fe5bc0e8fbe5d8b8b7a">setFastMathFlags</a>(Flags);</Highlight></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a7ce29ca36c91b8c790b0f8b2560c3033">InsertNewInstWith</a>(NewBO, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getIterator());</Highlight></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><Highlight kind="normal">        NewBO-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(Op1);</Highlight></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 0, NewBO);</Highlight></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, 1, CRes);</Highlight></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Conservatively clear the optional flags, since they may not be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// preserved by the reassociation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><Highlight kind="normal">        <a href="#a4904699fe3329a5027ccd76991b0c1e4">ClearSubclassDataAfterReassociation</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsNUW)</Highlight></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setHasNoUnsignedWrap(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><Highlight kind="normal">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// No further simplifications.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><Highlight kind="comment">/// Return whether &quot;X LOp (Y ROp Z)&quot; is always equal to</Highlight></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><Highlight kind="comment">/// &quot;(X LOp Y) ROp (X LOp Z)&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597" lineLink="#a615b5564b60828081d3682b75710627c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecalls-cpp/#ae063b0dfc81b595a88500b6e54e2d14a">leftDistributesOverRight</a>(<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> LOp,</Highlight></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> ROp) &#123;</Highlight></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// X &amp; (Y | Z) &lt;--&gt; (X &amp; Y) | (X &amp; Z)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// X &amp; (Y ^ Z) &lt;--&gt; (X &amp; Y) ^ (X &amp; Z)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LOp == Instruction::And)</Highlight></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ROp == Instruction::Or || ROp == Instruction::Xor;</Highlight></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// X | (Y &amp; Z) &lt;--&gt; (X | Y) &amp; (X | Z)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LOp == Instruction::Or)</Highlight></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ROp == Instruction::And;</Highlight></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// X &#42; (Y + Z) &lt;--&gt; (X &#42; Y) + (X &#42; Z)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// X &#42; (Y - Z) &lt;--&gt; (X &#42; Y) - (X &#42; Z)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LOp == Instruction::Mul)</Highlight></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ROp == Instruction::Add || ROp == Instruction::Sub;</Highlight></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><Highlight kind="comment">/// Return whether &quot;(X LOp Y) ROp Z&quot; is always equal to</Highlight></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><Highlight kind="comment">/// &quot;(X ROp Z) LOp (Y ROp Z)&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618" lineLink="#a9f7798eb98807e7ce804788b339a6978"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a9f7798eb98807e7ce804788b339a6978">rightDistributesOverLeft</a>(<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> LOp,</Highlight></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> ROp) &#123;</Highlight></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction/#a55743bd32282bf6f87aeb49237b1fb68">Instruction::isCommutative</a>(ROp))</Highlight></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecalls-cpp/#ae063b0dfc81b595a88500b6e54e2d14a">leftDistributesOverRight</a>(ROp, LOp);</Highlight></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (X &#123;&amp;|^&#125; Y) &gt;&gt; Z &lt;--&gt; (X &gt;&gt; Z) &#123;&amp;|^&#125; (Y &gt;&gt; Z) for all shifts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction/#ac3376e3bd632ad72252638ae43295ce4">Instruction::isBitwiseLogicOp</a>(LOp) &amp;&amp; <a href="/docs/api/classes/llvm/instruction/#ac5984d6827f6e6922bed00bf03ba9552">Instruction::isShift</a>(ROp);</Highlight></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: It would be nice to handle division, aka &quot;(X + Y)/Z = X/Z + Y/Z&quot;,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// but this requires knowing that the addition does not overflow and other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// such subtleties.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><Highlight kind="comment">/// This function returns identity value for given opcode, which can be used to</Highlight></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><Highlight kind="comment">/// factor patterns like (X &#42; 2) + X ==&gt; (X &#42; 2) + (X &#42; 1) ==&gt; X &#42; (2 + 1).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633" lineLink="#a5e80024df498e16b544d9c0d3f2d9eb4"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a5e80024df498e16b544d9c0d3f2d9eb4">getIdentityValue</a>(<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opcode, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V))</Highlight></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantexpr/#ae9c2f00a962cb8e0316cf3548a5d8029">ConstantExpr::getBinOpIdentity</a>(Opcode, V-&gt;getType());</Highlight></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><Highlight kind="comment">/// This function predicates factorization using distributive laws. By default,</Highlight></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><Highlight kind="comment">/// it just returns the &#39;Op&#39; inputs. But for special-cases like</Highlight></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><Highlight kind="comment">/// &#39;add(shl(X, 5), ...)&#39;, this function will have TopOpcode == Instruction::Add</Highlight></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><Highlight kind="comment">/// and Op = shl(X, 5). The &#39;shl&#39; is treated as the more general &#39;mul X, 32&#39; to</Highlight></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><Highlight kind="comment">/// allow more factorization opportunities.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a></Highlight></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646" lineLink="#ac7754c95309ff1784b1e47b0001deeee"><Highlight kind="normal"><a href="#ac7754c95309ff1784b1e47b0001deeee">getBinOpsForFactorization</a>(<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> TopOpcode, <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>,</Highlight></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><Highlight kind="normal">                          <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;OtherOp) &#123;</Highlight></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected a binary operator&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TopOpcode == Instruction::Add || TopOpcode == Instruction::Sub) &#123;</Highlight></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)))) &#123;</Highlight></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// X &lt;&lt; C --&gt; X &#42; (1 &lt;&lt; C)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = <a href="/docs/api/namespaces/llvm/#af6674e64f01f197cffff55abcc6d2050">ConstantFoldBinaryInstruction</a>(</Highlight></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><Highlight kind="normal">          Instruction::Shl, ConstantInt::get(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getType(), 1), <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Constant folding of immediate constants failed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Instruction::Mul;</Highlight></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: We can add other conversions e.g. shr =&gt; div etc.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction/#a2d0036d2d7b30f510927731ba7a4f4b9">Instruction::isBitwiseLogicOp</a>(TopOpcode)) &#123;</Highlight></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OtherOp &amp;&amp; OtherOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::AShr &amp;&amp;</Highlight></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#ab8546ee1aaa68d6f4990e6241e24464c">m&#95;LShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a396e65a1f1bc7f17eea334857d5422a4">m&#95;NonNegative</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()))) &#123;</Highlight></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// lshr nneg C, X --&gt; ashr nneg C, X</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Instruction::AShr;</Highlight></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getOpcode();</Highlight></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><Highlight kind="comment">/// This tries to simplify binary operations by factorizing out common terms</Highlight></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><Highlight kind="comment">/// (e. g. &quot;(A&#42;B)+(A&#42;C)&quot; -&gt; &quot;A&#42;(B+C)&quot;).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674" lineLink="#ab952034edc23ad21ab312e0baaea0d7e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#ab952034edc23ad21ab312e0baaea0d7e">tryFactorization</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> &amp;SQ,</Highlight></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder,</Highlight></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> InnerOpcode, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>,</Highlight></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>) &#123;</Highlight></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> &amp;&amp; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> &amp;&amp; <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> &amp;&amp; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;All values must be provided&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetVal = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0), &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1);</Highlight></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> TopLevelOpcode = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode();</Highlight></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Does &quot;X op&#39; Y&quot; always equal &quot;Y op&#39; X&quot;?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InnerCommutative = <a href="/docs/api/classes/llvm/instruction/#a55743bd32282bf6f87aeb49237b1fb68">Instruction::isCommutative</a>(InnerOpcode);</Highlight></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Does &quot;X op&#39; (Y op Z)&quot; always equal &quot;(X op&#39; Y) op (X op&#39; Z)&quot;?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecalls-cpp/#ae063b0dfc81b595a88500b6e54e2d14a">leftDistributesOverRight</a>(InnerOpcode, TopLevelOpcode)) &#123;</Highlight></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Does the instruction have the form &quot;(A op&#39; B) op (A op&#39; D)&quot; or, in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// commutative case, &quot;(A op&#39; B) op (C op&#39; A)&quot;?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> || (InnerCommutative &amp;&amp; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> == <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>)) &#123;</Highlight></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)</Highlight></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><Highlight kind="normal">        <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>);</Highlight></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Consider forming &quot;A op&#39; (B op D)&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If &quot;B op D&quot; simplifies then it can be formed with no cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><Highlight kind="normal">      V = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(TopLevelOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, SQ.<a href="/docs/api/structs/llvm/simplifyquery/#a505cdf903e17bf9be677769bf0980adc">getWithInstruction</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If &quot;B op D&quot; doesn&#39;t simplify then only go on if one of the existing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// operations &quot;A op&#39; B&quot; and &quot;C op&#39; D&quot; will be zapped as no longer used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!V &amp;&amp; (<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;hasOneUse() || <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;hasOneUse()))</Highlight></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><Highlight kind="normal">        V = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aba5d97f3a14427982c1b86dafd033320">CreateBinOp</a>(TopLevelOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getName());</Highlight></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V)</Highlight></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><Highlight kind="normal">        RetVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aba5d97f3a14427982c1b86dafd033320">CreateBinOp</a>(InnerOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, V);</Highlight></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Does &quot;(X op Y) op&#39; Z&quot; always equal &quot;(X op&#39; Z) op (Y op&#39; Z)&quot;?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RetVal &amp;&amp; <a href="#a9f7798eb98807e7ce804788b339a6978">rightDistributesOverLeft</a>(TopLevelOpcode, InnerOpcode)) &#123;</Highlight></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Does the instruction have the form &quot;(A op&#39; B) op (C op&#39; B)&quot; or, in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// commutative case, &quot;(A op&#39; B) op (B op&#39; D)&quot;?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> == <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> || (InnerCommutative &amp;&amp; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)) &#123;</Highlight></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>)</Highlight></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><Highlight kind="normal">        <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>);</Highlight></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Consider forming &quot;(A op C) op&#39; B&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If &quot;A op C&quot; simplifies then it can be formed with no cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><Highlight kind="normal">      V = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(TopLevelOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, SQ.<a href="/docs/api/structs/llvm/simplifyquery/#a505cdf903e17bf9be677769bf0980adc">getWithInstruction</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If &quot;A op C&quot; doesn&#39;t simplify then only go on if one of the existing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// operations &quot;A op&#39; B&quot; and &quot;C op&#39; D&quot; will be zapped as no longer used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!V &amp;&amp; (<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;hasOneUse() || <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;hasOneUse()))</Highlight></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><Highlight kind="normal">        V = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aba5d97f3a14427982c1b86dafd033320">CreateBinOp</a>(TopLevelOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getName());</Highlight></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V)</Highlight></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><Highlight kind="normal">        RetVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aba5d97f3a14427982c1b86dafd033320">CreateBinOp</a>(InnerOpcode, V, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RetVal)</Highlight></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><Highlight kind="normal">  ++NumFactor;</Highlight></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><Highlight kind="normal">  RetVal-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to add no-overflow flags to the final value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(RetVal)) &#123;</Highlight></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasNSW = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasNUW = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;OverflowingBinaryOperator&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><Highlight kind="normal">      HasNSW = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.hasNoSignedWrap();</Highlight></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><Highlight kind="normal">      HasNUW = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.hasNoUnsignedWrap();</Highlight></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LOBO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;OverflowingBinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>)) &#123;</Highlight></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><Highlight kind="normal">      HasNSW &amp;= LOBO-&gt;hasNoSignedWrap();</Highlight></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><Highlight kind="normal">      HasNUW &amp;= LOBO-&gt;hasNoUnsignedWrap();</Highlight></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ROBO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;OverflowingBinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)) &#123;</Highlight></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><Highlight kind="normal">      HasNSW &amp;= ROBO-&gt;hasNoSignedWrap();</Highlight></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><Highlight kind="normal">      HasNUW &amp;= ROBO-&gt;hasNoUnsignedWrap();</Highlight></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TopLevelOpcode == Instruction::Add &amp;&amp; InnerOpcode == Instruction::Mul) &#123;</Highlight></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We can propagate &#39;nsw&#39; if we know that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//  %Y = mul nsw i16 %X, C</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//  %Z = add nsw i16 %Y, %X</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// =&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//  %Z = mul nsw i16 %X, C+1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// iff C+1 isn&#39;t INT&#95;MIN</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;CInt;</Highlight></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(CInt)) &amp;&amp; !CInt-&gt;<a href="/docs/api/classes/llvm/apint/#a1f04e382556a817950fd0390aeaf9b0e">isMinSignedValue</a>())</Highlight></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(RetVal)-&gt;setHasNoSignedWrap(HasNSW);</Highlight></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// nuw can be propagated with any constant or nuw value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(RetVal)-&gt;setHasNoUnsignedWrap(HasNUW);</Highlight></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> RetVal;</Highlight></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><Highlight kind="normal"></Highlight><Highlight kind="comment">// If &#96;I&#96; has one Const operand and the other matches &#96;(ctpop (not x))&#96;,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><Highlight kind="normal"></Highlight><Highlight kind="comment">// replace &#96;(ctpop (not x))&#96; with &#96;(sub nuw nsw BitWidth(x), (ctpop x))&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This is only useful is the new subtract can fold so we only handle the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><Highlight kind="normal"></Highlight><Highlight kind="comment">// following cases:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    1) (add/sub/disjoint&#95;or C, (ctpop (not x))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        -&gt; (add/sub/disjoint&#95;or C&#39;, (ctpop x))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    1) (cmp pred C, (ctpop (not x))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        -&gt; (cmp pred C&#39;, (ctpop x))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779" lineLink="/docs/api/classes/llvm/instcombinerimpl/#aa4cf868b89270f2f699fdee46cb572a4"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#aa4cf868b89270f2f699fdee46cb572a4">InstCombinerImpl::tryFoldInstWithCtpopWithNot</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opc = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode();</Highlight></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ConstIdx = 1;</Highlight></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (Opc) &#123;</Highlight></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (ctpop (not x)) &lt;-&gt; (sub nuw nsw BitWidth(x) - (ctpop x))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We can fold the BitWidth(x) with add/sub/icmp as long the other operand</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Sub:</Highlight></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><Highlight kind="normal">    ConstIdx = 0;</Highlight></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ICmp:</Highlight></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Signed predicates aren&#39;t correct in some edge cases like for i2 types, as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// well since (ctpop x) is known &#91;0, log2(BitWidth(x))&#93; almost all signed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// comparisons against it are simplfied to unsigned.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a href="/docs/api/files/lib/lib/codegen/expandlargedivrem-cpp/#a49b2092a066cfbc24bc6925bdea9682a">isSigned</a>())</Highlight></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Or:</Highlight></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a2e802f68e832ba9873bd9baee927700c">m&#95;DisjointOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())))</Highlight></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><Highlight kind="normal">    &#91;&#91;fallthrough&#93;&#93;;</Highlight></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Add:</Highlight></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>;</Highlight></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find ctpop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1 - ConstIdx),</Highlight></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::ctpop&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)))))</Highlight></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check other operand is ImmConstant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(ConstIdx), <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)))</Highlight></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getType();</Highlight></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;BitWidthC = ConstantInt::get(Ty, Ty-&gt;getScalarSizeInBits());</Highlight></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Need extra check for icmp. Note if this check is true, it generally means</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the icmp will simplify to true/false.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Opc == Instruction::ICmp &amp;&amp; !<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;isEquality()) &#123;</Highlight></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Cmp =</Highlight></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a3cd3a3ec28036937ecebe767498ba55d">ConstantFoldCompareInstOperands</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">ICmpInst::ICMP&#95;UGT</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, BitWidthC, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>);</Highlight></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Cmp || !Cmp-&gt;isZeroValue())</Highlight></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check we can invert &#96;(not x)&#96; for free.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Consumes = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/instcombiner/#a1f819cdc746560fd28977b1175030cff">isFreeToInvert</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;hasOneUse(), Consumes) || !Consumes)</Highlight></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NotOp = <a href="/docs/api/classes/llvm/instcombiner/#af11b32adde24fea55878e66dd7139362">getFreelyInverted</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;hasOneUse(), &amp;<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>);</Highlight></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NotOp != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> &amp;&amp;</Highlight></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Desync between isFreeToInvert and getFreelyInverted&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CtpopOfNotOp = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateIntrinsic(Ty, Intrinsic::ctpop, NotOp);</Highlight></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;R = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do the transformation here to avoid potentially introducing an infinite</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (Opc) &#123;</Highlight></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Sub:</Highlight></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><Highlight kind="normal">    R = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAdd(CtpopOfNotOp, <a href="/docs/api/classes/llvm/constantexpr/#a554ab77949b0a16670a83ec3307501eb">ConstantExpr::getSub</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, BitWidthC));</Highlight></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Or:</Highlight></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Add:</Highlight></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><Highlight kind="normal">    R = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateSub(<a href="/docs/api/classes/llvm/constantexpr/#ae6f1c15034bc5515033874630a8ecce6">ConstantExpr::getAdd</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, BitWidthC), CtpopOfNotOp);</Highlight></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ICmp:</Highlight></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><Highlight kind="normal">    R = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateICmp(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getSwappedPredicate(),</Highlight></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><Highlight kind="normal">                           CtpopOfNotOp, <a href="/docs/api/classes/llvm/constantexpr/#a554ab77949b0a16670a83ec3307501eb">ConstantExpr::getSub</a>(BitWidthC, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>));</Highlight></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Unhandled Opcode&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(R != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, R);</Highlight></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><Highlight kind="normal"></Highlight><Highlight kind="comment">// (Binop1 (Binop2 (logic&#95;shift X, C), C1), (logic&#95;shift Y, C))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   IFF</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    1) the logic&#95;shifts match</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    2) either both binops are binops and one is &#96;and&#96; or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><Highlight kind="normal"></Highlight><Highlight kind="comment">//       BinOp1 is &#96;and&#96;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><Highlight kind="normal"></Highlight><Highlight kind="comment">//       (logic&#95;shift (inv&#95;logic&#95;shift C1, C), C) == C1 or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    -&gt; (logic&#95;shift (Binop1 (Binop2 X, inv&#95;logic&#95;shift(C1, C)), Y), C)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><Highlight kind="normal"></Highlight><Highlight kind="comment">// (Binop1 (Binop2 (logic&#95;shift X, Amt), Mask), (logic&#95;shift Y, Amt))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   IFF</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    1) the logic&#95;shifts match</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    2) BinOp1 == BinOp2 (if BinOp ==  &#96;add&#96;, then also requires &#96;shl&#96;).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    -&gt; (BinOp (logic&#95;shift (BinOp X, Y)), Mask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><Highlight kind="normal"></Highlight><Highlight kind="comment">// (Binop1 (Binop2 (arithmetic&#95;shift X, Amt), Mask), (arithmetic&#95;shift Y, Amt))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   IFF</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   1) Binop1 is bitwise logical operator &#96;and&#96;, &#96;or&#96; or &#96;xor&#96;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   2) Binop2 is &#96;not&#96;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   -&gt; (arithmetic&#95;shift Binop1((not X), Y), Amt)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a295de4cfe04f8cf0dee3bc16c78e5f13"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a295de4cfe04f8cf0dee3bc16c78e5f13">InstCombinerImpl::foldBinOpShiftWithShift</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDataLayout();</Highlight></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsValidBinOpc = &#91;&#93;(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opc) &#123;</Highlight></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (Opc) &#123;</Highlight></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::And:</Highlight></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Or:</Highlight></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Xor:</Highlight></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Add:</Highlight></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Skip Sub as we only match constant masks which will canonicalize to use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// add.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if we can distribute binop arbitrarily. &#96;add&#96; + &#96;lshr&#96; has extra</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// constraints.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsCompletelyDistributable = &#91;&#93;(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BinOpc1, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BinOpc2,</Highlight></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><Highlight kind="normal">                                      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ShOpc) &#123;</Highlight></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ShOpc != Instruction::AShr);</Highlight></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> (BinOpc1 != Instruction::Add &amp;&amp; BinOpc2 != Instruction::Add) ||</Highlight></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><Highlight kind="normal">           ShOpc == Instruction::Shl;</Highlight></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetInvShift = &#91;&#93;(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ShOpc) &#123;</Highlight></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ShOpc != Instruction::AShr);</Highlight></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ShOpc == Instruction::LShr ? Instruction::Shl : Instruction::LShr;</Highlight></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CanDistributeBinops = &#91;&amp;&#93;(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BinOpc1, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BinOpc2,</Highlight></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><Highlight kind="normal">                                 </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ShOpc, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CMask,</Highlight></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><Highlight kind="normal">                                 <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CShift) &#123;</Highlight></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the BinOp1 is &#96;and&#96; we don&#39;t need to check the mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BinOpc1 == Instruction::And)</Highlight></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For all other possible transfers we need complete distributable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// binop/shift (anything but &#96;add&#96; + &#96;lshr&#96;).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsCompletelyDistributable(BinOpc1, BinOpc2, ShOpc))</Highlight></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If BinOp2 is &#96;and&#96;, any mask works (this only really helps for non-splat</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// vecs, otherwise the mask will be simplified and the following check will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// handle it).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BinOpc2 == Instruction::And)</Highlight></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise, need mask that meets the below requirement.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (logic&#95;shift (inv&#95;logic&#95;shift Mask, ShAmt), ShAmt) == Mask</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;MaskInvShift =</Highlight></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a964455f36837281d37f2a44e2fcb4cca">ConstantFoldBinaryOpOperands</a>(GetInvShift(ShOpc), CMask, CShift, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>);</Highlight></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a964455f36837281d37f2a44e2fcb4cca">ConstantFoldBinaryOpOperands</a>(ShOpc, MaskInvShift, CShift, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>) ==</Highlight></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><Highlight kind="normal">           CMask;</Highlight></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MatchBinOp = &#91;&amp;&#93;(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ShOpnum) -&gt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CMask, &#42;CShift;</Highlight></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, &#42;ShiftedX, &#42;Mask, &#42;Shift;</Highlight></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(ShOpnum),</Highlight></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aba80fdc6570c5a40cecd27fd7a06c858">m&#95;Shift</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Shift)))))</Highlight></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1 - ShOpnum),</Highlight></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/patternmatch/#ab3021d22d00a294cb59bd5067bc5c4b2">m&#95;c&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a469c3ed35e782000933c996ccd2d2333">m&#95;CombineAnd</a>(</Highlight></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><Highlight kind="normal">                             <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aba80fdc6570c5a40cecd27fd7a06c858">m&#95;Shift</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(Shift))),</Highlight></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><Highlight kind="normal">                             <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(ShiftedX)),</Highlight></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><Highlight kind="normal">                         <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Mask))))</Highlight></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make sure we are matching instruction shifts and not ConstantExpr</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IY = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(ShOpnum));</Highlight></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(ShiftedX);</Highlight></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IY || !IX)</Highlight></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// LHS and RHS need same shift opcode</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ShOpc = IY-&gt;getOpcode();</Highlight></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ShOpc != IX-&gt;getOpcode())</Highlight></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make sure binop is real instruction and not ConstantExpr</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BO2 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1 - ShOpnum));</Highlight></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BO2)</Highlight></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BinOpc = BO2-&gt;getOpcode();</Highlight></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make sure we have valid binops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsValidBinOpc(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode()) || !IsValidBinOpc(BinOpc))</Highlight></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ShOpc == Instruction::AShr) &#123;</Highlight></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction/#a2d0036d2d7b30f510927731ba7a4f4b9">Instruction::isBitwiseLogicOp</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode()) &amp;&amp;</Highlight></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><Highlight kind="normal">          BinOpc == Instruction::Xor &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Mask, <a href="/docs/api/namespaces/llvm/patternmatch/#a00ef056813d120034e387417e9cde341">m&#95;AllOnes</a>())) &#123;</Highlight></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;NotX = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateNot(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</Highlight></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBinOp = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, NotX);</Highlight></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(</Highlight></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a></Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(ShOpc), NewBinOp, Shift);</Highlight></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If BinOp1 == BinOp2 and it&#39;s bitwise or shl with add, then just</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// distribute to drop the shift irrelevant of constants.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BinOpc == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode() &amp;&amp;</Highlight></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><Highlight kind="normal">        IsCompletelyDistributable(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode(), BinOpc, ShOpc)) &#123;</Highlight></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBinOp2 = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBinOp1 = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(</Highlight></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a></Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(ShOpc), NewBinOp2, Shift);</Highlight></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode(), NewBinOp1, Mask);</Highlight></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise we can only distribute by constant shifting the mask, so</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// ensure we have constants.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Shift, <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(CShift)))</Highlight></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Mask, <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(CMask)))</Highlight></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if we can distribute the binops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CanDistributeBinops(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode(), BinOpc, ShOpc, CMask, CShift))</Highlight></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewCMask =</Highlight></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a964455f36837281d37f2a44e2fcb4cca">ConstantFoldBinaryOpOperands</a>(GetInvShift(ShOpc), CMask, CShift, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>);</Highlight></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBinOp2 = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(</Highlight></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a></Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(BinOpc), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, NewCMask);</Highlight></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBinOp1 = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, NewBinOp2);</Highlight></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(</Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a></Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(ShOpc),</Highlight></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><Highlight kind="normal">                                  NewBinOp1, CShift);</Highlight></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;R = MatchBinOp(0))</Highlight></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> R;</Highlight></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MatchBinOp(1);</Highlight></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><Highlight kind="normal"></Highlight><Highlight kind="comment">// (Binop (zext C), (select C, T, F))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    -&gt; (select C, (binop 1, T), (binop 0, F))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><Highlight kind="normal"></Highlight><Highlight kind="comment">// (Binop (sext C), (select C, T, F))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    -&gt; (select C, (binop -1, T), (binop 0, F))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Attempt to simplify binary operations into a select with folded args, when</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><Highlight kind="normal"></Highlight><Highlight kind="comment">// one operand of the binop is a select instruction and the other operand is a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><Highlight kind="normal"></Highlight><Highlight kind="comment">// zext/sext extension, whose value is the select condition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</Highlight></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a069cade7de51978d60286551f6ff71e1"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instcombinerimpl/#a069cade7de51978d60286551f6ff71e1">InstCombinerImpl::foldBinOpOfSelectAndCastOfSelectCondition</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: this simplification may be extended to any speculatable instruction,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// not just binops, and would possibly be handled better in FoldOpIntoSelect.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opc = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode();</Highlight></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0), &#42;RHS = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1);</Highlight></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &#42;CondVal, &#42;TrueVal, &#42;FalseVal;</Highlight></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastOp;</Highlight></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MatchSelectAndCast = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;CastOp, <a href="/docs/api/classes/llvm/value">Value</a> &#42;SelectOp) &#123;</Highlight></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(CastOp, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>))) &amp;&amp;</Highlight></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><Highlight kind="normal">           <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType()-&gt;getScalarSizeInBits() == 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(SelectOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(CondVal), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(TrueVal),</Highlight></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><Highlight kind="normal">                                    <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(FalseVal)));</Highlight></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make sure one side of the binop is a select instruction, and the other is a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// zero/sign extension operating on a i1.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MatchSelectAndCast(LHS, RHS))</Highlight></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><Highlight kind="normal">    CastOp = LHS;</Highlight></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MatchSelectAndCast(RHS, LHS))</Highlight></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><Highlight kind="normal">    CastOp = RHS;</Highlight></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewFoldedConst = &#91;&amp;&#93;(</Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsTrueArm, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsCastOpRHS = (CastOp == RHS);</Highlight></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsZExt = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(CastOp);</Highlight></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsTrueArm) &#123;</Highlight></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(V-&gt;getType());</Highlight></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsZExt) &#123;</Highlight></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = V-&gt;getType()-&gt;getScalarSizeInBits();</Highlight></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/constant/#a0154da1d06b29a1d5649607ae2dfc389">Constant::getIntegerValue</a>(V-&gt;getType(), <a href="/docs/api/classes/llvm/apint">APInt</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, 1));</Highlight></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(V-&gt;getType());</Highlight></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> IsCastOpRHS ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(Opc, V, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)</Highlight></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><Highlight kind="normal">                       : <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(Opc, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, V);</Highlight></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the value used in the zext/sext is the select condition, or the negated</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the select condition, the binop can be simplified.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CondVal == <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) &#123;</Highlight></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewTrueVal = NewFoldedConst(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, TrueVal);</Highlight></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(CondVal, NewTrueVal,</Highlight></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><Highlight kind="normal">                              NewFoldedConst(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, FalseVal));</Highlight></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(CondVal)))) &#123;</Highlight></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewTrueVal = NewFoldedConst(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, TrueVal);</Highlight></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(CondVal, NewTrueVal,</Highlight></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><Highlight kind="normal">                              NewFoldedConst(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, FalseVal));</Highlight></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089" lineLink="/docs/api/classes/llvm/instcombinerimpl/#aebf722c3ce9439ef88175255d8669080"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#aebf722c3ce9439ef88175255d8669080">InstCombinerImpl::tryFactorizationFolds</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0), &#42;RHS = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1);</Highlight></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Op0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(LHS);</Highlight></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Op1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(RHS);</Highlight></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> TopLevelOpcode = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode();</Highlight></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>;</Highlight></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> LHSOpcode, RHSOpcode;</Highlight></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op0)</Highlight></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><Highlight kind="normal">    LHSOpcode = <a href="#ac7754c95309ff1784b1e47b0001deeee">getBinOpsForFactorization</a>(TopLevelOpcode, Op0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, Op1);</Highlight></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op1)</Highlight></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><Highlight kind="normal">    RHSOpcode = <a href="#ac7754c95309ff1784b1e47b0001deeee">getBinOpsForFactorization</a>(TopLevelOpcode, Op1, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, Op0);</Highlight></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The instruction has the form &quot;(A op&#39; B) op (C op&#39; D)&quot;.  Try to factorize</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a common term.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op0 &amp;&amp; Op1 &amp;&amp; LHSOpcode == RHSOpcode)</Highlight></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="#ab952034edc23ad21ab312e0baaea0d7e">tryFactorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>, LHSOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>))</Highlight></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> V;</Highlight></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The instruction has the form &quot;(A op&#39; B) op (C)&quot;.  Try to factorize common</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// term.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op0)</Highlight></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident = <a href="#a5e80024df498e16b544d9c0d3f2d9eb4">getIdentityValue</a>(LHSOpcode, RHS))</Highlight></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V =</Highlight></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><Highlight kind="normal">              <a href="#ab952034edc23ad21ab312e0baaea0d7e">tryFactorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>, LHSOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, RHS, Ident))</Highlight></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> V;</Highlight></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The instruction has the form &quot;(B) op (C op&#39; D)&quot;.  Try to factorize common</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// term.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op1)</Highlight></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident = <a href="#a5e80024df498e16b544d9c0d3f2d9eb4">getIdentityValue</a>(RHSOpcode, LHS))</Highlight></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V =</Highlight></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><Highlight kind="normal">              <a href="#ab952034edc23ad21ab312e0baaea0d7e">tryFactorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>, RHSOpcode, LHS, Ident, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>))</Highlight></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> V;</Highlight></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><Highlight kind="comment">/// This tries to simplify binary operations which some other binary operation</Highlight></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><Highlight kind="comment">/// distributes over either by factorizing out common terms</Highlight></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><Highlight kind="comment">/// (eg &quot;(A&#42;B)+(A&#42;C)&quot; -&gt; &quot;A&#42;(B+C)&quot;) or expanding out if this results in</Highlight></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><Highlight kind="comment">/// simplifications (eg: &quot;A &amp; (B | C) -&gt; (A&amp;B) | (A&amp;C)&quot; if this is a win).</Highlight></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><Highlight kind="comment">/// Returns the simplified value, or null if it didn&#39;t simplify.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a2511e442d198696042ad2a39cad89059"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a2511e442d198696042ad2a39cad89059">InstCombinerImpl::foldUsingDistributiveLaws</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0), &#42;RHS = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1);</Highlight></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Op0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(LHS);</Highlight></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Op1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(RHS);</Highlight></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> TopLevelOpcode = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode();</Highlight></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Factorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;R = <a href="/docs/api/classes/llvm/instcombinerimpl/#aebf722c3ce9439ef88175255d8669080">tryFactorizationFolds</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> R;</Highlight></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Expansion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op0 &amp;&amp; <a href="#a9f7798eb98807e7ce804788b339a6978">rightDistributesOverLeft</a>(Op0-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), TopLevelOpcode)) &#123;</Highlight></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The instruction has the form &quot;(A op&#39; B) op C&quot;.  See if expanding it out</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to &quot;(A op C) op&#39; (B op C)&quot; results in simplifications.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = Op0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = Op0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = RHS;</Highlight></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> InnerOpcode = Op0-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(); </Highlight><Highlight kind="comment">// op&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Disable the use of undef because it&#39;s not safe to distribute undef.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SQDistributive = <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).getWithoutUndef();</Highlight></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;L = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(TopLevelOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, SQDistributive);</Highlight></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;R = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(TopLevelOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, SQDistributive);</Highlight></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Do &quot;A op C&quot; and &quot;B op C&quot; both simplify?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (L &amp;&amp; R) &#123;</Highlight></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// They do! Return &quot;L op&#39; R&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><Highlight kind="normal">      ++NumExpand;</Highlight></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(InnerOpcode, L, R);</Highlight></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;takeName(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Does &quot;A op C&quot; simplify to the identity value for the inner opcode?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (L &amp;&amp; L == <a href="/docs/api/classes/llvm/constantexpr/#ae9c2f00a962cb8e0316cf3548a5d8029">ConstantExpr::getBinOpIdentity</a>(InnerOpcode, L-&gt;getType())) &#123;</Highlight></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// They do! Return &quot;B op C&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><Highlight kind="normal">      ++NumExpand;</Highlight></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(TopLevelOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;takeName(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Does &quot;B op C&quot; simplify to the identity value for the inner opcode?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (R &amp;&amp; R == <a href="/docs/api/classes/llvm/constantexpr/#ae9c2f00a962cb8e0316cf3548a5d8029">ConstantExpr::getBinOpIdentity</a>(InnerOpcode, R-&gt;getType())) &#123;</Highlight></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// They do! Return &quot;A op C&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><Highlight kind="normal">      ++NumExpand;</Highlight></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(TopLevelOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;takeName(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op1 &amp;&amp; <a href="/docs/api/files/lib/lib/transforms/lib/transforms/instcombine/instcombinecalls-cpp/#ae063b0dfc81b595a88500b6e54e2d14a">leftDistributesOverRight</a>(TopLevelOpcode, Op1-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>())) &#123;</Highlight></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The instruction has the form &quot;A op (B op&#39; C)&quot;.  See if expanding it out</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to &quot;(A op B) op&#39; (A op C)&quot; results in simplifications.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = LHS, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = Op1-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = Op1-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> InnerOpcode = Op1-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(); </Highlight><Highlight kind="comment">// op&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Disable the use of undef because it&#39;s not safe to distribute undef.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SQDistributive = <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).getWithoutUndef();</Highlight></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;L = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(TopLevelOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, SQDistributive);</Highlight></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;R = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(TopLevelOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, SQDistributive);</Highlight></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Do &quot;A op B&quot; and &quot;A op C&quot; both simplify?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (L &amp;&amp; R) &#123;</Highlight></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// They do! Return &quot;L op&#39; R&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><Highlight kind="normal">      ++NumExpand;</Highlight></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(InnerOpcode, L, R);</Highlight></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;takeName(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>;</Highlight></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Does &quot;A op B&quot; simplify to the identity value for the inner opcode?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (L &amp;&amp; L == <a href="/docs/api/classes/llvm/constantexpr/#ae9c2f00a962cb8e0316cf3548a5d8029">ConstantExpr::getBinOpIdentity</a>(InnerOpcode, L-&gt;getType())) &#123;</Highlight></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// They do! Return &quot;A op C&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><Highlight kind="normal">      ++NumExpand;</Highlight></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(TopLevelOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;takeName(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>;</Highlight></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Does &quot;A op C&quot; simplify to the identity value for the inner opcode?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (R &amp;&amp; R == <a href="/docs/api/classes/llvm/constantexpr/#ae9c2f00a962cb8e0316cf3548a5d8029">ConstantExpr::getBinOpIdentity</a>(InnerOpcode, R-&gt;getType())) &#123;</Highlight></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// They do! Return &quot;A op B&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><Highlight kind="normal">      ++NumExpand;</Highlight></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(TopLevelOpcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;takeName(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>;</Highlight></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#ad36c0bc30660bad4f2b79be90608ea60">SimplifySelectsFeedingBinaryOp</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LHS, RHS);</Highlight></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::optional&lt;std::pair&lt;Value &#42;, Value &#42;&gt;&gt;</Highlight></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225" lineLink="#a6b7f636d0a933a4771be0a45870c4db8"><Highlight kind="normal"><a href="#a6b7f636d0a933a4771be0a45870c4db8">matchSymmetricPhiNodesPair</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getParent() != <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getParent())</Highlight></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getNumIncomingValues() &lt; 2)</Highlight></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#ae04157f1cd3b64e93ebd44f8f65e395c">equal</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;blocks(), <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;blocks()))</Highlight></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;L0 = <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getIncomingValue(0);</Highlight></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;R0 = <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getIncomingValue(0);</Highlight></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 1, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getNumIncomingValues(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;L1 = <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;R1 = <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((L0 == L1 &amp;&amp; R0 == R1) || (L0 == R1 &amp;&amp; R0 == L1))</Highlight></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::optional(std::pair(L0, R0));</Highlight></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><Highlight kind="normal">std::optional&lt;std::pair&lt;Value &#42;, Value &#42;&gt;&gt;</Highlight></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><Highlight kind="normal">InstCombinerImpl::matchSymmetricPair(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;LHSInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>);</Highlight></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;RHSInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</Highlight></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LHSInst || !RHSInst || LHSInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() != RHSInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>())</Highlight></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (LHSInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>()) &#123;</Highlight></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::PHI:</Highlight></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a6b7f636d0a933a4771be0a45870c4db8">matchSymmetricPhiNodesPair</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>));</Highlight></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Select: &#123;</Highlight></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = LHSInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a58b95af1ca96e109f85a0646a05fceb7">TrueVal</a> = LHSInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5aeb5a2908109c763377832cbb4726b6d4">FalseVal</a> = LHSInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2);</Highlight></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> == RHSInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) &amp;&amp; TrueVal == RHSInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(2) &amp;&amp;</Highlight></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><Highlight kind="normal">        FalseVal == RHSInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))</Highlight></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::pair(TrueVal, FalseVal);</Highlight></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Call: &#123;</Highlight></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Match min(a, b) and max(a, b)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><Highlight kind="normal">    MinMaxIntrinsic &#42;LHSMinMax = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MinMaxIntrinsic&gt;</a>(LHSInst);</Highlight></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><Highlight kind="normal">    MinMaxIntrinsic &#42;RHSMinMax = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MinMaxIntrinsic&gt;</a>(RHSInst);</Highlight></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LHSMinMax &amp;&amp; RHSMinMax &amp;&amp;</Highlight></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><Highlight kind="normal">        LHSMinMax-&gt;<a href="/docs/api/classes/llvm/minmaxintrinsic/#a988ae1c84a3ad7f92b7f94ac90ba9b79">getPredicate</a>() ==</Highlight></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/cmpinst/#a49a2d8f483ea08a3d6ea75f90c640d76">ICmpInst::getSwappedPredicate</a>(RHSMinMax-&gt;<a href="/docs/api/classes/llvm/minmaxintrinsic/#a988ae1c84a3ad7f92b7f94ac90ba9b79">getPredicate</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><Highlight kind="normal">        ((LHSMinMax-&gt;<a href="/docs/api/classes/llvm/minmaxintrinsic/#a673a466c3e8606df34705f6953698a10">getLHS</a>() == RHSMinMax-&gt;<a href="/docs/api/classes/llvm/minmaxintrinsic/#a673a466c3e8606df34705f6953698a10">getLHS</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><Highlight kind="normal">          LHSMinMax-&gt;<a href="/docs/api/classes/llvm/minmaxintrinsic/#a82ded87f3e0e5e0a0827c7494b097d1d">getRHS</a>() == RHSMinMax-&gt;<a href="/docs/api/classes/llvm/minmaxintrinsic/#a82ded87f3e0e5e0a0827c7494b097d1d">getRHS</a>()) ||</Highlight></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><Highlight kind="normal">         (LHSMinMax-&gt;<a href="/docs/api/classes/llvm/minmaxintrinsic/#a673a466c3e8606df34705f6953698a10">getLHS</a>() == RHSMinMax-&gt;<a href="/docs/api/classes/llvm/minmaxintrinsic/#a82ded87f3e0e5e0a0827c7494b097d1d">getRHS</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><Highlight kind="normal">          LHSMinMax-&gt;<a href="/docs/api/classes/llvm/minmaxintrinsic/#a82ded87f3e0e5e0a0827c7494b097d1d">getRHS</a>() == RHSMinMax-&gt;<a href="/docs/api/classes/llvm/minmaxintrinsic/#a673a466c3e8606df34705f6953698a10">getLHS</a>())))</Highlight></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::pair(LHSMinMax-&gt;<a href="/docs/api/classes/llvm/minmaxintrinsic/#a673a466c3e8606df34705f6953698a10">getLHS</a>(), LHSMinMax-&gt;<a href="/docs/api/classes/llvm/minmaxintrinsic/#a82ded87f3e0e5e0a0827c7494b097d1d">getRHS</a>());</Highlight></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288" lineLink="/docs/api/classes/llvm/instcombinerimpl/#ad36c0bc30660bad4f2b79be90608ea60"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#ad36c0bc30660bad4f2b79be90608ea60">InstCombinerImpl::SimplifySelectsFeedingBinaryOp</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><Highlight kind="normal">                                                        <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS,</Highlight></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><Highlight kind="normal">                                                        <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHS) &#123;</Highlight></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, &#42;E, &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>;</Highlight></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LHSIsSelect = <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)));</Highlight></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> RHSIsSelect = <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(E), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)));</Highlight></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LHSIsSelect &amp;&amp; !RHSIsSelect)</Highlight></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/fastmathflags">FastMathFlags</a> FMF;</Highlight></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilderbase/fastmathflagguard">BuilderTy::FastMathFlagGuard</a> Guard(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>);</Highlight></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FPMathOperator&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><Highlight kind="normal">    FMF = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getFastMathFlags();</Highlight></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.setFastMathFlags(FMF);</Highlight></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opcode = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode();</Highlight></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> Q = <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, &#42;True = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, &#42;False = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Special-case for add/negate combination. Replace the zero in the negation</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with the trailing add operand:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (Cond ? TVal : -N) + Z --&gt; Cond ? True : (Z - N)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (Cond ? -N : FVal) + Z --&gt; Cond ? (Z - N) : False</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> foldAddNegate = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;TVal, <a href="/docs/api/classes/llvm/value">Value</a> &#42;FVal, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Z) -&gt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We need an &#39;add&#39; and exactly 1 arm of the select to have been simplified.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Opcode != Instruction::Add || (!True &amp;&amp; !False) || (True &amp;&amp; False))</Highlight></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>;</Highlight></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (True &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(FVal, <a href="/docs/api/namespaces/llvm/patternmatch/#a5d295dcffba83c3c5a17d2fb3273b434">m&#95;Neg</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>)))) &#123;</Highlight></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Sub = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateSub(Z, <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>);</Highlight></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateSelect(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, True, Sub, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getName());</Highlight></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (False &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(TVal, <a href="/docs/api/namespaces/llvm/patternmatch/#a5d295dcffba83c3c5a17d2fb3273b434">m&#95;Neg</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>)))) &#123;</Highlight></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Sub = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateSub(Z, <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>);</Highlight></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateSelect(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, Sub, False, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getName());</Highlight></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LHSIsSelect &amp;&amp; RHSIsSelect &amp;&amp; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> == <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>) &#123;</Highlight></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (A ? B : C) op (A ? E : F) -&gt; A ? (B op E) : (C op F)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>;</Highlight></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><Highlight kind="normal">    True = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(Opcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, E, FMF, Q);</Highlight></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><Highlight kind="normal">    False = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(Opcode, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, FMF, Q);</Highlight></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LHS-&gt;hasOneUse() &amp;&amp; RHS-&gt;hasOneUse()) &#123;</Highlight></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (False &amp;&amp; !True)</Highlight></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><Highlight kind="normal">        True = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(Opcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, E);</Highlight></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (True &amp;&amp; !False)</Highlight></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><Highlight kind="normal">        False = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(Opcode, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LHSIsSelect &amp;&amp; LHS-&gt;hasOneUse()) &#123;</Highlight></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (A ? B : C) op Y -&gt; A ? (B op Y) : (C op Y)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>;</Highlight></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><Highlight kind="normal">    True = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(Opcode, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, RHS, FMF, Q);</Highlight></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><Highlight kind="normal">    False = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(Opcode, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, RHS, FMF, Q);</Highlight></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;NewSel = foldAddNegate(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, RHS))</Highlight></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewSel;</Highlight></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RHSIsSelect &amp;&amp; RHS-&gt;hasOneUse()) &#123;</Highlight></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// X op (D ? E : F) -&gt; D ? (X op E) : (X op F)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>;</Highlight></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><Highlight kind="normal">    True = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(Opcode, LHS, E, FMF, Q);</Highlight></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><Highlight kind="normal">    False = <a href="/docs/api/namespaces/llvm/#aa750395459fa1eb7130d6de8e3d074f6">simplifyBinOp</a>(Opcode, LHS, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, FMF, Q);</Highlight></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;NewSel = foldAddNegate(E, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, LHS))</Highlight></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewSel;</Highlight></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!True || !False)</Highlight></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateSelect(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, True, False);</Highlight></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;takeName(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/si">SI</a>;</Highlight></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><Highlight kind="comment">/// Freely adapt every user of V as-if V was changed to !V.</Highlight></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><Highlight kind="comment">/// WARNING: only if canFreelyInvertAllUsersOf() said this can be done.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368" lineLink="/docs/api/classes/llvm/instcombinerimpl/#af8c1d39848b445bea8e307b53f81c481"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#af8c1d39848b445bea8e307b53f81c481">InstCombinerImpl::freelyInvertAllUsersOf</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;IgnoredUser) &#123;</Highlight></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Shouldn&#39;t invert users of constant&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users())) &#123;</Highlight></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (U == IgnoredUser)</Highlight></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Don&#39;t consider this user.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanslp-cpp/#a06b4f19004df11b338ccc7e73bf47ab4">getOpcode</a>()) &#123;</Highlight></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Select: &#123;</Highlight></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;swapValues();</Highlight></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;swapProfMetadata();</Highlight></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Br: &#123;</Highlight></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><Highlight kind="normal">      BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a6550fe5bd437c1c3c6e237d726e36b90">swapSuccessors</a>(); </Highlight><Highlight kind="comment">// swaps prof metadata too</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#a7f74e84c9b2bc2441706161c2ed9cc5a">BPI</a>)</Highlight></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a7f74e84c9b2bc2441706161c2ed9cc5a">BPI</a>-&gt;swapSuccEdgesProbabilities(BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Xor:</Highlight></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;U), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Add to worklist for DCE.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#ab86d58ae73173328360a32cbbb0d5b14">addToWorklist</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U));</Highlight></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Got unexpected user - out of sync with &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><Highlight kind="normal">                       </Highlight><Highlight kind="stringliteral">&quot;canFreelyInvertAllUsersOf() ?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><Highlight kind="comment">/// Given a &#39;sub&#39; instruction, return the RHS of the instruction if the LHS is a</Highlight></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><Highlight kind="comment">/// constant zero (which is the &#39;negate&#39; form).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;InstCombinerImpl::dyn&#95;castNegVal(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NegV;</Highlight></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a5d295dcffba83c3c5a17d2fb3273b434">m&#95;Neg</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(NegV))))</Highlight></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NegV;</Highlight></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Constants can be considered to be negated values if they can be folded.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(V))</Highlight></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantexpr/#aefdfcd6977f799b0f35e93d75114121c">ConstantExpr::getNeg</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constantdatavector">ConstantDataVector</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantDataVector&gt;</a>(V))</Highlight></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getType()-&gt;getElementType()-&gt;isIntegerTy())</Highlight></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantexpr/#aefdfcd6977f799b0f35e93d75114121c">ConstantExpr::getNeg</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constantvector">ConstantVector</a> &#42;CV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantVector&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = CV-&gt;getNumOperands(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Elt = CV-&gt;<a href="/docs/api/classes/llvm/constant/#acd530d0571f320d47d37e7ae51cf70ff">getAggregateElement</a>(i);</Highlight></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Elt)</Highlight></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Elt))</Highlight></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Elt))</Highlight></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantexpr/#aefdfcd6977f799b0f35e93d75114121c">ConstantExpr::getNeg</a>(CV);</Highlight></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Negate integer vector splats.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V))</Highlight></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CV-&gt;getType()-&gt;isVectorTy() &amp;&amp;</Highlight></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><Highlight kind="normal">        CV-&gt;getType()-&gt;getScalarType()-&gt;isIntegerTy() &amp;&amp; CV-&gt;getSplatValue())</Highlight></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantexpr/#aefdfcd6977f799b0f35e93d75114121c">ConstantExpr::getNeg</a>(CV);</Highlight></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Try to fold:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    1) (fp&#95;binop (&#123;s|u&#125;itofp x), (&#123;s|u&#125;itofp y))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        -&gt; (&#123;s|u&#125;itofp (int&#95;binop x, y))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    2) (fp&#95;binop (&#123;s|u&#125;itofp x), FpC)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        -&gt; (&#123;s|u&#125;itofp (int&#95;binop x, (fpto&#123;s|u&#125;i FpC)))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Assuming the sign of the cast for x/y is &#96;OpsFromSigned&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InstCombinerImpl::foldFBinOpOfIntCastsFromSign(</Highlight></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;BO, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> OpsFromSigned, std::array&lt;Value &#42;, 2&gt; IntOps,</Highlight></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Op1FpC, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;<a href="/docs/api/classes/llvm/withcache">WithCache&lt;const Value &#42;&gt;</a>&gt; &amp;OpsKnown) &#123;</Highlight></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;FPTy = BO.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IntTy = IntOps&#91;0&#93;-&gt;getType();</Highlight></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IntSz = IntTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</Highlight></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is the maximum number of inuse bits by the integer where the int -&gt; fp</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// casts are exact.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxRepresentableBits =</Highlight></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/apfloatbase/#a6530cd829b7e8d4df2c29d950039961e">APFloat::semanticsPrecision</a>(FPTy-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#adc21598ac33ea9d50f3a939f26a28940">getFltSemantics</a>());</Highlight></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Preserve known number of leading bits. This can allow us to trivial nsw/nuw</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// checks later on.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumUsedLeadingBits&#91;2&#93; = &#123;IntSz, IntSz&#125;;</Highlight></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// NB: This only comes up if OpsFromSigned is true, so there is no need to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cache if between calls to &#96;foldFBinOpOfIntCastsFromSign&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsNonZero = &#91;&amp;&#93;(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OpNo) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OpsKnown&#91;OpNo&#93;.hasKnownBits() &amp;&amp;</Highlight></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><Highlight kind="normal">        OpsKnown&#91;OpNo&#93;.getKnownBits(<a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>).isNonZero())</Highlight></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a9893e3e4b14f8fa15d7c3c25a6a0b6f6">isKnownNonZero</a>(IntOps&#91;OpNo&#93;, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>);</Highlight></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsNonNeg = &#91;&amp;&#93;(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OpNo) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// NB: This matches the impl in ValueTracking, we just try to use cached</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// knownbits here. If we ever start supporting WithCache for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#96;isKnownNonNegative&#96;, change this to an explicit call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OpsKnown&#91;OpNo&#93;.getKnownBits(<a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>).isNonNegative();</Highlight></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if we know for certain that (&#123;s|u&#125;itofp op) is exact.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsValidPromotion = &#91;&amp;&#93;(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OpNo) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Can we treat this operand as the desired sign?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OpsFromSigned != <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SIToFPInst&gt;</a>(BO.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(OpNo)) &amp;&amp;</Highlight></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><Highlight kind="normal">        !IsNonNeg(OpNo))</Highlight></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If fp precision &gt;= bitwidth(op) then its exact.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// NB: This is slightly conservative for &#96;sitofp&#96;. For signed conversion, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// can handle &#96;MaxRepresentableBits == IntSz - 1&#96; as the sign bit will be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// handled specially. We can&#39;t, however, increase the bound arbitrarily for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#96;sitofp&#96; as for larger sizes, it won&#39;t sign extend.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaxRepresentableBits &lt; IntSz) &#123;</Highlight></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Otherwise if its signed cast check that fp precisions &gt;= bitwidth(op) -</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// numSignBits(op).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: If we add support for &#96;WithCache&#96; in &#96;ComputeNumSignBits&#96;, change</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// &#96;IntOps&#91;OpNo&#93;&#96; arguments to &#96;KnownOps&#91;OpNo&#93;&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OpsFromSigned)</Highlight></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><Highlight kind="normal">        NumUsedLeadingBits&#91;OpNo&#93; = IntSz - <a href="/docs/api/classes/llvm/instcombiner/#a879221accd38e1327b8dcf596650b031">ComputeNumSignBits</a>(IntOps&#91;OpNo&#93;);</Highlight></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Finally for unsigned check that fp precision &gt;= bitwidth(op) -</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// numLeadingZeros(op).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><Highlight kind="normal">        NumUsedLeadingBits&#91;OpNo&#93; =</Highlight></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><Highlight kind="normal">            IntSz - OpsKnown&#91;OpNo&#93;.getKnownBits(<a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>).countMinLeadingZeros();</Highlight></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// NB: We could also check if op is known to be a power of 2 or zero (which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// will always be representable). Its unlikely, however, that is we are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// unable to bound op in any way we will be able to pass the overflow checks</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// later on.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaxRepresentableBits &lt; NumUsedLeadingBits&#91;OpNo&#93;)</Highlight></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Signed + Mul also requires that op is non-zero to avoid -0 cases.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !OpsFromSigned || BO.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() != Instruction::FMul ||</Highlight></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><Highlight kind="normal">           IsNonZero(OpNo);</Highlight></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have a constant rhs, see if we can losslessly convert it to an int.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op1FpC != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Signed + Mul req non-zero</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OpsFromSigned &amp;&amp; BO.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::FMul &amp;&amp;</Highlight></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op1FpC, <a href="/docs/api/namespaces/llvm/patternmatch/#ac4b40d385459f2afb3d3c51dbc58b4c4">m&#95;NonZeroFP</a>()))</Highlight></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;Op1IntC = <a href="/docs/api/namespaces/llvm/#a8bf77c90e2fb57af4d4d4aab084f7052">ConstantFoldCastOperand</a>(</Highlight></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><Highlight kind="normal">        OpsFromSigned ? Instruction::FPToSI : Instruction::FPToUI, Op1FpC,</Highlight></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><Highlight kind="normal">        IntTy, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>);</Highlight></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op1IntC == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a8bf77c90e2fb57af4d4d4aab084f7052">ConstantFoldCastOperand</a>(OpsFromSigned ? Instruction::SIToFP</Highlight></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><Highlight kind="normal">                                              : Instruction::UIToFP,</Highlight></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><Highlight kind="normal">                                Op1IntC, FPTy, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>) != Op1FpC)</Highlight></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// First try to keep sign of cast the same.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><Highlight kind="normal">    IntOps&#91;1&#93; = Op1IntC;</Highlight></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Ensure lhs/rhs integer types match.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntTy != IntOps&#91;1&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>())</Highlight></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op1FpC == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsValidPromotion(1))</Highlight></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsValidPromotion(0))</Highlight></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Final we check if the integer version of the binop will not overflow.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> IntOpc;</Highlight></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Because of the precision check, we can often rule out overflows.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> NeedsOverflowCheck = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to conservatively rule out overflow based on the already done precision</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// checks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OverflowMaxOutputBits = OpsFromSigned ? 2 : 1;</Highlight></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OverflowMaxCurBits =</Highlight></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><Highlight kind="normal">      std::max(NumUsedLeadingBits&#91;0&#93;, NumUsedLeadingBits&#91;1&#93;);</Highlight></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> OutputSigned = OpsFromSigned;</Highlight></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (BO.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>()) &#123;</Highlight></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FAdd:</Highlight></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><Highlight kind="normal">    IntOpc = Instruction::Add;</Highlight></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><Highlight kind="normal">    OverflowMaxOutputBits += OverflowMaxCurBits;</Highlight></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FSub:</Highlight></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><Highlight kind="normal">    IntOpc = Instruction::Sub;</Highlight></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><Highlight kind="normal">    OverflowMaxOutputBits += OverflowMaxCurBits;</Highlight></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FMul:</Highlight></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><Highlight kind="normal">    IntOpc = Instruction::Mul;</Highlight></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><Highlight kind="normal">    OverflowMaxOutputBits += OverflowMaxCurBits &#42; 2;</Highlight></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Unsupported binop&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The precision check may have already ruled out overflow.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OverflowMaxOutputBits &lt; IntSz) &#123;</Highlight></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><Highlight kind="normal">    NeedsOverflowCheck = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We can bound unsigned overflow from sub to in range signed value (this is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// what allows us to avoid the overflow check for sub).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntOpc == Instruction::Sub)</Highlight></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><Highlight kind="normal">      OutputSigned = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Precision check did not rule out overflow, so need to check.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: If we add support for &#96;WithCache&#96; in &#96;willNotOverflow&#96;, change</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &#96;IntOps&#91;...&#93;&#96; arguments to &#96;KnownOps&#91;...&#93;&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NeedsOverflowCheck &amp;&amp;</Highlight></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><Highlight kind="normal">      !willNotOverflow(IntOpc, IntOps&#91;0&#93;, IntOps&#91;1&#93;, BO, OutputSigned))</Highlight></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IntBinOp = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(IntOpc, IntOps&#91;0&#93;, IntOps&#91;1&#93;);</Highlight></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IntBO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(IntBinOp)) &#123;</Highlight></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><Highlight kind="normal">    IntBO-&gt;setHasNoSignedWrap(OutputSigned);</Highlight></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><Highlight kind="normal">    IntBO-&gt;setHasNoUnsignedWrap(!OutputSigned);</Highlight></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OutputSigned)</Highlight></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> SIToFPInst(IntBinOp, FPTy);</Highlight></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> UIToFPInst(IntBinOp, FPTy);</Highlight></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Try to fold:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    1) (fp&#95;binop (&#123;s|u&#125;itofp x), (&#123;s|u&#125;itofp y))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        -&gt; (&#123;s|u&#125;itofp (int&#95;binop x, y))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    2) (fp&#95;binop (&#123;s|u&#125;itofp x), FpC)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        -&gt; (&#123;s|u&#125;itofp (int&#95;binop x, (fpto&#123;s|u&#125;i FpC)))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InstCombinerImpl::foldFBinOpOfIntCasts(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;BO) &#123;</Highlight></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><Highlight kind="normal">  std::array&lt;Value &#42;, 2&gt; IntOps = &#123;</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;Op1FpC = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check for:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    1) (binop (&#123;s|u&#125;itofp x), (&#123;s|u&#125;itofp y))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    2) (binop (&#123;s|u&#125;itofp x), FpC)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/patternmatch/#ab6ebd06f5c6506c6187670934a669db6">m&#95;SIToFP</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(IntOps&#91;0&#93;))) &amp;&amp;</Highlight></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a997de5064c00da2a575c5fa561dc3c65">m&#95;UIToFP</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(IntOps&#91;0&#93;))))</Highlight></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(Op1FpC)) &amp;&amp;</Highlight></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#ab6ebd06f5c6506c6187670934a669db6">m&#95;SIToFP</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(IntOps&#91;1&#93;))) &amp;&amp;</Highlight></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a997de5064c00da2a575c5fa561dc3c65">m&#95;UIToFP</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(IntOps&#91;1&#93;))))</Highlight></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Cache KnownBits a bit to potentially save some analysis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;WithCache&lt;const Value &#42;&gt;</a>, 2&gt; OpsKnown = &#123;IntOps&#91;0&#93;, IntOps&#91;1&#93;&#125;;</Highlight></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try treating x/y as coming from both &#96;uitofp&#96; and &#96;sitofp&#96;. There are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// different constraints depending on the sign of the cast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// NB: &#96;(uitofp nneg X)&#96; == &#96;(sitofp nneg X)&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Instruction &#42;R = foldFBinOpOfIntCastsFromSign(BO, </Highlight><Highlight kind="comment">/&#42;OpsFromSigned=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><Highlight kind="normal">                                                    IntOps, Op1FpC, OpsKnown))</Highlight></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>;</Highlight></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> foldFBinOpOfIntCastsFromSign(BO, </Highlight><Highlight kind="comment">/&#42;OpsFromSigned=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, IntOps,</Highlight></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><Highlight kind="normal">                                      Op1FpC, OpsKnown);</Highlight></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><Highlight kind="comment">/// A binop with a constant operand and a sign-extended boolean operand may be</Highlight></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><Highlight kind="comment">/// converted into a select of constants by applying the binary operation to</Highlight></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><Highlight kind="comment">/// the constant with the two possible values of the extended boolean (0 or -1).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InstCombinerImpl::foldBinopOfSextBoolToSelect(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;BO) &#123;</Highlight></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Handle non-commutative binop (constant is operand 0).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Handle zext.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Peek through &#39;not&#39; of cast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BO0 = BO.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BO1 = BO.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO0, <a href="/docs/api/namespaces/llvm/patternmatch/#ae5cf2b09af0c75d08cf9e5e8f2818a66">m&#95;SExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BO1, <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)) ||</Highlight></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><Highlight kind="normal">      !<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;isIntOrIntVectorTy(1))</Highlight></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// bo (sext i1 X), C --&gt; select X, (bo -1, C), (bo 0, C)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;Ones = <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">ConstantInt::getAllOnesValue</a>(BO.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110aac2f0a84dd2aa5ee4c3f1385e9565f5e">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefad7ed4ee1df437474d005188535f74875">Zero</a> = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">ConstantInt::getNullValue</a>(BO.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TVal = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(BO.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), Ones, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;FVal = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(BO.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), Zero, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, TVal, FVal);</Highlight></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656" lineLink="#a89d0a81f215ecb18fe5e589fbe66dc1e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a89d0a81f215ecb18fe5e589fbe66dc1e">simplifyOperationIntoSelectOperand</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>,</Highlight></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><Highlight kind="normal">                                                 </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsTrueArm) &#123;</Highlight></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>;</Highlight></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) &#123;</Highlight></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == <a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</Highlight></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><Highlight kind="normal">      V = IsTrueArm ? <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getTrueValue() : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getFalseValue();</Highlight></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition(),</Highlight></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><Highlight kind="normal">                     <a href="/docs/api/namespaces/llvm/patternmatch/#a6924ab881778c340b66e1e693154b1a8">m&#95;SpecificICmp</a>(IsTrueArm ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a></Highlight></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><Highlight kind="normal">                                              : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a>,</Highlight></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><Highlight kind="normal">                                    <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V))) &amp;&amp;</Highlight></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/#ab8a7ef433279aabf7f30fa5504a4d4ef">isGuaranteedNotToBeUndefOrPoison</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Pass</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><Highlight kind="normal">      V = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>;</Highlight></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(V);</Highlight></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a367cc3c1cd48f8723586daebe9a17d00">simplifyInstructionWithOperands</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDataLayout());</Highlight></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678" lineLink="#a7b9a62f04a493cc8b8dadc64100578f8"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a7b9a62f04a493cc8b8dadc64100578f8">foldOperationIntoSelectOperand</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>,</Highlight></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><Highlight kind="normal">                                             <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewOp, <a href="/docs/api/classes/llvm/instcombiner">InstCombiner</a> &amp;IC) &#123;</Highlight></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Clone = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.clone();</Highlight></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><Highlight kind="normal">  Clone-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, NewOp);</Highlight></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><Highlight kind="normal">  Clone-&gt;<a href="/docs/api/classes/llvm/instruction/#a7cdb2c2c02ea6d97b993be4c2bd099e6">dropUBImplyingAttrsAndMetadata</a>();</Highlight></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><Highlight kind="normal">  IC.<a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(Clone, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getIterator());</Highlight></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Clone;</Highlight></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a039111728e11b1cdf25e60446ae17f2a"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a039111728e11b1cdf25e60446ae17f2a">InstCombinerImpl::FoldOpIntoSelect</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>,</Highlight></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><Highlight kind="normal">                                                </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> FoldWithMultiUse) &#123;</Highlight></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t modify shared select instructions unless set FoldWithMultiUse</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;hasOneUse() &amp;&amp; !FoldWithMultiUse)</Highlight></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;TV = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getTrueValue();</Highlight></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;FV = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getFalseValue();</Highlight></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Bool selects with constant operands can be folded to logical ops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getType()-&gt;isIntOrIntVectorTy(1))</Highlight></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Test if a FCmpInst instruction is used exclusively by a select as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// part of a minimum or maximum operation. If so, refrain from doing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// any other folding. This helps out other analyses which understand</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// non-obfuscated minimum and maximum idioms. And in this case, at</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// least one of the comparison operands has at least one user besides</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the compare (the select), which would often largely negate the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// benefit of folding anyway.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FCmpInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition())) &#123;</Highlight></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;hasOneUse()) &#123;</Highlight></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = CI-&gt;getOperand(0), &#42;Op1 = CI-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((TV == Op0 &amp;&amp; FV == Op1) || (FV == Op0 &amp;&amp; TV == Op1))</Highlight></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make sure that one of the select arms folds successfully.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewTV = <a href="#a89d0a81f215ecb18fe5e589fbe66dc1e">simplifyOperationIntoSelectOperand</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/si">SI</a>, </Highlight><Highlight kind="comment">/&#42;IsTrueArm=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewFV =</Highlight></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><Highlight kind="normal">      <a href="#a89d0a81f215ecb18fe5e589fbe66dc1e">simplifyOperationIntoSelectOperand</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/si">SI</a>, </Highlight><Highlight kind="comment">/&#42;IsTrueArm=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewTV &amp;&amp; !NewFV)</Highlight></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create an instruction for the arm that did not fold.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewTV)</Highlight></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><Highlight kind="normal">    NewTV = <a href="#a7b9a62f04a493cc8b8dadc64100578f8">foldOperationIntoSelectOperand</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/si">SI</a>, TV, &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewFV)</Highlight></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><Highlight kind="normal">    NewFV = <a href="#a7b9a62f04a493cc8b8dadc64100578f8">foldOperationIntoSelectOperand</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/namespaces/llvm/si">SI</a>, FV, &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition(), NewTV, NewFV, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/si">SI</a>);</Highlight></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730" lineLink="#a45bde60377059fca310bb78e5d3a3ccb"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a45bde60377059fca310bb78e5d3a3ccb">simplifyInstructionWithPHI</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN,</Highlight></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/value">Value</a> &#42;InValue, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InBB,</Highlight></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><Highlight kind="normal">                                         </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><Highlight kind="normal">                                         </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> SQ) &#123;</Highlight></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// NB: It is a precondition of this transform that the operands be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// phi translatable!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>;</Highlight></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) &#123;</Highlight></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == PN)</Highlight></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(InValue);</Highlight></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;DoPHITranslation(PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), InBB));</Highlight></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t consider the simplification successful if we get back a constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// expression. That&#39;s just an instruction in hiding.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Also reject the case where we simplify back to the phi node. We wouldn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// be able to remove it in that case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewVal = <a href="/docs/api/namespaces/llvm/#a367cc3c1cd48f8723586daebe9a17d00">simplifyInstructionWithOperands</a>(</Highlight></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><Highlight kind="normal">      &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, SQ.<a href="/docs/api/structs/llvm/simplifyquery/#a505cdf903e17bf9be677769bf0980adc">getWithInstruction</a>(InBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()));</Highlight></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewVal &amp;&amp; NewVal != PN &amp;&amp; !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(NewVal, <a href="/docs/api/namespaces/llvm/patternmatch/#a300db8bf3acf4b1cff9a56ae53a8727c">m&#95;ConstantExpr</a>()))</Highlight></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewVal;</Highlight></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if incoming PHI value can be replaced with constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// based on implied condition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;TerminatorBI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(InBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TerminatorBI &amp;&amp; TerminatorBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><Highlight kind="normal">      TerminatorBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != TerminatorBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) &amp;&amp; ICmp) &#123;</Highlight></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LHSIsTrue = TerminatorBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><Highlight kind="normal">    std::optional&lt;bool&gt; ImpliedCond = <a href="/docs/api/namespaces/llvm/#af7f2eb961a542779e97c0b3ec7fa6623">isImpliedCondition</a>(</Highlight></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><Highlight kind="normal">        TerminatorBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>(), ICmp-&gt;<a href="/docs/api/classes/llvm/icmpinst/#a36f67a81e2a4449854771f4e64efe60a">getCmpPredicate</a>(), <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;0&#93;, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;1&#93;,</Highlight></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, LHSIsTrue);</Highlight></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ImpliedCond)</Highlight></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantint/#afe7d477c6022fe7123b90e3b39c58e69">ConstantInt::getBool</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType(), ImpliedCond.value());</Highlight></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a2fc50d227d302eb98914f04bcc6634e1"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a2fc50d227d302eb98914f04bcc6634e1">InstCombinerImpl::foldOpIntoPhi</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN,</Highlight></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><Highlight kind="normal">                                             </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllowMultipleUses) &#123;</Highlight></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumPHIValues = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>();</Highlight></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumPHIValues == 0)</Highlight></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We normally only transform phis with a single use.  However, if a PHI has</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// multiple uses and they are all the same operation, we can fold &#42;all&#42; of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// uses into the PHI.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> OneUse = PN-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>();</Highlight></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IdenticalUsers = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AllowMultipleUses &amp;&amp; !OneUse) &#123;</Highlight></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Walk the use list for the instruction, comparing them to I.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : PN-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UI != &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isIdenticalTo(UI))</Highlight></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise, we can replace &#42;all&#42; users with the new PHI we form.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><Highlight kind="normal">    IdenticalUsers = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check that all operands are phi-translatable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) &#123;</Highlight></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == PN)</Highlight></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Non-instructions never require phi-translation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Phi-translate can handle phi nodes in the same block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</Highlight></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Operand dominates the block, no phi-translation necessary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>.dominates(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()))</Highlight></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Not phi-translatable, bail out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check to see whether the instruction can be folded into each phi operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there is one operand that does not fold, remember the BB it is in.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> NewPhiValues;</Highlight></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;unsigned int&gt;</a> OpsToMoveUseToIncomingBB;</Highlight></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> SeenNonSimplifiedInVal = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != NumPHIValues; ++i) &#123;</Highlight></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i);</Highlight></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InBB = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i);</Highlight></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewVal = <a href="#a45bde60377059fca310bb78e5d3a3ccb">simplifyInstructionWithPHI</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, PN, InVal, InBB, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>)) &#123;</Highlight></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><Highlight kind="normal">      NewPhiValues.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(NewVal);</Highlight></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Handle some cases that can&#39;t be fully simplified, but where we know that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the two instructions will fold into one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> WillFold = &#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InVal-&gt;<a href="/docs/api/classes/llvm/value/#a2e987c6af902aad6baa39bd5b7ef322c">hasOneUser</a>())</Highlight></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// icmp of ucmp/scmp with constant will fold to icmp.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;Ignored;</Highlight></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CmpIntrinsic&gt;</a>(InVal) &amp;&amp;</Highlight></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#ab86c85b47e09489dcda68fd91d082d77">m&#95;ICmp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(PN), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(Ignored))))</Highlight></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// icmp eq zext(bool), 0 will fold to !bool.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(InVal) &amp;&amp;</Highlight></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ZExtInst&gt;</a>(InVal)-&gt;getSrcTy()-&gt;isIntOrIntVectorTy(1) &amp;&amp;</Highlight></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><Highlight kind="normal">                <a href="/docs/api/namespaces/llvm/patternmatch/#a6924ab881778c340b66e1e693154b1a8">m&#95;SpecificICmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(PN), <a href="/docs/api/namespaces/llvm/patternmatch/#ae77be336e228cf9aa00709a8606dfb98">m&#95;Zero</a>())))</Highlight></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (WillFold()) &#123;</Highlight></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><Highlight kind="normal">      OpsToMoveUseToIncomingBB.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(i);</Highlight></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><Highlight kind="normal">      NewPhiValues.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OneUse &amp;&amp; !IdenticalUsers)</Highlight></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SeenNonSimplifiedInVal)</Highlight></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// More than one non-simplified value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><Highlight kind="normal">    SeenNonSimplifiedInVal = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If there is exactly one non-simplified value, we can insert a copy of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// operation in that block.  However, if this is a critical edge, we would</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// be inserting the computation on some other paths (e.g. inside a loop).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Only do this if the pred block is unconditionally branching into the phi</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// block. Also, make sure that the pred block is not dead code.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(InBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BI || !BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>() || !<a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>.isReachableFromEntry(InBB))</Highlight></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><Highlight kind="normal">    NewPhiValues.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><Highlight kind="normal">    OpsToMoveUseToIncomingBB.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(i);</Highlight></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the InVal is an invoke at the end of the pred block, then we can&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// insert a computation after it without breaking the edge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InvokeInst&gt;</a>(InVal))</Highlight></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(InVal)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() == InBB)</Highlight></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Do not push the operation across a loop backedge. This could result in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// an infinite combine loop, and is generally non-profitable (especially</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// if the operation was originally outside the loop).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#af5a8feb3d194df1e72e6a32cc746bc97">isBackEdge</a>(InBB, PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()))</Highlight></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Clone the instruction that uses the phi node and move it into the incoming</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// BB because we know that the next iteration of InstCombine will simplify it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;BasicBlock &#42;, Instruction &#42;&gt;</a> Clones;</Highlight></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvmoduleanalysis-cpp/#acaab1e2660e7055669741c9f485e26c5">OpIndex</a> : OpsToMoveUseToIncomingBB) &#123;</Highlight></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvmoduleanalysis-cpp/#acaab1e2660e7055669741c9f485e26c5">OpIndex</a>);</Highlight></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OpBB = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(<a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvmoduleanalysis-cpp/#acaab1e2660e7055669741c9f485e26c5">OpIndex</a>);</Highlight></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Clone = Clones.<a href="/docs/api/classes/llvm/densemapbase/#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(OpBB);</Highlight></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Clone) &#123;</Highlight></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><Highlight kind="normal">      Clone = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.clone();</Highlight></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : Clone-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) &#123;</Highlight></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (U == PN)</Highlight></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><Highlight kind="normal">          U = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>;</Highlight></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><Highlight kind="normal">          U = U-&gt;DoPHITranslation(PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), OpBB);</Highlight></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><Highlight kind="normal">      Clone = <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(Clone, OpBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><Highlight kind="normal">      Clones.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;OpBB, Clone&#125;);</Highlight></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><Highlight kind="normal">    NewPhiValues&#91;<a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvmoduleanalysis-cpp/#acaab1e2660e7055669741c9f485e26c5">OpIndex</a>&#93; = Clone;</Highlight></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Okay, we can do the transformation: create the new PHI node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType(), PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>());</Highlight></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instcombiner/#a46f1e493b5d0822af6344aa294f93fdb">InsertNewInstBefore</a>(NewPN, PN-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><Highlight kind="normal">  NewPN-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(PN);</Highlight></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><Highlight kind="normal">  NewPN-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(PN-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != NumPHIValues; ++i)</Highlight></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><Highlight kind="normal">    NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewPhiValues&#91;i&#93;, PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i));</Highlight></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IdenticalUsers) &#123;</Highlight></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(PN-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())) &#123;</Highlight></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> == &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;<a href="/docs/api/classes/llvm/user">User</a>, NewPN);</Highlight></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;<a href="/docs/api/classes/llvm/user">User</a>);</Highlight></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><Highlight kind="normal">    OneUse = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OneUse) &#123;</Highlight></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a9784a018b2dd6a85ee8a70f5f5ab3d02">replaceAllDbgUsesWith</a>(</Highlight><Highlight kind="keyword">const&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(&#42;PN),</Highlight></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><Highlight kind="normal">                          </Highlight><Highlight kind="keyword">const&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(&#42;NewPN),</Highlight></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><Highlight kind="normal">                          </Highlight><Highlight kind="keyword">const&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(&#42;PN), <a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>);</Highlight></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, NewPN);</Highlight></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a9317f2efaf85a4afc7cde58a2c0d734b"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a9317f2efaf85a4afc7cde58a2c0d734b">InstCombinerImpl::foldBinopWithPhiOperands</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;BO) &#123;</Highlight></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: This should be similar to the incoming values check in foldOpIntoPhi:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       we are guarding against replicating the binop in &gt;1 predecessor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       This could miss matching a phi with 2 constant incoming values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Phi0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BO.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Phi1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BO.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</Highlight></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Phi0 || !Phi1 || !Phi0-&gt;hasOneUse() || !Phi1-&gt;hasOneUse() ||</Highlight></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><Highlight kind="normal">      Phi0-&gt;getNumOperands() != Phi1-&gt;getNumOperands())</Highlight></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Remove the restriction for binop being in the same block as the phis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BO.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Phi0-&gt;getParent() ||</Highlight></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><Highlight kind="normal">      BO.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != Phi1-&gt;getParent())</Highlight></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Fold if there is at least one specific constant value in phi0 or phi1&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// incoming values that comes from the same block and this specific constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// value can be used to do optimization for specific binary operator.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// %phi0 = phi i32 &#91;0, %bb0&#93;, &#91;%i, %bb1&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// %phi1 = phi i32 &#91;%j, %bb0&#93;, &#91;0, %bb1&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// %add = add i32 %phi0, %phi1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ==&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// %add = phi i32 &#91;%j, %bb0&#93;, &#91;%i, %bb1&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/constantexpr/#ae9c2f00a962cb8e0316cf3548a5d8029">ConstantExpr::getBinOpIdentity</a>(BO.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), BO.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</Highlight></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><Highlight kind="normal">                                               </Highlight><Highlight kind="comment">/&#42;AllowRHSConstant&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &#123;</Highlight></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> NewIncomingValues;</Highlight></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CanFoldIncomingValuePair = &#91;&amp;&#93;(std::tuple&lt;Use &amp;, Use &amp;&gt; <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>) &#123;</Highlight></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Phi0Use = std::get&lt;0&gt;(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</Highlight></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Phi1Use = std::get&lt;1&gt;(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</Highlight></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Phi0-&gt;getIncomingBlock(Phi0Use) != Phi1-&gt;getIncomingBlock(Phi1Use))</Highlight></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Phi0UseV = Phi0Use.get();</Highlight></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Phi1UseV = Phi1Use.get();</Highlight></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Phi0UseV == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)</Highlight></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><Highlight kind="normal">        NewIncomingValues.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Phi1UseV);</Highlight></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Phi1UseV == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)</Highlight></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><Highlight kind="normal">        NewIncomingValues.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Phi0UseV);</Highlight></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(Phi0-&gt;operands(), Phi1-&gt;operands()),</Highlight></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><Highlight kind="normal">               CanFoldIncomingValuePair)) &#123;</Highlight></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPhi =</Highlight></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(Phi0-&gt;getType(), Phi0-&gt;getNumOperands());</Highlight></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewIncomingValues.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == Phi0-&gt;getNumOperands() &amp;&amp;</Highlight></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;The number of collected incoming values should equal the number &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;of the original PHINode operands!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Phi0-&gt;getNumOperands(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++)</Highlight></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><Highlight kind="normal">        NewPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewIncomingValues&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;, Phi0-&gt;getIncomingBlock(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewPhi;</Highlight></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Phi0-&gt;getNumOperands() != 2 || Phi1-&gt;getNumOperands() != 2)</Highlight></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Match a pair of incoming constants for one of the predecessor blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ConstBB, &#42;OtherBB;</Highlight></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;C0, &#42;C1;</Highlight></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Phi0-&gt;getIncomingValue(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(C0))) &#123;</Highlight></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><Highlight kind="normal">    ConstBB = Phi0-&gt;getIncomingBlock(0);</Highlight></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><Highlight kind="normal">    OtherBB = Phi0-&gt;getIncomingBlock(1);</Highlight></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Phi0-&gt;getIncomingValue(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(C0))) &#123;</Highlight></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><Highlight kind="normal">    ConstBB = Phi0-&gt;getIncomingBlock(1);</Highlight></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><Highlight kind="normal">    OtherBB = Phi0-&gt;getIncomingBlock(0);</Highlight></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Phi1-&gt;getIncomingValueForBlock(ConstBB), <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(C1)))</Highlight></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The block that we are hoisting to must reach here unconditionally.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Otherwise, we could be speculatively executing an expensive or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// non-speculative op.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PredBlockBranch = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(OtherBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PredBlockBranch || PredBlockBranch-&gt;isConditional() ||</Highlight></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><Highlight kind="normal">      !<a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>.isReachableFromEntry(OtherBB))</Highlight></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: This check could be tightened to only apply to binops (div/rem) that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       are not safe to speculatively execute. But that could allow hoisting</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       potentially expensive instructions (fdiv for example).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> BBIter = BO.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;begin(); &amp;&#42;BBIter != &amp;BO; ++BBIter)</Highlight></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(&amp;&#42;BBIter))</Highlight></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Fold constants for the predecessor block with constant incoming values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewC = <a href="/docs/api/namespaces/llvm/#a964455f36837281d37f2a44e2fcb4cca">ConstantFoldBinaryOpOperands</a>(BO.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), C0, C1, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>);</Highlight></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewC)</Highlight></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make a new binop in the predecessor block with the non-constant incoming</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.SetInsertPoint(PredBlockBranch);</Highlight></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBO = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(BO.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(),</Highlight></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><Highlight kind="normal">                                     Phi0-&gt;getIncomingValueForBlock(OtherBB),</Highlight></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><Highlight kind="normal">                                     Phi1-&gt;getIncomingValueForBlock(OtherBB));</Highlight></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NotFoldedNewBO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(NewBO))</Highlight></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><Highlight kind="normal">    NotFoldedNewBO-&gt;copyIRFlags(&amp;BO);</Highlight></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace the binop with a phi of the new values. The old phis are dead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPhi = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(BO.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 2);</Highlight></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><Highlight kind="normal">  NewPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewBO, OtherBB);</Highlight></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><Highlight kind="normal">  NewPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewC, ConstBB);</Highlight></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewPhi;</Highlight></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a1b94928a51545cb29d3e46b8ad94cb72"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a1b94928a51545cb29d3e46b8ad94cb72">InstCombinerImpl::foldBinOpIntoSelectOrPhi</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(1)))</Highlight></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Sel = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0))) &#123;</Highlight></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewSel = <a href="/docs/api/classes/llvm/instcombinerimpl/#a039111728e11b1cdf25e60446ae17f2a">FoldOpIntoSelect</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Sel))</Highlight></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewSel;</Highlight></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0))) &#123;</Highlight></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewPhi = <a href="/docs/api/classes/llvm/instcombinerimpl/#a2fc50d227d302eb98914f04bcc6634e1">foldOpIntoPhi</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, PN))</Highlight></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewPhi;</Highlight></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065" lineLink="#a27dc41c474e5376ef7d1865735cfb3dd"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a27dc41c474e5376ef7d1865735cfb3dd">shouldMergeGEPs</a>(<a href="/docs/api/classes/llvm/gepoperator">GEPOperator</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, <a href="/docs/api/classes/llvm/gepoperator">GEPOperator</a> &amp;Src) &#123;</Highlight></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this GEP has only 0 indices, it is the same pointer as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Src. If Src is not a trivial GEP too, don&#39;t combine</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the indices.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.hasAllZeroIndices() &amp;&amp; !Src.hasAllZeroIndices() &amp;&amp;</Highlight></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><Highlight kind="normal">      !Src.hasOneUse())</Highlight></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075" lineLink="/docs/api/classes/llvm/instcombinerimpl/#acbf4c17d9f1b9f6729602a3c2a6c5b9d"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#acbf4c17d9f1b9f6729602a3c2a6c5b9d">InstCombinerImpl::foldVectorBinop</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;Inst) &#123;</Highlight></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(Inst.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))</Highlight></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">BinaryOperator::BinaryOps</a> Opcode = Inst.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>();</Highlight></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = Inst.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;RHS = Inst.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(LHS-&gt;getType())-&gt;getElementCount() ==</Highlight></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><Highlight kind="normal">         <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(Inst.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getElementCount());</Highlight></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(RHS-&gt;getType())-&gt;getElementCount() ==</Highlight></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><Highlight kind="normal">         <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(Inst.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getElementCount());</Highlight></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If both operands of the binop are vector concatenations, then perform the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// narrow binop on each pair of the source operands followed by concatenation</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the results.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;L0, &#42;L1, &#42;R0, &#42;R1;</Highlight></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> Mask;</Highlight></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(L0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(L1), <a href="/docs/api/structs/llvm/patternmatch/m-mask">m&#95;Mask</a>(Mask))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(R0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(R1), <a href="/docs/api/structs/llvm/patternmatch/m-specificmask">m&#95;SpecificMask</a>(Mask))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><Highlight kind="normal">      LHS-&gt;hasOneUse() &amp;&amp; RHS-&gt;hasOneUse() &amp;&amp;</Highlight></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ShuffleVectorInst&gt;</a>(LHS)-&gt;isConcat() &amp;&amp;</Highlight></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ShuffleVectorInst&gt;</a>(RHS)-&gt;isConcat()) &#123;</Highlight></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This transform does not have the speculative execution constraint as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// below because the shuffle is a concatenation. The new binops are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// operating on exactly the same elements as the existing binop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: We could ease the mask requirement to allow different undef lanes,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//       but that requires an analysis of the binop-with-undef output value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBO0 = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(Opcode, L0, R0);</Highlight></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(NewBO0))</Highlight></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><Highlight kind="normal">      BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a3e6d2896c39a84cfa6c47f34cdc584ff">copyIRFlags</a>(&amp;Inst);</Highlight></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBO1 = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(Opcode, L1, R1);</Highlight></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(NewBO1))</Highlight></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><Highlight kind="normal">      BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a3e6d2896c39a84cfa6c47f34cdc584ff">copyIRFlags</a>(&amp;Inst);</Highlight></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(NewBO0, NewBO1, Mask);</Highlight></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> createBinOpReverse = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>) &#123;</Highlight></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(Opcode, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, Inst.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</Highlight></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(V))</Highlight></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><Highlight kind="normal">      BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a3e6d2896c39a84cfa6c47f34cdc584ff">copyIRFlags</a>(&amp;Inst);</Highlight></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/module">Module</a> &#42;M = Inst.<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>();</Highlight></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/namespaces/llvm/intrinsic/#a0cff8be0190d8e20b7cf13646f34afa2">Intrinsic::getOrInsertDeclaration</a>(</Highlight></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><Highlight kind="normal">        M, Intrinsic::vector&#95;reverse, V-&gt;getType());</Highlight></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, V);</Highlight></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// NOTE: Reverse shuffles don&#39;t require the speculative execution protection</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// below because they don&#39;t affect which lanes take part in the computation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V1, &#42;V2;</Highlight></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LHS, <a href="/docs/api/namespaces/llvm/patternmatch/#acaf7ff6a377746861ec2f167c3c574dc">m&#95;VecReverse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V1)))) &#123;</Highlight></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Op(rev(V1), rev(V2)) -&gt; rev(Op(V1, V2))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#acaf7ff6a377746861ec2f167c3c574dc">m&#95;VecReverse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V2))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><Highlight kind="normal">        (LHS-&gt;hasOneUse() || RHS-&gt;hasOneUse() ||</Highlight></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><Highlight kind="normal">         (LHS == RHS &amp;&amp; LHS-&gt;hasNUses(2))))</Highlight></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> createBinOpReverse(V1, V2);</Highlight></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Op(rev(V1), RHSSplat)) -&gt; rev(Op(V1, RHSSplat))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LHS-&gt;hasOneUse() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(RHS))</Highlight></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> createBinOpReverse(V1, RHS);</Highlight></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Op(LHSSplat, rev(V2)) -&gt; rev(Op(LHSSplat, V2))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(LHS) &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#acaf7ff6a377746861ec2f167c3c574dc">m&#95;VecReverse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V2)))))</Highlight></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> createBinOpReverse(LHS, V2);</Highlight></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// It may not be safe to reorder shuffles and things like div, urem, etc.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// because we may trap when executing those ops on unknown vector elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// See PR20059.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a19ebaad52d11be3121c2bfcbd0f30193">isSafeToSpeculativelyExecuteWithVariableReplaced</a>(&amp;Inst))</Highlight></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> createBinOpShuffle = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> M) &#123;</Highlight></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;XY = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(Opcode, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(XY))</Highlight></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><Highlight kind="normal">      BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a3e6d2896c39a84cfa6c47f34cdc584ff">copyIRFlags</a>(&amp;Inst);</Highlight></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/shufflevectorinst">ShuffleVectorInst</a>(XY, M);</Highlight></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If both arguments of the binary operation are shuffles that use the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// mask and shuffle within a single vector, move the shuffle after the binop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>(), <a href="/docs/api/structs/llvm/patternmatch/m-mask">m&#95;Mask</a>(Mask))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V2), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>(), <a href="/docs/api/structs/llvm/patternmatch/m-specificmask">m&#95;SpecificMask</a>(Mask))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><Highlight kind="normal">      V1-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == V2-&gt;getType() &amp;&amp;</Highlight></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><Highlight kind="normal">      (LHS-&gt;hasOneUse() || RHS-&gt;hasOneUse() || LHS == RHS)) &#123;</Highlight></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Op(shuffle(V1, Mask), shuffle(V2, Mask)) -&gt; shuffle(Op(V1, V2), Mask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> createBinOpShuffle(V1, V2, Mask);</Highlight></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If both arguments of a commutative binop are select-shuffles that use the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// same mask with commuted operands, the shuffles are unnecessary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inst.<a href="/docs/api/classes/llvm/instruction/#a55743bd32282bf6f87aeb49237b1fb68">isCommutative</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V1), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V2), <a href="/docs/api/structs/llvm/patternmatch/m-mask">m&#95;Mask</a>(Mask))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS,</Highlight></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(V2), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(V1), <a href="/docs/api/structs/llvm/patternmatch/m-specificmask">m&#95;SpecificMask</a>(Mask)))) &#123;</Highlight></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LShuf = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ShuffleVectorInst&gt;</a>(LHS);</Highlight></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RShuf = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ShuffleVectorInst&gt;</a>(RHS);</Highlight></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Allow shuffles that contain undefs in the mask?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//       That is legal, but it reduces undef knowledge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Allow arbitrary shuffles by shuffling after binop?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//       That might be legal, but we have to deal with poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LShuf-&gt;isSelect() &amp;&amp;</Highlight></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(LShuf-&gt;getShuffleMask(), <a href="/docs/api/namespaces/llvm/#a9965a6249be879ba3d336a75a4f3efa7">PoisonMaskElem</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><Highlight kind="normal">        RShuf-&gt;isSelect() &amp;&amp;</Highlight></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(RShuf-&gt;getShuffleMask(), <a href="/docs/api/namespaces/llvm/#a9965a6249be879ba3d336a75a4f3efa7">PoisonMaskElem</a>)) &#123;</Highlight></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// LHS = shuffle V1, V2, &lt;0, 5, 6, 3&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// RHS = shuffle V2, V1, &lt;0, 5, 6, 3&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// LHS + RHS --&gt; (V10+V20, V21+V11, V22+V12, V13+V23) --&gt; V1 + V2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewBO = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(Opcode, V1, V2);</Highlight></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><Highlight kind="normal">      NewBO-&gt;<a href="/docs/api/classes/llvm/instruction/#a3e6d2896c39a84cfa6c47f34cdc584ff">copyIRFlags</a>(&amp;Inst);</Highlight></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewBO;</Highlight></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If one argument is a shuffle within one vector and the other is a constant,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// try moving the shuffle after the binary operation. This canonicalization</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// intends to move shuffles closer to other shuffles and binops closer to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// other binops, so they can be folded. It may also enable demanded elements</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// transforms.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;InstVTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FixedVectorType&gt;</a>(Inst.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InstVTy &amp;&amp;</Highlight></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;Inst, <a href="/docs/api/namespaces/llvm/patternmatch/#ab3021d22d00a294cb59bd5067bc5c4b2">m&#95;c&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V1), <a href="/docs/api/namespaces/llvm/patternmatch/#a0108cb60d944ff177beaa8f419c91d72">m&#95;Poison</a>(),</Highlight></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><Highlight kind="normal">                                                <a href="/docs/api/structs/llvm/patternmatch/m-mask">m&#95;Mask</a>(Mask))),</Highlight></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><Highlight kind="normal">                             <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(V1-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getNumElements() &lt;=</Highlight></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><Highlight kind="normal">          InstVTy-&gt;getNumElements()) &#123;</Highlight></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InstVTy-&gt;getScalarType() == V1-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Shuffle should not change scalar type&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find constant NewC that has property:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   shuffle(NewC, ShMask) = C</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If such constant does not exist (example: ShMask=&lt;0,0&gt; and C=&lt;1,2&gt;)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// reorder is not possible. A 1-to-1 mapping is not required. Example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// ShMask = &lt;1,1,2,2&gt; and C = &lt;5,5,6,6&gt; --&gt; NewC = &lt;undef,5,6,undef&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ConstOp1 = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(RHS);</Highlight></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> ShMask = Mask;</Highlight></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SrcVecNumElts =</Highlight></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FixedVectorType&gt;</a>(V1-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/poisonvalue">PoisonValue</a> &#42;PoisonScalar = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getType()-&gt;getScalarType());</Highlight></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;, 16&gt;</a> NewVecC(SrcVecNumElts, PoisonScalar);</Highlight></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MayChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumElts = InstVTy-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumElts; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CElt = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getAggregateElement(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ShMask&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; &gt;= 0) &#123;</Highlight></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ShMask&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; &lt; (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal">)NumElts &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Not expecting narrowing shuffle&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewCElt = NewVecC&#91;ShMask&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;&#93;;</Highlight></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Bail out if:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// 1 The constant vector contains a constant expression.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// 2 The shuffle needs an element of the constant vector that can&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//    be mapped to a new constant vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// 3 This is a widening shuffle that copies elements of V1 into the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//    extended elements (extending with poison is allowed).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CElt || (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(NewCElt) &amp;&amp; NewCElt != CElt) ||</Highlight></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt;= SrcVecNumElts) &#123;</Highlight></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><Highlight kind="normal">          MayChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><Highlight kind="normal">        NewVecC&#91;ShMask&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;&#93; = CElt;</Highlight></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If this is a widening shuffle, we must be able to extend with poison</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// elements. If the original binop does not produce a poison in the high</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// lanes, then this transform is not safe.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Similarly for poison lanes due to the shuffle mask, we can only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// transform binops that preserve poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: We could shuffle those non-poison constant values into the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//       result by using a constant vector (rather than an poison vector)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//       as operand 1 of the new binop, but that might be too aggressive</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//       for target-independent shuffle creation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt;= SrcVecNumElts || ShMask&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; &lt; 0) &#123;</Highlight></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;MaybePoison =</Highlight></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><Highlight kind="normal">            ConstOp1</Highlight></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><Highlight kind="normal">                ? <a href="/docs/api/namespaces/llvm/#a964455f36837281d37f2a44e2fcb4cca">ConstantFoldBinaryOpOperands</a>(Opcode, PoisonScalar, CElt, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>)</Highlight></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><Highlight kind="normal">                : <a href="/docs/api/namespaces/llvm/#a964455f36837281d37f2a44e2fcb4cca">ConstantFoldBinaryOpOperands</a>(Opcode, CElt, PoisonScalar, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>);</Highlight></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MaybePoison || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(MaybePoison)) &#123;</Highlight></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><Highlight kind="normal">          MayChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MayChange) &#123;</Highlight></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewC = <a href="/docs/api/classes/llvm/constantvector/#ade9fa017ca3aa82f7694a47090547bc1">ConstantVector::get</a>(NewVecC);</Highlight></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// It may not be safe to execute a binop on a vector with poison elements</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// because the entire instruction can be folded to undef or create poison</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// that did not exist in the original code.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: The shift case should not be necessary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inst.<a href="/docs/api/classes/llvm/instruction/#af9c2825ab53adf1bf8c9fa19ec89d986">isIntDivRem</a>() || (Inst.<a href="/docs/api/classes/llvm/instruction/#ac5984d6827f6e6922bed00bf03ba9552">isShift</a>() &amp;&amp; ConstOp1))</Highlight></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><Highlight kind="normal">        NewC = <a href="/docs/api/classes/llvm/instcombiner/#acf9cbfcb493b0042022c94230e9350e2">getSafeVectorConstantForBinop</a>(Opcode, NewC, ConstOp1);</Highlight></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Op(shuffle(V1, Mask), C) -&gt; shuffle(Op(V1, NewC), Mask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Op(C, shuffle(V1, Mask)) -&gt; shuffle(Op(NewC, V1), Mask)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewLHS = ConstOp1 ? V1 : NewC;</Highlight></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewRHS = ConstOp1 ? NewC : V1;</Highlight></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> createBinOpShuffle(NewLHS, NewRHS, Mask);</Highlight></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to reassociate to sink a splat shuffle after a binary operation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inst.<a href="/docs/api/classes/llvm/instruction/#a4f0027b9d05b27206b1882976fce9038">isAssociative</a>() &amp;&amp; Inst.<a href="/docs/api/classes/llvm/instruction/#a55743bd32282bf6f87aeb49237b1fb68">isCommutative</a>()) &#123;</Highlight></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Canonicalize shuffle operand as LHS.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ShuffleVectorInst&gt;</a>(RHS))</Highlight></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><Highlight kind="normal">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(LHS, RHS);</Highlight></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int&gt;</a> MaskC;</Highlight></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> SplatIndex;</Highlight></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, &#42;OtherOp;</Highlight></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LHS,</Highlight></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5eee6cdb006c1d88b1123400f7f462d1">m&#95;Shuffle</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>(), <a href="/docs/api/structs/llvm/patternmatch/m-mask">m&#95;Mask</a>(MaskC)))) ||</Highlight></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(MaskC, <a href="/docs/api/structs/llvm/patternmatch/m-splatorpoisonmask">m&#95;SplatOrPoisonMask</a>(SplatIndex)) ||</Highlight></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() != Inst.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() ||</Highlight></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(Opcode, <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(OtherOp)))))</Highlight></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: This may not be safe if the analysis allows undef elements. By</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//        moving &#39;Y&#39; before the splat shuffle, we are implicitly assuming</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//        that it is not undef/poison at the splat index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(OtherOp, SplatIndex)) &#123;</Highlight></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><Highlight kind="normal">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, OtherOp);</Highlight></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a6339f2ad6701dc229c34ca4305596d3a">isSplatValue</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, SplatIndex)) &#123;</Highlight></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// X and Y are splatted values, so perform the binary operation on those</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// values followed by a splat followed by the 2nd binary operation:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// bo (splat X), (bo Y, OtherOp) --&gt; bo (splat (bo X, Y)), OtherOp</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewBO = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(Opcode, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 8&gt;</a> NewMask(MaskC.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), SplatIndex);</Highlight></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewSplat = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateShuffleVector(NewBO, NewMask);</Highlight></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;R = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(Opcode, NewSplat, OtherOp);</Highlight></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Intersect FMF on both new binops. Other (poison-generating) flags are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// dropped to be safe.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FPMathOperator&gt;</a>(R)) &#123;</Highlight></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><Highlight kind="normal">      R-&gt;copyFastMathFlags(&amp;Inst);</Highlight></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><Highlight kind="normal">      R-&gt;andIRFlags(RHS);</Highlight></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewInstBO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(NewBO))</Highlight></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><Highlight kind="normal">      NewInstBO-&gt;copyIRFlags(R);</Highlight></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> R;</Highlight></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><Highlight kind="comment">/// Try to narrow the width of a binop if at least 1 operand is an extend of</Highlight></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><Highlight kind="comment">/// of a value. This requires a potentially expensive known bits check to make</Highlight></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><Highlight kind="comment">/// sure the narrow op does not overflow.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InstCombinerImpl::narrowMathIfNoOverflow(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &amp;BO) &#123;</Highlight></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We need at least one extended operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = BO.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;Op1 = BO.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</Highlight></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this is a sub, we swap the operands since we always want an extension</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// on the RHS. The LHS can be an extension or a constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BO.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::Sub)</Highlight></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><Highlight kind="normal">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Op0, Op1);</Highlight></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsSext = <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#ae5cf2b09af0c75d08cf9e5e8f2818a66">m&#95;SExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)));</Highlight></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsSext &amp;&amp; !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#a6ba4022cd30993a84d111871dd0f6ba6">m&#95;ZExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))))</Highlight></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If both operands are the same extension from the same source type and we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// can eliminate at least one (hasOneUse), this might work.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">CastInst::CastOps</a> CastOpc = IsSext ? Instruction::SExt : Instruction::ZExt;</Highlight></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!(<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op1, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))) &amp;&amp; <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType() &amp;&amp;</Highlight></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Operator&gt;</a>(Op1)-&gt;getOpcode() == CastOpc &amp;&amp;</Highlight></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><Highlight kind="normal">        (Op0-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || Op1-&gt;hasOneUse()))) &#123;</Highlight></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If that did not match, see if we have a suitable constant operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Truncating and extending must produce the same constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;WideC;</Highlight></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Op0-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op1, <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(WideC)))</Highlight></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NarrowC = <a href="/docs/api/classes/llvm/instcombinerimpl/#a97d3f5c1aaad9cd86d8f6e9596473891">getLosslessTrunc</a>(WideC, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType(), CastOpc);</Highlight></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NarrowC)</Highlight></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = NarrowC;</Highlight></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Swap back now that we found our operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BO.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::Sub)</Highlight></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><Highlight kind="normal">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Both operands have narrow versions. Last step: the math must not overflow</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in the narrow width.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/correlatedvaluepropagation-cpp/#a52da671999cb61370bfe5c7e9fee966f">willNotOverflow</a>(BO.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, BO, IsSext))</Highlight></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// bo (ext X), (ext Y) --&gt; ext (bo X, Y)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// bo (ext X), C       --&gt; ext (bo X, C&#39;)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NarrowBO = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#aba5d97f3a14427982c1b86dafd033320">CreateBinOp</a>(BO.<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, </Highlight><Highlight kind="stringliteral">&quot;narrow&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewBinOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(NarrowBO)) &#123;</Highlight></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsSext)</Highlight></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><Highlight kind="normal">      NewBinOp-&gt;setHasNoSignedWrap();</Highlight></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><Highlight kind="normal">      NewBinOp-&gt;setHasNoUnsignedWrap();</Highlight></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/castinst/#ad2e0ab6d7096fe67a2216fe349044387">CastInst::Create</a>(CastOpc, NarrowBO, BO.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><Highlight kind="comment">/// Determine nowrap flags for (gep (gep p, x), y) to (gep p, (x + y))</Highlight></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><Highlight kind="comment">/// transform.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378" lineLink="#afef6fefdb447008608fc826b31a49d28"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/gepnowrapflags">GEPNoWrapFlags</a> <a href="#afef6fefdb447008608fc826b31a49d28">getMergedGEPNoWrapFlags</a>(<a href="/docs/api/classes/llvm/gepoperator">GEPOperator</a> &amp;GEP1,</Highlight></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><Highlight kind="normal">                                              <a href="/docs/api/classes/llvm/gepoperator">GEPOperator</a> &amp;GEP2) &#123;</Highlight></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> GEP1.<a href="/docs/api/classes/llvm/gepoperator/#a9f19d28f31c79215e0e0190115b0373d">getNoWrapFlags</a>().<a href="/docs/api/classes/llvm/gepnowrapflags/#aca022065bc2e60a2b5d4d968ae400b8b">intersectForOffsetAdd</a>(GEP2.<a href="/docs/api/classes/llvm/gepoperator/#a9f19d28f31c79215e0e0190115b0373d">getNoWrapFlags</a>());</Highlight></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><Highlight kind="comment">/// Thread a GEP operation with constant indices through the constant true/false</Highlight></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><Highlight kind="comment">/// arms of a select.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385" lineLink="#a16a66955e366f83c6e35d99511a33167"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a16a66955e366f83c6e35d99511a33167">foldSelectGEP</a>(<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</Highlight></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">InstCombiner::BuilderTy</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.hasAllConstantIndices())</Highlight></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Sel;</Highlight></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>;</Highlight></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;TrueC, &#42;FalseC;</Highlight></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getPointerOperand(), <a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(Sel)) ||</Highlight></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Sel,</Highlight></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(TrueC), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(FalseC))))</Highlight></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// gep (select Cond, TrueC, FalseC), IndexC --&gt; select Cond, TrueC&#39;, FalseC&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Propagate &#39;inbounds&#39; and metadata from existing instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note: using IRBuilder to create the constants for efficiency.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> IndexC(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.indices());</Highlight></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/gepnowrapflags">GEPNoWrapFlags</a> NW = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getNoWrapFlags();</Highlight></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getSourceElementType();</Highlight></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewTrueC = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(Ty, TrueC, IndexC, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, NW);</Highlight></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewFalseC = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(Ty, FalseC, IndexC, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, NW);</Highlight></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, NewTrueC, NewFalseC, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, Sel);</Highlight></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Canonicalization:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><Highlight kind="normal"></Highlight><Highlight kind="comment">// gep T, (gep i8, base, C1), (Index + C2) into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><Highlight kind="normal"></Highlight><Highlight kind="comment">// gep T, (gep i8, base, C1 + C2 &#42; sizeof(T)), Index</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412" lineLink="#a856d46e90d7159a88c175ceff667f40c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a856d46e90d7159a88c175ceff667f40c">canonicalizeGEPOfConstGEPI8</a>(<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</Highlight></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><Highlight kind="normal">                                                <a href="/docs/api/classes/llvm/gepoperator">GEPOperator</a> &#42;Src,</Highlight></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><Highlight kind="normal">                                                <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> &amp;IC) &#123;</Highlight></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getNumIndices() != 1)</Highlight></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = IC.<a href="/docs/api/classes/llvm/instcombiner/#a16262e69f9cdf5d2c9d5623c3b06af43">getDataLayout</a>();</Highlight></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>;</Highlight></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;C1;</Highlight></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Src, <a href="/docs/api/namespaces/llvm/patternmatch/#a01e017c10a19541f103b7367f579e6f4">m&#95;PtrAdd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(C1))))</Highlight></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VarIndex;</Highlight></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;C2;</Highlight></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;PtrTy = Src-&gt;getType()-&gt;getScalarType();</Highlight></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IndexSizeInBits = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIndexTypeSizeInBits(PtrTy);</Highlight></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a9670636a8101c675bd9ef6d40803afe3">m&#95;AddLike</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(VarIndex), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(C2))))</Highlight></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (C1-&gt;<a href="/docs/api/classes/llvm/apint/#a512fe2c15ea651294688eeec1341644c">getBitWidth</a>() != IndexSizeInBits ||</Highlight></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><Highlight kind="normal">      C2-&gt;<a href="/docs/api/classes/llvm/apint/#a512fe2c15ea651294688eeec1341644c">getBitWidth</a>() != IndexSizeInBits)</Highlight></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp/#ae96315ee246bd4a509133af84c88c5e1">BaseType</a> = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getSourceElementType();</Highlight></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ScalableVectorType&gt;</a>(<a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp/#ae96315ee246bd4a509133af84c88c5e1">BaseType</a>))</Highlight></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="/docs/api/classes/llvm/typesize">TypeSize</a>(IndexSizeInBits, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(<a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp/#ae96315ee246bd4a509133af84c88c5e1">BaseType</a>));</Highlight></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/apint">APInt</a> NewOffset = <a href="/docs/api/classes/llvm/typesize">TypeSize</a> &#42; &#42;C2 + &#42;C1;</Highlight></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewOffset.<a href="/docs/api/classes/llvm/apint/#a49cd5939942c6665aba4cae8c220dff1">isZero</a>() ||</Highlight></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><Highlight kind="normal">      (Src-&gt;hasOneUse() &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1)-&gt;hasOneUse())) &#123;</Highlight></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;GEPConst =</Highlight></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><Highlight kind="normal">        IC.<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a5b416a8603ccb844165c8df22454ac05">CreatePtrAdd</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, IC.<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7c8f643db1fdc579f1aa5320c7a0398">getInt</a>(NewOffset));</Highlight></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/getelementptrinst/#a7e5d474f9fda4b2b2e5de3dcfefcc472">GetElementPtrInst::Create</a>(<a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp/#ae96315ee246bd4a509133af84c88c5e1">BaseType</a>, GEPConst, VarIndex);</Highlight></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a22bc54f319e33d248b169116b757a143"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a22bc54f319e33d248b169116b757a143">InstCombinerImpl::visitGEPOfGEP</a>(<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</Highlight></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><Highlight kind="normal">                                             <a href="/docs/api/classes/llvm/gepoperator">GEPOperator</a> &#42;Src) &#123;</Highlight></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Combine Indices - If the source pointer to this getelementptr instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is a getelementptr instruction with matching element type, combine the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// indices of the two getelementptr instructions into a single instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a27dc41c474e5376ef7d1865735cfb3dd">shouldMergeGEPs</a>(&#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>), &#42;Src))</Highlight></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a856d46e90d7159a88c175ceff667f40c">canonicalizeGEPOfConstGEPI8</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, Src, &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For constant GEPs, use a more general offset-based folding approach.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;PtrTy = Src-&gt;getType()-&gt;getScalarType();</Highlight></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.hasAllConstantIndices() &amp;&amp;</Highlight></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><Highlight kind="normal">      (Src-&gt;hasOneUse() || Src-&gt;hasAllConstantIndices())) &#123;</Highlight></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Split Src into a variable part and a constant suffix.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a81c0916829c13ba5279ca0e5480aef0c">gep&#95;type&#95;iterator</a> GTI = <a href="/docs/api/namespaces/llvm/#ac828b9b52935f87659a4adf237f820a3">gep&#95;type&#95;begin</a>(&#42;Src);</Highlight></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/classes/basetype">BaseType</a> = GTI.<a href="/docs/api/classes/llvm/generic-gep-type-iterator/#af429d12fd67c390e17272e9b16ce9186">getIndexedType</a>();</Highlight></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsFirstType = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumVarIndices = 0;</Highlight></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Pair : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(Src-&gt;indices())) &#123;</Highlight></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Pair.value())) &#123;</Highlight></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><Highlight kind="normal">        <a href="/docs/api/classes/basetype">BaseType</a> = GTI.<a href="/docs/api/classes/llvm/generic-gep-type-iterator/#af429d12fd67c390e17272e9b16ce9186">getIndexedType</a>();</Highlight></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><Highlight kind="normal">        IsFirstType = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><Highlight kind="normal">        NumVarIndices = Pair.index() + 1;</Highlight></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><Highlight kind="normal">      ++GTI;</Highlight></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Determine the offset for the constant suffix of Src.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(<a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getIndexTypeSizeInBits(PtrTy), 0);</Highlight></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumVarIndices != Src-&gt;getNumIndices()) &#123;</Highlight></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// FIXME: getIndexedOffsetInType() does not handled scalable vectors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/basetype">BaseType</a>-&gt;isScalableTy())</Highlight></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> ConstantIndices;</Highlight></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsFirstType)</Highlight></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><Highlight kind="normal">        ConstantIndices.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</Highlight></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getContext())));</Highlight></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(ConstantIndices, <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(Src-&gt;indices(), NumVarIndices));</Highlight></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getIndexedOffsetInType(<a href="/docs/api/classes/basetype">BaseType</a>, ConstantIndices);</Highlight></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add the offset for GEP (which is fully constant).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.accumulateConstantOffset(<a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>))</Highlight></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Convert the total offset back into indices.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;APInt&gt;</a> ConstIndices =</Highlight></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getGEPIndicesForOffset(<a href="/docs/api/classes/basetype">BaseType</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</Highlight></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>.isZero() || (!IsFirstType &amp;&amp; !ConstIndices&#91;0&#93;.isZero()))</Highlight></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/gepnowrapflags">GEPNoWrapFlags</a> NW = <a href="#afef6fefdb447008608fc826b31a49d28">getMergedGEPNoWrapFlags</a>(&#42;Src, &#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>));</Highlight></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> Indices;</Highlight></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(Indices, <a href="/docs/api/namespaces/llvm/#a9b64313b5c1907066b7bab1c60a2ea08">drop&#95;end</a>(Src-&gt;indices(),</Highlight></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><Highlight kind="normal">                                   Src-&gt;getNumIndices() - NumVarIndices));</Highlight></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;Idx : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(ConstIndices, !IsFirstType)) &#123;</Highlight></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><Highlight kind="normal">      Indices.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ConstantInt::get(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getContext(), Idx));</Highlight></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Even if the total offset is inbounds, we may end up representing it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// by first performing a larger negative offset, and then a smaller</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// positive one. The large negative offset might go out of bounds. Only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// preserve inbounds if all signs are the same.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Idx.isNonNegative() != ConstIndices&#91;0&#93;.isNonNegative())</Highlight></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><Highlight kind="normal">        NW = NW.<a href="/docs/api/classes/llvm/gepnowrapflags/#a20c93f80ea8da60e454d7596737b5c88">withoutNoUnsignedSignedWrap</a>();</Highlight></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Idx.isNonNegative())</Highlight></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><Highlight kind="normal">        NW = NW.<a href="/docs/api/classes/llvm/gepnowrapflags/#acd0ff795c450e59448a23dc04afdf3c8">withoutNoUnsignedWrap</a>();</Highlight></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(</Highlight></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateGEP(Src-&gt;getSourceElementType(), Src-&gt;getOperand(0),</Highlight></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><Highlight kind="normal">                               Indices, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, NW));</Highlight></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Src-&gt;getResultElementType() != <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getSourceElementType())</Highlight></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value&#42;, 8&gt;</a> Indices;</Highlight></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find out whether the last index in the source GEP is a sequential idx.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> EndsWithSequential = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a81c0916829c13ba5279ca0e5480aef0c">gep&#95;type&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac828b9b52935f87659a4adf237f820a3">gep&#95;type&#95;begin</a>(&#42;Src), E = <a href="/docs/api/namespaces/llvm/#a43c6ebb4fd35ebd815d66a2df4eed0b9">gep&#95;type&#95;end</a>(&#42;Src);</Highlight></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><Highlight kind="normal">       <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><Highlight kind="normal">    EndsWithSequential = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isSequential();</Highlight></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Can we combine the two pointer arithmetics offsets?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EndsWithSequential) &#123;</Highlight></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace: gep (gep %P, long B), long A, ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// With:    T = long A+B; gep %P, T, ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;SO1 = Src-&gt;getOperand(Src-&gt;getNumOperands()-1);</Highlight></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;GO1 = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1);</Highlight></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If they aren&#39;t the same type, then the input hasn&#39;t been processed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// by the loop above yet (which canonicalizes sequential index types to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// intptr&#95;t).  Just avoid transforming this until the input has been</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// normalized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SO1-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != GO1-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</Highlight></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Sum =</Highlight></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a5e0af1b16cab9e0efc63a6ce9de2b9cc">simplifyAddInst</a>(GO1, SO1, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>));</Highlight></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Only do the combine when we are sure the cost after the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// merge is never more than that before the merge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Sum == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><Highlight kind="normal">    Indices.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(Src-&gt;op&#95;begin()+1, Src-&gt;op&#95;end()-1);</Highlight></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><Highlight kind="normal">    Indices.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Sum);</Highlight></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><Highlight kind="normal">    Indices.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.op&#95;begin()+2, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.op&#95;end());</Highlight></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.idx&#95;begin()) &amp;&amp;</Highlight></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.idx&#95;begin())-&gt;isNullValue() &amp;&amp;</Highlight></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><Highlight kind="normal">             Src-&gt;getNumOperands() != 1) &#123;</Highlight></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise we can do the fold if the first index of the GEP is a zero</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><Highlight kind="normal">    Indices.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(Src-&gt;op&#95;begin()+1, Src-&gt;op&#95;end());</Highlight></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><Highlight kind="normal">    Indices.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.idx&#95;begin()+1, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.idx&#95;end());</Highlight></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Indices.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</Highlight></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(</Highlight></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateGEP(</Highlight></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><Highlight kind="normal">                 Src-&gt;getSourceElementType(), Src-&gt;getOperand(0), Indices, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><Highlight kind="normal">                 <a href="#afef6fefdb447008608fc826b31a49d28">getMergedGEPNoWrapFlags</a>(&#42;Src, &#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>))));</Highlight></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573" lineLink="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">InstCombiner::getFreelyInvertedImpl</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> WillInvertAllUses,</Highlight></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><Highlight kind="normal">                                           <a href="/docs/api/classes/llvm/instcombiner/#a19c4df37b96c2a73991556b696924584">BuilderTy</a> &#42;<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><Highlight kind="normal">                                           </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &amp;DoesConsume, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>) &#123;</Highlight></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> NonNull = </Highlight><Highlight kind="keyword">reinterpret&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(uintptr&#95;t(1));</Highlight></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ~(~(X)) -&gt; X.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>;</Highlight></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>)))) &#123;</Highlight></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><Highlight kind="normal">    DoesConsume = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>;</Highlight></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Constants can be considered to be not&#39;ed values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)))</Highlight></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantexpr/#a5b43a866f0fca605556f0f69f70c522a">ConstantExpr::getNot</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>++ &gt;= <a href="/docs/api/namespaces/llvm/#a67b491833e9e37c0ff08f1d4cd1bd4f4">MaxAnalysisRecursionDepth</a>)</Highlight></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The rest of the cases require that we invert all uses so don&#39;t bother</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// doing the analysis if we know we can&#39;t use the result.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!WillInvertAllUses)</Highlight></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Compares can be inverted if all of their uses are being modified to use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the ~V.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateCmp(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getInversePredicate(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0),</Highlight></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><Highlight kind="normal">                                <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NonNull;</Highlight></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If &#96;V&#96; is of the form &#96;A + B&#96; then &#96;-1 - V&#96; can be folded into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &#96;(-1 - B) - A&#96; if we are willing to invert all of the uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)))) &#123;</Highlight></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BV = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;hasOneUse(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><Highlight kind="normal">                                         DoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</Highlight></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateSub(BV, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) : NonNull;</Highlight></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AV = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;hasOneUse(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><Highlight kind="normal">                                         DoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</Highlight></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateSub(AV, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) : NonNull;</Highlight></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If &#96;V&#96; is of the form &#96;A ^ ~B&#96; then &#96;~(A ^ ~B)&#96; can be folded</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// into &#96;A ^ B&#96; if we are willing to invert all of the uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a1cacb72e897c55bdfd5c726d13d69af1">m&#95;Xor</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)))) &#123;</Highlight></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BV = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;hasOneUse(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><Highlight kind="normal">                                         DoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</Highlight></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateXor(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, BV) : NonNull;</Highlight></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AV = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;hasOneUse(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><Highlight kind="normal">                                         DoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</Highlight></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateXor(AV, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) : NonNull;</Highlight></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If &#96;V&#96; is of the form &#96;B - A&#96; then &#96;-1 - V&#96; can be folded into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &#96;A + (-1 - B)&#96; if we are willing to invert all of the uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)))) &#123;</Highlight></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AV = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;hasOneUse(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><Highlight kind="normal">                                         DoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</Highlight></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateAdd(AV, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) : NonNull;</Highlight></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If &#96;V&#96; is of the form &#96;(~A) s&gt;&gt; B&#96; then &#96;~((~A) s&gt;&gt; B)&#96; can be folded</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// into &#96;A s&gt;&gt; B&#96; if we are willing to invert all of the uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a0c94f3ca4234f78cf22840e79087f3f2">m&#95;AShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)))) &#123;</Highlight></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AV = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;hasOneUse(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><Highlight kind="normal">                                         DoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</Highlight></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateAShr(AV, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) : NonNull;</Highlight></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>;</Highlight></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// LogicOps are special in that we canonicalize them at the cost of an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcisellowering-cpp/#a5e8a1ef711294cc52d6e2c41279f4c0f">IsSelect</a> = <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))) &amp;&amp;</Highlight></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><Highlight kind="normal">                  !<a href="/docs/api/classes/llvm/instcombiner/#a4ffe5454cf09255ace0804d9c8044004">shouldAvoidAbsorbingNotIntoSelect</a>(&#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(V));</Highlight></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Selects/min/max with invertible operands are freely invertible</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcisellowering-cpp/#a5e8a1ef711294cc52d6e2c41279f4c0f">IsSelect</a> || <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#ad1e2bbf1a8ae559791b42b649d06bbd0">m&#95;MaxOrMin</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)))) &#123;</Highlight></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LocalDoesConsume = DoesConsume;</Highlight></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;hasOneUse(), </Highlight><Highlight kind="comment">/&#42;Builder&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><Highlight kind="normal">                               LocalDoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</Highlight></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;NotA = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;hasOneUse(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><Highlight kind="normal">                                            LocalDoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>)) &#123;</Highlight></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><Highlight kind="normal">      DoesConsume = LocalDoesConsume;</Highlight></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;NotB = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;hasOneUse(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><Highlight kind="normal">                                            DoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</Highlight></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NotB != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> &amp;&amp;</Highlight></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;Unable to build inverted value for known freely invertable op&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(V))</Highlight></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateBinaryIntrinsic(</Highlight></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#a0434306df3aa5ec48fcf19d0958d7c01">getInverseMinMaxIntrinsic</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID()), NotA, NotB);</Highlight></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateSelect(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, NotA, NotB);</Highlight></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NonNull;</Highlight></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LocalDoesConsume = DoesConsume;</Highlight></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;Value &#42;, BasicBlock &#42;&gt;</a>, 8&gt; IncomingValues;</Highlight></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : PN-&gt;operands()) &#123;</Highlight></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IncomingBlock = PN-&gt;getIncomingBlock(U);</Highlight></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewIncomingVal = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(</Highlight></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><Highlight kind="normal">          U.get(), </Highlight><Highlight kind="comment">/&#42;WillInvertAllUses=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><Highlight kind="normal">          </Highlight><Highlight kind="comment">/&#42;Builder=&#42;/</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, LocalDoesConsume, <a href="/docs/api/namespaces/llvm/#a67b491833e9e37c0ff08f1d4cd1bd4f4">MaxAnalysisRecursionDepth</a> - 1);</Highlight></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewIncomingVal == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Make sure that we can safely erase the original PHI node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewIncomingVal == V)</Highlight></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><Highlight kind="normal">        IncomingValues.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(NewIncomingVal, IncomingBlock);</Highlight></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><Highlight kind="normal">    DoesConsume = LocalDoesConsume;</Highlight></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/irbuilderbase/insertpointguard">IRBuilderBase::InsertPointGuard</a> Guard(&#42;<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>);</Highlight></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;SetInsertPoint(PN);</Highlight></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN =</Highlight></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreatePHI(PN-&gt;getType(), PN-&gt;getNumIncomingValues());</Highlight></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;Val, Pred&#93; : IncomingValues)</Highlight></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><Highlight kind="normal">        NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(Val, Pred);</Highlight></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewPN;</Highlight></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NonNull;</Highlight></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a9ffe83e2db4b833b819ee721595c04dc">m&#95;SExtLike</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>)))) &#123;</Highlight></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AV = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;hasOneUse(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><Highlight kind="normal">                                         DoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</Highlight></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateSExt(AV, V-&gt;getType()) : NonNull;</Highlight></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>)))) &#123;</Highlight></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AV = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;hasOneUse(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><Highlight kind="normal">                                         DoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</Highlight></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateTrunc(AV, V-&gt;getType()) : NonNull;</Highlight></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// De Morgan&#39;s Laws:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (~(A | B)) -&gt; (~A &amp; ~B)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (~(A &amp; B)) -&gt; (~A | ~B)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> TryInvertAndOrUsingDeMorgan = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opcode,</Highlight></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><Highlight kind="normal">                                         </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsLogical, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>,</Highlight></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) -&gt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LocalDoesConsume = DoesConsume;</Highlight></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;hasOneUse(), </Highlight><Highlight kind="comment">/&#42;Builder=&#42;/</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><Highlight kind="normal">                               LocalDoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>))</Highlight></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NotA = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;hasOneUse(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><Highlight kind="normal">                                           LocalDoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>)) &#123;</Highlight></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NotB = <a href="/docs/api/classes/llvm/instcombiner/#ab98cb2aaf6e757aac9c471f85f113a50">getFreelyInvertedImpl</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;hasOneUse(), <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>,</Highlight></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><Highlight kind="normal">                                         LocalDoesConsume, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a>);</Highlight></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><Highlight kind="normal">      DoesConsume = LocalDoesConsume;</Highlight></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsLogical)</Highlight></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateLogicalOp(Opcode, NotA, NotB) : NonNull;</Highlight></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a> ? <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>-&gt;CreateBinOp(Opcode, NotA, NotB) : NonNull;</Highlight></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#ae44af1eeb2e5f7a1973a4ab78963a503">m&#95;Or</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))))</Highlight></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TryInvertAndOrUsingDeMorgan(Instruction::And, </Highlight><Highlight kind="comment">/&#42;IsLogical=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>,</Highlight></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><Highlight kind="normal">                                       <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a014d851989a66ce781c4f89dfffb26b5">m&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))))</Highlight></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TryInvertAndOrUsingDeMorgan(Instruction::Or, </Highlight><Highlight kind="comment">/&#42;IsLogical=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>,</Highlight></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><Highlight kind="normal">                                       <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))))</Highlight></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TryInvertAndOrUsingDeMorgan(Instruction::And, </Highlight><Highlight kind="comment">/&#42;IsLogical=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>,</Highlight></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><Highlight kind="normal">                                       <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))))</Highlight></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TryInvertAndOrUsingDeMorgan(Instruction::Or, </Highlight><Highlight kind="comment">/&#42;IsLogical=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>,</Highlight></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><Highlight kind="normal">                                       <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><Highlight kind="comment">/// Return true if we should canonicalize the gep to an i8 ptradd.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763" lineLink="#a48d49b8df95d21ba931f3642c1f5a30d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a48d49b8df95d21ba931f3642c1f5a30d">shouldCanonicalizeGEPToPtrAdd</a>(<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>) &#123;</Highlight></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;PtrOp = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(0);</Highlight></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;GEPEltType = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getSourceElementType();</Highlight></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GEPEltType-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>(8))</Highlight></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Canonicalize scalable GEPs to an explicit offset using the llvm.vscale</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// intrinsic. This has better support in BasicAA.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GEPEltType-&gt;<a href="/docs/api/classes/llvm/type/#a2ff127c9924cd3337080c4445c324aea">isScalableTy</a>())</Highlight></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// gep i32 p, mul(O, C) -&gt; gep i8, p, mul(O, C&#42;4) to fold the two multiplies</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// together.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getNumIndices() == 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1),</Highlight></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a532515120d78196926b68c48460087ab">m&#95;Mul</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>()),</Highlight></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><Highlight kind="normal">                                 <a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>())))))</Highlight></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// gep (gep %p, C1), %x, C2 is expanded so the two constants can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// possibly be merged together.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> PtrOpGep = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GEPOperator&gt;</a>(PtrOp);</Highlight></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> PtrOpGep &amp;&amp; PtrOpGep-&gt;hasAllConstantIndices() &amp;&amp;</Highlight></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><Highlight kind="normal">         <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.indices(), &#91;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><Highlight kind="normal">           const APInt &#42;C;</Highlight></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><Highlight kind="normal">           return match(V, m&#95;APInt(C)) &amp;&amp; !C-&gt;isZero();</Highlight></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><Highlight kind="normal">         &#125;);</Highlight></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792" lineLink="#ad12cb02e2ee53655e834dcb84cd57333"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#ad12cb02e2ee53655e834dcb84cd57333">foldGEPOfPhi</a>(<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN,</Highlight></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><Highlight kind="normal">                                 <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Op1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(PN-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Op1)</Highlight></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t fold a GEP into itself through a PHI node. This can only happen</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// through the back-edge of a loop. Folding a GEP into itself means that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the value of the previous iteration needs to be stored in the meantime,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// thus requiring an additional register variable to be live, but not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// actually achieving anything (the GEP still needs to be executed once per</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loop iteration).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op1 == &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)</Highlight></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/gepnowrapflags">GEPNoWrapFlags</a> NW = Op1-&gt;getNoWrapFlags();</Highlight></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> DI = -1;</Highlight></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = PN-&gt;<a href="/docs/api/classes/llvm/user/#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op&#95;begin</a>()+1, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = PN-&gt;<a href="/docs/api/classes/llvm/user/#af41f58e730804d10b91fcff39b035f74">op&#95;end</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> !=<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Op2 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Op2 || Op1-&gt;getNumOperands() != Op2-&gt;getNumOperands() ||</Highlight></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><Highlight kind="normal">        Op1-&gt;getSourceElementType() != Op2-&gt;getSourceElementType())</Highlight></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// As for Op1 above, don&#39;t try to fold a GEP into itself.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op2 == &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)</Highlight></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Keep track of the type as we walk the GEP.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;CurTy = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> J = 0, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = Op1-&gt;getNumOperands(); J != <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>; ++J) &#123;</Highlight></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op1-&gt;getOperand(J)-&gt;getType() != Op2-&gt;getOperand(J)-&gt;getType())</Highlight></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op1-&gt;getOperand(J) != Op2-&gt;getOperand(J)) &#123;</Highlight></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DI == -1) &#123;</Highlight></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We have not seen any differences yet in the GEPs feeding the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// PHI yet, so we record this one if it is allowed to be a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// variable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// The first two arguments can vary for any GEP, the rest have to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// static for struct slots</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (J &gt; 1) &#123;</Highlight></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurTy &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;No current type?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurTy-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>())</Highlight></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><Highlight kind="normal">          DI = J;</Highlight></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// The GEP is different by more than one input. While this could be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// extended to support GEPs that vary by more than one variable it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// doesn&#39;t make sense since it greatly increases the complexity and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// would result in an R+R+R addressing mode which no backend</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// directly supports and would need to be broken into several</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// simpler instructions anyway.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Sink down a layer of the type for the next iteration.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (J &gt; 0) &#123;</Highlight></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (J == 1) &#123;</Highlight></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><Highlight kind="normal">          CurTy = Op1-&gt;getSourceElementType();</Highlight></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><Highlight kind="normal">          CurTy =</Highlight></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/getelementptrinst/#a056eabb719f475aa4c5a7e2ba11973b9">GetElementPtrInst::getTypeAtIndex</a>(CurTy, Op1-&gt;getOperand(J));</Highlight></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><Highlight kind="normal">    NW &amp;= Op2-&gt;getNoWrapFlags();</Highlight></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If not all GEPs are identical we&#39;ll have to create a new PHI node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check that the old PHI node has only one use so that it will get</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DI != -1 &amp;&amp; !PN-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</Highlight></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewGEP = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GetElementPtrInst&gt;</a>(Op1-&gt;clone());</Highlight></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><Highlight kind="normal">  NewGEP-&gt;setNoWrapFlags(NW);</Highlight></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DI == -1) &#123;</Highlight></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// All the GEPs feeding the PHI are identical. Clone one down into our</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// BB so that it can be merged with the current GEP.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// All the GEPs feeding the PHI differ at a single offset. Clone a GEP</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// into the current block so it can be merged, and create a new PHI to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// set that index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN;</Highlight></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><Highlight kind="normal">    &#123;</Highlight></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/irbuilderbase/insertpointguard">IRBuilderBase::InsertPointGuard</a> Guard(Builder);</Highlight></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(PN);</Highlight></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><Highlight kind="normal">      NewPN = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(Op1-&gt;getOperand(DI)-&gt;getType(),</Highlight></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><Highlight kind="normal">                                PN-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>());</Highlight></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : PN-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>())</Highlight></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><Highlight kind="normal">      NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getOperand(DI),</Highlight></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><Highlight kind="normal">                         PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><Highlight kind="normal">    NewGEP-&gt;setOperand(DI, NewPN);</Highlight></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><Highlight kind="normal">  NewGEP-&gt;insertBefore(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getParent(), <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getParent()-&gt;getFirstInsertionPt());</Highlight></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewGEP;</Highlight></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902" lineLink="/docs/api/classes/llvm/instcombinerimpl/#ae755d569b6e5c69a8abbc6de50cf3f6b"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#ae755d569b6e5c69a8abbc6de50cf3f6b">InstCombinerImpl::visitGetElementPtrInst</a>(<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>) &#123;</Highlight></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;PtrOp = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(0);</Highlight></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 8&gt;</a> Indices(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.indices());</Highlight></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;GEPType = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getType();</Highlight></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;GEPEltType = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getSourceElementType();</Highlight></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V =</Highlight></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a0f010abd897957459c535649fa702c98">simplifyGEPInst</a>(GEPEltType, PtrOp, Indices, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getNoWrapFlags(),</Highlight></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><Highlight kind="normal">                          <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)))</Highlight></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, V);</Highlight></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For vector geps, use the generic demanded vector support.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Skip if GEP return type is scalable. The number of elements is unknown at</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// compile-time.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;GEPFVTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FixedVectorType&gt;</a>(GEPType)) &#123;</Highlight></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> VWidth = GEPFVTy-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/apint">APInt</a> PoisonElts(VWidth, 0);</Highlight></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/apint">APInt</a> AllOnesEltMask(<a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VWidth));</Highlight></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/classes/llvm/instcombinerimpl/#a37cce7aa1875173688e5971c5d6fa9e0">SimplifyDemandedVectorElts</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, AllOnesEltMask,</Highlight></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><Highlight kind="normal">                                              PoisonElts)) &#123;</Highlight></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V != &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)</Highlight></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, V);</Highlight></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>;</Highlight></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: 1) Scalarize splat operands, 2) scalarize entire instruction if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// possible (decide on canonical form for pointer broadcast), 3) exploit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// undef elements to decrease demanded bits</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Eliminate unneeded casts for indices, and replace indices which displace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// by multiples of a zero size type with zero.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Index width may not be the same width as pointer width.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Data layout chooses the right type based on supported integer types.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;NewScalarIndexTy =</Highlight></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getIndexType(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getPointerOperandType()-&gt;getScalarType());</Highlight></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a81c0916829c13ba5279ca0e5480aef0c">gep&#95;type&#95;iterator</a> GTI = <a href="/docs/api/namespaces/llvm/#ac828b9b52935f87659a4adf237f820a3">gep&#95;type&#95;begin</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</Highlight></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user/#a0126e6f10273e8db07142833979a0c8f">User::op&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.op&#95;begin() + 1, E = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.op&#95;end(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;</Highlight></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><Highlight kind="normal">       ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ++GTI) &#123;</Highlight></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip indices into struct types.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GTI.<a href="/docs/api/classes/llvm/generic-gep-type-iterator/#a9c393ed0a6b446c52d205a562ac8d544">isStruct</a>())</Highlight></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;IndexTy = (&#42;I)-&gt;getType();</Highlight></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;NewIndexType =</Highlight></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><Highlight kind="normal">        IndexTy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>()</Highlight></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><Highlight kind="normal">            ? <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(NewScalarIndexTy,</Highlight></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><Highlight kind="normal">                              <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(IndexTy)-&gt;getElementCount())</Highlight></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><Highlight kind="normal">            : NewScalarIndexTy;</Highlight></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the element type has zero size then any index over it is equivalent</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to an index of zero, so replace it with zero if it is not zero already.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;EltTy = GTI.<a href="/docs/api/classes/llvm/generic-gep-type-iterator/#af429d12fd67c390e17272e9b16ce9186">getIndexedType</a>();</Highlight></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EltTy-&gt;<a href="/docs/api/classes/llvm/type/#a8ad67a33bae235fe3cca1c3e5a91ed2d">isSized</a>() &amp;&amp; <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getTypeAllocSize(EltTy).isZero())</Highlight></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;get(), <a href="/docs/api/namespaces/llvm/patternmatch/#ae77be336e228cf9aa00709a8606dfb98">m&#95;Zero</a>())) &#123;</Highlight></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><Highlight kind="normal">        &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(NewIndexType);</Highlight></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><Highlight kind="normal">        MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IndexTy != NewIndexType) &#123;</Highlight></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we are using a wider index than needed for this platform, shrink</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// it to what we need.  If narrower, sign-extend it to what we need.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This explicit cast can make subsequent optimizations more obvious.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><Highlight kind="normal">      &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateIntCast(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, NewIndexType, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><Highlight kind="normal">      MadeChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MadeChange)</Highlight></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>;</Highlight></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Canonicalize constant GEPs to i8 type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GEPEltType-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>(8) &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.hasAllConstantIndices()) &#123;</Highlight></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(<a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getIndexTypeSizeInBits(GEPType), 0);</Highlight></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.accumulateConstantOffset(<a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>))</Highlight></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(</Highlight></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreatePtrAdd(PtrOp, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.getInt(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>), </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"><Highlight kind="normal">                                    <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getNoWrapFlags()));</Highlight></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a48d49b8df95d21ba931f3642c1f5a30d">shouldCanonicalizeGEPToPtrAdd</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>)) &#123;</Highlight></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = EmitGEPOffset(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GEPOperator&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>));</Highlight></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewGEP =</Highlight></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreatePtrAdd(PtrOp, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getNoWrapFlags());</Highlight></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, NewGEP);</Highlight></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check to see if the inputs to the PHI node are getelementptr instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(PtrOp)) &#123;</Highlight></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;NewPtrOp = <a href="#ad12cb02e2ee53655e834dcb84cd57333">foldGEPOfPhi</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, PN, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</Highlight></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, 0, NewPtrOp);</Highlight></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Src = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GEPOperator&gt;</a>(PtrOp))</Highlight></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombinerimpl/#a22bc54f319e33d248b169116b757a143">visitGEPOfGEP</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, Src))</Highlight></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getNumIndices() == 1) &#123;</Highlight></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getPointerAddressSpace();</Highlight></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1)-&gt;getType()-&gt;getScalarSizeInBits() ==</Highlight></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getIndexSizeInBits(AS)) &#123;</Highlight></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><Highlight kind="normal">      uint64&#95;t TyAllocSize = <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getTypeAllocSize(GEPEltType).getFixedValue();</Highlight></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TyAllocSize == 1) &#123;</Highlight></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Canonicalize (gep i8&#42; X, (ptrtoint Y)-(ptrtoint X)) to (bitcast Y),</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// but only if the result pointer is only used as if it were an integer,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// or both point to the same underlying object (otherwise provenance is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// not necessarily retained).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getPointerOperand();</Highlight></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1),</Highlight></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><Highlight kind="normal">                  <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#af15a15d65884a305e9eec3b690eb37f3">m&#95;PtrToInt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>)), <a href="/docs/api/namespaces/llvm/patternmatch/#af15a15d65884a305e9eec3b690eb37f3">m&#95;PtrToInt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)))) &amp;&amp;</Highlight></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><Highlight kind="normal">            GEPType == <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType()) &#123;</Highlight></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><Highlight kind="normal">          </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasSameUnderlyingObject =</Highlight></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>) == <a href="/docs/api/namespaces/llvm/#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><Highlight kind="normal">          </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.replaceUsesWithIf(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) &#123;</Highlight></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"><Highlight kind="normal">            </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ShouldReplace = HasSameUnderlyingObject ||</Highlight></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><Highlight kind="normal">                                 <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ICmpInst&gt;</a>(U.getUser()) ||</Highlight></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><Highlight kind="normal">                                 <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PtrToIntInst&gt;</a>(U.getUser());</Highlight></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><Highlight kind="normal">            <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= ShouldReplace;</Highlight></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ShouldReplace;</Highlight></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><Highlight kind="normal">          &#125;);</Highlight></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> ? &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExactIns =</Highlight></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><Highlight kind="normal">                     <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PossiblyExactOperator&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1))) &#123;</Highlight></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Canonicalize (gep T&#42; X, V / sizeof(T)) to (gep i8&#42; X, V)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;V;</Highlight></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExactIns-&gt;isExact()) &#123;</Highlight></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((<a href="/docs/api/namespaces/llvm/#a617c1c04cfa1325ad04eb69339d92188">has&#95;single&#95;bit</a>(TyAllocSize) &amp;&amp;</Highlight></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1),</Highlight></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><Highlight kind="normal">                     <a href="/docs/api/namespaces/llvm/patternmatch/#a310fbeb4d6c1b137dfd8713d354f3d76">m&#95;Shr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V),</Highlight></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><Highlight kind="normal">                           <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(<a href="/docs/api/namespaces/llvm/#a57d2f9ee99e9e68cff564d0d579c8163">countr&#95;zero</a>(TyAllocSize))))) ||</Highlight></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1),</Highlight></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><Highlight kind="normal">                    <a href="/docs/api/namespaces/llvm/patternmatch/#a25e68280ed348917cd4b8657cac2be84">m&#95;IDiv</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(TyAllocSize)))) &#123;</Highlight></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/getelementptrinst/#a7e5d474f9fda4b2b2e5de3dcfefcc472">GetElementPtrInst::Create</a>(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.getInt8Ty(),</Highlight></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><Highlight kind="normal">                                             <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getPointerOperand(), V,</Highlight></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><Highlight kind="normal">                                             <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getNoWrapFlags());</Highlight></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExactIns-&gt;isExact() &amp;&amp; ExactIns-&gt;hasOneUse()) &#123;</Highlight></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Try to canonicalize non-i8 element type to i8 if the index is an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// exact instruction. If the index is an exact instruction (div/shr)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// with a constant RHS, we can fold the non-i8 element scale into the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// div/shr (similiar to the mul case, just inverted).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><Highlight kind="normal">          std::optional&lt;APInt&gt; NewC;</Highlight></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a617c1c04cfa1325ad04eb69339d92188">has&#95;single&#95;bit</a>(TyAllocSize) &amp;&amp;</Highlight></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ExactIns, <a href="/docs/api/namespaces/llvm/patternmatch/#a310fbeb4d6c1b137dfd8713d354f3d76">m&#95;Shr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))) &amp;&amp;</Highlight></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;uge(<a href="/docs/api/namespaces/llvm/#a57d2f9ee99e9e68cff564d0d579c8163">countr&#95;zero</a>(TyAllocSize)))</Highlight></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"><Highlight kind="normal">            NewC = &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> - <a href="/docs/api/namespaces/llvm/#a57d2f9ee99e9e68cff564d0d579c8163">countr&#95;zero</a>(TyAllocSize);</Highlight></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ExactIns, <a href="/docs/api/namespaces/llvm/patternmatch/#a719c774934ac66be45cc09cef392cf65">m&#95;UDiv</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)))) &#123;</Highlight></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/apint">APInt</a> Quot;</Highlight></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057"><Highlight kind="normal">            uint64&#95;t Rem;</Highlight></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/apint/#a0f0a665210e453bb16b4bf1861dbdd58">APInt::udivrem</a>(&#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, TyAllocSize, Quot, Rem);</Highlight></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Rem == 0)</Highlight></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060"><Highlight kind="normal">              NewC = Quot;</Highlight></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"><Highlight kind="normal">          &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ExactIns, <a href="/docs/api/namespaces/llvm/patternmatch/#aa288295c57b0d3adeed48f9ed452701e">m&#95;SDiv</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(V), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)))) &#123;</Highlight></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/apint">APInt</a> Quot;</Highlight></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063"><Highlight kind="normal">            int64&#95;t Rem;</Highlight></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/apint/#a24187c2e178af0df22dac26cd5229294">APInt::sdivrem</a>(&#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, TyAllocSize, Quot, Rem);</Highlight></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// For sdiv we need to make sure we arent creating INT&#95;MIN / -1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Quot.<a href="/docs/api/classes/llvm/apint/#a423e2c491de1408d54e35f0b47d076be">isAllOnes</a>() &amp;&amp; Rem == 0)</Highlight></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067"><Highlight kind="normal">              NewC = Quot;</Highlight></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewC.has&#95;value()) &#123;</Highlight></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewOp = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateBinOp(</Highlight></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072"><Highlight kind="normal">                </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a></Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(ExactIns-&gt;getOpcode()), V,</Highlight></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"><Highlight kind="normal">                ConstantInt::get(V-&gt;getType(), &#42;NewC));</Highlight></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(NewOp)-&gt;setIsExact();</Highlight></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/getelementptrinst/#a7e5d474f9fda4b2b2e5de3dcfefcc472">GetElementPtrInst::Create</a>(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.getInt8Ty(),</Highlight></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"><Highlight kind="normal">                                             <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getPointerOperand(), NewOp,</Highlight></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><Highlight kind="normal">                                             <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getNoWrapFlags());</Highlight></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We do not handle pointer-vector geps here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GEPType-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>())</Highlight></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getNumIndices() == 1) &#123;</Highlight></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We can only preserve inbounds if the original gep is inbounds, the add</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is nsw, and the add operands are non-negative.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CanPreserveInBounds = &#91;&amp;&#93;(</Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AddIsNSW, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Idx1, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Idx2) &#123;</Highlight></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/simplifyquery">SimplifyQuery</a> Q = <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</Highlight></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.isInBounds() &amp;&amp; AddIsNSW &amp;&amp; <a href="/docs/api/namespaces/llvm/#ae7f4b5fbc0aa5c8204b9a4b06e070d75">isKnownNonNegative</a>(Idx1, Q) &amp;&amp;</Highlight></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/#ae7f4b5fbc0aa5c8204b9a4b06e070d75">isKnownNonNegative</a>(Idx2, Q);</Highlight></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Try to replace ADD + GEP with GEP + GEP.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Idx1, &#42;Idx2;</Highlight></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1),</Highlight></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Idx1), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Idx2))))) &#123;</Highlight></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %idx = add i64 %idx1, %idx2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %gep = getelementptr i32, ptr %ptr, i64 %idx</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// as:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %newptr = getelementptr i32, ptr %ptr, i64 %idx1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   %newgep = getelementptr i32, ptr %newptr, i64 %idx2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsInBounds = CanPreserveInBounds(</Highlight></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;OverflowingBinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1))-&gt;hasNoSignedWrap(),</Highlight></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"><Highlight kind="normal">          Idx1, Idx2);</Highlight></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewPtr =</Highlight></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateGEP(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getSourceElementType(), <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getPointerOperand(),</Highlight></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><Highlight kind="normal">                            Idx1, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, IsInBounds);</Highlight></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(</Highlight></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateGEP(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getSourceElementType(), NewPtr, Idx2, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><Highlight kind="normal">                                 IsInBounds));</Highlight></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a9ffe83e2db4b833b819ee721595c04dc">m&#95;SExtLike</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ab65bddcf2ef369ad6d5678882800a7da">m&#95;NSWAdd</a>(</Highlight></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><Highlight kind="normal">                                     <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Idx1), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))))))) &#123;</Highlight></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %add = add nsw i32 %idx1, idx2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %sidx = sext i32 %add to i64</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %gep = getelementptr i32, ptr %ptr, i64 %sidx</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// as:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %newptr = getelementptr i32, ptr %ptr, i32 %idx1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %newgep = getelementptr i32, ptr %newptr, i32 idx2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsInBounds = CanPreserveInBounds(</Highlight></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"><Highlight kind="normal">          </Highlight><Highlight kind="comment">/&#42;IsNSW=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, Idx1, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewPtr = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateGEP(</Highlight></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getSourceElementType(), <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getPointerOperand(),</Highlight></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateSExt(Idx1, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1)-&gt;getType()), </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><Highlight kind="normal">          IsInBounds);</Highlight></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(</Highlight></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</Highlight></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateGEP(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getSourceElementType(), NewPtr,</Highlight></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateSExt(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getOperand(1)-&gt;getType()),</Highlight></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><Highlight kind="normal">                            </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, IsInBounds));</Highlight></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.isInBounds()) &#123;</Highlight></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IdxWidth =</Highlight></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>.getIndexSizeInBits(PtrOp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>());</Highlight></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/apint">APInt</a> BasePtrOffset(IdxWidth, 0);</Highlight></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;UnderlyingPtrOp =</Highlight></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"><Highlight kind="normal">            PtrOp-&gt;<a href="/docs/api/classes/llvm/value/#a14f27b1cef50a1f887650a8c79dbb436">stripAndAccumulateInBoundsConstantOffsets</a>(<a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>,</Highlight></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><Highlight kind="normal">                                                             BasePtrOffset);</Highlight></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CanBeNull, CanBeFreed;</Highlight></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"><Highlight kind="normal">    uint64&#95;t DerefBytes = UnderlyingPtrOp-&gt;<a href="/docs/api/classes/llvm/value/#acfdc7354dccb27bc092d9ac8c92b76c7">getPointerDereferenceableBytes</a>(</Highlight></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>, CanBeNull, CanBeFreed);</Highlight></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CanBeNull &amp;&amp; !CanBeFreed &amp;&amp; DerefBytes != 0) &#123;</Highlight></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.accumulateConstantOffset(<a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>, BasePtrOffset) &amp;&amp;</Highlight></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"><Highlight kind="normal">          BasePtrOffset.<a href="/docs/api/classes/llvm/apint/#ac8c0157adbe12649beac0009c2f6ad8d">isNonNegative</a>()) &#123;</Highlight></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/apint">APInt</a> AllocSize(IdxWidth, DerefBytes);</Highlight></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BasePtrOffset.<a href="/docs/api/classes/llvm/apint/#aca14d9ec64ba4ab7fb2cef37c57d9ce4">ule</a>(AllocSize)) &#123;</Highlight></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/getelementptrinst/#aa1d295f380f20e10c5554de9307b681a">GetElementPtrInst::CreateInBounds</a>(</Highlight></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><Highlight kind="normal">              <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getSourceElementType(), PtrOp, Indices, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getName());</Highlight></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// nusw + nneg -&gt; nuw</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.hasNoUnsignedSignedWrap() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.hasNoUnsignedWrap() &amp;&amp;</Highlight></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.indices(), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Idx) &#123;</Highlight></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"><Highlight kind="normal">        return isKnownNonNegative(Idx, SQ.getWithInstruction(&amp;GEP));</Highlight></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"><Highlight kind="normal">      &#125;)) &#123;</Highlight></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.setNoWrapFlags(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>.getNoWrapFlags() | <a href="/docs/api/classes/llvm/gepnowrapflags/#a5bfde791508b16caf8509e95a8fdf7b9">GEPNoWrapFlags::noUnsignedWrap</a>());</Highlight></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>;</Highlight></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;R = <a href="#a16a66955e366f83c6e35d99511a33167">foldSelectGEP</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>))</Highlight></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> R;</Highlight></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175" lineLink="#a04d581f6b1ca4d25c0c0a7e97404151c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a04d581f6b1ca4d25c0c0a7e97404151c">isNeverEqualToUnescapedAlloc</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;TLI,</Highlight></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;AI) &#123;</Highlight></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(V))</Highlight></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(V))</Highlight></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GlobalVariable&gt;</a>(LI-&gt;getPointerOperand());</Highlight></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Two distinct allocations will never be equal.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a56641197c50e1c7a9558446d14deadb3">isAllocLikeFn</a>(V, &amp;TLI) &amp;&amp; V != AI;</Highlight></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"><Highlight kind="comment">/// Given a call CB which uses an address UsedV, return true if we can prove the</Highlight></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"><Highlight kind="comment">/// call&#39;s only possible effect is storing to V.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187" lineLink="#abbd47852a13b73290f4625f20c9018d8"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#abbd47852a13b73290f4625f20c9018d8">isRemovableWrite</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &amp;CB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;UsedV,</Highlight></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188"><Highlight kind="normal">                             </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;TLI) &#123;</Highlight></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CB.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</Highlight></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: add recursion if returned attribute is present</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB.<a href="/docs/api/classes/llvm/instruction/#a7653277511df1034148a37520a585bb5">isTerminator</a>())</Highlight></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: remove implementation restriction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CB.<a href="/docs/api/classes/llvm/instruction/#aa03e017ef451ba2f6f504b0d40c2da2e">willReturn</a>() || !CB.<a href="/docs/api/classes/llvm/callbase/#aa87fae97a8c702741eca5a95748af49d">doesNotThrow</a>())</Highlight></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the only possible side effect of the call is writing to the alloca,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and the result isn&#39;t used, we can safely remove any reads implied by the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// call including those which might read the alloca itself.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"><Highlight kind="normal">  std::optional&lt;MemoryLocation&gt; Dest = <a href="/docs/api/classes/llvm/memorylocation/#ac8f8983c6b76d0e30f22fff86b281f16">MemoryLocation::getForDest</a>(&amp;CB, TLI);</Highlight></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Dest &amp;&amp; Dest-&gt;Ptr == UsedV;</Highlight></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207" lineLink="#a5d94ee8aaee00c42c11954aaa6022894"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a5d94ee8aaee00c42c11954aaa6022894">isAllocSiteRemovable</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;AI,</Highlight></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"><Highlight kind="normal">                                 <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>,</Highlight></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"><Highlight kind="normal">                                 </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;TLI) &#123;</Highlight></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction&#42;, 4&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l03211" /><CodeLine lineNumber="3211"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::optional&lt;StringRef&gt; Family = <a href="/docs/api/namespaces/llvm/#a291c4451c91c4aaee65308741793626a">getAllocationFamily</a>(AI, &amp;TLI);</Highlight></CodeLine>
<Link id="l03212" /><CodeLine lineNumber="3212"><Highlight kind="normal">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(AI);</Highlight></CodeLine>
<Link id="l03213" /><CodeLine lineNumber="3213"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03214" /><CodeLine lineNumber="3214"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">do</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03215" /><CodeLine lineNumber="3215"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PI = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l03216" /><CodeLine lineNumber="3216"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : PI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l03217" /><CodeLine lineNumber="3217"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l03218" /><CodeLine lineNumber="3218"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l03219" /><CodeLine lineNumber="3219"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l03220" /><CodeLine lineNumber="3220"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Give up the moment we see something we can&#39;t handle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03221" /><CodeLine lineNumber="3221"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03222" /><CodeLine lineNumber="3222"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03223" /><CodeLine lineNumber="3223"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::AddrSpaceCast:</Highlight></CodeLine>
<Link id="l03224" /><CodeLine lineNumber="3224"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::BitCast:</Highlight></CodeLine>
<Link id="l03225" /><CodeLine lineNumber="3225"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::GetElementPtr:</Highlight></CodeLine>
<Link id="l03226" /><CodeLine lineNumber="3226"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.emplace&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03227" /><CodeLine lineNumber="3227"><Highlight kind="normal">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03228" /><CodeLine lineNumber="3228"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03229" /><CodeLine lineNumber="3229"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03230" /><CodeLine lineNumber="3230"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ICmp: &#123;</Highlight></CodeLine>
<Link id="l03231" /><CodeLine lineNumber="3231"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03232" /><CodeLine lineNumber="3232"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We can fold eq/ne comparisons with null to false/true, respectively.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03233" /><CodeLine lineNumber="3233"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We also fold comparisons in some conditions provided the alloc has</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03234" /><CodeLine lineNumber="3234"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// not escaped (see isNeverEqualToUnescapedAlloc).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03235" /><CodeLine lineNumber="3235"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ICI-&gt;<a href="/docs/api/classes/llvm/icmpinst/#abe8988eef2e6fc2baba032cb22afedd7">isEquality</a>())</Highlight></CodeLine>
<Link id="l03236" /><CodeLine lineNumber="3236"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03237" /><CodeLine lineNumber="3237"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OtherIndex = (ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == PI) ? 1 : 0;</Highlight></CodeLine>
<Link id="l03238" /><CodeLine lineNumber="3238"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a04d581f6b1ca4d25c0c0a7e97404151c">isNeverEqualToUnescapedAlloc</a>(ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(OtherIndex), TLI, AI))</Highlight></CodeLine>
<Link id="l03239" /><CodeLine lineNumber="3239"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03240" /><CodeLine lineNumber="3240"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03241" /><CodeLine lineNumber="3241"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Do not fold compares to aligned&#95;alloc calls, as they may have to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03242" /><CodeLine lineNumber="3242"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// return null in case the required alignment cannot be satisfied,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03243" /><CodeLine lineNumber="3243"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// unless we can prove that both alignment and size are valid.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03244" /><CodeLine lineNumber="3244"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AlignmentAndSizeKnownValid = &#91;&#93;(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CB) &#123;</Highlight></CodeLine>
<Link id="l03245" /><CodeLine lineNumber="3245"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Check if alignment and size of a call to aligned&#95;alloc is valid,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03246" /><CodeLine lineNumber="3246"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// that is alignment is a power-of-2 and the size is a multiple of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03247" /><CodeLine lineNumber="3247"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// alignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03248" /><CodeLine lineNumber="3248"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;Alignment;</Highlight></CodeLine>
<Link id="l03249" /><CodeLine lineNumber="3249"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</Highlight></CodeLine>
<Link id="l03250" /><CodeLine lineNumber="3250"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(CB-&gt;getArgOperand(0), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(Alignment)) &amp;&amp;</Highlight></CodeLine>
<Link id="l03251" /><CodeLine lineNumber="3251"><Highlight kind="normal">                 <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(CB-&gt;getArgOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>)) &amp;&amp;</Highlight></CodeLine>
<Link id="l03252" /><CodeLine lineNumber="3252"><Highlight kind="normal">                 Alignment-&gt;<a href="/docs/api/classes/llvm/apint/#ad1b0513de876d1c85cf6268ca21b2c86">isPowerOf2</a>() &amp;&amp; <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>-&gt;urem(&#42;Alignment).isZero();</Highlight></CodeLine>
<Link id="l03253" /><CodeLine lineNumber="3253"><Highlight kind="normal">        &#125;;</Highlight></CodeLine>
<Link id="l03254" /><CodeLine lineNumber="3254"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(AI);</Highlight></CodeLine>
<Link id="l03255" /><CodeLine lineNumber="3255"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a26a5e408fc09c5664d2bbb2d7fae154e">LibFunc</a> TheLibFunc;</Highlight></CodeLine>
<Link id="l03256" /><CodeLine lineNumber="3256"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB &amp;&amp; TLI.<a href="/docs/api/classes/llvm/targetlibraryinfo/#a97cfbbed8869e3582142012a071a9052">getLibFunc</a>(&#42;CB-&gt;getCalledFunction(), TheLibFunc) &amp;&amp;</Highlight></CodeLine>
<Link id="l03257" /><CodeLine lineNumber="3257"><Highlight kind="normal">            TLI.<a href="/docs/api/classes/llvm/targetlibraryinfo/#a54699e3f128acda6003afc11d3027f6c">has</a>(TheLibFunc) &amp;&amp; TheLibFunc == LibFunc&#95;aligned&#95;alloc &amp;&amp;</Highlight></CodeLine>
<Link id="l03258" /><CodeLine lineNumber="3258"><Highlight kind="normal">            !AlignmentAndSizeKnownValid(CB))</Highlight></CodeLine>
<Link id="l03259" /><CodeLine lineNumber="3259"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03260" /><CodeLine lineNumber="3260"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.emplace&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03261" /><CodeLine lineNumber="3261"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03262" /><CodeLine lineNumber="3262"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03263" /><CodeLine lineNumber="3263"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03264" /><CodeLine lineNumber="3264"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Call:</Highlight></CodeLine>
<Link id="l03265" /><CodeLine lineNumber="3265"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Ignore no-op and store intrinsics.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03266" /><CodeLine lineNumber="3266"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03267" /><CodeLine lineNumber="3267"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID()) &#123;</Highlight></CodeLine>
<Link id="l03268" /><CodeLine lineNumber="3268"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l03269" /><CodeLine lineNumber="3269"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03270" /><CodeLine lineNumber="3270"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03271" /><CodeLine lineNumber="3271"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::memmove:</Highlight></CodeLine>
<Link id="l03272" /><CodeLine lineNumber="3272"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::memcpy:</Highlight></CodeLine>
<Link id="l03273" /><CodeLine lineNumber="3273"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::memset: &#123;</Highlight></CodeLine>
<Link id="l03274" /><CodeLine lineNumber="3274"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/memintrinsic">MemIntrinsic</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MemIntrinsic&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l03275" /><CodeLine lineNumber="3275"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;isVolatile() || <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getRawDest() != PI)</Highlight></CodeLine>
<Link id="l03276" /><CodeLine lineNumber="3276"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03277" /><CodeLine lineNumber="3277"><Highlight kind="normal">            &#91;&#91;fallthrough&#93;&#93;;</Highlight></CodeLine>
<Link id="l03278" /><CodeLine lineNumber="3278"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l03279" /><CodeLine lineNumber="3279"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::assume:</Highlight></CodeLine>
<Link id="l03280" /><CodeLine lineNumber="3280"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::invariant&#95;start:</Highlight></CodeLine>
<Link id="l03281" /><CodeLine lineNumber="3281"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::invariant&#95;end:</Highlight></CodeLine>
<Link id="l03282" /><CodeLine lineNumber="3282"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::lifetime&#95;start:</Highlight></CodeLine>
<Link id="l03283" /><CodeLine lineNumber="3283"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::lifetime&#95;end:</Highlight></CodeLine>
<Link id="l03284" /><CodeLine lineNumber="3284"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::objectsize:</Highlight></CodeLine>
<Link id="l03285" /><CodeLine lineNumber="3285"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.emplace&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03286" /><CodeLine lineNumber="3286"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03287" /><CodeLine lineNumber="3287"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::launder&#95;invariant&#95;group:</Highlight></CodeLine>
<Link id="l03288" /><CodeLine lineNumber="3288"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::strip&#95;invariant&#95;group:</Highlight></CodeLine>
<Link id="l03289" /><CodeLine lineNumber="3289"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.emplace&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03290" /><CodeLine lineNumber="3290"><Highlight kind="normal">            Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03291" /><CodeLine lineNumber="3291"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03292" /><CodeLine lineNumber="3292"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l03293" /><CodeLine lineNumber="3293"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03294" /><CodeLine lineNumber="3294"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03295" /><CodeLine lineNumber="3295"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#abbd47852a13b73290f4625f20c9018d8">isRemovableWrite</a>(&#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), PI, TLI)) &#123;</Highlight></CodeLine>
<Link id="l03296" /><CodeLine lineNumber="3296"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.emplace&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03297" /><CodeLine lineNumber="3297"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03298" /><CodeLine lineNumber="3298"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03299" /><CodeLine lineNumber="3299"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03300" /><CodeLine lineNumber="3300"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ab9cb77a3069c227792d6bade6faff422">getFreedOperand</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), &amp;TLI) == PI &amp;&amp;</Highlight></CodeLine>
<Link id="l03301" /><CodeLine lineNumber="3301"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a291c4451c91c4aaee65308741793626a">getAllocationFamily</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &amp;TLI) == Family) &#123;</Highlight></CodeLine>
<Link id="l03302" /><CodeLine lineNumber="3302"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Family);</Highlight></CodeLine>
<Link id="l03303" /><CodeLine lineNumber="3303"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.emplace&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03304" /><CodeLine lineNumber="3304"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03305" /><CodeLine lineNumber="3305"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03306" /><CodeLine lineNumber="3306"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03307" /><CodeLine lineNumber="3307"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a4ff10451ba01dc08fc0d38983c6743b7">getReallocatedOperand</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) == PI &amp;&amp;</Highlight></CodeLine>
<Link id="l03308" /><CodeLine lineNumber="3308"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a291c4451c91c4aaee65308741793626a">getAllocationFamily</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &amp;TLI) == Family) &#123;</Highlight></CodeLine>
<Link id="l03309" /><CodeLine lineNumber="3309"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Family);</Highlight></CodeLine>
<Link id="l03310" /><CodeLine lineNumber="3310"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.emplace&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03311" /><CodeLine lineNumber="3311"><Highlight kind="normal">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03312" /><CodeLine lineNumber="3312"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03313" /><CodeLine lineNumber="3313"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03314" /><CodeLine lineNumber="3314"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03315" /><CodeLine lineNumber="3315"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03316" /><CodeLine lineNumber="3316"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03317" /><CodeLine lineNumber="3317"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Store: &#123;</Highlight></CodeLine>
<Link id="l03318" /><CodeLine lineNumber="3318"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03319" /><CodeLine lineNumber="3319"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isVolatile() || <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand() != PI)</Highlight></CodeLine>
<Link id="l03320" /><CodeLine lineNumber="3320"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03321" /><CodeLine lineNumber="3321"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.emplace&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03322" /><CodeLine lineNumber="3322"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03323" /><CodeLine lineNumber="3323"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03324" /><CodeLine lineNumber="3324"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03325" /><CodeLine lineNumber="3325"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;missing a return?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03326" /><CodeLine lineNumber="3326"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03327" /><CodeLine lineNumber="3327"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>());</Highlight></CodeLine>
<Link id="l03328" /><CodeLine lineNumber="3328"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03329" /><CodeLine lineNumber="3329"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03330" /><CodeLine lineNumber="3330"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03331" /><CodeLine lineNumber="3331" lineLink="/docs/api/classes/llvm/instcombinerimpl/#ae289e620828eabb1dfe34c9ad322a81d"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#ae289e620828eabb1dfe34c9ad322a81d">InstCombinerImpl::visitAllocSite</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</Highlight></CodeLine>
<Link id="l03332" /><CodeLine lineNumber="3332"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) || <a href="/docs/api/namespaces/llvm/#a2787d1134842ab0b9be8694d95ccbdd7">isRemovableAlloc</a>(&amp;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>), &amp;<a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>));</Highlight></CodeLine>
<Link id="l03333" /><CodeLine lineNumber="3333"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03334" /><CodeLine lineNumber="3334"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have a malloc call which is only used in any amount of comparisons to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03335" /><CodeLine lineNumber="3335"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// null and free calls, delete the calls and replace the comparisons with true</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03336" /><CodeLine lineNumber="3336"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// or false as appropriate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03337" /><CodeLine lineNumber="3337"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03338" /><CodeLine lineNumber="3338"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is based on the principle that we can substitute our own allocation</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03339" /><CodeLine lineNumber="3339"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// function (which will never return null) rather than knowledge of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03340" /><CodeLine lineNumber="3340"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// specific function being called. In some sense this can change the permitted</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03341" /><CodeLine lineNumber="3341"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// outputs of a program (when we convert a malloc to an alloca, the fact that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03342" /><CodeLine lineNumber="3342"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the allocation is now on the stack is potentially visible, for example),</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03343" /><CodeLine lineNumber="3343"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// but we believe in a permissible manner.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03344" /><CodeLine lineNumber="3344"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WeakTrackingVH, 64&gt;</a> <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>;</Highlight></CodeLine>
<Link id="l03345" /><CodeLine lineNumber="3345"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03346" /><CodeLine lineNumber="3346"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we are removing an alloca with a dbg.declare, insert dbg.value calls</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03347" /><CodeLine lineNumber="3347"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// before each store.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03348" /><CodeLine lineNumber="3348"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableIntrinsic &#42;, 8&gt;</a> DVIs;</Highlight></CodeLine>
<Link id="l03349" /><CodeLine lineNumber="3349"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;, 8&gt;</a> DVRs;</Highlight></CodeLine>
<Link id="l03350" /><CodeLine lineNumber="3350"><Highlight kind="normal">  std::unique&#95;ptr&lt;DIBuilder&gt; DIB;</Highlight></CodeLine>
<Link id="l03351" /><CodeLine lineNumber="3351"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) &#123;</Highlight></CodeLine>
<Link id="l03352" /><CodeLine lineNumber="3352"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a26bad0f6e5435a5a4dc50850c5b8f628">findDbgUsers</a>(DVIs, &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, &amp;DVRs);</Highlight></CodeLine>
<Link id="l03353" /><CodeLine lineNumber="3353"><Highlight kind="normal">    DIB.reset(</Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a>(&#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getModule(), </Highlight><Highlight kind="comment">/&#42;AllowUnresolved=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l03354" /><CodeLine lineNumber="3354"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03355" /><CodeLine lineNumber="3355"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03356" /><CodeLine lineNumber="3356"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a5d94ee8aaee00c42c11954aaa6022894">isAllocSiteRemovable</a>(&amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>, <a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>)) &#123;</Highlight></CodeLine>
<Link id="l03357" /><CodeLine lineNumber="3357"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.size(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l03358" /><CodeLine lineNumber="3358"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Lowering all @llvm.objectsize calls first because they may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03359" /><CodeLine lineNumber="3359"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// use a bitcast/GEP of the alloca we are removing.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03360" /><CodeLine lineNumber="3360"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>&#91;i&#93;)</Highlight></CodeLine>
<Link id="l03361" /><CodeLine lineNumber="3361"><Highlight kind="normal">       </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03362" /><CodeLine lineNumber="3362"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03363" /><CodeLine lineNumber="3363"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&amp;&#42;<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>&#91;i&#93;);</Highlight></CodeLine>
<Link id="l03364" /><CodeLine lineNumber="3364"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03365" /><CodeLine lineNumber="3365"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03366" /><CodeLine lineNumber="3366"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::objectsize) &#123;</Highlight></CodeLine>
<Link id="l03367" /><CodeLine lineNumber="3367"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;&gt;</a> InsertedInstructions;</Highlight></CodeLine>
<Link id="l03368" /><CodeLine lineNumber="3368"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;Result = <a href="/docs/api/namespaces/llvm/#a2f635b6d5c5f74d0c2e359897a5e7498">lowerObjectSizeCall</a>(</Highlight></CodeLine>
<Link id="l03369" /><CodeLine lineNumber="3369"><Highlight kind="normal">              <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>, &amp;<a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>, <a href="/docs/api/classes/llvm/instcombiner/#a4764870a6b87dce34acb4e5eaef32e42">AA</a>, </Highlight><Highlight kind="comment">/&#42;MustSucceed=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, &amp;InsertedInstructions);</Highlight></CodeLine>
<Link id="l03370" /><CodeLine lineNumber="3370"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inserted : InsertedInstructions)</Highlight></CodeLine>
<Link id="l03371" /><CodeLine lineNumber="3371"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.add(Inserted);</Highlight></CodeLine>
<Link id="l03372" /><CodeLine lineNumber="3372"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Result);</Highlight></CodeLine>
<Link id="l03373" /><CodeLine lineNumber="3373"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03374" /><CodeLine lineNumber="3374"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>&#91;i&#93; = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Skip examining in the next loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03375" /><CodeLine lineNumber="3375"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03376" /><CodeLine lineNumber="3376"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03377" /><CodeLine lineNumber="3377"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03378" /><CodeLine lineNumber="3378"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.size(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l03379" /><CodeLine lineNumber="3379"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>&#91;i&#93;)</Highlight></CodeLine>
<Link id="l03380" /><CodeLine lineNumber="3380"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03381" /><CodeLine lineNumber="3381"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03382" /><CodeLine lineNumber="3382"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&amp;&#42;<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>&#91;i&#93;);</Highlight></CodeLine>
<Link id="l03383" /><CodeLine lineNumber="3383"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03384" /><CodeLine lineNumber="3384"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03385" /><CodeLine lineNumber="3385"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>,</Highlight></CodeLine>
<Link id="l03386" /><CodeLine lineNumber="3386"><Highlight kind="normal">                            ConstantInt::get(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getContext()),</Highlight></CodeLine>
<Link id="l03387" /><CodeLine lineNumber="3387"><Highlight kind="normal">                                             <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isFalseWhenEqual()));</Highlight></CodeLine>
<Link id="l03388" /><CodeLine lineNumber="3388"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03389" /><CodeLine lineNumber="3389"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DVI : DVIs)</Highlight></CodeLine>
<Link id="l03390" /><CodeLine lineNumber="3390"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVI-&gt;isAddressOfVariable())</Highlight></CodeLine>
<Link id="l03391" /><CodeLine lineNumber="3391"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a8946e172b10c0ef5eaebb28ebb7662ad">ConvertDebugDeclareToDebugValue</a>(DVI, <a href="/docs/api/namespaces/llvm/si">SI</a>, &#42;DIB);</Highlight></CodeLine>
<Link id="l03392" /><CodeLine lineNumber="3392"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DVR : DVRs)</Highlight></CodeLine>
<Link id="l03393" /><CodeLine lineNumber="3393"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVR-&gt;isAddressOfVariable())</Highlight></CodeLine>
<Link id="l03394" /><CodeLine lineNumber="3394"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a8946e172b10c0ef5eaebb28ebb7662ad">ConvertDebugDeclareToDebugValue</a>(DVR, <a href="/docs/api/namespaces/llvm/si">SI</a>, &#42;DIB);</Highlight></CodeLine>
<Link id="l03395" /><CodeLine lineNumber="3395"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03396" /><CodeLine lineNumber="3396"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Casts, GEP, or anything else: we&#39;re about to delete this instruction,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03397" /><CodeLine lineNumber="3397"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// so it can not have any valid uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03398" /><CodeLine lineNumber="3398"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()));</Highlight></CodeLine>
<Link id="l03399" /><CodeLine lineNumber="3399"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03400" /><CodeLine lineNumber="3400"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03401" /><CodeLine lineNumber="3401"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03402" /><CodeLine lineNumber="3402"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03403" /><CodeLine lineNumber="3403"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)) &#123;</Highlight></CodeLine>
<Link id="l03404" /><CodeLine lineNumber="3404"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Replace invoke with a NOP intrinsic to maintain the original CFG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03405" /><CodeLine lineNumber="3405"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/module">Module</a> &#42;M = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getModule();</Highlight></CodeLine>
<Link id="l03406" /><CodeLine lineNumber="3406"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/namespaces/llvm/intrinsic/#a0cff8be0190d8e20b7cf13646f34afa2">Intrinsic::getOrInsertDeclaration</a>(M, Intrinsic::donothing);</Highlight></CodeLine>
<Link id="l03407" /><CodeLine lineNumber="3407"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/invokeinst/#afd66a65191b8b1e51ce7d6aa1a726329">InvokeInst::Create</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getNormalDest(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getUnwindDest(), &#123;&#125;, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03408" /><CodeLine lineNumber="3408"><Highlight kind="normal">                         <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent());</Highlight></CodeLine>
<Link id="l03409" /><CodeLine lineNumber="3409"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03410" /><CodeLine lineNumber="3410"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03411" /><CodeLine lineNumber="3411"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remove debug intrinsics which describe the value contained within the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03412" /><CodeLine lineNumber="3412"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// alloca. In addition to removing dbg.&#123;declare,addr&#125; which simply point to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03413" /><CodeLine lineNumber="3413"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the alloca, remove dbg.value(&lt;alloca&gt;, ..., DW&#95;OP&#95;deref)&#39;s as well, e.g.:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03414" /><CodeLine lineNumber="3414"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03415" /><CodeLine lineNumber="3415"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#96;&#96;&#96;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03416" /><CodeLine lineNumber="3416"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   define void @foo(i32 %0) &#123;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03417" /><CodeLine lineNumber="3417"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     %a = alloca i32                              ; Deleted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03418" /><CodeLine lineNumber="3418"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     store i32 %0, i32&#42; %a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03419" /><CodeLine lineNumber="3419"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     dbg.value(i32 %0, &quot;arg0&quot;)                    ; Not deleted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03420" /><CodeLine lineNumber="3420"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     dbg.value(i32&#42; %a, &quot;arg0&quot;, DW&#95;OP&#95;deref)      ; Deleted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03421" /><CodeLine lineNumber="3421"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     call void @trivially&#95;inlinable&#95;no&#95;op(i32&#42; %a)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03422" /><CodeLine lineNumber="3422"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     ret void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03423" /><CodeLine lineNumber="3423"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03424" /><CodeLine lineNumber="3424"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#96;&#96;&#96;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03425" /><CodeLine lineNumber="3425"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03426" /><CodeLine lineNumber="3426"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This may not be required if we stop describing the contents of allocas</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03427" /><CodeLine lineNumber="3427"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// using dbg.value(&lt;alloca&gt;, ..., DW&#95;OP&#95;deref), but we currently do this in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03428" /><CodeLine lineNumber="3428"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the LowerDbgDeclare utility.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03429" /><CodeLine lineNumber="3429"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03430" /><CodeLine lineNumber="3430"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If there is a dead store to &#96;%a&#96; in @trivially&#95;inlinable&#95;no&#95;op, the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03431" /><CodeLine lineNumber="3431"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &quot;arg0&quot; dbg.value may be stale after the call. However, failing to remove</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03432" /><CodeLine lineNumber="3432"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the DW&#95;OP&#95;deref dbg.value causes large gaps in location coverage.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03433" /><CodeLine lineNumber="3433"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03434" /><CodeLine lineNumber="3434"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: the Assignment Tracking project has now likely made this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03435" /><CodeLine lineNumber="3435"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// redundant (and it&#39;s sometimes harmful).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03436" /><CodeLine lineNumber="3436"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DVI : DVIs)</Highlight></CodeLine>
<Link id="l03437" /><CodeLine lineNumber="3437"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVI-&gt;isAddressOfVariable() || DVI-&gt;getExpression()-&gt;startsWithDeref())</Highlight></CodeLine>
<Link id="l03438" /><CodeLine lineNumber="3438"><Highlight kind="normal">        DVI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03439" /><CodeLine lineNumber="3439"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DVR : DVRs)</Highlight></CodeLine>
<Link id="l03440" /><CodeLine lineNumber="3440"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVR-&gt;isAddressOfVariable() || DVR-&gt;getExpression()-&gt;startsWithDeref())</Highlight></CodeLine>
<Link id="l03441" /><CodeLine lineNumber="3441"><Highlight kind="normal">        DVR-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03442" /><CodeLine lineNumber="3442"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03443" /><CodeLine lineNumber="3443"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</Highlight></CodeLine>
<Link id="l03444" /><CodeLine lineNumber="3444"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03445" /><CodeLine lineNumber="3445"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03446" /><CodeLine lineNumber="3446"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03447" /><CodeLine lineNumber="3447"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03448" /><CodeLine lineNumber="3448"><Highlight kind="comment">/// Move the call to free before a NULL test.</Highlight></CodeLine>
<Link id="l03449" /><CodeLine lineNumber="3449"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l03450" /><CodeLine lineNumber="3450"><Highlight kind="comment">/// Check if this free is accessed after its argument has been test</Highlight></CodeLine>
<Link id="l03451" /><CodeLine lineNumber="3451"><Highlight kind="comment">/// against NULL (property 0).</Highlight></CodeLine>
<Link id="l03452" /><CodeLine lineNumber="3452"><Highlight kind="comment">/// If yes, it is legal to move this call in its predecessor block.</Highlight></CodeLine>
<Link id="l03453" /><CodeLine lineNumber="3453"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l03454" /><CodeLine lineNumber="3454"><Highlight kind="comment">/// The move is performed only if the block containing the call to free</Highlight></CodeLine>
<Link id="l03455" /><CodeLine lineNumber="3455"><Highlight kind="comment">/// will be removed, i.e.:</Highlight></CodeLine>
<Link id="l03456" /><CodeLine lineNumber="3456"><Highlight kind="comment">/// 1 it has only one predecessor P, and P has two successors</Highlight></CodeLine>
<Link id="l03457" /><CodeLine lineNumber="3457"><Highlight kind="comment">/// 2 it contains the call, noops, and an unconditional branch</Highlight></CodeLine>
<Link id="l03458" /><CodeLine lineNumber="3458"><Highlight kind="comment">/// 3 its successor is the same as its predecessor&#39;s successor</Highlight></CodeLine>
<Link id="l03459" /><CodeLine lineNumber="3459"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l03460" /><CodeLine lineNumber="3460"><Highlight kind="comment">/// The profitability is out-of concern here and this function should</Highlight></CodeLine>
<Link id="l03461" /><CodeLine lineNumber="3461"><Highlight kind="comment">/// be called only if the caller knows this transformation would be</Highlight></CodeLine>
<Link id="l03462" /><CodeLine lineNumber="3462"><Highlight kind="comment">/// profitable (e.g., for code size).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03463" /><CodeLine lineNumber="3463" lineLink="#a87ed771bf8f375c44d2c5451328d4637"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a87ed771bf8f375c44d2c5451328d4637">tryToMoveFreeBeforeNullTest</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &amp;FI,</Highlight></CodeLine>
<Link id="l03464" /><CodeLine lineNumber="3464"><Highlight kind="normal">                                                </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</Highlight></CodeLine>
<Link id="l03465" /><CodeLine lineNumber="3465"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = FI.<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(0);</Highlight></CodeLine>
<Link id="l03466" /><CodeLine lineNumber="3466"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FreeInstrBB = FI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l03467" /><CodeLine lineNumber="3467"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB = FreeInstrBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</Highlight></CodeLine>
<Link id="l03468" /><CodeLine lineNumber="3468"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03469" /><CodeLine lineNumber="3469"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Validate part of constraint #1: Only one predecessor</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03470" /><CodeLine lineNumber="3470"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: We can extend the number of predecessor, but in that case, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03471" /><CodeLine lineNumber="3471"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//        would duplicate the call to free in each predecessor and it may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03472" /><CodeLine lineNumber="3472"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//        not be profitable even for code size.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03473" /><CodeLine lineNumber="3473"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PredBB)</Highlight></CodeLine>
<Link id="l03474" /><CodeLine lineNumber="3474"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03475" /><CodeLine lineNumber="3475"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03476" /><CodeLine lineNumber="3476"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Validate constraint #2: Does this block contains only the call to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03477" /><CodeLine lineNumber="3477"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//                         free, noops, and an unconditional branch?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03478" /><CodeLine lineNumber="3478"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBB;</Highlight></CodeLine>
<Link id="l03479" /><CodeLine lineNumber="3479"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;FreeInstrBBTerminator = FreeInstrBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l03480" /><CodeLine lineNumber="3480"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(FreeInstrBBTerminator, <a href="/docs/api/namespaces/llvm/patternmatch/#a1de3bd08ca83d6b976d4c8deacbf5e71">m&#95;UnconditionalBr</a>(SuccBB)))</Highlight></CodeLine>
<Link id="l03481" /><CodeLine lineNumber="3481"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03482" /><CodeLine lineNumber="3482"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03483" /><CodeLine lineNumber="3483"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there are only 2 instructions in the block, at this point,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03484" /><CodeLine lineNumber="3484"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// this is the call to free and unconditional.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03485" /><CodeLine lineNumber="3485"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there are more than 2 instructions, check that they are noops</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03486" /><CodeLine lineNumber="3486"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// i.e., they won&#39;t hurt the performance of the generated code.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03487" /><CodeLine lineNumber="3487"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FreeInstrBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>() != 2) &#123;</Highlight></CodeLine>
<Link id="l03488" /><CodeLine lineNumber="3488"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst : FreeInstrBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a2069641f358ef416658a2f321ca19d74">instructionsWithoutDebug</a>()) &#123;</Highlight></CodeLine>
<Link id="l03489" /><CodeLine lineNumber="3489"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&amp;Inst == &amp;FI || &amp;Inst == FreeInstrBBTerminator)</Highlight></CodeLine>
<Link id="l03490" /><CodeLine lineNumber="3490"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03491" /><CodeLine lineNumber="3491"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cast = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(&amp;Inst);</Highlight></CodeLine>
<Link id="l03492" /><CodeLine lineNumber="3492"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Cast || !Cast-&gt;isNoopCast(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</Highlight></CodeLine>
<Link id="l03493" /><CodeLine lineNumber="3493"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03494" /><CodeLine lineNumber="3494"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03495" /><CodeLine lineNumber="3495"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03496" /><CodeLine lineNumber="3496"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Validate the rest of constraint #1 by matching on the pred branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03497" /><CodeLine lineNumber="3497"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI = PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l03498" /><CodeLine lineNumber="3498"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueBB, &#42;FalseBB;</Highlight></CodeLine>
<Link id="l03499" /><CodeLine lineNumber="3499"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> Pred;</Highlight></CodeLine>
<Link id="l03500" /><CodeLine lineNumber="3500"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(TI, <a href="/docs/api/namespaces/llvm/patternmatch/#a811d001fa503a556ac2a48d64366500f">m&#95;Br</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ab86c85b47e09489dcda68fd91d082d77">m&#95;ICmp</a>(Pred,</Highlight></CodeLine>
<Link id="l03501" /><CodeLine lineNumber="3501"><Highlight kind="normal">                             <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>),</Highlight></CodeLine>
<Link id="l03502" /><CodeLine lineNumber="3502"><Highlight kind="normal">                                         <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;stripPointerCasts())),</Highlight></CodeLine>
<Link id="l03503" /><CodeLine lineNumber="3503"><Highlight kind="normal">                             <a href="/docs/api/namespaces/llvm/patternmatch/#ae77be336e228cf9aa00709a8606dfb98">m&#95;Zero</a>()),</Highlight></CodeLine>
<Link id="l03504" /><CodeLine lineNumber="3504"><Highlight kind="normal">                      TrueBB, FalseBB)))</Highlight></CodeLine>
<Link id="l03505" /><CodeLine lineNumber="3505"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03506" /><CodeLine lineNumber="3506"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a> &amp;&amp; Pred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a>)</Highlight></CodeLine>
<Link id="l03507" /><CodeLine lineNumber="3507"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03508" /><CodeLine lineNumber="3508"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03509" /><CodeLine lineNumber="3509"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Validate constraint #3: Ensure the null case just falls through.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03510" /><CodeLine lineNumber="3510"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccBB != (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a> ? TrueBB : FalseBB))</Highlight></CodeLine>
<Link id="l03511" /><CodeLine lineNumber="3511"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03512" /><CodeLine lineNumber="3512"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FreeInstrBB == (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a> ? FalseBB : TrueBB) &amp;&amp;</Highlight></CodeLine>
<Link id="l03513" /><CodeLine lineNumber="3513"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Broken CFG: missing edge from predecessor to successor&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03514" /><CodeLine lineNumber="3514"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03515" /><CodeLine lineNumber="3515"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// At this point, we know that everything in FreeInstrBB can be moved</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03516" /><CodeLine lineNumber="3516"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// before TI.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03517" /><CodeLine lineNumber="3517"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Instr : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(&#42;FreeInstrBB)) &#123;</Highlight></CodeLine>
<Link id="l03518" /><CodeLine lineNumber="3518"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&amp;Instr == FreeInstrBBTerminator)</Highlight></CodeLine>
<Link id="l03519" /><CodeLine lineNumber="3519"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03520" /><CodeLine lineNumber="3520"><Highlight kind="normal">    Instr.moveBeforePreserving(TI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l03521" /><CodeLine lineNumber="3521"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03522" /><CodeLine lineNumber="3522"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FreeInstrBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>() == 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l03523" /><CodeLine lineNumber="3523"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Only the branch instruction should remain&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03524" /><CodeLine lineNumber="3524"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03525" /><CodeLine lineNumber="3525"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now that we&#39;ve moved the call to free before the NULL check, we have to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03526" /><CodeLine lineNumber="3526"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// remove any attributes on its parameter that imply it&#39;s non-null, because</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03527" /><CodeLine lineNumber="3527"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// those attributes might have only been valid because of the NULL check, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03528" /><CodeLine lineNumber="3528"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we can get miscompiles if we keep them. This is conservative if non-null is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03529" /><CodeLine lineNumber="3529"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// also implied by something other than the NULL check, but it&#39;s guaranteed to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03530" /><CodeLine lineNumber="3530"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// be correct, and the conservativeness won&#39;t matter in practice, since the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03531" /><CodeLine lineNumber="3531"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// attributes are irrelevant for the call to free itself and the pointer</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03532" /><CodeLine lineNumber="3532"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shouldn&#39;t be used after the call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03533" /><CodeLine lineNumber="3533"><Highlight kind="normal">  AttributeList Attrs = FI.<a href="/docs/api/classes/llvm/callbase/#ae0c55761fce39dd71617690b04385193">getAttributes</a>();</Highlight></CodeLine>
<Link id="l03534" /><CodeLine lineNumber="3534"><Highlight kind="normal">  Attrs = Attrs.removeParamAttribute(FI.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), 0, Attribute::NonNull);</Highlight></CodeLine>
<Link id="l03535" /><CodeLine lineNumber="3535"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/attribute">Attribute</a> Dereferenceable = Attrs.getParamAttr(0, Attribute::Dereferenceable);</Highlight></CodeLine>
<Link id="l03536" /><CodeLine lineNumber="3536"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Dereferenceable.<a href="/docs/api/classes/llvm/attribute/#adf4d22686e85732b2fef71e3c45531c6">isValid</a>()) &#123;</Highlight></CodeLine>
<Link id="l03537" /><CodeLine lineNumber="3537"><Highlight kind="normal">    uint64&#95;t Bytes = Dereferenceable.<a href="/docs/api/classes/llvm/attribute/#a7a7458f7bdc291db1a43ad26f149cfed">getDereferenceableBytes</a>();</Highlight></CodeLine>
<Link id="l03538" /><CodeLine lineNumber="3538"><Highlight kind="normal">    Attrs = Attrs.removeParamAttribute(FI.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), 0,</Highlight></CodeLine>
<Link id="l03539" /><CodeLine lineNumber="3539"><Highlight kind="normal">                                       Attribute::Dereferenceable);</Highlight></CodeLine>
<Link id="l03540" /><CodeLine lineNumber="3540"><Highlight kind="normal">    Attrs = Attrs.addDereferenceableOrNullParamAttr(FI.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), 0, Bytes);</Highlight></CodeLine>
<Link id="l03541" /><CodeLine lineNumber="3541"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03542" /><CodeLine lineNumber="3542"><Highlight kind="normal">  FI.<a href="/docs/api/classes/llvm/callbase/#a9da3b29e8e71b9be4645874e1721207a">setAttributes</a>(Attrs);</Highlight></CodeLine>
<Link id="l03543" /><CodeLine lineNumber="3543"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03544" /><CodeLine lineNumber="3544"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;FI;</Highlight></CodeLine>
<Link id="l03545" /><CodeLine lineNumber="3545"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03546" /><CodeLine lineNumber="3546"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03547" /><CodeLine lineNumber="3547" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a629e02c312173d0da1b62288bc8fbd48"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a629e02c312173d0da1b62288bc8fbd48">InstCombinerImpl::visitFree</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &amp;FI, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123;</Highlight></CodeLine>
<Link id="l03548" /><CodeLine lineNumber="3548"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// free undef -&gt; unreachable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03549" /><CodeLine lineNumber="3549"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</Highlight></CodeLine>
<Link id="l03550" /><CodeLine lineNumber="3550"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Leave a marker since we can&#39;t modify the CFG here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03551" /><CodeLine lineNumber="3551"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#ab464550d233a70bf18d772d204549342">CreateNonTerminatorUnreachable</a>(&amp;FI);</Highlight></CodeLine>
<Link id="l03552" /><CodeLine lineNumber="3552"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(FI);</Highlight></CodeLine>
<Link id="l03553" /><CodeLine lineNumber="3553"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03554" /><CodeLine lineNumber="3554"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03555" /><CodeLine lineNumber="3555"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have &#39;free null&#39; delete the instruction.  This can happen in stl code</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03556" /><CodeLine lineNumber="3556"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// when lots of inlining happens.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03557" /><CodeLine lineNumber="3557"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</Highlight></CodeLine>
<Link id="l03558" /><CodeLine lineNumber="3558"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(FI);</Highlight></CodeLine>
<Link id="l03559" /><CodeLine lineNumber="3559"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03560" /><CodeLine lineNumber="3560"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we had free(realloc(...)) with no intervening uses, then eliminate the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03561" /><CodeLine lineNumber="3561"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// realloc() entirely.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03562" /><CodeLine lineNumber="3562"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l03563" /><CodeLine lineNumber="3563"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</Highlight></CodeLine>
<Link id="l03564" /><CodeLine lineNumber="3564"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;ReallocatedOp = <a href="/docs/api/namespaces/llvm/#a4ff10451ba01dc08fc0d38983c6743b7">getReallocatedOperand</a>(CI))</Highlight></CodeLine>
<Link id="l03565" /><CodeLine lineNumber="3565"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;<a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;CI, ReallocatedOp));</Highlight></CodeLine>
<Link id="l03566" /><CodeLine lineNumber="3566"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03567" /><CodeLine lineNumber="3567"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we optimize for code size, try to move the call to free before the null</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03568" /><CodeLine lineNumber="3568"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// test so that simplify cfg can remove the empty block and dead code</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03569" /><CodeLine lineNumber="3569"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// elimination the branch. I.e., helps to turn something like:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03570" /><CodeLine lineNumber="3570"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if (foo) free(foo);</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03571" /><CodeLine lineNumber="3571"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03572" /><CodeLine lineNumber="3572"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// free(foo);</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03573" /><CodeLine lineNumber="3573"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03574" /><CodeLine lineNumber="3574"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that we can only do this for &#39;free&#39; and not for any flavor of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03575" /><CodeLine lineNumber="3575"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &#39;operator delete&#39;; there is no &#39;operator delete&#39; symbol for which we are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03576" /><CodeLine lineNumber="3576"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// permitted to invent a call, even if we&#39;re passing in a null pointer.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03577" /><CodeLine lineNumber="3577"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#a8d57399452f30fb78195887945ae507c">MinimizeSize</a>) &#123;</Highlight></CodeLine>
<Link id="l03578" /><CodeLine lineNumber="3578"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a26a5e408fc09c5664d2bbb2d7fae154e">LibFunc</a> Func;</Highlight></CodeLine>
<Link id="l03579" /><CodeLine lineNumber="3579"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>.getLibFunc(FI, Func) &amp;&amp; <a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>.has(Func) &amp;&amp; Func == LibFunc&#95;free)</Highlight></CodeLine>
<Link id="l03580" /><CodeLine lineNumber="3580"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="#a87ed771bf8f375c44d2c5451328d4637">tryToMoveFreeBeforeNullTest</a>(FI, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>))</Highlight></CodeLine>
<Link id="l03581" /><CodeLine lineNumber="3581"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l03582" /><CodeLine lineNumber="3582"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03583" /><CodeLine lineNumber="3583"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03584" /><CodeLine lineNumber="3584"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03585" /><CodeLine lineNumber="3585"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03586" /><CodeLine lineNumber="3586"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03587" /><CodeLine lineNumber="3587" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a8b0688ee292d40a24ba7117b39d426bd"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a8b0688ee292d40a24ba7117b39d426bd">InstCombinerImpl::visitReturnInst</a>(<a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &amp;RI) &#123;</Highlight></CodeLine>
<Link id="l03588" /><CodeLine lineNumber="3588"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetVal = RI.<a href="/docs/api/classes/llvm/returninst/#a6c2dee0852138a5cb8a4fef5883db9ec">getReturnValue</a>();</Highlight></CodeLine>
<Link id="l03589" /><CodeLine lineNumber="3589"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RetVal || !AttributeFuncs::isNoFPClassCompatibleType(RetVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))</Highlight></CodeLine>
<Link id="l03590" /><CodeLine lineNumber="3590"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03591" /><CodeLine lineNumber="3591"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03592" /><CodeLine lineNumber="3592"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = RI.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>();</Highlight></CodeLine>
<Link id="l03593" /><CodeLine lineNumber="3593"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1d">FPClassTest</a> ReturnClass = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes().getRetNoFPClass();</Highlight></CodeLine>
<Link id="l03594" /><CodeLine lineNumber="3594"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ReturnClass == <a href="/docs/api/namespaces/llvm/#a76921eddf6329af860916f3278ef1d1da4759a508982cd525d9f17024f09aea22">fcNone</a>)</Highlight></CodeLine>
<Link id="l03595" /><CodeLine lineNumber="3595"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03596" /><CodeLine lineNumber="3596"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03597" /><CodeLine lineNumber="3597"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/knownfpclass">KnownFPClass</a> KnownClass;</Highlight></CodeLine>
<Link id="l03598" /><CodeLine lineNumber="3598"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Simplified =</Highlight></CodeLine>
<Link id="l03599" /><CodeLine lineNumber="3599"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombinerimpl/#a98e8d1806c78a1e84fa32e50a41a8a62">SimplifyDemandedUseFPClass</a>(RetVal, ~ReturnClass, KnownClass, 0, &amp;RI);</Highlight></CodeLine>
<Link id="l03600" /><CodeLine lineNumber="3600"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Simplified)</Highlight></CodeLine>
<Link id="l03601" /><CodeLine lineNumber="3601"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03602" /><CodeLine lineNumber="3602"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03603" /><CodeLine lineNumber="3603"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/returninst/#a932710d4c1c965497707751eb4f7948f">ReturnInst::Create</a>(RI.<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), Simplified);</Highlight></CodeLine>
<Link id="l03604" /><CodeLine lineNumber="3604"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03605" /><CodeLine lineNumber="3605"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03606" /><CodeLine lineNumber="3606"><Highlight kind="normal"></Highlight><Highlight kind="comment">// WARNING: keep in sync with SimplifyCFGOpt::simplifyUnreachable()!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03607" /><CodeLine lineNumber="3607" lineLink="/docs/api/classes/llvm/instcombinerimpl/#acc169700a214095e0dca03c99ba3a9eb"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#acc169700a214095e0dca03c99ba3a9eb">InstCombinerImpl::removeInstructionsBeforeUnreachable</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l03608" /><CodeLine lineNumber="3608"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to remove the previous instruction if it must lead to unreachable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03609" /><CodeLine lineNumber="3609"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This includes instructions like stores and &quot;llvm.assume&quot; that may not get</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03610" /><CodeLine lineNumber="3610"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// removed by simple dead code elimination.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03611" /><CodeLine lineNumber="3611"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03612" /><CodeLine lineNumber="3612"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Prev = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getPrevNonDebugInstruction()) &#123;</Highlight></CodeLine>
<Link id="l03613" /><CodeLine lineNumber="3613"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// While we theoretically can erase EH, that would result in a block that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03614" /><CodeLine lineNumber="3614"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// used to start with an EH no longer starting with EH, which is invalid.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03615" /><CodeLine lineNumber="3615"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// To make it valid, we&#39;d need to fixup predecessors to no longer refer to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03616" /><CodeLine lineNumber="3616"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this block, but that changes CFG, which is not allowed in InstCombine.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03617" /><CodeLine lineNumber="3617"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Prev-&gt;isEHPad())</Highlight></CodeLine>
<Link id="l03618" /><CodeLine lineNumber="3618"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Can not drop any more instructions. We&#39;re done here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03619" /><CodeLine lineNumber="3619"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03620" /><CodeLine lineNumber="3620"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(Prev))</Highlight></CodeLine>
<Link id="l03621" /><CodeLine lineNumber="3621"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Can not drop any more instructions. We&#39;re done here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03622" /><CodeLine lineNumber="3622"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise, this instruction can be freely erased,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03623" /><CodeLine lineNumber="3623"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// even if it is not side-effect free.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03624" /><CodeLine lineNumber="3624"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03625" /><CodeLine lineNumber="3625"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// A value may still have uses before we process it here (for example, in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03626" /><CodeLine lineNumber="3626"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// another unreachable block), so convert those to poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03627" /><CodeLine lineNumber="3627"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;Prev, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Prev-&gt;getType()));</Highlight></CodeLine>
<Link id="l03628" /><CodeLine lineNumber="3628"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;Prev);</Highlight></CodeLine>
<Link id="l03629" /><CodeLine lineNumber="3629"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03630" /><CodeLine lineNumber="3630"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03631" /><CodeLine lineNumber="3631"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l03632" /><CodeLine lineNumber="3632"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03633" /><CodeLine lineNumber="3633"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03634" /><CodeLine lineNumber="3634" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a2cf3d604e1fd1a965cce4e5c70fe05ca"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a2cf3d604e1fd1a965cce4e5c70fe05ca">InstCombinerImpl::visitUnreachableInst</a>(<a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l03635" /><CodeLine lineNumber="3635"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instcombinerimpl/#acc169700a214095e0dca03c99ba3a9eb">removeInstructionsBeforeUnreachable</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03636" /><CodeLine lineNumber="3636"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03637" /><CodeLine lineNumber="3637"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03638" /><CodeLine lineNumber="3638"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03639" /><CodeLine lineNumber="3639" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a6ab9ce3ba2b714edf23aa74567ba4540"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a6ab9ce3ba2b714edf23aa74567ba4540">InstCombinerImpl::visitUnconditionalBranchInst</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &amp;BI) &#123;</Highlight></CodeLine>
<Link id="l03640" /><CodeLine lineNumber="3640"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI.<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Only for unconditional branches.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03641" /><CodeLine lineNumber="3641"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03642" /><CodeLine lineNumber="3642"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this store is the second-to-last instruction in the basic block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03643" /><CodeLine lineNumber="3643"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (excluding debug info and bitcasts of pointers) and if the block ends with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03644" /><CodeLine lineNumber="3644"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// an unconditional branch, try to move the store to the successor block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03645" /><CodeLine lineNumber="3645"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03646" /><CodeLine lineNumber="3646"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetLastSinkableStore = &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI) &#123;</Highlight></CodeLine>
<Link id="l03647" /><CodeLine lineNumber="3647"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsNoopInstrForStoreMerging = &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI) &#123;</Highlight></CodeLine>
<Link id="l03648" /><CodeLine lineNumber="3648"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BBI-&gt;isDebugOrPseudoInst() ||</Highlight></CodeLine>
<Link id="l03649" /><CodeLine lineNumber="3649"><Highlight kind="normal">             (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BitCastInst&gt;</a>(BBI) &amp;&amp; BBI-&gt;getType()-&gt;isPointerTy());</Highlight></CodeLine>
<Link id="l03650" /><CodeLine lineNumber="3650"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l03651" /><CodeLine lineNumber="3651"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03652" /><CodeLine lineNumber="3652"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> FirstInstr = BBI-&gt;getParent()-&gt;begin();</Highlight></CodeLine>
<Link id="l03653" /><CodeLine lineNumber="3653"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">do</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03654" /><CodeLine lineNumber="3654"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BBI != FirstInstr)</Highlight></CodeLine>
<Link id="l03655" /><CodeLine lineNumber="3655"><Highlight kind="normal">        --BBI;</Highlight></CodeLine>
<Link id="l03656" /><CodeLine lineNumber="3656"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (BBI != FirstInstr &amp;&amp; IsNoopInstrForStoreMerging(BBI));</Highlight></CodeLine>
<Link id="l03657" /><CodeLine lineNumber="3657"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03658" /><CodeLine lineNumber="3658"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(BBI);</Highlight></CodeLine>
<Link id="l03659" /><CodeLine lineNumber="3659"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03660" /><CodeLine lineNumber="3660"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03661" /><CodeLine lineNumber="3661"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = GetLastSinkableStore(<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(BI)))</Highlight></CodeLine>
<Link id="l03662" /><CodeLine lineNumber="3662"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombinerimpl/#a9d9df487d54cc5567b4e0b1c8e0120a8">mergeStoreIntoSuccessor</a>(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>))</Highlight></CodeLine>
<Link id="l03663" /><CodeLine lineNumber="3663"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;BI;</Highlight></CodeLine>
<Link id="l03664" /><CodeLine lineNumber="3664"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03665" /><CodeLine lineNumber="3665"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03666" /><CodeLine lineNumber="3666"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03667" /><CodeLine lineNumber="3667"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03668" /><CodeLine lineNumber="3668" lineLink="/docs/api/classes/llvm/instcombinerimpl/#ad6aa61c7462784d1c9641ee501486375"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6aa61c7462784d1c9641ee501486375">InstCombinerImpl::addDeadEdge</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;From, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;To,</Highlight></CodeLine>
<Link id="l03669" /><CodeLine lineNumber="3669"><Highlight kind="normal">                                   <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;<a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>) &#123;</Highlight></CodeLine>
<Link id="l03670" /><CodeLine lineNumber="3670"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/instcombiner/#ad9606d00d0f1d7488ee416b25857f223">DeadEdges</a>.insert(&#123;From, To&#125;).second)</Highlight></CodeLine>
<Link id="l03671" /><CodeLine lineNumber="3671"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03672" /><CodeLine lineNumber="3672"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03673" /><CodeLine lineNumber="3673"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace phi node operands in successor with poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03674" /><CodeLine lineNumber="3674"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : To-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>())</Highlight></CodeLine>
<Link id="l03675" /><CodeLine lineNumber="3675"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : PN.incoming&#95;values())</Highlight></CodeLine>
<Link id="l03676" /><CodeLine lineNumber="3676"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PN.getIncomingBlock(U) == From &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l03677" /><CodeLine lineNumber="3677"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a6c1f812e984c68bc39c22b63a117e1eb">replaceUse</a>(U, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(PN.getType()));</Highlight></CodeLine>
<Link id="l03678" /><CodeLine lineNumber="3678"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#ab86d58ae73173328360a32cbbb0d5b14">addToWorklist</a>(&amp;PN);</Highlight></CodeLine>
<Link id="l03679" /><CodeLine lineNumber="3679"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03680" /><CodeLine lineNumber="3680"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03681" /><CodeLine lineNumber="3681"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03682" /><CodeLine lineNumber="3682"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.push&#95;back(To);</Highlight></CodeLine>
<Link id="l03683" /><CodeLine lineNumber="3683"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03684" /><CodeLine lineNumber="3684"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03685" /><CodeLine lineNumber="3685"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Under the assumption that I is unreachable, remove it and following</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03686" /><CodeLine lineNumber="3686"><Highlight kind="normal"></Highlight><Highlight kind="comment">// instructions. Changes are reported directly to MadeIRChange.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03687" /><CodeLine lineNumber="3687" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a352cde174c12aa24afbb7e61c22853e2"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a352cde174c12aa24afbb7e61c22853e2">InstCombinerImpl::handleUnreachableFrom</a>(</Highlight></CodeLine>
<Link id="l03688" /><CodeLine lineNumber="3688"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;<a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>) &#123;</Highlight></CodeLine>
<Link id="l03689" /><CodeLine lineNumber="3689"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l03690" /><CodeLine lineNumber="3690"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(</Highlight></CodeLine>
<Link id="l03691" /><CodeLine lineNumber="3691"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(std::next(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#ad4bb544993573a6677d97cf5413110c7">getReverseIterator</a>()),</Highlight></CodeLine>
<Link id="l03692" /><CodeLine lineNumber="3692"><Highlight kind="normal">                      std::next(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getReverseIterator())))) &#123;</Highlight></CodeLine>
<Link id="l03693" /><CodeLine lineNumber="3693"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Inst.use&#95;empty() &amp;&amp; !Inst.getType()-&gt;isTokenTy()) &#123;</Highlight></CodeLine>
<Link id="l03694" /><CodeLine lineNumber="3694"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(Inst, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Inst.getType()));</Highlight></CodeLine>
<Link id="l03695" /><CodeLine lineNumber="3695"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03696" /><CodeLine lineNumber="3696"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03697" /><CodeLine lineNumber="3697"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inst.isEHPad() || Inst.getType()-&gt;isTokenTy())</Highlight></CodeLine>
<Link id="l03698" /><CodeLine lineNumber="3698"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03699" /><CodeLine lineNumber="3699"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// RemoveDIs: erase debug-info on this instruction manually.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03700" /><CodeLine lineNumber="3700"><Highlight kind="normal">    Inst.dropDbgRecords();</Highlight></CodeLine>
<Link id="l03701" /><CodeLine lineNumber="3701"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(Inst);</Highlight></CodeLine>
<Link id="l03702" /><CodeLine lineNumber="3702"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03703" /><CodeLine lineNumber="3703"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03704" /><CodeLine lineNumber="3704"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03705" /><CodeLine lineNumber="3705"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l03706" /><CodeLine lineNumber="3706"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a5698394aeae942bfac76f1f7ac4d31a7">handleUnreachableTerminator</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)) &#123;</Highlight></CodeLine>
<Link id="l03707" /><CodeLine lineNumber="3707"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03708" /><CodeLine lineNumber="3708"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</Highlight></CodeLine>
<Link id="l03709" /><CodeLine lineNumber="3709"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#ab86d58ae73173328360a32cbbb0d5b14">addToWorklist</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V));</Highlight></CodeLine>
<Link id="l03710" /><CodeLine lineNumber="3710"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03711" /><CodeLine lineNumber="3711"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03712" /><CodeLine lineNumber="3712"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Handle potentially dead successors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03713" /><CodeLine lineNumber="3713"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB))</Highlight></CodeLine>
<Link id="l03714" /><CodeLine lineNumber="3714"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6aa61c7462784d1c9641ee501486375">addDeadEdge</a>(BB, Succ, <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>);</Highlight></CodeLine>
<Link id="l03715" /><CodeLine lineNumber="3715"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03716" /><CodeLine lineNumber="3716"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03717" /><CodeLine lineNumber="3717" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a4e25c5f8a8a770362e0ab9dcaa167dab"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a4e25c5f8a8a770362e0ab9dcaa167dab">InstCombinerImpl::handlePotentiallyDeadBlocks</a>(</Highlight></CodeLine>
<Link id="l03718" /><CodeLine lineNumber="3718"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;<a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>) &#123;</Highlight></CodeLine>
<Link id="l03719" /><CodeLine lineNumber="3719"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.empty()) &#123;</Highlight></CodeLine>
<Link id="l03720" /><CodeLine lineNumber="3720"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.pop&#95;back&#95;val();</Highlight></CodeLine>
<Link id="l03721" /><CodeLine lineNumber="3721"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred) &#123;</Highlight></CodeLine>
<Link id="l03722" /><CodeLine lineNumber="3722"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ad9606d00d0f1d7488ee416b25857f223">DeadEdges</a>.contains(&#123;Pred, BB&#125;) || <a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>.dominates(BB, Pred);</Highlight></CodeLine>
<Link id="l03723" /><CodeLine lineNumber="3723"><Highlight kind="normal">        &#125;))</Highlight></CodeLine>
<Link id="l03724" /><CodeLine lineNumber="3724"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03725" /><CodeLine lineNumber="3725"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03726" /><CodeLine lineNumber="3726"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#a352cde174c12aa24afbb7e61c22853e2">handleUnreachableFrom</a>(&amp;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>(), <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>);</Highlight></CodeLine>
<Link id="l03727" /><CodeLine lineNumber="3727"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03728" /><CodeLine lineNumber="3728"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03729" /><CodeLine lineNumber="3729"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03730" /><CodeLine lineNumber="3730" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a68e1b07361fa3158d2c11c1af3d7ab1b"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a68e1b07361fa3158d2c11c1af3d7ab1b">InstCombinerImpl::handlePotentiallyDeadSuccessors</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l03731" /><CodeLine lineNumber="3731"><Highlight kind="normal">                                                       <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LiveSucc) &#123;</Highlight></CodeLine>
<Link id="l03732" /><CodeLine lineNumber="3732"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;&gt;</a> <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>;</Highlight></CodeLine>
<Link id="l03733" /><CodeLine lineNumber="3733"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB)) &#123;</Highlight></CodeLine>
<Link id="l03734" /><CodeLine lineNumber="3734"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The live successor isn&#39;t dead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03735" /><CodeLine lineNumber="3735"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succ == LiveSucc)</Highlight></CodeLine>
<Link id="l03736" /><CodeLine lineNumber="3736"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03737" /><CodeLine lineNumber="3737"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03738" /><CodeLine lineNumber="3738"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#ad6aa61c7462784d1c9641ee501486375">addDeadEdge</a>(BB, Succ, <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>);</Highlight></CodeLine>
<Link id="l03739" /><CodeLine lineNumber="3739"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03740" /><CodeLine lineNumber="3740"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03741" /><CodeLine lineNumber="3741"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instcombinerimpl/#a4e25c5f8a8a770362e0ab9dcaa167dab">handlePotentiallyDeadBlocks</a>(<a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>);</Highlight></CodeLine>
<Link id="l03742" /><CodeLine lineNumber="3742"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03743" /><CodeLine lineNumber="3743"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03744" /><CodeLine lineNumber="3744" lineLink="/docs/api/classes/llvm/instcombinerimpl/#aea9ba5a362fb88bd97349a302133dd03"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#aea9ba5a362fb88bd97349a302133dd03">InstCombinerImpl::visitBranchInst</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &amp;BI) &#123;</Highlight></CodeLine>
<Link id="l03745" /><CodeLine lineNumber="3745"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BI.<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>())</Highlight></CodeLine>
<Link id="l03746" /><CodeLine lineNumber="3746"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a6ab9ce3ba2b714edf23aa74567ba4540">visitUnconditionalBranchInst</a>(BI);</Highlight></CodeLine>
<Link id="l03747" /><CodeLine lineNumber="3747"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03748" /><CodeLine lineNumber="3748"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Change br (not X), label True, label False to: br X, label False, True</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03749" /><CodeLine lineNumber="3749"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = BI.<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</Highlight></CodeLine>
<Link id="l03750" /><CodeLine lineNumber="3750"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l03751" /><CodeLine lineNumber="3751"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)) &#123;</Highlight></CodeLine>
<Link id="l03752" /><CodeLine lineNumber="3752"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Swap Destinations and condition...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03753" /><CodeLine lineNumber="3753"><Highlight kind="normal">    BI.<a href="/docs/api/classes/llvm/branchinst/#a6550fe5bd437c1c3c6e237d726e36b90">swapSuccessors</a>();</Highlight></CodeLine>
<Link id="l03754" /><CodeLine lineNumber="3754"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#a7f74e84c9b2bc2441706161c2ed9cc5a">BPI</a>)</Highlight></CodeLine>
<Link id="l03755" /><CodeLine lineNumber="3755"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#a7f74e84c9b2bc2441706161c2ed9cc5a">BPI</a>-&gt;swapSuccEdgesProbabilities(BI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l03756" /><CodeLine lineNumber="3756"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(BI, 0, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</Highlight></CodeLine>
<Link id="l03757" /><CodeLine lineNumber="3757"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03758" /><CodeLine lineNumber="3758"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03759" /><CodeLine lineNumber="3759"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Canonicalize logical-and-with-invert as logical-or-with-invert.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03760" /><CodeLine lineNumber="3760"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is done by inverting the condition and swapping successors:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03761" /><CodeLine lineNumber="3761"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// br (X &amp;&amp; !Y), T, F --&gt; br !(X &amp;&amp; !Y), F, T --&gt; br (!X || Y), F, T</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03762" /><CodeLine lineNumber="3762"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l03763" /><CodeLine lineNumber="3763"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l03764" /><CodeLine lineNumber="3764"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>,</Highlight></CodeLine>
<Link id="l03765" /><CodeLine lineNumber="3765"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))))))) &#123;</Highlight></CodeLine>
<Link id="l03766" /><CodeLine lineNumber="3766"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NotX = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateNot(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, </Highlight><Highlight kind="stringliteral">&quot;not.&quot;</Highlight><Highlight kind="normal"> + <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getName());</Highlight></CodeLine>
<Link id="l03767" /><CodeLine lineNumber="3767"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">Or</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateLogicalOr(NotX, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l03768" /><CodeLine lineNumber="3768"><Highlight kind="normal">    BI.<a href="/docs/api/classes/llvm/branchinst/#a6550fe5bd437c1c3c6e237d726e36b90">swapSuccessors</a>();</Highlight></CodeLine>
<Link id="l03769" /><CodeLine lineNumber="3769"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#a7f74e84c9b2bc2441706161c2ed9cc5a">BPI</a>)</Highlight></CodeLine>
<Link id="l03770" /><CodeLine lineNumber="3770"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#a7f74e84c9b2bc2441706161c2ed9cc5a">BPI</a>-&gt;swapSuccEdgesProbabilities(BI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l03771" /><CodeLine lineNumber="3771"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(BI, 0, <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">Or</a>);</Highlight></CodeLine>
<Link id="l03772" /><CodeLine lineNumber="3772"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03773" /><CodeLine lineNumber="3773"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03774" /><CodeLine lineNumber="3774"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the condition is irrelevant, remove the use so that other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03775" /><CodeLine lineNumber="3775"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// transforms on the condition become more effective.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03776" /><CodeLine lineNumber="3776"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>) &amp;&amp; BI.<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BI.<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1))</Highlight></CodeLine>
<Link id="l03777" /><CodeLine lineNumber="3777"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(BI, 0, <a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getType()));</Highlight></CodeLine>
<Link id="l03778" /><CodeLine lineNumber="3778"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03779" /><CodeLine lineNumber="3779"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Canonicalize, for example, fcmp&#95;one -&gt; fcmp&#95;oeq.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03780" /><CodeLine lineNumber="3780"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> Pred;</Highlight></CodeLine>
<Link id="l03781" /><CodeLine lineNumber="3781"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a08d5220c6f77428fcfd5bd1de5af2bbc">m&#95;FCmp</a>(Pred, <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()))) &amp;&amp;</Highlight></CodeLine>
<Link id="l03782" /><CodeLine lineNumber="3782"><Highlight kind="normal">      !<a href="/docs/api/classes/llvm/instcombiner/#a7245fe59c5c3470907144f999fbb258a">isCanonicalPredicate</a>(Pred)) &#123;</Highlight></CodeLine>
<Link id="l03783" /><CodeLine lineNumber="3783"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Swap destinations and condition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03784" /><CodeLine lineNumber="3784"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</Highlight></CodeLine>
<Link id="l03785" /><CodeLine lineNumber="3785"><Highlight kind="normal">    Cmp-&gt;setPredicate(<a href="/docs/api/classes/llvm/cmpinst/#aa2a54b545d237ecfe450fd1292f7675e">CmpInst::getInversePredicate</a>(Pred));</Highlight></CodeLine>
<Link id="l03786" /><CodeLine lineNumber="3786"><Highlight kind="normal">    BI.<a href="/docs/api/classes/llvm/branchinst/#a6550fe5bd437c1c3c6e237d726e36b90">swapSuccessors</a>();</Highlight></CodeLine>
<Link id="l03787" /><CodeLine lineNumber="3787"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#a7f74e84c9b2bc2441706161c2ed9cc5a">BPI</a>)</Highlight></CodeLine>
<Link id="l03788" /><CodeLine lineNumber="3788"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#a7f74e84c9b2bc2441706161c2ed9cc5a">BPI</a>-&gt;swapSuccEdgesProbabilities(BI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l03789" /><CodeLine lineNumber="3789"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.push(Cmp);</Highlight></CodeLine>
<Link id="l03790" /><CodeLine lineNumber="3790"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;BI;</Highlight></CodeLine>
<Link id="l03791" /><CodeLine lineNumber="3791"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03792" /><CodeLine lineNumber="3792"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03793" /><CodeLine lineNumber="3793"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</Highlight></CodeLine>
<Link id="l03794" /><CodeLine lineNumber="3794"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#a68e1b07361fa3158d2c11c1af3d7ab1b">handlePotentiallyDeadSuccessors</a>(BI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), </Highlight><Highlight kind="comment">/&#42;LiveSucc&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03795" /><CodeLine lineNumber="3795"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03796" /><CodeLine lineNumber="3796"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03797" /><CodeLine lineNumber="3797"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</Highlight></CodeLine>
<Link id="l03798" /><CodeLine lineNumber="3798"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#a68e1b07361fa3158d2c11c1af3d7ab1b">handlePotentiallyDeadSuccessors</a>(BI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(),</Highlight></CodeLine>
<Link id="l03799" /><CodeLine lineNumber="3799"><Highlight kind="normal">                                    BI.<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(!CI-&gt;getZExtValue()));</Highlight></CodeLine>
<Link id="l03800" /><CodeLine lineNumber="3800"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03801" /><CodeLine lineNumber="3801"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03802" /><CodeLine lineNumber="3802"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03803" /><CodeLine lineNumber="3803"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace all dominated uses of the condition with true/false</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03804" /><CodeLine lineNumber="3804"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Ignore constant expressions to avoid iterating over uses on other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03805" /><CodeLine lineNumber="3805"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// functions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03806" /><CodeLine lineNumber="3806"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>) &amp;&amp; BI.<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != BI.<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)) &#123;</Highlight></CodeLine>
<Link id="l03807" /><CodeLine lineNumber="3807"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;uses())) &#123;</Highlight></CodeLine>
<Link id="l03808" /><CodeLine lineNumber="3808"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblockedge">BasicBlockEdge</a> Edge0(BI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), BI.<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0));</Highlight></CodeLine>
<Link id="l03809" /><CodeLine lineNumber="3809"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>.dominates(Edge0, U)) &#123;</Highlight></CodeLine>
<Link id="l03810" /><CodeLine lineNumber="3810"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a6c1f812e984c68bc39c22b63a117e1eb">replaceUse</a>(U, <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getType()));</Highlight></CodeLine>
<Link id="l03811" /><CodeLine lineNumber="3811"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#ab86d58ae73173328360a32cbbb0d5b14">addToWorklist</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser()));</Highlight></CodeLine>
<Link id="l03812" /><CodeLine lineNumber="3812"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03813" /><CodeLine lineNumber="3813"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03814" /><CodeLine lineNumber="3814"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblockedge">BasicBlockEdge</a> Edge1(BI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), BI.<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1));</Highlight></CodeLine>
<Link id="l03815" /><CodeLine lineNumber="3815"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>.dominates(Edge1, U)) &#123;</Highlight></CodeLine>
<Link id="l03816" /><CodeLine lineNumber="3816"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a6c1f812e984c68bc39c22b63a117e1eb">replaceUse</a>(U, <a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getType()));</Highlight></CodeLine>
<Link id="l03817" /><CodeLine lineNumber="3817"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#ab86d58ae73173328360a32cbbb0d5b14">addToWorklist</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser()));</Highlight></CodeLine>
<Link id="l03818" /><CodeLine lineNumber="3818"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03819" /><CodeLine lineNumber="3819"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03820" /><CodeLine lineNumber="3820"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03821" /><CodeLine lineNumber="3821"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03822" /><CodeLine lineNumber="3822"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instcombiner/#a888ebf4b0f794a1c13741d38f0c4aa61">DC</a>.registerBranch(&amp;BI);</Highlight></CodeLine>
<Link id="l03823" /><CodeLine lineNumber="3823"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03824" /><CodeLine lineNumber="3824"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03825" /><CodeLine lineNumber="3825"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03826" /><CodeLine lineNumber="3826"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Replaces (switch (select cond, X, C)/(select cond, C, X)) with (switch X) if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03827" /><CodeLine lineNumber="3827"><Highlight kind="normal"></Highlight><Highlight kind="comment">// we can prove that both (switch C) and (switch X) go to the default when cond</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03828" /><CodeLine lineNumber="3828"><Highlight kind="normal"></Highlight><Highlight kind="comment">// is false/true.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03829" /><CodeLine lineNumber="3829" lineLink="#a002b7ea3a854166ae7ffe9d0e3e994d7"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a002b7ea3a854166ae7ffe9d0e3e994d7">simplifySwitchOnSelectUsingRanges</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>,</Highlight></CodeLine>
<Link id="l03830" /><CodeLine lineNumber="3830"><Highlight kind="normal">                                                <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>,</Highlight></CodeLine>
<Link id="l03831" /><CodeLine lineNumber="3831"><Highlight kind="normal">                                                </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsTrueArm) &#123;</Highlight></CodeLine>
<Link id="l03832" /><CodeLine lineNumber="3832"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> CstOpIdx = IsTrueArm ? 1 : 2;</Highlight></CodeLine>
<Link id="l03833" /><CodeLine lineNumber="3833"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getOperand(CstOpIdx));</Highlight></CodeLine>
<Link id="l03834" /><CodeLine lineNumber="3834"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)</Highlight></CodeLine>
<Link id="l03835" /><CodeLine lineNumber="3835"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03836" /><CodeLine lineNumber="3836"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03837" /><CodeLine lineNumber="3837"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CstBB = <a href="/docs/api/namespaces/llvm/si">SI</a>.findCaseValue(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)-&gt;getCaseSuccessor();</Highlight></CodeLine>
<Link id="l03838" /><CodeLine lineNumber="3838"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CstBB != <a href="/docs/api/namespaces/llvm/si">SI</a>.getDefaultDest())</Highlight></CodeLine>
<Link id="l03839" /><CodeLine lineNumber="3839"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03840" /><CodeLine lineNumber="3840"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getOperand(3 - CstOpIdx);</Highlight></CodeLine>
<Link id="l03841" /><CodeLine lineNumber="3841"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> Pred;</Highlight></CodeLine>
<Link id="l03842" /><CodeLine lineNumber="3842"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;RHSC;</Highlight></CodeLine>
<Link id="l03843" /><CodeLine lineNumber="3843"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getCondition(),</Highlight></CodeLine>
<Link id="l03844" /><CodeLine lineNumber="3844"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/patternmatch/#ab86c85b47e09489dcda68fd91d082d77">m&#95;ICmp</a>(Pred, <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(RHSC))))</Highlight></CodeLine>
<Link id="l03845" /><CodeLine lineNumber="3845"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03846" /><CodeLine lineNumber="3846"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsTrueArm)</Highlight></CodeLine>
<Link id="l03847" /><CodeLine lineNumber="3847"><Highlight kind="normal">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#aa2a54b545d237ecfe450fd1292f7675e">ICmpInst::getInversePredicate</a>(Pred);</Highlight></CodeLine>
<Link id="l03848" /><CodeLine lineNumber="3848"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03849" /><CodeLine lineNumber="3849"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// See whether we can replace the select with X</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03850" /><CodeLine lineNumber="3850"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constantrange">ConstantRange</a> CR = <a href="/docs/api/classes/llvm/constantrange/#aa89e9cec92a0b38d2f47a077bf12cc98">ConstantRange::makeExactICmpRegion</a>(Pred, &#42;RHSC);</Highlight></CodeLine>
<Link id="l03851" /><CodeLine lineNumber="3851"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Case : <a href="/docs/api/namespaces/llvm/si">SI</a>.cases())</Highlight></CodeLine>
<Link id="l03852" /><CodeLine lineNumber="3852"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CR.<a href="/docs/api/classes/llvm/constantrange/#aaca3a4d2b25c24b11179cbd01079b73c">contains</a>(Case.getCaseValue()-&gt;getValue()))</Highlight></CodeLine>
<Link id="l03853" /><CodeLine lineNumber="3853"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03854" /><CodeLine lineNumber="3854"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03855" /><CodeLine lineNumber="3855"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l03856" /><CodeLine lineNumber="3856"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03857" /><CodeLine lineNumber="3857"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03858" /><CodeLine lineNumber="3858" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a91100900b6eb1ae18127f1e1f8f8a40e"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a91100900b6eb1ae18127f1e1f8f8a40e">InstCombinerImpl::visitSwitchInst</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</Highlight></CodeLine>
<Link id="l03859" /><CodeLine lineNumber="3859"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>.getCondition();</Highlight></CodeLine>
<Link id="l03860" /><CodeLine lineNumber="3860"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0;</Highlight></CodeLine>
<Link id="l03861" /><CodeLine lineNumber="3861"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;AddRHS;</Highlight></CodeLine>
<Link id="l03862" /><CodeLine lineNumber="3862"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(AddRHS)))) &#123;</Highlight></CodeLine>
<Link id="l03863" /><CodeLine lineNumber="3863"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Change &#39;switch (X+4) case 1:&#39; into &#39;switch (X) case -3&#39;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03864" /><CodeLine lineNumber="3864"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Case : <a href="/docs/api/namespaces/llvm/si">SI</a>.cases()) &#123;</Highlight></CodeLine>
<Link id="l03865" /><CodeLine lineNumber="3865"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewCase = <a href="/docs/api/classes/llvm/constantexpr/#a554ab77949b0a16670a83ec3307501eb">ConstantExpr::getSub</a>(Case.getCaseValue(), AddRHS);</Highlight></CodeLine>
<Link id="l03866" /><CodeLine lineNumber="3866"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(NewCase) &amp;&amp;</Highlight></CodeLine>
<Link id="l03867" /><CodeLine lineNumber="3867"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Result of expression should be constant&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03868" /><CodeLine lineNumber="3868"><Highlight kind="normal">      Case.setValue(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(NewCase));</Highlight></CodeLine>
<Link id="l03869" /><CodeLine lineNumber="3869"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03870" /><CodeLine lineNumber="3870"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, 0, Op0);</Highlight></CodeLine>
<Link id="l03871" /><CodeLine lineNumber="3871"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03872" /><CodeLine lineNumber="3872"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03873" /><CodeLine lineNumber="3873"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;SubLHS;</Highlight></CodeLine>
<Link id="l03874" /><CodeLine lineNumber="3874"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(SubLHS), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op0)))) &#123;</Highlight></CodeLine>
<Link id="l03875" /><CodeLine lineNumber="3875"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Change &#39;switch (1-X) case 1:&#39; into &#39;switch (X) case 0&#39;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03876" /><CodeLine lineNumber="3876"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Case : <a href="/docs/api/namespaces/llvm/si">SI</a>.cases()) &#123;</Highlight></CodeLine>
<Link id="l03877" /><CodeLine lineNumber="3877"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewCase = <a href="/docs/api/classes/llvm/constantexpr/#a554ab77949b0a16670a83ec3307501eb">ConstantExpr::getSub</a>(SubLHS, Case.getCaseValue());</Highlight></CodeLine>
<Link id="l03878" /><CodeLine lineNumber="3878"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(NewCase) &amp;&amp;</Highlight></CodeLine>
<Link id="l03879" /><CodeLine lineNumber="3879"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Result of expression should be constant&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03880" /><CodeLine lineNumber="3880"><Highlight kind="normal">      Case.setValue(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(NewCase));</Highlight></CodeLine>
<Link id="l03881" /><CodeLine lineNumber="3881"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03882" /><CodeLine lineNumber="3882"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, 0, Op0);</Highlight></CodeLine>
<Link id="l03883" /><CodeLine lineNumber="3883"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03884" /><CodeLine lineNumber="3884"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03885" /><CodeLine lineNumber="3885"><Highlight kind="normal">  uint64&#95;t ShiftAmt;</Highlight></CodeLine>
<Link id="l03886" /><CodeLine lineNumber="3886"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#a3aa1f5d3cd54d36e7e47f401a0118aeb">m&#95;ConstantInt</a>(ShiftAmt))) &amp;&amp;</Highlight></CodeLine>
<Link id="l03887" /><CodeLine lineNumber="3887"><Highlight kind="normal">      ShiftAmt &lt; Op0-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>()-&gt;<a href="/docs/api/files/lib/lib/target/lib/target/systemz/systemztargettransforminfo-cpp/#a69eeffbc38c079195008fbfb5aaad0b9">getScalarSizeInBits</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l03888" /><CodeLine lineNumber="3888"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.cases(), &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Case) &#123;</Highlight></CodeLine>
<Link id="l03889" /><CodeLine lineNumber="3889"><Highlight kind="normal">        return Case.getCaseValue()-&gt;getValue().countr&#95;zero() &gt;= ShiftAmt;</Highlight></CodeLine>
<Link id="l03890" /><CodeLine lineNumber="3890"><Highlight kind="normal">      &#125;)) &#123;</Highlight></CodeLine>
<Link id="l03891" /><CodeLine lineNumber="3891"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Change &#39;switch (X &lt;&lt; 2) case 4:&#39; into &#39;switch (X) case 1:&#39;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03892" /><CodeLine lineNumber="3892"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/overflowingbinaryoperator">OverflowingBinaryOperator</a> &#42;Shl = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;OverflowingBinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</Highlight></CodeLine>
<Link id="l03893" /><CodeLine lineNumber="3893"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Shl-&gt;<a href="/docs/api/classes/llvm/overflowingbinaryoperator/#a95474ea140862464db7ea0580f01eae9">hasNoUnsignedWrap</a>() || Shl-&gt;<a href="/docs/api/classes/llvm/overflowingbinaryoperator/#a7876c618729b8764493aa340b53b574f">hasNoSignedWrap</a>() ||</Highlight></CodeLine>
<Link id="l03894" /><CodeLine lineNumber="3894"><Highlight kind="normal">        Shl-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>()) &#123;</Highlight></CodeLine>
<Link id="l03895" /><CodeLine lineNumber="3895"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCond = Op0;</Highlight></CodeLine>
<Link id="l03896" /><CodeLine lineNumber="3896"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Shl-&gt;<a href="/docs/api/classes/llvm/overflowingbinaryoperator/#a95474ea140862464db7ea0580f01eae9">hasNoUnsignedWrap</a>() &amp;&amp; !Shl-&gt;<a href="/docs/api/classes/llvm/overflowingbinaryoperator/#a7876c618729b8764493aa340b53b574f">hasNoSignedWrap</a>()) &#123;</Highlight></CodeLine>
<Link id="l03897" /><CodeLine lineNumber="3897"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the shift may wrap, we need to mask off the shifted bits.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03898" /><CodeLine lineNumber="3898"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = Op0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</Highlight></CodeLine>
<Link id="l03899" /><CodeLine lineNumber="3899"><Highlight kind="normal">        NewCond = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAnd(</Highlight></CodeLine>
<Link id="l03900" /><CodeLine lineNumber="3900"><Highlight kind="normal">            Op0, <a href="/docs/api/classes/llvm/apint/#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> - ShiftAmt));</Highlight></CodeLine>
<Link id="l03901" /><CodeLine lineNumber="3901"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03902" /><CodeLine lineNumber="3902"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Case : <a href="/docs/api/namespaces/llvm/si">SI</a>.cases()) &#123;</Highlight></CodeLine>
<Link id="l03903" /><CodeLine lineNumber="3903"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;CaseVal = Case.getCaseValue()-&gt;getValue();</Highlight></CodeLine>
<Link id="l03904" /><CodeLine lineNumber="3904"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/apint">APInt</a> ShiftedCase = Shl-&gt;<a href="/docs/api/classes/llvm/overflowingbinaryoperator/#a7876c618729b8764493aa340b53b574f">hasNoSignedWrap</a>() ? CaseVal.<a href="/docs/api/classes/llvm/apint/#ab6006923d1a3139d70abc8f6552a7960">ashr</a>(ShiftAmt)</Highlight></CodeLine>
<Link id="l03905" /><CodeLine lineNumber="3905"><Highlight kind="normal">                                                   : CaseVal.<a href="/docs/api/classes/llvm/apint/#af34549c39d6f741fbdaf9a795aa306e9">lshr</a>(ShiftAmt);</Highlight></CodeLine>
<Link id="l03906" /><CodeLine lineNumber="3906"><Highlight kind="normal">        Case.setValue(ConstantInt::get(<a href="/docs/api/namespaces/llvm/si">SI</a>.getContext(), ShiftedCase));</Highlight></CodeLine>
<Link id="l03907" /><CodeLine lineNumber="3907"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03908" /><CodeLine lineNumber="3908"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, 0, NewCond);</Highlight></CodeLine>
<Link id="l03909" /><CodeLine lineNumber="3909"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03910" /><CodeLine lineNumber="3910"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03911" /><CodeLine lineNumber="3911"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03912" /><CodeLine lineNumber="3912"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Fold switch(zext/sext(X)) into switch(X) if possible.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03913" /><CodeLine lineNumber="3913"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op0)))) &#123;</Highlight></CodeLine>
<Link id="l03914" /><CodeLine lineNumber="3914"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsZExt = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</Highlight></CodeLine>
<Link id="l03915" /><CodeLine lineNumber="3915"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcTy = Op0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l03916" /><CodeLine lineNumber="3916"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NewWidth = SrcTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</Highlight></CodeLine>
<Link id="l03917" /><CodeLine lineNumber="3917"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03918" /><CodeLine lineNumber="3918"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.cases(), &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Case) &#123;</Highlight></CodeLine>
<Link id="l03919" /><CodeLine lineNumber="3919"><Highlight kind="normal">          const APInt &amp;CaseVal = Case.getCaseValue()-&gt;getValue();</Highlight></CodeLine>
<Link id="l03920" /><CodeLine lineNumber="3920"><Highlight kind="normal">          return IsZExt ? CaseVal.isIntN(NewWidth)</Highlight></CodeLine>
<Link id="l03921" /><CodeLine lineNumber="3921"><Highlight kind="normal">                        : CaseVal.isSignedIntN(NewWidth);</Highlight></CodeLine>
<Link id="l03922" /><CodeLine lineNumber="3922"><Highlight kind="normal">        &#125;)) &#123;</Highlight></CodeLine>
<Link id="l03923" /><CodeLine lineNumber="3923"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Case : <a href="/docs/api/namespaces/llvm/si">SI</a>.cases()) &#123;</Highlight></CodeLine>
<Link id="l03924" /><CodeLine lineNumber="3924"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/apint">APInt</a> TruncatedCase = Case.getCaseValue()-&gt;getValue().<a href="/docs/api/classes/llvm/apint/#a317c64fd4cfebc88e79387b3821a629d">trunc</a>(NewWidth);</Highlight></CodeLine>
<Link id="l03925" /><CodeLine lineNumber="3925"><Highlight kind="normal">        Case.setValue(ConstantInt::get(<a href="/docs/api/namespaces/llvm/si">SI</a>.getContext(), TruncatedCase));</Highlight></CodeLine>
<Link id="l03926" /><CodeLine lineNumber="3926"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03927" /><CodeLine lineNumber="3927"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, 0, Op0);</Highlight></CodeLine>
<Link id="l03928" /><CodeLine lineNumber="3928"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03929" /><CodeLine lineNumber="3929"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03930" /><CodeLine lineNumber="3930"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03931" /><CodeLine lineNumber="3931"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Fold switch(select cond, X, Y) into switch(X/Y) if possible</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03932" /><CodeLine lineNumber="3932"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</Highlight></CodeLine>
<Link id="l03933" /><CodeLine lineNumber="3933"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V =</Highlight></CodeLine>
<Link id="l03934" /><CodeLine lineNumber="3934"><Highlight kind="normal">            <a href="#a002b7ea3a854166ae7ffe9d0e3e994d7">simplifySwitchOnSelectUsingRanges</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>, </Highlight><Highlight kind="comment">/&#42;IsTrueArm=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l03935" /><CodeLine lineNumber="3935"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, 0, V);</Highlight></CodeLine>
<Link id="l03936" /><CodeLine lineNumber="3936"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V =</Highlight></CodeLine>
<Link id="l03937" /><CodeLine lineNumber="3937"><Highlight kind="normal">            <a href="#a002b7ea3a854166ae7ffe9d0e3e994d7">simplifySwitchOnSelectUsingRanges</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>, </Highlight><Highlight kind="comment">/&#42;IsTrueArm=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l03938" /><CodeLine lineNumber="3938"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, 0, V);</Highlight></CodeLine>
<Link id="l03939" /><CodeLine lineNumber="3939"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03940" /><CodeLine lineNumber="3940"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03941" /><CodeLine lineNumber="3941"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/knownbits">KnownBits</a> Known = <a href="/docs/api/classes/llvm/instcombiner/#ae099c6fa4a0b06306ece7dd372e8d02a">computeKnownBits</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, 0, &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>);</Highlight></CodeLine>
<Link id="l03942" /><CodeLine lineNumber="3942"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> LeadingKnownZeros = Known.<a href="/docs/api/structs/llvm/knownbits/#a7f47812e8e75b0616a97d7004e5fb909">countMinLeadingZeros</a>();</Highlight></CodeLine>
<Link id="l03943" /><CodeLine lineNumber="3943"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> LeadingKnownOnes = Known.<a href="/docs/api/structs/llvm/knownbits/#a1d90fff0f1479f662286338ffecd7f05">countMinLeadingOnes</a>();</Highlight></CodeLine>
<Link id="l03944" /><CodeLine lineNumber="3944"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03945" /><CodeLine lineNumber="3945"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Compute the number of leading bits we can ignore.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03946" /><CodeLine lineNumber="3946"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: A better way to determine this would use ComputeNumSignBits().</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03947" /><CodeLine lineNumber="3947"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> : <a href="/docs/api/namespaces/llvm/si">SI</a>.cases()) &#123;</Highlight></CodeLine>
<Link id="l03948" /><CodeLine lineNumber="3948"><Highlight kind="normal">    LeadingKnownZeros =</Highlight></CodeLine>
<Link id="l03949" /><CodeLine lineNumber="3949"><Highlight kind="normal">        std::min(LeadingKnownZeros, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getCaseValue()-&gt;getValue().countl&#95;zero());</Highlight></CodeLine>
<Link id="l03950" /><CodeLine lineNumber="3950"><Highlight kind="normal">    LeadingKnownOnes =</Highlight></CodeLine>
<Link id="l03951" /><CodeLine lineNumber="3951"><Highlight kind="normal">        std::min(LeadingKnownOnes, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getCaseValue()-&gt;getValue().countl&#95;one());</Highlight></CodeLine>
<Link id="l03952" /><CodeLine lineNumber="3952"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03953" /><CodeLine lineNumber="3953"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03954" /><CodeLine lineNumber="3954"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NewWidth = Known.<a href="/docs/api/structs/llvm/knownbits/#a4fdc09049a61f952b5d52788dbd2f69b">getBitWidth</a>() - std::max(LeadingKnownZeros, LeadingKnownOnes);</Highlight></CodeLine>
<Link id="l03955" /><CodeLine lineNumber="3955"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03956" /><CodeLine lineNumber="3956"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Shrink the condition operand if the new type is smaller than the old type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03957" /><CodeLine lineNumber="3957"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// But do not shrink to a non-standard type, because backend can&#39;t generate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03958" /><CodeLine lineNumber="3958"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// good code for that yet.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03959" /><CodeLine lineNumber="3959"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: We can make it aggressive again after fixing PR39569.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03960" /><CodeLine lineNumber="3960"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewWidth &gt; 0 &amp;&amp; NewWidth &lt; Known.<a href="/docs/api/structs/llvm/knownbits/#a4fdc09049a61f952b5d52788dbd2f69b">getBitWidth</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l03961" /><CodeLine lineNumber="3961"><Highlight kind="normal">      shouldChangeType(Known.<a href="/docs/api/structs/llvm/knownbits/#a4fdc09049a61f952b5d52788dbd2f69b">getBitWidth</a>(), NewWidth)) &#123;</Highlight></CodeLine>
<Link id="l03962" /><CodeLine lineNumber="3962"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;Ty = <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.getContext(), NewWidth);</Highlight></CodeLine>
<Link id="l03963" /><CodeLine lineNumber="3963"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.SetInsertPoint(&amp;<a href="/docs/api/namespaces/llvm/si">SI</a>);</Highlight></CodeLine>
<Link id="l03964" /><CodeLine lineNumber="3964"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCond = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateTrunc(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, Ty, </Highlight><Highlight kind="stringliteral">&quot;trunc&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03965" /><CodeLine lineNumber="3965"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03966" /><CodeLine lineNumber="3966"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Case : <a href="/docs/api/namespaces/llvm/si">SI</a>.cases()) &#123;</Highlight></CodeLine>
<Link id="l03967" /><CodeLine lineNumber="3967"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/apint">APInt</a> TruncatedCase = Case.getCaseValue()-&gt;getValue().<a href="/docs/api/classes/llvm/apint/#a317c64fd4cfebc88e79387b3821a629d">trunc</a>(NewWidth);</Highlight></CodeLine>
<Link id="l03968" /><CodeLine lineNumber="3968"><Highlight kind="normal">      Case.setValue(ConstantInt::get(<a href="/docs/api/namespaces/llvm/si">SI</a>.getContext(), TruncatedCase));</Highlight></CodeLine>
<Link id="l03969" /><CodeLine lineNumber="3969"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03970" /><CodeLine lineNumber="3970"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac2a56636a6f3742f5e495f67e67b6b36">replaceOperand</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, 0, NewCond);</Highlight></CodeLine>
<Link id="l03971" /><CodeLine lineNumber="3971"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03972" /><CodeLine lineNumber="3972"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03973" /><CodeLine lineNumber="3973"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</Highlight></CodeLine>
<Link id="l03974" /><CodeLine lineNumber="3974"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#a68e1b07361fa3158d2c11c1af3d7ab1b">handlePotentiallyDeadSuccessors</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.getParent(), </Highlight><Highlight kind="comment">/&#42;LiveSucc&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03975" /><CodeLine lineNumber="3975"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03976" /><CodeLine lineNumber="3976"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03977" /><CodeLine lineNumber="3977"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</Highlight></CodeLine>
<Link id="l03978" /><CodeLine lineNumber="3978"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#a68e1b07361fa3158d2c11c1af3d7ab1b">handlePotentiallyDeadSuccessors</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.getParent(),</Highlight></CodeLine>
<Link id="l03979" /><CodeLine lineNumber="3979"><Highlight kind="normal">                                    <a href="/docs/api/namespaces/llvm/si">SI</a>.findCaseValue(CI)-&gt;getCaseSuccessor());</Highlight></CodeLine>
<Link id="l03980" /><CodeLine lineNumber="3980"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03981" /><CodeLine lineNumber="3981"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03982" /><CodeLine lineNumber="3982"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03983" /><CodeLine lineNumber="3983"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03984" /><CodeLine lineNumber="3984"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03985" /><CodeLine lineNumber="3985"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03986" /><CodeLine lineNumber="3986"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</Highlight></CodeLine>
<Link id="l03987" /><CodeLine lineNumber="3987"><Highlight kind="normal">InstCombinerImpl::foldExtractOfOverflowIntrinsic(<a href="/docs/api/classes/llvm/extractvalueinst">ExtractValueInst</a> &amp;EV) &#123;</Highlight></CodeLine>
<Link id="l03988" /><CodeLine lineNumber="3988"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;WithOverflowInst&gt;</a>(EV.<a href="/docs/api/classes/llvm/extractvalueinst/#ab6fc714572e1434db6d1b2a240877039">getAggregateOperand</a>());</Highlight></CodeLine>
<Link id="l03989" /><CodeLine lineNumber="3989"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!WO)</Highlight></CodeLine>
<Link id="l03990" /><CodeLine lineNumber="3990"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03991" /><CodeLine lineNumber="3991"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03992" /><CodeLine lineNumber="3992"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> OvID = WO-&gt;getIntrinsicID();</Highlight></CodeLine>
<Link id="l03993" /><CodeLine lineNumber="3993"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03994" /><CodeLine lineNumber="3994"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(WO-&gt;getRHS(), <a href="/docs/api/namespaces/llvm/patternmatch/#a59cab71d904ae725a5ef54bbf5490017">m&#95;APIntAllowPoison</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))) &#123;</Highlight></CodeLine>
<Link id="l03995" /><CodeLine lineNumber="3995"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&#42;EV.<a href="/docs/api/classes/llvm/extractvalueinst/#afcd55a28a257b9ea1708f66671b13e6e">idx&#95;begin</a>() == 0 &amp;&amp; (OvID == Intrinsic::smul&#95;with&#95;overflow ||</Highlight></CodeLine>
<Link id="l03996" /><CodeLine lineNumber="3996"><Highlight kind="normal">                                 OvID == Intrinsic::umul&#95;with&#95;overflow)) &#123;</Highlight></CodeLine>
<Link id="l03997" /><CodeLine lineNumber="3997"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// extractvalue (any&#95;mul&#95;with&#95;overflow X, -1), 0 --&gt; -X</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03998" /><CodeLine lineNumber="3998"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isAllOnes())</Highlight></CodeLine>
<Link id="l03999" /><CodeLine lineNumber="3999"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/binaryoperator/#a17c16c797477788dba165b1d6e8e862d">BinaryOperator::CreateNeg</a>(WO-&gt;getLHS());</Highlight></CodeLine>
<Link id="l04000" /><CodeLine lineNumber="4000"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// extractvalue (any&#95;mul&#95;with&#95;overflow X, 2^n), 0 --&gt; X &lt;&lt; n</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04001" /><CodeLine lineNumber="4001"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isPowerOf2()) &#123;</Highlight></CodeLine>
<Link id="l04002" /><CodeLine lineNumber="4002"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BinaryOperator::CreateShl(</Highlight></CodeLine>
<Link id="l04003" /><CodeLine lineNumber="4003"><Highlight kind="normal">            WO-&gt;getLHS(),</Highlight></CodeLine>
<Link id="l04004" /><CodeLine lineNumber="4004"><Highlight kind="normal">            ConstantInt::get(WO-&gt;getLHS()-&gt;getType(), <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;logBase2()));</Highlight></CodeLine>
<Link id="l04005" /><CodeLine lineNumber="4005"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04006" /><CodeLine lineNumber="4006"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04007" /><CodeLine lineNumber="4007"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04008" /><CodeLine lineNumber="4008"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04009" /><CodeLine lineNumber="4009"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We&#39;re extracting from an overflow intrinsic. See if we&#39;re the only user.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04010" /><CodeLine lineNumber="4010"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// That allows us to simplify multiple result intrinsics to simpler things</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04011" /><CodeLine lineNumber="4011"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that just get one value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04012" /><CodeLine lineNumber="4012"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!WO-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l04013" /><CodeLine lineNumber="4013"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04014" /><CodeLine lineNumber="4014"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04015" /><CodeLine lineNumber="4015"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if we&#39;re grabbing only the result of a &#39;with overflow&#39; intrinsic</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04016" /><CodeLine lineNumber="4016"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and replace it with a traditional binary instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04017" /><CodeLine lineNumber="4017"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&#42;EV.<a href="/docs/api/classes/llvm/extractvalueinst/#afcd55a28a257b9ea1708f66671b13e6e">idx&#95;begin</a>() == 0) &#123;</Highlight></CodeLine>
<Link id="l04018" /><CodeLine lineNumber="4018"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> BinOp = WO-&gt;getBinaryOp();</Highlight></CodeLine>
<Link id="l04019" /><CodeLine lineNumber="4019"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = WO-&gt;getLHS(), &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = WO-&gt;getRHS();</Highlight></CodeLine>
<Link id="l04020" /><CodeLine lineNumber="4020"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace the old instruction&#39;s uses with poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04021" /><CodeLine lineNumber="4021"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(&#42;WO, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(WO-&gt;getType()));</Highlight></CodeLine>
<Link id="l04022" /><CodeLine lineNumber="4022"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;WO);</Highlight></CodeLine>
<Link id="l04023" /><CodeLine lineNumber="4023"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BinOp, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</Highlight></CodeLine>
<Link id="l04024" /><CodeLine lineNumber="4024"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04025" /><CodeLine lineNumber="4025"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04026" /><CodeLine lineNumber="4026"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&#42;EV.<a href="/docs/api/classes/llvm/extractvalueinst/#afcd55a28a257b9ea1708f66671b13e6e">idx&#95;begin</a>() == 1 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unexpected extract index for overflow inst&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04027" /><CodeLine lineNumber="4027"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04028" /><CodeLine lineNumber="4028"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (usub LHS, RHS) overflows when LHS is unsigned-less-than RHS.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04029" /><CodeLine lineNumber="4029"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OvID == Intrinsic::usub&#95;with&#95;overflow)</Highlight></CodeLine>
<Link id="l04030" /><CodeLine lineNumber="4030"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> ICmpInst(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>, WO-&gt;getLHS(), WO-&gt;getRHS());</Highlight></CodeLine>
<Link id="l04031" /><CodeLine lineNumber="4031"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04032" /><CodeLine lineNumber="4032"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// smul with i1 types overflows when both sides are set: -1 &#42; -1 == +1, but</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04033" /><CodeLine lineNumber="4033"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1 is not possible because we assume signed values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04034" /><CodeLine lineNumber="4034"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OvID == Intrinsic::smul&#95;with&#95;overflow &amp;&amp;</Highlight></CodeLine>
<Link id="l04035" /><CodeLine lineNumber="4035"><Highlight kind="normal">      WO-&gt;getLHS()-&gt;getType()-&gt;isIntOrIntVectorTy(1))</Highlight></CodeLine>
<Link id="l04036" /><CodeLine lineNumber="4036"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BinaryOperator::CreateAnd(WO-&gt;getLHS(), WO-&gt;getRHS());</Highlight></CodeLine>
<Link id="l04037" /><CodeLine lineNumber="4037"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04038" /><CodeLine lineNumber="4038"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// extractvalue (umul&#95;with&#95;overflow X, X), 1 -&gt; X u&gt; 2^(N/2)-1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04039" /><CodeLine lineNumber="4039"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OvID == Intrinsic::umul&#95;with&#95;overflow &amp;&amp; WO-&gt;getLHS() == WO-&gt;getRHS()) &#123;</Highlight></CodeLine>
<Link id="l04040" /><CodeLine lineNumber="4040"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = WO-&gt;getLHS()-&gt;getType()-&gt;getScalarSizeInBits();</Highlight></CodeLine>
<Link id="l04041" /><CodeLine lineNumber="4041"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Only handle even bitwidths for performance reasons.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04042" /><CodeLine lineNumber="4042"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> % 2 == 0)</Highlight></CodeLine>
<Link id="l04043" /><CodeLine lineNumber="4043"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> ICmpInst(</Highlight></CodeLine>
<Link id="l04044" /><CodeLine lineNumber="4044"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">ICmpInst::ICMP&#95;UGT</a>, WO-&gt;getLHS(),</Highlight></CodeLine>
<Link id="l04045" /><CodeLine lineNumber="4045"><Highlight kind="normal">          ConstantInt::get(WO-&gt;getLHS()-&gt;getType(),</Highlight></CodeLine>
<Link id="l04046" /><CodeLine lineNumber="4046"><Highlight kind="normal">                           <a href="/docs/api/classes/llvm/apint/#ad960e1ff48d25c382b6d28e7961f074e">APInt::getLowBitsSet</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> / 2)));</Highlight></CodeLine>
<Link id="l04047" /><CodeLine lineNumber="4047"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04048" /><CodeLine lineNumber="4048"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04049" /><CodeLine lineNumber="4049"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If only the overflow result is used, and the right hand side is a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04050" /><CodeLine lineNumber="4050"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// constant (or constant splat), we can remove the intrinsic by directly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04051" /><CodeLine lineNumber="4051"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// checking for overflow.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04052" /><CodeLine lineNumber="4052"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &#123;</Highlight></CodeLine>
<Link id="l04053" /><CodeLine lineNumber="4053"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Compute the no-wrap range for LHS given RHS=C, then construct an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04054" /><CodeLine lineNumber="4054"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// equivalent icmp, potentially using an offset.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04055" /><CodeLine lineNumber="4055"><Highlight kind="normal">    ConstantRange NWR = <a href="/docs/api/classes/llvm/constantrange/#aeddb6f4f9ffcb9e893e5cb321b7a7f83">ConstantRange::makeExactNoWrapRegion</a>(</Highlight></CodeLine>
<Link id="l04056" /><CodeLine lineNumber="4056"><Highlight kind="normal">        WO-&gt;getBinaryOp(), &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, WO-&gt;getNoWrapKind());</Highlight></CodeLine>
<Link id="l04057" /><CodeLine lineNumber="4057"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04058" /><CodeLine lineNumber="4058"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred;</Highlight></CodeLine>
<Link id="l04059" /><CodeLine lineNumber="4059"><Highlight kind="normal">    APInt NewRHSC, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</Highlight></CodeLine>
<Link id="l04060" /><CodeLine lineNumber="4060"><Highlight kind="normal">    NWR.<a href="/docs/api/classes/llvm/constantrange/#a1616515fc811646b8cc5e6625e36b954">getEquivalentICmp</a>(Pred, NewRHSC, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</Highlight></CodeLine>
<Link id="l04061" /><CodeLine lineNumber="4061"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpTy = WO-&gt;getRHS()-&gt;getType();</Highlight></CodeLine>
<Link id="l04062" /><CodeLine lineNumber="4062"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewLHS = WO-&gt;getLHS();</Highlight></CodeLine>
<Link id="l04063" /><CodeLine lineNumber="4063"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> != 0)</Highlight></CodeLine>
<Link id="l04064" /><CodeLine lineNumber="4064"><Highlight kind="normal">      NewLHS = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateAdd(NewLHS, ConstantInt::get(OpTy, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>));</Highlight></CodeLine>
<Link id="l04065" /><CodeLine lineNumber="4065"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> ICmpInst(<a href="/docs/api/classes/llvm/cmpinst/#aa2a54b545d237ecfe450fd1292f7675e">ICmpInst::getInversePredicate</a>(Pred), NewLHS,</Highlight></CodeLine>
<Link id="l04066" /><CodeLine lineNumber="4066"><Highlight kind="normal">                        ConstantInt::get(OpTy, NewRHSC));</Highlight></CodeLine>
<Link id="l04067" /><CodeLine lineNumber="4067"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04068" /><CodeLine lineNumber="4068"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04069" /><CodeLine lineNumber="4069"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04070" /><CodeLine lineNumber="4070"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04071" /><CodeLine lineNumber="4071"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04072" /><CodeLine lineNumber="4072" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a679f36556ace611ccc56580cb497973a"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a679f36556ace611ccc56580cb497973a">InstCombinerImpl::visitExtractValueInst</a>(<a href="/docs/api/classes/llvm/extractvalueinst">ExtractValueInst</a> &amp;EV) &#123;</Highlight></CodeLine>
<Link id="l04073" /><CodeLine lineNumber="4073"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Agg = EV.<a href="/docs/api/classes/llvm/extractvalueinst/#ab6fc714572e1434db6d1b2a240877039">getAggregateOperand</a>();</Highlight></CodeLine>
<Link id="l04074" /><CodeLine lineNumber="4074"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04075" /><CodeLine lineNumber="4075"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!EV.<a href="/docs/api/classes/llvm/extractvalueinst/#adcb2c5c48153bf5892d78301517fe59b">hasIndices</a>())</Highlight></CodeLine>
<Link id="l04076" /><CodeLine lineNumber="4076"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(EV, Agg);</Highlight></CodeLine>
<Link id="l04077" /><CodeLine lineNumber="4077"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04078" /><CodeLine lineNumber="4078"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a9442ed00a8dff89558d50f9c150951ff">simplifyExtractValueInst</a>(Agg, EV.<a href="/docs/api/classes/llvm/extractvalueinst/#a089f295919afbb059f9f745206094002">getIndices</a>(),</Highlight></CodeLine>
<Link id="l04079" /><CodeLine lineNumber="4079"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;EV)))</Highlight></CodeLine>
<Link id="l04080" /><CodeLine lineNumber="4080"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(EV, V);</Highlight></CodeLine>
<Link id="l04081" /><CodeLine lineNumber="4081"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04082" /><CodeLine lineNumber="4082"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/insertvalueinst">InsertValueInst</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InsertValueInst&gt;</a>(Agg)) &#123;</Highlight></CodeLine>
<Link id="l04083" /><CodeLine lineNumber="4083"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We&#39;re extracting from an insertvalue instruction, compare the indices</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04084" /><CodeLine lineNumber="4084"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> &#42;exti, &#42;exte, &#42;insi, &#42;inse;</Highlight></CodeLine>
<Link id="l04085" /><CodeLine lineNumber="4085"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (exti = EV.<a href="/docs/api/classes/llvm/extractvalueinst/#afcd55a28a257b9ea1708f66671b13e6e">idx&#95;begin</a>(), insi = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;idx&#95;begin(),</Highlight></CodeLine>
<Link id="l04086" /><CodeLine lineNumber="4086"><Highlight kind="normal">         exte = EV.<a href="/docs/api/classes/llvm/extractvalueinst/#a949ac9df3b15e4f72940cea79d8298b5">idx&#95;end</a>(), inse = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;idx&#95;end();</Highlight></CodeLine>
<Link id="l04087" /><CodeLine lineNumber="4087"><Highlight kind="normal">         exti != exte &amp;&amp; insi != inse;</Highlight></CodeLine>
<Link id="l04088" /><CodeLine lineNumber="4088"><Highlight kind="normal">         ++exti, ++insi) &#123;</Highlight></CodeLine>
<Link id="l04089" /><CodeLine lineNumber="4089"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&#42;insi != &#42;exti)</Highlight></CodeLine>
<Link id="l04090" /><CodeLine lineNumber="4090"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// The insert and extract both reference distinctly different elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04091" /><CodeLine lineNumber="4091"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// This means the extract is not influenced by the insert, and we can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04092" /><CodeLine lineNumber="4092"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// replace the aggregate operand of the extract with the aggregate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04093" /><CodeLine lineNumber="4093"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// operand of the insert. i.e., replace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04094" /><CodeLine lineNumber="4094"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// %I = insertvalue &#123; i32, &#123; i32 &#125; &#125; %A, &#123; i32 &#125; &#123; i32 42 &#125;, 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04095" /><CodeLine lineNumber="4095"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// %E = extractvalue &#123; i32, &#123; i32 &#125; &#125; %I, 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04096" /><CodeLine lineNumber="4096"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04097" /><CodeLine lineNumber="4097"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// %E = extractvalue &#123; i32, &#123; i32 &#125; &#125; %A, 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04098" /><CodeLine lineNumber="4098"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/extractvalueinst/#a94c8c620b21236971c734ff2913e99f3">ExtractValueInst::Create</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getAggregateOperand(),</Highlight></CodeLine>
<Link id="l04099" /><CodeLine lineNumber="4099"><Highlight kind="normal">                                        EV.<a href="/docs/api/classes/llvm/extractvalueinst/#a089f295919afbb059f9f745206094002">getIndices</a>());</Highlight></CodeLine>
<Link id="l04100" /><CodeLine lineNumber="4100"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04101" /><CodeLine lineNumber="4101"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (exti == exte &amp;&amp; insi == inse)</Highlight></CodeLine>
<Link id="l04102" /><CodeLine lineNumber="4102"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Both iterators are at the end: Index lists are identical. Replace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04103" /><CodeLine lineNumber="4103"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %B = insertvalue &#123; i32, &#123; i32 &#125; &#125; %A, i32 42, 1, 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04104" /><CodeLine lineNumber="4104"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %C = extractvalue &#123; i32, &#123; i32 &#125; &#125; %B, 1, 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04105" /><CodeLine lineNumber="4105"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// with &quot;i32 42&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04106" /><CodeLine lineNumber="4106"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(EV, <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getInsertedValueOperand());</Highlight></CodeLine>
<Link id="l04107" /><CodeLine lineNumber="4107"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (exti == exte) &#123;</Highlight></CodeLine>
<Link id="l04108" /><CodeLine lineNumber="4108"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The extract list is a prefix of the insert list. i.e. replace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04109" /><CodeLine lineNumber="4109"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %I = insertvalue &#123; i32, &#123; i32 &#125; &#125; %A, i32 42, 1, 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04110" /><CodeLine lineNumber="4110"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %E = extractvalue &#123; i32, &#123; i32 &#125; &#125; %I, 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04111" /><CodeLine lineNumber="4111"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04112" /><CodeLine lineNumber="4112"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %X = extractvalue &#123; i32, &#123; i32 &#125; &#125; %A, 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04113" /><CodeLine lineNumber="4113"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %E = insertvalue &#123; i32 &#125; %X, i32 42, 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04114" /><CodeLine lineNumber="4114"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// by switching the order of the insert and extract (though the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04115" /><CodeLine lineNumber="4115"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// insertvalue should be left in, since it may have other uses).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04116" /><CodeLine lineNumber="4116"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewEV = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateExtractValue(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getAggregateOperand(),</Highlight></CodeLine>
<Link id="l04117" /><CodeLine lineNumber="4117"><Highlight kind="normal">                                                EV.<a href="/docs/api/classes/llvm/extractvalueinst/#a089f295919afbb059f9f745206094002">getIndices</a>());</Highlight></CodeLine>
<Link id="l04118" /><CodeLine lineNumber="4118"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/insertvalueinst/#acc871ff3698895f1efc402d2482032b9">InsertValueInst::Create</a>(NewEV, <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getInsertedValueOperand(),</Highlight></CodeLine>
<Link id="l04119" /><CodeLine lineNumber="4119"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>(insi, inse));</Highlight></CodeLine>
<Link id="l04120" /><CodeLine lineNumber="4120"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04121" /><CodeLine lineNumber="4121"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (insi == inse)</Highlight></CodeLine>
<Link id="l04122" /><CodeLine lineNumber="4122"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The insert list is a prefix of the extract list</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04123" /><CodeLine lineNumber="4123"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We can simply remove the common indices from the extract and make it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04124" /><CodeLine lineNumber="4124"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// operate on the inserted value instead of the insertvalue result.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04125" /><CodeLine lineNumber="4125"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// i.e., replace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04126" /><CodeLine lineNumber="4126"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %I = insertvalue &#123; i32, &#123; i32 &#125; &#125; %A, &#123; i32 &#125; &#123; i32 42 &#125;, 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04127" /><CodeLine lineNumber="4127"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %E = extractvalue &#123; i32, &#123; i32 &#125; &#125; %I, 1, 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04128" /><CodeLine lineNumber="4128"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04129" /><CodeLine lineNumber="4129"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// %E extractvalue &#123; i32 &#125; &#123; i32 42 &#125;, 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04130" /><CodeLine lineNumber="4130"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/extractvalueinst/#a94c8c620b21236971c734ff2913e99f3">ExtractValueInst::Create</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getInsertedValueOperand(),</Highlight></CodeLine>
<Link id="l04131" /><CodeLine lineNumber="4131"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>(exti, exte));</Highlight></CodeLine>
<Link id="l04132" /><CodeLine lineNumber="4132"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04133" /><CodeLine lineNumber="4133"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04134" /><CodeLine lineNumber="4134"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;R = foldExtractOfOverflowIntrinsic(EV))</Highlight></CodeLine>
<Link id="l04135" /><CodeLine lineNumber="4135"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> R;</Highlight></CodeLine>
<Link id="l04136" /><CodeLine lineNumber="4136"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04137" /><CodeLine lineNumber="4137"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;L = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(Agg)) &#123;</Highlight></CodeLine>
<Link id="l04138" /><CodeLine lineNumber="4138"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Bail out if the aggregate contains scalable vector type</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04139" /><CodeLine lineNumber="4139"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;STy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StructType&gt;</a>(Agg-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l04140" /><CodeLine lineNumber="4140"><Highlight kind="normal">        STy &amp;&amp; STy-&gt;isScalableTy())</Highlight></CodeLine>
<Link id="l04141" /><CodeLine lineNumber="4141"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04142" /><CodeLine lineNumber="4142"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04143" /><CodeLine lineNumber="4143"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the (non-volatile) load only has one use, we can rewrite this to a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04144" /><CodeLine lineNumber="4144"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// load from a GEP. This reduces the size of the load. If a load is used</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04145" /><CodeLine lineNumber="4145"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// only by extractvalue instructions then this either must have been</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04146" /><CodeLine lineNumber="4146"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// optimized before, or it is a struct with padding, in which case we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04147" /><CodeLine lineNumber="4147"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// don&#39;t want to do the transformation as it loses padding knowledge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04148" /><CodeLine lineNumber="4148"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (L-&gt;isSimple() &amp;&amp; L-&gt;hasOneUse()) &#123;</Highlight></CodeLine>
<Link id="l04149" /><CodeLine lineNumber="4149"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// extractvalue has integer indices, getelementptr has Value&#42;s. Convert.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04150" /><CodeLine lineNumber="4150"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value&#42;, 4&gt;</a> Indices;</Highlight></CodeLine>
<Link id="l04151" /><CodeLine lineNumber="4151"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Prefix an i32 0 since we need the first element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04152" /><CodeLine lineNumber="4152"><Highlight kind="normal">      Indices.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.getInt32(0));</Highlight></CodeLine>
<Link id="l04153" /><CodeLine lineNumber="4153"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx : EV.<a href="/docs/api/classes/llvm/extractvalueinst/#a767130a28a6a9148ab3f2cf451fc9375">indices</a>())</Highlight></CodeLine>
<Link id="l04154" /><CodeLine lineNumber="4154"><Highlight kind="normal">        Indices.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.getInt32(Idx));</Highlight></CodeLine>
<Link id="l04155" /><CodeLine lineNumber="4155"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04156" /><CodeLine lineNumber="4156"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We need to insert these at the location of the old load, not at that of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04157" /><CodeLine lineNumber="4157"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the extractvalue.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04158" /><CodeLine lineNumber="4158"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.SetInsertPoint(L);</Highlight></CodeLine>
<Link id="l04159" /><CodeLine lineNumber="4159"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateInBoundsGEP(L-&gt;getType(),</Highlight></CodeLine>
<Link id="l04160" /><CodeLine lineNumber="4160"><Highlight kind="normal">                                             L-&gt;getPointerOperand(), Indices);</Highlight></CodeLine>
<Link id="l04161" /><CodeLine lineNumber="4161"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NL = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateLoad(EV.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>);</Highlight></CodeLine>
<Link id="l04162" /><CodeLine lineNumber="4162"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Whatever aliasing information we had for the orignal load must also</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04163" /><CodeLine lineNumber="4163"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// hold for the smaller load, so propagate the annotations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04164" /><CodeLine lineNumber="4164"><Highlight kind="normal">      NL-&gt;<a href="/docs/api/classes/llvm/instruction/#a4dd9b6c5bb93e01393c47dbe60f8b23f">setAAMetadata</a>(L-&gt;getAAMetadata());</Highlight></CodeLine>
<Link id="l04165" /><CodeLine lineNumber="4165"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Returning the load directly will cause the main loop to insert it in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04166" /><CodeLine lineNumber="4166"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the wrong spot, so use replaceInstUsesWith().</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04167" /><CodeLine lineNumber="4167"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(EV, NL);</Highlight></CodeLine>
<Link id="l04168" /><CodeLine lineNumber="4168"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04169" /><CodeLine lineNumber="4169"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04170" /><CodeLine lineNumber="4170"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04171" /><CodeLine lineNumber="4171"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Agg))</Highlight></CodeLine>
<Link id="l04172" /><CodeLine lineNumber="4172"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Res = <a href="/docs/api/classes/llvm/instcombinerimpl/#a2fc50d227d302eb98914f04bcc6634e1">foldOpIntoPhi</a>(EV, PN))</Highlight></CodeLine>
<Link id="l04173" /><CodeLine lineNumber="4173"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Res;</Highlight></CodeLine>
<Link id="l04174" /><CodeLine lineNumber="4174"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04175" /><CodeLine lineNumber="4175"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Canonicalize extract (select Cond, TV, FV)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04176" /><CodeLine lineNumber="4176"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// -&gt; select cond, (extract TV), (extract FV)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04177" /><CodeLine lineNumber="4177"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(Agg))</Highlight></CodeLine>
<Link id="l04178" /><CodeLine lineNumber="4178"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;R = <a href="/docs/api/classes/llvm/instcombinerimpl/#a039111728e11b1cdf25e60446ae17f2a">FoldOpIntoSelect</a>(EV, <a href="/docs/api/namespaces/llvm/si">SI</a>, </Highlight><Highlight kind="comment">/&#42;FoldWithMultiUse=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l04179" /><CodeLine lineNumber="4179"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> R;</Highlight></CodeLine>
<Link id="l04180" /><CodeLine lineNumber="4180"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04181" /><CodeLine lineNumber="4181"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We could simplify extracts from other values. Note that nested extracts may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04182" /><CodeLine lineNumber="4182"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// already be simplified implicitly by the above: extract (extract (insert) )</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04183" /><CodeLine lineNumber="4183"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will be translated into extract ( insert ( extract ) ) first and then just</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04184" /><CodeLine lineNumber="4184"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the value inserted, if appropriate. Similarly for extracts from single-use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04185" /><CodeLine lineNumber="4185"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loads: extract (extract (load)) will be translated to extract (load (gep))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04186" /><CodeLine lineNumber="4186"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and if again single-use then via load (gep (gep)) to load (gep).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04187" /><CodeLine lineNumber="4187"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// However, double extracts from e.g. function arguments or return values</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04188" /><CodeLine lineNumber="4188"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// aren&#39;t handled yet.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04189" /><CodeLine lineNumber="4189"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04190" /><CodeLine lineNumber="4190"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04191" /><CodeLine lineNumber="4191"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04192" /><CodeLine lineNumber="4192"><Highlight kind="comment">/// Return &#39;true&#39; if the given typeinfo will match anything.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04193" /><CodeLine lineNumber="4193" lineLink="#ae4125133d683a4652b396ec3b18cd92e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ae4125133d683a4652b396ec3b18cd92e">isCatchAll</a>(<a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6a">EHPersonality</a> Personality, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;TypeInfo) &#123;</Highlight></CodeLine>
<Link id="l04194" /><CodeLine lineNumber="4194"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (Personality) &#123;</Highlight></CodeLine>
<Link id="l04195" /><CodeLine lineNumber="4195"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aa4c0484152e8ccb276b690a1f664b2480">EHPersonality::GNU&#95;C</a>:</Highlight></CodeLine>
<Link id="l04196" /><CodeLine lineNumber="4196"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aae83ea70f8c69153f8fb6aed8edc63ce8">EHPersonality::GNU&#95;C&#95;SjLj</a>:</Highlight></CodeLine>
<Link id="l04197" /><CodeLine lineNumber="4197"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aaf5e265d607cb720058fc166e00083fe8">EHPersonality::Rust</a>:</Highlight></CodeLine>
<Link id="l04198" /><CodeLine lineNumber="4198"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The GCC C EH and Rust personality only exists to support cleanups, so</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04199" /><CodeLine lineNumber="4199"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// it&#39;s not clear what the semantics of catch clauses are.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04200" /><CodeLine lineNumber="4200"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04201" /><CodeLine lineNumber="4201"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aa88183b946cc5f0e8c96b2e66e1c74a7e">EHPersonality::Unknown</a>:</Highlight></CodeLine>
<Link id="l04202" /><CodeLine lineNumber="4202"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04203" /><CodeLine lineNumber="4203"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aa4d1f6c49eb4a44a6cc14725ba0cfe658">EHPersonality::GNU&#95;Ada</a>:</Highlight></CodeLine>
<Link id="l04204" /><CodeLine lineNumber="4204"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// While &#95;&#95;gnat&#95;all&#95;others&#95;value will match any Ada exception, it doesn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04205" /><CodeLine lineNumber="4205"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// match foreign exceptions (or didn&#39;t, before gcc-4.7).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04206" /><CodeLine lineNumber="4206"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04207" /><CodeLine lineNumber="4207"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aac19ef91dbd2fa5148e96a750c2b5c4cb">EHPersonality::GNU&#95;CXX</a>:</Highlight></CodeLine>
<Link id="l04208" /><CodeLine lineNumber="4208"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aa827e35d1ece0eb007816f52f42e87007">EHPersonality::GNU&#95;CXX&#95;SjLj</a>:</Highlight></CodeLine>
<Link id="l04209" /><CodeLine lineNumber="4209"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aa395fbfe74c30a81fe4f743ba95964c86">EHPersonality::GNU&#95;ObjC</a>:</Highlight></CodeLine>
<Link id="l04210" /><CodeLine lineNumber="4210"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aa1d0ce965d5884b3d11d6f26fac012613">EHPersonality::MSVC&#95;X86SEH</a>:</Highlight></CodeLine>
<Link id="l04211" /><CodeLine lineNumber="4211"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aa5fe2b2d01019e4b6a9828d4b9820a7ce">EHPersonality::MSVC&#95;TableSEH</a>:</Highlight></CodeLine>
<Link id="l04212" /><CodeLine lineNumber="4212"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aab34bedfd8d86f0adbefe4ae0e708f428">EHPersonality::MSVC&#95;CXX</a>:</Highlight></CodeLine>
<Link id="l04213" /><CodeLine lineNumber="4213"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aa05b0e25c98ba4300ca28989a35dab72a">EHPersonality::CoreCLR</a>:</Highlight></CodeLine>
<Link id="l04214" /><CodeLine lineNumber="4214"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aa7939c43653700c52daa7a68a575c3ec5">EHPersonality::Wasm&#95;CXX</a>:</Highlight></CodeLine>
<Link id="l04215" /><CodeLine lineNumber="4215"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aac3cb0fb563149ec44c47b526c7b0a0d2">EHPersonality::XL&#95;CXX</a>:</Highlight></CodeLine>
<Link id="l04216" /><CodeLine lineNumber="4216"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6aae41eac69861c981fbdd0a270668ea387">EHPersonality::ZOS&#95;CXX</a>:</Highlight></CodeLine>
<Link id="l04217" /><CodeLine lineNumber="4217"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TypeInfo-&gt;<a href="/docs/api/classes/llvm/constant/#ae4b6abe77abf42fb02081a6cc41a0132">isNullValue</a>();</Highlight></CodeLine>
<Link id="l04218" /><CodeLine lineNumber="4218"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04219" /><CodeLine lineNumber="4219"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;invalid enum&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04220" /><CodeLine lineNumber="4220"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04221" /><CodeLine lineNumber="4221"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04222" /><CodeLine lineNumber="4222" lineLink="#a13d41ea63582902162e0efd8a78a5ad5"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a13d41ea63582902162e0efd8a78a5ad5">shorter&#95;filter</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l04223" /><CodeLine lineNumber="4223"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04224" /><CodeLine lineNumber="4224"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ArrayType&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getType())-&gt;getNumElements()</Highlight></CodeLine>
<Link id="l04225" /><CodeLine lineNumber="4225"><Highlight kind="normal">  &lt;</Highlight></CodeLine>
<Link id="l04226" /><CodeLine lineNumber="4226"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ArrayType&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getType())-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l04227" /><CodeLine lineNumber="4227"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04228" /><CodeLine lineNumber="4228"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04229" /><CodeLine lineNumber="4229" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a7af99fa2202fcc7db245865dd1bcec1f"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a7af99fa2202fcc7db245865dd1bcec1f">InstCombinerImpl::visitLandingPadInst</a>(<a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &amp;LI) &#123;</Highlight></CodeLine>
<Link id="l04230" /><CodeLine lineNumber="4230"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The logic here should be correct for any real-world personality function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04231" /><CodeLine lineNumber="4231"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// However if that turns out not to be true, the offending logic can always</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04232" /><CodeLine lineNumber="4232"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// be conditioned on the personality function, like the catch-all logic is.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04233" /><CodeLine lineNumber="4233"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a5d56157a385f8cd7d3e54ed87da1ba6a">EHPersonality</a> Personality =</Highlight></CodeLine>
<Link id="l04234" /><CodeLine lineNumber="4234"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a8d508f23e2580095561902c39911fb9b">classifyEHPersonality</a>(LI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent()-&gt;getPersonalityFn());</Highlight></CodeLine>
<Link id="l04235" /><CodeLine lineNumber="4235"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04236" /><CodeLine lineNumber="4236"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Simplify the list of clauses, eg by removing repeated catch clauses</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04237" /><CodeLine lineNumber="4237"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (these are often created by inlining).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04238" /><CodeLine lineNumber="4238"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MakeNewInstruction = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// If true, recreate using the following:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04239" /><CodeLine lineNumber="4239"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;, 16&gt;</a> NewClauses; </Highlight><Highlight kind="comment">// - Clauses for the new instruction;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04240" /><CodeLine lineNumber="4240"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CleanupFlag = LI.<a href="/docs/api/classes/llvm/landingpadinst/#a0966e2f38f20609a643b5d5e3da8bae5">isCleanup</a>();   </Highlight><Highlight kind="comment">// - The new instruction is a cleanup.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04241" /><CodeLine lineNumber="4241"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04242" /><CodeLine lineNumber="4242"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 16&gt;</a> AlreadyCaught; </Highlight><Highlight kind="comment">// Typeinfos known caught already.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04243" /><CodeLine lineNumber="4243"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = LI.<a href="/docs/api/classes/llvm/landingpadinst/#a1d25e478c9de2656ce4c793a8b80e537">getNumClauses</a>(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l04244" /><CodeLine lineNumber="4244"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isLastClause = i + 1 == e;</Highlight></CodeLine>
<Link id="l04245" /><CodeLine lineNumber="4245"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LI.<a href="/docs/api/classes/llvm/landingpadinst/#a74e94530fdc21fe0a7eb5465437c980f">isCatch</a>(i)) &#123;</Highlight></CodeLine>
<Link id="l04246" /><CodeLine lineNumber="4246"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// A catch clause.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04247" /><CodeLine lineNumber="4247"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CatchClause = LI.<a href="/docs/api/classes/llvm/landingpadinst/#a836dacc5f24807bbc216145ff7de36ab">getClause</a>(i);</Highlight></CodeLine>
<Link id="l04248" /><CodeLine lineNumber="4248"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;TypeInfo = CatchClause-&gt;<a href="/docs/api/classes/llvm/constant/#a6c6af867b9eca0a16600b50e31df0e33">stripPointerCasts</a>();</Highlight></CodeLine>
<Link id="l04249" /><CodeLine lineNumber="4249"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04250" /><CodeLine lineNumber="4250"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we already saw this clause, there is no point in having a second</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04251" /><CodeLine lineNumber="4251"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// copy of it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04252" /><CodeLine lineNumber="4252"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AlreadyCaught.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(TypeInfo).second) &#123;</Highlight></CodeLine>
<Link id="l04253" /><CodeLine lineNumber="4253"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// This catch clause was not already seen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04254" /><CodeLine lineNumber="4254"><Highlight kind="normal">        NewClauses.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CatchClause);</Highlight></CodeLine>
<Link id="l04255" /><CodeLine lineNumber="4255"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04256" /><CodeLine lineNumber="4256"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Repeated catch clause - drop the redundant copy.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04257" /><CodeLine lineNumber="4257"><Highlight kind="normal">        MakeNewInstruction = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04258" /><CodeLine lineNumber="4258"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04259" /><CodeLine lineNumber="4259"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04260" /><CodeLine lineNumber="4260"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If this is a catch-all then there is no point in keeping any following</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04261" /><CodeLine lineNumber="4261"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// clauses or marking the landingpad as having a cleanup.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04262" /><CodeLine lineNumber="4262"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ae4125133d683a4652b396ec3b18cd92e">isCatchAll</a>(Personality, TypeInfo)) &#123;</Highlight></CodeLine>
<Link id="l04263" /><CodeLine lineNumber="4263"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!isLastClause)</Highlight></CodeLine>
<Link id="l04264" /><CodeLine lineNumber="4264"><Highlight kind="normal">          MakeNewInstruction = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04265" /><CodeLine lineNumber="4265"><Highlight kind="normal">        CleanupFlag = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04266" /><CodeLine lineNumber="4266"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04267" /><CodeLine lineNumber="4267"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04268" /><CodeLine lineNumber="4268"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04269" /><CodeLine lineNumber="4269"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// A filter clause.  If any of the filter elements were already caught</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04270" /><CodeLine lineNumber="4270"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// then they can be dropped from the filter.  It is tempting to try to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04271" /><CodeLine lineNumber="4271"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// exploit the filter further by saying that any typeinfo that does not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04272" /><CodeLine lineNumber="4272"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// occur in the filter can&#39;t be caught later (and thus can be dropped).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04273" /><CodeLine lineNumber="4273"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// However this would be wrong, since typeinfos can match without being</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04274" /><CodeLine lineNumber="4274"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// equal (for example if one represents a C++ class, and the other some</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04275" /><CodeLine lineNumber="4275"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// class derived from it).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04276" /><CodeLine lineNumber="4276"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI.<a href="/docs/api/classes/llvm/landingpadinst/#a794866f5c0f6877de0b1dd863ceaf93e">isFilter</a>(i) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unsupported landingpad clause!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04277" /><CodeLine lineNumber="4277"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;FilterClause = LI.<a href="/docs/api/classes/llvm/landingpadinst/#a836dacc5f24807bbc216145ff7de36ab">getClause</a>(i);</Highlight></CodeLine>
<Link id="l04278" /><CodeLine lineNumber="4278"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/arraytype">ArrayType</a> &#42;FilterType = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ArrayType&gt;</a>(FilterClause-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l04279" /><CodeLine lineNumber="4279"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumTypeInfos = FilterType-&gt;<a href="/docs/api/classes/llvm/arraytype/#a1c35bd7a4fa08845607033aecc94423d">getNumElements</a>();</Highlight></CodeLine>
<Link id="l04280" /><CodeLine lineNumber="4280"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04281" /><CodeLine lineNumber="4281"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// An empty filter catches everything, so there is no point in keeping any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04282" /><CodeLine lineNumber="4282"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// following clauses or marking the landingpad as having a cleanup.  By</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04283" /><CodeLine lineNumber="4283"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// dealing with this case here the following code is made a bit simpler.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04284" /><CodeLine lineNumber="4284"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NumTypeInfos) &#123;</Highlight></CodeLine>
<Link id="l04285" /><CodeLine lineNumber="4285"><Highlight kind="normal">        NewClauses.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FilterClause);</Highlight></CodeLine>
<Link id="l04286" /><CodeLine lineNumber="4286"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!isLastClause)</Highlight></CodeLine>
<Link id="l04287" /><CodeLine lineNumber="4287"><Highlight kind="normal">          MakeNewInstruction = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04288" /><CodeLine lineNumber="4288"><Highlight kind="normal">        CleanupFlag = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04289" /><CodeLine lineNumber="4289"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04290" /><CodeLine lineNumber="4290"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04291" /><CodeLine lineNumber="4291"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04292" /><CodeLine lineNumber="4292"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MakeNewFilter = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// If true, make a new filter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04293" /><CodeLine lineNumber="4293"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;, 16&gt;</a> NewFilterElts; </Highlight><Highlight kind="comment">// New elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04294" /><CodeLine lineNumber="4294"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantAggregateZero&gt;</a>(FilterClause)) &#123;</Highlight></CodeLine>
<Link id="l04295" /><CodeLine lineNumber="4295"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Not an empty filter - it contains at least one null typeinfo.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04296" /><CodeLine lineNumber="4296"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumTypeInfos &gt; 0 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Should have handled empty filter already!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04297" /><CodeLine lineNumber="4297"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;TypeInfo =</Highlight></CodeLine>
<Link id="l04298" /><CodeLine lineNumber="4298"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(FilterType-&gt;<a href="/docs/api/classes/llvm/arraytype/#aed75da684d36221f1f7b9fbf5aa3aed8">getElementType</a>());</Highlight></CodeLine>
<Link id="l04299" /><CodeLine lineNumber="4299"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If this typeinfo is a catch-all then the filter can never match.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04300" /><CodeLine lineNumber="4300"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ae4125133d683a4652b396ec3b18cd92e">isCatchAll</a>(Personality, TypeInfo)) &#123;</Highlight></CodeLine>
<Link id="l04301" /><CodeLine lineNumber="4301"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Throw the filter away.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04302" /><CodeLine lineNumber="4302"><Highlight kind="normal">          MakeNewInstruction = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04303" /><CodeLine lineNumber="4303"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04304" /><CodeLine lineNumber="4304"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l04305" /><CodeLine lineNumber="4305"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04306" /><CodeLine lineNumber="4306"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// There is no point in having multiple copies of this typeinfo, so</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04307" /><CodeLine lineNumber="4307"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// discard all but the first copy if there is more than one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04308" /><CodeLine lineNumber="4308"><Highlight kind="normal">        NewFilterElts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(TypeInfo);</Highlight></CodeLine>
<Link id="l04309" /><CodeLine lineNumber="4309"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumTypeInfos &gt; 1)</Highlight></CodeLine>
<Link id="l04310" /><CodeLine lineNumber="4310"><Highlight kind="normal">          MakeNewFilter = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04311" /><CodeLine lineNumber="4311"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04312" /><CodeLine lineNumber="4312"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/constantarray">ConstantArray</a> &#42;<a href="/docs/api/namespaces/llvm/#aaee5189b9c4db9ad666a88abaf1ee0c4ad7778d0c64b6ba21494c97f77a66885a">Filter</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantArray&gt;</a>(FilterClause);</Highlight></CodeLine>
<Link id="l04313" /><CodeLine lineNumber="4313"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 16&gt;</a> SeenInFilter; </Highlight><Highlight kind="comment">// For uniquing the elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04314" /><CodeLine lineNumber="4314"><Highlight kind="normal">        NewFilterElts.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(NumTypeInfos);</Highlight></CodeLine>
<Link id="l04315" /><CodeLine lineNumber="4315"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04316" /><CodeLine lineNumber="4316"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Remove any filter elements that were already caught or that already</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04317" /><CodeLine lineNumber="4317"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// occurred in the filter.  While there, see if any of the elements are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04318" /><CodeLine lineNumber="4318"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// catch-alls.  If so, the filter can be discarded.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04319" /><CodeLine lineNumber="4319"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> SawCatchAll = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04320" /><CodeLine lineNumber="4320"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> j = 0; j != NumTypeInfos; ++j) &#123;</Highlight></CodeLine>
<Link id="l04321" /><CodeLine lineNumber="4321"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Elt = <a href="/docs/api/namespaces/llvm/#aaee5189b9c4db9ad666a88abaf1ee0c4ad7778d0c64b6ba21494c97f77a66885a">Filter</a>-&gt;getOperand(j);</Highlight></CodeLine>
<Link id="l04322" /><CodeLine lineNumber="4322"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;TypeInfo = Elt-&gt;<a href="/docs/api/classes/llvm/constant/#a6c6af867b9eca0a16600b50e31df0e33">stripPointerCasts</a>();</Highlight></CodeLine>
<Link id="l04323" /><CodeLine lineNumber="4323"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ae4125133d683a4652b396ec3b18cd92e">isCatchAll</a>(Personality, TypeInfo)) &#123;</Highlight></CodeLine>
<Link id="l04324" /><CodeLine lineNumber="4324"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// This element is a catch-all.  Bail out, noting this fact.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04325" /><CodeLine lineNumber="4325"><Highlight kind="normal">            SawCatchAll = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04326" /><CodeLine lineNumber="4326"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04327" /><CodeLine lineNumber="4327"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l04328" /><CodeLine lineNumber="4328"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04329" /><CodeLine lineNumber="4329"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Even if we&#39;ve seen a type in a catch clause, we don&#39;t want to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04330" /><CodeLine lineNumber="4330"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// remove it from the filter.  An unexpected type handler may be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04331" /><CodeLine lineNumber="4331"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// set up for a call site which throws an exception of the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04332" /><CodeLine lineNumber="4332"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// type caught.  In order for the exception thrown by the unexpected</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04333" /><CodeLine lineNumber="4333"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// handler to propagate correctly, the filter must be correctly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04334" /><CodeLine lineNumber="4334"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// described for the call site.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04335" /><CodeLine lineNumber="4335"><Highlight kind="normal">          </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04336" /><CodeLine lineNumber="4336"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04337" /><CodeLine lineNumber="4337"><Highlight kind="normal">          </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04338" /><CodeLine lineNumber="4338"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// void unexpected() &#123; throw 1;&#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04339" /><CodeLine lineNumber="4339"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// void foo() throw (int) &#123;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04340" /><CodeLine lineNumber="4340"><Highlight kind="normal">          </Highlight><Highlight kind="comment">//   std::set&#95;unexpected(unexpected);</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04341" /><CodeLine lineNumber="4341"><Highlight kind="normal">          </Highlight><Highlight kind="comment">//   try &#123;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04342" /><CodeLine lineNumber="4342"><Highlight kind="normal">          </Highlight><Highlight kind="comment">//     throw 2.0;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04343" /><CodeLine lineNumber="4343"><Highlight kind="normal">          </Highlight><Highlight kind="comment">//   &#125; catch (int i) &#123;&#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04344" /><CodeLine lineNumber="4344"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04345" /><CodeLine lineNumber="4345"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04346" /><CodeLine lineNumber="4346"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// There is no point in having multiple copies of the same typeinfo in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04347" /><CodeLine lineNumber="4347"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// a filter, so only add it if we didn&#39;t already.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04348" /><CodeLine lineNumber="4348"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SeenInFilter.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(TypeInfo).second)</Highlight></CodeLine>
<Link id="l04349" /><CodeLine lineNumber="4349"><Highlight kind="normal">            NewFilterElts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(Elt));</Highlight></CodeLine>
<Link id="l04350" /><CodeLine lineNumber="4350"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l04351" /><CodeLine lineNumber="4351"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// A filter containing a catch-all cannot match anything by definition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04352" /><CodeLine lineNumber="4352"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SawCatchAll) &#123;</Highlight></CodeLine>
<Link id="l04353" /><CodeLine lineNumber="4353"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Throw the filter away.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04354" /><CodeLine lineNumber="4354"><Highlight kind="normal">          MakeNewInstruction = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04355" /><CodeLine lineNumber="4355"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04356" /><CodeLine lineNumber="4356"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l04357" /><CodeLine lineNumber="4357"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04358" /><CodeLine lineNumber="4358"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If we dropped something from the filter, make a new one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04359" /><CodeLine lineNumber="4359"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewFilterElts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt; NumTypeInfos)</Highlight></CodeLine>
<Link id="l04360" /><CodeLine lineNumber="4360"><Highlight kind="normal">          MakeNewFilter = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04361" /><CodeLine lineNumber="4361"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04362" /><CodeLine lineNumber="4362"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MakeNewFilter) &#123;</Highlight></CodeLine>
<Link id="l04363" /><CodeLine lineNumber="4363"><Highlight kind="normal">        FilterType = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(FilterType-&gt;<a href="/docs/api/classes/llvm/arraytype/#aed75da684d36221f1f7b9fbf5aa3aed8">getElementType</a>(),</Highlight></CodeLine>
<Link id="l04364" /><CodeLine lineNumber="4364"><Highlight kind="normal">                                    NewFilterElts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</Highlight></CodeLine>
<Link id="l04365" /><CodeLine lineNumber="4365"><Highlight kind="normal">        FilterClause = <a href="/docs/api/classes/llvm/constantarray/#a0900dacdc7ad8e3ea0cc92993c7fd422">ConstantArray::get</a>(FilterType, NewFilterElts);</Highlight></CodeLine>
<Link id="l04366" /><CodeLine lineNumber="4366"><Highlight kind="normal">        MakeNewInstruction = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04367" /><CodeLine lineNumber="4367"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04368" /><CodeLine lineNumber="4368"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04369" /><CodeLine lineNumber="4369"><Highlight kind="normal">      NewClauses.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FilterClause);</Highlight></CodeLine>
<Link id="l04370" /><CodeLine lineNumber="4370"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04371" /><CodeLine lineNumber="4371"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the new filter is empty then it will catch everything so there is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04372" /><CodeLine lineNumber="4372"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// no point in keeping any following clauses or marking the landingpad</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04373" /><CodeLine lineNumber="4373"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// as having a cleanup.  The case of the original filter being empty was</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04374" /><CodeLine lineNumber="4374"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// already handled above.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04375" /><CodeLine lineNumber="4375"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MakeNewFilter &amp;&amp; !NewFilterElts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>()) &#123;</Highlight></CodeLine>
<Link id="l04376" /><CodeLine lineNumber="4376"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MakeNewInstruction &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;New filter but not a new instruction!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04377" /><CodeLine lineNumber="4377"><Highlight kind="normal">        CleanupFlag = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04378" /><CodeLine lineNumber="4378"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04379" /><CodeLine lineNumber="4379"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04380" /><CodeLine lineNumber="4380"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04381" /><CodeLine lineNumber="4381"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04382" /><CodeLine lineNumber="4382"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04383" /><CodeLine lineNumber="4383"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If several filters occur in a row then reorder them so that the shortest</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04384" /><CodeLine lineNumber="4384"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// filters come first (those with the smallest number of elements).  This is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04385" /><CodeLine lineNumber="4385"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// advantageous because shorter filters are more likely to match, speeding up</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04386" /><CodeLine lineNumber="4386"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// unwinding, but mostly because it increases the effectiveness of the other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04387" /><CodeLine lineNumber="4387"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// filter optimizations below.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04388" /><CodeLine lineNumber="4388"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = NewClauses.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); i + 1 &lt; e; ) &#123;</Highlight></CodeLine>
<Link id="l04389" /><CodeLine lineNumber="4389"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> j;</Highlight></CodeLine>
<Link id="l04390" /><CodeLine lineNumber="4390"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find the maximal &#39;j&#39; s.t. the range &#91;i, j) consists entirely of filters.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04391" /><CodeLine lineNumber="4391"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (j = i; j != e; ++j)</Highlight></CodeLine>
<Link id="l04392" /><CodeLine lineNumber="4392"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ArrayType&gt;</a>(NewClauses&#91;j&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>()))</Highlight></CodeLine>
<Link id="l04393" /><CodeLine lineNumber="4393"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04394" /><CodeLine lineNumber="4394"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04395" /><CodeLine lineNumber="4395"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check whether the filters are already sorted by length.  We need to know</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04396" /><CodeLine lineNumber="4396"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// if sorting them is actually going to do anything so that we only make a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04397" /><CodeLine lineNumber="4397"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// new landingpad instruction if it does.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04398" /><CodeLine lineNumber="4398"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> k = i; k + 1 &lt; j; ++k)</Highlight></CodeLine>
<Link id="l04399" /><CodeLine lineNumber="4399"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a13d41ea63582902162e0efd8a78a5ad5">shorter&#95;filter</a>(NewClauses&#91;k+1&#93;, NewClauses&#91;k&#93;)) &#123;</Highlight></CodeLine>
<Link id="l04400" /><CodeLine lineNumber="4400"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Not sorted, so sort the filters now.  Doing an unstable sort would be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04401" /><CodeLine lineNumber="4401"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// correct too but reordering filters pointlessly might confuse users.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04402" /><CodeLine lineNumber="4402"><Highlight kind="normal">        std::stable&#95;sort(NewClauses.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>() + i, NewClauses.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>() + j,</Highlight></CodeLine>
<Link id="l04403" /><CodeLine lineNumber="4403"><Highlight kind="normal">                         <a href="#a13d41ea63582902162e0efd8a78a5ad5">shorter&#95;filter</a>);</Highlight></CodeLine>
<Link id="l04404" /><CodeLine lineNumber="4404"><Highlight kind="normal">        MakeNewInstruction = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04405" /><CodeLine lineNumber="4405"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04406" /><CodeLine lineNumber="4406"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04407" /><CodeLine lineNumber="4407"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04408" /><CodeLine lineNumber="4408"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Look for the next batch of filters.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04409" /><CodeLine lineNumber="4409"><Highlight kind="normal">    i = j + 1;</Highlight></CodeLine>
<Link id="l04410" /><CodeLine lineNumber="4410"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04411" /><CodeLine lineNumber="4411"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04412" /><CodeLine lineNumber="4412"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If typeinfos matched if and only if equal, then the elements of a filter L</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04413" /><CodeLine lineNumber="4413"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that occurs later than a filter F could be replaced by the intersection of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04414" /><CodeLine lineNumber="4414"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the elements of F and L.  In reality two typeinfos can match without being</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04415" /><CodeLine lineNumber="4415"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// equal (for example if one represents a C++ class, and the other some class</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04416" /><CodeLine lineNumber="4416"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// derived from it) so it would be wrong to perform this transform in general.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04417" /><CodeLine lineNumber="4417"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// However the transform is correct and useful if F is a subset of L.  In that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04418" /><CodeLine lineNumber="4418"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// case L can be replaced by F, and thus removed altogether since repeating a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04419" /><CodeLine lineNumber="4419"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// filter is pointless.  So here we look at all pairs of filters F and L where</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04420" /><CodeLine lineNumber="4420"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// L follows F in the list of clauses, and remove L if every element of F is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04421" /><CodeLine lineNumber="4421"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// an element of L.  This can occur when inlining C++ functions with exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04422" /><CodeLine lineNumber="4422"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// specifications.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04423" /><CodeLine lineNumber="4423"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i + 1 &lt; NewClauses.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); ++i) &#123;</Highlight></CodeLine>
<Link id="l04424" /><CodeLine lineNumber="4424"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Examine each filter in turn.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04425" /><CodeLine lineNumber="4425"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#aaee5189b9c4db9ad666a88abaf1ee0c4ad7778d0c64b6ba21494c97f77a66885a">Filter</a> = NewClauses&#91;i&#93;;</Highlight></CodeLine>
<Link id="l04426" /><CodeLine lineNumber="4426"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/arraytype">ArrayType</a> &#42;FTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ArrayType&gt;</a>(<a href="/docs/api/namespaces/llvm/#aaee5189b9c4db9ad666a88abaf1ee0c4ad7778d0c64b6ba21494c97f77a66885a">Filter</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l04427" /><CodeLine lineNumber="4427"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FTy)</Highlight></CodeLine>
<Link id="l04428" /><CodeLine lineNumber="4428"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Not a filter - skip it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04429" /><CodeLine lineNumber="4429"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04430" /><CodeLine lineNumber="4430"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> FElts = FTy-&gt;<a href="/docs/api/classes/llvm/arraytype/#a1c35bd7a4fa08845607033aecc94423d">getNumElements</a>();</Highlight></CodeLine>
<Link id="l04431" /><CodeLine lineNumber="4431"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Examine each filter following this one.  Doing this backwards means that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04432" /><CodeLine lineNumber="4432"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we don&#39;t have to worry about filters disappearing under us when removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04433" /><CodeLine lineNumber="4433"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> j = NewClauses.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() - 1; j != i; --j) &#123;</Highlight></CodeLine>
<Link id="l04434" /><CodeLine lineNumber="4434"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;LFilter = NewClauses&#91;j&#93;;</Highlight></CodeLine>
<Link id="l04435" /><CodeLine lineNumber="4435"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/arraytype">ArrayType</a> &#42;LTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ArrayType&gt;</a>(LFilter-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l04436" /><CodeLine lineNumber="4436"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LTy)</Highlight></CodeLine>
<Link id="l04437" /><CodeLine lineNumber="4437"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Not a filter - skip it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04438" /><CodeLine lineNumber="4438"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04439" /><CodeLine lineNumber="4439"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If Filter is a subset of LFilter, i.e. every element of Filter is also</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04440" /><CodeLine lineNumber="4440"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// an element of LFilter, then discard LFilter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04441" /><CodeLine lineNumber="4441"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvectorimpl/#ac5b936169badf0b703567eb960278648">SmallVectorImpl&lt;Constant &#42;&gt;::iterator</a> J = NewClauses.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>() + j;</Highlight></CodeLine>
<Link id="l04442" /><CodeLine lineNumber="4442"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If Filter is empty then it is a subset of LFilter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04443" /><CodeLine lineNumber="4443"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FElts) &#123;</Highlight></CodeLine>
<Link id="l04444" /><CodeLine lineNumber="4444"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Discard LFilter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04445" /><CodeLine lineNumber="4445"><Highlight kind="normal">        NewClauses.<a href="/docs/api/classes/llvm/smallvectorimpl/#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(J);</Highlight></CodeLine>
<Link id="l04446" /><CodeLine lineNumber="4446"><Highlight kind="normal">        MakeNewInstruction = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04447" /><CodeLine lineNumber="4447"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Move on to the next filter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04448" /><CodeLine lineNumber="4448"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04449" /><CodeLine lineNumber="4449"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04450" /><CodeLine lineNumber="4450"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> LElts = LTy-&gt;getNumElements();</Highlight></CodeLine>
<Link id="l04451" /><CodeLine lineNumber="4451"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If Filter is longer than LFilter then it cannot be a subset of it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04452" /><CodeLine lineNumber="4452"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FElts &gt; LElts)</Highlight></CodeLine>
<Link id="l04453" /><CodeLine lineNumber="4453"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Move on to the next filter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04454" /><CodeLine lineNumber="4454"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04455" /><CodeLine lineNumber="4455"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// At this point we know that LFilter has at least one element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04456" /><CodeLine lineNumber="4456"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantAggregateZero&gt;</a>(LFilter)) &#123; </Highlight><Highlight kind="comment">// LFilter only contains zeros.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04457" /><CodeLine lineNumber="4457"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Filter is a subset of LFilter iff Filter contains only zeros (as we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04458" /><CodeLine lineNumber="4458"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// already know that Filter is not longer than LFilter).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04459" /><CodeLine lineNumber="4459"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantAggregateZero&gt;</a>(<a href="/docs/api/namespaces/llvm/#aaee5189b9c4db9ad666a88abaf1ee0c4ad7778d0c64b6ba21494c97f77a66885a">Filter</a>)) &#123;</Highlight></CodeLine>
<Link id="l04460" /><CodeLine lineNumber="4460"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FElts &lt;= LElts &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Should have handled this case earlier!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04461" /><CodeLine lineNumber="4461"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Discard LFilter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04462" /><CodeLine lineNumber="4462"><Highlight kind="normal">          NewClauses.<a href="/docs/api/classes/llvm/smallvectorimpl/#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(J);</Highlight></CodeLine>
<Link id="l04463" /><CodeLine lineNumber="4463"><Highlight kind="normal">          MakeNewInstruction = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04464" /><CodeLine lineNumber="4464"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l04465" /><CodeLine lineNumber="4465"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Move on to the next filter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04466" /><CodeLine lineNumber="4466"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04467" /><CodeLine lineNumber="4467"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04468" /><CodeLine lineNumber="4468"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constantarray">ConstantArray</a> &#42;LArray = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantArray&gt;</a>(LFilter);</Highlight></CodeLine>
<Link id="l04469" /><CodeLine lineNumber="4469"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantAggregateZero&gt;</a>(<a href="/docs/api/namespaces/llvm/#aaee5189b9c4db9ad666a88abaf1ee0c4ad7778d0c64b6ba21494c97f77a66885a">Filter</a>)) &#123; </Highlight><Highlight kind="comment">// Filter only contains zeros.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04470" /><CodeLine lineNumber="4470"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Since Filter is non-empty and contains only zeros, it is a subset of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04471" /><CodeLine lineNumber="4471"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// LFilter iff LFilter contains a zero.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04472" /><CodeLine lineNumber="4472"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FElts &gt; 0 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Should have eliminated the empty filter earlier!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04473" /><CodeLine lineNumber="4473"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> l = 0; l != LElts; ++l)</Highlight></CodeLine>
<Link id="l04474" /><CodeLine lineNumber="4474"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LArray-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(l)-&gt;isNullValue()) &#123;</Highlight></CodeLine>
<Link id="l04475" /><CodeLine lineNumber="4475"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// LFilter contains a zero - discard it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04476" /><CodeLine lineNumber="4476"><Highlight kind="normal">            NewClauses.<a href="/docs/api/classes/llvm/smallvectorimpl/#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(J);</Highlight></CodeLine>
<Link id="l04477" /><CodeLine lineNumber="4477"><Highlight kind="normal">            MakeNewInstruction = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04478" /><CodeLine lineNumber="4478"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04479" /><CodeLine lineNumber="4479"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l04480" /><CodeLine lineNumber="4480"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Move on to the next filter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04481" /><CodeLine lineNumber="4481"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04482" /><CodeLine lineNumber="4482"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04483" /><CodeLine lineNumber="4483"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// At this point we know that both filters are ConstantArrays.  Loop over</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04484" /><CodeLine lineNumber="4484"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// operands to see whether every element of Filter is also an element of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04485" /><CodeLine lineNumber="4485"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// LFilter.  Since filters tend to be short this is probably faster than</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04486" /><CodeLine lineNumber="4486"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// using a method that scales nicely.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04487" /><CodeLine lineNumber="4487"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constantarray">ConstantArray</a> &#42;FArray = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantArray&gt;</a>(<a href="/docs/api/namespaces/llvm/#aaee5189b9c4db9ad666a88abaf1ee0c4ad7778d0c64b6ba21494c97f77a66885a">Filter</a>);</Highlight></CodeLine>
<Link id="l04488" /><CodeLine lineNumber="4488"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllFound = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04489" /><CodeLine lineNumber="4489"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> f = 0; f != FElts; ++f) &#123;</Highlight></CodeLine>
<Link id="l04490" /><CodeLine lineNumber="4490"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;FTypeInfo = FArray-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(f)-&gt;<a href="/docs/api/classes/llvm/value/#a966eb231e7d4e572874d2cb49b18faea">stripPointerCasts</a>();</Highlight></CodeLine>
<Link id="l04491" /><CodeLine lineNumber="4491"><Highlight kind="normal">        AllFound = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04492" /><CodeLine lineNumber="4492"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> l = 0; l != LElts; ++l) &#123;</Highlight></CodeLine>
<Link id="l04493" /><CodeLine lineNumber="4493"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;LTypeInfo = LArray-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(l)-&gt;<a href="/docs/api/classes/llvm/value/#a966eb231e7d4e572874d2cb49b18faea">stripPointerCasts</a>();</Highlight></CodeLine>
<Link id="l04494" /><CodeLine lineNumber="4494"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LTypeInfo == FTypeInfo) &#123;</Highlight></CodeLine>
<Link id="l04495" /><CodeLine lineNumber="4495"><Highlight kind="normal">            AllFound = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04496" /><CodeLine lineNumber="4496"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04497" /><CodeLine lineNumber="4497"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l04498" /><CodeLine lineNumber="4498"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l04499" /><CodeLine lineNumber="4499"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AllFound)</Highlight></CodeLine>
<Link id="l04500" /><CodeLine lineNumber="4500"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04501" /><CodeLine lineNumber="4501"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04502" /><CodeLine lineNumber="4502"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AllFound) &#123;</Highlight></CodeLine>
<Link id="l04503" /><CodeLine lineNumber="4503"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Discard LFilter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04504" /><CodeLine lineNumber="4504"><Highlight kind="normal">        NewClauses.<a href="/docs/api/classes/llvm/smallvectorimpl/#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(J);</Highlight></CodeLine>
<Link id="l04505" /><CodeLine lineNumber="4505"><Highlight kind="normal">        MakeNewInstruction = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04506" /><CodeLine lineNumber="4506"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04507" /><CodeLine lineNumber="4507"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Move on to the next filter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04508" /><CodeLine lineNumber="4508"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04509" /><CodeLine lineNumber="4509"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04510" /><CodeLine lineNumber="4510"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04511" /><CodeLine lineNumber="4511"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we changed any of the clauses, replace the old landingpad instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04512" /><CodeLine lineNumber="4512"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with a new one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04513" /><CodeLine lineNumber="4513"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MakeNewInstruction) &#123;</Highlight></CodeLine>
<Link id="l04514" /><CodeLine lineNumber="4514"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &#42;NLI = <a href="/docs/api/classes/llvm/landingpadinst/#a346619c899a36e84949cf205d08b7052">LandingPadInst::Create</a>(LI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</Highlight></CodeLine>
<Link id="l04515" /><CodeLine lineNumber="4515"><Highlight kind="normal">                                                 NewClauses.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</Highlight></CodeLine>
<Link id="l04516" /><CodeLine lineNumber="4516"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> : NewClauses)</Highlight></CodeLine>
<Link id="l04517" /><CodeLine lineNumber="4517"><Highlight kind="normal">      NLI-&gt;<a href="/docs/api/classes/llvm/landingpadinst/#a3a936522e13d33927dc23f0488e421d8">addClause</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l04518" /><CodeLine lineNumber="4518"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// A landing pad with no clauses must have the cleanup flag set.  It is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04519" /><CodeLine lineNumber="4519"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// theoretically possible, though highly unlikely, that we eliminated all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04520" /><CodeLine lineNumber="4520"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// clauses.  If so, force the cleanup flag to true.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04521" /><CodeLine lineNumber="4521"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewClauses.empty())</Highlight></CodeLine>
<Link id="l04522" /><CodeLine lineNumber="4522"><Highlight kind="normal">      CleanupFlag = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04523" /><CodeLine lineNumber="4523"><Highlight kind="normal">    NLI-&gt;<a href="/docs/api/classes/llvm/landingpadinst/#a97bc0afbd46cc7b3539e1cba861ac350">setCleanup</a>(CleanupFlag);</Highlight></CodeLine>
<Link id="l04524" /><CodeLine lineNumber="4524"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NLI;</Highlight></CodeLine>
<Link id="l04525" /><CodeLine lineNumber="4525"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04526" /><CodeLine lineNumber="4526"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04527" /><CodeLine lineNumber="4527"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Even if none of the clauses changed, we may nonetheless have understood</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04528" /><CodeLine lineNumber="4528"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that the cleanup flag is pointless.  Clear it if so.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04529" /><CodeLine lineNumber="4529"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LI.<a href="/docs/api/classes/llvm/landingpadinst/#a0966e2f38f20609a643b5d5e3da8bae5">isCleanup</a>() != CleanupFlag) &#123;</Highlight></CodeLine>
<Link id="l04530" /><CodeLine lineNumber="4530"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!CleanupFlag &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Adding a cleanup, not removing one?!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04531" /><CodeLine lineNumber="4531"><Highlight kind="normal">    LI.<a href="/docs/api/classes/llvm/landingpadinst/#a97bc0afbd46cc7b3539e1cba861ac350">setCleanup</a>(CleanupFlag);</Highlight></CodeLine>
<Link id="l04532" /><CodeLine lineNumber="4532"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;LI;</Highlight></CodeLine>
<Link id="l04533" /><CodeLine lineNumber="4533"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04534" /><CodeLine lineNumber="4534"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04535" /><CodeLine lineNumber="4535"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04536" /><CodeLine lineNumber="4536"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04537" /><CodeLine lineNumber="4537"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04538" /><CodeLine lineNumber="4538"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;</Highlight></CodeLine>
<Link id="l04539" /><CodeLine lineNumber="4539" lineLink="/docs/api/classes/llvm/instcombinerimpl/#ab7805c1d4f86c20199da1dd1fab589f0"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instcombinerimpl/#ab7805c1d4f86c20199da1dd1fab589f0">InstCombinerImpl::pushFreezeToPreventPoisonFromPropagating</a>(<a href="/docs/api/classes/llvm/freezeinst">FreezeInst</a> &amp;OrigFI) &#123;</Highlight></CodeLine>
<Link id="l04540" /><CodeLine lineNumber="4540"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to push freeze through instructions that propagate but don&#39;t produce</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04541" /><CodeLine lineNumber="4541"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// poison as far as possible.  If an operand of freeze follows three</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04542" /><CodeLine lineNumber="4542"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// conditions 1) one-use, 2) does not produce poison, and 3) has all but one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04543" /><CodeLine lineNumber="4543"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// guaranteed-non-poison operands then push the freeze through to the one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04544" /><CodeLine lineNumber="4544"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// operand that is not guaranteed non-poison.  The actual transform is as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04545" /><CodeLine lineNumber="4545"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// follows.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04546" /><CodeLine lineNumber="4546"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   Op1 = ...                        ; Op1 can be posion</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04547" /><CodeLine lineNumber="4547"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   Op0 = Inst(Op1, NonPoisonOps...) ; Op0 has only one use and only have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04548" /><CodeLine lineNumber="4548"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//                                    ; single guaranteed-non-poison operands</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04549" /><CodeLine lineNumber="4549"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   ... = Freeze(Op0)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04550" /><CodeLine lineNumber="4550"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// =&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04551" /><CodeLine lineNumber="4551"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   Op1 = ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04552" /><CodeLine lineNumber="4552"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   Op1.fr = Freeze(Op1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04553" /><CodeLine lineNumber="4553"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   ... = Inst(Op1.fr, NonPoisonOps...)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04554" /><CodeLine lineNumber="4554"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OrigOp = OrigFI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l04555" /><CodeLine lineNumber="4555"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OrigOpInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(OrigOp);</Highlight></CodeLine>
<Link id="l04556" /><CodeLine lineNumber="4556"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04557" /><CodeLine lineNumber="4557"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// While we could change the other users of OrigOp to use freeze(OrigOp), that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04558" /><CodeLine lineNumber="4558"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// potentially reduces their optimization potential, so let&#39;s only do this iff</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04559" /><CodeLine lineNumber="4559"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the OrigOp is only used by the freeze.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04560" /><CodeLine lineNumber="4560"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OrigOpInst || !OrigOpInst-&gt;hasOneUse() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(OrigOp))</Highlight></CodeLine>
<Link id="l04561" /><CodeLine lineNumber="4561"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04562" /><CodeLine lineNumber="4562"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04563" /><CodeLine lineNumber="4563"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can&#39;t push the freeze through an instruction which can itself create</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04564" /><CodeLine lineNumber="4564"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// poison.  If the only source of new poison is flags, we can simply</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04565" /><CodeLine lineNumber="4565"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// strip them (since we know the only use is the freeze and nothing can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04566" /><CodeLine lineNumber="4566"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// benefit from them.)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04567" /><CodeLine lineNumber="4567"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a8c064bbaef44753bce38ba88b8ba7588">canCreateUndefOrPoison</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Operator&gt;</a>(OrigOp),</Highlight></CodeLine>
<Link id="l04568" /><CodeLine lineNumber="4568"><Highlight kind="normal">                             </Highlight><Highlight kind="comment">/&#42;ConsiderFlagsAndMetadata&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l04569" /><CodeLine lineNumber="4569"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04570" /><CodeLine lineNumber="4570"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04571" /><CodeLine lineNumber="4571"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If operand is guaranteed not to be poison, there is no need to add freeze</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04572" /><CodeLine lineNumber="4572"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to the operand. So we first find the operand that is not guaranteed to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04573" /><CodeLine lineNumber="4573"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04574" /><CodeLine lineNumber="4574"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/use">Use</a> &#42;MaybePoisonOperand = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04575" /><CodeLine lineNumber="4575"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : OrigOpInst-&gt;operands()) &#123;</Highlight></CodeLine>
<Link id="l04576" /><CodeLine lineNumber="4576"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;MetadataAsValue&gt;</a>(U.get()) ||</Highlight></CodeLine>
<Link id="l04577" /><CodeLine lineNumber="4577"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ab8a7ef433279aabf7f30fa5504a4d4ef">isGuaranteedNotToBeUndefOrPoison</a>(U.get()))</Highlight></CodeLine>
<Link id="l04578" /><CodeLine lineNumber="4578"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04579" /><CodeLine lineNumber="4579"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MaybePoisonOperand)</Highlight></CodeLine>
<Link id="l04580" /><CodeLine lineNumber="4580"><Highlight kind="normal">      MaybePoisonOperand = &amp;U;</Highlight></CodeLine>
<Link id="l04581" /><CodeLine lineNumber="4581"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04582" /><CodeLine lineNumber="4582"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04583" /><CodeLine lineNumber="4583"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04584" /><CodeLine lineNumber="4584"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04585" /><CodeLine lineNumber="4585"><Highlight kind="normal">  OrigOpInst-&gt;dropPoisonGeneratingAnnotations();</Highlight></CodeLine>
<Link id="l04586" /><CodeLine lineNumber="4586"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04587" /><CodeLine lineNumber="4587"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If all operands are guaranteed to be non-poison, we can drop freeze.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04588" /><CodeLine lineNumber="4588"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MaybePoisonOperand)</Highlight></CodeLine>
<Link id="l04589" /><CodeLine lineNumber="4589"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OrigOp;</Highlight></CodeLine>
<Link id="l04590" /><CodeLine lineNumber="4590"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04591" /><CodeLine lineNumber="4591"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.SetInsertPoint(OrigOpInst);</Highlight></CodeLine>
<Link id="l04592" /><CodeLine lineNumber="4592"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FrozenMaybePoisonOperand = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFreeze(</Highlight></CodeLine>
<Link id="l04593" /><CodeLine lineNumber="4593"><Highlight kind="normal">      MaybePoisonOperand-&gt;get(), MaybePoisonOperand-&gt;get()-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.fr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04594" /><CodeLine lineNumber="4594"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04595" /><CodeLine lineNumber="4595"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instcombiner/#a6c1f812e984c68bc39c22b63a117e1eb">replaceUse</a>(&#42;MaybePoisonOperand, FrozenMaybePoisonOperand);</Highlight></CodeLine>
<Link id="l04596" /><CodeLine lineNumber="4596"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OrigOp;</Highlight></CodeLine>
<Link id="l04597" /><CodeLine lineNumber="4597"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04598" /><CodeLine lineNumber="4598"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04599" /><CodeLine lineNumber="4599" lineLink="/docs/api/classes/llvm/instcombinerimpl/#aef28063eb280fec69a391dd35c51666e"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#aef28063eb280fec69a391dd35c51666e">InstCombinerImpl::foldFreezeIntoRecurrence</a>(<a href="/docs/api/classes/llvm/freezeinst">FreezeInst</a> &amp;FI,</Highlight></CodeLine>
<Link id="l04600" /><CodeLine lineNumber="4600"><Highlight kind="normal">                                                        <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN) &#123;</Highlight></CodeLine>
<Link id="l04601" /><CodeLine lineNumber="4601"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Detect whether this is a recurrence with a start value and some number of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04602" /><CodeLine lineNumber="4602"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// backedge values. We&#39;ll check whether we can push the freeze through the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04603" /><CodeLine lineNumber="4603"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// backedge values (possibly dropping poison flags along the way) until we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04604" /><CodeLine lineNumber="4604"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reach the phi again. In that case, we can move the freeze to the start</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04605" /><CodeLine lineNumber="4605"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04606" /><CodeLine lineNumber="4606"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/use">Use</a> &#42;StartU = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04607" /><CodeLine lineNumber="4607"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>;</Highlight></CodeLine>
<Link id="l04608" /><CodeLine lineNumber="4608"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>()) &#123;</Highlight></CodeLine>
<Link id="l04609" /><CodeLine lineNumber="4609"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>.dominates(PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(U))) &#123;</Highlight></CodeLine>
<Link id="l04610" /><CodeLine lineNumber="4610"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Add backedge value to worklist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04611" /><CodeLine lineNumber="4611"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.push&#95;back(U.get());</Highlight></CodeLine>
<Link id="l04612" /><CodeLine lineNumber="4612"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04613" /><CodeLine lineNumber="4613"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04614" /><CodeLine lineNumber="4614"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04615" /><CodeLine lineNumber="4615"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t bother handling multiple start values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04616" /><CodeLine lineNumber="4616"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StartU)</Highlight></CodeLine>
<Link id="l04617" /><CodeLine lineNumber="4617"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04618" /><CodeLine lineNumber="4618"><Highlight kind="normal">    StartU = &amp;U;</Highlight></CodeLine>
<Link id="l04619" /><CodeLine lineNumber="4619"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04620" /><CodeLine lineNumber="4620"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04621" /><CodeLine lineNumber="4621"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!StartU || <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.empty())</Highlight></CodeLine>
<Link id="l04622" /><CodeLine lineNumber="4622"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Not a recurrence.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04623" /><CodeLine lineNumber="4623"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04624" /><CodeLine lineNumber="4624"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;StartV = StartU-&gt;get();</Highlight></CodeLine>
<Link id="l04625" /><CodeLine lineNumber="4625"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;StartBB = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(&#42;StartU);</Highlight></CodeLine>
<Link id="l04626" /><CodeLine lineNumber="4626"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> StartNeedsFreeze = !<a href="/docs/api/namespaces/llvm/#ab8a7ef433279aabf7f30fa5504a4d4ef">isGuaranteedNotToBeUndefOrPoison</a>(StartV);</Highlight></CodeLine>
<Link id="l04627" /><CodeLine lineNumber="4627"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can&#39;t insert freeze if the start value is the result of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04628" /><CodeLine lineNumber="4628"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// terminator (e.g. an invoke).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04629" /><CodeLine lineNumber="4629"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StartNeedsFreeze &amp;&amp; StartBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>() == StartV)</Highlight></CodeLine>
<Link id="l04630" /><CodeLine lineNumber="4630"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04631" /><CodeLine lineNumber="4631"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04632" /><CodeLine lineNumber="4632"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 32&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l04633" /><CodeLine lineNumber="4633"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;&gt;</a> DropFlags;</Highlight></CodeLine>
<Link id="l04634" /><CodeLine lineNumber="4634"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.empty()) &#123;</Highlight></CodeLine>
<Link id="l04635" /><CodeLine lineNumber="4635"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.pop&#95;back&#95;val();</Highlight></CodeLine>
<Link id="l04636" /><CodeLine lineNumber="4636"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(V).second)</Highlight></CodeLine>
<Link id="l04637" /><CodeLine lineNumber="4637"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04638" /><CodeLine lineNumber="4638"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04639" /><CodeLine lineNumber="4639"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() &gt; 32)</Highlight></CodeLine>
<Link id="l04640" /><CodeLine lineNumber="4640"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Limit the total number of values we inspect.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04641" /><CodeLine lineNumber="4641"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04642" /><CodeLine lineNumber="4642"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Assume that PN is non-poison, because it will be after the transform.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04643" /><CodeLine lineNumber="4643"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V == PN || <a href="/docs/api/namespaces/llvm/#ab8a7ef433279aabf7f30fa5504a4d4ef">isGuaranteedNotToBeUndefOrPoison</a>(V))</Highlight></CodeLine>
<Link id="l04644" /><CodeLine lineNumber="4644"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04645" /><CodeLine lineNumber="4645"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04646" /><CodeLine lineNumber="4646"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</Highlight></CodeLine>
<Link id="l04647" /><CodeLine lineNumber="4647"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || <a href="/docs/api/namespaces/llvm/#a8c064bbaef44753bce38ba88b8ba7588">canCreateUndefOrPoison</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Operator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>),</Highlight></CodeLine>
<Link id="l04648" /><CodeLine lineNumber="4648"><Highlight kind="normal">                                     </Highlight><Highlight kind="comment">/&#42;ConsiderFlagsAndMetadata&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l04649" /><CodeLine lineNumber="4649"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04650" /><CodeLine lineNumber="4650"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04651" /><CodeLine lineNumber="4651"><Highlight kind="normal">    DropFlags.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l04652" /><CodeLine lineNumber="4652"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(<a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands());</Highlight></CodeLine>
<Link id="l04653" /><CodeLine lineNumber="4653"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04654" /><CodeLine lineNumber="4654"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04655" /><CodeLine lineNumber="4655"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DropFlags)</Highlight></CodeLine>
<Link id="l04656" /><CodeLine lineNumber="4656"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;dropPoisonGeneratingAnnotations();</Highlight></CodeLine>
<Link id="l04657" /><CodeLine lineNumber="4657"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04658" /><CodeLine lineNumber="4658"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StartNeedsFreeze) &#123;</Highlight></CodeLine>
<Link id="l04659" /><CodeLine lineNumber="4659"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.SetInsertPoint(StartBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l04660" /><CodeLine lineNumber="4660"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;FrozenStartV = <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CreateFreeze(StartV,</Highlight></CodeLine>
<Link id="l04661" /><CodeLine lineNumber="4661"><Highlight kind="normal">                                               StartV-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.fr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04662" /><CodeLine lineNumber="4662"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#a6c1f812e984c68bc39c22b63a117e1eb">replaceUse</a>(&#42;StartU, FrozenStartV);</Highlight></CodeLine>
<Link id="l04663" /><CodeLine lineNumber="4663"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04664" /><CodeLine lineNumber="4664"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(FI, PN);</Highlight></CodeLine>
<Link id="l04665" /><CodeLine lineNumber="4665"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04666" /><CodeLine lineNumber="4666"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04667" /><CodeLine lineNumber="4667" lineLink="/docs/api/classes/llvm/instcombinerimpl/#af59c587eddc75748a1e201369cd3dbac"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#af59c587eddc75748a1e201369cd3dbac">InstCombinerImpl::freezeOtherUses</a>(<a href="/docs/api/classes/llvm/freezeinst">FreezeInst</a> &amp;FI) &#123;</Highlight></CodeLine>
<Link id="l04668" /><CodeLine lineNumber="4668"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = FI.<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l04669" /><CodeLine lineNumber="4669"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04670" /><CodeLine lineNumber="4670"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) || <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l04671" /><CodeLine lineNumber="4671"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04672" /><CodeLine lineNumber="4672"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04673" /><CodeLine lineNumber="4673"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Move the freeze directly after the definition of its operand, so that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04674" /><CodeLine lineNumber="4674"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// it dominates the maximum number of uses. Note that it may not dominate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04675" /><CodeLine lineNumber="4675"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &#42;all&#42; uses if the operand is an invoke/callbr and the use is in a phi on</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04676" /><CodeLine lineNumber="4676"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the normal/default destination. This is why the domination check in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04677" /><CodeLine lineNumber="4677"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// replacement below is still necessary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04678" /><CodeLine lineNumber="4678"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> MoveBefore;</Highlight></CodeLine>
<Link id="l04679" /><CodeLine lineNumber="4679"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Argument&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</Highlight></CodeLine>
<Link id="l04680" /><CodeLine lineNumber="4680"><Highlight kind="normal">    MoveBefore =</Highlight></CodeLine>
<Link id="l04681" /><CodeLine lineNumber="4681"><Highlight kind="normal">        FI.<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>().<a href="/docs/api/classes/llvm/basicblock/#aab4db88f47575918879912e8ca511756">getFirstNonPHIOrDbgOrAlloca</a>();</Highlight></CodeLine>
<Link id="l04682" /><CodeLine lineNumber="4682"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04683" /><CodeLine lineNumber="4683"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MoveBeforeOpt = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)-&gt;getInsertionPointAfterDef();</Highlight></CodeLine>
<Link id="l04684" /><CodeLine lineNumber="4684"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MoveBeforeOpt)</Highlight></CodeLine>
<Link id="l04685" /><CodeLine lineNumber="4685"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04686" /><CodeLine lineNumber="4686"><Highlight kind="normal">    MoveBefore = &#42;MoveBeforeOpt;</Highlight></CodeLine>
<Link id="l04687" /><CodeLine lineNumber="4687"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04688" /><CodeLine lineNumber="4688"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04689" /><CodeLine lineNumber="4689"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t move to the position of a debug intrinsic.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04690" /><CodeLine lineNumber="4690"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(MoveBefore))</Highlight></CodeLine>
<Link id="l04691" /><CodeLine lineNumber="4691"><Highlight kind="normal">    MoveBefore = MoveBefore-&gt;getNextNonDebugInstruction()-&gt;getIterator();</Highlight></CodeLine>
<Link id="l04692" /><CodeLine lineNumber="4692"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Re-point iterator to come after any debug-info records, if we&#39;re</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04693" /><CodeLine lineNumber="4693"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// running in &quot;RemoveDIs&quot; mode</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04694" /><CodeLine lineNumber="4694"><Highlight kind="normal">  MoveBefore.setHeadBit(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04695" /><CodeLine lineNumber="4695"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04696" /><CodeLine lineNumber="4696"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04697" /><CodeLine lineNumber="4697"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&amp;FI != &amp;&#42;MoveBefore) &#123;</Highlight></CodeLine>
<Link id="l04698" /><CodeLine lineNumber="4698"><Highlight kind="normal">    FI.<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(&#42;MoveBefore-&gt;getParent(), MoveBefore);</Highlight></CodeLine>
<Link id="l04699" /><CodeLine lineNumber="4699"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04700" /><CodeLine lineNumber="4700"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04701" /><CodeLine lineNumber="4701"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04702" /><CodeLine lineNumber="4702"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;replaceUsesWithIf(&amp;FI, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04703" /><CodeLine lineNumber="4703"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Dominates = <a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>.dominates(&amp;FI, U);</Highlight></CodeLine>
<Link id="l04704" /><CodeLine lineNumber="4704"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= Dominates;</Highlight></CodeLine>
<Link id="l04705" /><CodeLine lineNumber="4705"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Dominates;</Highlight></CodeLine>
<Link id="l04706" /><CodeLine lineNumber="4706"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l04707" /><CodeLine lineNumber="4707"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04708" /><CodeLine lineNumber="4708"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l04709" /><CodeLine lineNumber="4709"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04710" /><CodeLine lineNumber="4710"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04711" /><CodeLine lineNumber="4711"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Check if any direct or bitcast user of this value is a shuffle instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04712" /><CodeLine lineNumber="4712" lineLink="#a04960b3b85873b5232f0d293f29946c1"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a04960b3b85873b5232f0d293f29946c1">isUsedWithinShuffleVector</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l04713" /><CodeLine lineNumber="4713"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : V-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l04714" /><CodeLine lineNumber="4714"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ShuffleVectorInst&gt;</a>(U))</Highlight></CodeLine>
<Link id="l04715" /><CodeLine lineNumber="4715"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04716" /><CodeLine lineNumber="4716"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#a99d8e67ed2343ad6717d7a8fdd3e7c7a">m&#95;BitCast</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(V))) &amp;&amp; <a href="#a04960b3b85873b5232f0d293f29946c1">isUsedWithinShuffleVector</a>(U))</Highlight></CodeLine>
<Link id="l04717" /><CodeLine lineNumber="4717"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04718" /><CodeLine lineNumber="4718"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04719" /><CodeLine lineNumber="4719"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04720" /><CodeLine lineNumber="4720"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04721" /><CodeLine lineNumber="4721"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04722" /><CodeLine lineNumber="4722" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a397caaa6fe7aad6bb3d482f9fe157e71"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/instcombinerimpl/#a397caaa6fe7aad6bb3d482f9fe157e71">InstCombinerImpl::visitFreeze</a>(<a href="/docs/api/classes/llvm/freezeinst">FreezeInst</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l04723" /><CodeLine lineNumber="4723"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0 = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperand(0);</Highlight></CodeLine>
<Link id="l04724" /><CodeLine lineNumber="4724"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04725" /><CodeLine lineNumber="4725"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a12c01eba586da4db7ad4662e901b10a0">simplifyFreezeInst</a>(Op0, <a href="/docs/api/classes/llvm/instcombiner/#a067e49eb19f14e50f84cf4b4e7f6acde">SQ</a>.getWithInstruction(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)))</Highlight></CodeLine>
<Link id="l04726" /><CodeLine lineNumber="4726"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, V);</Highlight></CodeLine>
<Link id="l04727" /><CodeLine lineNumber="4727"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04728" /><CodeLine lineNumber="4728"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// freeze (phi const, x) --&gt; phi const, (freeze x)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04729" /><CodeLine lineNumber="4729"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Op0)) &#123;</Highlight></CodeLine>
<Link id="l04730" /><CodeLine lineNumber="4730"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NV = <a href="/docs/api/classes/llvm/instcombinerimpl/#a2fc50d227d302eb98914f04bcc6634e1">foldOpIntoPhi</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, PN))</Highlight></CodeLine>
<Link id="l04731" /><CodeLine lineNumber="4731"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NV;</Highlight></CodeLine>
<Link id="l04732" /><CodeLine lineNumber="4732"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NV = <a href="/docs/api/classes/llvm/instcombinerimpl/#aef28063eb280fec69a391dd35c51666e">foldFreezeIntoRecurrence</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, PN))</Highlight></CodeLine>
<Link id="l04733" /><CodeLine lineNumber="4733"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NV;</Highlight></CodeLine>
<Link id="l04734" /><CodeLine lineNumber="4734"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04735" /><CodeLine lineNumber="4735"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04736" /><CodeLine lineNumber="4736"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;NI = <a href="/docs/api/classes/llvm/instcombinerimpl/#ab7805c1d4f86c20199da1dd1fab589f0">pushFreezeToPreventPoisonFromPropagating</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l04737" /><CodeLine lineNumber="4737"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, NI);</Highlight></CodeLine>
<Link id="l04738" /><CodeLine lineNumber="4738"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04739" /><CodeLine lineNumber="4739"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If I is freeze(undef), check its uses and fold it to a fixed constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04740" /><CodeLine lineNumber="4740"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// - or: pick -1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04741" /><CodeLine lineNumber="4741"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// - select&#39;s condition: if the true value is constant, choose it by making</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04742" /><CodeLine lineNumber="4742"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//                       the condition true.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04743" /><CodeLine lineNumber="4743"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// - default: pick 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04744" /><CodeLine lineNumber="4744"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04745" /><CodeLine lineNumber="4745"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that this transform is intentionally done here rather than</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04746" /><CodeLine lineNumber="4746"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// via an analysis in InstSimplify or at individual user sites. That is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04747" /><CodeLine lineNumber="4747"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// because we must produce the same value for all uses of the freeze -</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04748" /><CodeLine lineNumber="4748"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// it&#39;s the reason &quot;freeze&quot; exists!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04749" /><CodeLine lineNumber="4749"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04750" /><CodeLine lineNumber="4750"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: This could use getBinopAbsorber() / getBinopIdentity() to avoid</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04751" /><CodeLine lineNumber="4751"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       duplicating logic for binops at least.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04752" /><CodeLine lineNumber="4752"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> getUndefReplacement = &#91;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</Highlight></CodeLine>
<Link id="l04753" /><CodeLine lineNumber="4753"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;BestValue = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04754" /><CodeLine lineNumber="4754"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NullValue = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Ty);</Highlight></CodeLine>
<Link id="l04755" /><CodeLine lineNumber="4755"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.users()) &#123;</Highlight></CodeLine>
<Link id="l04756" /><CodeLine lineNumber="4756"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = NullValue;</Highlight></CodeLine>
<Link id="l04757" /><CodeLine lineNumber="4757"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#ae44af1eeb2e5f7a1973a4ab78963a503">m&#95;Or</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())))</Highlight></CodeLine>
<Link id="l04758" /><CodeLine lineNumber="4758"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">ConstantInt::getAllOnesValue</a>(Ty);</Highlight></CodeLine>
<Link id="l04759" /><CodeLine lineNumber="4759"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U, <a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())))</Highlight></CodeLine>
<Link id="l04760" /><CodeLine lineNumber="4760"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(Ty);</Highlight></CodeLine>
<Link id="l04761" /><CodeLine lineNumber="4761"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04762" /><CodeLine lineNumber="4762"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BestValue)</Highlight></CodeLine>
<Link id="l04763" /><CodeLine lineNumber="4763"><Highlight kind="normal">        BestValue = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l04764" /><CodeLine lineNumber="4764"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestValue != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)</Highlight></CodeLine>
<Link id="l04765" /><CodeLine lineNumber="4765"><Highlight kind="normal">        BestValue = NullValue;</Highlight></CodeLine>
<Link id="l04766" /><CodeLine lineNumber="4766"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04767" /><CodeLine lineNumber="4767"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BestValue &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Must have at least one use&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04768" /><CodeLine lineNumber="4768"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BestValue;</Highlight></CodeLine>
<Link id="l04769" /><CodeLine lineNumber="4769"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l04770" /><CodeLine lineNumber="4770"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04771" /><CodeLine lineNumber="4771"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#adea6dc2e42baa345b97be48b0370313d">m&#95;Undef</a>())) &#123;</Highlight></CodeLine>
<Link id="l04772" /><CodeLine lineNumber="4772"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t fold freeze(undef/poison) if it&#39;s used as a vector operand in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04773" /><CodeLine lineNumber="4773"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// a shuffle. This may improve codegen for shuffles that allow</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04774" /><CodeLine lineNumber="4774"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// unspecified inputs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04775" /><CodeLine lineNumber="4775"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a04960b3b85873b5232f0d293f29946c1">isUsedWithinShuffleVector</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l04776" /><CodeLine lineNumber="4776"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04777" /><CodeLine lineNumber="4777"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, getUndefReplacement(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()));</Highlight></CodeLine>
<Link id="l04778" /><CodeLine lineNumber="4778"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04779" /><CodeLine lineNumber="4779"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04780" /><CodeLine lineNumber="4780"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l04781" /><CodeLine lineNumber="4781"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#a16be5fe0cce90e51f8c0e0c4d6c589f6">m&#95;Constant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)) &amp;&amp; <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;containsUndefOrPoisonElement()) &#123;</Highlight></CodeLine>
<Link id="l04782" /><CodeLine lineNumber="4782"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ReplaceC = getUndefReplacement(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()-&gt;getScalarType());</Highlight></CodeLine>
<Link id="l04783" /><CodeLine lineNumber="4783"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#a49f1bd0bdf0ef741bdd714cc1188d7c5">replaceInstUsesWith</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/constant/#a174c8fd19771468c53842a7fde8ddce1">Constant::replaceUndefsWith</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, ReplaceC));</Highlight></CodeLine>
<Link id="l04784" /><CodeLine lineNumber="4784"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04785" /><CodeLine lineNumber="4785"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04786" /><CodeLine lineNumber="4786"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace uses of Op with freeze(Op).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04787" /><CodeLine lineNumber="4787"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombinerimpl/#af59c587eddc75748a1e201369cd3dbac">freezeOtherUses</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l04788" /><CodeLine lineNumber="4788"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l04789" /><CodeLine lineNumber="4789"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04790" /><CodeLine lineNumber="4790"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04791" /><CodeLine lineNumber="4791"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04792" /><CodeLine lineNumber="4792"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04793" /><CodeLine lineNumber="4793"><Highlight kind="comment">/// Check for case where the call writes to an otherwise dead alloca.  This</Highlight></CodeLine>
<Link id="l04794" /><CodeLine lineNumber="4794"><Highlight kind="comment">/// shows up for unused out-params in idiomatic C/C++ code.   Note that this</Highlight></CodeLine>
<Link id="l04795" /><CodeLine lineNumber="4795"><Highlight kind="comment">/// helper &#42;only&#42; analyzes the write; doesn&#39;t check any other legality aspect.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04796" /><CodeLine lineNumber="4796" lineLink="#aca7c31a6dcc095ed3c2831f6876c6dc0"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#aca7c31a6dcc095ed3c2831f6876c6dc0">SoleWriteToDeadLocal</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;TLI) &#123;</Highlight></CodeLine>
<Link id="l04797" /><CodeLine lineNumber="4797"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l04798" /><CodeLine lineNumber="4798"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CB)</Highlight></CodeLine>
<Link id="l04799" /><CodeLine lineNumber="4799"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: handle e.g. store to alloca here - only worth doing if we extend</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04800" /><CodeLine lineNumber="4800"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to allow reload along used path as described below.  Otherwise, this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04801" /><CodeLine lineNumber="4801"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is simply a store to a dead allocation which will be removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04802" /><CodeLine lineNumber="4802"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04803" /><CodeLine lineNumber="4803"><Highlight kind="normal">  std::optional&lt;MemoryLocation&gt; Dest = <a href="/docs/api/classes/llvm/memorylocation/#ac8f8983c6b76d0e30f22fff86b281f16">MemoryLocation::getForDest</a>(CB, TLI);</Highlight></CodeLine>
<Link id="l04804" /><CodeLine lineNumber="4804"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Dest)</Highlight></CodeLine>
<Link id="l04805" /><CodeLine lineNumber="4805"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04806" /><CodeLine lineNumber="4806"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(Dest-&gt;Ptr));</Highlight></CodeLine>
<Link id="l04807" /><CodeLine lineNumber="4807"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AI)</Highlight></CodeLine>
<Link id="l04808" /><CodeLine lineNumber="4808"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: allow malloc?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04809" /><CodeLine lineNumber="4809"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04810" /><CodeLine lineNumber="4810"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: allow memory access dominated by move point?  Note that since AI</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04811" /><CodeLine lineNumber="4811"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// could have a reference to itself captured by the call, we would need to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04812" /><CodeLine lineNumber="4812"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// account for cycles in doing so.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04813" /><CodeLine lineNumber="4813"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const User &#42;&gt;</a> AllocaUsers;</Highlight></CodeLine>
<Link id="l04814" /><CodeLine lineNumber="4814"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const User &#42;, 4&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l04815" /><CodeLine lineNumber="4815"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> pushUsers = &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l04816" /><CodeLine lineNumber="4816"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.users()) &#123;</Highlight></CodeLine>
<Link id="l04817" /><CodeLine lineNumber="4817"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(U).second)</Highlight></CodeLine>
<Link id="l04818" /><CodeLine lineNumber="4818"><Highlight kind="normal">        AllocaUsers.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(U);</Highlight></CodeLine>
<Link id="l04819" /><CodeLine lineNumber="4819"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04820" /><CodeLine lineNumber="4820"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l04821" /><CodeLine lineNumber="4821"><Highlight kind="normal">  pushUsers(&#42;AI);</Highlight></CodeLine>
<Link id="l04822" /><CodeLine lineNumber="4822"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!AllocaUsers.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l04823" /><CodeLine lineNumber="4823"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UserI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(AllocaUsers.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>());</Highlight></CodeLine>
<Link id="l04824" /><CodeLine lineNumber="4824"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(UserI) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AddrSpaceCastInst&gt;</a>(UserI)) &#123;</Highlight></CodeLine>
<Link id="l04825" /><CodeLine lineNumber="4825"><Highlight kind="normal">      pushUsers(&#42;UserI);</Highlight></CodeLine>
<Link id="l04826" /><CodeLine lineNumber="4826"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04827" /><CodeLine lineNumber="4827"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04828" /><CodeLine lineNumber="4828"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserI == CB)</Highlight></CodeLine>
<Link id="l04829" /><CodeLine lineNumber="4829"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04830" /><CodeLine lineNumber="4830"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: support lifetime.start/end here</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04831" /><CodeLine lineNumber="4831"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04832" /><CodeLine lineNumber="4832"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04833" /><CodeLine lineNumber="4833"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04834" /><CodeLine lineNumber="4834"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04835" /><CodeLine lineNumber="4835"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04836" /><CodeLine lineNumber="4836"><Highlight kind="comment">/// Try to move the specified instruction from its current block into the</Highlight></CodeLine>
<Link id="l04837" /><CodeLine lineNumber="4837"><Highlight kind="comment">/// beginning of DestBlock, which can only happen if it&#39;s safe to move the</Highlight></CodeLine>
<Link id="l04838" /><CodeLine lineNumber="4838"><Highlight kind="comment">/// instruction past all of the instructions between it and the end of its</Highlight></CodeLine>
<Link id="l04839" /><CodeLine lineNumber="4839"><Highlight kind="comment">/// block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04840" /><CodeLine lineNumber="4840" lineLink="/docs/api/classes/llvm/instcombinerimpl/#af4b167ac2fde7b3d71172817650150a6"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#af4b167ac2fde7b3d71172817650150a6">InstCombinerImpl::tryToSinkInstruction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l04841" /><CodeLine lineNumber="4841"><Highlight kind="normal">                                            <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBlock) &#123;</Highlight></CodeLine>
<Link id="l04842" /><CodeLine lineNumber="4842"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SrcBlock = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l04843" /><CodeLine lineNumber="4843"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04844" /><CodeLine lineNumber="4844"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Cannot move control-flow-involving, volatile loads, vaarg, etc.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04845" /><CodeLine lineNumber="4845"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isEHPad() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayThrow() || !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;willReturn() ||</Highlight></CodeLine>
<Link id="l04846" /><CodeLine lineNumber="4846"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator())</Highlight></CodeLine>
<Link id="l04847" /><CodeLine lineNumber="4847"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04848" /><CodeLine lineNumber="4848"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04849" /><CodeLine lineNumber="4849"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do not sink static or dynamic alloca instructions. Static allocas must</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04850" /><CodeLine lineNumber="4850"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// remain in the entry block, and dynamic allocas must not be sunk in between</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04851" /><CodeLine lineNumber="4851"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a stacksave / stackrestore pair, which would incorrectly shorten its</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04852" /><CodeLine lineNumber="4852"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// lifetime.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04853" /><CodeLine lineNumber="4853"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l04854" /><CodeLine lineNumber="4854"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04855" /><CodeLine lineNumber="4855"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04856" /><CodeLine lineNumber="4856"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do not sink into catchswitch blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04857" /><CodeLine lineNumber="4857"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CatchSwitchInst&gt;</a>(DestBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()))</Highlight></CodeLine>
<Link id="l04858" /><CodeLine lineNumber="4858"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04859" /><CodeLine lineNumber="4859"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04860" /><CodeLine lineNumber="4860"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do not sink convergent call instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04861" /><CodeLine lineNumber="4861"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l04862" /><CodeLine lineNumber="4862"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CI-&gt;isConvergent())</Highlight></CodeLine>
<Link id="l04863" /><CodeLine lineNumber="4863"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04864" /><CodeLine lineNumber="4864"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04865" /><CodeLine lineNumber="4865"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04866" /><CodeLine lineNumber="4866"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Unless we can prove that the memory write isn&#39;t visibile except on the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04867" /><CodeLine lineNumber="4867"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// path we&#39;re sinking to, we must bail.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04868" /><CodeLine lineNumber="4868"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayWriteToMemory()) &#123;</Highlight></CodeLine>
<Link id="l04869" /><CodeLine lineNumber="4869"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#aca7c31a6dcc095ed3c2831f6876c6dc0">SoleWriteToDeadLocal</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>))</Highlight></CodeLine>
<Link id="l04870" /><CodeLine lineNumber="4870"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04871" /><CodeLine lineNumber="4871"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04872" /><CodeLine lineNumber="4872"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04873" /><CodeLine lineNumber="4873"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can only sink load instructions if there is nothing between the load and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04874" /><CodeLine lineNumber="4874"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the end of block that could change the value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04875" /><CodeLine lineNumber="4875"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadFromMemory() &amp;&amp;</Highlight></CodeLine>
<Link id="l04876" /><CodeLine lineNumber="4876"><Highlight kind="normal">      !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasMetadata(LLVMContext::MD&#95;invariant&#95;load)) &#123;</Highlight></CodeLine>
<Link id="l04877" /><CodeLine lineNumber="4877"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We don&#39;t want to do any sophisticated alias analysis, so we only check</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04878" /><CodeLine lineNumber="4878"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the instructions after I in I&#39;s parent block if we try to sink to its</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04879" /><CodeLine lineNumber="4879"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// successor block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04880" /><CodeLine lineNumber="4880"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DestBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>() != <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent())</Highlight></CodeLine>
<Link id="l04881" /><CodeLine lineNumber="4881"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04882" /><CodeLine lineNumber="4882"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> Scan = std::next(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIterator()),</Highlight></CodeLine>
<Link id="l04883" /><CodeLine lineNumber="4883"><Highlight kind="normal">                              E = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()-&gt;end();</Highlight></CodeLine>
<Link id="l04884" /><CodeLine lineNumber="4884"><Highlight kind="normal">         Scan != E; ++Scan)</Highlight></CodeLine>
<Link id="l04885" /><CodeLine lineNumber="4885"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Scan-&gt;mayWriteToMemory())</Highlight></CodeLine>
<Link id="l04886" /><CodeLine lineNumber="4886"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04887" /><CodeLine lineNumber="4887"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04888" /><CodeLine lineNumber="4888"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04889" /><CodeLine lineNumber="4889"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;dropDroppableUses(&#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/use">Use</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l04890" /><CodeLine lineNumber="4890"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U-&gt;getUser());</Highlight></CodeLine>
<Link id="l04891" /><CodeLine lineNumber="4891"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() != DestBlock) &#123;</Highlight></CodeLine>
<Link id="l04892" /><CodeLine lineNumber="4892"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.add(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l04893" /><CodeLine lineNumber="4893"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04894" /><CodeLine lineNumber="4894"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04895" /><CodeLine lineNumber="4895"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04896" /><CodeLine lineNumber="4896"><Highlight kind="normal">  &#125;);</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04897" /><CodeLine lineNumber="4897"><Highlight kind="comment">  /// FIXME: We could remove droppable uses that are not dominated by</Highlight></CodeLine>
<Link id="l04898" /><CodeLine lineNumber="4898"><Highlight kind="comment">  /// the new position.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04899" /><CodeLine lineNumber="4899"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04900" /><CodeLine lineNumber="4900"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPos = DestBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</Highlight></CodeLine>
<Link id="l04901" /><CodeLine lineNumber="4901"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;moveBefore(&#42;DestBlock, InsertPos);</Highlight></CodeLine>
<Link id="l04902" /><CodeLine lineNumber="4902"><Highlight kind="normal">  ++NumSunkInst;</Highlight></CodeLine>
<Link id="l04903" /><CodeLine lineNumber="4903"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04904" /><CodeLine lineNumber="4904"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Also sink all related debug uses from the source basic block. Otherwise we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04905" /><CodeLine lineNumber="4905"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// get debug use before the def. Attempt to salvage debug uses first, to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04906" /><CodeLine lineNumber="4906"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// maximise the range variables have location for. If we cannot salvage, then</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04907" /><CodeLine lineNumber="4907"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// mark the location undef: we know it was supposed to receive a new location</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04908" /><CodeLine lineNumber="4908"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// here, but that computation has been sunk.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04909" /><CodeLine lineNumber="4909"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableIntrinsic &#42;, 2&gt;</a> DbgUsers;</Highlight></CodeLine>
<Link id="l04910" /><CodeLine lineNumber="4910"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;, 2&gt;</a> DbgVariableRecords;</Highlight></CodeLine>
<Link id="l04911" /><CodeLine lineNumber="4911"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a26bad0f6e5435a5a4dc50850c5b8f628">findDbgUsers</a>(DbgUsers, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &amp;DbgVariableRecords);</Highlight></CodeLine>
<Link id="l04912" /><CodeLine lineNumber="4912"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DbgUsers.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</Highlight></CodeLine>
<Link id="l04913" /><CodeLine lineNumber="4913"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#aa6739b4a0bc5d6540e53c1688aefeed4">tryToSinkInstructionDbgValues</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, InsertPos, SrcBlock, DestBlock, DbgUsers);</Highlight></CodeLine>
<Link id="l04914" /><CodeLine lineNumber="4914"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DbgVariableRecords.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</Highlight></CodeLine>
<Link id="l04915" /><CodeLine lineNumber="4915"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl/#ad4296b2b81379548b300c4676f0d2125">tryToSinkInstructionDbgVariableRecords</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, InsertPos, SrcBlock, DestBlock,</Highlight></CodeLine>
<Link id="l04916" /><CodeLine lineNumber="4916"><Highlight kind="normal">                                           DbgVariableRecords);</Highlight></CodeLine>
<Link id="l04917" /><CodeLine lineNumber="4917"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04918" /><CodeLine lineNumber="4918"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// PS: there are numerous flaws with this behaviour, not least that right now</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04919" /><CodeLine lineNumber="4919"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// assignments can be re-ordered past other assignments to the same variable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04920" /><CodeLine lineNumber="4920"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if they use different Values. Creating more undef assignements can never be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04921" /><CodeLine lineNumber="4921"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// undone. And salvaging all users outside of this block can un-necessarily</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04922" /><CodeLine lineNumber="4922"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// alter the lifetime of the live-value that the variable refers to.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04923" /><CodeLine lineNumber="4923"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Some of these things can be resolved by tolerating debug use-before-defs in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04924" /><CodeLine lineNumber="4924"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// LLVM-IR, however it depends on the instruction-referencing CodeGen backend</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04925" /><CodeLine lineNumber="4925"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// being used for more architectures.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04926" /><CodeLine lineNumber="4926"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04927" /><CodeLine lineNumber="4927"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04928" /><CodeLine lineNumber="4928"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04929" /><CodeLine lineNumber="4929"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04930" /><CodeLine lineNumber="4930" lineLink="/docs/api/classes/llvm/instcombinerimpl/#aa6739b4a0bc5d6540e53c1688aefeed4"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#aa6739b4a0bc5d6540e53c1688aefeed4">InstCombinerImpl::tryToSinkInstructionDbgValues</a>(</Highlight></CodeLine>
<Link id="l04931" /><CodeLine lineNumber="4931"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPos, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SrcBlock,</Highlight></CodeLine>
<Link id="l04932" /><CodeLine lineNumber="4932"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBlock, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;DbgVariableIntrinsic &#42;&gt;</a> &amp;DbgUsers) &#123;</Highlight></CodeLine>
<Link id="l04933" /><CodeLine lineNumber="4933"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For all debug values in the destination block, the sunk instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04934" /><CodeLine lineNumber="4934"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will still be available, so they do not need to be dropped.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04935" /><CodeLine lineNumber="4935"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableIntrinsic &#42;, 2&gt;</a> DbgUsersToSalvage;</Highlight></CodeLine>
<Link id="l04936" /><CodeLine lineNumber="4936"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;DbgUser : DbgUsers)</Highlight></CodeLine>
<Link id="l04937" /><CodeLine lineNumber="4937"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DbgUser-&gt;getParent() != DestBlock)</Highlight></CodeLine>
<Link id="l04938" /><CodeLine lineNumber="4938"><Highlight kind="normal">      DbgUsersToSalvage.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(DbgUser);</Highlight></CodeLine>
<Link id="l04939" /><CodeLine lineNumber="4939"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04940" /><CodeLine lineNumber="4940"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Process the sinking DbgUsersToSalvage in reverse order, as we only want</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04941" /><CodeLine lineNumber="4941"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to clone the last appearing debug intrinsic for each given variable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04942" /><CodeLine lineNumber="4942"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableIntrinsic &#42;, 2&gt;</a> DbgUsersToSink;</Highlight></CodeLine>
<Link id="l04943" /><CodeLine lineNumber="4943"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbgvariableintrinsic">DbgVariableIntrinsic</a> &#42;DVI : DbgUsersToSalvage)</Highlight></CodeLine>
<Link id="l04944" /><CodeLine lineNumber="4944"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVI-&gt;getParent() == SrcBlock)</Highlight></CodeLine>
<Link id="l04945" /><CodeLine lineNumber="4945"><Highlight kind="normal">      DbgUsersToSink.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(DVI);</Highlight></CodeLine>
<Link id="l04946" /><CodeLine lineNumber="4946"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(DbgUsersToSink,</Highlight></CodeLine>
<Link id="l04947" /><CodeLine lineNumber="4947"><Highlight kind="normal">             &#91;&#93;(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;comesBefore(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>); &#125;);</Highlight></CodeLine>
<Link id="l04948" /><CodeLine lineNumber="4948"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04949" /><CodeLine lineNumber="4949"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableIntrinsic &#42;, 2&gt;</a> DIIClones;</Highlight></CodeLine>
<Link id="l04950" /><CodeLine lineNumber="4950"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;DebugVariable, 4&gt;</a> SunkVariables;</Highlight></CodeLine>
<Link id="l04951" /><CodeLine lineNumber="4951"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/classes/llvm/user">User</a> : DbgUsersToSink) &#123;</Highlight></CodeLine>
<Link id="l04952" /><CodeLine lineNumber="4952"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// A dbg.declare instruction should not be cloned, since there can only be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04953" /><CodeLine lineNumber="4953"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// one per variable fragment. It should be left in the original place</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04954" /><CodeLine lineNumber="4954"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// because the sunk instruction is not an alloca (otherwise we could not be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04955" /><CodeLine lineNumber="4955"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// here).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04956" /><CodeLine lineNumber="4956"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgDeclareInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>))</Highlight></CodeLine>
<Link id="l04957" /><CodeLine lineNumber="4957"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04958" /><CodeLine lineNumber="4958"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04959" /><CodeLine lineNumber="4959"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a> DbgUserVariable =</Highlight></CodeLine>
<Link id="l04960" /><CodeLine lineNumber="4960"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;getVariable(), <a href="/docs/api/classes/llvm/user">User</a>-&gt;getExpression(),</Highlight></CodeLine>
<Link id="l04961" /><CodeLine lineNumber="4961"><Highlight kind="normal">                      <a href="/docs/api/classes/llvm/user">User</a>-&gt;getDebugLoc()-&gt;getInlinedAt());</Highlight></CodeLine>
<Link id="l04962" /><CodeLine lineNumber="4962"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04963" /><CodeLine lineNumber="4963"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SunkVariables.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(DbgUserVariable).second)</Highlight></CodeLine>
<Link id="l04964" /><CodeLine lineNumber="4964"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04965" /><CodeLine lineNumber="4965"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04966" /><CodeLine lineNumber="4966"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Leave dbg.assign intrinsics in their original positions and there should</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04967" /><CodeLine lineNumber="4967"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// be no need to insert a clone.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04968" /><CodeLine lineNumber="4968"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgAssignIntrinsic&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>))</Highlight></CodeLine>
<Link id="l04969" /><CodeLine lineNumber="4969"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04970" /><CodeLine lineNumber="4970"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04971" /><CodeLine lineNumber="4971"><Highlight kind="normal">    DIIClones.emplace&#95;back(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;DbgVariableIntrinsic&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;clone()));</Highlight></CodeLine>
<Link id="l04972" /><CodeLine lineNumber="4972"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgDeclareInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>) &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l04973" /><CodeLine lineNumber="4973"><Highlight kind="normal">      DIIClones.back()-&gt;replaceVariableLocationOp(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l04974" /><CodeLine lineNumber="4974"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;CLONE: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;DIIClones.back() &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04975" /><CodeLine lineNumber="4975"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04976" /><CodeLine lineNumber="4976"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04977" /><CodeLine lineNumber="4977"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Perform salvaging without the clones, then sink the clones.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04978" /><CodeLine lineNumber="4978"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DIIClones.empty()) &#123;</Highlight></CodeLine>
<Link id="l04979" /><CodeLine lineNumber="4979"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a245a901981dbba45d423697bb3351b1b">salvageDebugInfoForDbgValues</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, DbgUsersToSalvage, &#123;&#125;);</Highlight></CodeLine>
<Link id="l04980" /><CodeLine lineNumber="4980"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The clones are in reverse order of original appearance, reverse again to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04981" /><CodeLine lineNumber="4981"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// maintain the original order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04982" /><CodeLine lineNumber="4982"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;DIIClone : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(DIIClones)) &#123;</Highlight></CodeLine>
<Link id="l04983" /><CodeLine lineNumber="4983"><Highlight kind="normal">      DIIClone-&gt;insertBefore(InsertPos);</Highlight></CodeLine>
<Link id="l04984" /><CodeLine lineNumber="4984"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;SINK: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;DIIClone &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04985" /><CodeLine lineNumber="4985"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04986" /><CodeLine lineNumber="4986"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04987" /><CodeLine lineNumber="4987"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04988" /><CodeLine lineNumber="4988"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04989" /><CodeLine lineNumber="4989" lineLink="/docs/api/classes/llvm/instcombinerimpl/#ad4296b2b81379548b300c4676f0d2125"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#ad4296b2b81379548b300c4676f0d2125">InstCombinerImpl::tryToSinkInstructionDbgVariableRecords</a>(</Highlight></CodeLine>
<Link id="l04990" /><CodeLine lineNumber="4990"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPos, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SrcBlock,</Highlight></CodeLine>
<Link id="l04991" /><CodeLine lineNumber="4991"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBlock,</Highlight></CodeLine>
<Link id="l04992" /><CodeLine lineNumber="4992"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;DbgVariableRecord &#42;&gt;</a> &amp;DbgVariableRecords) &#123;</Highlight></CodeLine>
<Link id="l04993" /><CodeLine lineNumber="4993"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Implementation of tryToSinkInstructionDbgValues, but for the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04994" /><CodeLine lineNumber="4994"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// DbgVariableRecord of variable assignments rather than dbg.values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04995" /><CodeLine lineNumber="4995"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04996" /><CodeLine lineNumber="4996"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Fetch all DbgVariableRecords not already in the destination.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04997" /><CodeLine lineNumber="4997"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;, 2&gt;</a> DbgVariableRecordsToSalvage;</Highlight></CodeLine>
<Link id="l04998" /><CodeLine lineNumber="4998"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;DVR : DbgVariableRecords)</Highlight></CodeLine>
<Link id="l04999" /><CodeLine lineNumber="4999"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVR-&gt;getParent() != DestBlock)</Highlight></CodeLine>
<Link id="l05000" /><CodeLine lineNumber="5000"><Highlight kind="normal">      DbgVariableRecordsToSalvage.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(DVR);</Highlight></CodeLine>
<Link id="l05001" /><CodeLine lineNumber="5001"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05002" /><CodeLine lineNumber="5002"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Fetch a second collection, of DbgVariableRecords in the source block that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05003" /><CodeLine lineNumber="5003"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we&#39;re going to sink.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05004" /><CodeLine lineNumber="5004"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;&gt;</a> DbgVariableRecordsToSink;</Highlight></CodeLine>
<Link id="l05005" /><CodeLine lineNumber="5005"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR : DbgVariableRecordsToSalvage)</Highlight></CodeLine>
<Link id="l05006" /><CodeLine lineNumber="5006"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVR-&gt;getParent() == SrcBlock)</Highlight></CodeLine>
<Link id="l05007" /><CodeLine lineNumber="5007"><Highlight kind="normal">      DbgVariableRecordsToSink.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(DVR);</Highlight></CodeLine>
<Link id="l05008" /><CodeLine lineNumber="5008"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05009" /><CodeLine lineNumber="5009"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sort DbgVariableRecords according to their position in the block. This is a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05010" /><CodeLine lineNumber="5010"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// partial order: DbgVariableRecords attached to different instructions will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05011" /><CodeLine lineNumber="5011"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// be ordered by the instruction order, but DbgVariableRecords attached to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05012" /><CodeLine lineNumber="5012"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// same instruction won&#39;t have an order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05013" /><CodeLine lineNumber="5013"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Order = &#91;&#93;(<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05014" /><CodeLine lineNumber="5014"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;getInstruction()-&gt;comesBefore(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getInstruction());</Highlight></CodeLine>
<Link id="l05015" /><CodeLine lineNumber="5015"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l05016" /><CodeLine lineNumber="5016"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(DbgVariableRecordsToSink, Order);</Highlight></CodeLine>
<Link id="l05017" /><CodeLine lineNumber="5017"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05018" /><CodeLine lineNumber="5018"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there are two assignments to the same variable attached to the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05019" /><CodeLine lineNumber="5019"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction, the ordering between the two assignments is important. Scan</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05020" /><CodeLine lineNumber="5020"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// for this (rare) case and establish which is the last assignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05021" /><CodeLine lineNumber="5021"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">InstVarPair = std::pair&lt;const Instruction &#42;, DebugVariable&gt;;</Highlight></CodeLine>
<Link id="l05022" /><CodeLine lineNumber="5022"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;InstVarPair, DbgVariableRecord &#42;&gt;</a> FilterOutMap;</Highlight></CodeLine>
<Link id="l05023" /><CodeLine lineNumber="5023"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DbgVariableRecordsToSink.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt; 1) &#123;</Highlight></CodeLine>
<Link id="l05024" /><CodeLine lineNumber="5024"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;InstVarPair, unsigned&gt;</a> CountMap;</Highlight></CodeLine>
<Link id="l05025" /><CodeLine lineNumber="5025"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Count how many assignments to each variable there is per instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05026" /><CodeLine lineNumber="5026"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR : DbgVariableRecordsToSink) &#123;</Highlight></CodeLine>
<Link id="l05027" /><CodeLine lineNumber="5027"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a> DbgUserVariable =</Highlight></CodeLine>
<Link id="l05028" /><CodeLine lineNumber="5028"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a>(DVR-&gt;getVariable(), DVR-&gt;getExpression(),</Highlight></CodeLine>
<Link id="l05029" /><CodeLine lineNumber="5029"><Highlight kind="normal">                        DVR-&gt;getDebugLoc()-&gt;getInlinedAt());</Highlight></CodeLine>
<Link id="l05030" /><CodeLine lineNumber="5030"><Highlight kind="normal">      CountMap&#91;std::make&#95;pair(DVR-&gt;getInstruction(), DbgUserVariable)&#93; += 1;</Highlight></CodeLine>
<Link id="l05031" /><CodeLine lineNumber="5031"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05032" /><CodeLine lineNumber="5032"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05033" /><CodeLine lineNumber="5033"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If there are any instructions with two assignments, add them to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05034" /><CodeLine lineNumber="5034"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FilterOutMap to record that they need extra filtering.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05035" /><CodeLine lineNumber="5035"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Instruction &#42;, 4&gt;</a> DupSet;</Highlight></CodeLine>
<Link id="l05036" /><CodeLine lineNumber="5036"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It : CountMap) &#123;</Highlight></CodeLine>
<Link id="l05037" /><CodeLine lineNumber="5037"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It.second &gt; 1) &#123;</Highlight></CodeLine>
<Link id="l05038" /><CodeLine lineNumber="5038"><Highlight kind="normal">        FilterOutMap&#91;It.first&#93; = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05039" /><CodeLine lineNumber="5039"><Highlight kind="normal">        DupSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(It.first.first);</Highlight></CodeLine>
<Link id="l05040" /><CodeLine lineNumber="5040"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05041" /><CodeLine lineNumber="5041"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05042" /><CodeLine lineNumber="5042"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05043" /><CodeLine lineNumber="5043"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For all instruction/variable pairs needing extra filtering, find the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05044" /><CodeLine lineNumber="5044"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// latest assignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05045" /><CodeLine lineNumber="5045"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst : DupSet) &#123;</Highlight></CodeLine>
<Link id="l05046" /><CodeLine lineNumber="5046"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &amp;DVR :</Highlight></CodeLine>
<Link id="l05047" /><CodeLine lineNumber="5047"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(<a href="/docs/api/namespaces/llvm/#ae876eb96b89c1afcc3e9cd285cc3f08c">filterDbgVars</a>(Inst-&gt;getDbgRecordRange()))) &#123;</Highlight></CodeLine>
<Link id="l05048" /><CodeLine lineNumber="5048"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a> DbgUserVariable =</Highlight></CodeLine>
<Link id="l05049" /><CodeLine lineNumber="5049"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a>(DVR.getVariable(), DVR.getExpression(),</Highlight></CodeLine>
<Link id="l05050" /><CodeLine lineNumber="5050"><Highlight kind="normal">                          DVR.getDebugLoc()-&gt;getInlinedAt());</Highlight></CodeLine>
<Link id="l05051" /><CodeLine lineNumber="5051"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> FilterIt =</Highlight></CodeLine>
<Link id="l05052" /><CodeLine lineNumber="5052"><Highlight kind="normal">            FilterOutMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(std::make&#95;pair(Inst, DbgUserVariable));</Highlight></CodeLine>
<Link id="l05053" /><CodeLine lineNumber="5053"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FilterIt == FilterOutMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</Highlight></CodeLine>
<Link id="l05054" /><CodeLine lineNumber="5054"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05055" /><CodeLine lineNumber="5055"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FilterIt-&gt;second != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l05056" /><CodeLine lineNumber="5056"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05057" /><CodeLine lineNumber="5057"><Highlight kind="normal">        FilterIt-&gt;second = &amp;DVR;</Highlight></CodeLine>
<Link id="l05058" /><CodeLine lineNumber="5058"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05059" /><CodeLine lineNumber="5059"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05060" /><CodeLine lineNumber="5060"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05061" /><CodeLine lineNumber="5061"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05062" /><CodeLine lineNumber="5062"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Perform cloning of the DbgVariableRecords that we plan on sinking, filter</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05063" /><CodeLine lineNumber="5063"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// out any duplicate assignments identified above.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05064" /><CodeLine lineNumber="5064"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;, 2&gt;</a> DVRClones;</Highlight></CodeLine>
<Link id="l05065" /><CodeLine lineNumber="5065"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;DebugVariable, 4&gt;</a> SunkVariables;</Highlight></CodeLine>
<Link id="l05066" /><CodeLine lineNumber="5066"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR : DbgVariableRecordsToSink) &#123;</Highlight></CodeLine>
<Link id="l05067" /><CodeLine lineNumber="5067"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVR-&gt;Type == <a href="/docs/api/classes/llvm/dbgvariablerecord/#ae2c3391c27b9fa4f64f9ed1bdbbdea4ca2709046ed364cc54b91f908e85e512ed">DbgVariableRecord::LocationType::Declare</a>)</Highlight></CodeLine>
<Link id="l05068" /><CodeLine lineNumber="5068"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05069" /><CodeLine lineNumber="5069"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05070" /><CodeLine lineNumber="5070"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a> DbgUserVariable =</Highlight></CodeLine>
<Link id="l05071" /><CodeLine lineNumber="5071"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/debugvariable">DebugVariable</a>(DVR-&gt;getVariable(), DVR-&gt;getExpression(),</Highlight></CodeLine>
<Link id="l05072" /><CodeLine lineNumber="5072"><Highlight kind="normal">                      DVR-&gt;getDebugLoc()-&gt;getInlinedAt());</Highlight></CodeLine>
<Link id="l05073" /><CodeLine lineNumber="5073"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05074" /><CodeLine lineNumber="5074"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For any variable where there were multiple assignments in the same place,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05075" /><CodeLine lineNumber="5075"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// ignore all but the last assignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05076" /><CodeLine lineNumber="5076"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FilterOutMap.<a href="/docs/api/classes/llvm/densemapbase/#a49c487a9395a6c384be8544cfb2cfccf">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l05077" /><CodeLine lineNumber="5077"><Highlight kind="normal">      InstVarPair IVP = std::make&#95;pair(DVR-&gt;getInstruction(), DbgUserVariable);</Highlight></CodeLine>
<Link id="l05078" /><CodeLine lineNumber="5078"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = FilterOutMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(IVP);</Highlight></CodeLine>
<Link id="l05079" /><CodeLine lineNumber="5079"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05080" /><CodeLine lineNumber="5080"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Filter out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05081" /><CodeLine lineNumber="5081"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It != FilterOutMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; It-&gt;second != DVR)</Highlight></CodeLine>
<Link id="l05082" /><CodeLine lineNumber="5082"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05083" /><CodeLine lineNumber="5083"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05084" /><CodeLine lineNumber="5084"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05085" /><CodeLine lineNumber="5085"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SunkVariables.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(DbgUserVariable).second)</Highlight></CodeLine>
<Link id="l05086" /><CodeLine lineNumber="5086"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05087" /><CodeLine lineNumber="5087"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05088" /><CodeLine lineNumber="5088"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVR-&gt;isDbgAssign())</Highlight></CodeLine>
<Link id="l05089" /><CodeLine lineNumber="5089"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05090" /><CodeLine lineNumber="5090"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05091" /><CodeLine lineNumber="5091"><Highlight kind="normal">    DVRClones.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(DVR-&gt;clone());</Highlight></CodeLine>
<Link id="l05092" /><CodeLine lineNumber="5092"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;CLONE: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;DVRClones.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>() &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05093" /><CodeLine lineNumber="5093"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05094" /><CodeLine lineNumber="5094"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05095" /><CodeLine lineNumber="5095"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Perform salvaging without the clones, then sink the clones.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05096" /><CodeLine lineNumber="5096"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVRClones.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</Highlight></CodeLine>
<Link id="l05097" /><CodeLine lineNumber="5097"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05098" /><CodeLine lineNumber="5098"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05099" /><CodeLine lineNumber="5099"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a245a901981dbba45d423697bb3351b1b">salvageDebugInfoForDbgValues</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &#123;&#125;, DbgVariableRecordsToSalvage);</Highlight></CodeLine>
<Link id="l05100" /><CodeLine lineNumber="5100"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05101" /><CodeLine lineNumber="5101"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The clones are in reverse order of original appearance. Assert that the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05102" /><CodeLine lineNumber="5102"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// head bit is set on the iterator as we &#95;should&#95; have received it via</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05103" /><CodeLine lineNumber="5103"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// getFirstInsertionPt. Inserting like this will reverse the clone order as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05104" /><CodeLine lineNumber="5104"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we&#39;ll repeatedly insert at the head, such as:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05105" /><CodeLine lineNumber="5105"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   DVR-3 (third insertion goes here)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05106" /><CodeLine lineNumber="5106"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   DVR-2 (second insertion goes here)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05107" /><CodeLine lineNumber="5107"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   DVR-1 (first insertion goes here)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05108" /><CodeLine lineNumber="5108"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   Any-Prior-DVRs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05109" /><CodeLine lineNumber="5109"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   InsertPtInst</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05110" /><CodeLine lineNumber="5110"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertPos.getHeadBit());</Highlight></CodeLine>
<Link id="l05111" /><CodeLine lineNumber="5111"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVRClone : DVRClones) &#123;</Highlight></CodeLine>
<Link id="l05112" /><CodeLine lineNumber="5112"><Highlight kind="normal">    InsertPos-&gt;getParent()-&gt;insertDbgRecordBefore(DVRClone, InsertPos);</Highlight></CodeLine>
<Link id="l05113" /><CodeLine lineNumber="5113"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;SINK: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;DVRClone &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05114" /><CodeLine lineNumber="5114"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05115" /><CodeLine lineNumber="5115"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05116" /><CodeLine lineNumber="5116"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05117" /><CodeLine lineNumber="5117" lineLink="/docs/api/classes/llvm/instcombinerimpl/#ac5d3cfa0755b34bcbd3f2298e9fa28ed"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#ac5d3cfa0755b34bcbd3f2298e9fa28ed">InstCombinerImpl::run</a>() &#123;</Highlight></CodeLine>
<Link id="l05118" /><CodeLine lineNumber="5118"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.isEmpty()) &#123;</Highlight></CodeLine>
<Link id="l05119" /><CodeLine lineNumber="5119"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Walk deferred instructions in reverse order, and push them to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05120" /><CodeLine lineNumber="5120"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// worklist, which means they&#39;ll end up popped from the worklist in-order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05121" /><CodeLine lineNumber="5121"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.popDeferred()) &#123;</Highlight></CodeLine>
<Link id="l05122" /><CodeLine lineNumber="5122"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Check to see if we can DCE the instruction. We do this already here to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05123" /><CodeLine lineNumber="5123"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// reduce the number of uses and thus allow other folds to trigger.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05124" /><CodeLine lineNumber="5124"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Note that eraseInstFromFunction() may push additional instructions on</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05125" /><CodeLine lineNumber="5125"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the deferred worklist, so this will DCE whole instruction chains.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05126" /><CodeLine lineNumber="5126"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &amp;<a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>)) &#123;</Highlight></CodeLine>
<Link id="l05127" /><CodeLine lineNumber="5127"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05128" /><CodeLine lineNumber="5128"><Highlight kind="normal">        ++NumDeadInst;</Highlight></CodeLine>
<Link id="l05129" /><CodeLine lineNumber="5129"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05130" /><CodeLine lineNumber="5130"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05131" /><CodeLine lineNumber="5131"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05132" /><CodeLine lineNumber="5132"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.push(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05133" /><CodeLine lineNumber="5133"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05134" /><CodeLine lineNumber="5134"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05135" /><CodeLine lineNumber="5135"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.removeOne();</Highlight></CodeLine>
<Link id="l05136" /><CodeLine lineNumber="5136"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;  </Highlight><Highlight kind="comment">// skip null values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05137" /><CodeLine lineNumber="5137"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05138" /><CodeLine lineNumber="5138"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check to see if we can DCE the instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05139" /><CodeLine lineNumber="5139"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &amp;<a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>)) &#123;</Highlight></CodeLine>
<Link id="l05140" /><CodeLine lineNumber="5140"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05141" /><CodeLine lineNumber="5141"><Highlight kind="normal">      ++NumDeadInst;</Highlight></CodeLine>
<Link id="l05142" /><CodeLine lineNumber="5142"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05143" /><CodeLine lineNumber="5143"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05144" /><CodeLine lineNumber="5144"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05145" /><CodeLine lineNumber="5145"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/debugcounter/#a5aace8653ce3726ef07194dcf6bce2bf">DebugCounter::shouldExecute</a>(VisitCounter))</Highlight></CodeLine>
<Link id="l05146" /><CodeLine lineNumber="5146"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05147" /><CodeLine lineNumber="5147"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05148" /><CodeLine lineNumber="5148"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// See if we can trivially sink this instruction to its user if we can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05149" /><CodeLine lineNumber="5149"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// prove that the successor is not executed more frequently than our block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05150" /><CodeLine lineNumber="5150"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Return the UserBlock if successful.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05151" /><CodeLine lineNumber="5151"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> getOptionalSinkBlockForInst =</Highlight></CodeLine>
<Link id="l05152" /><CodeLine lineNumber="5152"><Highlight kind="normal">        &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; std::optional&lt;BasicBlock &#42;&gt; &#123;</Highlight></CodeLine>
<Link id="l05153" /><CodeLine lineNumber="5153"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#af2d52269f675e18b1f7e7cd3b4df6c47">EnableCodeSinking</a>)</Highlight></CodeLine>
<Link id="l05154" /><CodeLine lineNumber="5154"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l05155" /><CodeLine lineNumber="5155"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05156" /><CodeLine lineNumber="5156"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l05157" /><CodeLine lineNumber="5157"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UserParent = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05158" /><CodeLine lineNumber="5158"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumUsers = 0;</Highlight></CodeLine>
<Link id="l05159" /><CodeLine lineNumber="5159"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05160" /><CodeLine lineNumber="5160"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;uses()) &#123;</Highlight></CodeLine>
<Link id="l05161" /><CodeLine lineNumber="5161"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/user">User</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = U.getUser();</Highlight></CodeLine>
<Link id="l05162" /><CodeLine lineNumber="5162"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/user/#af6a49991304b167c94f4a9756d3fd48f">isDroppable</a>())</Highlight></CodeLine>
<Link id="l05163" /><CodeLine lineNumber="5163"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05164" /><CodeLine lineNumber="5164"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumUsers &gt; <a href="#acdf26e07093ddfc79830643f176af525">MaxSinkNumUsers</a>)</Highlight></CodeLine>
<Link id="l05165" /><CodeLine lineNumber="5165"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l05166" /><CodeLine lineNumber="5166"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05167" /><CodeLine lineNumber="5167"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UserInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</Highlight></CodeLine>
<Link id="l05168" /><CodeLine lineNumber="5168"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Special handling for Phi nodes - get the block the use occurs in.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05169" /><CodeLine lineNumber="5169"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UserBB = UserInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l05170" /><CodeLine lineNumber="5170"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(UserInst))</Highlight></CodeLine>
<Link id="l05171" /><CodeLine lineNumber="5171"><Highlight kind="normal">          UserBB = PN-&gt;getIncomingBlock(U);</Highlight></CodeLine>
<Link id="l05172" /><CodeLine lineNumber="5172"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Bail out if we have uses in different blocks. We don&#39;t do any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05173" /><CodeLine lineNumber="5173"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// sophisticated analysis (i.e finding NearestCommonDominator of these</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05174" /><CodeLine lineNumber="5174"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// use blocks).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05175" /><CodeLine lineNumber="5175"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserParent &amp;&amp; UserParent != UserBB)</Highlight></CodeLine>
<Link id="l05176" /><CodeLine lineNumber="5176"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l05177" /><CodeLine lineNumber="5177"><Highlight kind="normal">        UserParent = UserBB;</Highlight></CodeLine>
<Link id="l05178" /><CodeLine lineNumber="5178"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05179" /><CodeLine lineNumber="5179"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Make sure these checks are done only once, naturally we do the checks</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05180" /><CodeLine lineNumber="5180"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// the first time we get the userparent, this will save compile time.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05181" /><CodeLine lineNumber="5181"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumUsers == 0) &#123;</Highlight></CodeLine>
<Link id="l05182" /><CodeLine lineNumber="5182"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Try sinking to another block. If that block is unreachable, then do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05183" /><CodeLine lineNumber="5183"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// not bother. SimplifyCFG should handle it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05184" /><CodeLine lineNumber="5184"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserParent == BB || !<a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>.isReachableFromEntry(UserParent))</Highlight></CodeLine>
<Link id="l05185" /><CodeLine lineNumber="5185"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l05186" /><CodeLine lineNumber="5186"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05187" /><CodeLine lineNumber="5187"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Term = UserParent-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l05188" /><CodeLine lineNumber="5188"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// See if the user is one of our successors that has only one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05189" /><CodeLine lineNumber="5189"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// predecessor, so that we don&#39;t have to split the critical edge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05190" /><CodeLine lineNumber="5190"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Another option where we can sink is a block that ends with a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05191" /><CodeLine lineNumber="5191"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// terminator that does not pass control to other block (such as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05192" /><CodeLine lineNumber="5192"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// return or unreachable or resume). In this case:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05193" /><CodeLine lineNumber="5193"><Highlight kind="normal">          </Highlight><Highlight kind="comment">//   - I dominates the User (by SSA form);</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05194" /><CodeLine lineNumber="5194"><Highlight kind="normal">          </Highlight><Highlight kind="comment">//   - the User will be executed at most once.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05195" /><CodeLine lineNumber="5195"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// So sinking I down to User is always profitable or neutral.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05196" /><CodeLine lineNumber="5196"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserParent-&gt;<a href="/docs/api/classes/llvm/basicblock/#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>() != BB &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a126a78caf2176eb39d879c899bdd749c">succ&#95;empty</a>(Term))</Highlight></CodeLine>
<Link id="l05197" /><CodeLine lineNumber="5197"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l05198" /><CodeLine lineNumber="5198"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05199" /><CodeLine lineNumber="5199"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>.dominates(BB, UserParent) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Dominance relation broken?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05200" /><CodeLine lineNumber="5200"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05201" /><CodeLine lineNumber="5201"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05202" /><CodeLine lineNumber="5202"><Highlight kind="normal">        NumUsers++;</Highlight></CodeLine>
<Link id="l05203" /><CodeLine lineNumber="5203"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05204" /><CodeLine lineNumber="5204"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05205" /><CodeLine lineNumber="5205"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// No user or only has droppable users.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05206" /><CodeLine lineNumber="5206"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UserParent)</Highlight></CodeLine>
<Link id="l05207" /><CodeLine lineNumber="5207"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l05208" /><CodeLine lineNumber="5208"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05209" /><CodeLine lineNumber="5209"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> UserParent;</Highlight></CodeLine>
<Link id="l05210" /><CodeLine lineNumber="5210"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l05211" /><CodeLine lineNumber="5211"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05212" /><CodeLine lineNumber="5212"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> OptBB = getOptionalSinkBlockForInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05213" /><CodeLine lineNumber="5213"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OptBB) &#123;</Highlight></CodeLine>
<Link id="l05214" /><CodeLine lineNumber="5214"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UserParent = &#42;OptBB;</Highlight></CodeLine>
<Link id="l05215" /><CodeLine lineNumber="5215"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Okay, the CFG is simple enough, try to sink this instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05216" /><CodeLine lineNumber="5216"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instcombinerimpl/#af4b167ac2fde7b3d71172817650150a6">tryToSinkInstruction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, UserParent)) &#123;</Highlight></CodeLine>
<Link id="l05217" /><CodeLine lineNumber="5217"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;IC: Sink: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05218" /><CodeLine lineNumber="5218"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05219" /><CodeLine lineNumber="5219"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We&#39;ll add uses of the sunk instruction below, but since</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05220" /><CodeLine lineNumber="5220"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// sinking can expose opportunities for it&#39;s &#42;operands&#42; add</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05221" /><CodeLine lineNumber="5221"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// them to the worklist</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05222" /><CodeLine lineNumber="5222"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</Highlight></CodeLine>
<Link id="l05223" /><CodeLine lineNumber="5223"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OpI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U.get()))</Highlight></CodeLine>
<Link id="l05224" /><CodeLine lineNumber="5224"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.push(OpI);</Highlight></CodeLine>
<Link id="l05225" /><CodeLine lineNumber="5225"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05226" /><CodeLine lineNumber="5226"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05227" /><CodeLine lineNumber="5227"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05228" /><CodeLine lineNumber="5228"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Now that we have an instruction, try combining it to simplify it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05229" /><CodeLine lineNumber="5229"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.SetInsertPoint(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05230" /><CodeLine lineNumber="5230"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#ae1d331bc844ecb92bdeb0b706ae04396">Builder</a>.CollectMetadataToCopy(</Highlight></CodeLine>
<Link id="l05231" /><CodeLine lineNumber="5231"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &#123;LLVMContext::MD&#95;dbg, LLVMContext::MD&#95;annotation&#125;);</Highlight></CodeLine>
<Link id="l05232" /><CodeLine lineNumber="5232"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05233" /><CodeLine lineNumber="5233"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05234" /><CodeLine lineNumber="5234"><Highlight kind="normal">    std::string OrigI;</Highlight></CodeLine>
<Link id="l05235" /><CodeLine lineNumber="5235"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05236" /><CodeLine lineNumber="5236"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/classes/llvm/raw-string-ostream">raw&#95;string&#95;ostream</a> SS(OrigI); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;print(SS););</Highlight></CodeLine>
<Link id="l05237" /><CodeLine lineNumber="5237"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;IC: Visiting: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; OrigI &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05238" /><CodeLine lineNumber="5238"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05239" /><CodeLine lineNumber="5239"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Result = <a href="/docs/api/classes/llvm/instvisitor/#a6352e72d11377a9c62f24434ae869bf0">visit</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l05240" /><CodeLine lineNumber="5240"><Highlight kind="normal">      ++NumCombined;</Highlight></CodeLine>
<Link id="l05241" /><CodeLine lineNumber="5241"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Should we replace the old instruction with a new one?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05242" /><CodeLine lineNumber="5242"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Result != <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l05243" /><CodeLine lineNumber="5243"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;IC: Old = &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05244" /><CodeLine lineNumber="5244"><Highlight kind="normal">                          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    New = &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Result &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05245" /><CodeLine lineNumber="5245"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05246" /><CodeLine lineNumber="5246"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We copy the old instruction&#39;s DebugLoc to the new instruction, unless</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05247" /><CodeLine lineNumber="5247"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// InstCombine already assigned a DebugLoc to it, in which case we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05248" /><CodeLine lineNumber="5248"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// should trust the more specifically selected DebugLoc.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05249" /><CodeLine lineNumber="5249"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Result-&gt;getDebugLoc())</Highlight></CodeLine>
<Link id="l05250" /><CodeLine lineNumber="5250"><Highlight kind="normal">          Result-&gt;setDebugLoc(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l05251" /><CodeLine lineNumber="5251"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We also copy annotation metadata to the new instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05252" /><CodeLine lineNumber="5252"><Highlight kind="normal">        Result-&gt;copyMetadata(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, LLVMContext::MD&#95;annotation);</Highlight></CodeLine>
<Link id="l05253" /><CodeLine lineNumber="5253"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Everything uses the new instruction now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05254" /><CodeLine lineNumber="5254"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(Result);</Highlight></CodeLine>
<Link id="l05255" /><CodeLine lineNumber="5255"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05256" /><CodeLine lineNumber="5256"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Move the name to the new instruction first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05257" /><CodeLine lineNumber="5257"><Highlight kind="normal">        Result-&gt;takeName(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05258" /><CodeLine lineNumber="5258"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05259" /><CodeLine lineNumber="5259"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Insert the new instruction into the basic block...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05260" /><CodeLine lineNumber="5260"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InstParent = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l05261" /><CodeLine lineNumber="5261"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPos = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIterator();</Highlight></CodeLine>
<Link id="l05262" /><CodeLine lineNumber="5262"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05263" /><CodeLine lineNumber="5263"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Are we replace a PHI with something that isn&#39;t a PHI, or vice versa?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05264" /><CodeLine lineNumber="5264"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(Result) != <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l05265" /><CodeLine lineNumber="5265"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We need to fix up the insertion point.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05266" /><CodeLine lineNumber="5266"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) </Highlight><Highlight kind="comment">// PHI -&gt; Non-PHI</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05267" /><CodeLine lineNumber="5267"><Highlight kind="normal">            InsertPos = InstParent-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</Highlight></CodeLine>
<Link id="l05268" /><CodeLine lineNumber="5268"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">// Non-PHI -&gt; PHI</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05269" /><CodeLine lineNumber="5269"><Highlight kind="normal">            InsertPos = InstParent-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>();</Highlight></CodeLine>
<Link id="l05270" /><CodeLine lineNumber="5270"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05271" /><CodeLine lineNumber="5271"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05272" /><CodeLine lineNumber="5272"><Highlight kind="normal">        Result-&gt;insertInto(InstParent, InsertPos);</Highlight></CodeLine>
<Link id="l05273" /><CodeLine lineNumber="5273"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05274" /><CodeLine lineNumber="5274"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Push the new instruction and any users onto the worklist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05275" /><CodeLine lineNumber="5275"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.pushUsersToWorkList(&#42;Result);</Highlight></CodeLine>
<Link id="l05276" /><CodeLine lineNumber="5276"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.push(Result);</Highlight></CodeLine>
<Link id="l05277" /><CodeLine lineNumber="5277"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05278" /><CodeLine lineNumber="5278"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05279" /><CodeLine lineNumber="5279"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05280" /><CodeLine lineNumber="5280"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;IC: Mod = &quot;</Highlight><Highlight kind="normal"> &lt;&lt; OrigI &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05281" /><CodeLine lineNumber="5281"><Highlight kind="normal">                          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    New = &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05282" /><CodeLine lineNumber="5282"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05283" /><CodeLine lineNumber="5283"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the instruction was modified, it&#39;s possible that it is now dead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05284" /><CodeLine lineNumber="5284"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// if so, remove it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05285" /><CodeLine lineNumber="5285"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &amp;<a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>)) &#123;</Highlight></CodeLine>
<Link id="l05286" /><CodeLine lineNumber="5286"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombinerimpl/#a6fc7cb23fbdc2e353fdf2f3aa5212e92">eraseInstFromFunction</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05287" /><CodeLine lineNumber="5287"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05288" /><CodeLine lineNumber="5288"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.pushUsersToWorkList(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05289" /><CodeLine lineNumber="5289"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.push(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05290" /><CodeLine lineNumber="5290"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05291" /><CodeLine lineNumber="5291"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05292" /><CodeLine lineNumber="5292"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05293" /><CodeLine lineNumber="5293"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05294" /><CodeLine lineNumber="5294"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05295" /><CodeLine lineNumber="5295"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05296" /><CodeLine lineNumber="5296"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.zap();</Highlight></CodeLine>
<Link id="l05297" /><CodeLine lineNumber="5297"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a>;</Highlight></CodeLine>
<Link id="l05298" /><CodeLine lineNumber="5298"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05299" /><CodeLine lineNumber="5299"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05300" /><CodeLine lineNumber="5300"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Track the scopes used by !alias.scope and !noalias. In a function, a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05301" /><CodeLine lineNumber="5301"><Highlight kind="normal"></Highlight><Highlight kind="comment">// @llvm.experimental.noalias.scope.decl is only useful if that scope is used</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05302" /><CodeLine lineNumber="5302"><Highlight kind="normal"></Highlight><Highlight kind="comment">// by both sets. If not, the declaration of the scope can be safely omitted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05303" /><CodeLine lineNumber="5303"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The MDNode of the scope can be omitted as well for the instructions that are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05304" /><CodeLine lineNumber="5304"><Highlight kind="normal"></Highlight><Highlight kind="comment">// part of this function. We do not do that at this point, as this might become</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05305" /><CodeLine lineNumber="5305"><Highlight kind="normal"></Highlight><Highlight kind="comment">// too time consuming to do.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05306" /><CodeLine lineNumber="5306" lineLink="/docs/api/classes/aliasscopetracker"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/aliasscopetracker">AliasScopeTracker</a> &#123;</Highlight></CodeLine>
<Link id="l05307" /><CodeLine lineNumber="5307"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const MDNode &#42;, 8&gt;</a> UsedAliasScopesAndLists;</Highlight></CodeLine>
<Link id="l05308" /><CodeLine lineNumber="5308"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const MDNode &#42;, 8&gt;</a> UsedNoAliasScopesAndLists;</Highlight></CodeLine>
<Link id="l05309" /><CodeLine lineNumber="5309"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05310" /><CodeLine lineNumber="5310"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l05311" /><CodeLine lineNumber="5311" lineLink="/docs/api/classes/aliasscopetracker/#ab6c7ca8d33397896ff4fda4b5c023a40"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/aliasscopetracker/#ab6c7ca8d33397896ff4fda4b5c023a40">analyse</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l05312" /><CodeLine lineNumber="5312"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This seems to be faster than checking &#39;mayReadOrWriteMemory()&#39;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05313" /><CodeLine lineNumber="5313"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasMetadataOtherThanDebugLoc())</Highlight></CodeLine>
<Link id="l05314" /><CodeLine lineNumber="5314"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05315" /><CodeLine lineNumber="5315"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05316" /><CodeLine lineNumber="5316"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Track = &#91;&#93;(<a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;ScopeList, </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Container) &#123;</Highlight></CodeLine>
<Link id="l05317" /><CodeLine lineNumber="5317"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MDScopeList = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;MDNode&gt;</a>(ScopeList);</Highlight></CodeLine>
<Link id="l05318" /><CodeLine lineNumber="5318"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MDScopeList || !Container.insert(MDScopeList).second)</Highlight></CodeLine>
<Link id="l05319" /><CodeLine lineNumber="5319"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05320" /><CodeLine lineNumber="5320"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/classes/llvm/mdoperand">MDOperand</a> : MDScopeList-&gt;operands())</Highlight></CodeLine>
<Link id="l05321" /><CodeLine lineNumber="5321"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MDScope = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDNode&gt;</a>(<a href="/docs/api/classes/llvm/mdoperand">MDOperand</a>))</Highlight></CodeLine>
<Link id="l05322" /><CodeLine lineNumber="5322"><Highlight kind="normal">          Container.insert(MDScope);</Highlight></CodeLine>
<Link id="l05323" /><CodeLine lineNumber="5323"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l05324" /><CodeLine lineNumber="5324"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05325" /><CodeLine lineNumber="5325"><Highlight kind="normal">    Track(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getMetadata(LLVMContext::MD&#95;alias&#95;scope), UsedAliasScopesAndLists);</Highlight></CodeLine>
<Link id="l05326" /><CodeLine lineNumber="5326"><Highlight kind="normal">    Track(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getMetadata(LLVMContext::MD&#95;noalias), UsedNoAliasScopesAndLists);</Highlight></CodeLine>
<Link id="l05327" /><CodeLine lineNumber="5327"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05328" /><CodeLine lineNumber="5328"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05329" /><CodeLine lineNumber="5329" lineLink="/docs/api/classes/aliasscopetracker/#a426cdd40c6024520c943e7c3d11f1d78"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/aliasscopetracker/#a426cdd40c6024520c943e7c3d11f1d78">isNoAliasScopeDeclDead</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst) &#123;</Highlight></CodeLine>
<Link id="l05330" /><CodeLine lineNumber="5330"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/noaliasscopedeclinst">NoAliasScopeDeclInst</a> &#42;Decl = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;NoAliasScopeDeclInst&gt;</a>(Inst);</Highlight></CodeLine>
<Link id="l05331" /><CodeLine lineNumber="5331"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Decl)</Highlight></CodeLine>
<Link id="l05332" /><CodeLine lineNumber="5332"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05333" /><CodeLine lineNumber="5333"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05334" /><CodeLine lineNumber="5334"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Decl-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05335" /><CodeLine lineNumber="5335"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;llvm.experimental.noalias.scope.decl in use ?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05336" /><CodeLine lineNumber="5336"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;MDSL = Decl-&gt;<a href="/docs/api/classes/llvm/noaliasscopedeclinst/#a34f6aa565eff649a89e0406f516d12a5">getScopeList</a>();</Highlight></CodeLine>
<Link id="l05337" /><CodeLine lineNumber="5337"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MDSL-&gt;<a href="/docs/api/classes/llvm/mdnode/#aa4068e37ec583962685e3567dc102ae5">getNumOperands</a>() == 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l05338" /><CodeLine lineNumber="5338"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;llvm.experimental.noalias.scope should refer to a single scope&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05339" /><CodeLine lineNumber="5339"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/classes/llvm/mdoperand">MDOperand</a> = MDSL-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l05340" /><CodeLine lineNumber="5340"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MD = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDNode&gt;</a>(<a href="/docs/api/classes/llvm/mdoperand">MDOperand</a>))</Highlight></CodeLine>
<Link id="l05341" /><CodeLine lineNumber="5341"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !UsedAliasScopesAndLists.contains(MD) ||</Highlight></CodeLine>
<Link id="l05342" /><CodeLine lineNumber="5342"><Highlight kind="normal">             !UsedNoAliasScopesAndLists.contains(MD);</Highlight></CodeLine>
<Link id="l05343" /><CodeLine lineNumber="5343"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05344" /><CodeLine lineNumber="5344"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Not an MDNode ? throw away.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05345" /><CodeLine lineNumber="5345"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05346" /><CodeLine lineNumber="5346"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05347" /><CodeLine lineNumber="5347"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l05348" /><CodeLine lineNumber="5348"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l05349" /><CodeLine lineNumber="5349"><Highlight kind="comment">/// Populate the IC worklist from a function, by walking it in reverse</Highlight></CodeLine>
<Link id="l05350" /><CodeLine lineNumber="5350"><Highlight kind="comment">/// post-order and adding all reachable code to the worklist.</Highlight></CodeLine>
<Link id="l05351" /><CodeLine lineNumber="5351"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l05352" /><CodeLine lineNumber="5352"><Highlight kind="comment">/// This has a couple of tricks to make the code faster and more powerful.  In</Highlight></CodeLine>
<Link id="l05353" /><CodeLine lineNumber="5353"><Highlight kind="comment">/// particular, we constant fold and DCE instructions as we go, to avoid adding</Highlight></CodeLine>
<Link id="l05354" /><CodeLine lineNumber="5354"><Highlight kind="comment">/// them to the worklist (this significantly speeds up instcombine on code where</Highlight></CodeLine>
<Link id="l05355" /><CodeLine lineNumber="5355"><Highlight kind="comment">/// many instructions are dead or constant).  Additionally, if we find a branch</Highlight></CodeLine>
<Link id="l05356" /><CodeLine lineNumber="5356"><Highlight kind="comment">/// whose condition is a known constant, we only visit the reachable successors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05357" /><CodeLine lineNumber="5357" lineLink="/docs/api/classes/llvm/instcombinerimpl/#a51dffbda74e47e34a64858d09d456108"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinerimpl/#a51dffbda74e47e34a64858d09d456108">InstCombinerImpl::prepareWorklist</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l05358" /><CodeLine lineNumber="5358"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05359" /><CodeLine lineNumber="5359"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 32&gt;</a> LiveBlocks;</Highlight></CodeLine>
<Link id="l05360" /><CodeLine lineNumber="5360"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 128&gt;</a> InstrsForInstructionWorklist;</Highlight></CodeLine>
<Link id="l05361" /><CodeLine lineNumber="5361"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Constant &#42;, Constant &#42;&gt;</a> FoldedConstants;</Highlight></CodeLine>
<Link id="l05362" /><CodeLine lineNumber="5362"><Highlight kind="normal">  <a href="/docs/api/classes/aliasscopetracker">AliasScopeTracker</a> SeenAliasScopes;</Highlight></CodeLine>
<Link id="l05363" /><CodeLine lineNumber="5363"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05364" /><CodeLine lineNumber="5364"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> HandleOnlyLiveSuccessor = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LiveSucc) &#123;</Highlight></CodeLine>
<Link id="l05365" /><CodeLine lineNumber="5365"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB))</Highlight></CodeLine>
<Link id="l05366" /><CodeLine lineNumber="5366"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succ != LiveSucc &amp;&amp; <a href="/docs/api/classes/llvm/instcombiner/#ad9606d00d0f1d7488ee416b25857f223">DeadEdges</a>.insert(&#123;BB, Succ&#125;).second)</Highlight></CodeLine>
<Link id="l05367" /><CodeLine lineNumber="5367"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : Succ-&gt;phis())</Highlight></CodeLine>
<Link id="l05368" /><CodeLine lineNumber="5368"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : PN.incoming&#95;values())</Highlight></CodeLine>
<Link id="l05369" /><CodeLine lineNumber="5369"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PN.getIncomingBlock(U) == BB &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l05370" /><CodeLine lineNumber="5370"><Highlight kind="normal">              U.set(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(PN.getType()));</Highlight></CodeLine>
<Link id="l05371" /><CodeLine lineNumber="5371"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05372" /><CodeLine lineNumber="5372"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l05373" /><CodeLine lineNumber="5373"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l05374" /><CodeLine lineNumber="5374"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05375" /><CodeLine lineNumber="5375"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/instcombiner/#a8768d7bd3a905c9cd89c3738d4873a0d">RPOT</a>) &#123;</Highlight></CodeLine>
<Link id="l05376" /><CodeLine lineNumber="5376"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a4ec05121d4b54b3691ad6203e78ff54e">isEntryBlock</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred) &#123;</Highlight></CodeLine>
<Link id="l05377" /><CodeLine lineNumber="5377"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ad9606d00d0f1d7488ee416b25857f223">DeadEdges</a>.contains(&#123;Pred, BB&#125;) || <a href="/docs/api/classes/llvm/instcombiner/#ac881b40b83c0bd8934689bdc8c306cf5">DT</a>.dominates(BB, Pred);</Highlight></CodeLine>
<Link id="l05378" /><CodeLine lineNumber="5378"><Highlight kind="normal">        &#125;)) &#123;</Highlight></CodeLine>
<Link id="l05379" /><CodeLine lineNumber="5379"><Highlight kind="normal">      HandleOnlyLiveSuccessor(BB, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05380" /><CodeLine lineNumber="5380"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05381" /><CodeLine lineNumber="5381"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05382" /><CodeLine lineNumber="5382"><Highlight kind="normal">    LiveBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(BB);</Highlight></CodeLine>
<Link id="l05383" /><CodeLine lineNumber="5383"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05384" /><CodeLine lineNumber="5384"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(&#42;BB)) &#123;</Highlight></CodeLine>
<Link id="l05385" /><CodeLine lineNumber="5385"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// ConstantProp instruction if trivially constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05386" /><CodeLine lineNumber="5386"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Inst.use&#95;empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l05387" /><CodeLine lineNumber="5387"><Highlight kind="normal">          (Inst.getNumOperands() == 0 || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Inst.getOperand(0))))</Highlight></CodeLine>
<Link id="l05388" /><CodeLine lineNumber="5388"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#ab6be6270337c6f7620007555247401ce">ConstantFoldInstruction</a>(&amp;Inst, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>, &amp;<a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>)) &#123;</Highlight></CodeLine>
<Link id="l05389" /><CodeLine lineNumber="5389"><Highlight kind="normal">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;IC: ConstFold to: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; from: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; Inst</Highlight></CodeLine>
<Link id="l05390" /><CodeLine lineNumber="5390"><Highlight kind="normal">                            &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05391" /><CodeLine lineNumber="5391"><Highlight kind="normal">          Inst.replaceAllUsesWith(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</Highlight></CodeLine>
<Link id="l05392" /><CodeLine lineNumber="5392"><Highlight kind="normal">          ++NumConstProp;</Highlight></CodeLine>
<Link id="l05393" /><CodeLine lineNumber="5393"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(&amp;Inst, &amp;<a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>))</Highlight></CodeLine>
<Link id="l05394" /><CodeLine lineNumber="5394"><Highlight kind="normal">            Inst.eraseFromParent();</Highlight></CodeLine>
<Link id="l05395" /><CodeLine lineNumber="5395"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05396" /><CodeLine lineNumber="5396"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05397" /><CodeLine lineNumber="5397"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05398" /><CodeLine lineNumber="5398"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05399" /><CodeLine lineNumber="5399"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// See if we can constant fold its operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05400" /><CodeLine lineNumber="5400"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : Inst.operands()) &#123;</Highlight></CodeLine>
<Link id="l05401" /><CodeLine lineNumber="5401"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantVector&gt;</a>(U) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantExpr&gt;</a>(U))</Highlight></CodeLine>
<Link id="l05402" /><CodeLine lineNumber="5402"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05403" /><CodeLine lineNumber="5403"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05404" /><CodeLine lineNumber="5404"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(U);</Highlight></CodeLine>
<Link id="l05405" /><CodeLine lineNumber="5405"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;&amp;FoldRes = FoldedConstants&#91;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>&#93;;</Highlight></CodeLine>
<Link id="l05406" /><CodeLine lineNumber="5406"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FoldRes)</Highlight></CodeLine>
<Link id="l05407" /><CodeLine lineNumber="5407"><Highlight kind="normal">          FoldRes = <a href="/docs/api/namespaces/llvm/#a5e655fd99a56d50b071fc26d8db5fd5b">ConstantFoldConstant</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/classes/llvm/instcombiner/#a878e8128a9a4e5626df91dcd91cba337">DL</a>, &amp;<a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>);</Highlight></CodeLine>
<Link id="l05408" /><CodeLine lineNumber="5408"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05409" /><CodeLine lineNumber="5409"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FoldRes != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &#123;</Highlight></CodeLine>
<Link id="l05410" /><CodeLine lineNumber="5410"><Highlight kind="normal">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;IC: ConstFold operand of: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; Inst</Highlight></CodeLine>
<Link id="l05411" /><CodeLine lineNumber="5411"><Highlight kind="normal">                            &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n    Old = &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a></Highlight></CodeLine>
<Link id="l05412" /><CodeLine lineNumber="5412"><Highlight kind="normal">                            &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n    New = &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;FoldRes &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05413" /><CodeLine lineNumber="5413"><Highlight kind="normal">          U = FoldRes;</Highlight></CodeLine>
<Link id="l05414" /><CodeLine lineNumber="5414"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05415" /><CodeLine lineNumber="5415"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05416" /><CodeLine lineNumber="5416"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05417" /><CodeLine lineNumber="5417"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05418" /><CodeLine lineNumber="5418"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Skip processing debug and pseudo intrinsics in InstCombine. Processing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05419" /><CodeLine lineNumber="5419"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// these call instructions consumes non-trivial amount of time and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05420" /><CodeLine lineNumber="5420"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// provides no value for the optimization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05421" /><CodeLine lineNumber="5421"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Inst.isDebugOrPseudoInst()) &#123;</Highlight></CodeLine>
<Link id="l05422" /><CodeLine lineNumber="5422"><Highlight kind="normal">        InstrsForInstructionWorklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;Inst);</Highlight></CodeLine>
<Link id="l05423" /><CodeLine lineNumber="5423"><Highlight kind="normal">        SeenAliasScopes.<a href="/docs/api/classes/aliasscopetracker/#ab6c7ca8d33397896ff4fda4b5c023a40">analyse</a>(&amp;Inst);</Highlight></CodeLine>
<Link id="l05424" /><CodeLine lineNumber="5424"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05425" /><CodeLine lineNumber="5425"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05426" /><CodeLine lineNumber="5426"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05427" /><CodeLine lineNumber="5427"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this is a branch or switch on a constant, mark only the single</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05428" /><CodeLine lineNumber="5428"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// live successor. Otherwise assume all successors are live.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05429" /><CodeLine lineNumber="5429"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l05430" /><CodeLine lineNumber="5430"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(TI); BI &amp;&amp; BI-&gt;isConditional()) &#123;</Highlight></CodeLine>
<Link id="l05431" /><CodeLine lineNumber="5431"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(BI-&gt;getCondition())) &#123;</Highlight></CodeLine>
<Link id="l05432" /><CodeLine lineNumber="5432"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Branch on undef is UB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05433" /><CodeLine lineNumber="5433"><Highlight kind="normal">        HandleOnlyLiveSuccessor(BB, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05434" /><CodeLine lineNumber="5434"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05435" /><CodeLine lineNumber="5435"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05436" /><CodeLine lineNumber="5436"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(BI-&gt;getCondition())) &#123;</Highlight></CodeLine>
<Link id="l05437" /><CodeLine lineNumber="5437"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CondVal = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l05438" /><CodeLine lineNumber="5438"><Highlight kind="normal">        HandleOnlyLiveSuccessor(BB, BI-&gt;getSuccessor(!CondVal));</Highlight></CodeLine>
<Link id="l05439" /><CodeLine lineNumber="5439"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05440" /><CodeLine lineNumber="5440"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05441" /><CodeLine lineNumber="5441"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(TI)) &#123;</Highlight></CodeLine>
<Link id="l05442" /><CodeLine lineNumber="5442"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition())) &#123;</Highlight></CodeLine>
<Link id="l05443" /><CodeLine lineNumber="5443"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Switch on undef is UB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05444" /><CodeLine lineNumber="5444"><Highlight kind="normal">        HandleOnlyLiveSuccessor(BB, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05445" /><CodeLine lineNumber="5445"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05446" /><CodeLine lineNumber="5446"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05447" /><CodeLine lineNumber="5447"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition())) &#123;</Highlight></CodeLine>
<Link id="l05448" /><CodeLine lineNumber="5448"><Highlight kind="normal">        HandleOnlyLiveSuccessor(BB,</Highlight></CodeLine>
<Link id="l05449" /><CodeLine lineNumber="5449"><Highlight kind="normal">                                <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;findCaseValue(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)-&gt;getCaseSuccessor());</Highlight></CodeLine>
<Link id="l05450" /><CodeLine lineNumber="5450"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05451" /><CodeLine lineNumber="5451"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05452" /><CodeLine lineNumber="5452"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05453" /><CodeLine lineNumber="5453"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05454" /><CodeLine lineNumber="5454"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05455" /><CodeLine lineNumber="5455"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove instructions inside unreachable blocks. This prevents the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05456" /><CodeLine lineNumber="5456"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instcombine code from having to deal with some bad special cases, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05457" /><CodeLine lineNumber="5457"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reduces use counts of instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05458" /><CodeLine lineNumber="5458"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l05459" /><CodeLine lineNumber="5459"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LiveBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(&amp;BB))</Highlight></CodeLine>
<Link id="l05460" /><CodeLine lineNumber="5460"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05461" /><CodeLine lineNumber="5461"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05462" /><CodeLine lineNumber="5462"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumDeadInstInBB;</Highlight></CodeLine>
<Link id="l05463" /><CodeLine lineNumber="5463"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumDeadDbgInstInBB;</Highlight></CodeLine>
<Link id="l05464" /><CodeLine lineNumber="5464"><Highlight kind="normal">    std::tie(NumDeadInstInBB, NumDeadDbgInstInBB) =</Highlight></CodeLine>
<Link id="l05465" /><CodeLine lineNumber="5465"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a1c9e22b633ee4e0727bba3c87db57296">removeAllNonTerminatorAndEHPadInstructions</a>(&amp;BB);</Highlight></CodeLine>
<Link id="l05466" /><CodeLine lineNumber="5466"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05467" /><CodeLine lineNumber="5467"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a> |= NumDeadInstInBB + NumDeadDbgInstInBB &gt; 0;</Highlight></CodeLine>
<Link id="l05468" /><CodeLine lineNumber="5468"><Highlight kind="normal">    NumDeadInst += NumDeadInstInBB;</Highlight></CodeLine>
<Link id="l05469" /><CodeLine lineNumber="5469"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05470" /><CodeLine lineNumber="5470"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05471" /><CodeLine lineNumber="5471"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Once we&#39;ve found all of the instructions to add to instcombine&#39;s worklist,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05472" /><CodeLine lineNumber="5472"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// add them in reverse order.  This way instcombine will visit from the top</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05473" /><CodeLine lineNumber="5473"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the function down.  This jives well with the way that it adds all uses</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05474" /><CodeLine lineNumber="5474"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of instructions to the worklist after doing a transformation, thus avoiding</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05475" /><CodeLine lineNumber="5475"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// some N^2 behavior in pathological cases.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05476" /><CodeLine lineNumber="5476"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.reserve(InstrsForInstructionWorklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</Highlight></CodeLine>
<Link id="l05477" /><CodeLine lineNumber="5477"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(InstrsForInstructionWorklist)) &#123;</Highlight></CodeLine>
<Link id="l05478" /><CodeLine lineNumber="5478"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// DCE instruction if trivially dead. As we iterate in reverse program</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05479" /><CodeLine lineNumber="5479"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// order here, we will clean up whole chains of dead instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05480" /><CodeLine lineNumber="5480"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(Inst, &amp;<a href="/docs/api/classes/llvm/instcombiner/#a3ccb79ce550ca98c6f524c1c6bdd06a1">TLI</a>) ||</Highlight></CodeLine>
<Link id="l05481" /><CodeLine lineNumber="5481"><Highlight kind="normal">        SeenAliasScopes.<a href="/docs/api/classes/aliasscopetracker/#a426cdd40c6024520c943e7c3d11f1d78">isNoAliasScopeDeclDead</a>(Inst)) &#123;</Highlight></CodeLine>
<Link id="l05482" /><CodeLine lineNumber="5482"><Highlight kind="normal">      ++NumDeadInst;</Highlight></CodeLine>
<Link id="l05483" /><CodeLine lineNumber="5483"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;IC: DCE: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Inst &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05484" /><CodeLine lineNumber="5484"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a26be1141b23850a2b4eb78021d99e862">salvageDebugInfo</a>(&#42;Inst);</Highlight></CodeLine>
<Link id="l05485" /><CodeLine lineNumber="5485"><Highlight kind="normal">      Inst-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l05486" /><CodeLine lineNumber="5486"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05487" /><CodeLine lineNumber="5487"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05488" /><CodeLine lineNumber="5488"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05489" /><CodeLine lineNumber="5489"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05490" /><CodeLine lineNumber="5490"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombiner/#a7b93340fbcab35a38a04bf49aa3113a0">Worklist</a>.push(Inst);</Highlight></CodeLine>
<Link id="l05491" /><CodeLine lineNumber="5491"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05492" /><CodeLine lineNumber="5492"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05493" /><CodeLine lineNumber="5493"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ae03c488dcba2bb63f265b62001cc361e">MadeIRChange</a>;</Highlight></CodeLine>
<Link id="l05494" /><CodeLine lineNumber="5494"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05495" /><CodeLine lineNumber="5495"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05496" /><CodeLine lineNumber="5496" lineLink="/docs/api/classes/llvm/instcombiner/#ac17fa2d851e729e9c308df593b098fc1"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombiner/#ac17fa2d851e729e9c308df593b098fc1">InstCombiner::computeBackEdges</a>() &#123;</Highlight></CodeLine>
<Link id="l05497" /><CodeLine lineNumber="5497"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect backedges.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05498" /><CodeLine lineNumber="5498"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 16&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l05499" /><CodeLine lineNumber="5499"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/instcombiner/#a8768d7bd3a905c9cd89c3738d4873a0d">RPOT</a>) &#123;</Highlight></CodeLine>
<Link id="l05500" /><CodeLine lineNumber="5500"><Highlight kind="normal">    Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(BB);</Highlight></CodeLine>
<Link id="l05501" /><CodeLine lineNumber="5501"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB))</Highlight></CodeLine>
<Link id="l05502" /><CodeLine lineNumber="5502"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(Succ))</Highlight></CodeLine>
<Link id="l05503" /><CodeLine lineNumber="5503"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instcombiner/#abca480cb3ed0ecf3fe3bde76bdf4b230">BackEdges</a>.insert(&#123;BB, Succ&#125;);</Highlight></CodeLine>
<Link id="l05504" /><CodeLine lineNumber="5504"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05505" /><CodeLine lineNumber="5505"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instcombiner/#a577df1f2641fe6bf067c364d94154cf1">ComputedBackEdges</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05506" /><CodeLine lineNumber="5506"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05507" /><CodeLine lineNumber="5507"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05508" /><CodeLine lineNumber="5508" lineLink="#a45a945c85468ec7d17b48b0d4f612b7e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a45a945c85468ec7d17b48b0d4f612b7e">combineInstructionsOverFunction</a>(</Highlight></CodeLine>
<Link id="l05509" /><CodeLine lineNumber="5509"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/instructionworklist">InstructionWorklist</a> &amp;Worklist, <a href="/docs/api/namespaces/llvm/#ae457f1cf451ed893666c4a384e58f8e5">AliasAnalysis</a> &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>,</Highlight></CodeLine>
<Link id="l05510" /><CodeLine lineNumber="5510"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &amp;AC, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;TLI, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</Highlight></CodeLine>
<Link id="l05511" /><CodeLine lineNumber="5511"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &amp;ORE, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI,</Highlight></CodeLine>
<Link id="l05512" /><CodeLine lineNumber="5512"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a> &#42;BPI, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI,</Highlight></CodeLine>
<Link id="l05513" /><CodeLine lineNumber="5513"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/instcombineoptions">InstCombineOptions</a> &amp;Opts) &#123;</Highlight></CodeLine>
<Link id="l05514" /><CodeLine lineNumber="5514"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getDataLayout();</Highlight></CodeLine>
<Link id="l05515" /><CodeLine lineNumber="5515"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> VerifyFixpoint = Opts.<a href="/docs/api/structs/llvm/instcombineoptions/#a0f45e49d1f747665efbc20e8b08013bb">VerifyFixpoint</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l05516" /><CodeLine lineNumber="5516"><Highlight kind="normal">                        !<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(</Highlight><Highlight kind="stringliteral">&quot;instcombine-no-verify-fixpoint&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05517" /><CodeLine lineNumber="5517"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l05518" /><CodeLine lineNumber="5518"><Highlight kind="comment">  /// Builder - This is an IRBuilder that automatically inserts new</Highlight></CodeLine>
<Link id="l05519" /><CodeLine lineNumber="5519"><Highlight kind="comment">  /// instructions into the worklist when they are created.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05520" /><CodeLine lineNumber="5520"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;TargetFolder, IRBuilderCallbackInserter&gt;</a> Builder(</Highlight></CodeLine>
<Link id="l05521" /><CodeLine lineNumber="5521"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getContext(), <a href="/docs/api/classes/llvm/targetfolder">TargetFolder</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>),</Highlight></CodeLine>
<Link id="l05522" /><CodeLine lineNumber="5522"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/irbuildercallbackinserter">IRBuilderCallbackInserter</a>(&#91;&amp;Worklist, &amp;AC&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l05523" /><CodeLine lineNumber="5523"><Highlight kind="normal">        Worklist.<a href="/docs/api/classes/llvm/instructionworklist/#a7047d80c4bd7c774fccbd0293f7da341">add</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05524" /><CodeLine lineNumber="5524"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Assume = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AssumeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l05525" /><CodeLine lineNumber="5525"><Highlight kind="normal">          AC.<a href="/docs/api/classes/llvm/assumptioncache/#a23187618f079555e127ba0e7b4581530">registerAssumption</a>(Assume);</Highlight></CodeLine>
<Link id="l05526" /><CodeLine lineNumber="5526"><Highlight kind="normal">      &#125;));</Highlight></CodeLine>
<Link id="l05527" /><CodeLine lineNumber="5527"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05528" /><CodeLine lineNumber="5528"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/reversepostordertraversal">ReversePostOrderTraversal&lt;BasicBlock &#42;&gt;</a> RPOT(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.front());</Highlight></CodeLine>
<Link id="l05529" /><CodeLine lineNumber="5529"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05530" /><CodeLine lineNumber="5530"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Lower dbg.declare intrinsics otherwise their value may be clobbered</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05531" /><CodeLine lineNumber="5531"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// by instcombiner.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05532" /><CodeLine lineNumber="5532"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeIRChange = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05533" /><CodeLine lineNumber="5533"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a3a08a0164a82ef4868072c7adf277c22">ShouldLowerDbgDeclare</a>)</Highlight></CodeLine>
<Link id="l05534" /><CodeLine lineNumber="5534"><Highlight kind="normal">    MadeIRChange = <a href="/docs/api/namespaces/llvm/#a7994fd7ca0d8f8fcf2a9d18d151d0988">LowerDbgDeclare</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05535" /><CodeLine lineNumber="5535"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05536" /><CodeLine lineNumber="5536"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterate while there is work to do.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05537" /><CodeLine lineNumber="5537"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Iteration = 0;</Highlight></CodeLine>
<Link id="l05538" /><CodeLine lineNumber="5538"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l05539" /><CodeLine lineNumber="5539"><Highlight kind="normal">    ++Iteration;</Highlight></CodeLine>
<Link id="l05540" /><CodeLine lineNumber="5540"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05541" /><CodeLine lineNumber="5541"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Iteration &gt; Opts.<a href="/docs/api/structs/llvm/instcombineoptions/#a9a77a6ddd1d80e50ef38c126e03206c1">MaxIterations</a> &amp;&amp; !VerifyFixpoint) &#123;</Highlight></CodeLine>
<Link id="l05542" /><CodeLine lineNumber="5542"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n\\n&#91;IC&#93; Iteration limit #&quot;</Highlight><Highlight kind="normal"> &lt;&lt; Opts.<a href="/docs/api/structs/llvm/instcombineoptions/#a9a77a6ddd1d80e50ef38c126e03206c1">MaxIterations</a></Highlight></CodeLine>
<Link id="l05543" /><CodeLine lineNumber="5543"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; on &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()</Highlight></CodeLine>
<Link id="l05544" /><CodeLine lineNumber="5544"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; reached; stopping without verifying fixpoint\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05545" /><CodeLine lineNumber="5545"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05546" /><CodeLine lineNumber="5546"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05547" /><CodeLine lineNumber="5547"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05548" /><CodeLine lineNumber="5548"><Highlight kind="normal">    ++NumWorklistIterations;</Highlight></CodeLine>
<Link id="l05549" /><CodeLine lineNumber="5549"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n\\nINSTCOMBINE ITERATION #&quot;</Highlight><Highlight kind="normal"> &lt;&lt; Iteration &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; on &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05550" /><CodeLine lineNumber="5550"><Highlight kind="normal">                      &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05551" /><CodeLine lineNumber="5551"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05552" /><CodeLine lineNumber="5552"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instcombinerimpl">InstCombinerImpl</a> IC(Worklist, Builder, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasMinSize(), <a href="/docs/api/namespaces/llvm/aa">AA</a>, AC, TLI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, DT,</Highlight></CodeLine>
<Link id="l05553" /><CodeLine lineNumber="5553"><Highlight kind="normal">                        ORE, BFI, BPI, PSI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, RPOT);</Highlight></CodeLine>
<Link id="l05554" /><CodeLine lineNumber="5554"><Highlight kind="normal">    IC.<a href="/docs/api/classes/llvm/instcombiner/#a4bc1fafcc9582581002518df62792214">MaxArraySizeForCombine</a> = <a href="#a296fa67782952394abb3c14137eef1c4">MaxArraySize</a>;</Highlight></CodeLine>
<Link id="l05555" /><CodeLine lineNumber="5555"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MadeChangeInThisIteration = IC.<a href="/docs/api/classes/llvm/instcombinerimpl/#a51dffbda74e47e34a64858d09d456108">prepareWorklist</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05556" /><CodeLine lineNumber="5556"><Highlight kind="normal">    MadeChangeInThisIteration |= IC.<a href="/docs/api/classes/llvm/instcombinerimpl/#ac5d3cfa0755b34bcbd3f2298e9fa28ed">run</a>();</Highlight></CodeLine>
<Link id="l05557" /><CodeLine lineNumber="5557"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MadeChangeInThisIteration)</Highlight></CodeLine>
<Link id="l05558" /><CodeLine lineNumber="5558"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05559" /><CodeLine lineNumber="5559"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05560" /><CodeLine lineNumber="5560"><Highlight kind="normal">    MadeIRChange = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05561" /><CodeLine lineNumber="5561"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Iteration &gt; Opts.<a href="/docs/api/structs/llvm/instcombineoptions/#a9a77a6ddd1d80e50ef38c126e03206c1">MaxIterations</a>) &#123;</Highlight></CodeLine>
<Link id="l05562" /><CodeLine lineNumber="5562"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</Highlight></CodeLine>
<Link id="l05563" /><CodeLine lineNumber="5563"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Instruction Combining on &quot;</Highlight><Highlight kind="normal"> + <a href="/docs/api/classes/llvm/twine">Twine</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()) +</Highlight></CodeLine>
<Link id="l05564" /><CodeLine lineNumber="5564"><Highlight kind="normal">              </Highlight><Highlight kind="stringliteral">&quot; did not reach a fixpoint after &quot;</Highlight><Highlight kind="normal"> + <a href="/docs/api/classes/llvm/twine">Twine</a>(Opts.<a href="/docs/api/structs/llvm/instcombineoptions/#a9a77a6ddd1d80e50ef38c126e03206c1">MaxIterations</a>) +</Highlight></CodeLine>
<Link id="l05565" /><CodeLine lineNumber="5565"><Highlight kind="normal">              </Highlight><Highlight kind="stringliteral">&quot; iterations. &quot;</Highlight><Highlight kind="normal"> +</Highlight></CodeLine>
<Link id="l05566" /><CodeLine lineNumber="5566"><Highlight kind="normal">              </Highlight><Highlight kind="stringliteral">&quot;Use &#39;instcombine&lt;no-verify-fixpoint&gt;&#39; or function attribute &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05567" /><CodeLine lineNumber="5567"><Highlight kind="normal">              </Highlight><Highlight kind="stringliteral">&quot;&#39;instcombine-no-verify-fixpoint&#39; to suppress this error.&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l05568" /><CodeLine lineNumber="5568"><Highlight kind="normal">          </Highlight><Highlight kind="comment">/&#42;GenCrashDiag=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05569" /><CodeLine lineNumber="5569"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05570" /><CodeLine lineNumber="5570"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05571" /><CodeLine lineNumber="5571"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05572" /><CodeLine lineNumber="5572"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Iteration == 1)</Highlight></CodeLine>
<Link id="l05573" /><CodeLine lineNumber="5573"><Highlight kind="normal">    ++NumOneIteration;</Highlight></CodeLine>
<Link id="l05574" /><CodeLine lineNumber="5574"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Iteration == 2)</Highlight></CodeLine>
<Link id="l05575" /><CodeLine lineNumber="5575"><Highlight kind="normal">    ++NumTwoIterations;</Highlight></CodeLine>
<Link id="l05576" /><CodeLine lineNumber="5576"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Iteration == 3)</Highlight></CodeLine>
<Link id="l05577" /><CodeLine lineNumber="5577"><Highlight kind="normal">    ++NumThreeIterations;</Highlight></CodeLine>
<Link id="l05578" /><CodeLine lineNumber="5578"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05579" /><CodeLine lineNumber="5579"><Highlight kind="normal">    ++NumFourOrMoreIterations;</Highlight></CodeLine>
<Link id="l05580" /><CodeLine lineNumber="5580"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05581" /><CodeLine lineNumber="5581"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MadeIRChange;</Highlight></CodeLine>
<Link id="l05582" /><CodeLine lineNumber="5582"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05583" /><CodeLine lineNumber="5583"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05584" /><CodeLine lineNumber="5584" lineLink="/docs/api/classes/llvm/instcombinepass/#a47a183acc3ac3d0266a9cbf0dfd25ddb"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instcombinepass/#a47a183acc3ac3d0266a9cbf0dfd25ddb">InstCombinePass::InstCombinePass</a>(<a href="/docs/api/structs/llvm/instcombineoptions">InstCombineOptions</a> Opts) : Options(Opts) &#123;&#125;</Highlight></CodeLine>
<Link id="l05585" /><CodeLine lineNumber="5585"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05586" /><CodeLine lineNumber="5586" lineLink="/docs/api/classes/llvm/instcombinepass/#a779ab7b9886dd41004229220d070721b"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instcombinepass/#a779ab7b9886dd41004229220d070721b">InstCombinePass::printPipeline</a>(</Highlight></CodeLine>
<Link id="l05587" /><CodeLine lineNumber="5587"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/stringref">StringRef</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a>)&gt; MapClassName2PassName) &#123;</Highlight></CodeLine>
<Link id="l05588" /><CodeLine lineNumber="5588"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/structs/llvm/passinfomixin">PassInfoMixin&lt;InstCombinePass&gt;</a> &#42;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">)-&gt;<a href="/docs/api/classes/llvm/instcombinepass/#a779ab7b9886dd41004229220d070721b">printPipeline</a>(</Highlight></CodeLine>
<Link id="l05589" /><CodeLine lineNumber="5589"><Highlight kind="normal">      OS, MapClassName2PassName);</Highlight></CodeLine>
<Link id="l05590" /><CodeLine lineNumber="5590"><Highlight kind="normal">  OS &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;&lt;&#39;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05591" /><CodeLine lineNumber="5591"><Highlight kind="normal">  OS &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;max-iterations=&quot;</Highlight><Highlight kind="normal"> &lt;&lt; Options.MaxIterations &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;;&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05592" /><CodeLine lineNumber="5592"><Highlight kind="normal">  OS &lt;&lt; (Options.VerifyFixpoint ? </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;no-&quot;</Highlight><Highlight kind="normal">) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;verify-fixpoint&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05593" /><CodeLine lineNumber="5593"><Highlight kind="normal">  OS &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;&gt;&#39;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05594" /><CodeLine lineNumber="5594"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05595" /><CodeLine lineNumber="5595"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05596" /><CodeLine lineNumber="5596"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> InstCombinePass::ID = 0;</Highlight></CodeLine>
<Link id="l05597" /><CodeLine lineNumber="5597"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05598" /><CodeLine lineNumber="5598" lineLink="/docs/api/classes/llvm/instcombinepass/#aa1ffc7ad08181545bbc25eabac7f5aae"><Highlight kind="normal"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/instcombinepass/#aa1ffc7ad08181545bbc25eabac7f5aae">InstCombinePass::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</Highlight></CodeLine>
<Link id="l05599" /><CodeLine lineNumber="5599"><Highlight kind="normal">                                       <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM) &#123;</Highlight></CodeLine>
<Link id="l05600" /><CodeLine lineNumber="5600"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;LRT = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/lastruntrackinganalysis">LastRunTrackingAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05601" /><CodeLine lineNumber="5601"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// No changes since last InstCombine pass, exit early.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05602" /><CodeLine lineNumber="5602"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LRT.shouldSkip(&amp;ID))</Highlight></CodeLine>
<Link id="l05603" /><CodeLine lineNumber="5603"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</Highlight></CodeLine>
<Link id="l05604" /><CodeLine lineNumber="5604"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05605" /><CodeLine lineNumber="5605"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;AC = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/assumptionanalysis">AssumptionAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05606" /><CodeLine lineNumber="5606"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;DT = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05607" /><CodeLine lineNumber="5607"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;TLI = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryanalysis">TargetLibraryAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05608" /><CodeLine lineNumber="5608"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;ORE = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/optimizationremarkemitteranalysis">OptimizationRemarkEmitterAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05609" /><CodeLine lineNumber="5609"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05610" /><CodeLine lineNumber="5610"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05611" /><CodeLine lineNumber="5611"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/aamanager">AAManager</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05612" /><CodeLine lineNumber="5612"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;MAMProxy = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/namespaces/llvm/#a2b0ee73723ccffec457f8712220b0c25">ModuleAnalysisManagerFunctionProxy</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05613" /><CodeLine lineNumber="5613"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI =</Highlight></CodeLine>
<Link id="l05614" /><CodeLine lineNumber="5614"><Highlight kind="normal">      MAMProxy.getCachedResult&lt;<a href="/docs/api/classes/llvm/profilesummaryanalysis">ProfileSummaryAnalysis</a>&gt;(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent());</Highlight></CodeLine>
<Link id="l05615" /><CodeLine lineNumber="5615"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BFI = (PSI &amp;&amp; PSI-&gt;hasProfileSummary()) ?</Highlight></CodeLine>
<Link id="l05616" /><CodeLine lineNumber="5616"><Highlight kind="normal">      &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/blockfrequencyanalysis">BlockFrequencyAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05617" /><CodeLine lineNumber="5617"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BPI = AM.<a href="/docs/api/classes/llvm/analysismanager/#a828ff8185f881fca9e3d534781244041">getCachedResult</a>&lt;<a href="/docs/api/classes/llvm/branchprobabilityanalysis">BranchProbabilityAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05618" /><CodeLine lineNumber="5618"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05619" /><CodeLine lineNumber="5619"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a45a945c85468ec7d17b48b0d4f612b7e">combineInstructionsOverFunction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Worklist, <a href="/docs/api/namespaces/llvm/aa">AA</a>, AC, TLI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, DT, ORE,</Highlight></CodeLine>
<Link id="l05620" /><CodeLine lineNumber="5620"><Highlight kind="normal">                                       BFI, BPI, PSI, Options)) &#123;</Highlight></CodeLine>
<Link id="l05621" /><CodeLine lineNumber="5621"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// No changes, all analyses are preserved.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05622" /><CodeLine lineNumber="5622"><Highlight kind="normal">    LRT.update(&amp;ID, </Highlight><Highlight kind="comment">/&#42;Changed=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05623" /><CodeLine lineNumber="5623"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</Highlight></CodeLine>
<Link id="l05624" /><CodeLine lineNumber="5624"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05625" /><CodeLine lineNumber="5625"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05626" /><CodeLine lineNumber="5626"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Mark all the analyses that instcombine updates as preserved.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05627" /><CodeLine lineNumber="5627"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> PA;</Highlight></CodeLine>
<Link id="l05628" /><CodeLine lineNumber="5628"><Highlight kind="normal">  LRT.update(&amp;ID, </Highlight><Highlight kind="comment">/&#42;Changed=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05629" /><CodeLine lineNumber="5629"><Highlight kind="normal">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/lastruntrackinganalysis">LastRunTrackingAnalysis</a>&gt;();</Highlight></CodeLine>
<Link id="l05630" /><CodeLine lineNumber="5630"><Highlight kind="normal">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#a937c42f77e161349ce0f999e448c7027">preserveSet</a>&lt;<a href="/docs/api/classes/llvm/cfganalyses">CFGAnalyses</a>&gt;();</Highlight></CodeLine>
<Link id="l05631" /><CodeLine lineNumber="5631"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> PA;</Highlight></CodeLine>
<Link id="l05632" /><CodeLine lineNumber="5632"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05633" /><CodeLine lineNumber="5633"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05634" /><CodeLine lineNumber="5634" lineLink="/docs/api/classes/llvm/instructioncombiningpass/#a5acf47fe333b314ccdb4c0a26f39db97"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncombiningpass/#a5acf47fe333b314ccdb4c0a26f39db97">InstructionCombiningPass::getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l05635" /><CodeLine lineNumber="5635"><Highlight kind="normal">  AU.<a href="/docs/api/classes/llvm/analysisusage/#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</Highlight></CodeLine>
<Link id="l05636" /><CodeLine lineNumber="5636"><Highlight kind="normal">  AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/aaresultswrapperpass">AAResultsWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l05637" /><CodeLine lineNumber="5637"><Highlight kind="normal">  AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/assumptioncachetracker">AssumptionCacheTracker</a>&gt;();</Highlight></CodeLine>
<Link id="l05638" /><CodeLine lineNumber="5638"><Highlight kind="normal">  AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryinfowrapperpass">TargetLibraryInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l05639" /><CodeLine lineNumber="5639"><Highlight kind="normal">  AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targettransforminfowrapperpass">TargetTransformInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l05640" /><CodeLine lineNumber="5640"><Highlight kind="normal">  AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/dominatortreewrapperpass">DominatorTreeWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l05641" /><CodeLine lineNumber="5641"><Highlight kind="normal">  AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/optimizationremarkemitterwrapperpass">OptimizationRemarkEmitterWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l05642" /><CodeLine lineNumber="5642"><Highlight kind="normal">  AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/dominatortreewrapperpass">DominatorTreeWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l05643" /><CodeLine lineNumber="5643"><Highlight kind="normal">  AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/aaresultswrapperpass">AAResultsWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l05644" /><CodeLine lineNumber="5644"><Highlight kind="normal">  AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/basicaawrapperpass">BasicAAWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l05645" /><CodeLine lineNumber="5645"><Highlight kind="normal">  AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/globalsaawrapperpass">GlobalsAAWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l05646" /><CodeLine lineNumber="5646"><Highlight kind="normal">  AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/profilesummaryinfowrapperpass">ProfileSummaryInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l05647" /><CodeLine lineNumber="5647"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/lazyblockfrequencyinfopass/#a8969b22606511eb0e2b2e028a3c0f332">LazyBlockFrequencyInfoPass::getLazyBFIAnalysisUsage</a>(AU);</Highlight></CodeLine>
<Link id="l05648" /><CodeLine lineNumber="5648"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05649" /><CodeLine lineNumber="5649"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05650" /><CodeLine lineNumber="5650" lineLink="/docs/api/classes/llvm/instructioncombiningpass/#ab64b7e967adeebc9bacc8abd8ddce0c8"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncombiningpass/#ab64b7e967adeebc9bacc8abd8ddce0c8">InstructionCombiningPass::runOnFunction</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l05651" /><CodeLine lineNumber="5651"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/functionpass/#af9f5f511d75e16f09a5520cb9444cfa8">skipFunction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>))</Highlight></CodeLine>
<Link id="l05652" /><CodeLine lineNumber="5652"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05653" /><CodeLine lineNumber="5653"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05654" /><CodeLine lineNumber="5654"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Required analyses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05655" /><CodeLine lineNumber="5655"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/aa">AA</a> = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;AAResultsWrapperPass&gt;</a>().getAAResults();</Highlight></CodeLine>
<Link id="l05656" /><CodeLine lineNumber="5656"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;AC = <a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;AssumptionCacheTracker&gt;</a>().getAssumptionCache(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05657" /><CodeLine lineNumber="5657"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;TLI = <a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;TargetLibraryInfoWrapperPass&gt;</a>().getTLI(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05658" /><CodeLine lineNumber="5658"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> = <a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;TargetTransformInfoWrapperPass&gt;</a>().getTTI(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05659" /><CodeLine lineNumber="5659"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;DT = <a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;DominatorTreeWrapperPass&gt;</a>().getDomTree();</Highlight></CodeLine>
<Link id="l05660" /><CodeLine lineNumber="5660"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;ORE = <a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;OptimizationRemarkEmitterWrapperPass&gt;</a>().getORE();</Highlight></CodeLine>
<Link id="l05661" /><CodeLine lineNumber="5661"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05662" /><CodeLine lineNumber="5662"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Optional analyses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05663" /><CodeLine lineNumber="5663"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI =</Highlight></CodeLine>
<Link id="l05664" /><CodeLine lineNumber="5664"><Highlight kind="normal">      &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;ProfileSummaryInfoWrapperPass&gt;</a>().getPSI();</Highlight></CodeLine>
<Link id="l05665" /><CodeLine lineNumber="5665"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI =</Highlight></CodeLine>
<Link id="l05666" /><CodeLine lineNumber="5666"><Highlight kind="normal">      (PSI &amp;&amp; PSI-&gt;<a href="/docs/api/classes/llvm/profilesummaryinfo/#a11d1c1af51bf81a6a9f8f5191b5e3cf2">hasProfileSummary</a>()) ?</Highlight></CodeLine>
<Link id="l05667" /><CodeLine lineNumber="5667"><Highlight kind="normal">      &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;LazyBlockFrequencyInfoPass&gt;</a>().getBFI() :</Highlight></CodeLine>
<Link id="l05668" /><CodeLine lineNumber="5668"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05669" /><CodeLine lineNumber="5669"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a> &#42;BPI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05670" /><CodeLine lineNumber="5670"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WrapperPass =</Highlight></CodeLine>
<Link id="l05671" /><CodeLine lineNumber="5671"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/pass/#af94c014e968489e96c7d4353a84ad7f5">getAnalysisIfAvailable&lt;BranchProbabilityInfoWrapperPass&gt;</a>())</Highlight></CodeLine>
<Link id="l05672" /><CodeLine lineNumber="5672"><Highlight kind="normal">    BPI = &amp;WrapperPass-&gt;getBPI();</Highlight></CodeLine>
<Link id="l05673" /><CodeLine lineNumber="5673"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05674" /><CodeLine lineNumber="5674"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a45a945c85468ec7d17b48b0d4f612b7e">combineInstructionsOverFunction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Worklist, <a href="/docs/api/namespaces/llvm/aa">AA</a>, AC, TLI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, DT, ORE,</Highlight></CodeLine>
<Link id="l05675" /><CodeLine lineNumber="5675"><Highlight kind="normal">                                         BFI, BPI, PSI, <a href="/docs/api/structs/llvm/instcombineoptions">InstCombineOptions</a>());</Highlight></CodeLine>
<Link id="l05676" /><CodeLine lineNumber="5676"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05677" /><CodeLine lineNumber="5677"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05678" /><CodeLine lineNumber="5678"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncombiningpass/#ad5db0c25b136012cb2e8ac3fa98318da">InstructionCombiningPass::ID</a> = 0;</Highlight></CodeLine>
<Link id="l05679" /><CodeLine lineNumber="5679"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05680" /><CodeLine lineNumber="5680" lineLink="/docs/api/classes/llvm/instructioncombiningpass/#a0dd4dac14ef239990364482706fd75f3"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncombiningpass/#a0dd4dac14ef239990364482706fd75f3">InstructionCombiningPass::InstructionCombiningPass</a>() : <a href="/docs/api/classes/llvm/functionpass/#a7691d83e3561f781cae4ce4a01bdfa93">FunctionPass</a>(<a href="/docs/api/classes/llvm/instructioncombiningpass/#ad5db0c25b136012cb2e8ac3fa98318da">ID</a>) &#123;</Highlight></CodeLine>
<Link id="l05681" /><CodeLine lineNumber="5681"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#af1419a855f9813cb9164ca88d90d690c">initializeInstructionCombiningPassPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</Highlight></CodeLine>
<Link id="l05682" /><CodeLine lineNumber="5682"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05683" /><CodeLine lineNumber="5683"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05684" /><CodeLine lineNumber="5684" lineLink="#a8a787de77e16e56d936abb2ad6ee4c8c"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(<a href="/docs/api/classes/llvm/instructioncombiningpass">InstructionCombiningPass</a>, </Highlight><Highlight kind="stringliteral">&quot;instcombine&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l05685" /><CodeLine lineNumber="5685"><Highlight kind="normal">                      </Highlight><Highlight kind="stringliteral">&quot;Combine redundant instructions&quot;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l05686" /><CodeLine lineNumber="5686"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/assumptioncachetracker">AssumptionCacheTracker</a>)</Highlight></CodeLine>
<Link id="l05687" /><CodeLine lineNumber="5687"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/targetlibraryinfowrapperpass">TargetLibraryInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l05688" /><CodeLine lineNumber="5688"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/targettransforminfowrapperpass">TargetTransformInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l05689" /><CodeLine lineNumber="5689"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/dominatortreewrapperpass">DominatorTreeWrapperPass</a>)</Highlight></CodeLine>
<Link id="l05690" /><CodeLine lineNumber="5690"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/aaresultswrapperpass">AAResultsWrapperPass</a>)</Highlight></CodeLine>
<Link id="l05691" /><CodeLine lineNumber="5691"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/globalsaawrapperpass">GlobalsAAWrapperPass</a>)</Highlight></CodeLine>
<Link id="l05692" /><CodeLine lineNumber="5692"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/optimizationremarkemitterwrapperpass">OptimizationRemarkEmitterWrapperPass</a>)</Highlight></CodeLine>
<Link id="l05693" /><CodeLine lineNumber="5693"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/lazyblockfrequencyinfopass">LazyBlockFrequencyInfoPass</a>)</Highlight></CodeLine>
<Link id="l05694" /><CodeLine lineNumber="5694"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/profilesummaryinfowrapperpass">ProfileSummaryInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l05695" /><CodeLine lineNumber="5695" lineLink="#a7d4d7e39548303ef4c1f5a0ed13a9c23"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(<a href="/docs/api/classes/llvm/instructioncombiningpass">InstructionCombiningPass</a>, </Highlight><Highlight kind="stringliteral">&quot;instcombine&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l05696" /><CodeLine lineNumber="5696" lineLink="#ac735dc0034fb289533e5dc1a10a6c9ce"><Highlight kind="normal">                    </Highlight><Highlight kind="stringliteral">&quot;Combine redundant instructions&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/false">false</a>, <a href="/docs/api/namespaces/false">false</a>)</Highlight></CodeLine>
<Link id="l05697" /><CodeLine lineNumber="5697"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05698" /><CodeLine lineNumber="5698"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Initialization Routines</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05699" /><CodeLine lineNumber="5699" lineLink="/docs/api/namespaces/llvm/#aee2cbad0134e307a0d2f3dee1db34d7c"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm">llvm</a>::<a href="/docs/api/namespaces/llvm/#aee2cbad0134e307a0d2f3dee1db34d7c">initializeInstCombine</a>(<a href="/docs/api/classes/llvm/passregistry">PassRegistry</a> &amp;<a href="/docs/api/classes/llvm/registry">Registry</a>) &#123;</Highlight></CodeLine>
<Link id="l05700" /><CodeLine lineNumber="5700"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#af1419a855f9813cb9164ca88d90d690c">initializeInstructionCombiningPassPass</a>(<a href="/docs/api/classes/llvm/registry">Registry</a>);</Highlight></CodeLine>
<Link id="l05701" /><CodeLine lineNumber="5701"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05702" /><CodeLine lineNumber="5702"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05703" /><CodeLine lineNumber="5703" lineLink="/docs/api/namespaces/llvm/#a195c85317ba5f5262812d33289c7a2b3"><Highlight kind="normal"><a href="/docs/api/classes/llvm/functionpass">FunctionPass</a> &#42;<a href="/docs/api/namespaces/llvm/#a195c85317ba5f5262812d33289c7a2b3">llvm::createInstructionCombiningPass</a>() &#123;</Highlight></CodeLine>
<Link id="l05704" /><CodeLine lineNumber="5704"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncombiningpass">InstructionCombiningPass</a>();</Highlight></CodeLine>
<Link id="l05705" /><CodeLine lineNumber="5705"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>


</DoxygenPage>
