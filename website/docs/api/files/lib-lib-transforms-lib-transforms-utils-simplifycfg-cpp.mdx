---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import EnumerationList from '@xpack/docusaurus-plugin-doxygen/components/EnumerationList'
import EnumerationListItem from '@xpack/docusaurus-plugin-doxygen/components/EnumerationListItem'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ParametersList from '@xpack/docusaurus-plugin-doxygen/components/ParametersList'
import ParametersListItem from '@xpack/docusaurus-plugin-doxygen/components/ParametersListItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'
import SectionUser from '@xpack/docusaurus-plugin-doxygen/components/SectionUser'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `SimplifyCFG.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/ADT/APInt.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/MapVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Sequence.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/sequence-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetOperations.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setoperations-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/StringRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AssumptionCache.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CaptureTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/capturetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ConstantFolding.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/constantfolding-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/DomTreeUpdater.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/domtreeupdater-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/GuardUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/guardutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/InstructionSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/Loads.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loads-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemorySSA.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssa-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemorySSAUpdater.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssaupdater-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Attributes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ConstantRange.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constantrange-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalValue.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalVariable.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/MDBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/MemoryModelRelaxationAnnotations.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/memorymodelrelaxationannotations-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Metadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/NoFolder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/nofolder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Operator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ProfDataUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Use.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/use-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ValueHandle.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BranchProbability.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/KnownBits.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/knownbits-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/MathExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/mathextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/ValueMapper.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/valuemapper-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="climits"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstddef"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="map"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="set"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="tuple"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-simplifycfg-cpp-">anonymous&#123;SimplifyCFG.cpp&#125;</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/llvm">llvm</a></>}>
This is an optimization pass for GlobalISel generic memory operations. <a href="/docs/api/namespaces/llvm/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase">ValueEqualityComparisonCase</a></>}>
<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase">ValueEqualityComparisonCase</a> - Represents a case of a switch. <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt">SimplifyCFGOpt</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer">ConstantComparesGatherer</a></>}>
Given a chain of or (||) or and (&amp;&amp;) comparison of a value against a constant, this will try to recover the information required for a switch structure. <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantintordering">ConstantIntOrdering</a></>}>
This class implements a stable ordering of constant integers that does not depend on their address. <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantintordering/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator">LockstepReverseIterator</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets">CompatibleSets</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/ephemeralvaluetracker">EphemeralValueTracker</a></>}>
Track ephemeral values, which should be ignored for cost-modelling purposes. <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/ephemeralvaluetracker/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable">SwitchLookupTable</a></>}>
This class represents a lookup table that can be used to replace a switch. <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/switchsuccwrapper">SwitchSuccWrapper</a></>}>
Checking whether two cases of <a href="/docs/api/namespaces/llvm/si">SI</a> are equal depends on the contents of the <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> and the incoming values of their successor PHINodes. <a href="/docs/api/structs/switchsuccwrapper/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/llvm/densemapinfo-aa60992bff446bfaa212c7392dde9918">DenseMapInfo&lt;const SwitchSuccWrapper *&gt;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Enumerations Index

<MembersIndex>

<MembersIndexItem
  type="enum"
  name={<>:  &#123; <a href="#a72d0db08ead54facf3e1e90aaae435ba">...</a> &#125;</>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a0375fe3378c23272b805320851744043">addPredecessorToBlock</a> (BasicBlock &#42;Succ, BasicBlock &#42;NewPred, BasicBlock &#42;ExistPred, MemorySSAUpdater &#42;MSSAU=nullptr)</>}>
Update PHI nodes in Succ to indicate that there will now be entries in it from the &#39;NewPred&#39; block. <a href="#a0375fe3378c23272b805320851744043">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</>}
  name={<><a href="#a265306d8985def49c26247e9006878de">allPredecessorsComeFromSameSource</a> (BasicBlock &#42;BB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a47aa12b3f79390c9835ac99904b2cb51">areIdenticalUpToCommutativity</a> (const Instruction &#42;I1, const Instruction &#42;I2)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aee330f66887329eef3ddc7dc8ccda193">blockIsSimpleEnoughToThreadThrough</a> (BasicBlock &#42;BB)</>}>
Return true if we can thread a branch across this block. <a href="#aee330f66887329eef3ddc7dc8ccda193">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ae9efb27478c86bece81f1bf5bca2d348">canSinkInstructions</a> (ArrayRef&lt; Instruction &#42; &gt; Insts, DenseMap&lt; const Use &#42;, SmallVector&lt; Value &#42;, 4 &gt; &gt; &amp;PHIOperands)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a7e7374e59505b56b9bf65507fb90dd40">casesAreContiguous</a> (SmallVectorImpl&lt; ConstantInt &#42; &gt; &amp;Cases)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a2a8aa905f11fdce2fbbfd8e695d282b5">cloneInstructionsIntoPredecessorBlockAndUpdateSSAUses</a> (BasicBlock &#42;BB, BasicBlock &#42;PredBlock, ValueToValueMapTy &amp;VMap)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></>}
  name={<><a href="#a9ac94808486f1c47e5cc9ba62dcc6fae">computeSpeculationCost</a> (const User &#42;I, const TargetTransformInfo &amp;TTI)</>}>
Compute an abstract &quot;cost&quot; of speculating the given instruction, which is assumed to be safe to speculate. <a href="#a9ac94808486f1c47e5cc9ba62dcc6fae">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;</>}
  name={<><a href="#a40bb6295bf75ebb0f636376637ed518f">constantFold</a> (Instruction &#42;I, const DataLayout &amp;DL, const SmallDenseMap&lt; Value &#42;, Constant &#42; &gt; &amp;ConstantPool)</>}>
Try to fold instruction I into a constant. <a href="#a40bb6295bf75ebb0f636376637ed518f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="int"
  name={<><a href="#a2ab3a1c5bf0fff25a3254622107b9c9f">constantIntSortPredicate</a> (ConstantInt &#42;const &#42;P1, ConstantInt &#42;const &#42;P2)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a6092c4a20d4eba2072c849c5408b9435">createLogicalOp</a> (IRBuilderBase &amp;Builder, Instruction::BinaryOps Opc, Value &#42;LHS, Value &#42;RHS, const Twine &amp;Name=&quot;&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a7aa8025f73f4e06135e6ba7083ad7aab">createUnreachableSwitchDefault</a> (SwitchInst &#42;Switch, DomTreeUpdater &#42;DTU, bool RemoveOrigDefaultBlock=true)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af67eef9e8d101756a1a0164e63eb4556">dominatesMergePoint</a> (Value &#42;V, BasicBlock &#42;BB, Instruction &#42;InsertPt, SmallPtrSetImpl&lt; Instruction &#42; &gt; &amp;AggressiveInsts, InstructionCost &amp;Cost, InstructionCost Budget, const TargetTransformInfo &amp;TTI, AssumptionCache &#42;AC, unsigned Depth=0)</>}>
If we have a merge point of an &quot;if condition&quot; as accepted above, return true if the specified value dominates the block. <a href="#af67eef9e8d101756a1a0164e63eb4556">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ab2bdf79ec154e7a070ec95b9700152da">eliminateBlockCases</a> (BasicBlock &#42;BB, std::vector&lt; ValueEqualityComparisonCase &gt; &amp;Cases)</>}>
Given a vector of bb/value pairs, remove any entries in the list that match the specified block. <a href="#ab2bdf79ec154e7a070ec95b9700152da">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a83b0a34d940365e97b9a531c1f13f3b9">eliminateDeadSwitchCases</a> (SwitchInst &#42;SI, DomTreeUpdater &#42;DTU, AssumptionCache &#42;AC, const DataLayout &amp;DL)</>}>
Compute masked bits for the condition of a switch and use it to remove dead cases. <a href="#a83b0a34d940365e97b9a531c1f13f3b9">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a5bb62631ba6a4be0ae02f7365ee4a7d7">ensureValueAvailableInSuccessor</a> (Value &#42;V, BasicBlock &#42;BB, Value &#42;AlternativeV=nullptr)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aa9dd0c9b2a49c91d814102c1d0c7b09d">eraseTerminatorAndDCECond</a> (Instruction &#42;TI, MemorySSAUpdater &#42;MSSAU=nullptr)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a404f7a1827e4eb8c5ded5ce6dafecf07">extractPredSuccWeights</a> (BranchInst &#42;PBI, BranchInst &#42;BI, uint64&#95;t &amp;PredTrueWeight, uint64&#95;t &amp;PredFalseWeight, uint64&#95;t &amp;SuccTrueWeight, uint64&#95;t &amp;SuccFalseWeight)</>}>
Return true if either PBI or BI has branch weight available, and store the weights in &#123;Pred|Succ&#125;&#123;True|False&#125;Weight. <a href="#a404f7a1827e4eb8c5ded5ce6dafecf07">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;</>}
  name={<><a href="#a48e98416c61da7bdde42d88ea460723c">findPHIForConditionForwarding</a> (ConstantInt &#42;CaseValue, BasicBlock &#42;BB, int &#42;PhiIndex)</>}>
If BB would be eligible for simplification by TryToSimplifyUncondBranchFromEmptyBlock (i.e. <a href="#a48e98416c61da7bdde42d88ea460723c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;</>}
  name={<><a href="#a068826fbd1f18b8ecd1b8798d957eca9">findUniqueStoreInBlocks</a> (BasicBlock &#42;BB1, BasicBlock &#42;BB2)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a7b05fae85db516bdd2df79cef5a6343d">fitWeights</a> (MutableArrayRef&lt; uint64&#95;t &gt; Weights)</>}>
Keep halving the weights until all can fit in uint32&#95;t. <a href="#a7b05fae85db516bdd2df79cef5a6343d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3f284045c53ed237131eb9153017c364">foldCondBranchOnValueKnownInPredecessor</a> (BranchInst &#42;BI, DomTreeUpdater &#42;DTU, const DataLayout &amp;DL, AssumptionCache &#42;AC)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; bool &gt;</>}
  name={<><a href="#ac0fb2da7eaa616e8ef8a8f52b981334b">foldCondBranchOnValueKnownInPredecessorImpl</a> (BranchInst &#42;BI, DomTreeUpdater &#42;DTU, const DataLayout &amp;DL, AssumptionCache &#42;AC)</>}>
If we have a conditional branch on something for which we know the constant value in predecessors (e.g. <a href="#ac0fb2da7eaa616e8ef8a8f52b981334b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a53f06c06e81412900ac140caaf764ff8">foldSwitchToSelect</a> (const SwitchCaseResultVectorTy &amp;ResultVector, Constant &#42;DefaultResult, Value &#42;Condition, IRBuilder&lt;&gt; &amp;Builder)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a92fe4b2aa97a12f4a947e5ce99f05b15">foldTwoEntryPHINode</a> (PHINode &#42;PN, const TargetTransformInfo &amp;TTI, DomTreeUpdater &#42;DTU, AssumptionCache &#42;AC, const DataLayout &amp;DL, bool SpeculateUnpredictables)</>}>
Given a BB that starts with the specified two-entry PHI node, see if we can eliminate it. <a href="#a92fe4b2aa97a12f4a947e5ce99f05b15">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a480bd8ae64f6f3e4a9cc6e1a724b2ad0">forwardSwitchConditionToPHI</a> (SwitchInst &#42;SI)</>}>
Try to forward the condition of a switch instruction to a phi node dominated by the switch, if that would mean that some of the destination blocks of the switch can be folded away. <a href="#a480bd8ae64f6f3e4a9cc6e1a724b2ad0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ad3e63520dcd2b8f8aa1b2e66e734a575">getBranchWeights</a> (Instruction &#42;TI, SmallVectorImpl&lt; uint64&#95;t &gt; &amp;Weights)</>}>
Get Weights of a given terminator, the default weight is at the front of the vector. <a href="#ad3e63520dcd2b8f8aa1b2e66e734a575">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a31070c67db84f4caef376dcb7906c4fb">getCaseResults</a> (SwitchInst &#42;SI, ConstantInt &#42;CaseVal, BasicBlock &#42;CaseDest, BasicBlock &#42;&#42;CommonDest, SmallVectorImpl&lt; std::pair&lt; PHINode &#42;, Constant &#42; &gt; &gt; &amp;Res, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</>}>
Try to determine the resulting constant values in phi nodes at the common destination basic block, &#42;CommonDest, for one of the case destionations CaseDest corresponding to value CaseVal (0 for the default case), of a switch instruction <a href="/docs/api/namespaces/llvm/si">SI</a>. <a href="#a31070c67db84f4caef376dcb7906c4fb">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;</>}
  name={<><a href="#a3abb1cc80a02ab7f543ff2d98987e121">getConstantInt</a> (Value &#42;V, const DataLayout &amp;DL)</>}>
Extract <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> from value, looking through IntToPtr and PointerNullValue. <a href="#a3abb1cc80a02ab7f543ff2d98987e121">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;</>}
  name={<><a href="#afb9fd1f991a7503fe4fd7dc16bda6f30">getKnownValueOnEdge</a> (Value &#42;V, BasicBlock &#42;From, BasicBlock &#42;To)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ab99310a04afb6c28186b1a6428eb75b0">hoistConditionalLoadsStores</a> (BranchInst &#42;BI, SmallVectorImpl&lt; Instruction &#42; &gt; &amp;SpeculatedConditionalLoadsStores, std::optional&lt; bool &gt; Invert)</>}>
If the target supports conditional faulting, we look for the following pattern: <a href="#ab99310a04afb6c28186b1a6428eb75b0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aedc31552ebf0ce116c665da44b4a97a5">hoistLockstepIdenticalDbgVariableRecords</a> (Instruction &#42;TI, Instruction &#42;I1, SmallVectorImpl&lt; Instruction &#42; &gt; &amp;OtherInsts)</>}>
Hoists DbgVariableRecords from <code>I1</code> and <code>OtherInstrs</code> that are identical in lock-step to <code>TI</code>. <a href="#aedc31552ebf0ce116c665da44b4a97a5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a7851d1e39cf3c6f27aa6fe911056a142">incomingValuesAreCompatible</a> (BasicBlock &#42;BB, ArrayRef&lt; BasicBlock &#42; &gt; IncomingBlocks, SmallPtrSetImpl&lt; Value &#42; &gt; &#42;EquivalenceSet=nullptr)</>}>
Return true if all the PHI nodes in the basic block <code>BB</code> receive compatible (identical) incoming values when coming from all of the predecessor blocks that are specified in <code>IncomingBlocks</code>. <a href="#a7851d1e39cf3c6f27aa6fe911056a142">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a95851c48d68c2406ef12a7cca9c65f76">initializeUniqueCases</a> (SwitchInst &#42;SI, PHINode &#42;&amp;PHI, BasicBlock &#42;&amp;CommonDest, SwitchCaseResultVectorTy &amp;UniqueResults, Constant &#42;&amp;DefaultResult, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI, uintptr&#95;t MaxUniqueResults)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a583f07468003b1c19e8227f1c0e63fb7">isCleanupBlockEmpty</a> (iterator&#95;range&lt; BasicBlock::iterator &gt; R)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ae97521436759fc2489301a34e621bbcd">isLifeTimeMarker</a> (const Instruction &#42;I)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a08cd264874d8deee9a2bdda9b9461e29">isProfitableToSpeculate</a> (const BranchInst &#42;BI, std::optional&lt; bool &gt; Invert, const TargetTransformInfo &amp;TTI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af7700655934807d2b707112f79217377">isSafeCheapLoadStore</a> (const Instruction &#42;I, const TargetTransformInfo &amp;TTI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a396eac919c9ac7907275e770a8cd37cf">isSafeToHoistInstr</a> (Instruction &#42;I, unsigned Flags)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3aaba0277f5dd5636e099fa81c20c533">isSafeToHoistInvoke</a> (BasicBlock &#42;BB1, BasicBlock &#42;BB2, Instruction &#42;I1, Instruction &#42;I2)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a8bb9afd23da56f99f3bcdb52e9c74320">isSafeToSpeculateStore</a> (Instruction &#42;I, BasicBlock &#42;BrBB, BasicBlock &#42;StoreBB, BasicBlock &#42;EndBB)</>}>
Determine if we can hoist sink a sole store instruction out of a conditional block. <a href="#a8bb9afd23da56f99f3bcdb52e9c74320">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a> (uint64&#95;t NumCases, uint64&#95;t CaseRange)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aa28651c1e85585ae702f652a8df06019">isSwitchDense</a> (ArrayRef&lt; int64&#95;t &gt; Values)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a7ef36c3b9f5334218cf1b3b7e8e33569">isTypeLegalForLookupTable</a> (Type &#42;Ty, const TargetTransformInfo &amp;TTI, const DataLayout &amp;DL)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a227525ceb37837d0076479b272b50aec">isVectorOp</a> (Instruction &amp;I)</>}>
Return if an instruction&#39;s type or any of its operands&#39; types are a vector type. <a href="#a227525ceb37837d0076479b272b50aec">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;</>}
  name={<><a href="#adc3fe6855d95097c6692cea63a747695">lookupConstant</a> (Value &#42;V, const SmallDenseMap&lt; Value &#42;, Constant &#42; &gt; &amp;ConstantPool)</>}>
If V is a <a href="/docs/api/classes/llvm/constant">Constant</a>, return it. <a href="#adc3fe6855d95097c6692cea63a747695">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>size&#95;t</>}
  name={<><a href="#ac46c68ef01d64ec7e21b62016818063a">mapCaseToResult</a> (ConstantInt &#42;CaseVal, SwitchCaseResultVectorTy &amp;UniqueResults, Constant &#42;Result)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a1f70470f7a7722fd55c58c81358107f2">mergeCleanupPad</a> (CleanupReturnInst &#42;RI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aa7e215bdd027461da0d8205cf5ef0e32">mergeCompatibleInvokes</a> (BasicBlock &#42;BB, DomTreeUpdater &#42;DTU)</>}>
If this block is a <code>landingpad</code> exception handling block, categorize all the predecessor <code>invoke</code>s into sets, with all <code>invoke</code>s in each set being &quot;mergeable&quot; together, and then merge invokes in each set together. <a href="#aa7e215bdd027461da0d8205cf5ef0e32">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#acc8066950deec241b4fafe0700ff5f2c">mergeCompatibleInvokesImpl</a> (ArrayRef&lt; InvokeInst &#42; &gt; Invokes, DomTreeUpdater &#42;DTU)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6a58dfc629e1b208cdd7b2bd76203184">mergeConditionalStores</a> (BranchInst &#42;PBI, BranchInst &#42;QBI, DomTreeUpdater &#42;DTU, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a1a5189be752e56bf8343fd72f45720ee">mergeConditionalStoreToAddress</a> (BasicBlock &#42;PTB, BasicBlock &#42;PFB, BasicBlock &#42;QTB, BasicBlock &#42;QFB, BasicBlock &#42;PostBB, Value &#42;Address, bool InvertPCond, bool InvertQCond, DomTreeUpdater &#42;DTU, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ad9d19d00519eec89a553d376d72c9520">mergeNestedCondBranch</a> (BranchInst &#42;BI, DomTreeUpdater &#42;DTU)</>}>
Fold the following pattern: bb0: br i1 cond1, label bb1, label bb2 bb1: br i1 cond2, label bb3, label bb4 bb2: br i1 cond2, label bb4, label bb3 bb3: ... bb4: ... into bb0: cond = xor i1 cond1, cond2 br i1 cond, label bb4, label bb3 bb3: ... bb4: ... NOTE: cond2 always dominates the terminator of bb0. <a href="#ad9d19d00519eec89a553d376d72c9520">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a> (Value &#42;V, Instruction &#42;I, bool PtrValueMayBeModified)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if passing a value to an instruction will cause undefined behavior. <a href="#a32c2973fa0babdd440d3ab7dd160664a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a31a4e5663521fd6944605496cbc32bbb">performBranchToCommonDestFolding</a> (BranchInst &#42;BI, BranchInst &#42;PBI, DomTreeUpdater &#42;DTU, MemorySSAUpdater &#42;MSSAU, const TargetTransformInfo &#42;TTI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6860a87b20545e2f53641a1bf33f6c4c">reduceSwitchRange</a> (SwitchInst &#42;SI, IRBuilder&lt;&gt; &amp;Builder, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</>}>
Try to transform a switch that has &quot;holes&quot; in it to a contiguous sequence of cases. <a href="#a6860a87b20545e2f53641a1bf33f6c4c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aedfe10b7b8a1008ddaa4104f54e0b483">removeEmptyCleanup</a> (CleanupReturnInst &#42;RI, DomTreeUpdater &#42;DTU)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a0ceff22bcbbcc85abecced9a3a395ccf">removeSwitchAfterSelectFold</a> (SwitchInst &#42;SI, PHINode &#42;PHI, Value &#42;SelectValue, IRBuilder&lt;&gt; &amp;Builder, DomTreeUpdater &#42;DTU)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af04adca83664ebd947723470c4da58aa">removeUndefIntroducingPredecessor</a> (BasicBlock &#42;BB, DomTreeUpdater &#42;DTU, AssumptionCache &#42;AC)</>}>
If BB has an incoming value that will always trigger undefined behavior (eg. <a href="#af04adca83664ebd947723470c4da58aa">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aa85a3c04f64695265702d0b3c3d6ea1c">replacingOperandWithVariableIsCheap</a> (const Instruction &#42;I, int OpIdx)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ad75372cc26ff6f641159aed90d5fc11e">reuseTableCompare</a> (User &#42;PhiUser, BasicBlock &#42;PhiBlock, BranchInst &#42;RangeCheckBranch, Constant &#42;DefaultValue, const SmallVectorImpl&lt; std::pair&lt; ConstantInt &#42;, Constant &#42; &gt; &gt; &amp;Values)</>}>
Try to reuse the switch table index compare. <a href="#ad75372cc26ff6f641159aed90d5fc11e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6b537c9f5fe8ee7d5950f9984fa5010a">safeToMergeTerminators</a> (Instruction &#42;SI1, Instruction &#42;SI2, SmallSetVector&lt; BasicBlock &#42;, 4 &gt; &#42;FailBlocks=nullptr)</>}>
Return true if it is safe to merge these two terminator instructions together. <a href="#a6b537c9f5fe8ee7d5950f9984fa5010a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a4c6e9504894d5f9468c5f151bdc75de2">setBranchWeights</a> (SwitchInst &#42;SI, ArrayRef&lt; uint32&#95;t &gt; Weights, bool IsExpected)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a939fe4165e88bc40fb5831d3d7a42976">setBranchWeights</a> (Instruction &#42;I, uint32&#95;t TrueWeight, uint32&#95;t FalseWeight, bool IsExpected)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a5efd178c4162515b93c85a967395564e">shouldBuildLookupTable</a> (SwitchInst &#42;SI, uint64&#95;t TableSize, const TargetTransformInfo &amp;TTI, const DataLayout &amp;DL, const SmallDenseMap&lt; PHINode &#42;, Type &#42; &gt; &amp;ResultTypes)</>}>
Determine whether a lookup table should be built for this switch, based on the number of cases, size of the table, and the types of the results. <a href="#a5efd178c4162515b93c85a967395564e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; std::tuple&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a>, bool &gt; &gt;</>}
  name={<><a href="#a1c4994ac805321b7fa03617dff656ad8">shouldFoldCondBranchesToCommonDestination</a> (BranchInst &#42;BI, BranchInst &#42;PBI, const TargetTransformInfo &#42;TTI)</>}>
Determine if the two branches share a common destination and deduce a glue that joins the branches&#39; conditions to arrive at the common destination if that would be profitable. <a href="#a1c4994ac805321b7fa03617dff656ad8">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a638ffe19974c5c1ce19abcd1905d4981">shouldHoistCommonInstructions</a> (Instruction &#42;I1, Instruction &#42;I2, const TargetTransformInfo &amp;TTI)</>}>
Helper function for hoistCommonCodeFromSuccessors. <a href="#a638ffe19974c5c1ce19abcd1905d4981">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9bb113178ba0769ba9abbfa1e896f6f0">shouldUseSwitchConditionAsTableIndex</a> (ConstantInt &amp;MinCaseVal, const ConstantInt &amp;MaxCaseVal, bool HasDefaultResults, const SmallDenseMap&lt; PHINode &#42;, Type &#42; &gt; &amp;ResultTypes, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a40f7c70fc970f25f1c32e8b2c28662ec">SimplifyCondBranchToCondBranch</a> (BranchInst &#42;PBI, BranchInst &#42;BI, DomTreeUpdater &#42;DTU, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</>}>
If we have a conditional branch as a predecessor of another block, this function tries to simplify it. <a href="#a40f7c70fc970f25f1c32e8b2c28662ec">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3e8ca2c20b8c4c14c72c49d98f3801ed">simplifySwitchOfCmpIntrinsic</a> (SwitchInst &#42;SI, IRBuilderBase &amp;Builder, DomTreeUpdater &#42;DTU)</>}>
Fold switch over ucmp/scmp intrinsic to br if two of the switch arms have the same destination. <a href="#a3e8ca2c20b8c4c14c72c49d98f3801ed">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#adc11c5fbec9bf293b000637357da66e4">simplifySwitchOfPowersOfTwo</a> (SwitchInst &#42;SI, IRBuilder&lt;&gt; &amp;Builder, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</>}>
Tries to transform switch of powers of two to reduce switch range. <a href="#adc11c5fbec9bf293b000637357da66e4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a7da8333874d1ad28bd987d4e7c474e53">sinkCommonCodeFromPredecessors</a> (BasicBlock &#42;BB, DomTreeUpdater &#42;DTU)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> whether BB&#39;s predecessors end with unconditional branches. <a href="#a7da8333874d1ad28bd987d4e7c474e53">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#abf69483b802f1e342399912142341c60">sinkLastInstruction</a> (ArrayRef&lt; BasicBlock &#42; &gt; Blocks)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#aa67a8bc0841ad57e26ed447bb99ea15d">skippedInstrFlags</a> (Instruction &#42;I)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a2584054e6f103298b373933971ba043a">STATISTIC</a> (NumBitMaps, &quot;Number of switch instructions turned into bitmaps&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ad06da0e96d7a2a4d6bb3feb5fd526659">STATISTIC</a> (NumLinearMaps, &quot;Number of switch instructions turned into linear mapping&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a07de8e6e4b0f1b765d87d23ac481ed9c">STATISTIC</a> (NumLookupTables, &quot;Number of switch instructions turned into lookup tables&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a10e5b4ab061061964a8ee9bdd135740d">STATISTIC</a> (NumLookupTablesHoles, &quot;Number of switch instructions turned into lookup tables (holes checked)&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#afda497480c7b80935a03dc10e35e6720">STATISTIC</a> (NumTableCmpReuses, &quot;Number of reused switch table lookup compares&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#abd947f60b34fd0d51dff4a603e2c4911">STATISTIC</a> (NumFoldValueComparisonIntoPredecessors, &quot;Number of value comparisons folded into predecessor basic blocks&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a09df89d3f06016afc645940f8cec4188">STATISTIC</a> (NumFoldBranchToCommonDest, &quot;Number of branches folded into predecessor basic block&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a3c3039a37824ae27819879004f1951dd">STATISTIC</a> (NumHoistCommonCode, &quot;Number of common instruction &#39;blocks&#39; hoisted up to the begin block&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a607d6761635bfa081583159779e51bb8">STATISTIC</a> (NumHoistCommonInstrs, &quot;Number of common instructions hoisted up to the begin block&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#abb20ec00f27f5c7f72fe1e0d1b3b04f5">STATISTIC</a> (NumSinkCommonCode, &quot;Number of common instruction &#39;blocks&#39; sunk down to the end block&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a858341feba4cac053973cdd66125defc">STATISTIC</a> (NumSinkCommonInstrs, &quot;Number of common instructions sunk down to the end block&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a2d98bfa47dabe9de17f8b2126fdfbd79">STATISTIC</a> (NumSpeculations, &quot;Number of speculative executed instructions&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#affaf4a17c353673f09b5c56566ef08a2">STATISTIC</a> (NumInvokes, &quot;Number of invokes with empty resume blocks simplified into calls&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a93817c738869659b94158c32d1b35e8a">STATISTIC</a> (NumInvokesMerged, &quot;Number of invokes that were merged together&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a0d4a52565b6d16f6c6fa743471e62002">STATISTIC</a> (NumInvokeSetsFormed, &quot;Number of invoke sets that were formed&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4abbfca67cb7fc77432aa8cd48af8b0a">switchToLookupTable</a> (SwitchInst &#42;SI, IRBuilder&lt;&gt; &amp;Builder, DomTreeUpdater &#42;DTU, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</>}>
If the switch is only used to initialize one or more phi nodes in a common successor block with different constant values, replace the switch with lookup tables. <a href="#a4abbfca67cb7fc77432aa8cd48af8b0a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a794d3a5f46134c24aade41b327d8418e">trySwitchToSelect</a> (SwitchInst &#42;SI, IRBuilder&lt;&gt; &amp;Builder, DomTreeUpdater &#42;DTU, const DataLayout &amp;DL, const TargetTransformInfo &amp;TTI)</>}>
If a switch is only used to initialize one or more phi nodes in a common successor block with only two different constant values, try to replace the switch with a select. <a href="#a794d3a5f46134c24aade41b327d8418e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a428f7b53e32934ae46a9aa35d3028d87">tryToMergeLandingPad</a> (LandingPadInst &#42;LPad, BranchInst &#42;BI, BasicBlock &#42;BB, DomTreeUpdater &#42;DTU)</>}>
Given an block with only a single landing pad and a unconditional branch try to find another basic block which this one can be merged with. <a href="#a428f7b53e32934ae46a9aa35d3028d87">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ad98f06eded5a01ee8704f7d7d9ca4c5b">tryWidenCondBranchToCondBranch</a> (BranchInst &#42;PBI, BranchInst &#42;BI, DomTreeUpdater &#42;DTU)</>}>
If the previous block ended with a widenable branch, determine if reusing the target block is profitable and legal. <a href="#ad98f06eded5a01ee8704f7d7d9ca4c5b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a0b4c48d53ab1ddc5bf009cd4ddffdc5a">validateAndCostRequiredSelects</a> (BasicBlock &#42;BB, BasicBlock &#42;ThenBB, BasicBlock &#42;EndBB, unsigned &amp;SpeculatedInstructions, InstructionCost &amp;Cost, const TargetTransformInfo &amp;TTI)</>}>
Estimate the cost of the insertion(s) and check that the PHI nodes can be converted to selects. <a href="#a0b4c48d53ab1ddc5bf009cd4ddffdc5a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a05c11986a2c95c43b7a1ae03b7f88d1d">validLookupTableConstant</a> (Constant &#42;C, const TargetTransformInfo &amp;TTI)</>}>
Return true if the backend will be able to handle initializing an array of constants like C. <a href="#a05c11986a2c95c43b7a1ae03b7f88d1d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a159c35fe8089d7348efef90d098aecbe">valuesOverlap</a> (std::vector&lt; ValueEqualityComparisonCase &gt; &amp;C1, std::vector&lt; ValueEqualityComparisonCase &gt; &amp;C2)</>}>
Return true if there are any keys in C1 that exist in C2 as well. <a href="#a159c35fe8089d7348efef90d098aecbe">More...</a>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a79acde6fd121317486a8a70fbc1e0c14">BranchFoldThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#aebaf393c898e387f182c798412f13622">BranchFoldToCommonDestVectorMultiplier</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a763f9b0b99f42804e6ab2d09ebc395a1">EnableMergeCompatibleInvokes</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a8e8073e7ef8737b21cdf98608bbd17b9">HoistCommon</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#aedd87113e9f2b7035fb15c4aeadbbd98">HoistCommonSkipLimit</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a96d7d928b8da0aaa8a366c8a36a16b89">HoistCondStores</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a004c0d539d69756950a2dcd676799e0c">HoistLoadsStoresWithCondFaulting</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#afcc2d83294ce3af8abbfda0a3ea248ea">HoistLoadsStoresWithCondFaultingThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; int &gt;</>}
  name={<><a href="#a47aef60715560eb30f15d8c2edc4cae7">MaxSmallBlockSize</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a1b01002cae53d61fdfeba33d27907dfb">MaxSpeculationDepth</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a25dbc1cc43ca0c2fa252ddd0255f86cf">MaxSwitchCasesPerResult</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ae848c33bb9817bf71288c58eb68f0e11">MergeCondStores</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a3caffa5cefe8399ed3efb62e834b1528">MergeCondStoresAggressively</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#af03cfeeab17b16ab9c47da7686f9f632">PHINodeFoldingThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a0cca1e07e2a0f1f96f02d60bc5cb7a88">SinkCommon</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a43eed4d9c3854b2af5336428e83359d4">SpeculateOneExpensiveInst</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a4060584a976cdd9ab251ce690690796c">TwoEntryPHINodeFoldingThreshold</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;simplifycfg&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Enumerations

### enum  {#a72d0db08ead54facf3e1e90aaae435ba}

<MemberDefinition
  prototype="enum SkipFlags ">

<EnumerationList title="Enumeration values">

<Link id="a72d0db08ead54facf3e1e90aaae435baa45adf13243e382f733c98877e11c1e92" />
<EnumerationListItem name="SkipReadMem">
 (= 1)
</EnumerationListItem>

<Link id="a72d0db08ead54facf3e1e90aaae435baa9b3138aebe4b75a1d2cf58ca3b2aaa9e" />
<EnumerationListItem name="SkipSideEffect">
 (= 2)
</EnumerationListItem>

<Link id="a72d0db08ead54facf3e1e90aaae435baae768be164a586335f583dbafeecc1ea7" />
<EnumerationListItem name="SkipImplicitControlFlow">
 (= 4)
</EnumerationListItem>

</EnumerationList>

Definition at line <a href="#l01452">1452</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### addPredecessorToBlock() {#a0375fe3378c23272b805320851744043}

<MemberDefinition
  prototype={<>static void addPredecessorToBlock (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; Succ, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; NewPred, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ExistPred, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &#42; MSSAU=nullptr)</>}
  labels = {["static"]}>
Update PHI nodes in Succ to indicate that there will now be entries in it from the &#39;NewPred&#39; block.

The values that will be flowing into the PHI nodes will be the same as those coming in from ExistPred, an existing predecessor of Succ.

Definition at line <a href="#l00388">388</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### allPredecessorsComeFromSameSource() {#a265306d8985def49c26247e9006878de}

<MemberDefinition
  prototype={<>static BasicBlock &#42; allPredecessorsComeFromSameSource (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB)</>}
  labels = {["static"]}>

Definition at line <a href="#l07923">7923</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### areIdenticalUpToCommutativity() {#a47aa12b3f79390c9835ac99904b2cb51}

<MemberDefinition
  prototype={<>static bool areIdenticalUpToCommutativity (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I1, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I2)</>}
  labels = {["static"]}>

Definition at line <a href="#l01597">1597</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### blockIsSimpleEnoughToThreadThrough() {#aee330f66887329eef3ddc7dc8ccda193}

<MemberDefinition
  prototype={<>static bool blockIsSimpleEnoughToThreadThrough (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB)</>}
  labels = {["static"]}>
Return true if we can thread a branch across this block.

Definition at line <a href="#l03508">3508</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### canSinkInstructions() {#ae9efb27478c86bece81f1bf5bca2d348}

<MemberDefinition
  prototype={<>static bool canSinkInstructions (<a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &gt; Insts, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/use">Use</a> &#42;, <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, 4 &gt; &gt; &amp; PHIOperands)</>}
  labels = {["static"]}>

Definition at line <a href="#l02219">2219</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### casesAreContiguous() {#a7e7374e59505b56b9bf65507fb90dd40}

<MemberDefinition
  prototype={<>static bool casesAreContiguous (<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42; &gt; &amp; Cases)</>}
  labels = {["static"]}>

Definition at line <a href="#l05736">5736</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### cloneInstructionsIntoPredecessorBlockAndUpdateSSAUses() {#a2a8aa905f11fdce2fbbfd8e695d282b5}

<MemberDefinition
  prototype={<>static void cloneInstructionsIntoPredecessorBlockAndUpdateSSAUses (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; PredBlock, <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp; VMap)</>}
  labels = {["static"]}>

Definition at line <a href="#l01106">1106</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### computeSpeculationCost() {#a9ac94808486f1c47e5cc9ba62dcc6fae}

<MemberDefinition
  prototype={<>static InstructionCost computeSpeculationCost (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/user">User</a> &#42; I, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
Compute an abstract &quot;cost&quot; of speculating the given instruction, which is assumed to be safe to speculate.

TCC&#95;Free means cheap, TCC&#95;Basic means less cheap, and TCC&#95;Expensive means prohibitively expensive.

Definition at line <a href="#l00402">402</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### constantFold() {#a40bb6295bf75ebb0f636376637ed518f}

<MemberDefinition
  prototype={<>static Constant &#42; constantFold (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; &gt; &amp; ConstantPool)</>}
  labels = {["static"]}>
Try to fold instruction I into a constant.

This works for simple instructions such as binary operations where both operands are constant or can be replaced by constants from the <a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>. Returns the resulting constant on success, 0 otherwise.

Definition at line <a href="#l06133">6133</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### constantIntSortPredicate() {#a2ab3a1c5bf0fff25a3254622107b9c9f}

<MemberDefinition
  prototype={<>static int constantIntSortPredicate (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> &#42; P1, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> &#42; P2)</>}
  labels = {["static"]}>

Definition at line <a href="#l01067">1067</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### createLogicalOp() {#a6092c4a20d4eba2072c849c5408b9435}

<MemberDefinition
  prototype={<>static Value &#42; createLogicalOp (<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; Builder, <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opc, <a href="/docs/api/classes/llvm/value">Value</a> &#42; LHS, <a href="/docs/api/classes/llvm/value">Value</a> &#42; RHS, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp; Name=&quot;&quot;)</>}
  labels = {["static"]}>

Definition at line <a href="#l03931">3931</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### createUnreachableSwitchDefault() {#a7aa8025f73f4e06135e6ba7083ad7aab}

<MemberDefinition
  prototype={<>static void createUnreachableSwitchDefault (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; Switch, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, bool RemoveOrigDefaultBlock=<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a>)</>}
  labels = {["static"]}>

Definition at line <a href="#l05747">5747</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### dominatesMergePoint() {#af67eef9e8d101756a1a0164e63eb4556}

<MemberDefinition
  prototype={<>static bool dominatesMergePoint (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; InsertPt, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &gt; &amp; AggressiveInsts, <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> &amp; Cost, <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> Budget, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, unsigned Depth=0)</>}
  labels = {["static"]}>
If we have a merge point of an &quot;if condition&quot; as accepted above, return true if the specified value dominates the block.

We don&#39;t handle the true generality of domination here, just a special case which works well enough for us.

If AggressiveInsts is non-null, and if V does not dominate BB, we check to see if V (which must be an instruction) and its recursive operands that do not dominate BB have a combined cost lower than Budget and are non-trapping. If both are true, the instruction is inserted into the set and true is returned.

The cost for most non-trapping instructions is defined as 1 except for Select whose cost is 2.

After this function returns, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> is increased by the cost of V plus its non-dominating operands. If that cost is greater than Budget, false is returned and <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> is undefined.

Definition at line <a href="#l00424">424</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### eliminateBlockCases() {#ab2bdf79ec154e7a070ec95b9700152da}

<MemberDefinition
  prototype={<>static void eliminateBlockCases (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; ValueEqualityComparisonCase &gt; &amp; Cases)</>}
  labels = {["static"]}>
Given a vector of bb/value pairs, remove any entries in the list that match the specified block.

Definition at line <a href="#l00834">834</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### eliminateDeadSwitchCases() {#a83b0a34d940365e97b9a531c1f13f3b9}

<MemberDefinition
  prototype={<>static bool eliminateDeadSwitchCases (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; SI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Compute masked bits for the condition of a switch and use it to remove dead cases.

Definition at line <a href="#l05902">5902</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### ensureValueAvailableInSuccessor() {#a5bb62631ba6a4be0ae02f7365ee4a7d7}

<MemberDefinition
  prototype={<>static Value &#42; ensureValueAvailableInSuccessor (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/value">Value</a> &#42; AlternativeV=nullptr)</>}
  labels = {["static"]}>

Definition at line <a href="#l04277">4277</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### eraseTerminatorAndDCECond() {#aa9dd0c9b2a49c91d814102c1d0c7b09d}

<MemberDefinition
  prototype={<>static void eraseTerminatorAndDCECond (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; TI, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &#42; MSSAU=nullptr)</>}
  labels = {["static"]}>

Definition at line <a href="#l00767">767</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### extractPredSuccWeights() {#a404f7a1827e4eb8c5ded5ce6dafecf07}

<MemberDefinition
  prototype={<>static bool extractPredSuccWeights (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; PBI, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, uint64&#95;t &amp; PredTrueWeight, uint64&#95;t &amp; PredFalseWeight, uint64&#95;t &amp; SuccTrueWeight, uint64&#95;t &amp; SuccFalseWeight)</>}
  labels = {["static"]}>
Return true if either PBI or BI has branch weight available, and store the weights in &#123;Pred|Succ&#125;&#123;True|False&#125;Weight.

If one of PBI and BI does not have branch weight, use 1:1 as its weight.

Definition at line <a href="#l03947">3947</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### findPHIForConditionForwarding() {#a48e98416c61da7bdde42d88ea460723c}

<MemberDefinition
  prototype={<>static PHINode &#42; findPHIForConditionForwarding (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42; CaseValue, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, int &#42; PhiIndex)</>}
  labels = {["static"]}>
If BB would be eligible for simplification by TryToSimplifyUncondBranchFromEmptyBlock (i.e.

it is empty and terminated by an unconditional branch), look at the phi node for BB in the successor block and see if the incoming value is equal to CaseValue. If so, return the phi node, and set PhiIndex to BB&#39;s index in the phi node.

Definition at line <a href="#l06004">6004</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### findUniqueStoreInBlocks() {#a068826fbd1f18b8ecd1b8798d957eca9}

<MemberDefinition
  prototype={<>static StoreInst &#42; findUniqueStoreInBlocks (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB1, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB2)</>}
  labels = {["static"]}>

Definition at line <a href="#l04260">4260</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### fitWeights() {#a7b05fae85db516bdd2df79cef5a6343d}

<MemberDefinition
  prototype={<>static void fitWeights (<a href="/docs/api/classes/llvm/mutablearrayref">MutableArrayRef</a>&lt; uint64&#95;t &gt; Weights)</>}
  labels = {["static"]}>
Keep halving the weights until all can fit in uint32&#95;t.

Definition at line <a href="#l01097">1097</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### foldCondBranchOnValueKnownInPredecessor() {#a3f284045c53ed237131eb9153017c364}

<MemberDefinition
  prototype={<>static bool foldCondBranchOnValueKnownInPredecessor (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC)</>}
  labels = {["static"]}>

Definition at line <a href="#l03721">3721</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### foldCondBranchOnValueKnownInPredecessorImpl() {#ac0fb2da7eaa616e8ef8a8f52b981334b}

<MemberDefinition
  prototype={<>static std::optional&lt; bool &gt; foldCondBranchOnValueKnownInPredecessorImpl (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC)</>}
  labels = {["static"]}>
If we have a conditional branch on something for which we know the constant value in predecessors (e.g.

a phi node in the current block), thread edges from the predecessor to their ultimate destination.

Definition at line <a href="#l03564">3564</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### foldSwitchToSelect() {#a53f06c06e81412900ac140caaf764ff8}

<MemberDefinition
  prototype={<>static Value &#42; foldSwitchToSelect (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> SwitchCaseResultVectorTy &amp; ResultVector, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; DefaultResult, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Condition, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt; &amp; Builder)</>}
  labels = {["static"]}>

Definition at line <a href="#l06308">6308</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### foldTwoEntryPHINode() {#a92fe4b2aa97a12f4a947e5ce99f05b15}

<MemberDefinition
  prototype={<>static bool foldTwoEntryPHINode (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, bool SpeculateUnpredictables)</>}
  labels = {["static"]}>
Given a BB that starts with the specified two-entry PHI node, see if we can eliminate it.

Definition at line <a href="#l03737">3737</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### forwardSwitchConditionToPHI() {#a480bd8ae64f6f3e4a9cc6e1a724b2ad0}

<MemberDefinition
  prototype={<>static bool forwardSwitchConditionToPHI (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; SI)</>}
  labels = {["static"]}>
Try to forward the condition of a switch instruction to a phi node dominated by the switch, if that would mean that some of the destination blocks of the switch can be folded away.

Return true if a change is made.

Definition at line <a href="#l06035">6035</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### getBranchWeights() {#ad3e63520dcd2b8f8aa1b2e66e734a575}

<MemberDefinition
  prototype={<>static void getBranchWeights (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; TI, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; uint64&#95;t &gt; &amp; Weights)</>}
  labels = {["static"]}>
Get Weights of a given terminator, the default weight is at the front of the vector.

If TI is a conditional eq, we need to swap the branch-weight metadata.

Definition at line <a href="#l01079">1079</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### getCaseResults() {#a31070c67db84f4caef376dcb7906c4fb}

<MemberDefinition
  prototype={<>static bool getCaseResults (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; SI, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42; CaseVal, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; CaseDest, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;&#42; CommonDest, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; std::pair&lt; <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; &gt; &gt; &amp; Res, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
Try to determine the resulting constant values in phi nodes at the common destination basic block, &#42;CommonDest, for one of the case destionations CaseDest corresponding to value CaseVal (0 for the default case), of a switch instruction <a href="/docs/api/namespaces/llvm/si">SI</a>.

Definition at line <a href="#l06162">6162</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### getConstantInt() {#a3abb1cc80a02ab7f543ff2d98987e121}

<MemberDefinition
  prototype={<>static ConstantInt &#42; getConstantInt (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
Extract <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> from value, looking through IntToPtr and PointerNullValue.

Return NULL if value is not a constant int.

Definition at line <a href="#l00492">492</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### getKnownValueOnEdge() {#afb9fd1f991a7503fe4fd7dc16bda6f30}

<MemberDefinition
  prototype={<>static ConstantInt &#42; getKnownValueOnEdge (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; From, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; To)</>}
  labels = {["static"]}>

Definition at line <a href="#l03542">3542</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### hoistConditionalLoadsStores() {#ab99310a04afb6c28186b1a6428eb75b0}

<MemberDefinition
  prototype={<>static void hoistConditionalLoadsStores (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &gt; &amp; SpeculatedConditionalLoadsStores, std::optional&lt; bool &gt; Invert)</>}
  labels = {["static"]}>
If the target supports conditional faulting, we look for the following pattern:

<ProgramListing>

<CodeLine><span class="doxyHighlight">BB:</span></CodeLine>
<CodeLine><span class="doxyHighlight">  ...</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %cond = icmp ult %x, %y</span></CodeLine>
<CodeLine><span class="doxyHighlight">  br i1 %cond, label %TrueBB, label %FalseBB</span></CodeLine>
<CodeLine><span class="doxyHighlight">FalseBB:</span></CodeLine>
<CodeLine><span class="doxyHighlight">  store i32 1, ptr %q, align 4</span></CodeLine>
<CodeLine><span class="doxyHighlight">  ...</span></CodeLine>
<CodeLine><span class="doxyHighlight">TrueBB:</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %maskedloadstore = load i32, ptr %b, align 4</span></CodeLine>
<CodeLine><span class="doxyHighlight">  store i32 %maskedloadstore, ptr %p, align 4</span></CodeLine>
<CodeLine><span class="doxyHighlight">  ...</span></CodeLine>

</ProgramListing>


and transform it into:


<ProgramListing>

<CodeLine><span class="doxyHighlight">BB:</span></CodeLine>
<CodeLine><span class="doxyHighlight">  ...</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %cond = icmp ult %x, %y</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %maskedloadstore = cload i32, ptr %b, %cond</span></CodeLine>
<CodeLine><span class="doxyHighlight">  cstore i32 %maskedloadstore, ptr %p, %cond</span></CodeLine>
<CodeLine><span class="doxyHighlight">  cstore i32 1, ptr %q, ~%cond</span></CodeLine>
<CodeLine><span class="doxyHighlight">  br i1 %cond, label %TrueBB, label %FalseBB</span></CodeLine>
<CodeLine><span class="doxyHighlight">FalseBB:</span></CodeLine>
<CodeLine><span class="doxyHighlight">  ...</span></CodeLine>
<CodeLine><span class="doxyHighlight">TrueBB:</span></CodeLine>
<CodeLine><span class="doxyHighlight">  ...</span></CodeLine>

</ProgramListing>


where cload/cstore are represented by llvm.masked.load/store intrinsics, e.g.


<ProgramListing>

<CodeLine><span class="doxyHighlight">%vcond = bitcast i1 %cond to &lt;1 x i1&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">%v0 = call &lt;1 x i32&gt; @llvm.masked.load.v1i32.p0</span></CodeLine>
<CodeLine><span class="doxyHighlight">                      (ptr %b, i32 4, &lt;1 x i1&gt; %vcond, &lt;1 x i32&gt; poison)</span></CodeLine>
<CodeLine><span class="doxyHighlight">%maskedloadstore = bitcast &lt;1 x i32&gt; %v0 to i32</span></CodeLine>
<CodeLine><span class="doxyHighlight">call void @llvm.masked.store.v1i32.p0</span></CodeLine>
<CodeLine><span class="doxyHighlight">                       (&lt;1 x i32&gt; %v0, ptr %p, i32 4, &lt;1 x i1&gt; %vcond)</span></CodeLine>
<CodeLine><span class="doxyHighlight">%cond.not = xor i1 %cond, true</span></CodeLine>
<CodeLine><span class="doxyHighlight">%vcond.not = bitcast i1 %cond.not to &lt;1 x i&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">call void @llvm.masked.store.v1i32.p0</span></CodeLine>
<CodeLine><span class="doxyHighlight">           (&lt;1 x i32&gt; &lt;i32 1&gt;, ptr %q, i32 4, &lt;1x i1&gt; %vcond.not)</span></CodeLine>

</ProgramListing>


So we need to turn hoisted load/store into cload/cstore.


<ParametersList title="Parameters">
<ParametersListItem name="BI">The branch instruction.</ParametersListItem>
<ParametersListItem name="SpeculatedConditionalLoadsStores">The load/store instructions that will be speculated.</ParametersListItem>
<ParametersListItem name="Invert">indicates if speculates FalseBB. Only used in triangle CFG.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l01671">1671</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### hoistLockstepIdenticalDbgVariableRecords() {#aedc31552ebf0ce116c665da44b4a97a5}

<MemberDefinition
  prototype={<>static void hoistLockstepIdenticalDbgVariableRecords (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; TI, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I1, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &gt; &amp; OtherInsts)</>}
  labels = {["static"]}>
Hoists DbgVariableRecords from <code>I1</code> and <code>OtherInstrs</code> that are identical in lock-step to <code>TI</code>.

This matches how dbg.&#42; intrinsics are hoisting in hoistCommonCodeFromSuccessors. e.g. The input: I1 DVRs: &#123; x, z &#125;, OtherInsts: &#123; I2 DVRs: &#123; x, y, z &#125; &#125; would result in hoisting only <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> x.

Definition at line <a href="#l01546">1546</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### incomingValuesAreCompatible() {#a7851d1e39cf3c6f27aa6fe911056a142}

<MemberDefinition
  prototype={<>static bool incomingValuesAreCompatible (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; IncomingBlocks, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &#42; EquivalenceSet=nullptr)</>}
  labels = {["static"]}>
Return true if all the PHI nodes in the basic block <code>BB</code> receive compatible (identical) incoming values when coming from all of the predecessor blocks that are specified in <code>IncomingBlocks</code>.

Note that if the values aren&#39;t exactly identical, but <code>EquivalenceSet</code> is provided, and <em>both</em> of the values are present in the set, then they are considered equal.

Definition at line <a href="#l00332">332</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### initializeUniqueCases() {#a95851c48d68c2406ef12a7cca9c65f76}

<MemberDefinition
  prototype={<>static bool initializeUniqueCases (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; SI, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp; PHI, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;&amp; CommonDest, SwitchCaseResultVectorTy &amp; UniqueResults, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;&amp; DefaultResult, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, uintptr&#95;t MaxUniqueResults)</>}
  labels = {["static"]}>

Definition at line <a href="#l06251">6251</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### isCleanupBlockEmpty() {#a583f07468003b1c19e8227f1c0e63fb7}

<MemberDefinition
  prototype={<>static bool isCleanupBlockEmpty (<a href="/docs/api/classes/llvm/iterator-range">iterator&#95;range</a>&lt; <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> &gt; R)</>}
  labels = {["static"]}>

Definition at line <a href="#l05274">5274</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### isLifeTimeMarker() {#ae97521436759fc2489301a34e621bbcd}

<MemberDefinition
  prototype={<>static bool isLifeTimeMarker (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I)</>}
  labels = {["static"]}>

Definition at line <a href="#l02191">2191</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### isProfitableToSpeculate() {#a08cd264874d8deee9a2bdda9b9461e29}

<MemberDefinition
  prototype={<>static bool isProfitableToSpeculate (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, std::optional&lt; bool &gt; Invert, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>

Definition at line <a href="#l03194">3194</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### isSafeCheapLoadStore() {#af7700655934807d2b707112f79217377}

<MemberDefinition
  prototype={<>static bool isSafeCheapLoadStore (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>

Definition at line <a href="#l01757">1757</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### isSafeToHoistInstr() {#a396eac919c9ac7907275e770a8cd37cf}

<MemberDefinition
  prototype={<>static bool isSafeToHoistInstr (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, unsigned Flags)</>}
  labels = {["static"]}>

Definition at line <a href="#l01473">1473</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### isSafeToHoistInvoke() {#a3aaba0277f5dd5636e099fa81c20c533}

<MemberDefinition
  prototype={<>static bool isSafeToHoistInvoke (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB1, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB2, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I1, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I2)</>}
  labels = {["static"]}>

Definition at line <a href="#l01435">1435</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### isSafeToSpeculateStore() {#a8bb9afd23da56f99f3bcdb52e9c74320}

<MemberDefinition
  prototype={<>static Value &#42; isSafeToSpeculateStore (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BrBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; StoreBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; EndBB)</>}
  labels = {["static"]}>
Determine if we can hoist sink a sole store instruction out of a conditional block.

We are looking for code like the following: BrBB: store i32 add, i32&#42; arrayidx2 ... // No other stores or function calls (we could be calling a memory ... // function). cmp = icmp ult x, y br i1 cmp, label EndBB, label ThenBB ThenBB: store i32 add5, i32&#42; arrayidx2 br label EndBB EndBB: ... We are going to transform this into: BrBB: store i32 add, i32&#42; arrayidx2 ... // cmp = icmp ult x, y add.add5 = select i1 cmp, i32 add, add5 store i32 add.add5, i32&#42; arrayidx2 ...


<SectionUser title="Returns">
The pointer to the value of the previous store if the store can be hoisted into the predecessor block. 0 otherwise.
</SectionUser>

Definition at line <a href="#l03079">3079</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### isSwitchDense() {#a7c6e64e4a4dbba951d47fe2b1d188b2c}

<MemberDefinition
  prototype={<>static bool isSwitchDense (uint64&#95;t NumCases, uint64&#95;t CaseRange)</>}
  labels = {["static"]}>

Definition at line <a href="#l06745">6745</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### isSwitchDense() {#aa28651c1e85585ae702f652a8df06019}

<MemberDefinition
  prototype={<>static bool isSwitchDense (<a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; int64&#95;t &gt; Values)</>}
  labels = {["static"]}>

Definition at line <a href="#l06757">6757</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### isTypeLegalForLookupTable() {#a7ef36c3b9f5334218cf1b3b7e8e33569}

<MemberDefinition
  prototype={<>static bool isTypeLegalForLookupTable (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>

Definition at line <a href="#l06724">6724</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### isVectorOp() {#a227525ceb37837d0076479b272b50aec}

<MemberDefinition
  prototype={<>static bool isVectorOp (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp; I)</>}
  labels = {["static"]}>
Return if an instruction&#39;s type or any of its operands&#39; types are a vector type.

Definition at line <a href="#l04124">4124</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### lookupConstant() {#adc3fe6855d95097c6692cea63a747695}

<MemberDefinition
  prototype={<>static Constant &#42; lookupConstant (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; &gt; &amp; ConstantPool)</>}
  labels = {["static"]}>
If V is a <a href="/docs/api/classes/llvm/constant">Constant</a>, return it.

Otherwise, try to look up its constant value in <a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>, returning 0 if it&#39;s not there.

Definition at line <a href="#l06121">6121</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### mapCaseToResult() {#ac46c68ef01d64ec7e21b62016818063a}

<MemberDefinition
  prototype={<>static size&#95;t mapCaseToResult (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42; CaseVal, SwitchCaseResultVectorTy &amp; UniqueResults, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; Result)</>}
  labels = {["static"]}>

Definition at line <a href="#l06233">6233</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### mergeCleanupPad() {#a1f70470f7a7722fd55c58c81358107f2}

<MemberDefinition
  prototype={<>static bool mergeCleanupPad (<a href="/docs/api/classes/llvm/cleanupreturninst">CleanupReturnInst</a> &#42; RI)</>}
  labels = {["static"]}>

Definition at line <a href="#l05504">5504</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### mergeCompatibleInvokes() {#aa7e215bdd027461da0d8205cf5ef0e32}

<MemberDefinition
  prototype={<>static bool mergeCompatibleInvokes (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU)</>}
  labels = {["static"]}>
If this block is a <code>landingpad</code> exception handling block, categorize all the predecessor <code>invoke</code>s into sets, with all <code>invoke</code>s in each set being &quot;mergeable&quot; together, and then merge invokes in each set together.

This is a weird mix of hoisting and sinking. Visually, it goes from: &#91;...&#93; &#91;...&#93; | | &#91;invoke0&#93; &#91;invoke1&#93; / \\ / \\ &#91;cont0&#93; &#91;landingpad&#93; &#91;cont1&#93; to: &#91;...&#93; &#91;...&#93; \\ / &#91;invoke&#93; / \\ &#91;cont&#93; &#91;landingpad&#93;

But of course we can only do that if the invokes share the <code>landingpad</code>, edges invoke0-&gt;cont0 and invoke1-&gt;cont1 are &quot;compatible&quot;, and the invoked functions are &quot;compatible&quot;.

Definition at line <a href="#l02996">2996</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### mergeCompatibleInvokesImpl() {#acc8066950deec241b4fafe0700ff5f2c}

<MemberDefinition
  prototype={<>static void mergeCompatibleInvokesImpl (<a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42; &gt; Invokes, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU)</>}
  labels = {["static"]}>

Definition at line <a href="#l02844">2844</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### mergeConditionalStores() {#a6a58dfc629e1b208cdd7b2bd76203184}

<MemberDefinition
  prototype={<>static bool mergeConditionalStores (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; PBI, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; QBI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>

Definition at line <a href="#l04475">4475</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### mergeConditionalStoreToAddress() {#a1a5189be752e56bf8343fd72f45720ee}

<MemberDefinition
  prototype={<>static bool mergeConditionalStoreToAddress (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; PTB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; PFB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; QTB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; QFB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; PostBB, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Address, bool InvertPCond, bool InvertQCond, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>

Definition at line <a href="#l04327">4327</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### mergeNestedCondBranch() {#ad9d19d00519eec89a553d376d72c9520}

<MemberDefinition
  prototype={<>static bool mergeNestedCondBranch (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU)</>}
  labels = {["static"]}>
Fold the following pattern: bb0: br i1 cond1, label bb1, label bb2 bb1: br i1 cond2, label bb3, label bb4 bb2: br i1 cond2, label bb4, label bb3 bb3: ... bb4: ... into bb0: cond = xor i1 cond1, cond2 br i1 cond, label bb4, label bb3 bb3: ... bb4: ... NOTE: cond2 always dominates the terminator of bb0.

Definition at line <a href="#l07954">7954</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### passingValueIsAlwaysUndefined() {#a32c2973fa0babdd440d3ab7dd160664a}

<MemberDefinition
  prototype={<>static bool passingValueIsAlwaysUndefined (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, bool PtrValueMayBeModified=false)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if passing a value to an instruction will cause undefined behavior.

Definition at line <a href="#l08167">8167</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### performBranchToCommonDestFolding() {#a31a4e5663521fd6944605496cbc32bbb}

<MemberDefinition
  prototype={<>static bool performBranchToCommonDestFolding (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; PBI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &#42; MSSAU, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI)</>}
  labels = {["static"]}>

Definition at line <a href="#l04010">4010</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### reduceSwitchRange() {#a6860a87b20545e2f53641a1bf33f6c4c}

<MemberDefinition
  prototype={<>static bool reduceSwitchRange (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; SI, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt; &amp; Builder, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
Try to transform a switch that has &quot;holes&quot; in it to a contiguous sequence of cases.

A switch such as: switch(i) &#123;case 5: case 9: case 13: case 17:&#125; can be range-reduced to: switch ((i-5) / 4) &#123;case 0: case 1: case 2: case 3:&#125;.

This converts a sparse switch into a dense switch which allows better lowering and could also allow transforming into a lookup table.

Definition at line <a href="#l07226">7226</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### removeEmptyCleanup() {#aedfe10b7b8a1008ddaa4104f54e0b483}

<MemberDefinition
  prototype={<>static bool removeEmptyCleanup (<a href="/docs/api/classes/llvm/cleanupreturninst">CleanupReturnInst</a> &#42; RI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU)</>}
  labels = {["static"]}>

Definition at line <a href="#l05387">5387</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### removeSwitchAfterSelectFold() {#a0ceff22bcbbcc85abecced9a3a395ccf}

<MemberDefinition
  prototype={<>static void removeSwitchAfterSelectFold (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; SI, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PHI, <a href="/docs/api/classes/llvm/value">Value</a> &#42; SelectValue, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt; &amp; Builder, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU)</>}
  labels = {["static"]}>

Definition at line <a href="#l06384">6384</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### removeUndefIntroducingPredecessor() {#af04adca83664ebd947723470c4da58aa}

<MemberDefinition
  prototype={<>static bool removeUndefIntroducingPredecessor (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC)</>}
  labels = {["static"]}>
If BB has an incoming value that will always trigger undefined behavior (eg.

null pointer dereference), remove the branch leading here.

Definition at line <a href="#l08309">8309</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### replacingOperandWithVariableIsCheap() {#aa85a3c04f64695265702d0b3c3d6ea1c}

<MemberDefinition
  prototype={<>static bool replacingOperandWithVariableIsCheap (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, int OpIdx)</>}
  labels = {["static"]}>

Definition at line <a href="#l02206">2206</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### reuseTableCompare() {#ad75372cc26ff6f641159aed90d5fc11e}

<MemberDefinition
  prototype={<>static void reuseTableCompare (<a href="/docs/api/classes/llvm/user">User</a> &#42; PhiUser, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; PhiBlock, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; RangeCheckBranch, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; DefaultValue, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; std::pair&lt; <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; &gt; &gt; &amp; Values)</>}
  labels = {["static"]}>
Try to reuse the switch table index compare.

Following pattern: 
<ProgramListing>

<CodeLine><span class="doxyHighlight">if (idx &lt; tablesize)</span></CodeLine>
<CodeLine><span class="doxyHighlight">   r = table&#91;idx&#93;; // table does not contain default&#95;value</span></CodeLine>
<CodeLine><span class="doxyHighlight">else</span></CodeLine>
<CodeLine><span class="doxyHighlight">   r = default&#95;value;</span></CodeLine>
<CodeLine><span class="doxyHighlight">if (r != default&#95;value)</span></CodeLine>
<CodeLine><span class="doxyHighlight">   ...</span></CodeLine>

</ProgramListing>
 Is optimized to: 
<ProgramListing>

<CodeLine><span class="doxyHighlight">cond = idx &lt; tablesize;</span></CodeLine>
<CodeLine><span class="doxyHighlight">if (cond)</span></CodeLine>
<CodeLine><span class="doxyHighlight">   r = table&#91;idx&#93;;</span></CodeLine>
<CodeLine><span class="doxyHighlight">else</span></CodeLine>
<CodeLine><span class="doxyHighlight">   r = default&#95;value;</span></CodeLine>
<CodeLine><span class="doxyHighlight">if (cond)</span></CodeLine>
<CodeLine><span class="doxyHighlight">   ...</span></CodeLine>

</ProgramListing>
 Jump threading will then eliminate the second if(cond).

Definition at line <a href="#l06846">6846</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### safeToMergeTerminators() {#a6b537c9f5fe8ee7d5950f9984fa5010a}

<MemberDefinition
  prototype={<>static bool safeToMergeTerminators (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; SI1, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; SI2, <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 4 &gt; &#42; FailBlocks=nullptr)</>}
  labels = {["static"]}>
Return true if it is safe to merge these two terminator instructions together.

Definition at line <a href="#l00356">356</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### setBranchWeights() {#a4c6e9504894d5f9468c5f151bdc75de2}

<MemberDefinition
  prototype={<>static void setBranchWeights (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; SI, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; uint32&#95;t &gt; Weights, bool IsExpected)</>}
  labels = {["static"]}>

Definition at line <a href="#l00875">875</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### setBranchWeights() {#a939fe4165e88bc40fb5831d3d7a42976}

<MemberDefinition
  prototype={<>static void setBranchWeights (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, uint32&#95;t TrueWeight, uint32&#95;t FalseWeight, bool IsExpected)</>}
  labels = {["static"]}>

Definition at line <a href="#l00888">888</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### shouldBuildLookupTable() {#a5efd178c4162515b93c85a967395564e}

<MemberDefinition
  prototype={<>static bool shouldBuildLookupTable (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; SI, uint64&#95;t TableSize, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap</a>&lt; <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;, <a href="/docs/api/classes/llvm/type">Type</a> &#42; &gt; &amp; ResultTypes)</>}
  labels = {["static"]}>
Determine whether a lookup table should be built for this switch, based on the number of cases, size of the table, and the types of the results.

Definition at line <a href="#l06772">6772</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### shouldFoldCondBranchesToCommonDestination() {#a1c4994ac805321b7fa03617dff656ad8}

<MemberDefinition
  prototype={<>static std::optional&lt; std::tuple&lt; BasicBlock &#42;, Instruction::BinaryOps, bool &gt; &gt; shouldFoldCondBranchesToCommonDestination (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; PBI, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI)</>}
  labels = {["static"]}>
Determine if the two branches share a common destination and deduce a glue that joins the branches&#39; conditions to arrive at the common destination if that would be profitable.

Definition at line <a href="#l03971">3971</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### shouldHoistCommonInstructions() {#a638ffe19974c5c1ce19abcd1905d4981}

<MemberDefinition
  prototype={<>static bool shouldHoistCommonInstructions (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I1, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I2, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
Helper function for hoistCommonCodeFromSuccessors.

Return true if identical instructions <code>I1</code> and <code>I2</code> can and should be hoisted.

Definition at line <a href="#l01511">1511</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### shouldUseSwitchConditionAsTableIndex() {#a9bb113178ba0769ba9abbfa1e896f6f0}

<MemberDefinition
  prototype={<>static bool shouldUseSwitchConditionAsTableIndex (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &amp; MinCaseVal, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &amp; MaxCaseVal, bool HasDefaultResults, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap</a>&lt; <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;, <a href="/docs/api/classes/llvm/type">Type</a> &#42; &gt; &amp; ResultTypes, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>

Definition at line <a href="#l06809">6809</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### SimplifyCondBranchToCondBranch() {#a40f7c70fc970f25f1c32e8b2c28662ec}

<MemberDefinition
  prototype={<>static bool SimplifyCondBranchToCondBranch (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; PBI, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
If we have a conditional branch as a predecessor of another block, this function tries to simplify it.

We know that PBI and BI are both conditional branches, and BI is in one of the successor blocks of PBI - PBI branches to BI.

Definition at line <a href="#l04644">4644</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### simplifySwitchOfCmpIntrinsic() {#a3e8ca2c20b8c4c14c72c49d98f3801ed}

<MemberDefinition
  prototype={<>static bool simplifySwitchOfCmpIntrinsic (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; SI, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; Builder, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU)</>}
  labels = {["static"]}>
Fold switch over ucmp/scmp intrinsic to br if two of the switch arms have the same destination.

Definition at line <a href="#l07381">7381</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### simplifySwitchOfPowersOfTwo() {#adc11c5fbec9bf293b000637357da66e4}

<MemberDefinition
  prototype={<>static bool simplifySwitchOfPowersOfTwo (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; SI, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt; &amp; Builder, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
Tries to transform switch of powers of two to reduce switch range.

For example, switch like: switch (C) &#123; case 1: case 2: case 64: case 128: &#125; will be transformed to: switch (count&#95;trailing&#95;zeros(C)) &#123; case 0: case 1: case 6: case 7: &#125;

This transformation allows better lowering and could allow transforming into a lookup table.

Definition at line <a href="#l07313">7313</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### sinkCommonCodeFromPredecessors() {#a7da8333874d1ad28bd987d4e7c474e53}

<MemberDefinition
  prototype={<>static bool sinkCommonCodeFromPredecessors (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> whether BB&#39;s predecessors end with unconditional branches.

If it is true, sink any common code from the predecessors to BB.

Definition at line <a href="#l02442">2442</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### sinkLastInstruction() {#abf69483b802f1e342399912142341c60}

<MemberDefinition
  prototype={<>static void sinkLastInstruction (<a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; Blocks)</>}
  labels = {["static"]}>

Definition at line <a href="#l02345">2345</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### skippedInstrFlags() {#aa67a8bc0841ad57e26ed447bb99ea15d}

<MemberDefinition
  prototype={<>static unsigned skippedInstrFlags (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I)</>}
  labels = {["static"]}>

Definition at line <a href="#l01458">1458</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a2584054e6f103298b373933971ba043a}

<MemberDefinition
  prototype={<>STATISTIC (NumBitMaps, &quot;Number of switch <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> turned into bitmaps&quot;)</>}>

Definition at line <a href="#l00197">197</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ad06da0e96d7a2a4d6bb3feb5fd526659}

<MemberDefinition
  prototype={<>STATISTIC (NumLinearMaps, &quot;Number of switch <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> turned into linear mapping&quot;)</>}>

Definition at line <a href="#l00198">198</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a07de8e6e4b0f1b765d87d23ac481ed9c}

<MemberDefinition
  prototype={<>STATISTIC (NumLookupTables, &quot;Number of switch <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> turned into <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/gsym/inlineinfo-cpp/#a5db99f4b7f8744e0b1c8b50dba8ec5a2">lookup</a> tables&quot;)</>}>

Definition at line <a href="#l00200">200</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a10e5b4ab061061964a8ee9bdd135740d}

<MemberDefinition
  prototype={<>STATISTIC (NumLookupTablesHoles, &quot;Number of switch <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> turned into <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/gsym/inlineinfo-cpp/#a5db99f4b7f8744e0b1c8b50dba8ec5a2">lookup</a> tables (holes checked)&quot;)</>}>

Definition at line <a href="#l00202">202</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#afda497480c7b80935a03dc10e35e6720}

<MemberDefinition
  prototype={<>STATISTIC (NumTableCmpReuses, &quot;Number of reused switch table <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/gsym/inlineinfo-cpp/#a5db99f4b7f8744e0b1c8b50dba8ec5a2">lookup</a> compares&quot;)</>}>

Definition at line <a href="#l00205">205</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#abd947f60b34fd0d51dff4a603e2c4911}

<MemberDefinition
  prototype={<>STATISTIC (NumFoldValueComparisonIntoPredecessors, &quot;Number of value comparisons folded into predecessor basic blocks&quot;)</>}>

Definition at line <a href="#l00206">206</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a09df89d3f06016afc645940f8cec4188}

<MemberDefinition
  prototype={<>STATISTIC (NumFoldBranchToCommonDest, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/arc/arcbranchfinalize-cpp/#a14311558a7445776def2d5bc13161ba3">branches</a> folded into predecessor basic block&quot;)</>}>

Definition at line <a href="#l00208">208</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a3c3039a37824ae27819879004f1951dd}

<MemberDefinition
  prototype={<>STATISTIC (NumHoistCommonCode, &quot;Number of common instruction &#39;<a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp/#a6b480a971048f2d9cc342c18046d7774">blocks</a>&#39; hoisted up to the begin block&quot;)</>}>

Definition at line <a href="#l00210">210</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a607d6761635bfa081583159779e51bb8}

<MemberDefinition
  prototype={<>STATISTIC (NumHoistCommonInstrs, &quot;Number of common <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> hoisted up to the begin block&quot;)</>}>

Definition at line <a href="#l00213">213</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#abb20ec00f27f5c7f72fe1e0d1b3b04f5}

<MemberDefinition
  prototype={<>STATISTIC (NumSinkCommonCode, &quot;Number of common instruction &#39;<a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp/#a6b480a971048f2d9cc342c18046d7774">blocks</a>&#39; sunk down to the end block&quot;)</>}>

Definition at line <a href="#l00215">215</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a858341feba4cac053973cdd66125defc}

<MemberDefinition
  prototype={<>STATISTIC (NumSinkCommonInstrs, &quot;Number of common <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> sunk down to the end block&quot;)</>}>

Definition at line <a href="#l00217">217</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a2d98bfa47dabe9de17f8b2126fdfbd79}

<MemberDefinition
  prototype={<>STATISTIC (NumSpeculations, &quot;Number of speculative executed instructions&quot;)</>}>

Definition at line <a href="#l00219">219</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#affaf4a17c353673f09b5c56566ef08a2}

<MemberDefinition
  prototype={<>STATISTIC (NumInvokes, &quot;Number of invokes with empty resume <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp/#a6b480a971048f2d9cc342c18046d7774">blocks</a> simplified into calls&quot;)</>}>

Definition at line <a href="#l00220">220</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a93817c738869659b94158c32d1b35e8a}

<MemberDefinition
  prototype={<>STATISTIC (NumInvokesMerged, &quot;Number of invokes that were merged together&quot;)</>}>

Definition at line <a href="#l00222">222</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a0d4a52565b6d16f6c6fa743471e62002}

<MemberDefinition
  prototype={<>STATISTIC (NumInvokeSetsFormed, &quot;Number of invoke sets that were formed&quot;)</>}>

Definition at line <a href="#l00223">223</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### switchToLookupTable() {#a4abbfca67cb7fc77432aa8cd48af8b0a}

<MemberDefinition
  prototype={<>static bool switchToLookupTable (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; SI, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt; &amp; Builder, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
If the switch is only used to initialize one or more phi nodes in a common successor block with different constant values, replace the switch with lookup tables.

Definition at line <a href="#l06911">6911</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### trySwitchToSelect() {#a794d3a5f46134c24aade41b327d8418e}

<MemberDefinition
  prototype={<>static bool trySwitchToSelect (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42; SI, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt; &amp; Builder, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
If a switch is only used to initialize one or more phi nodes in a common successor block with only two different constant values, try to replace the switch with a select.

Returns true if the fold was made.

Definition at line <a href="#l06421">6421</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### tryToMergeLandingPad() {#a428f7b53e32934ae46a9aa35d3028d87}

<MemberDefinition
  prototype={<>static bool tryToMergeLandingPad (<a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &#42; LPad, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU)</>}
  labels = {["static"]}>
Given an block with only a single landing pad and a unconditional branch try to find another basic block which this one can be merged with.

This handles cases where we have multiple invokes with unique landing pads, but a shared handler.

We specifically choose to not worry about merging non-empty blocks here. That is a PRE/scheduling problem and is best solved elsewhere. In practice, the optimizer produces empty landing pad blocks quite frequently when dealing with exception dense code. (see: instcombine, gvn, if-else sinking in this file)

This is primarily a code size optimization. We need to avoid performing any transform which might inhibit optimization (such as our ability to specialize a particular handler via tail commoning). We do this by not merging any blocks which require us to introduce a phi. Since the same values are flowing through both blocks, we don&#39;t lose any ability to specialize. If anything, we make such specialization more likely.

TODO - This transformation could remove entries from a phi in the target block when the inputs in the phi are the same for the two blocks being merged. In some cases, this could result in removal of the PHI entirely.

Definition at line <a href="#l07805">7805</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### tryWidenCondBranchToCondBranch() {#ad98f06eded5a01ee8704f7d7d9ca4c5b}

<MemberDefinition
  prototype={<>static bool tryWidenCondBranchToCondBranch (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; PBI, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42; DTU)</>}
  labels = {["static"]}>
If the previous block ended with a widenable branch, determine if reusing the target block is profitable and legal.

This will have the effect of &quot;widening&quot; PBI, but doesn&#39;t require us to reason about hosting safety.

Definition at line <a href="#l04587">4587</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### validateAndCostRequiredSelects() {#a0b4c48d53ab1ddc5bf009cd4ddffdc5a}

<MemberDefinition
  prototype={<>static bool validateAndCostRequiredSelects (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; ThenBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; EndBB, unsigned &amp; SpeculatedInstructions, <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> &amp; Cost, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
Estimate the cost of the insertion(s) and check that the PHI nodes can be converted to selects.

Definition at line <a href="#l03141">3141</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### validLookupTableConstant() {#a05c11986a2c95c43b7a1ae03b7f88d1d}

<MemberDefinition
  prototype={<>static bool validLookupTableConstant (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42; C, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
Return true if the backend will be able to handle initializing an array of constants like C.

Definition at line <a href="#l06093">6093</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### valuesOverlap() {#a159c35fe8089d7348efef90d098aecbe}

<MemberDefinition
  prototype={<>static bool valuesOverlap (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; ValueEqualityComparisonCase &gt; &amp; C1, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; ValueEqualityComparisonCase &gt; &amp; C2)</>}
  labels = {["static"]}>
Return true if there are any keys in C1 that exist in C2 as well.

Definition at line <a href="#l00840">840</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### BranchFoldThreshold {#a79acde6fd121317486a8a70fbc1e0c14}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; BranchFoldThreshold(&quot;simplifycfg-branch-fold-threshold&quot;, cl::Hidden, cl::init(2), cl::desc(&quot;Maximum cost of combining conditions when &quot; &quot;folding branches&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00177">177</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### BranchFoldToCommonDestVectorMultiplier {#aebaf393c898e387f182c798412f13622}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; BranchFoldToCommonDestVectorMultiplier(&quot;simplifycfg-branch-fold-common-dest-vector-multiplier&quot;, cl::Hidden, cl::init(2), cl::desc(&quot;Multiplier to apply to threshold when determining whether or not &quot; &quot;to fold branch to common destination when vector operations are &quot; &quot;present&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00182">182</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### EnableMergeCompatibleInvokes {#a763f9b0b99f42804e6ab2d09ebc395a1}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableMergeCompatibleInvokes(&quot;simplifycfg-merge-compatible-invokes&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow SimplifyCFG to merge invokes together when appropriate&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00189">189</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### HoistCommon {#a8e8073e7ef8737b21cdf98608bbd17b9}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; HoistCommon(&quot;simplifycfg-hoist-common&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Hoist common instructions up to the parent block&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00119">119</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### HoistCommonSkipLimit {#aedd87113e9f2b7035fb15c4aeadbbd98}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; HoistCommonSkipLimit(&quot;simplifycfg-hoist-common-skip-limit&quot;, cl::Hidden, cl::init(20), cl::desc(&quot;Allow reordering across at most this many &quot; &quot;instructions when hoisting&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00135">135</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### HoistCondStores {#a96d7d928b8da0aaa8a366c8a36a16b89}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; HoistCondStores(&quot;simplifycfg-hoist-cond-stores&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Hoist conditional stores if an unconditional store precedes&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00144">144</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### HoistLoadsStoresWithCondFaulting {#a004c0d539d69756950a2dcd676799e0c}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; HoistLoadsStoresWithCondFaulting(&quot;simplifycfg-hoist-loads-stores-with-cond-faulting&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Hoist loads/stores if the target supports &quot; &quot;conditional faulting&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00122">122</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### HoistLoadsStoresWithCondFaultingThreshold {#afcc2d83294ce3af8abbfda0a3ea248ea}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; HoistLoadsStoresWithCondFaultingThreshold(&quot;hoist-loads-stores-with-cond-faulting-threshold&quot;, cl::Hidden, cl::init(6), cl::desc(&quot;Control the maximal conditional load/store that we are willing &quot; &quot;to speculatively execute to eliminate conditional branch &quot; &quot;(default = 6)&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00128">128</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### MaxSmallBlockSize {#a47aef60715560eb30f15d8c2edc4cae7}

<MemberDefinition
  prototype={<>cl::opt&lt; int &gt; MaxSmallBlockSize(&quot;simplifycfg-max-small-block-size&quot;, cl::Hidden, cl::init(10), cl::desc(&quot;Max size of a block which is still considered &quot; &quot;small enough to thread through&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00170">170</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### MaxSpeculationDepth {#a1b01002cae53d61fdfeba33d27907dfb}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxSpeculationDepth(&quot;max-speculation-depth&quot;, cl::Hidden, cl::init(10), cl::desc(&quot;Limit maximum recursion depth when calculating costs of &quot; &quot;speculatively executed instructions&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00164">164</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### MaxSwitchCasesPerResult {#a25dbc1cc43ca0c2fa252ddd0255f86cf}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxSwitchCasesPerResult(&quot;max-switch-cases-per-result&quot;, cl::Hidden, cl::init(16), cl::desc(&quot;Limit cases to analyze when converting a switch to select&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00193">193</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### MergeCondStores {#ae848c33bb9817bf71288c58eb68f0e11}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; MergeCondStores(&quot;simplifycfg-merge-cond-stores&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Hoist conditional stores even if an unconditional store does not &quot; &quot;precede - hoist multiple conditional stores into a single &quot; &quot;predicated store&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00148">148</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### MergeCondStoresAggressively {#a3caffa5cefe8399ed3efb62e834b1528}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; MergeCondStoresAggressively(&quot;simplifycfg-merge-cond-stores-aggressively&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;When merging conditional stores, do so even if the resultant &quot; &quot;basic blocks are unlikely to be if-converted as a result&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00154">154</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### PHINodeFoldingThreshold {#af03cfeeab17b16ab9c47da7686f9f632}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; PHINodeFoldingThreshold(&quot;phi-node-folding-threshold&quot;, cl::Hidden, cl::init(2), cl::desc( &quot;Control the amount of phi node folding to perform (default = 2)&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00107">107</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### SinkCommon {#a0cca1e07e2a0f1f96f02d60bc5cb7a88}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; SinkCommon(&quot;simplifycfg-sink-common&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Sink common instructions down to the end block&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00141">141</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### SpeculateOneExpensiveInst {#a43eed4d9c3854b2af5336428e83359d4}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; SpeculateOneExpensiveInst(&quot;speculate-one-expensive-inst&quot;, cl::Hidden, cl::init(true), cl::desc(&quot;Allow exactly one expensive instruction to be speculatively &quot; &quot;executed&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00159">159</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

### TwoEntryPHINodeFoldingThreshold {#a4060584a976cdd9ab251ce690690796c}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; TwoEntryPHINodeFoldingThreshold(&quot;two-entry-phi-node-folding-threshold&quot;, cl::Hidden, cl::init(4), cl::desc(&quot;Control the maximal total instruction cost that we are willing &quot; &quot;to speculatively execute to fold a 2-entry PHI node into a &quot; &quot;select (default = 4)&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00112">112</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;simplifycfg&quot;</>}>

Definition at line <a href="#l00094">94</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifycfg-cpp">SimplifyCFG.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- SimplifyCFG.cpp - Code to perform CFG simplification ---------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// Peephole optimize the CFG.</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h">llvm/ADT/APInt.h</a>&quot;</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h">llvm/ADT/MapVector.h</a>&quot;</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/sequence-h">llvm/ADT/Sequence.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setoperations-h">llvm/ADT/SetOperations.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h">llvm/ADT/StringRef.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h">llvm/Analysis/AssumptionCache.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/capturetracking-h">llvm/Analysis/CaptureTracking.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/constantfolding-h">llvm/Analysis/ConstantFolding.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/domtreeupdater-h">llvm/Analysis/DomTreeUpdater.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/guardutils-h">llvm/Analysis/GuardUtils.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/instructionsimplify-h">llvm/Analysis/InstructionSimplify.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loads-h">llvm/Analysis/Loads.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssa-h">llvm/Analysis/MemorySSA.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssaupdater-h">llvm/Analysis/MemorySSAUpdater.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h">llvm/IR/Attributes.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h">llvm/IR/CFG.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constantrange-h">llvm/IR/ConstantRange.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h">llvm/IR/GlobalValue.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h">llvm/IR/GlobalVariable.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h">llvm/IR/MDBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/memorymodelrelaxationannotations-h">llvm/IR/MemoryModelRelaxationAnnotations.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h">llvm/IR/Metadata.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/nofolder-h">llvm/IR/NoFolder.h</a>&quot;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h">llvm/IR/Operator.h</a>&quot;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h">llvm/IR/ProfDataUtils.h</a>&quot;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/use-h">llvm/IR/Use.h</a>&quot;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h">llvm/IR/ValueHandle.h</a>&quot;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h">llvm/Support/BranchProbability.h</a>&quot;</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/knownbits-h">llvm/Support/KnownBits.h</a>&quot;</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/mathextras-h">llvm/Support/MathExtras.h</a>&quot;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/valuemapper-h">llvm/Transforms/Utils/ValueMapper.h</a>&quot;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightPreprocessor">#include &lt;algorithm&gt;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightPreprocessor">#include &lt;climits&gt;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightPreprocessor">#include &lt;cstddef&gt;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightPreprocessor">#include &lt;cstdint&gt;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightPreprocessor">#include &lt;iterator&gt;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightPreprocessor">#include &lt;map&gt;</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightPreprocessor">#include &lt;optional&gt;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlightPreprocessor">#include &lt;set&gt;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlightPreprocessor">#include &lt;tuple&gt;</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlightPreprocessor">#include &lt;vector&gt;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;simplifycfg&quot;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#a967725b39b57414036183e1384497b22">llvm::RequireAndPreserveDomTree</a>(</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;simplifycfg-require-and-preserve-domtree&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Temporary development switch used to gradually uplift SimplifyCFG &quot;</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;into preserving DomTree,&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlightComment">// Chosen as 2 so as to be cheap, but still to have enough power to fold</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlightComment">// a select, so the &quot;clamp&quot; idiom (of a min followed by a max) will be caught.</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlightComment">// To catch this, we need to fold a compare and a select, hence &#39;2&#39; being the</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlightComment">// minimum reasonable default.</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="#af03cfeeab17b16ab9c47da7686f9f632"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#af03cfeeab17b16ab9c47da7686f9f632">PHINodeFoldingThreshold</a>(</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;phi-node-folding-threshold&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(2),</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Control the amount of phi node folding to perform (default = 2)&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112" lineLink="#a4060584a976cdd9ab251ce690690796c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a4060584a976cdd9ab251ce690690796c">TwoEntryPHINodeFoldingThreshold</a>(</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;two-entry-phi-node-folding-threshold&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(4),</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Control the maximal total instruction cost that we are willing &quot;</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;to speculatively execute to fold a 2-entry PHI node into a &quot;</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;select (default = 4)&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119" lineLink="#a8e8073e7ef8737b21cdf98608bbd17b9"><span class="doxyHighlight">    <a href="#a8e8073e7ef8737b21cdf98608bbd17b9">HoistCommon</a>(</span><span class="doxyHighlightStringLiteral">&quot;simplifycfg-hoist-common&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlight">                <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Hoist common instructions up to the parent block&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122" lineLink="#a004c0d539d69756950a2dcd676799e0c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a004c0d539d69756950a2dcd676799e0c">HoistLoadsStoresWithCondFaulting</a>(</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;simplifycfg-hoist-loads-stores-with-cond-faulting&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Hoist loads/stores if the target supports &quot;</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;conditional faulting&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128" lineLink="#afcc2d83294ce3af8abbfda0a3ea248ea"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#afcc2d83294ce3af8abbfda0a3ea248ea">HoistLoadsStoresWithCondFaultingThreshold</a>(</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;hoist-loads-stores-with-cond-faulting-threshold&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(6),</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Control the maximal conditional load/store that we are willing &quot;</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;to speculatively execute to eliminate conditional branch &quot;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;(default = 6)&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a></span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135" lineLink="#aedd87113e9f2b7035fb15c4aeadbbd98"><span class="doxyHighlight">    <a href="#aedd87113e9f2b7035fb15c4aeadbbd98">HoistCommonSkipLimit</a>(</span><span class="doxyHighlightStringLiteral">&quot;simplifycfg-hoist-common-skip-limit&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">                         <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(20),</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">                         <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow reordering across at most this many &quot;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">                                  </span><span class="doxyHighlightStringLiteral">&quot;instructions when hoisting&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141" lineLink="#a0cca1e07e2a0f1f96f02d60bc5cb7a88"><span class="doxyHighlight">    <a href="#a0cca1e07e2a0f1f96f02d60bc5cb7a88">SinkCommon</a>(</span><span class="doxyHighlightStringLiteral">&quot;simplifycfg-sink-common&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">               <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Sink common instructions down to the end block&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144" lineLink="#a96d7d928b8da0aaa8a366c8a36a16b89"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a96d7d928b8da0aaa8a366c8a36a16b89">HoistCondStores</a>(</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;simplifycfg-hoist-cond-stores&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Hoist conditional stores if an unconditional store precedes&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148" lineLink="#ae848c33bb9817bf71288c58eb68f0e11"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#ae848c33bb9817bf71288c58eb68f0e11">MergeCondStores</a>(</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;simplifycfg-merge-cond-stores&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Hoist conditional stores even if an unconditional store does not &quot;</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;precede - hoist multiple conditional stores into a single &quot;</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;predicated store&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154" lineLink="#a3caffa5cefe8399ed3efb62e834b1528"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a3caffa5cefe8399ed3efb62e834b1528">MergeCondStoresAggressively</a>(</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;simplifycfg-merge-cond-stores-aggressively&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;When merging conditional stores, do so even if the resultant &quot;</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;basic blocks are unlikely to be if-converted as a result&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159" lineLink="#a43eed4d9c3854b2af5336428e83359d4"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a43eed4d9c3854b2af5336428e83359d4">SpeculateOneExpensiveInst</a>(</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;speculate-one-expensive-inst&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow exactly one expensive instruction to be speculatively &quot;</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;executed&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164" lineLink="#a1b01002cae53d61fdfeba33d27907dfb"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a1b01002cae53d61fdfeba33d27907dfb">MaxSpeculationDepth</a>(</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;max-speculation-depth&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(10),</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Limit maximum recursion depth when calculating costs of &quot;</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;speculatively executed instructions&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;int&gt;</a></span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170" lineLink="#a47aef60715560eb30f15d8c2edc4cae7"><span class="doxyHighlight">    <a href="#a47aef60715560eb30f15d8c2edc4cae7">MaxSmallBlockSize</a>(</span><span class="doxyHighlightStringLiteral">&quot;simplifycfg-max-small-block-size&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">                      <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(10),</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">                      <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Max size of a block which is still considered &quot;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">                               </span><span class="doxyHighlightStringLiteral">&quot;small enough to thread through&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlightComment">// Two is chosen to allow one negation and a logical combine.</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a></span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177" lineLink="#a79acde6fd121317486a8a70fbc1e0c14"><span class="doxyHighlight">    <a href="#a79acde6fd121317486a8a70fbc1e0c14">BranchFoldThreshold</a>(</span><span class="doxyHighlightStringLiteral">&quot;simplifycfg-branch-fold-threshold&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">                        <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(2),</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">                        <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Maximum cost of combining conditions when &quot;</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">                                 </span><span class="doxyHighlightStringLiteral">&quot;folding branches&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182" lineLink="#aebaf393c898e387f182c798412f13622"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#aebaf393c898e387f182c798412f13622">BranchFoldToCommonDestVectorMultiplier</a>(</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;simplifycfg-branch-fold-common-dest-vector-multiplier&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(2),</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Multiplier to apply to threshold when determining whether or not &quot;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;to fold branch to common destination when vector operations are &quot;</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;present&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189" lineLink="#a763f9b0b99f42804e6ab2d09ebc395a1"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a763f9b0b99f42804e6ab2d09ebc395a1">EnableMergeCompatibleInvokes</a>(</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;simplifycfg-merge-compatible-invokes&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow SimplifyCFG to merge invokes together when appropriate&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193" lineLink="#a25dbc1cc43ca0c2fa252ddd0255f86cf"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a25dbc1cc43ca0c2fa252ddd0255f86cf">MaxSwitchCasesPerResult</a>(</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;max-switch-cases-per-result&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(16),</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Limit cases to analyze when converting a switch to select&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197" lineLink="#a2584054e6f103298b373933971ba043a"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumBitMaps, </span><span class="doxyHighlightStringLiteral">&quot;Number of switch instructions turned into bitmaps&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198" lineLink="#ad06da0e96d7a2a4d6bb3feb5fd526659"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumLinearMaps,</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of switch instructions turned into linear mapping&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200" lineLink="#a07de8e6e4b0f1b765d87d23ac481ed9c"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumLookupTables,</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of switch instructions turned into lookup tables&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202" lineLink="#a10e5b4ab061061964a8ee9bdd135740d"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">    NumLookupTablesHoles,</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;Number of switch instructions turned into lookup tables (holes checked)&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205" lineLink="#afda497480c7b80935a03dc10e35e6720"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumTableCmpReuses, </span><span class="doxyHighlightStringLiteral">&quot;Number of reused switch table lookup compares&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206" lineLink="#abd947f60b34fd0d51dff4a603e2c4911"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumFoldValueComparisonIntoPredecessors,</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of value comparisons folded into predecessor basic blocks&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208" lineLink="#a09df89d3f06016afc645940f8cec4188"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumFoldBranchToCommonDest,</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of branches folded into predecessor basic block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210" lineLink="#a3c3039a37824ae27819879004f1951dd"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">    NumHoistCommonCode,</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;Number of common instruction &#39;blocks&#39; hoisted up to the begin block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213" lineLink="#a607d6761635bfa081583159779e51bb8"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumHoistCommonInstrs,</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of common instructions hoisted up to the begin block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215" lineLink="#abb20ec00f27f5c7f72fe1e0d1b3b04f5"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSinkCommonCode,</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of common instruction &#39;blocks&#39; sunk down to the end block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217" lineLink="#a858341feba4cac053973cdd66125defc"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSinkCommonInstrs,</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of common instructions sunk down to the end block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219" lineLink="#a2d98bfa47dabe9de17f8b2126fdfbd79"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSpeculations, </span><span class="doxyHighlightStringLiteral">&quot;Number of speculative executed instructions&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220" lineLink="#affaf4a17c353673f09b5c56566ef08a2"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumInvokes,</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of invokes with empty resume blocks simplified into calls&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222" lineLink="#a93817c738869659b94158c32d1b35e8a"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumInvokesMerged, </span><span class="doxyHighlightStringLiteral">&quot;Number of invokes that were merged together&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223" lineLink="#a0d4a52565b6d16f6c6fa743471e62002"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumInvokeSetsFormed, </span><span class="doxyHighlightStringLiteral">&quot;Number of invoke sets that were formed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225" lineLink="/docs/api/namespaces/anonymous-simplifycfg-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlightComment">// The first field contains the value that the switch produces when a certain</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlightComment">// case group is selected, and the second field is a vector containing the</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlightComment">// cases composing the case group.</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230" lineLink="/docs/api/namespaces/anonymous-simplifycfg-cpp-/#acc1b2160383f472d108b5eaa86ca3b23"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-simplifycfg-cpp-/#acc1b2160383f472d108b5eaa86ca3b23">SwitchCaseResultVectorTy</a> =</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;Constant &#42;, SmallVector&lt;ConstantInt &#42;, 4&gt;</a>&gt;, 2&gt;;</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlightComment">// The first field contains the phi node that generates a result of the switch</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlightComment">// and the second field contains the value generated for a certain case in the</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlightComment">// switch for that PHI.</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236" lineLink="/docs/api/namespaces/anonymous-simplifycfg-cpp-/#a52b27f5246c1976536740d7fdaeefe0e"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-simplifycfg-cpp-/#a52b27f5246c1976536740d7fdaeefe0e">SwitchCaseResultsTy</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;PHINode &#42;, Constant &#42;&gt;</a>, 4&gt;;</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlightComment">/// ValueEqualityComparisonCase - Represents a case of a switch.</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6b935cc2b06bb94c85ad18681414e1e8">ValueEqualityComparisonCase</a> &#123;</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a98c4698c87ab764e96adc93a80f46c87"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a98c4698c87ab764e96adc93a80f46c87">Value</a>;</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6ba0e937fa0ed27cb0278db8cbc46648"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6ba0e937fa0ed27cb0278db8cbc46648">Dest</a>;</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6b935cc2b06bb94c85ad18681414e1e8"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6b935cc2b06bb94c85ad18681414e1e8">ValueEqualityComparisonCase</a>(<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a98c4698c87ab764e96adc93a80f46c87">Value</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6ba0e937fa0ed27cb0278db8cbc46648">Dest</a>)</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">      : <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a98c4698c87ab764e96adc93a80f46c87">Value</a>(<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a98c4698c87ab764e96adc93a80f46c87">Value</a>), <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6ba0e937fa0ed27cb0278db8cbc46648">Dest</a>(<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6ba0e937fa0ed27cb0278db8cbc46648">Dest</a>) &#123;&#125;</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#abe2eb42530edb66efe5ae339eea73903"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#abe2eb42530edb66efe5ae339eea73903">operator&lt;</a>(<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6b935cc2b06bb94c85ad18681414e1e8">ValueEqualityComparisonCase</a> RHS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Comparing pointers is ok as we only rely on the order for uniquing.</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a98c4698c87ab764e96adc93a80f46c87">Value</a> &lt; RHS.Value;</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a83cca3e08c2faab34ac6657b3f12b121"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a83cca3e08c2faab34ac6657b3f12b121">operator==</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;RHSDest)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6ba0e937fa0ed27cb0278db8cbc46648">Dest</a> == RHSDest; &#125;</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a5d499c25e889b8f1b09536dacabf828d">SimplifyCFGOpt</a> &#123;</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;TTI;</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU;</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL;</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;WeakVH&gt;</a> LoopHeaders;</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/simplifycfgoptions">SimplifyCFGOptions</a> &amp;Options;</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Resimplify;</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;isValueEqualityComparison(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI);</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;getValueEqualityComparisonCases(</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI, std::vector&lt;ValueEqualityComparisonCase&gt; &amp;Cases);</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyEqualityComparisonWithOnlyPredecessor(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI,</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred,</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder);</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> performValueComparisonIntoPredecessorFolding(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;CV,</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">                                                    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PTI,</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">                                                    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder);</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> foldValueComparisonIntoPredecessors(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI,</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder);</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyResume(<a href="/docs/api/classes/llvm/resumeinst">ResumeInst</a> &#42;RI, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder);</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifySingleResume(<a href="/docs/api/classes/llvm/resumeinst">ResumeInst</a> &#42;RI);</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyCommonResume(<a href="/docs/api/classes/llvm/resumeinst">ResumeInst</a> &#42;RI);</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyCleanupReturn(<a href="/docs/api/classes/llvm/cleanupreturninst">CleanupReturnInst</a> &#42;RI);</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyUnreachable(<a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a> &#42;UI);</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifySwitch(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder);</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyDuplicateSwitchArms(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU);</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyIndirectBr(<a href="/docs/api/classes/llvm/indirectbrinst">IndirectBrInst</a> &#42;IBI);</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyBranch(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;Branch, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder);</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyUncondBranch(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder);</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyCondBranch(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder);</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> tryToSimplifyUncondBranchWithICmpInIt(<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICI,</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder);</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> hoistCommonCodeFromSuccessors(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllInstsEqOnly);</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> hoistSuccIdenticalTerminatorToSwitchOrIf(</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I1,</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;OtherSuccTIs);</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> speculativelyExecuteBB(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ThenBB);</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyTerminatorOnSelect(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OldTerm, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>,</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FalseBB,</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">                                  uint32&#95;t TrueWeight, uint32&#95;t FalseWeight);</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyBranchOnICmpChain(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder,</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL);</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifySwitchOnSelect(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>);</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyIndirectBrOnSelect(<a href="/docs/api/classes/llvm/indirectbrinst">IndirectBrInst</a> &#42;IBI, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> turnSwitchRangeIntoICmp(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder);</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a5d499c25e889b8f1b09536dacabf828d"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a5d499c25e889b8f1b09536dacabf828d">SimplifyCFGOpt</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;TTI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU,</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;WeakVH&gt;</a> LoopHeaders,</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/simplifycfgoptions">SimplifyCFGOptions</a> &amp;Opts)</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">      : TTI(TTI), DTU(DTU), DL(DL), LoopHeaders(LoopHeaders), Options(Opts) &#123;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!DTU || !DTU-&gt;hasPostDomTree()) &amp;&amp;</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;SimplifyCFG is not yet capable of maintaining validity of a &quot;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;PostDomTree, so don&#39;t ask for it.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> simplifyOnce(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB);</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> run(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB);</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Helper to set Resimplify and return change indication.</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>() &#123;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">    Resimplify = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlightComment">/// Return true if all the PHI nodes in the basic block \\p BB</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlightComment">/// receive compatible (identical) incoming values when coming from</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlightComment">/// all of the predecessor blocks that are specified in \\p IncomingBlocks.</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlightComment">/// Note that if the values aren&#39;t exactly identical, but \\p EquivalenceSet</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlightComment">/// is provided, and &#42;both&#42; of the values are present in the set,</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlightComment">/// then they are considered equal.</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332" lineLink="#a7851d1e39cf3c6f27aa6fe911056a142"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a7851d1e39cf3c6f27aa6fe911056a142">incomingValuesAreCompatible</a>(</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;BasicBlock &#42;&gt;</a> IncomingBlocks,</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;Value &#42;&gt;</a> &#42;EquivalenceSet = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IncomingBlocks.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2 &amp;&amp;</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Only for a pair of incoming blocks at the time!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: it is okay if one of the incoming values is an &#96;undef&#96; value,</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        iff the other incoming value is guaranteed to be a non-poison value.</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: it is okay if one of the incoming values is a &#96;poison&#96; value.</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>(), &#91;IncomingBlocks, EquivalenceSet&#93;(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN) &#123;</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">    Value &#42;IV0 = PN.getIncomingValueForBlock(IncomingBlocks&#91;0&#93;);</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">    Value &#42;IV1 = PN.getIncomingValueForBlock(IncomingBlocks&#91;1&#93;);</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">    if (IV0 == IV1)</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">      return true;</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">    if (EquivalenceSet &amp;&amp; EquivalenceSet-&gt;contains(IV0) &amp;&amp;</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">        EquivalenceSet-&gt;contains(IV1))</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">      return true;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">    return false;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlightComment">/// Return true if it is safe to merge these two</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlightComment">/// terminator instructions together.</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356" lineLink="#a6b537c9f5fe8ee7d5950f9984fa5010a"><span class="doxyHighlight"><a href="#a6b537c9f5fe8ee7d5950f9984fa5010a">safeToMergeTerminators</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;SI1, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;SI2,</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;BasicBlock &#42;, 4&gt;</a> &#42;FailBlocks = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SI1 == SI2)</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Can&#39;t merge with self!</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is not safe to merge these two switch instructions if they have a common</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// successor, and if that successor has a PHI node, and if &#42;that&#42; PHI node has</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// conflicting incoming values from the two switch blocks.</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SI1BB = SI1-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SI2BB = SI2-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 16&gt;</a> SI1Succs(<a href="/docs/api/namespaces/llvm/#a9aa408bc83db2292cc1a57a3e6b206c2">succ&#95;begin</a>(SI1BB), <a href="/docs/api/namespaces/llvm/#aa5684e4976198c1b64b694d3972ddf78">succ&#95;end</a>(SI1BB));</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#aae15979c93f7f0929116b975b5c46cd6">Fail</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(SI2BB)) &#123;</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SI1Succs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(Succ))</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a7851d1e39cf3c6f27aa6fe911056a142">incomingValuesAreCompatible</a>(Succ, &#123;SI1BB, SI2BB&#125;))</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#aae15979c93f7f0929116b975b5c46cd6">Fail</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FailBlocks)</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">      FailBlocks-&gt;insert(Succ);</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#aae15979c93f7f0929116b975b5c46cd6">Fail</a>;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlightComment">/// Update PHI nodes in Succ to indicate that there will now be entries in it</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlightComment">/// from the &#39;NewPred&#39; block. The values that will be flowing into the PHI nodes</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlightComment">/// will be the same as those coming in from ExistPred, an existing predecessor</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlightComment">/// of Succ.</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388" lineLink="#a0375fe3378c23272b805320851744043"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a0375fe3378c23272b805320851744043">addPredecessorToBlock</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewPred,</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExistPred,</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &#42;MSSAU = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>())</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">    PN.addIncoming(PN.getIncomingValueForBlock(ExistPred), NewPred);</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MSSAU)</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MPhi = MSSAU-&gt;getMemorySSA()-&gt;getMemoryAccess(Succ))</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">      MPhi-&gt;addIncoming(MPhi-&gt;getIncomingValueForBlock(ExistPred), NewPred);</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlightComment">/// Compute an abstract &quot;cost&quot; of speculating the given instruction,</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlightComment">/// which is assumed to be safe to speculate. TCC&#95;Free means cheap,</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlightComment">/// TCC&#95;Basic means less cheap, and TCC&#95;Expensive means prohibitively</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlightComment">/// expensive.</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402" lineLink="#a9ac94808486f1c47e5cc9ba62dcc6fae"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="#a9ac94808486f1c47e5cc9ba62dcc6fae">computeSpeculationCost</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">                                              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getInstructionCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>);</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlightComment">/// If we have a merge point of an &quot;if condition&quot; as accepted above,</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlightComment">/// return true if the specified value dominates the block.  We don&#39;t handle</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlightComment">/// the true generality of domination here, just a special case which works</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlightComment">/// well enough for us.</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlightComment">/// If AggressiveInsts is non-null, and if V does not dominate BB, we check to</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlightComment">/// see if V (which must be an instruction) and its recursive operands</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlightComment">/// that do not dominate BB have a combined cost lower than Budget and</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlightComment">/// are non-trapping.  If both are true, the instruction is inserted into the</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlightComment">/// set and true is returned.</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlightComment">/// The cost for most non-trapping instructions is defined as 1 except for</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlightComment">/// Select whose cost is 2</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlightComment">/// After this function returns, Cost is increased by the cost of</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlightComment">/// V plus its non-dominating operands.  If that cost is greater than</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlightComment">/// Budget, false is returned and Cost is undefined.</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424" lineLink="#af67eef9e8d101756a1a0164e63eb4556"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#af67eef9e8d101756a1a0164e63eb4556">dominatesMergePoint</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt,</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;Instruction &#42;&gt;</a> &amp;AggressiveInsts,</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> &amp;<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>, <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> Budget,</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> = 0) &#123;</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is possible to hit a zero-cost cycle (phi/gep instructions for example),</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so limit the recursion depth.</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: While this recursion limit does prevent pathological behavior, it</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// would be better to track visited instructions to avoid cycles.</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> == <a href="#a1b01002cae53d61fdfeba33d27907dfb">MaxSpeculationDepth</a>)</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Non-instructions dominate all instructions and can be executed</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// unconditionally.</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PBB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We don&#39;t want to allow weird loops that might have the &quot;if condition&quot; in</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the bottom of this block.</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBB == BB)</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this instruction is defined in a block that contains an unconditional</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branch to BB, then it must be in the &#39;conditional&#39; part of the &quot;if</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// statement&quot;.  If not, it definitely dominates the region.</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI || BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() || BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != BB)</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have seen this instruction before, don&#39;t count it again.</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AggressiveInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, it looks like the instruction IS in the &quot;condition&quot;.  Check to</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// see if it&#39;s a cheap instruction to unconditionally compute, and if it</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// only uses stuff defined outside of the condition.  If so, hoist it out.</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, InsertPt, AC))</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="#a9ac94808486f1c47e5cc9ba62dcc6fae">computeSpeculationCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Allow exactly one instruction to be speculated regardless of its cost</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (as long as it is safe to do so).</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is intended to flatten the CFG even if the instruction is a division</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or other expensive operation. The speculation of an expensive instruction</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is expected to be undone in CodeGenPrepare if the speculation has not</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// enabled further IR optimizations.</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> &gt; Budget &amp;&amp;</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">      (!<a href="#a43eed4d9c3854b2af5336428e83359d4">SpeculateOneExpensiveInst</a> || !AggressiveInsts.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#af8a50544090e81ac83601aff8f4b0142">empty</a>() || <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> &gt; 0 ||</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">       !<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>.isValid()))</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, we can only really hoist these out if their operands do</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// not take us over the cost threshold.</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#af67eef9e8d101756a1a0164e63eb4556">dominatesMergePoint</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, BB, InsertPt, AggressiveInsts, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>, Budget,</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">                             <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, AC, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06afe578efb7ca235af77fb0eef7edcf639">Depth</a> + 1))</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, it&#39;s safe to do this!  Remember this instruction.</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">  AggressiveInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlightComment">/// Extract ConstantInt from value, looking through IntToPtr</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlightComment">/// and PointerNullValue. Return NULL if value is not a constant int.</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492" lineLink="#a3abb1cc80a02ab7f543ff2d98987e121"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="#a3abb1cc80a02ab7f543ff2d98987e121">getConstantInt</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Normal constant int.</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(V);</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V) || !V-&gt;getType()-&gt;isPointerTy() ||</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isNonIntegralPointerType(V-&gt;getType()))</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CI;</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is some kind of pointer constant. Turn it into a pointer-sized</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ConstantInt if possible.</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;PtrTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(V-&gt;getType()));</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Null pointer means 0, see SelectionDAGBuilder::getValue(const Value&#42;).</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(V))</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ConstantInt::get(PtrTy, 0);</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// IntToPtr const int.</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantexpr">ConstantExpr</a> &#42;CE = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantExpr&gt;</a>(V))</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CE-&gt;getOpcode() == Instruction::IntToPtr)</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(CE-&gt;getOperand(0))) &#123;</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The constant is very likely to have the right type already.</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == PtrTy)</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CI;</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#ae45c454aff5d0478a70219bb15d369b3">ConstantFoldIntegerCast</a>(CI, PtrTy, </span><span class="doxyHighlightComment">/&#42;isSigned=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>));</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlightComment">/// Given a chain of or (||) or and (&amp;&amp;) comparison of a value against a</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlightComment">/// constant, this will try to recover the information required for a switch</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlightComment">/// structure.</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlightComment">/// It will depth-first traverse the chain of comparison, seeking for patterns</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlightComment">/// like %a == 12 or %a &lt; 4 and combine them to produce a set of integer</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlightComment">/// representing the different cases for the switch.</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlightComment">/// Note that if the chain is composed of &#39;||&#39; it will build the set of elements</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlightComment">/// that matches the comparisons (i.e. any of this value validate the chain)</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlightComment">/// while for a chain of &#39;&amp;&amp;&#39; it will build the set elements that make the test</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlightComment">/// fail.</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a2d4d63c7f5734e71bb5bcf6fd36d6888">ConstantComparesGatherer</a> &#123;</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ab91c0864780d3ac43fdeb39b7034bdaf"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ab91c0864780d3ac43fdeb39b7034bdaf">DL</a>;</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlightComment">  /// Value found for the switch comparison</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a0672c6aca6021dfa9e5b6823a760db78"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a0672c6aca6021dfa9e5b6823a760db78">CompValue</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlightComment">  /// Extra clause to be checked before the switch</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a31bb30d8d4ac7d1f8c1a431e1cd86ba3"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a31bb30d8d4ac7d1f8c1a431e1cd86ba3">Extra</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlightComment">  /// Set of integers to match in switch</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ab3a44fdc0389349f3026138888096e44"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ConstantInt &#42;, 8&gt;</a> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ab3a44fdc0389349f3026138888096e44">Vals</a>;</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlightComment">  /// Number of comparisons matched in the and/or chain</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a3b3100c0f9b21e01920825332cfb7a30"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a3b3100c0f9b21e01920825332cfb7a30">UsedICmps</a> = 0;</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlightComment">  /// Construct and compute the result for the comparison instruction Cond</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a2d4d63c7f5734e71bb5bcf6fd36d6888"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a2d4d63c7f5734e71bb5bcf6fd36d6888">ConstantComparesGatherer</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ab91c0864780d3ac43fdeb39b7034bdaf">DL</a>) : <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ab91c0864780d3ac43fdeb39b7034bdaf">DL</a>(<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ab91c0864780d3ac43fdeb39b7034bdaf">DL</a>) &#123;</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">    gather(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ad5d8c53a3fad18a7b6aa8c97f749d182"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ad5d8c53a3fad18a7b6aa8c97f749d182">ConstantComparesGatherer</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a2d4d63c7f5734e71bb5bcf6fd36d6888">ConstantComparesGatherer</a> &amp;) = </span><span class="doxyHighlightKeyword">delete</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a2d4d63c7f5734e71bb5bcf6fd36d6888">ConstantComparesGatherer</a> &amp;</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a9f989d1a296fca1993e32bf1d99de2fa"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a9f989d1a296fca1993e32bf1d99de2fa">operator=</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a2d4d63c7f5734e71bb5bcf6fd36d6888">ConstantComparesGatherer</a> &amp;) = </span><span class="doxyHighlightKeyword">delete</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlightComment">  /// Try to set the current value used for the comparison, it succeeds only if</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlightComment">  /// it wasn&#39;t set before or if the new value is the same as the old one</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> setValueOnce(<a href="/docs/api/classes/llvm/value">Value</a> &#42;NewVal) &#123;</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a0672c6aca6021dfa9e5b6823a760db78">CompValue</a> &amp;&amp; <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a0672c6aca6021dfa9e5b6823a760db78">CompValue</a> != NewVal)</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a0672c6aca6021dfa9e5b6823a760db78">CompValue</a> = NewVal;</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a0672c6aca6021dfa9e5b6823a760db78">CompValue</a> != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlightComment">  /// Try to match Instruction &quot;I&quot; as a comparison against a constant and</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlightComment">  /// populates the array Vals with the set of values that match (or do not</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlightComment">  /// match depending on isEQ).</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlightComment">  /// Return false on failure. On success, the Value the comparison matched</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlightComment">  /// against is placed in CompValue.</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlightComment">  /// If CompValue is already set, the function is expected to fail if a match</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlightComment">  /// is found but the value compared to is different.</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> matchInstruction(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isEQ) &#123;</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is an icmp against a constant, handle this as one of the cases.</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICI;</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!((ICI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">          (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="#a3abb1cc80a02ab7f543ff2d98987e121">getConstantInt</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)))) &#123;</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHSVal;</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;RHSC;</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Pattern match a special case</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (x &amp; ~2^z) == y --&gt; x == y || x == y|2^z</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This undoes a transformation done by instcombine to fuse 2 compares.</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICI-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == (isEQ ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a> : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a>)) &#123;</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// It&#39;s a little bit hard to see why the following transformations are</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// correct. Here is a CVC3 program to verify them for 64-bit values:</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlightComment">         ONE  : BITVECTOR(64) = BVZEROEXTEND(0bin1, 63);</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlightComment">         x    : BITVECTOR(64);</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlightComment">         y    : BITVECTOR(64);</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlightComment">         z    : BITVECTOR(64);</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlightComment">         mask : BITVECTOR(64) = BVSHL(ONE, z);</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlightComment">         QUERY( (y &amp; ~mask = y) =&gt;</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlightComment">                ((x &amp; ~mask = y) &lt;=&gt; (x = y OR x = (y |  mask)))</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlightComment">         );</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlightComment">         QUERY( (y |  mask = y) =&gt;</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlightComment">                ((x |  mask = y) &lt;=&gt; (x = y OR x = (y &amp; ~mask)))</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlightComment">         );</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlightComment">      &#42;/</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Please note that each pattern must be a dual implication (&lt;--&gt; or</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// iff). One directional implication can create spurious matches. If the</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// implication is only one-way, an unsatisfiable condition on the left</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// side can imply a satisfiable condition on the right side. Dual</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// implication ensures that satisfiable conditions are transformed to</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// other satisfiable conditions and unsatisfiable conditions are</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// transformed to other unsatisfiable conditions.</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Here is a concrete example of a unsatisfiable condition on the left</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// implying a satisfiable condition on the right:</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// mask = (1 &lt;&lt; z)</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (x &amp; ~mask) == y  --&gt; (x == y || x == (y | mask))</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Substituting y = 3, z = 0 yields:</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (x &amp; -2) == 3 --&gt; (x == 3 || x == 2)</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Pattern match a special case:</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlightComment">        QUERY( (y &amp; ~mask = y) =&gt;</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlightComment">               ((x &amp; ~mask = y) &lt;=&gt; (x = y OR x = (y |  mask)))</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlightComment">        );</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlightComment">      &#42;/</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0),</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">                <a href="/docs/api/namespaces/llvm/patternmatch/#a014d851989a66ce781c4f89dfffb26b5">m&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(RHSVal), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(RHSC)))) &#123;</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/apint">APInt</a> Mask = ~&#42;RHSC;</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Mask.isPowerOf2() &amp;&amp; (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValue() &amp; ~Mask) == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValue()) &#123;</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If we already have a value for the switch, it has to match!</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!setValueOnce(RHSVal))</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">          Vals.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">          Vals.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">              ConstantInt::get(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getContext(),</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">                               <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValue() | Mask));</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">          UsedICmps++;</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Pattern match a special case:</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlightComment">        QUERY( (y |  mask = y) =&gt;</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlightComment">               ((x |  mask = y) &lt;=&gt; (x = y OR x = (y &amp; ~mask)))</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlightComment">        );</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlightComment">      &#42;/</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0),</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">                <a href="/docs/api/namespaces/llvm/patternmatch/#ae44af1eeb2e5f7a1973a4ab78963a503">m&#95;Or</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(RHSVal), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(RHSC)))) &#123;</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">        APInt <a href="/docs/api/namespaces/llvm/bitmaskenumdetail/#a4562904154aff9698a612bc7f6086a4c">Mask</a> = &#42;RHSC;</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/bitmaskenumdetail/#a4562904154aff9698a612bc7f6086a4c">Mask</a>.isPowerOf2() &amp;&amp; (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValue() | Mask) == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValue()) &#123;</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If we already have a value for the switch, it has to match!</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!setValueOnce(RHSVal))</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">          <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ab3a44fdc0389349f3026138888096e44">Vals</a>.push&#95;back(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">          <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ab3a44fdc0389349f3026138888096e44">Vals</a>.push&#95;back(ConstantInt::get(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getContext(),</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">                                          <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValue() &amp; ~Mask));</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">          <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a3b3100c0f9b21e01920825332cfb7a30">UsedICmps</a>++;</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we already have a value for the switch, it has to match!</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!setValueOnce(ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)))</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a3b3100c0f9b21e01920825332cfb7a30">UsedICmps</a>++;</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ab3a44fdc0389349f3026138888096e44">Vals</a>.push&#95;back(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have &quot;x ult 3&quot;, for example, then we can add 0,1,2 to the set.</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">    ConstantRange Span =</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constantrange/#aa89e9cec92a0b38d2f47a077bf12cc98">ConstantRange::makeExactICmpRegion</a>(ICI-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>(), <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValue());</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Shift the range if the compare is fed by an add. This is the range</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// compare idiom as emitted by instcombine.</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CandidateVal = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(RHSVal), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(RHSC)))) &#123;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">      Span = Span.<a href="/docs/api/classes/llvm/constantrange/#a1d29074c7a610816d4f328b7cd9b783d">subtract</a>(&#42;RHSC);</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">      CandidateVal = RHSVal;</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is an and/!= check, then we are looking to build the set of</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value that &#42;don&#39;t&#42; pass the and chain. I.e. to turn &quot;x ugt 2&quot; into</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// x != 0 &amp;&amp; x != 1</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isEQ)</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">      Span = Span.<a href="/docs/api/classes/llvm/constantrange/#aaaa2f5e2c6c3122d2b484f9e50950e18">inverse</a>();</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are a ton of values, we don&#39;t want to make a ginormous switch.</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Span.<a href="/docs/api/classes/llvm/constantrange/#a688f2c4ca99eb7f935cab42c4f6398e7">isSizeLargerThan</a>(8) || Span.<a href="/docs/api/classes/llvm/constantrange/#a5bd6d98b4a7ecc1dcdc571e4352fcc52">isEmptySet</a>()) &#123;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we already have a value for the switch, it has to match!</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!setValueOnce(CandidateVal))</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add all values from the range to the set</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (APInt Tmp = Span.<a href="/docs/api/classes/llvm/constantrange/#a23f4339e49343721146062b10c144052">getLower</a>(); Tmp != Span.<a href="/docs/api/classes/llvm/constantrange/#aa1955c426e1ff66455b4bb6657ee995d">getUpper</a>(); ++Tmp)</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#ab3a44fdc0389349f3026138888096e44">Vals</a>.push&#95;back(ConstantInt::get(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext(), Tmp));</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a3b3100c0f9b21e01920825332cfb7a30">UsedICmps</a>++;</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlightComment">  /// Given a potentially &#39;or&#39;d or &#39;and&#39;d together collection of icmp</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlightComment">  /// eq/ne/lt/gt instructions that compare a value against a constant, extract</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlightComment">  /// the value being compared, and stick the list constants into the Vals</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlightComment">  /// vector.</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlightComment">  /// One &quot;Extra&quot; case is allowed to differ from the other.</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> gather(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isEQ = <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()));</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Keep a stack (SmallVector for efficiency) for depth-first traversal</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">    SmallVector&lt;Value &#42;, 8&gt; DFT;</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">    SmallPtrSet&lt;Value &#42;, 8&gt; Visited;</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Initialize</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">    Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(V);</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">    DFT.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(V);</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!DFT.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = DFT.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If it is a || (or &amp;&amp; depending on isEQ), process the operands.</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Op0, &#42;Op1;</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isEQ ? <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op1)))</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">                 : <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op1)))) &#123;</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Op1).second)</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">            DFT.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Op1);</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Op0).second)</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">            DFT.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Op0);</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Try to match the current instruction</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (matchInstruction(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, isEQ))</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Match succeed, continue the loop</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// One element of the sequence of || (or &amp;&amp;) could not be match as a</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// comparison against the same value as the others.</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We allow only one &quot;Extra&quot; case to be checked before the switch</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a31bb30d8d4ac7d1f8c1a431e1cd86ba3">Extra</a>) &#123;</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a31bb30d8d4ac7d1f8c1a431e1cd86ba3">Extra</a> = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>;</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Failed to parse a proper sequence, abort now</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a0672c6aca6021dfa9e5b6823a760db78">CompValue</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767" lineLink="#aa9dd0c9b2a49c91d814102c1d0c7b09d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#aa9dd0c9b2a49c91d814102c1d0c7b09d">eraseTerminatorAndDCECond</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI,</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &#42;MSSAU = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(TI)) &#123;</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition());</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(TI)) &#123;</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;isConditional())</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(BI-&gt;getCondition());</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/indirectbrinst">IndirectBrInst</a> &#42;IBI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IndirectBrInst&gt;</a>(TI)) &#123;</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(IBI-&gt;getAddress());</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">  TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, MSSAU);</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlightComment">/// Return true if the specified terminator checks</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlightComment">/// to see if a value is equal to constant integer value.</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;SimplifyCFGOpt::isValueEqualityComparison(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI) &#123;</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CV = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(TI)) &#123;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not permit merging of large switch instructions into their</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessors unless there is only one predecessor.</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent()-&gt;hasNPredecessorsOrMore(128 / <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumSuccessors()))</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">      CV = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(TI))</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;isConditional() &amp;&amp; BI-&gt;getCondition()-&gt;hasOneUse())</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(BI-&gt;getCondition())) &#123;</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICI-&gt;<a href="/docs/api/classes/llvm/icmpinst/#abe8988eef2e6fc2baba032cb22afedd7">isEquality</a>() &amp;&amp; <a href="#a3abb1cc80a02ab7f543ff2d98987e121">getConstantInt</a>(ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">          CV = ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Unwrap any lossless ptrtoint cast.</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CV) &#123;</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/ptrtointinst">PtrToIntInst</a> &#42;PTII = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PtrToIntInst&gt;</a>(CV)) &#123;</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = PTII-&gt;getPointerOperand();</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PTII-&gt;getType() == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType()))</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">        CV = <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>;</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CV;</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlightComment">/// Given a value comparison instruction,</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlightComment">/// decode all of the &#39;cases&#39; that it represents and return the &#39;default&#39; block.</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SimplifyCFGOpt::getValueEqualityComparisonCases(</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI, std::vector&lt;ValueEqualityComparisonCase&gt; &amp;Cases) &#123;</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(TI)) &#123;</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">    Cases.reserve(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases());</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases())</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">      Cases.push&#95;back(<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6b935cc2b06bb94c85ad18681414e1e8">ValueEqualityComparisonCase</a>(Case.getCaseValue(),</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">                                                  Case.getCaseSuccessor()));</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest();</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(TI);</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(ICI-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a>);</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">  Cases.push&#95;back(<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6b935cc2b06bb94c85ad18681414e1e8">ValueEqualityComparisonCase</a>(</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">      <a href="#a3abb1cc80a02ab7f543ff2d98987e121">getConstantInt</a>(ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>), Succ));</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(ICI-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>);</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlightComment">/// Given a vector of bb/value pairs, remove any entries</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlightComment">/// in the list that match the specified block.</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834" lineLink="#ab2bdf79ec154e7a070ec95b9700152da"><span class="doxyHighlight"><a href="#ab2bdf79ec154e7a070ec95b9700152da">eliminateBlockCases</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">                    std::vector&lt;ValueEqualityComparisonCase&gt; &amp;Cases) &#123;</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a60a348350395aef11d68f58111bcf499">llvm::erase</a>(Cases, BB);</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlightComment">/// Return true if there are any keys in C1 that exist in C2 as well.</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840" lineLink="#a159c35fe8089d7348efef90d098aecbe"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a159c35fe8089d7348efef90d098aecbe">valuesOverlap</a>(std::vector&lt;ValueEqualityComparisonCase&gt; &amp;C1,</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">                          std::vector&lt;ValueEqualityComparisonCase&gt; &amp;C2) &#123;</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">  std::vector&lt;ValueEqualityComparisonCase&gt; &#42;V1 = &amp;C1, &#42;V2 = &amp;C2;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make V1 be smaller than V2.</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V1-&gt;size() &gt; V2-&gt;size())</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(V1, V2);</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V1-&gt;empty())</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V1-&gt;size() == 1) &#123;</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Just scan V2.</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;TheVal = (&#42;V1)&#91;0&#93;.<a href="/docs/api/classes/llvm/value/#a18dbfcb332af7515599ee795cf462843">Value</a>;</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6b935cc2b06bb94c85ad18681414e1e8">ValueEqualityComparisonCase</a> &amp;<a href="/docs/api/namespaces/llvm/vecc">VECC</a> : &#42;V2)</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TheVal == <a href="/docs/api/namespaces/llvm/vecc">VECC</a>.Value)</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, just sort both lists and compare element by element.</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#add1eb5637dd671428b6f138ed3db6428">array&#95;pod&#95;sort</a>(V1-&gt;begin(), V1-&gt;end());</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#add1eb5637dd671428b6f138ed3db6428">array&#95;pod&#95;sort</a>(V2-&gt;begin(), V2-&gt;end());</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i1 = 0, i2 = 0, NaN = V1-&gt;size(), NaN = V2-&gt;size();</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (i1 != NaN &amp;&amp; i2 != e2) &#123;</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((&#42;V1)&#91;i1&#93;.<a href="/docs/api/classes/llvm/value">Value</a> == (&#42;V2)&#91;i2&#93;.<a href="/docs/api/classes/llvm/value">Value</a>)</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((&#42;V1)&#91;i1&#93;.<a href="/docs/api/classes/llvm/value">Value</a> &lt; (&#42;V2)&#91;i2&#93;.<a href="/docs/api/classes/llvm/value">Value</a>)</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">      ++i1;</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">      ++i2;</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlightComment">// Set branch weights on SwitchInst. This sets the metadata if there is at</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlightComment">// least one non-zero weight.</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875" lineLink="#a4c6e9504894d5f9468c5f151bdc75de2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;uint32&#95;t&gt;</a> Weights,</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsExpected) &#123;</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that there is at least one non-zero weight. Otherwise, pass</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// nullptr to setMetadata which will erase the existing metadata.</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">llvm::any&#95;of</a>(Weights, &#91;&#93;(uint32&#95;t W) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> W != 0; &#125;))</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = <a href="/docs/api/classes/llvm/mdbuilder">MDBuilder</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent()-&gt;getContext())</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/mdbuilder/#a75043d12a76b84200e9ed593719dc5eb">createBranchWeights</a>(Weights, IsExpected);</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;setMetadata(LLVMContext::MD&#95;prof, <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>);</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlightComment">// Similar to the above, but for branch and select instructions that take</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlightComment">// exactly 2 weights.</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888" lineLink="#a939fe4165e88bc40fb5831d3d7a42976"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, uint32&#95;t TrueWeight,</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">                             uint32&#95;t FalseWeight, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsExpected) &#123;</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that there is at least one non-zero weight. Otherwise, pass</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// nullptr to setMetadata which will erase the existing metadata.</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrueWeight || FalseWeight)</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = <a href="/docs/api/classes/llvm/mdbuilder">MDBuilder</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()-&gt;getContext())</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/mdbuilder/#a75043d12a76b84200e9ed593719dc5eb">createBranchWeights</a>(TrueWeight, FalseWeight, IsExpected);</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;setMetadata(LLVMContext::MD&#95;prof, <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>);</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlightComment">/// If TI is known to be a terminator instruction and its block is known to</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlightComment">/// only have a single predecessor block, check to see if that predecessor is</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlightComment">/// also a value comparison with the same value, and if that comparison</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlightComment">/// determines the outcome of this comparison. If so, simplify TI. This does a</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlightComment">/// very limited form of jump threading.</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyEqualityComparisonWithOnlyPredecessor(</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;PredVal = isValueEqualityComparison(Pred-&gt;getTerminator());</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredVal)</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Not a value comparison in predecessor.</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ThisVal = isValueEqualityComparison(TI);</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ThisVal &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;This isn&#39;t a value comparison!!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ThisVal != PredVal)</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Different predicates.</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Preserve branch weight metadata, similarly to how</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// foldValueComparisonIntoPredecessors preserves it.</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find out information about when control will move from Pred to TI&#39;s block.</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">  std::vector&lt;ValueEqualityComparisonCase&gt; PredCases;</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredDef =</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">      getValueEqualityComparisonCases(Pred-&gt;getTerminator(), PredCases);</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">  <a href="#ab2bdf79ec154e7a070ec95b9700152da">eliminateBlockCases</a>(PredDef, PredCases); </span><span class="doxyHighlightComment">// Remove default from cases.</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find information about how control leaves this block.</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">  std::vector&lt;ValueEqualityComparisonCase&gt; ThisCases;</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ThisDef = getValueEqualityComparisonCases(TI, ThisCases);</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">  <a href="#ab2bdf79ec154e7a070ec95b9700152da">eliminateBlockCases</a>(ThisDef, ThisCases); </span><span class="doxyHighlightComment">// Remove default from cases.</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If TI&#39;s block is the default block from Pred&#39;s comparison, potentially</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// simplify TI based on this knowledge.</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredDef == TI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) &#123;</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we are here, we know that the value is none of those cases listed in</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// PredCases.  If there are any cases in ThisCases that are in PredCases, we</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// can simplify TI.</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a159c35fe8089d7348efef90d098aecbe">valuesOverlap</a>(PredCases, ThisCases))</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(TI)) &#123;</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Okay, one of the successors of this condbr is dead.  Convert it to a</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// uncond br.</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ThisCases.size() == 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Branch can only have one case!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Insert the new branch.</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NI = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(ThisDef);</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">      (void)NI;</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Remove PHI node entries for the dead edge.</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">      ThisCases&#91;0&#93;.Dest-&gt;removePredecessor(PredDef);</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Threading pred instr: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Pred-&gt;getTerminator()</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Through successor TI: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;TI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Leaving: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NI</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">      <a href="#aa9dd0c9b2a49c91d814102c1d0c7b09d">eraseTerminatorAndDCECond</a>(TI);</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">        DTU-&gt;applyUpdates(</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">            &#123;&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, PredDef, ThisCases&#91;0&#93;.Dest&#125;&#125;);</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/switchinstprofupdatewrapper">SwitchInstProfUpdateWrapper</a> <a href="/docs/api/namespaces/llvm/si">SI</a> = &#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SwitchInst&gt;</a>(TI);</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Okay, TI has cases that are statically dead, prune them away.</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Constant &#42;, 16&gt;</a> DeadCases;</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PredCases.size(); i != e; ++i)</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">      DeadCases.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PredCases&#91;i&#93;.<a href="/docs/api/classes/llvm/value">Value</a>);</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Threading pred instr: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Pred-&gt;getTerminator()</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Through successor TI: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;TI);</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;BasicBlock &#42;, int, 8&gt;</a> NumPerSuccessorCases;</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/switchinst/#a723af715edeaedc8ed1048f8c235ce9e">SwitchInst::CaseIt</a> i = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;case&#95;end(), e = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;case&#95;begin(); i != e;) &#123;</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">      --i;</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a> = i-&gt;getCaseSuccessor();</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">        ++NumPerSuccessorCases&#91;<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>&#93;;</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DeadCases.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(i-&gt;getCaseValue())) &#123;</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>-&gt;removePredecessor(PredDef);</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/si">SI</a>.removeCase(i);</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">          --NumPerSuccessorCases&#91;<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>&#93;;</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">      std::vector&lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::pair&lt;BasicBlock &#42;, int&gt; &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : NumPerSuccessorCases)</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second == 0)</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">          Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, PredDef, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.first&#125;);</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">      DTU-&gt;applyUpdates(Updates);</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Leaving: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;TI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, TI&#39;s block must correspond to some matched value.  Find out</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which value (or set of values) this is.</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;TIV = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TIBB = TI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;<a href="/docs/api/classes/llvm/value">Value</a>, Dest&#93; : PredCases)</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Dest == TIBB) &#123;</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TIV)</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Cannot handle multiple values coming to this block.</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">      TIV = <a href="/docs/api/classes/llvm/value">Value</a>;</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TIV &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No edge from pred to succ?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, we found the one constant that our value can be if we get into TI&#39;s</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB.  Find out which successor will unconditionally be branched to.</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TheRealDest = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;<a href="/docs/api/classes/llvm/value">Value</a>, Dest&#93; : ThisCases)</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> == TIV) &#123;</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">      TheRealDest = Dest;</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If not handled by any explicit cases, it is handled by the default case.</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TheRealDest)</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">    TheRealDest = ThisDef;</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 2&gt;</a> RemovedSuccs;</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove PHI node entries for dead edges.</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CheckEdge = TheRealDest;</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(TIBB))</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ != CheckEdge) &#123;</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ != TheRealDest)</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">        RemovedSuccs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Succ);</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">      Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(TIBB);</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">      CheckEdge = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert the new branch.</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NI = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(TheRealDest);</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">  (void)NI;</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Threading pred instr: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Pred-&gt;getTerminator()</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Through successor TI: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;TI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Leaving: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NI</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">  <a href="#aa9dd0c9b2a49c91d814102c1d0c7b09d">eraseTerminatorAndDCECond</a>(TI);</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType, 2&gt;</a> Updates;</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(RemovedSuccs.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>());</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RemovedSucc : RemovedSuccs)</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, TIBB, RemovedSucc&#125;);</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">    DTU-&gt;applyUpdates(Updates);</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlightComment">/// This class implements a stable ordering of constant</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlightComment">/// integers that does not depend on their address.  This is important for</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlightComment">/// applications that sort ConstantInt&#39;s to ensure uniqueness.</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantintordering"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantintordering">ConstantIntOrdering</a> &#123;</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantintordering/#aa81a6301d9af1eea54c8bb3cd52aba46"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantintordering/#aa81a6301d9af1eea54c8bb3cd52aba46">operator()</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;LHS, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;RHS)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LHS-&gt;getValue().ult(RHS-&gt;getValue());</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067" lineLink="#a2ab3a1c5bf0fff25a3254622107b9c9f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="#a2ab3a1c5bf0fff25a3254622107b9c9f">constantIntSortPredicate</a>(<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> &#42;P1,</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> &#42;P2) &#123;</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = &#42;P1;</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = &#42;P2;</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> == <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>)</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;getValue().ult(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;getValue()) ? 1 : -1;</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlightComment">/// Get Weights of a given terminator, the default weight is at the front</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlightComment">/// of the vector. If TI is a conditional eq, we need to swap the branch-weight</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlightComment">/// metadata.</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079" lineLink="#ad3e63520dcd2b8f8aa1b2e66e734a575"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ad3e63520dcd2b8f8aa1b2e66e734a575">getBranchWeights</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI,</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;uint64&#95;t&gt;</a> &amp;Weights) &#123;</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;MD = TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;prof);</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MD &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Invalid branch-weight metadata&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#afdf5ff7a7057ac7dbec6cdf4a3132dca">extractFromBranchWeightMD64</a>(MD, Weights);</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If TI is a conditional eq, the default case is the false case,</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and the corresponding branch-weight data is at index 2 We swap the</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// default weight to be the first entry.</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(TI)) &#123;</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Weights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 2);</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICI-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>)</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Weights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a58dc840fc84420b7f0b773794b8101c1">front</a>(), Weights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>());</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlightComment">/// Keep halving the weights until all can fit in uint32&#95;t.</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097" lineLink="#a7b05fae85db516bdd2df79cef5a6343d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a7b05fae85db516bdd2df79cef5a6343d">fitWeights</a>(<a href="/docs/api/classes/llvm/mutablearrayref">MutableArrayRef&lt;uint64&#95;t&gt;</a> Weights) &#123;</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">  uint64&#95;t Max = &#42;<a href="/docs/api/namespaces/llvm/#ab4e6de707bff0fe8081c4da0711bba07">llvm::max&#95;element</a>(Weights);</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Max &gt; UINT&#95;MAX) &#123;</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = 32 - <a href="/docs/api/namespaces/llvm/#a66191f0bcc8c62b784819e9e96ceeba2">llvm::countl&#95;zero</a>(Max);</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (uint64&#95;t &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Weights)</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt;&gt;= <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106" lineLink="#a2a8aa905f11fdce2fbbfd8e695d282b5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a2a8aa905f11fdce2fbbfd8e695d282b5">cloneInstructionsIntoPredecessorBlockAndUpdateSSAUses</a>(</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBlock, <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp;VMap) &#123;</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PTI = PredBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have bonus instructions, clone them into the predecessor block.</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that there may be multiple predecessor blocks, so we cannot move</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bonus instructions to a predecessor block.</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;BonusInst : &#42;BB) &#123;</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BonusInst.isTerminator())</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewBonusInst = BonusInst.<a href="/docs/api/classes/llvm/instruction/#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>();</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(BonusInst) &amp;&amp;</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">        PTI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>() != NewBonusInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>()) &#123;</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Unless the instruction has the same !dbg location as the original</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// branch, drop it. When we fold the bonus instructions we want to make</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// sure we reset their debug locations in order to avoid stepping on</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// dead code caused by folding dead branches.</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">      NewBonusInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7da684e1cead3524bdd9b0d171aad161">RemapInstruction</a>(NewBonusInst, VMap,</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">                     <a href="/docs/api/namespaces/llvm/#a77724415203930efd07d7098cb1e437da9a24bd8dba1bef2753bc3f087435ae7f">RF&#95;NoModuleLevelChanges</a> | <a href="/docs/api/namespaces/llvm/#a77724415203930efd07d7098cb1e437da5633028bc27ffa8eab39cc5de65b3108">RF&#95;IgnoreMissingLocals</a>);</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we speculated an instruction, we need to drop any metadata that may</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// result in undefined behavior, as the metadata might have been valid</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// only given the branch precondition.</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Similarly strip attributes on call parameters that may cause UB in</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// location the call is moved to.</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">    NewBonusInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a7cdb2c2c02ea6d97b993be4c2bd099e6">dropUBImplyingAttrsAndMetadata</a>();</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">    NewBonusInst-&gt;<a href="/docs/api/classes/llvm/instruction/#afcd9d2ea284c4d90541291ff9c47d332">insertInto</a>(PredBlock, PTI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a> = NewBonusInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a2c89a7c3adbeaf3cc5d02a41401801fb">cloneDebugInfoFrom</a>(&amp;BonusInst);</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a3c6de822ccc920e435932d6cb73ac146">RemapDbgRecordRange</a>(NewBonusInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>, VMap,</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">                        <a href="/docs/api/namespaces/llvm/#a77724415203930efd07d7098cb1e437da9a24bd8dba1bef2753bc3f087435ae7f">RF&#95;NoModuleLevelChanges</a> | <a href="/docs/api/namespaces/llvm/#a77724415203930efd07d7098cb1e437da5633028bc27ffa8eab39cc5de65b3108">RF&#95;IgnoreMissingLocals</a>);</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(BonusInst))</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">    NewBonusInst-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(&amp;BonusInst);</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">    BonusInst.setName(NewBonusInst-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.old&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">    VMap&#91;&amp;BonusInst&#93; = NewBonusInst;</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update (liveout) uses of bonus instructions,</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// now that the bonus instruction has been cloned into predecessor.</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that we expect to be in a block-closed SSA form for this to work!</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(BonusInst.uses())) &#123;</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(UI);</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PN) &#123;</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UI-&gt;getParent() == BB &amp;&amp; BonusInst.comesBefore(UI) &amp;&amp;</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;If the user is not a PHI node, then it should be in the same &quot;</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;block as, and come after, the original bonus instruction.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Keep using the original bonus instruction.</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Is this the block-closed SSA form PHI node?</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN-&gt;getIncomingBlock(U) == BB)</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Great, keep using the original bonus instruction.</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The only other alternative is an &quot;use&quot; when coming from</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the predecessor block - here we should refer to the cloned bonus instr.</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PN-&gt;getIncomingBlock(U) == PredBlock &amp;&amp;</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Not in block-closed SSA form?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">      U.set(NewBonusInst);</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::performValueComparisonIntoPredecessorFolding(</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;CV, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PTI, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = TI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = PTI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType, 32&gt;</a> Updates;</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Figure out which &#39;cases&#39; to copy from SI to PSI.</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">  std::vector&lt;ValueEqualityComparisonCase&gt; BBCases;</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BBDefault = getValueEqualityComparisonCases(TI, BBCases);</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">  std::vector&lt;ValueEqualityComparisonCase&gt; PredCases;</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredDefault = getValueEqualityComparisonCases(PTI, PredCases);</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Based on whether the default edge from PTI goes to BB or not, fill in</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PredCases and PredDefault with the new switch cases we would like to</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// build.</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/smallmapvector">SmallMapVector&lt;BasicBlock &#42;, int, 8&gt;</a> NewSuccessors;</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the branch weight metadata along the way</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint64&#95;t, 8&gt;</a> Weights;</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PredHasWeights = <a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;PTI);</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SuccHasWeights = <a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;TI);</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredHasWeights) &#123;</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">    <a href="#ad3e63520dcd2b8f8aa1b2e66e734a575">getBranchWeights</a>(PTI, Weights);</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// branch-weight metadata is inconsistent here.</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Weights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != 1 + PredCases.size())</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">      PredHasWeights = SuccHasWeights = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccHasWeights)</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are no predecessor weights but there are successor weights,</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// populate Weights with 1, which will later be scaled to the sum of</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// successor&#39;s weights</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">    Weights.<a href="/docs/api/classes/llvm/smallvectorimpl/#a38c50aa8e3e9588f4f968c2e03a0cee0">assign</a>(1 + PredCases.size(), 1);</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint64&#95;t, 8&gt;</a> SuccWeights;</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccHasWeights) &#123;</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">    <a href="#ad3e63520dcd2b8f8aa1b2e66e734a575">getBranchWeights</a>(TI, SuccWeights);</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// branch-weight metadata is inconsistent here.</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccWeights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != 1 + BBCases.size())</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">      PredHasWeights = SuccHasWeights = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredHasWeights)</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">    SuccWeights.<a href="/docs/api/classes/llvm/smallvectorimpl/#a38c50aa8e3e9588f4f968c2e03a0cee0">assign</a>(1 + BBCases.size(), 1);</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredDefault == BB) &#123;</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is the default destination from PTI, only the edges in TI</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that don&#39;t occur in PTI, or that branch to BB will be activated.</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">    std::set&lt;ConstantInt &#42;, ConstantIntOrdering&gt; PTIHandled;</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PredCases.size(); i != e; ++i)</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredCases&#91;i&#93;.Dest != BB)</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">        PTIHandled.insert(PredCases&#91;i&#93;.<a href="/docs/api/classes/llvm/value">Value</a>);</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The default destination is BB, we don&#39;t need explicit targets.</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">        <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(PredCases&#91;i&#93;, PredCases.back());</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredHasWeights || SuccHasWeights) &#123;</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Increase weight for the default case.</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">          Weights&#91;0&#93; += Weights&#91;i + 1&#93;;</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">          <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Weights&#91;i + 1&#93;, Weights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>());</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">          Weights.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#ad97688dfe9cd802e2a0691cbe620218a">pop&#95;back</a>();</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">        PredCases.pop&#95;back();</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">        --i;</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">        --<a href="/docs/api/namespaces/llvm/numbers/#a92f4283d4e0e2ea1776894b3ae93640f">e</a>;</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reconstruct the new switch statement we will be building.</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredDefault != BBDefault) &#123;</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">      PredDefault-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(Pred);</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU &amp;&amp; PredDefault != BB)</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">        Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, Pred, PredDefault&#125;);</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">      PredDefault = BBDefault;</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">      ++NewSuccessors&#91;BBDefault&#93;;</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CasesFromPred = Weights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">    uint64&#95;t ValidTotalSuccWeight = 0;</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = BBCases.size(); i != e; ++i)</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PTIHandled.count(BBCases&#91;i&#93;.Value) &amp;&amp; BBCases&#91;i&#93;.Dest != BBDefault) &#123;</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">        PredCases.push&#95;back(BBCases&#91;i&#93;);</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">        ++NewSuccessors&#91;BBCases&#91;i&#93;.Dest&#93;;</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccHasWeights || PredHasWeights) &#123;</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// The default weight is at index 0, so weight for the ith case</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// should be at index i+1. Scale the cases from successor by</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// PredDefaultWeight (Weights&#91;0&#93;).</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">          Weights.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Weights&#91;0&#93; &#42; SuccWeights&#91;i + 1&#93;);</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">          ValidTotalSuccWeight += SuccWeights&#91;i + 1&#93;;</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccHasWeights || PredHasWeights) &#123;</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">      ValidTotalSuccWeight += SuccWeights&#91;0&#93;;</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Scale the cases from predecessor by ValidTotalSuccWeight.</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 1; i &lt; CasesFromPred; ++i)</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">        Weights&#91;i&#93; &#42;= ValidTotalSuccWeight;</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Scale the default weight by SuccDefaultWeight (SuccWeights&#91;0&#93;).</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">      Weights&#91;0&#93; &#42;= SuccWeights&#91;0&#93;;</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is not the default destination from PSI, only the edges</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in SI that occur in PSI with a destination of BB will be</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// activated.</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">    std::set&lt;ConstantInt &#42;, ConstantIntOrdering&gt; PTIHandled;</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">    std::map&lt;ConstantInt &#42;, uint64&#95;t&gt; WeightsForHandled;</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PredCases.size(); i != e; ++i)</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredCases&#91;i&#93;.Dest == BB) &#123;</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">        PTIHandled.insert(PredCases&#91;i&#93;.<a href="/docs/api/classes/llvm/value">Value</a>);</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredHasWeights || SuccHasWeights) &#123;</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">          WeightsForHandled&#91;PredCases&#91;i&#93;.Value&#93; = Weights&#91;i + 1&#93;;</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">          <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Weights&#91;i + 1&#93;, Weights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>());</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">          Weights.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#ad97688dfe9cd802e2a0691cbe620218a">pop&#95;back</a>();</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">        <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(PredCases&#91;i&#93;, PredCases.back());</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">        PredCases.pop&#95;back();</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">        --i;</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">        --<a href="/docs/api/namespaces/llvm/numbers/#a92f4283d4e0e2ea1776894b3ae93640f">e</a>;</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Okay, now we know which constants were sent to BB from the</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessor.  Figure out where they will all go now.</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = BBCases.size(); i != e; ++i)</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PTIHandled.count(BBCases&#91;i&#93;.Value)) &#123;</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If this is one we are capable of getting...</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredHasWeights || SuccHasWeights)</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">          Weights.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(WeightsForHandled&#91;BBCases&#91;i&#93;.<a href="/docs/api/classes/llvm/value">Value</a>&#93;);</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">        PredCases.push&#95;back(BBCases&#91;i&#93;);</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">        ++NewSuccessors&#91;BBCases&#91;i&#93;.Dest&#93;;</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">        PTIHandled.erase(BBCases&#91;i&#93;.<a href="/docs/api/classes/llvm/value">Value</a>); </span><span class="doxyHighlightComment">// This constant is taken care of</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are any constants vectored to BB that TI doesn&#39;t handle,</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// they must go to the default destination of TI.</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : PTIHandled) &#123;</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredHasWeights || SuccHasWeights)</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">        Weights.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(WeightsForHandled&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">      PredCases.push&#95;back(<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6b935cc2b06bb94c85ad18681414e1e8">ValueEqualityComparisonCase</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BBDefault));</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">      ++NewSuccessors&#91;BBDefault&#93;;</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, at this point, we know which new successor Pred will get.  Make</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sure we update the number of entries in the PHI nodes for these</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// successors.</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 2&gt;</a> SuccsOfPred;</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">    SuccsOfPred = &#123;<a href="/docs/api/namespaces/llvm/#a9aa408bc83db2292cc1a57a3e6b206c2">succ&#95;begin</a>(Pred), <a href="/docs/api/namespaces/llvm/#aa5684e4976198c1b64b694d3972ddf78">succ&#95;end</a>(Pred)&#125;;</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(Updates.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() + NewSuccessors.<a href="/docs/api/classes/llvm/mapvector/#acf4c09e1f30cdd4e0b5b1b8a236ead34">size</a>());</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::pair&lt;BasicBlock &#42;, int /&#42;Num&#42;/&gt; &amp;NewSuccessor :</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">       NewSuccessors) &#123;</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#adc4eb8be6f7a12ede962987fb9cabb47">seq</a>(NewSuccessor.second)) &#123;</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">      (void)<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">      <a href="#a0375fe3378c23272b805320851744043">addPredecessorToBlock</a>(NewSuccessor.first, Pred, BB);</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU &amp;&amp; !SuccsOfPred.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(NewSuccessor.first))</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, Pred, NewSuccessor.first&#125;);</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(PTI);</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convert pointer to int before we switch.</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) &#123;</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">    CV =</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aae2c1bf70058f3665edaec525457030c">CreatePtrToInt</a>(CV, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(CV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()), </span><span class="doxyHighlightStringLiteral">&quot;magicptr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that the successors are updated, create the new Switch instruction.</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;NewSI = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8b123015de85b2f41b0deda2aeaad9d3">CreateSwitch</a>(CV, PredDefault, PredCases.size());</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">  NewSI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(PTI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/valueequalitycomparisoncase/#a6b935cc2b06bb94c85ad18681414e1e8">ValueEqualityComparisonCase</a> &amp;V : PredCases)</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">    NewSI-&gt;<a href="/docs/api/classes/llvm/switchinst/#a62abc2475d09c01d583ba24a487898fd">addCase</a>(V.Value, V.Dest);</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredHasWeights || SuccHasWeights) &#123;</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Halve the weights if any of them cannot fit in an uint32&#95;t</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">    <a href="#a7b05fae85db516bdd2df79cef5a6343d">fitWeights</a>(Weights);</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint32&#95;t, 8&gt;</a> MDWeights(Weights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Weights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(NewSI, MDWeights, </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">  <a href="#aa9dd0c9b2a49c91d814102c1d0c7b09d">eraseTerminatorAndDCECond</a>(PTI);</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, last check.  If BB is still a successor of PSI, then we must</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have an infinite loop case.  If so, add an infinitely looping block</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to handle the case to preserve the behavior of the code.</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InfLoopBlock = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = NewSI-&gt;<a href="/docs/api/classes/llvm/switchinst/#a90d8c814f871c58dbda5dccce5c4110e">getNumSuccessors</a>(); i != e; ++i)</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewSI-&gt;<a href="/docs/api/classes/llvm/switchinst/#a30f79d54afada3c9005d24ab8743a9d6">getSuccessor</a>(i) == BB) &#123;</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InfLoopBlock) &#123;</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Insert it at the end of the function, because it&#39;s either code,</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// or it won&#39;t matter if it&#39;s hot. :)</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">        InfLoopBlock =</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;infloop&quot;</span><span class="doxyHighlight">, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(InfLoopBlock, InfLoopBlock);</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">          Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">              &#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, InfLoopBlock, InfLoopBlock&#125;);</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">      NewSI-&gt;<a href="/docs/api/classes/llvm/switchinst/#a7fc7899c254935205ca29b6bd7baa926">setSuccessor</a>(i, InfLoopBlock);</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InfLoopBlock)</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, Pred, InfLoopBlock&#125;);</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, Pred, BB&#125;);</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">    DTU-&gt;applyUpdates(Updates);</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">  ++NumFoldValueComparisonIntoPredecessors;</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlightComment">/// The specified terminator is a value equality comparison instruction</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlightComment">/// (either a switch or a branch on &quot;X == c&quot;).</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlightComment">/// See if any of the predecessors of the terminator block are value comparisons</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlightComment">/// on the same value.  If so, and if safe to do so, fold them together.</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::foldValueComparisonIntoPredecessors(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI,</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">                                                         <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = TI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CV = isValueEqualityComparison(TI); </span><span class="doxyHighlightComment">// CondVal</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CV &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Not a comparison?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;BasicBlock &#42;, 16&gt;</a> Preds(<a href="/docs/api/namespaces/llvm/#ac3e549d97549636a7f08779d5cd98540">pred&#95;begin</a>(BB), <a href="/docs/api/namespaces/llvm/#a2103c335fa6ab933312c3871c82b0106">pred&#95;end</a>(BB));</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Preds.empty()) &#123;</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = Preds.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PTI = Pred-&gt;getTerminator();</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t try to fold into itself.</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred == BB)</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// See if the predecessor is a comparison with the same value.</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;PCV = isValueEqualityComparison(PTI); </span><span class="doxyHighlightComment">// PredCondVal</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PCV != CV)</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;BasicBlock &#42;, 4&gt;</a> FailBlocks;</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a6b537c9f5fe8ee7d5950f9984fa5010a">safeToMergeTerminators</a>(TI, PTI, &amp;FailBlocks)) &#123;</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Succ : FailBlocks) &#123;</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a9d391b6acc6d90c9b8a8442324b1aa6f">SplitBlockPredecessors</a>(Succ, TI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), </span><span class="doxyHighlightStringLiteral">&quot;.fold.split&quot;</span><span class="doxyHighlight">, DTU))</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">    performValueComparisonIntoPredecessorFolding(TI, CV, PTI, Builder);</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlightComment">// If we would need to insert a select that uses the value of this invoke</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlightComment">// (comments in hoistSuccIdenticalTerminatorToSwitchOrIf explain why we would</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlightComment">// need to do this), we can&#39;t hoist the invoke, as there is nowhere to put the</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlightComment">// select in this case.</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435" lineLink="#a3aaba0277f5dd5636e099fa81c20c533"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a3aaba0277f5dd5636e099fa81c20c533">isSafeToHoistInvoke</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB1, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB2,</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I1, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I2) &#123;</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB1)) &#123;</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;BB1V = PN.getIncomingValueForBlock(BB1);</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;BB2V = PN.getIncomingValueForBlock(BB2);</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB1V != BB2V &amp;&amp; (BB1V == I1 || BB2V == I2)) &#123;</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlightComment">// Get interesting characteristics of instructions that</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlightComment">// &#96;hoistCommonCodeFromSuccessors&#96; didn&#39;t hoist. They restrict what kind of</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlightComment">// instructions can be reordered across.</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452" lineLink="#a72d0db08ead54facf3e1e90aaae435ba"><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="#a72d0db08ead54facf3e1e90aaae435ba">SkipFlags</a> &#123;</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453" lineLink="#a72d0db08ead54facf3e1e90aaae435baa45adf13243e382f733c98877e11c1e92"><span class="doxyHighlight">  <a href="#a72d0db08ead54facf3e1e90aaae435baa45adf13243e382f733c98877e11c1e92">SkipReadMem</a> = 1,</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454" lineLink="#a72d0db08ead54facf3e1e90aaae435baa9b3138aebe4b75a1d2cf58ca3b2aaa9e"><span class="doxyHighlight">  <a href="#a72d0db08ead54facf3e1e90aaae435baa9b3138aebe4b75a1d2cf58ca3b2aaa9e">SkipSideEffect</a> = 2,</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455" lineLink="#a72d0db08ead54facf3e1e90aaae435baae768be164a586335f583dbafeecc1ea7"><span class="doxyHighlight">  <a href="#a72d0db08ead54facf3e1e90aaae435baae768be164a586335f583dbafeecc1ea7">SkipImplicitControlFlow</a> = 4</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458" lineLink="#aa67a8bc0841ad57e26ed447bb99ea15d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#aa67a8bc0841ad57e26ed447bb99ea15d">skippedInstrFlags</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Flags = 0;</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadFromMemory())</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">    Flags |= <a href="#a72d0db08ead54facf3e1e90aaae435baa45adf13243e382f733c98877e11c1e92">SkipReadMem</a>;</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can&#39;t arbitrarily move around allocas, e.g. moving allocas (especially</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// inalloca) across stacksave/stackrestore boundaries.</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayHaveSideEffects() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">    Flags |= <a href="#a72d0db08ead54facf3e1e90aaae435baa9b3138aebe4b75a1d2cf58ca3b2aaa9e">SkipSideEffect</a>;</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">    Flags |= <a href="#a72d0db08ead54facf3e1e90aaae435baae768be164a586335f583dbafeecc1ea7">SkipImplicitControlFlow</a>;</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Flags;</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlightComment">// Returns true if it is safe to reorder an instruction across preceding</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlightComment">// instructions in a basic block.</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473" lineLink="#a396eac919c9ac7907275e770a8cd37cf"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a396eac919c9ac7907275e770a8cd37cf">isSafeToHoistInstr</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Flags) &#123;</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t reorder a store over a load.</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Flags &amp; <a href="#a72d0db08ead54facf3e1e90aaae435baa45adf13243e382f733c98877e11c1e92">SkipReadMem</a>) &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayWriteToMemory())</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have seen an instruction with side effects, it&#39;s unsafe to reorder an</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction which reads memory or itself has side effects.</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Flags &amp; <a href="#a72d0db08ead54facf3e1e90aaae435baa9b3138aebe4b75a1d2cf58ca3b2aaa9e">SkipSideEffect</a>) &amp;&amp;</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">      (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadFromMemory() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayHaveSideEffects() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)))</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reordering across an instruction which does not necessarily transfer</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// control to the next instruction is speculation.</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Flags &amp; <a href="#a72d0db08ead54facf3e1e90aaae435baae768be164a586335f583dbafeecc1ea7">SkipImplicitControlFlow</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Hoisting of llvm.deoptimize is only legal together with the next return</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction, which this pass is not always able to do.</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CB-&gt;getIntrinsicID() == Intrinsic::experimental&#95;deoptimize)</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It&#39;s also unsafe/illegal to hoist an instruction above its instruction</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// operands</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands()) &#123;</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;J = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (J-&gt;getParent() == BB)</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PtrValueMayBeModified = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlightComment">/// Helper function for hoistCommonCodeFromSuccessors. Return true if identical</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlightComment">/// instructions \\p I1 and \\p I2 can and should be hoisted.</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511" lineLink="#a638ffe19974c5c1ce19abcd1905d4981"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a638ffe19974c5c1ce19abcd1905d4981">shouldHoistCommonInstructions</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I1, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I2,</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">                                          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we&#39;re going to hoist a call, make sure that the two instructions</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we&#39;re commoning/hoisting are both marked with musttail, or neither of</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them is marked as such. Otherwise, we might end up in a situation where</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we hoist from a block where the terminator is a &#96;ret&#96; to a block where</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the terminator is a &#96;br&#96;, and &#96;musttail&#96; calls expect to be followed by</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a return.</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;C1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(I1);</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;C2 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(I2);</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (C1 &amp;&amp; C2)</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (C1-&gt;isMustTailCall() != C2-&gt;isMustTailCall())</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.isProfitableToHoist(I1) || !<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.isProfitableToHoist(I2))</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If any of the two call sites has nomerge or convergent attribute, stop</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// hoisting.</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CB1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(I1))</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CB1-&gt;cannotMerge() || CB1-&gt;isConvergent())</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CB2 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(I2))</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CB2-&gt;cannotMerge() || CB2-&gt;isConvergent())</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlightComment">/// Hoists DbgVariableRecords from \\p I1 and \\p OtherInstrs that are identical</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlightComment">/// in lock-step to \\p TI. This matches how dbg.&#42; intrinsics are hoisting in</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlightComment">/// hoistCommonCodeFromSuccessors. e.g. The input:</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlightComment">///    I1                DVRs: &#123; x, z &#125;,</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlightComment">///    OtherInsts: &#123; I2  DVRs: &#123; x, y, z &#125; &#125;</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlightComment">/// would result in hoisting only DbgVariableRecord x.</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546" lineLink="#aedc31552ebf0ce116c665da44b4a97a5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#aedc31552ebf0ce116c665da44b4a97a5">hoistLockstepIdenticalDbgVariableRecords</a>(</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I1,</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;OtherInsts) &#123;</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!I1-&gt;hasDbgRecords())</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">CurrentAndEndIt =</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">      std::pair&lt;DbgRecord::self&#95;iterator, DbgRecord::self&#95;iterator&gt;;</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Vector of &#123;Current, End&#125; iterators.</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;CurrentAndEndIt&gt;</a> Itrs;</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">  Itrs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(OtherInsts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() + 1);</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Helper lambdas for lock-step checks:</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return true if this Current == End.</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> atEnd = &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> CurrentAndEndIt &amp;Pair) &#123;</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Pair.first == Pair.second;</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return true if all Current are identical.</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> allIdentical = &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;CurrentAndEndIt&gt;</a> &amp;Itrs) &#123;</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/#a7f02feabe2798347395e53d18da48f96">make&#95;first&#95;range</a>(<a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(Itrs).drop&#95;front()),</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">                  &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/dbgrecord/#a35975cf965c120e55130f30dd377418d">DbgRecord::self&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Itrs&#91;0&#93;.first-&gt;isIdenticalToWhenDefined(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">                  &#125;);</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect the iterators.</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">  Itrs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">      &#123;I1-&gt;getDbgRecordRange().begin(), I1-&gt;getDbgRecordRange().end()&#125;);</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a> : OtherInsts) &#123;</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>-&gt;hasDbgRecords())</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">    Itrs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">        &#123;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>-&gt;getDbgRecordRange().begin(), <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>-&gt;getDbgRecordRange().end()&#125;);</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate in lock-step until any of the DbgRecord lists are exausted. If</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the lock-step DbgRecord are identical, hoist all of them to TI.</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This replicates the dbg.&#42; intrinsic behaviour in</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// hoistCommonCodeFromSuccessors.</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(Itrs, atEnd)) &#123;</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HoistDVRs = allIdentical(Itrs);</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (CurrentAndEndIt &amp;Pair : Itrs) &#123;</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Increment Current iterator now as we may be about to move the</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// DbgRecord.</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/dbgrecord">DbgRecord</a> &amp;DR = &#42;Pair.first++;</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HoistDVRs) &#123;</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">        DR.<a href="/docs/api/classes/llvm/dbgrecord/#a04a8b2dc4d72db72e1f87bdec4074973">removeFromParent</a>();</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">        TI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;insertDbgRecordBefore(&amp;DR, TI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597" lineLink="#a47aa12b3f79390c9835ac99904b2cb51"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a47aa12b3f79390c9835ac99904b2cb51">areIdenticalUpToCommutativity</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I1,</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">                                          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I2) &#123;</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (I1-&gt;isIdenticalToWhenDefined(I2, </span><span class="doxyHighlightComment">/&#42;IntersectAttrs=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Cmp1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(I1))</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Cmp2 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(I2))</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Cmp1-&gt;getPredicate() == Cmp2-&gt;getSwappedPredicate() &amp;&amp;</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">             Cmp1-&gt;getOperand(0) == Cmp2-&gt;getOperand(1) &amp;&amp;</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">             Cmp1-&gt;getOperand(1) == Cmp2-&gt;getOperand(0);</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (I1-&gt;isCommutative() &amp;&amp; I1-&gt;isSameOperationAs(I2)) &#123;</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> I1-&gt;getOperand(0) == I2-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) &amp;&amp;</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">           I1-&gt;getOperand(1) == I2-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) &amp;&amp;</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#ae04157f1cd3b64e93ebd44f8f65e395c">equal</a>(<a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(I1-&gt;operands(), 2), <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(I2-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>(), 2));</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlightComment">/// If the target supports conditional faulting,</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlightComment">/// we look for the following pattern:</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlightComment">///   BB:</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><span class="doxyHighlightComment">///     ...</span></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlightComment">///     %cond = icmp ult %x, %y</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlightComment">///     br i1 %cond, label %TrueBB, label %FalseBB</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlightComment">///   FalseBB:</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlightComment">///     store i32 1, ptr %q, align 4</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlightComment">///     ...</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlightComment">///   TrueBB:</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlightComment">///     %maskedloadstore = load i32, ptr %b, align 4</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlightComment">///     store i32 %maskedloadstore, ptr %p, align 4</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlightComment">///     ...</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlightComment">/// and transform it into:</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlightComment">///   BB:</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlightComment">///     ...</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlightComment">///     %cond = icmp ult %x, %y</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlightComment">///     %maskedloadstore = cload i32, ptr %b, %cond</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlightComment">///     cstore i32 %maskedloadstore, ptr %p, %cond</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlightComment">///     cstore i32 1, ptr %q, ~%cond</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlightComment">///     br i1 %cond, label %TrueBB, label %FalseBB</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlightComment">///   FalseBB:</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlightComment">///     ...</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlightComment">///   TrueBB:</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlightComment">///     ...</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlightComment">/// where cload/cstore are represented by llvm.masked.load/store intrinsics,</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlightComment">/// e.g.</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlightComment">///   %vcond = bitcast i1 %cond to &lt;1 x i1&gt;</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlightComment">///   %v0 = call &lt;1 x i32&gt; @llvm.masked.load.v1i32.p0</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlightComment">///                         (ptr %b, i32 4, &lt;1 x i1&gt; %vcond, &lt;1 x i32&gt; poison)</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlightComment">///   %maskedloadstore = bitcast &lt;1 x i32&gt; %v0 to i32</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlightComment">///   call void @llvm.masked.store.v1i32.p0</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlightComment">///                          (&lt;1 x i32&gt; %v0, ptr %p, i32 4, &lt;1 x i1&gt; %vcond)</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlightComment">///   %cond.not = xor i1 %cond, true</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlightComment">///   %vcond.not = bitcast i1 %cond.not to &lt;1 x i&gt;</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlightComment">///   call void @llvm.masked.store.v1i32.p0</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlightComment">///              (&lt;1 x i32&gt; &lt;i32 1&gt;, ptr %q, i32 4, &lt;1x i1&gt; %vcond.not)</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlightComment">/// So we need to turn hoisted load/store into cload/cstore.</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlightComment">/// \\param BI The branch instruction.</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlightComment">/// \\param SpeculatedConditionalLoadsStores The load/store instructions that</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlightComment">///                                         will be speculated.</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlightComment">/// \\param Invert indicates if speculates FalseBB. Only used in triangle CFG.</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671" lineLink="#ab99310a04afb6c28186b1a6428eb75b0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ab99310a04afb6c28186b1a6428eb75b0">hoistConditionalLoadsStores</a>(</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI,</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;SpeculatedConditionalLoadsStores,</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlight">    std::optional&lt;bool&gt; Invert) &#123;</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Context = BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getContext();</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VCondTy = <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(Context), 1);</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = BI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Construct the condition if needed.</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">      Invert.has&#95;value() ? SpeculatedConditionalLoadsStores.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>() : BI);</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Mask = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;MaskFalse = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;MaskTrue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Invert.has&#95;value()) &#123;</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">    Mask = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">        &#42;Invert ? Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#add2225af2af25968f26ed4cb0db94dbe">CreateXor</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(Context)) : <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>,</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">        VCondTy);</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">    MaskFalse = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#add2225af2af25968f26ed4cb0db94dbe">CreateXor</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(Context)), VCondTy);</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">    MaskTrue = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, VCondTy);</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PeekThroughBitcasts = &#91;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BitCast = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(V))</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">      V = BitCast-&gt;getOperand(0);</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SpeculatedConditionalLoadsStores) &#123;</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Invert.has&#95;value() ? <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BI);</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Invert.has&#95;value())</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">      Mask = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == BI-&gt;getSuccessor(0) ? MaskTrue : MaskFalse;</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We currently assume conditional faulting load/store is supported for</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalar types only when creating new instructions. This can be easily</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// extended for vector types in the future.</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;isVectorTy() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;not implemented&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Op0 = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;MaskedLoadStore = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Handle Load.</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Ty = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType();</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;PassThru = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Invert.has&#95;value())</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users())</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(U))) &#123;</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">            PassThru = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">                PeekThroughBitcasts(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(BB)),</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(Ty, 1));</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">      MaskedLoadStore = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a483f68557374e8fc58f8a294e7f1268e">CreateMaskedLoad</a>(</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(Ty, 1), Op0, LI-&gt;getAlign(), Mask, PassThru);</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewLoadStore = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(MaskedLoadStore, Ty);</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN)</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">        PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ae9562b96f6f3fa41bd36538c080035ee">getBasicBlockIndex</a>(BB), NewLoadStore);</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(NewLoadStore);</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Handle Store.</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StoredVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">          PeekThroughBitcasts(Op0), <a href="/docs/api/classes/llvm/fixedvectortype/#af9a870d5df50fe0133a410b7c9114c80">FixedVectorType::get</a>(Op0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 1));</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">      MaskedLoadStore = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aad07e3e0fa03f6c780e13d924325d8d0">CreateMaskedStore</a>(</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">          StoredVal, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getAlign(), Mask);</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For non-debug metadata, only !annotation, !range, !nonnull and !align are</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// kept when hoisting (see Instruction::dropUBImplyingAttrsAndMetadata).</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// !nonnull, !align : Not support pointer type, no need to keep.</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// !range: Load type is changed from scalar to vector, but the metadata on</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//         vector specifies a per-element range, so the semantics stay the</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//         same. Keep it.</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// !annotation: Not impact semantics. Keep it.</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;Ranges = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getMetadata(LLVMContext::MD&#95;range))</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">      MaskedLoadStore-&gt;<a href="/docs/api/classes/llvm/callbase/#a0e7b74d310c94c459b8985806192cc99">addRangeRetAttr</a>(<a href="/docs/api/namespaces/llvm/#a5193c3535375c450b9430e5671cbeb2d">getConstantRangeFromMetadata</a>(&#42;Ranges));</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;dropUBImplyingAttrsAndUnknownMetadata(&#123;LLVMContext::MD&#95;annotation&#125;);</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: DIAssignID is not supported for masked store yet.</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (Verifier::visitDIAssignIDMetadata)</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/at/#acac0a0a393ce41aadc29e623549b6bfa">at::deleteAssignmentMarkers</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseMetadataIf(&#91;&#93;(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MDKind, <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;<a href="/docs/api/classes/node">Node</a>) &#123;</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/node">Node</a>-&gt;getMetadataID() == Metadata::DIAssignIDKind;</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">    MaskedLoadStore-&gt;<a href="/docs/api/classes/llvm/instruction/#aec6eaa1e49f48c178e0ab9c030b5971e">copyMetadata</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757" lineLink="#af7700655934807d2b707112f79217377"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#af7700655934807d2b707112f79217377">isSafeCheapLoadStore</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Not handle volatile or atomic.</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;L = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L-&gt;isSimple())</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;S = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!S-&gt;isSimple())</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// llvm.masked.load/store use i32 for alignment while load/store use i64.</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// That&#39;s why we have the alignment limitation.</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Update the prototype of the intrinsics?</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.hasConditionalLoadStoreForType(<a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &lt; <a href="/docs/api/classes/llvm/value/#a089e46429cea4cfcd2ba23a6fc6aa676">Value::MaximumAlignment</a>;</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlightComment">// LockstepReverseIterator - Iterates through instructions</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlightComment">// in a set of blocks in reverse order from the first non-terminator.</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlightComment">// For example (assume all blocks have size n):</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlightComment">//   LockstepReverseIterator I(&#91;B1, B2, B3&#93;);</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlightComment">//   &#42;I-- = &#91;B1&#91;n&#93;, B2&#91;n&#93;, B3&#91;n&#93;&#93;;</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlightComment">//   &#42;I-- = &#91;B1&#91;n-1&#93;, B2&#91;n-1&#93;, B3&#91;n-1&#93;&#93;;</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlightComment">//   &#42;I-- = &#91;B1&#91;n-2&#93;, B2&#91;n-2&#93;, B3&#91;n-2&#93;&#93;;</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#aa688b7ef72ecbc2c80a05e2859e24078">LockstepReverseIterator</a> &#123;</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;BasicBlock &#42;&gt;</a> Blocks;</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> Insts;</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Fail;</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#aa688b7ef72ecbc2c80a05e2859e24078"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#aa688b7ef72ecbc2c80a05e2859e24078">LockstepReverseIterator</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;BasicBlock &#42;&gt;</a> Blocks) : Blocks(Blocks) &#123;</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#a681ac4eccb12ef854bb38bb656c1f1f5">reset</a>();</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#a681ac4eccb12ef854bb38bb656c1f1f5"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#a681ac4eccb12ef854bb38bb656c1f1f5">reset</a>() &#123;</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlight">    Fail = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlight">    Insts.clear();</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : Blocks) &#123;</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Inst = Inst-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a1dfdcf6998ec28bfd2f8d2cdebc984a9">getPrevNode</a>(); Inst &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(Inst);)</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">        Inst = Inst-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a1dfdcf6998ec28bfd2f8d2cdebc984a9">getPrevNode</a>();</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inst) &#123;</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Block wasn&#39;t big enough.</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">        Fail = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">      Insts.push&#95;back(Inst);</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#ae17fcd107913b60a33a7a52b698d37e1"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#ae17fcd107913b60a33a7a52b698d37e1">isValid</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Fail; &#125;</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#ac761ab8d8b8e6b95f632c125dda1087e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#ac761ab8d8b8e6b95f632c125dda1087e">operator--</a>() &#123;</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Fail)</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;&amp;Inst : Insts) &#123;</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Inst = Inst-&gt;getPrevNode(); Inst &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(Inst);)</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">        Inst = Inst-&gt;getPrevNode();</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Already at beginning of block.</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inst) &#123;</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">        Fail = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#a0b0915c7a85254338aa8e25462021071"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#a0b0915c7a85254338aa8e25462021071">operator++</a>() &#123;</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Fail)</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;&amp;Inst : Insts) &#123;</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Inst = Inst-&gt;getNextNode(); Inst &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(Inst);)</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">        Inst = Inst-&gt;getNextNode();</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Already at end of block.</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inst) &#123;</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">        Fail = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#a3a4f3f6af70d45ad493ffbfaf32e2564"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Instruction &#42;&gt;</a> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#a3a4f3f6af70d45ad493ffbfaf32e2564">operator&#42;</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Insts; &#125;</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlightComment">/// Hoist any common code in the successor blocks up into the block. This</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlightComment">/// function guarantees that BB dominates all successors. If AllInstsEqOnly is</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlightComment">/// given, only perform hoisting in case all successors blocks contain matching</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlightComment">/// instructions only. In that case, all instructions can be hoisted and the</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlightComment">/// original branch will be replaced and selects for PHIs are added.</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::hoistCommonCodeFromSuccessors(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI,</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">                                                   </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllInstsEqOnly) &#123;</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This does very trivial matching, with limited scanning, to find identical</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions in the two blocks. In particular, we don&#39;t want to get into</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// O(N1&#42;N2&#42;...) situations here where Ni are the sizes of these successors. As</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// such, we currently just scan for obviously identical instructions in an</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// identical order, possibly separated by the same number of non-identical</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions.</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = TI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SuccSize = <a href="/docs/api/namespaces/llvm/#a85da2bdebeeed0bf7fdccfdfc5f1b92c">succ&#95;size</a>(BB);</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccSize &lt; 2)</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If either of the blocks has it&#39;s address taken, then we can&#39;t do this fold,</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// because the code we&#39;d hoist would no longer run when we jump into the block</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// by it&#39;s address.</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB))</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>() || !Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>())</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The second of pair is a SkipFlags bitmask.</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">SuccIterPair = std::pair&lt;BasicBlock::iterator, unsigned&gt;;</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SuccIterPair, 8&gt;</a> SuccIterPairs;</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB)) &#123;</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> SuccItr = Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(&#42;SuccItr))</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">    SuccIterPairs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SuccIterPair(SuccItr, 0));</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllInstsEqOnly) &#123;</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if all instructions in the successor blocks match. This allows</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// hoisting all instructions and removing the blocks we are hoisting from,</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// so does not add any new instructions.</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;&gt;</a> Succs = <a href="/docs/api/namespaces/llvm/#a886094eaed7ce32029ea52a641142b88">to&#95;vector</a>(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB));</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if sizes and terminators of all successors match.</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllSame = <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(Succs, &#91;&amp;Succs&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ) &#123;</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Term0 = Succs&#91;0&#93;-&gt;getTerminator();</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a> = Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a>-&gt;isSameOperationAs(Term0) ||</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">             !<a href="/docs/api/namespaces/llvm/#ae04157f1cd3b64e93ebd44f8f65e395c">equal</a>(<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a>-&gt;operands(), Term0-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) ||</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">             Succs&#91;0&#93;-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>();</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AllSame)</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllSame) &#123;</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#aa688b7ef72ecbc2c80a05e2859e24078">LockstepReverseIterator</a> LRI(Succs);</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (LRI.isValid()) &#123;</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I0 = (&#42;LRI)&#91;0&#93;;</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(&#42;LRI, &#91;I0&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="#a47aa12b3f79390c9835ac99904b2cb51">areIdenticalUpToCommutativity</a>(I0, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">            &#125;)) &#123;</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">        --LRI;</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now we know that all instructions in all successors can be hoisted. Let</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the loop below handle the hoisting.</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Count how many instructions were not hoisted so far. There&#39;s a limit on how</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// many instructions we skip, serving as a compilation time control as well as</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// preventing excessive increase of life ranges.</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumSkipped = 0;</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we find an unreachable instruction at the beginning of a basic block, we</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can still hoist instructions from the rest of the basic blocks.</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccIterPairs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt; 2) &#123;</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">erase&#95;if</a>(SuccIterPairs,</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">             &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pair) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UnreachableInst&gt;</a>(Pair.first); &#125;);</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccIterPairs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt; 2)</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (;;) &#123;</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SuccIterPairBegin = SuccIterPairs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>();</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BB1ItrPair = &#42;SuccIterPairBegin++;</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> OtherSuccIterPairRange =</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a9b5301a03dc90d7ac00440e2de4d9149">iterator&#95;range</a>(SuccIterPairBegin, SuccIterPairs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> OtherSuccIterRange = <a href="/docs/api/namespaces/llvm/#a7f02feabe2798347395e53d18da48f96">make&#95;first&#95;range</a>(OtherSuccIterPairRange);</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a> = &amp;&#42;BB1ItrPair.first;</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip debug info if it is not identical.</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllDbgInstsAreIdentical = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(OtherSuccIterRange, &#91;I1&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Iter) &#123;</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I2 = &amp;&#42;<a href="/docs/api/namespaces/anonymous-cskyconstantislandpass-cpp-/#a0bd7d621ba8de56e4052df49da823802">Iter</a>;</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a>-&gt;isIdenticalToWhenDefined(I2);</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AllDbgInstsAreIdentical) &#123;</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(I1))</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">        <a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a> = &amp;&#42;++BB1ItrPair.first;</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;SuccIter : OtherSuccIterRange) &#123;</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I2 = &amp;&#42;SuccIter;</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(I2))</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">          I2 = &amp;&#42;++SuccIter;</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllInstsAreIdentical = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasTerminator = <a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a>-&gt;isTerminator();</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;SuccIter : OtherSuccIterRange) &#123;</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I2 = &amp;&#42;SuccIter;</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">      HasTerminator |= I2-&gt;<a href="/docs/api/classes/llvm/instruction/#a7653277511df1034148a37520a585bb5">isTerminator</a>();</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllInstsAreIdentical &amp;&amp; (!<a href="#a47aa12b3f79390c9835ac99904b2cb51">areIdenticalUpToCommutativity</a>(I1, I2) ||</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/mmrametadata">MMRAMetadata</a>(&#42;I1) != <a href="/docs/api/classes/llvm/mmrametadata">MMRAMetadata</a>(&#42;I2)))</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">        AllInstsAreIdentical = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 8&gt;</a> OtherInsts;</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;SuccIter : OtherSuccIterRange)</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlight">      OtherInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;&#42;SuccIter);</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we are hoisting the terminator instruction, don&#39;t move one (making a</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// broken BB), instead clone it, and remove BI.</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasTerminator) &#123;</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Even if BB, which contains only one unreachable instruction, is ignored</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// at the beginning of the loop, we can hoist the terminator instruction.</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If any instructions remain in the block, we cannot hoist terminators.</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumSkipped || !AllInstsAreIdentical) &#123;</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">        <a href="#aedc31552ebf0ce116c665da44b4a97a5">hoistLockstepIdenticalDbgVariableRecords</a>(TI, I1, OtherInsts);</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> hoistSuccIdenticalTerminatorToSwitchOrIf(TI, I1, OtherInsts) ||</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">             <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllInstsAreIdentical) &#123;</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SkipFlagsBB1 = BB1ItrPair.second;</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">      AllInstsAreIdentical =</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">          <a href="#a396eac919c9ac7907275e770a8cd37cf">isSafeToHoistInstr</a>(I1, SkipFlagsBB1) &amp;&amp;</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(OtherSuccIterPairRange, &#91;=&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pair) &#123;</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I2 = &amp;&#42;Pair.first;</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SkipFlagsBB2 = Pair.second;</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Even if the instructions are identical, it may not</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// be safe to hoist them if we have skipped over</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// instructions with side effects or their operands</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// weren&#39;t hoisted.</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a396eac919c9ac7907275e770a8cd37cf">isSafeToHoistInstr</a>(I2, SkipFlagsBB2) &amp;&amp;</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">                   <a href="#a638ffe19974c5c1ce19abcd1905d4981">shouldHoistCommonInstructions</a>(I1, I2, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">          &#125;);</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllInstsAreIdentical) &#123;</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">      BB1ItrPair.first++;</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(I1)) &#123;</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The debug location is an integral part of a debug info intrinsic</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// and can&#39;t be separated from it or replaced.  Instead of attempting</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// to merge locations, simply hoist both copies of the intrinsic.</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">        <a href="#aedc31552ebf0ce116c665da44b4a97a5">hoistLockstepIdenticalDbgVariableRecords</a>(TI, I1, OtherInsts);</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We&#39;ve just hoisted DbgVariableRecords; move I1 after them (before TI)</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// and leave any that were not hoisted behind (by calling moveBefore</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// rather than moveBeforePreserving).</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">        <a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a>-&gt;moveBefore(TI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;SuccIter : OtherSuccIterRange) &#123;</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;I2 = &amp;&#42;SuccIter++;</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(I2));</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">          I2-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(TI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// For a normal instruction, we just move one to right before the</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// branch, then replace all uses of the other with the first.  Finally,</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// we remove the now redundant second instruction.</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">        <a href="#aedc31552ebf0ce116c665da44b4a97a5">hoistLockstepIdenticalDbgVariableRecords</a>(TI, I1, OtherInsts);</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We&#39;ve just hoisted DbgVariableRecords; move I1 after them (before TI)</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// and leave any that were not hoisted behind (by calling moveBefore</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// rather than moveBeforePreserving).</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">        <a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a>-&gt;moveBefore(TI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;SuccIter : OtherSuccIterRange) &#123;</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I2 = &amp;&#42;SuccIter++;</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(I2 != I1);</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!I2-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">            I2-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(I1);</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">          <a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a>-&gt;andIRFlags(I2);</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(I1)) &#123;</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> = CB-&gt;tryIntersectAttributes(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(I2));</span></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;We should not be trying to hoist callbases &quot;</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">                              </span><span class="doxyHighlightStringLiteral">&quot;with non-intersectable attributes&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// For NDEBUG Compile.</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">            (void)<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a>;</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a9b43098c569ea8289ed1ab70ee9a00af">combineMetadataForCSE</a>(I1, I2, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// I1 and I2 are being combined into a single instruction.  Its debug</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// location is the merged locations of the original instructions.</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">          <a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a>-&gt;applyMergedLocation(<a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a>-&gt;getDebugLoc(), I2-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">          I2-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">        NumHoistCommonCode += SuccIterPairs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">      NumHoistCommonInstrs += SuccIterPairs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumSkipped &gt;= <a href="#aedd87113e9f2b7035fb15c4aeadbbd98">HoistCommonSkipLimit</a>) &#123;</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">        <a href="#aedc31552ebf0ce116c665da44b4a97a5">hoistLockstepIdenticalDbgVariableRecords</a>(TI, I1, OtherInsts);</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We are about to skip over a pair of non-identical instructions. Record</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// if any have characteristics that would prevent reordering instructions</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// across them.</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;SuccIterPair : SuccIterPairs) &#123;</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = &amp;&#42;SuccIterPair.first++;</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">        SuccIterPair.second |= <a href="#aa67a8bc0841ad57e26ed447bb99ea15d">skippedInstrFlags</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">      ++NumSkipped;</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::hoistSuccIdenticalTerminatorToSwitchOrIf(</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I1,</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;OtherSuccTIs) &#123;</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(TI);</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TIParent = TI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB1 = <a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a>-&gt;getParent();</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use only for an if statement.</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;I2 = &#42;OtherSuccTIs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>();</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB2 = I2-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI) &#123;</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OtherSuccTIs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 1);</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == <a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a>-&gt;getParent());</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) == I2-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In the case of an if statement, we try to hoist an invoke.</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Can we define a safety predicate for CallBr?</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Test case llvm/test/Transforms/SimplifyCFG/2009-06-15-InvokeCrash.ll</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// removed in 4c923b3b3fd0ac1edebf0603265ca3ba51724937 commit?</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InvokeInst&gt;</a>(I1) &amp;&amp; (!BI || !<a href="#a3aaba0277f5dd5636e099fa81c20c533">isSafeToHoistInvoke</a>(BB1, BB2, I1, I2)))</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: callbr hoisting currently disabled pending further study.</span></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallBrInst&gt;</a>(I1))</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB1)) &#123;</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;BB1V = PN.getIncomingValueForBlock(BB1);</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OtherSuccTI : OtherSuccTIs) &#123;</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;BB2V = PN.getIncomingValueForBlock(OtherSuccTI-&gt;getParent());</span></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB1V == BB2V)</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// In the case of an if statement, check for</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// passingValueIsAlwaysUndefined here because we would rather eliminate</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// undefined control flow then converting it to a select.</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI || <a href="#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(BB1V, &amp;PN) ||</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">            <a href="#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(BB2V, &amp;PN))</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Hoist DbgVariableRecords attached to the terminator to match dbg.&#42;</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// intrinsic hoisting behaviour in hoistCommonCodeFromSuccessors.</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><span class="doxyHighlight">  <a href="#aedc31552ebf0ce116c665da44b4a97a5">hoistLockstepIdenticalDbgVariableRecords</a>(TI, I1, OtherSuccTIs);</span></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clone the terminator and hoist it into the pred, without any debug info.</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/cpol/#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a> = <a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a>-&gt;clone();</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/amdgpu/cpol/#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a>-&gt;insertInto(TIParent, TI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/amdgpu/cpol/#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a>-&gt;getType()-&gt;isVoidTy()) &#123;</span></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a>-&gt;replaceAllUsesWith(NT);</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OtherSuccTI : OtherSuccTIs)</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlight">      OtherSuccTI-&gt;replaceAllUsesWith(NT);</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/amdgpu/cpol/#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a>-&gt;takeName(I1);</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">  NumHoistCommonInstrs += OtherSuccTIs.size() + 1;</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ensure terminator gets a debug location, even an unknown one, in case</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it involves inlinable calls.</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DILocation &#42;, 4&gt;</a> Locs;</span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><span class="doxyHighlight">  Locs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/anonymous-dxilopbuilder-cpp-/#a3fe8fcf1f03e5da864eb86be303a3216a0bfbc695c285082c59ed77069aafbfae">I1</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OtherSuccTI : OtherSuccTIs)</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">    Locs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OtherSuccTI-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/amdgpu/cpol/#a7d79a4b341da8ac60b91c1f4b1ea42c4a3795a38ac6eb8cb14191aaba99205a87">NT</a>-&gt;setDebugLoc(<a href="/docs/api/classes/llvm/dilocation/#a30a7ce961d5d90ff2fb6c9cee4576e5a">DILocation::getMergedLocations</a>(Locs));</span></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHIs created below will adopt NT&#39;s merged DebugLoc.</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;NoFolder&gt;</a> Builder(NT);</span></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In the case of an if statement, hoisting one of the terminators from our</span></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// successor is a great thing. Unfortunately, the successors of the if/else</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// blocks may have PHI nodes in them.  If they do, all PHI entries for BB1/BB2</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// must agree for all PHI nodes, so we insert select instruction to compute</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the final result.</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI) &#123;</span></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlight">    std::map&lt;std::pair&lt;Value &#42;, Value &#42;&gt;, <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;&gt; InsertedSelects;</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB1)) &#123;</span></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;BB1V = PN.getIncomingValueForBlock(BB1);</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;BB2V = PN.getIncomingValueForBlock(BB2);</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB1V == BB2V)</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// These values do not agree.  Insert a select instruction before NT</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// that determines the right value.</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;&amp;<a href="/docs/api/namespaces/llvm/si">SI</a> = InsertedSelects&#91;std::make&#95;pair(BB1V, BB2V)&#93;;</span></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</span></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Propagate fast-math-flags from phi node to its replacement select.</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3cd8a9205d8cc6d024b6e6344a72aca0">CreateSelectFMF</a>(</span></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><span class="doxyHighlight">              BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>(), BB1V, BB2V,</span></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FPMathOperator&gt;</a>(PN) ? &amp;PN : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><span class="doxyHighlight">              BB1V-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight"> + BB2V-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>(), BI));</span></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Make the PHI node use the select for all incoming values for BB1/BB2</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PN.getNumIncomingValues(); i != e; ++i)</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN.getIncomingBlock(i) == BB1 || PN.getIncomingBlock(i) == BB2)</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlight">            PN.setIncomingValue(i, <a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType, 4&gt;</a> Updates;</span></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update any PHI nodes in our new successors.</span></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB1)) &#123;</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><span class="doxyHighlight">    <a href="#a0375fe3378c23272b805320851744043">addPredecessorToBlock</a>(Succ, TIParent, BB1);</span></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, TIParent, Succ&#125;);</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(TI))</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, TIParent, Succ&#125;);</span></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">  <a href="#aa9dd0c9b2a49c91d814102c1d0c7b09d">eraseTerminatorAndDCECond</a>(TI);</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><span class="doxyHighlight">    DTU-&gt;applyUpdates(Updates);</span></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlightComment">// Check lifetime markers.</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191" lineLink="#ae97521436759fc2489301a34e621bbcd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ae97521436759fc2489301a34e621bbcd">isLifeTimeMarker</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID()) &#123;</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::lifetime&#95;start:</span></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::lifetime&#95;end:</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlightComment">// TODO: Refine this. This should avoid cases like turning constant memcpy sizes</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><span class="doxyHighlightComment">// into variables.</span></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206" lineLink="#aa85a3c04f64695265702d0b3c3d6ea1c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aa85a3c04f64695265702d0b3c3d6ea1c">replacingOperandWithVariableIsCheap</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><span class="doxyHighlight">                                                </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> OpIdx) &#123;</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Divide/Remainder by constant is typically much cheaper than by variable.</span></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isIntDivRem())</span></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OpIdx != 1;</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><span class="doxyHighlightComment">// All instructions in Insts belong to different blocks that all unconditionally</span></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><span class="doxyHighlightComment">// branch to a common successor. Analyze each instruction and return true if it</span></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlightComment">// would be possible to sink them into their successor, creating one common</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlightComment">// instruction instead. For every value that would be required to be provided by</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><span class="doxyHighlightComment">// PHI node (because an operand varies in each input block), add to PHIOperands.</span></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219" lineLink="#ae9efb27478c86bece81f1bf5bca2d348"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ae9efb27478c86bece81f1bf5bca2d348">canSinkInstructions</a>(</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Instruction &#42;&gt;</a> Insts,</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/use">Use</a> &#42;, <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a>&gt; &amp;PHIOperands) &#123;</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Prune out obviously bad instructions to move. Each instruction must have</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the same number of uses, and we check later that the uses are consistent.</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; NumUses;</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts) &#123;</span></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// These instructions may change or break semantics if moved.</span></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isEHPad() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isTokenTy())</span></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not try to sink an instruction in an infinite loop - it can cause</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this algorithm to infinite loop.</span></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()-&gt;getSingleSuccessor() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent())</span></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Conservatively return false if I is an inline-asm instruction. Sinking</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and merging inline-asm instructions can potentially create arguments</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that cannot satisfy the inline-asm constraints.</span></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the instruction has nomerge or convergent attribute, return false.</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isInlineAsm() || <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;cannotMerge() || <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isConvergent())</span></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NumUses)</span></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><span class="doxyHighlight">      NumUses = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumUses();</span></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumUses != <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumUses())</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I0 = Insts.<a href="/docs/api/classes/llvm/arrayref/#a721fc555cb3d8dc2a1a680dcc2ce69b2">front</a>();</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> I0MMRA = <a href="/docs/api/classes/llvm/mmrametadata">MMRAMetadata</a>(&#42;I0);</span></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts) &#123;</span></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isSameOperationAs(I0, <a href="/docs/api/classes/llvm/instruction/#aa7d8c7b3481309b28659543d1efdb41dacf591df2f648de38effb4c1a274d0d37">Instruction::CompareUsingIntersectedAttrs</a>))</span></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// swifterror pointers can only be used by a load or store; sinking a load</span></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// or store would require introducing a select for the pointer operand,</span></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// which isn&#39;t allowed for swifterror pointers.</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1)-&gt;isSwiftError())</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;isSwiftError())</span></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Treat MMRAs conservatively. This pass can be quite aggressive and</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// could drop a lot of MMRAs otherwise.</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/mmrametadata">MMRAMetadata</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) != I0MMRA)</span></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Uses must be consistent: If I0 is used in a phi node in the sink target,</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// then the other phi operands must match the instructions from Insts. This</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// also has to hold true for any phi nodes that would be created as a result</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of sinking. Both of these cases are represented by PhiOperands.</span></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/use">Use</a> &amp;U : I0-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</span></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = PHIOperands.find(&amp;U);</span></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It == PHIOperands.end())</span></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// There may be uses in other blocks when sinking into a loop header.</span></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ae04157f1cd3b64e93ebd44f8f65e395c">equal</a>(Insts, It-&gt;second))</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For calls to be sinkable, they must all be indirect, or have same callee.</span></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// I.e. if we have two direct calls to different callees, we don&#39;t want to</span></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// turn that into an indirect call. Likewise, if we have an indirect call,</span></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and a direct call, we don&#39;t actually want to have a single indirect call.</span></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallBase&gt;</a>(I0)) &#123;</span></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsIndirectCall = &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;isIndirectCall();</span></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveIndirectCalls = <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(Insts, IsIndirectCall);</span></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllCallsAreIndirect = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Insts, IsIndirectCall);</span></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HaveIndirectCalls) &#123;</span></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AllCallsAreIndirect)</span></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// All callees must be identical.</span></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Callee = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts) &#123;</span></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;CurrCallee = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getCalledOperand();</span></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Callee)</span></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><span class="doxyHighlight">          Callee = CurrCallee;</span></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Callee != CurrCallee)</span></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OI = 0, OE = I0-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); OI != OE; ++OI) &#123;</span></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = I0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(OI);</span></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getType()-&gt;isTokenTy())</span></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t touch any operand of token type.</span></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SameAsI0 = &#91;&amp;I0, OI&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumOperands() == I0-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>());</span></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(OI) == I0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(OI);</span></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Insts, SameAsI0)) &#123;</span></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// SROA can&#39;t speculate lifetime markers of selects/phis, and the</span></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// backend may handle such lifetimes incorrectly as well (#104776).</span></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t sink lifetimes if it would introduce a phi on the pointer</span></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// argument.</span></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ae97521436759fc2489301a34e621bbcd">isLifeTimeMarker</a>(I0) &amp;&amp; OI == 1 &amp;&amp;</span></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(Insts, &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1)-&gt;stripPointerCasts());</span></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><span class="doxyHighlight">          &#125;))</span></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &amp;&amp; !<a href="#aa85a3c04f64695265702d0b3c3d6ea1c">replacingOperandWithVariableIsCheap</a>(I0, OI)) ||</span></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><span class="doxyHighlight">          !<a href="/docs/api/namespaces/llvm/#ab42e397923eec18d3ab8ea88d280b63c">canReplaceOperandWithVariable</a>(I0, OI))</span></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We can&#39;t create a PHI from this GEP.</span></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a> = PHIOperands&#91;&amp;I0-&gt;<a href="/docs/api/classes/llvm/user/#a3f3b252f63d32a9a6e05208ce26562bf">getOperandUse</a>(OI)&#93;;</span></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts)</span></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(OI));</span></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><span class="doxyHighlightComment">// Assuming canSinkInstructions(Blocks) has returned true, sink the last</span></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><span class="doxyHighlightComment">// instruction of every block in Blocks to their common successor, commoning</span></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><span class="doxyHighlightComment">// into one instruction.</span></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345" lineLink="#abf69483b802f1e342399912142341c60"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#abf69483b802f1e342399912142341c60">sinkLastInstruction</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;BasicBlock&#42;&gt;</a> Blocks) &#123;</span></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BBEnd = Blocks&#91;0&#93;-&gt;getTerminator()-&gt;getSuccessor(0);</span></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// canSinkInstructions returning true guarantees that every block has at</span></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// least one non-terminator instruction.</span></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction&#42;,4&gt;</a> Insts;</span></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : Blocks) &#123;</span></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getPrevNode();</span></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != &amp;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>());</span></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><span class="doxyHighlight">      Insts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We don&#39;t need to do any more checking here; canSinkInstructions should</span></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have done it all for us.</span></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value&#42;, 4&gt;</a> NewOperands;</span></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;I0 = Insts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a58dc840fc84420b7f0b773794b8101c1">front</a>();</span></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> O = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = I0-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); O != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++O) &#123;</span></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This check is different to that in canSinkInstructions. There, we</span></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cared about the global view once simplifycfg (and instcombine) have</span></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// completed - it takes into account PHIs that become trivially</span></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// simplifiable.  However here we need a more local view; if an operand</span></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// differs we create a PHI and rely on instcombine to clean up the very</span></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// small mess we may make.</span></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedPHI = <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(Insts, &#91;&amp;I0, O&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(O) != I0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(O);</span></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NeedPHI) &#123;</span></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><span class="doxyHighlight">      NewOperands.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(I0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(O));</span></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a new PHI in the successor block and populate it.</span></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = I0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(O);</span></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getType()-&gt;isTokenTy() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t PHI tokens!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN =</span></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getType(), Insts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(), <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.sink&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><span class="doxyHighlight">    PN-&gt;insertBefore(BBEnd-&gt;begin());</span></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts)</span></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><span class="doxyHighlight">      PN-&gt;addIncoming(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(O), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</span></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><span class="doxyHighlight">    NewOperands.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PN);</span></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Arbitrarily use I0 as the new &quot;common&quot; instruction; remap its operands</span></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and move it to the start of the successor block.</span></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> O = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = I0-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>(); O != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++O)</span></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><span class="doxyHighlight">    I0-&gt;<a href="/docs/api/classes/llvm/user/#a3f3b252f63d32a9a6e05208ce26562bf">getOperandUse</a>(O).<a href="/docs/api/classes/llvm/use/#a40360b4fa7b8e6920a68e5a8a0814f1f">set</a>(NewOperands&#91;O&#93;);</span></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><span class="doxyHighlight">  I0-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(&#42;BBEnd, BBEnd-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update metadata and IR flags, and merge debug locations.</span></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts)</span></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != I0) &#123;</span></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The debug location for the &quot;common&quot; instruction is the merged locations</span></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// of all the commoned instructions.  We start with the original location</span></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// of the &quot;common&quot; instruction and iteratively merge each location in the</span></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// loop below.</span></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This is an N-way merge, which will be inefficient if I0 is a CallInst.</span></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// However, as N-way merge for CallInst is rare, so we use simplified API</span></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instead of using complex API for N-way merge.</span></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><span class="doxyHighlight">      I0-&gt;<a href="/docs/api/classes/llvm/instruction/#ae88ca601f663c55cafa95cf742076aad">applyMergedLocation</a>(I0-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a9b43098c569ea8289ed1ab70ee9a00af">combineMetadataForCSE</a>(I0, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><span class="doxyHighlight">      I0-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ea9acbe7fd20332ea6ccdb0183d6395">andIRFlags</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(I0)) &#123;</span></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> = CB-&gt;tryIntersectAttributes(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallBase&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;We should not be trying to sink callbases &quot;</span></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><span class="doxyHighlight">                          </span><span class="doxyHighlightStringLiteral">&quot;with non-intersectable attributes&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// For NDEBUG Compile.</span></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><span class="doxyHighlight">        (void)<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a>;</span></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(I0-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())) &#123;</span></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// canSinkLastInstruction checked that all instructions are only used by</span></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// phi nodes in a way that allows replacing the phi node with the common</span></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instruction.</span></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(U);</span></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><span class="doxyHighlight">    PN-&gt;replaceAllUsesWith(I0);</span></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><span class="doxyHighlight">    PN-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Finally nuke all instructions apart from the common instruction.</span></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Insts) &#123;</span></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == I0)</span></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The remaining uses are debug users, replace those with the common inst.</span></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In most (all?) cases this just introduces a use-before-def.</span></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;user&#95;empty() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Inst unexpectedly still has non-dbg users&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(I0);</span></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><span class="doxyHighlightComment">/// Check whether BB&#39;s predecessors end with unconditional branches. If it is</span></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><span class="doxyHighlightComment">/// true, sink any common code from the predecessors to BB.</span></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442" lineLink="#a7da8333874d1ad28bd987d4e7c474e53"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a7da8333874d1ad28bd987d4e7c474e53">sinkCommonCodeFromPredecessors</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU) &#123;</span></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We support two situations:</span></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   (1) all incoming arcs are unconditional</span></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   (2) there are non-unconditional incoming arcs</span></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (2) is very common in switch defaults and</span></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// else-if patterns;</span></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   if (a) f(1);</span></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   else if (b) f(2);</span></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// produces:</span></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       &#91;if&#93;</span></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      /    \\</span></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><span class="doxyHighlightComment">  //    &#91;f(1)&#93; &#91;if&#93;</span></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      |     | \\</span></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><span class="doxyHighlightComment">  //      |     |  |</span></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      |  &#91;f(2)&#93;|</span></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       \\    | /</span></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        &#91; end &#93;</span></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#91;end&#93; has two unconditional predecessor arcs and one conditional. The</span></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// conditional refers to the implicit empty &#39;else&#39; arc. This conditional</span></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// arc can also be caused by an empty default block in a switch.</span></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In this case, we attempt to sink code from all &#42;unconditional&#42; arcs.</span></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we can sink instructions from these arcs (determined during the scan</span></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// phase below) we insert a common successor for all unconditional arcs and</span></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// connect that to &#91;end&#93;, to enable sinking:</span></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       &#91;if&#93;</span></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      /    \\</span></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><span class="doxyHighlightComment">  //    &#91;x(1)&#93; &#91;if&#93;</span></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      |     | \\</span></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><span class="doxyHighlightComment">  //      |     |  \\</span></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><span class="doxyHighlightComment">  //      |  &#91;x(2)&#93; |</span></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       \\   /    |</span></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#91;sink.split&#93; |</span></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//         \\     /</span></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//         &#91; end &#93;</span></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock&#42;,4&gt;</a> UnconditionalPreds;</span></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveNonUnconditionalPredecessors = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PredBB : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PredBr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PredBB-&gt;getTerminator());</span></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBr &amp;&amp; PredBr-&gt;isUnconditional())</span></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><span class="doxyHighlight">      UnconditionalPreds.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PredBB);</span></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><span class="doxyHighlight">      HaveNonUnconditionalPredecessors = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UnconditionalPreds.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt; 2)</span></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We take a two-step approach to tail sinking. First we scan from the end of</span></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// each block upwards in lockstep. If the n&#39;th instruction from the end of each</span></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block can be sunk, those instructions are added to ValuesToSink and we</span></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// carry on. If we can sink an instruction but need to PHI-merge some operands</span></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (because they&#39;re not identical in each instruction) we add these to</span></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHIOperands.</span></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We prepopulate PHIOperands with the phis that already exist in BB.</span></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const Use &#42;, SmallVector&lt;Value &#42;, 4&gt;</a>&gt; PHIOperands;</span></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;BasicBlock &#42;, const Use &#42;, 4&gt;</a> IncomingVals;</span></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/use">Use</a> &amp;U : PN.incoming&#95;values())</span></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><span class="doxyHighlight">      IncomingVals.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;PN.getIncomingBlock(U), &amp;U&#125;);</span></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a> = PHIOperands&#91;IncomingVals&#91;UnconditionalPreds&#91;0&#93;&#93;&#93;;</span></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : UnconditionalPreds)</span></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(&#42;IncomingVals&#91;Pred&#93;);</span></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> ScanIdx = 0;</span></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value&#42;,4&gt;</a> InstructionsToSink;</span></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#aa688b7ef72ecbc2c80a05e2859e24078">LockstepReverseIterator</a> LRI(UnconditionalPreds);</span></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (LRI.isValid() &amp;&amp;</span></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><span class="doxyHighlight">         <a href="#ae9efb27478c86bece81f1bf5bca2d348">canSinkInstructions</a>(&#42;LRI, PHIOperands)) &#123;</span></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;SINK: instruction can be sunk: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;(&#42;LRI)&#91;0&#93;</span></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><span class="doxyHighlight">    InstructionsToSink.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>((&#42;LRI).begin(), (&#42;LRI).end());</span></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><span class="doxyHighlight">    ++ScanIdx;</span></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><span class="doxyHighlight">    --LRI;</span></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If no instructions can be sunk, early-return.</span></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScanIdx == 0)</span></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> followedByDeoptOrUnreachable = <a href="/docs/api/namespaces/llvm/#a15055c7e3a33b44c293df24e4ba7bc5e">IsBlockFollowedByDeoptOrUnreachable</a>(BB);</span></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!followedByDeoptOrUnreachable) &#123;</span></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check whether this is the pointer operand of a load/store.</span></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsMemOperand = &#91;&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) &#123;</span></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> U.getOperandNo() == <a href="/docs/api/classes/llvm/loadinst/#a976e49f35fef77df271900abfdc42cd5">LoadInst::getPointerOperandIndex</a>();</span></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> U.getOperandNo() == <a href="/docs/api/classes/llvm/storeinst/#add13b402166ae4d70f5b93c3c4cfba99">StoreInst::getPointerOperandIndex</a>();</span></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Okay, we &#42;could&#42; sink last ScanIdx instructions. But how many can we</span></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// actually sink before encountering instruction that is unprofitable to</span></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sink?</span></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ProfitableToSinkInstruction = &#91;&amp;&#93;(<a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/lockstepreverseiterator/#aa688b7ef72ecbc2c80a05e2859e24078">LockstepReverseIterator</a> &amp;LRI) &#123;</span></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumPHIInsts = 0;</span></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : (&#42;LRI)&#91;0&#93;-&gt;operands()) &#123;</span></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = PHIOperands.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(&amp;U);</span></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It != PHIOperands.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(It-&gt;second, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><span class="doxyHighlight">              return InstructionsToSink.contains(V);</span></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><span class="doxyHighlight">            &#125;)) &#123;</span></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><span class="doxyHighlight">          ++NumPHIInsts;</span></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Do not separate a load/store from the gep producing the address.</span></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// The gep can likely be folded into the load/store as an addressing</span></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// mode. Additionally, a load of a gep is easier to analyze than a</span></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// load of a phi.</span></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsMemOperand(U) &amp;&amp;</span></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(It-&gt;second, &#91;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123; return isa&lt;GEPOperator&gt;(V); &#125;))</span></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// FIXME: this check is overly optimistic. We may end up not sinking</span></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// said instruction, due to the very same profitability check.</span></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// See @creating&#95;too&#95;many&#95;phis in sink-common-code.ll.</span></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;SINK: #phi insts: &quot;</span><span class="doxyHighlight"> &lt;&lt; NumPHIInsts &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NumPHIInsts &lt;= 1;</span></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We&#39;ve determined that we are going to sink last ScanIdx instructions,</span></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and recorded them in InstructionsToSink. Now, some instructions may be</span></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// unprofitable to sink. But that determination depends on the instructions</span></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that we are going to sink.</span></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// First, forward scan: find the first instruction unprofitable to sink,</span></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// recording all the ones that are profitable to sink.</span></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: would it be better, after we detect that not all are profitable.</span></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to either record the profitable ones, or erase the unprofitable ones?</span></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Maybe we need to choose (at runtime) the one that will touch least</span></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instrs?</span></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><span class="doxyHighlight">    LRI.reset();</span></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Idx = 0;</span></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 4&gt;</a> InstructionsProfitableToSink;</span></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (Idx &lt; ScanIdx) &#123;</span></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ProfitableToSinkInstruction(LRI)) &#123;</span></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Too many PHIs would be created.</span></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;SINK: stopping here, too many PHIs would be created!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><span class="doxyHighlight">      InstructionsProfitableToSink.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>((&#42;LRI).begin(), (&#42;LRI).end());</span></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><span class="doxyHighlight">      --LRI;</span></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><span class="doxyHighlight">      ++Idx;</span></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If no instructions can be sunk, early-return.</span></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Idx == 0)</span></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Did we determine that (only) some instructions are unprofitable to sink?</span></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Idx &lt; ScanIdx) &#123;</span></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Okay, some instructions are unprofitable.</span></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><span class="doxyHighlight">      ScanIdx = Idx;</span></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><span class="doxyHighlight">      InstructionsToSink = InstructionsProfitableToSink;</span></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// But, that may make other instructions unprofitable, too.</span></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// So, do a backward scan, do any earlier instructions become</span></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// unprofitable?</span></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><span class="doxyHighlight">          !ProfitableToSinkInstruction(LRI) &amp;&amp;</span></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;We already know that the last instruction is unprofitable to sink&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><span class="doxyHighlight">      ++LRI;</span></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><span class="doxyHighlight">      --Idx;</span></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (Idx &gt;= 0) &#123;</span></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If we detect that an instruction becomes unprofitable to sink,</span></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// all earlier instructions won&#39;t be sunk either,</span></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// so preemptively keep InstructionsProfitableToSink in sync.</span></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// FIXME: is this the most performant approach?</span></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;LRI)</span></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><span class="doxyHighlight">          InstructionsProfitableToSink.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ProfitableToSinkInstruction(LRI)) &#123;</span></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Everything starting with this instruction won&#39;t be sunk.</span></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><span class="doxyHighlight">          ScanIdx = Idx;</span></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><span class="doxyHighlight">          InstructionsToSink = InstructionsProfitableToSink;</span></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><span class="doxyHighlight">        ++LRI;</span></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><span class="doxyHighlight">        --Idx;</span></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If no instructions can be sunk, early-return.</span></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScanIdx == 0)</span></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HaveNonUnconditionalPredecessors) &#123;</span></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!followedByDeoptOrUnreachable) &#123;</span></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// It is always legal to sink common instructions from unconditional</span></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// predecessors. However, if not all predecessors are unconditional,</span></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// this transformation might be pessimizing. So as a rule of thumb,</span></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// don&#39;t do it unless we&#39;d sink at least one non-speculatable instruction.</span></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// See https://bugs.llvm.org/show&#95;bug.cgi?id=30244</span></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><span class="doxyHighlight">      LRI.reset();</span></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Idx = 0;</span></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Profitable = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (Idx &lt; ScanIdx) &#123;</span></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>((&#42;LRI)&#91;0&#93;)) &#123;</span></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><span class="doxyHighlight">          Profitable = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><span class="doxyHighlight">        --LRI;</span></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><span class="doxyHighlight">        ++Idx;</span></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Profitable)</span></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;SINK: Splitting edge\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We have a conditional edge and we&#39;re going to sink some instructions.</span></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Insert a new block postdominating all blocks we&#39;re going to sink from.</span></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a9d391b6acc6d90c9b8a8442324b1aa6f">SplitBlockPredecessors</a>(BB, UnconditionalPreds, </span><span class="doxyHighlightStringLiteral">&quot;.sink.split&quot;</span><span class="doxyHighlight">, DTU))</span></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Edges couldn&#39;t be split.</span></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we&#39;ve analyzed all potential sinking candidates, perform the</span></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// actual sink. We iteratively sink the last non-terminator of the source</span></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// blocks into their common successor unless doing so would require too</span></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// many PHI instructions to be generated (currently only one PHI is allowed</span></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// per sunk instruction).</span></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can use InstructionsToSink to discount values needing PHI-merging that will</span></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// actually be sunk in a later iteration. This allows us to be more</span></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// aggressive in what we sink. This does allow a false positive where we</span></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sink presuming a later value will also be sunk, but stop half way through</span></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and never actually sink it which means we produce more PHIs than intended.</span></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is unlikely in practice though.</span></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SinkIdx = 0;</span></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; SinkIdx != ScanIdx; ++SinkIdx) &#123;</span></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;SINK: Sink: &quot;</span></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><span class="doxyHighlight">                      &lt;&lt; &#42;UnconditionalPreds&#91;0&#93;-&gt;getTerminator()-&gt;getPrevNode()</span></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Because we&#39;ve sunk every instruction in turn, the current instruction to</span></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sink is always at index 0</span></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><span class="doxyHighlight">    LRI.reset();</span></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><span class="doxyHighlight">    <a href="#abf69483b802f1e342399912142341c60">sinkLastInstruction</a>(UnconditionalPreds);</span></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><span class="doxyHighlight">    NumSinkCommonInstrs++;</span></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SinkIdx != 0)</span></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><span class="doxyHighlight">    ++NumSinkCommonCode;</span></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets">CompatibleSets</a> &#123;</span></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a440f5f28ff594ce0e5ea1c5ac9d22e3e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a440f5f28ff594ce0e5ea1c5ac9d22e3e">SetTy</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;InvokeInst &#42;, 2&gt;</a>;</span></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a9ee19845cd1e1529458781494f344d46"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SetTy, 1&gt;</a> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a9ee19845cd1e1529458781494f344d46">Sets</a>;</span></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a4ef2eab86cf6fefd01ef4607cc834432">shouldBelongToSameSet</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;InvokeInst &#42;&gt;</a> Invokes);</span></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a440f5f28ff594ce0e5ea1c5ac9d22e3e">SetTy</a> &amp;<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#ada1d29fe3163e8e6a2cfd1e0e0085867">getCompatibleSet</a>(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a8bc804ff4c7a60743481aaf6fc30ca01">insert</a>(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#ada1d29fe3163e8e6a2cfd1e0e0085867"><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a440f5f28ff594ce0e5ea1c5ac9d22e3e">CompatibleSets::SetTy</a> &amp;<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#ada1d29fe3163e8e6a2cfd1e0e0085867">CompatibleSets::getCompatibleSet</a>(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Perform a linear scan over all the existing sets, see if the new &#96;invoke&#96;</span></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is compatible with any particular set. Since we know that all the &#96;invokes&#96;</span></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// within a set are compatible, only check the first &#96;invoke&#96; in each set.</span></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// WARNING: at worst, this has quadratic complexity.</span></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a440f5f28ff594ce0e5ea1c5ac9d22e3e">CompatibleSets::SetTy</a> &amp;Set : <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a9ee19845cd1e1529458781494f344d46">Sets</a>) &#123;</span></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a4ef2eab86cf6fefd01ef4607cc834432">CompatibleSets::shouldBelongToSameSet</a>(&#123;Set.front(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>&#125;))</span></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Set;</span></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, we either had no sets yet, or this invoke forms a new set.</span></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a9ee19845cd1e1529458781494f344d46">Sets</a>.emplace&#95;back();</span></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a8bc804ff4c7a60743481aaf6fc30ca01"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a8bc804ff4c7a60743481aaf6fc30ca01">CompatibleSets::insert</a>(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#ada1d29fe3163e8e6a2cfd1e0e0085867">getCompatibleSet</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>).<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732" lineLink="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a4ef2eab86cf6fefd01ef4607cc834432"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/compatiblesets/#a4ef2eab86cf6fefd01ef4607cc834432">CompatibleSets::shouldBelongToSameSet</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;InvokeInst &#42;&gt;</a> Invokes) &#123;</span></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Invokes.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Always called with exactly two candidates.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Can we theoretically merge these &#96;invoke&#96;s?</span></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsIllegalToMerge = &#91;&#93;(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;cannotMerge() || <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;isInlineAsm();</span></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(Invokes, IsIllegalToMerge))</span></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Either both &#96;invoke&#96;s must be   direct,</span></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or     both &#96;invoke&#96;s must be indirect.</span></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsIndirectCall = &#91;&#93;(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;isIndirectCall(); &#125;;</span></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveIndirectCalls = <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(Invokes, IsIndirectCall);</span></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllCallsAreIndirect = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Invokes, IsIndirectCall);</span></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HaveIndirectCalls) &#123;</span></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AllCallsAreIndirect)</span></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// All callees must be identical.</span></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Callee = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : Invokes) &#123;</span></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;CurrCallee = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getCalledOperand();</span></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrCallee &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There is always a called operand.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Callee)</span></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><span class="doxyHighlight">        Callee = CurrCallee;</span></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Callee != CurrCallee)</span></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Either both &#96;invoke&#96;s must not have a normal destination,</span></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or     both &#96;invoke&#96;s must     have a normal destination,</span></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> HasNormalDest = &#91;&#93;(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UnreachableInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getNormalDest()-&gt;getFirstNonPHIOrDbg());</span></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(Invokes, HasNormalDest)) &#123;</span></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not merge &#96;invoke&#96; that does not have a normal destination with one</span></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that does have a normal destination, even though doing so would be legal.</span></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Invokes, HasNormalDest))</span></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// All normal destinations must be identical.</span></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NormalBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : Invokes) &#123;</span></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CurrNormalBB = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getNormalDest();</span></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrNormalBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There is always a &#39;continue to&#39; basic block.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NormalBB)</span></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><span class="doxyHighlight">        NormalBB = CurrNormalBB;</span></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NormalBB != CurrNormalBB)</span></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In the normal destination, the incoming values for these two &#96;invoke&#96;s</span></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// must be compatible.</span></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 16&gt;</a> EquivalenceSet(Invokes.begin(), Invokes.end());</span></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a7851d1e39cf3c6f27aa6fe911056a142">incomingValuesAreCompatible</a>(</span></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><span class="doxyHighlight">            NormalBB, &#123;Invokes&#91;0&#93;-&gt;getParent(), Invokes&#91;1&#93;-&gt;getParent()&#125;,</span></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><span class="doxyHighlight">            &amp;EquivalenceSet))</span></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All unwind destinations must be identical.</span></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We know that because we have started from said unwind destination.</span></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UnwindBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : Invokes) &#123;</span></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CurrUnwindBB = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getUnwindDest();</span></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurrUnwindBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There is always an &#39;unwind to&#39; basic block.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UnwindBB)</span></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><span class="doxyHighlight">      UnwindBB = CurrUnwindBB;</span></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UnwindBB == CurrUnwindBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected unwind destination.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In the unwind destination, the incoming values for these two &#96;invoke&#96;s</span></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// must be compatible.</span></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a7851d1e39cf3c6f27aa6fe911056a142">incomingValuesAreCompatible</a>(</span></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><span class="doxyHighlight">          Invokes.<a href="/docs/api/classes/llvm/arrayref/#a721fc555cb3d8dc2a1a680dcc2ce69b2">front</a>()-&gt;getUnwindDest(),</span></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><span class="doxyHighlight">          &#123;Invokes&#91;0&#93;-&gt;getParent(), Invokes&#91;1&#93;-&gt;getParent()&#125;))</span></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ignoring arguments, these &#96;invoke&#96;s must be identical,</span></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// including operand bundles.</span></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;II0 = Invokes.<a href="/docs/api/classes/llvm/arrayref/#a721fc555cb3d8dc2a1a680dcc2ce69b2">front</a>();</span></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : Invokes.<a href="/docs/api/classes/llvm/arrayref/#a55089293ebaccd683a82d97170041376">drop&#95;front</a>())</span></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;isSameOperationAs(II0, <a href="/docs/api/classes/llvm/instruction/#aa7d8c7b3481309b28659543d1efdb41dacf591df2f648de38effb4c1a274d0d37">Instruction::CompareUsingIntersectedAttrs</a>))</span></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Can we theoretically form the data operands for the merged &#96;invoke&#96;?</span></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsIllegalToMergeArguments = &#91;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>) &#123;</span></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;U0 = std::get&lt;0&gt;(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>);</span></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/use">Use</a> &amp;U1 = std::get&lt;1&gt;(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>);</span></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (U0 == U1)</span></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> U0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac9542ee3a689ae9574b7807c96107d89">isTokenTy</a>() ||</span></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><span class="doxyHighlight">           !<a href="/docs/api/namespaces/llvm/#ab42e397923eec18d3ab8ea88d280b63c">canReplaceOperandWithVariable</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U0.<a href="/docs/api/classes/llvm/use/#a53a48d67682705c5f7f06ffc850fd622">getUser</a>()),</span></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><span class="doxyHighlight">                                          U0.<a href="/docs/api/classes/llvm/use/#a541187eb976df2189b40b3f62ed2cee0">getOperandNo</a>());</span></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Invokes.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Always called with exactly two candidates.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(Invokes&#91;0&#93;-&gt;data&#95;ops(), Invokes&#91;1&#93;-&gt;data&#95;ops()),</span></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><span class="doxyHighlight">             IsIllegalToMergeArguments))</span></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><span class="doxyHighlightComment">// Merge all invokes in the provided set, all of which are compatible</span></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><span class="doxyHighlightComment">// as per the &#96;CompatibleSets::shouldBelongToSameSet()&#96;.</span></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844" lineLink="#acc8066950deec241b4fafe0700ff5f2c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#acc8066950deec241b4fafe0700ff5f2c">mergeCompatibleInvokesImpl</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;InvokeInst &#42;&gt;</a> Invokes,</span></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU) &#123;</span></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Invokes.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &gt;= 2 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Must have at least two invokes to merge.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType, 8&gt;</a> Updates;</span></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(2 + 3 &#42; Invokes.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</span></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasNormalDest =</span></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UnreachableInst&gt;</a>(Invokes&#91;0&#93;-&gt;getNormalDest()-&gt;getFirstNonPHIOrDbg());</span></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clone one of the invokes into a new basic block.</span></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Since they are all compatible, it doesn&#39;t matter which invoke is cloned.</span></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;MergedInvoke = &#91;&amp;Invokes, HasNormalDest&#93;() &#123;</span></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;II0 = Invokes.<a href="/docs/api/classes/llvm/arrayref/#a721fc555cb3d8dc2a1a680dcc2ce69b2">front</a>();</span></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;II0BB = II0-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InsertBeforeBlock =</span></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><span class="doxyHighlight">        II0-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getIterator()-&gt;getNextNode();</span></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;Func = II0BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = II0-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>();</span></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;MergedInvokeBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><span class="doxyHighlight">        Ctx, II0BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.invoke&quot;</span><span class="doxyHighlight">, Func, InsertBeforeBlock);</span></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MergedInvoke = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;InvokeInst&gt;</a>(II0-&gt;<a href="/docs/api/classes/llvm/instruction/#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>());</span></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// NOTE: all invokes have the same attributes, so no handling needed.</span></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><span class="doxyHighlight">    MergedInvoke-&gt;<a href="/docs/api/classes/llvm/instruction/#afcd9d2ea284c4d90541291ff9c47d332">insertInto</a>(MergedInvokeBB, MergedInvokeBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasNormalDest) &#123;</span></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This set does not have a normal destination,</span></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// so just form a new block with unreachable terminator.</span></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;MergedNormalDest = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><span class="doxyHighlight">          Ctx, II0BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.cont&quot;</span><span class="doxyHighlight">, Func, InsertBeforeBlock);</span></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(Ctx, MergedNormalDest);</span></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><span class="doxyHighlight">      MergedInvoke-&gt;<a href="/docs/api/classes/llvm/invokeinst/#a2d3bf0d61fe883d8ceb95c68e03db669">setNormalDest</a>(MergedNormalDest);</span></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The unwind destination, however, remainds identical for all invokes here.</span></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MergedInvoke;</span></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><span class="doxyHighlight">  &#125;();</span></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Predecessor blocks that contained these invokes will now branch to</span></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the new block that contains the merged invoke, ...</span></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : Invokes)</span></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><span class="doxyHighlight">          &#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent(), MergedInvoke-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()&#125;);</span></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ... which has the new &#96;unreachable&#96; block as normal destination,</span></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// or unwinds to the (same for all &#96;invoke&#96;s in this set) &#96;landingpad&#96;,</span></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBBOfMergedInvoke : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(MergedInvoke))</span></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, MergedInvoke-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(),</span></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><span class="doxyHighlight">                         SuccBBOfMergedInvoke&#125;);</span></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Since predecessor blocks now unconditionally branch to a new block,</span></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// they no longer branch to their original successors.</span></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : Invokes)</span></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccOfPredBB : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent()))</span></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><span class="doxyHighlight">        Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><span class="doxyHighlight">            &#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent(), SuccOfPredBB&#125;);</span></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsIndirectCall = Invokes&#91;0&#93;-&gt;isIndirectCall();</span></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Form the merged operands for the merged invoke.</span></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : MergedInvoke-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) &#123;</span></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only PHI together the indirect callees and data operands.</span></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MergedInvoke-&gt;<a href="/docs/api/classes/llvm/callbase/#a754b47054852401f87e52805d15bdf05">isCallee</a>(&amp;U)) &#123;</span></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsIndirectCall)</span></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MergedInvoke-&gt;<a href="/docs/api/classes/llvm/callbase/#aebb1d2333537383d23ad22081752930f">isDataOperand</a>(&amp;U))</span></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t create trivial PHI&#39;s with all-identical incoming values.</span></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedPHI = <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(Invokes, &#91;&amp;U&#93;(<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getOperand(U.getOperandNo()) != U.get();</span></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NeedPHI)</span></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Form a PHI out of all the data ops under this index.</span></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(</span></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><span class="doxyHighlight">        U-&gt;getType(), </span><span class="doxyHighlightComment">/&#42;NumReservedValues=&#42;/</span><span class="doxyHighlight">Invokes.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, MergedInvoke-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : Invokes)</span></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><span class="doxyHighlight">      PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getOperand(U.getOperandNo()), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent());</span></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><span class="doxyHighlight">    U.set(PN);</span></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We&#39;ve ensured that each PHI node has compatible (identical) incoming values</span></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// when coming from each of the &#96;invoke&#96;s in the current merge set,</span></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so update the PHI nodes accordingly.</span></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(MergedInvoke))</span></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><span class="doxyHighlight">    <a href="#a0375fe3378c23272b805320851744043">addPredecessorToBlock</a>(Succ, </span><span class="doxyHighlightComment">/&#42;NewPred=&#42;/</span><span class="doxyHighlight">MergedInvoke-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(),</span></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42;ExistPred=&#42;/</span><span class="doxyHighlight">Invokes.<a href="/docs/api/classes/llvm/arrayref/#a721fc555cb3d8dc2a1a680dcc2ce69b2">front</a>()-&gt;getParent());</span></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// And finally, replace the original &#96;invoke&#96;s with an unconditional branch</span></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to the block with the merged &#96;invoke&#96;. Also, give that merged &#96;invoke&#96;</span></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the merged debugloc of all the original &#96;invoke&#96;s.</span></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dilocation">DILocation</a> &#42;MergedDebugLoc = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : Invokes) &#123;</span></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the debug location common to all the original &#96;invoke&#96;s.</span></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MergedDebugLoc)</span></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><span class="doxyHighlight">      MergedDebugLoc = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getDebugLoc();</span></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><span class="doxyHighlight">      MergedDebugLoc =</span></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/dilocation/#a78cc51c415c7e64b5efe2c8458fbd35a">DILocation::getMergedLocation</a>(MergedDebugLoc, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// And replace the old &#96;invoke&#96; with an unconditionally branch</span></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to the block with the merged &#96;invoke&#96;.</span></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OrigSuccBB : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent()))</span></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><span class="doxyHighlight">      OrigSuccBB-&gt;removePredecessor(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent());</span></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(MergedInvoke-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getParent());</span></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The unconditional branch is part of the replacement for the original</span></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// invoke, so should use its DebugLoc.</span></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><span class="doxyHighlight">    BI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> = MergedInvoke-&gt;<a href="/docs/api/classes/llvm/callbase/#afb49554840d9c699b6b3a2a09361dbd8">tryIntersectAttributes</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Merged invokes with incompatible attributes&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For NDEBUG Compile</span></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><span class="doxyHighlight">    (void)<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/lib/target/aarch64/disassembler/aarch64disassembler-cpp/#abdb086b34295fb7aa09493c62d798465">Success</a>;</span></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;replaceAllUsesWith(MergedInvoke);</span></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><span class="doxyHighlight">    ++NumInvokesMerged;</span></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><span class="doxyHighlight">  MergedInvoke-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(MergedDebugLoc);</span></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><span class="doxyHighlight">  ++NumInvokeSetsFormed;</span></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><span class="doxyHighlightComment">/// If this block is a &#96;landingpad&#96; exception handling block, categorize all</span></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><span class="doxyHighlightComment">/// the predecessor &#96;invoke&#96;s into sets, with all &#96;invoke&#96;s in each set</span></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><span class="doxyHighlightComment">/// being &quot;mergeable&quot; together, and then merge invokes in each set together.</span></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"><span class="doxyHighlightComment">/// This is a weird mix of hoisting and sinking. Visually, it goes from:</span></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><span class="doxyHighlightComment">///          &#91;...&#93;        &#91;...&#93;</span></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><span class="doxyHighlightComment">///            |            |</span></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><span class="doxyHighlightComment">///        &#91;invoke0&#93;    &#91;invoke1&#93;</span></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><span class="doxyHighlightComment">///           / \\          / \\</span></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><span class="doxyHighlightComment">///     &#91;cont0&#93; &#91;landingpad&#93; &#91;cont1&#93;</span></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><span class="doxyHighlightComment">/// to:</span></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><span class="doxyHighlightComment">///      &#91;...&#93; &#91;...&#93;</span></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><span class="doxyHighlightComment">///          \\ /</span></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><span class="doxyHighlightComment">///       &#91;invoke&#93;</span></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><span class="doxyHighlightComment">///          / \\</span></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><span class="doxyHighlightComment">///     &#91;cont&#93; &#91;landingpad&#93;</span></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><span class="doxyHighlightComment">/// But of course we can only do that if the invokes share the &#96;landingpad&#96;,</span></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><span class="doxyHighlightComment">/// edges invoke0-&gt;cont0 and invoke1-&gt;cont1 are &quot;compatible&quot;,</span></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><span class="doxyHighlightComment">/// and the invoked functions are &quot;compatible&quot;.</span></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996" lineLink="#aa7e215bdd027461da0d8205cf5ef0e32"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aa7e215bdd027461da0d8205cf5ef0e32">mergeCompatibleInvokes</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU) &#123;</span></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a763f9b0b99f42804e6ab2d09ebc395a1">EnableMergeCompatibleInvokes</a>)</span></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: generalize to all exception handling blocks?</span></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ac3a2a666b5703b8c9bda318ef18c731c">isLandingPad</a>())</span></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><span class="doxyHighlight">  CompatibleSets Grouper;</span></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Record all the predecessors of this &#96;landingpad&#96;. As per verifier,</span></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the only allowed predecessor is the unwind edge of an &#96;invoke&#96;.</span></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We want to group &quot;compatible&quot; &#96;invokes&#96; into the same set to be merged.</span></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB))</span></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><span class="doxyHighlight">    Grouper.insert(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;InvokeInst&gt;</a>(PredBB-&gt;getTerminator()));</span></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013"></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// And now, merge &#96;invoke&#96;s that were grouped togeter.</span></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;InvokeInst &#42;&gt;</a> Invokes : Grouper.Sets) &#123;</span></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Invokes.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() &lt; 2)</span></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><span class="doxyHighlight">    <a href="#acc8066950deec241b4fafe0700ff5f2c">mergeCompatibleInvokesImpl</a>(Invokes, DTU);</span></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><span class="doxyHighlightComment">/// Track ephemeral values, which should be ignored for cost-modelling</span></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><span class="doxyHighlightComment">/// purposes. Requires walking instructions in reverse order.</span></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/ephemeralvaluetracker"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/ephemeralvaluetracker">EphemeralValueTracker</a> &#123;</span></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Instruction &#42;, 32&gt;</a> EphValues;</span></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isEphemeral(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AssumeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayHaveSideEffects() &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator() &amp;&amp;</span></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users(), &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</span></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><span class="doxyHighlight">             return EphValues.count(cast&lt;Instruction&gt;(U));</span></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><span class="doxyHighlight">           &#125;);</span></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/ephemeralvaluetracker/#a40bb8c865a86e943a8014c8a0583177f"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/ephemeralvaluetracker/#a40bb8c865a86e943a8014c8a0583177f">track</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isEphemeral(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><span class="doxyHighlight">      EphValues.insert(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/ephemeralvaluetracker/#a967c6e2064004abc7dbdf3bab2f05e11"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/ephemeralvaluetracker/#a967c6e2064004abc7dbdf3bab2f05e11">contains</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EphValues.contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); &#125;</span></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><span class="doxyHighlightComment">/// Determine if we can hoist sink a sole store instruction out of a</span></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"><span class="doxyHighlightComment">/// conditional block.</span></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056"><span class="doxyHighlightComment">/// We are looking for code like the following:</span></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057"><span class="doxyHighlightComment">///   BrBB:</span></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058"><span class="doxyHighlightComment">///     store i32 %add, i32&#42; %arrayidx2</span></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059"><span class="doxyHighlightComment">///     ... // No other stores or function calls (we could be calling a memory</span></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060"><span class="doxyHighlightComment">///     ... // function).</span></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"><span class="doxyHighlightComment">///     %cmp = icmp ult %x, %y</span></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062"><span class="doxyHighlightComment">///     br i1 %cmp, label %EndBB, label %ThenBB</span></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063"><span class="doxyHighlightComment">///   ThenBB:</span></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064"><span class="doxyHighlightComment">///     store i32 %add5, i32&#42; %arrayidx2</span></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065"><span class="doxyHighlightComment">///     br label EndBB</span></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066"><span class="doxyHighlightComment">///   EndBB:</span></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067"><span class="doxyHighlightComment">///     ...</span></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068"><span class="doxyHighlightComment">///   We are going to transform this into:</span></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069"><span class="doxyHighlightComment">///   BrBB:</span></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"><span class="doxyHighlightComment">///     store i32 %add, i32&#42; %arrayidx2</span></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"><span class="doxyHighlightComment">///     ... //</span></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072"><span class="doxyHighlightComment">///     %cmp = icmp ult %x, %y</span></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"><span class="doxyHighlightComment">///     %add.add5 = select i1 %cmp, i32 %add, %add5</span></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><span class="doxyHighlightComment">///     store i32 %add.add5, i32&#42; %arrayidx2</span></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><span class="doxyHighlightComment">///     ...</span></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><span class="doxyHighlightComment">/// \\return The pointer to the value of the previous store if the store can be</span></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><span class="doxyHighlightComment">///         hoisted into the predecessor block. 0 otherwise.</span></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079" lineLink="#a8bb9afd23da56f99f3bcdb52e9c74320"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a8bb9afd23da56f99f3bcdb52e9c74320">isSafeToSpeculateStore</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BrBB,</span></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;StoreBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EndBB) &#123;</span></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;StoreToHoist = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!StoreToHoist)</span></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Volatile or atomic.</span></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!StoreToHoist-&gt;<a href="/docs/api/classes/llvm/storeinst/#a70f38e046a2d6f8d9b40e092eda2c919">isSimple</a>())</span></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;StorePtr = StoreToHoist-&gt;<a href="/docs/api/classes/llvm/storeinst/#aefb15964facf7f35f22a6e8a7fb67285">getPointerOperand</a>();</span></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;StoreTy = StoreToHoist-&gt;<a href="/docs/api/classes/llvm/storeinst/#a89caf38fb409b0217360689351f3b457">getValueOperand</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for a store to the same pointer in BrBB.</span></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxNumInstToLookAt = 9;</span></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Skip pseudo probe intrinsic calls which are not really killing any memory</span></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// accesses.</span></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;CurI : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(BrBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a2069641f358ef416658a2f321ca19d74">instructionsWithoutDebug</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">))) &#123;</span></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MaxNumInstToLookAt)</span></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><span class="doxyHighlight">    --MaxNumInstToLookAt;</span></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Could be calling an instruction that affects memory like free().</span></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurI.mayWriteToMemory() &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(CurI))</span></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104"></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;CurI)) &#123;</span></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Found the previous store to same location and type. Make sure it is</span></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// simple, to avoid introducing a spurious non-atomic write after an</span></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// atomic write.</span></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand() == StorePtr &amp;&amp;</span></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand()-&gt;getType() == StoreTy &amp;&amp; <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isSimple() &amp;&amp;</span></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getAlign() &gt;= StoreToHoist-&gt;<a href="/docs/api/classes/llvm/storeinst/#a3b47950858d6ed72efd1010a35b81caa">getAlign</a>())</span></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Found the previous store, return its value operand.</span></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand();</span></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Unknown store.</span></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(&amp;CurI)) &#123;</span></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;getPointerOperand() == StorePtr &amp;&amp; LI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == StoreTy &amp;&amp;</span></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"><span class="doxyHighlight">          LI-&gt;isSimple() &amp;&amp; LI-&gt;getAlign() &gt;= StoreToHoist-&gt;<a href="/docs/api/classes/llvm/storeinst/#a3b47950858d6ed72efd1010a35b81caa">getAlign</a>()) &#123;</span></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Obj = <a href="/docs/api/namespaces/llvm/#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(StorePtr);</span></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ExplicitlyDereferenceableOnly;</span></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#af8127f6185ab47ac50a4ad6127d0c77f">isWritableObject</a>(Obj, ExplicitlyDereferenceableOnly) &amp;&amp;</span></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><span class="doxyHighlight">            !<a href="/docs/api/namespaces/llvm/#a7912b6c9e7843ca9fd5a11e199bef617">PointerMayBeCaptured</a>(Obj, </span><span class="doxyHighlightComment">/&#42;ReturnCaptures=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124"><span class="doxyHighlight">                                  </span><span class="doxyHighlightComment">/&#42;StoreCaptures=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &amp;&amp;</span></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"><span class="doxyHighlight">            (!ExplicitlyDereferenceableOnly ||</span></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#abf1028e2af158aae1e00d3288ca013bb">isDereferenceablePointer</a>(StorePtr, StoreTy,</span></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"><span class="doxyHighlight">                                      LI-&gt;getDataLayout()))) &#123;</span></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Found a previous load, return it.</span></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LI;</span></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The load didn&#39;t work out, but we may still find a store.</span></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><span class="doxyHighlightComment">/// Estimate the cost of the insertion(s) and check that the PHI nodes can be</span></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"><span class="doxyHighlightComment">/// converted to selects.</span></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141" lineLink="#a0b4c48d53ab1ddc5bf009cd4ddffdc5a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a0b4c48d53ab1ddc5bf009cd4ddffdc5a">validateAndCostRequiredSelects</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ThenBB,</span></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EndBB,</span></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;SpeculatedInstructions,</span></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> &amp;<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>,</span></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bb">TargetTransformInfo::TargetCostKind</a> <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a> =</span></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147"><span class="doxyHighlight">    BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a548cfb9440f36ba67fc5566b8e967fc6">hasMinSize</a>()</span></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"><span class="doxyHighlight">    ? <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a></span></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><span class="doxyHighlight">    : <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>;</span></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveRewritablePHIs = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : EndBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;OrigV = PN.getIncomingValueForBlock(BB);</span></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ThenV = PN.getIncomingValueForBlock(ThenBB);</span></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Try to remove some of the duplication with</span></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// hoistCommonCodeFromSuccessors. Skip PHIs which are trivial.</span></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ThenV == OrigV)</span></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getCmpSelInstrCost(Instruction::Select, PN.getType(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD&#95;ICMP&#95;PREDICATE</a>, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>);</span></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t convert to selects if we could remove undefined behavior instead.</span></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(OrigV, &amp;PN) ||</span></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><span class="doxyHighlight">        <a href="#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(ThenV, &amp;PN))</span></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><span class="doxyHighlight">    HaveRewritablePHIs = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantexpr">ConstantExpr</a> &#42;OrigCE = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantExpr&gt;</a>(OrigV);</span></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantexpr">ConstantExpr</a> &#42;ThenCE = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantExpr&gt;</a>(ThenV);</span></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OrigCE &amp;&amp; !ThenCE)</span></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Known cheap (FIXME: Maybe not true for aggregates).</span></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174"></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> OrigCost = OrigCE ? <a href="#a9ac94808486f1c47e5cc9ba62dcc6fae">computeSpeculationCost</a>(OrigCE, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) : 0;</span></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ThenCost = ThenCE ? <a href="#a9ac94808486f1c47e5cc9ba62dcc6fae">computeSpeculationCost</a>(ThenCE, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) : 0;</span></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> MaxCost =</span></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"><span class="doxyHighlight">        2 &#42; <a href="#af03cfeeab17b16ab9c47da7686f9f632">PHINodeFoldingThreshold</a> &#42; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>;</span></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OrigCost + ThenCost &gt; MaxCost)</span></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Account for the cost of an unfolded ConstantExpr which could end up</span></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// getting expanded into Instructions.</span></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: This doesn&#39;t account for how many operations are combined in the</span></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// constant expression.</span></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"><span class="doxyHighlight">    ++SpeculatedInstructions;</span></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SpeculatedInstructions &gt; 1)</span></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> HaveRewritablePHIs;</span></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194" lineLink="#a08cd264874d8deee9a2bdda9b9461e29"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a08cd264874d8deee9a2bdda9b9461e29">isProfitableToSpeculate</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI,</span></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><span class="doxyHighlight">                                    std::optional&lt;bool&gt; Invert,</span></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the branch is non-unpredictable, and is predicted to &#42;not&#42; branch to</span></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the &#96;then&#96; block, then avoid speculating it.</span></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;unpredictable))</span></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202"><span class="doxyHighlight">  uint64&#95;t TWeight, FWeight;</span></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;BI, TWeight, FWeight) || (TWeight + FWeight) == 0)</span></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Invert.has&#95;value())</span></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"><span class="doxyHighlight">  uint64&#95;t EndWeight = &#42;Invert ? TWeight : FWeight;</span></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> BIEndProb =</span></CodeLine>
<Link id="l03211" /><CodeLine lineNumber="3211"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(EndWeight, TWeight + FWeight);</span></CodeLine>
<Link id="l03212" /><CodeLine lineNumber="3212"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> Likely = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getPredictableBranchThreshold();</span></CodeLine>
<Link id="l03213" /><CodeLine lineNumber="3213"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BIEndProb &lt; Likely;</span></CodeLine>
<Link id="l03214" /><CodeLine lineNumber="3214"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03215" /><CodeLine lineNumber="3215"></CodeLine>
<Link id="l03216" /><CodeLine lineNumber="3216"><span class="doxyHighlightComment">/// Speculate a conditional basic block flattening the CFG.</span></CodeLine>
<Link id="l03217" /><CodeLine lineNumber="3217"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03218" /><CodeLine lineNumber="3218"><span class="doxyHighlightComment">/// Note that this is a very risky transform currently. Speculating</span></CodeLine>
<Link id="l03219" /><CodeLine lineNumber="3219"><span class="doxyHighlightComment">/// instructions like this is most often not desirable. Instead, there is an MI</span></CodeLine>
<Link id="l03220" /><CodeLine lineNumber="3220"><span class="doxyHighlightComment">/// pass which can do it with full awareness of the resource constraints.</span></CodeLine>
<Link id="l03221" /><CodeLine lineNumber="3221"><span class="doxyHighlightComment">/// However, some cases are &quot;obvious&quot; and we should do directly. An example of</span></CodeLine>
<Link id="l03222" /><CodeLine lineNumber="3222"><span class="doxyHighlightComment">/// this is speculating a single, reasonably cheap instruction.</span></CodeLine>
<Link id="l03223" /><CodeLine lineNumber="3223"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03224" /><CodeLine lineNumber="3224"><span class="doxyHighlightComment">/// There is only one distinct advantage to flattening the CFG at the IR level:</span></CodeLine>
<Link id="l03225" /><CodeLine lineNumber="3225"><span class="doxyHighlightComment">/// it makes very common but simplistic optimizations such as are common in</span></CodeLine>
<Link id="l03226" /><CodeLine lineNumber="3226"><span class="doxyHighlightComment">/// instcombine and the DAG combiner more powerful by removing CFG edges and</span></CodeLine>
<Link id="l03227" /><CodeLine lineNumber="3227"><span class="doxyHighlightComment">/// modeling their effects with easier to reason about SSA value graphs.</span></CodeLine>
<Link id="l03228" /><CodeLine lineNumber="3228"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03229" /><CodeLine lineNumber="3229"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03230" /><CodeLine lineNumber="3230"><span class="doxyHighlightComment">/// An illustration of this transform is turning this IR:</span></CodeLine>
<Link id="l03231" /><CodeLine lineNumber="3231"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l03232" /><CodeLine lineNumber="3232"><span class="doxyHighlightComment">///   BB:</span></CodeLine>
<Link id="l03233" /><CodeLine lineNumber="3233"><span class="doxyHighlightComment">///     %cmp = icmp ult %x, %y</span></CodeLine>
<Link id="l03234" /><CodeLine lineNumber="3234"><span class="doxyHighlightComment">///     br i1 %cmp, label %EndBB, label %ThenBB</span></CodeLine>
<Link id="l03235" /><CodeLine lineNumber="3235"><span class="doxyHighlightComment">///   ThenBB:</span></CodeLine>
<Link id="l03236" /><CodeLine lineNumber="3236"><span class="doxyHighlightComment">///     %sub = sub %x, %y</span></CodeLine>
<Link id="l03237" /><CodeLine lineNumber="3237"><span class="doxyHighlightComment">///     br label BB2</span></CodeLine>
<Link id="l03238" /><CodeLine lineNumber="3238"><span class="doxyHighlightComment">///   EndBB:</span></CodeLine>
<Link id="l03239" /><CodeLine lineNumber="3239"><span class="doxyHighlightComment">///     %phi = phi &#91; %sub, %ThenBB &#93;, &#91; 0, %BB &#93;</span></CodeLine>
<Link id="l03240" /><CodeLine lineNumber="3240"><span class="doxyHighlightComment">///     ...</span></CodeLine>
<Link id="l03241" /><CodeLine lineNumber="3241"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l03242" /><CodeLine lineNumber="3242"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03243" /><CodeLine lineNumber="3243"><span class="doxyHighlightComment">/// Into this IR:</span></CodeLine>
<Link id="l03244" /><CodeLine lineNumber="3244"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l03245" /><CodeLine lineNumber="3245"><span class="doxyHighlightComment">///   BB:</span></CodeLine>
<Link id="l03246" /><CodeLine lineNumber="3246"><span class="doxyHighlightComment">///     %cmp = icmp ult %x, %y</span></CodeLine>
<Link id="l03247" /><CodeLine lineNumber="3247"><span class="doxyHighlightComment">///     %sub = sub %x, %y</span></CodeLine>
<Link id="l03248" /><CodeLine lineNumber="3248"><span class="doxyHighlightComment">///     %cond = select i1 %cmp, 0, %sub</span></CodeLine>
<Link id="l03249" /><CodeLine lineNumber="3249"><span class="doxyHighlightComment">///     ...</span></CodeLine>
<Link id="l03250" /><CodeLine lineNumber="3250"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l03251" /><CodeLine lineNumber="3251"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l03252" /><CodeLine lineNumber="3252"><span class="doxyHighlightComment">/// \\returns true if the conditional block is removed.</span></CodeLine>
<Link id="l03253" /><CodeLine lineNumber="3253"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::speculativelyExecuteBB(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI,</span></CodeLine>
<Link id="l03254" /><CodeLine lineNumber="3254"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ThenBB) &#123;</span></CodeLine>
<Link id="l03255" /><CodeLine lineNumber="3255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.SpeculateBlocks)</span></CodeLine>
<Link id="l03256" /><CodeLine lineNumber="3256"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03257" /><CodeLine lineNumber="3257"></CodeLine>
<Link id="l03258" /><CodeLine lineNumber="3258"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Be conservative for now. FP select instruction can often be expensive.</span></CodeLine>
<Link id="l03259" /><CodeLine lineNumber="3259"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;BrCond = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l03260" /><CodeLine lineNumber="3260"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FCmpInst&gt;</a>(BrCond))</span></CodeLine>
<Link id="l03261" /><CodeLine lineNumber="3261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03262" /><CodeLine lineNumber="3262"></CodeLine>
<Link id="l03263" /><CodeLine lineNumber="3263"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l03264" /><CodeLine lineNumber="3264"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EndBB = ThenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(0);</span></CodeLine>
<Link id="l03265" /><CodeLine lineNumber="3265"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> Budget =</span></CodeLine>
<Link id="l03266" /><CodeLine lineNumber="3266"><span class="doxyHighlight">      <a href="#af03cfeeab17b16ab9c47da7686f9f632">PHINodeFoldingThreshold</a> &#42; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>;</span></CodeLine>
<Link id="l03267" /><CodeLine lineNumber="3267"></CodeLine>
<Link id="l03268" /><CodeLine lineNumber="3268"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If ThenBB is actually on the false edge of the conditional branch, remember</span></CodeLine>
<Link id="l03269" /><CodeLine lineNumber="3269"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to swap the select operands later.</span></CodeLine>
<Link id="l03270" /><CodeLine lineNumber="3270"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Invert = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03271" /><CodeLine lineNumber="3271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ThenBB != BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)) &#123;</span></CodeLine>
<Link id="l03272" /><CodeLine lineNumber="3272"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ThenBB == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No edge from &#39;if&#39; block?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03273" /><CodeLine lineNumber="3273"><span class="doxyHighlight">    Invert = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03274" /><CodeLine lineNumber="3274"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03275" /><CodeLine lineNumber="3275"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndBB == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(!Invert) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No edge from to end block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03276" /><CodeLine lineNumber="3276"></CodeLine>
<Link id="l03277" /><CodeLine lineNumber="3277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a08cd264874d8deee9a2bdda9b9461e29">isProfitableToSpeculate</a>(BI, Invert, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l03278" /><CodeLine lineNumber="3278"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03279" /><CodeLine lineNumber="3279"></CodeLine>
<Link id="l03280" /><CodeLine lineNumber="3280"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep a count of how many times instructions are used within ThenBB when</span></CodeLine>
<Link id="l03281" /><CodeLine lineNumber="3281"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// they are candidates for sinking into ThenBB. Specifically:</span></CodeLine>
<Link id="l03282" /><CodeLine lineNumber="3282"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// - They are defined in BB, and</span></CodeLine>
<Link id="l03283" /><CodeLine lineNumber="3283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// - They have no side effects, and</span></CodeLine>
<Link id="l03284" /><CodeLine lineNumber="3284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// - All of their uses are in ThenBB.</span></CodeLine>
<Link id="l03285" /><CodeLine lineNumber="3285"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Instruction &#42;, unsigned, 4&gt;</a> SinkCandidateUseCounts;</span></CodeLine>
<Link id="l03286" /><CodeLine lineNumber="3286"></CodeLine>
<Link id="l03287" /><CodeLine lineNumber="3287"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> SpeculatedDbgIntrinsics;</span></CodeLine>
<Link id="l03288" /><CodeLine lineNumber="3288"></CodeLine>
<Link id="l03289" /><CodeLine lineNumber="3289"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SpeculatedInstructions = 0;</span></CodeLine>
<Link id="l03290" /><CodeLine lineNumber="3290"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HoistLoadsStores = <a href="#a004c0d539d69756950a2dcd676799e0c">HoistLoadsStoresWithCondFaulting</a> &amp;&amp;</span></CodeLine>
<Link id="l03291" /><CodeLine lineNumber="3291"><span class="doxyHighlight">                          <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.HoistLoadsStoresWithCondFaulting;</span></CodeLine>
<Link id="l03292" /><CodeLine lineNumber="3292"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 2&gt;</a> SpeculatedConditionalLoadsStores;</span></CodeLine>
<Link id="l03293" /><CodeLine lineNumber="3293"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SpeculatedStoreValue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03294" /><CodeLine lineNumber="3294"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;SpeculatedStore = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03295" /><CodeLine lineNumber="3295"><span class="doxyHighlight">  EphemeralValueTracker EphTracker;</span></CodeLine>
<Link id="l03296" /><CodeLine lineNumber="3296"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(<a href="/docs/api/namespaces/llvm/#a9b64313b5c1907066b7bab1c60a2ea08">drop&#95;end</a>(&#42;ThenBB))) &#123;</span></CodeLine>
<Link id="l03297" /><CodeLine lineNumber="3297"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip debug info.</span></CodeLine>
<Link id="l03298" /><CodeLine lineNumber="3298"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03299" /><CodeLine lineNumber="3299"><span class="doxyHighlight">      SpeculatedDbgIntrinsics.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03300" /><CodeLine lineNumber="3300"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03301" /><CodeLine lineNumber="3301"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03302" /><CodeLine lineNumber="3302"></CodeLine>
<Link id="l03303" /><CodeLine lineNumber="3303"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip pseudo probes. The consequence is we lose track of the branch</span></CodeLine>
<Link id="l03304" /><CodeLine lineNumber="3304"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// probability for ThenBB, which is fine since the optimization here takes</span></CodeLine>
<Link id="l03305" /><CodeLine lineNumber="3305"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// place regardless of the branch probability.</span></CodeLine>
<Link id="l03306" /><CodeLine lineNumber="3306"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PseudoProbeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03307" /><CodeLine lineNumber="3307"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The probe should be deleted so that it will not be over-counted when</span></CodeLine>
<Link id="l03308" /><CodeLine lineNumber="3308"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the samples collected on the non-conditional path are counted towards</span></CodeLine>
<Link id="l03309" /><CodeLine lineNumber="3309"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the conditional path. We leave it for the counts inference algorithm to</span></CodeLine>
<Link id="l03310" /><CodeLine lineNumber="3310"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// figure out a proper count for an unknown probe.</span></CodeLine>
<Link id="l03311" /><CodeLine lineNumber="3311"><span class="doxyHighlight">      SpeculatedDbgIntrinsics.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03312" /><CodeLine lineNumber="3312"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03313" /><CodeLine lineNumber="3313"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03314" /><CodeLine lineNumber="3314"></CodeLine>
<Link id="l03315" /><CodeLine lineNumber="3315"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ignore ephemeral values, they will be dropped by the transform.</span></CodeLine>
<Link id="l03316" /><CodeLine lineNumber="3316"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EphTracker.track(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03317" /><CodeLine lineNumber="3317"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03318" /><CodeLine lineNumber="3318"></CodeLine>
<Link id="l03319" /><CodeLine lineNumber="3319"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only speculatively execute a single instruction (not counting the</span></CodeLine>
<Link id="l03320" /><CodeLine lineNumber="3320"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// terminator) for now.</span></CodeLine>
<Link id="l03321" /><CodeLine lineNumber="3321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSafeCheapLoadStore = HoistLoadsStores &amp;&amp;</span></CodeLine>
<Link id="l03322" /><CodeLine lineNumber="3322"><span class="doxyHighlight">                                <a href="#af7700655934807d2b707112f79217377">isSafeCheapLoadStore</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &amp;&amp;</span></CodeLine>
<Link id="l03323" /><CodeLine lineNumber="3323"><span class="doxyHighlight">                                SpeculatedConditionalLoadsStores.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt;</span></CodeLine>
<Link id="l03324" /><CodeLine lineNumber="3324"><span class="doxyHighlight">                                    <a href="#afcc2d83294ce3af8abbfda0a3ea248ea">HoistLoadsStoresWithCondFaultingThreshold</a>;</span></CodeLine>
<Link id="l03325" /><CodeLine lineNumber="3325"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Not count load/store into cost if target supports conditional faulting</span></CodeLine>
<Link id="l03326" /><CodeLine lineNumber="3326"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// b/c it&#39;s cheap to speculate it.</span></CodeLine>
<Link id="l03327" /><CodeLine lineNumber="3327"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSafeCheapLoadStore)</span></CodeLine>
<Link id="l03328" /><CodeLine lineNumber="3328"><span class="doxyHighlight">      SpeculatedConditionalLoadsStores.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03329" /><CodeLine lineNumber="3329"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03330" /><CodeLine lineNumber="3330"><span class="doxyHighlight">      ++SpeculatedInstructions;</span></CodeLine>
<Link id="l03331" /><CodeLine lineNumber="3331"></CodeLine>
<Link id="l03332" /><CodeLine lineNumber="3332"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SpeculatedInstructions &gt; 1)</span></CodeLine>
<Link id="l03333" /><CodeLine lineNumber="3333"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03334" /><CodeLine lineNumber="3334"></CodeLine>
<Link id="l03335" /><CodeLine lineNumber="3335"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t hoist the instruction if it&#39;s unsafe or expensive.</span></CodeLine>
<Link id="l03336" /><CodeLine lineNumber="3336"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsSafeCheapLoadStore &amp;&amp;</span></CodeLine>
<Link id="l03337" /><CodeLine lineNumber="3337"><span class="doxyHighlight">        !<a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BI, <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.AC) &amp;&amp;</span></CodeLine>
<Link id="l03338" /><CodeLine lineNumber="3338"><span class="doxyHighlight">        !(<a href="#a96d7d928b8da0aaa8a366c8a36a16b89">HoistCondStores</a> &amp;&amp; !SpeculatedStoreValue &amp;&amp;</span></CodeLine>
<Link id="l03339" /><CodeLine lineNumber="3339"><span class="doxyHighlight">          (SpeculatedStoreValue =</span></CodeLine>
<Link id="l03340" /><CodeLine lineNumber="3340"><span class="doxyHighlight">               <a href="#a8bb9afd23da56f99f3bcdb52e9c74320">isSafeToSpeculateStore</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BB, ThenBB, EndBB))))</span></CodeLine>
<Link id="l03341" /><CodeLine lineNumber="3341"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03342" /><CodeLine lineNumber="3342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsSafeCheapLoadStore &amp;&amp; !SpeculatedStoreValue &amp;&amp;</span></CodeLine>
<Link id="l03343" /><CodeLine lineNumber="3343"><span class="doxyHighlight">        <a href="#a9ac94808486f1c47e5cc9ba62dcc6fae">computeSpeculationCost</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &gt;</span></CodeLine>
<Link id="l03344" /><CodeLine lineNumber="3344"><span class="doxyHighlight">            <a href="#af03cfeeab17b16ab9c47da7686f9f632">PHINodeFoldingThreshold</a> &#42; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>)</span></CodeLine>
<Link id="l03345" /><CodeLine lineNumber="3345"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03346" /><CodeLine lineNumber="3346"></CodeLine>
<Link id="l03347" /><CodeLine lineNumber="3347"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Store the store speculation candidate.</span></CodeLine>
<Link id="l03348" /><CodeLine lineNumber="3348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SpeculatedStore &amp;&amp; SpeculatedStoreValue)</span></CodeLine>
<Link id="l03349" /><CodeLine lineNumber="3349"><span class="doxyHighlight">      SpeculatedStore = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03350" /><CodeLine lineNumber="3350"></CodeLine>
<Link id="l03351" /><CodeLine lineNumber="3351"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not hoist the instruction if any of its operands are defined but not</span></CodeLine>
<Link id="l03352" /><CodeLine lineNumber="3352"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// used in BB. The transformation will prevent the operand from</span></CodeLine>
<Link id="l03353" /><CodeLine lineNumber="3353"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// being sunk into the use block.</span></CodeLine>
<Link id="l03354" /><CodeLine lineNumber="3354"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) &#123;</span></CodeLine>
<Link id="l03355" /><CodeLine lineNumber="3355"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OpI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l03356" /><CodeLine lineNumber="3356"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OpI || OpI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != BB || OpI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6ea260be710ac7b61309534308da3147">mayHaveSideEffects</a>())</span></CodeLine>
<Link id="l03357" /><CodeLine lineNumber="3357"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Not a candidate for sinking.</span></CodeLine>
<Link id="l03358" /><CodeLine lineNumber="3358"></CodeLine>
<Link id="l03359" /><CodeLine lineNumber="3359"><span class="doxyHighlight">      ++SinkCandidateUseCounts&#91;OpI&#93;;</span></CodeLine>
<Link id="l03360" /><CodeLine lineNumber="3360"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03361" /><CodeLine lineNumber="3361"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03362" /><CodeLine lineNumber="3362"></CodeLine>
<Link id="l03363" /><CodeLine lineNumber="3363"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Consider any sink candidates which are only used in ThenBB as costs for</span></CodeLine>
<Link id="l03364" /><CodeLine lineNumber="3364"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// speculation. Note, while we iterate over a DenseMap here, we are summing</span></CodeLine>
<Link id="l03365" /><CodeLine lineNumber="3365"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and so iteration order isn&#39;t significant.</span></CodeLine>
<Link id="l03366" /><CodeLine lineNumber="3366"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;Inst, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>&#93; : SinkCandidateUseCounts)</span></CodeLine>
<Link id="l03367" /><CodeLine lineNumber="3367"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst-&gt;hasNUses(<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>)) &#123;</span></CodeLine>
<Link id="l03368" /><CodeLine lineNumber="3368"><span class="doxyHighlight">      ++SpeculatedInstructions;</span></CodeLine>
<Link id="l03369" /><CodeLine lineNumber="3369"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SpeculatedInstructions &gt; 1)</span></CodeLine>
<Link id="l03370" /><CodeLine lineNumber="3370"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03371" /><CodeLine lineNumber="3371"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03372" /><CodeLine lineNumber="3372"></CodeLine>
<Link id="l03373" /><CodeLine lineNumber="3373"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that we can insert the selects and that it&#39;s not too expensive to do</span></CodeLine>
<Link id="l03374" /><CodeLine lineNumber="3374"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so.</span></CodeLine>
<Link id="l03375" /><CodeLine lineNumber="3375"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Convert =</span></CodeLine>
<Link id="l03376" /><CodeLine lineNumber="3376"><span class="doxyHighlight">      SpeculatedStore != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> || !SpeculatedConditionalLoadsStores.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>();</span></CodeLine>
<Link id="l03377" /><CodeLine lineNumber="3377"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = 0;</span></CodeLine>
<Link id="l03378" /><CodeLine lineNumber="3378"><span class="doxyHighlight">  Convert |= <a href="#a0b4c48d53ab1ddc5bf009cd4ddffdc5a">validateAndCostRequiredSelects</a>(BB, ThenBB, EndBB,</span></CodeLine>
<Link id="l03379" /><CodeLine lineNumber="3379"><span class="doxyHighlight">                                            SpeculatedInstructions, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l03380" /><CodeLine lineNumber="3380"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Convert || <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> &gt; Budget)</span></CodeLine>
<Link id="l03381" /><CodeLine lineNumber="3381"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03382" /><CodeLine lineNumber="3382"></CodeLine>
<Link id="l03383" /><CodeLine lineNumber="3383"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we get here, we can hoist the instruction and if-convert.</span></CodeLine>
<Link id="l03384" /><CodeLine lineNumber="3384"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;SPECULATIVELY EXECUTING BB&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;ThenBB &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;);</span></CodeLine>
<Link id="l03385" /><CodeLine lineNumber="3385"></CodeLine>
<Link id="l03386" /><CodeLine lineNumber="3386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert a select of the value of the speculated store.</span></CodeLine>
<Link id="l03387" /><CodeLine lineNumber="3387"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SpeculatedStoreValue) &#123;</span></CodeLine>
<Link id="l03388" /><CodeLine lineNumber="3388"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;NoFolder&gt;</a> Builder(BI);</span></CodeLine>
<Link id="l03389" /><CodeLine lineNumber="3389"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;OrigV = SpeculatedStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a89caf38fb409b0217360689351f3b457">getValueOperand</a>();</span></CodeLine>
<Link id="l03390" /><CodeLine lineNumber="3390"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;TrueV = SpeculatedStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a89caf38fb409b0217360689351f3b457">getValueOperand</a>();</span></CodeLine>
<Link id="l03391" /><CodeLine lineNumber="3391"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;FalseV = SpeculatedStoreValue;</span></CodeLine>
<Link id="l03392" /><CodeLine lineNumber="3392"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Invert)</span></CodeLine>
<Link id="l03393" /><CodeLine lineNumber="3393"><span class="doxyHighlight">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(TrueV, FalseV);</span></CodeLine>
<Link id="l03394" /><CodeLine lineNumber="3394"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;S = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(</span></CodeLine>
<Link id="l03395" /><CodeLine lineNumber="3395"><span class="doxyHighlight">        BrCond, TrueV, FalseV, </span><span class="doxyHighlightStringLiteral">&quot;spec.store.select&quot;</span><span class="doxyHighlight">, BI);</span></CodeLine>
<Link id="l03396" /><CodeLine lineNumber="3396"><span class="doxyHighlight">    SpeculatedStore-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, S);</span></CodeLine>
<Link id="l03397" /><CodeLine lineNumber="3397"><span class="doxyHighlight">    SpeculatedStore-&gt;<a href="/docs/api/classes/llvm/instruction/#ae88ca601f663c55cafa95cf742076aad">applyMergedLocation</a>(BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>(),</span></CodeLine>
<Link id="l03398" /><CodeLine lineNumber="3398"><span class="doxyHighlight">                                         SpeculatedStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l03399" /><CodeLine lineNumber="3399"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The value stored is still conditional, but the store itself is now</span></CodeLine>
<Link id="l03400" /><CodeLine lineNumber="3400"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// unconditonally executed, so we must be sure that any linked dbg.assign</span></CodeLine>
<Link id="l03401" /><CodeLine lineNumber="3401"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// intrinsics are tracking the new stored value (the result of the</span></CodeLine>
<Link id="l03402" /><CodeLine lineNumber="3402"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// select). If we don&#39;t, and the store were to be removed by another pass</span></CodeLine>
<Link id="l03403" /><CodeLine lineNumber="3403"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (e.g. DSE), then we&#39;d eventually end up emitting a location describing</span></CodeLine>
<Link id="l03404" /><CodeLine lineNumber="3404"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the conditional value, unconditionally.</span></CodeLine>
<Link id="l03405" /><CodeLine lineNumber="3405"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l03406" /><CodeLine lineNumber="3406"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// === Before this transformation ===</span></CodeLine>
<Link id="l03407" /><CodeLine lineNumber="3407"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pred:</span></CodeLine>
<Link id="l03408" /><CodeLine lineNumber="3408"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   store %one, %x.dest, !DIAssignID !1</span></CodeLine>
<Link id="l03409" /><CodeLine lineNumber="3409"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   dbg.assign %one, &quot;x&quot;, ..., !1, ...</span></CodeLine>
<Link id="l03410" /><CodeLine lineNumber="3410"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   br %cond if.then</span></CodeLine>
<Link id="l03411" /><CodeLine lineNumber="3411"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l03412" /><CodeLine lineNumber="3412"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// if.then:</span></CodeLine>
<Link id="l03413" /><CodeLine lineNumber="3413"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   store %two, %x.dest, !DIAssignID !2</span></CodeLine>
<Link id="l03414" /><CodeLine lineNumber="3414"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   dbg.assign %two, &quot;x&quot;, ..., !2, ...</span></CodeLine>
<Link id="l03415" /><CodeLine lineNumber="3415"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l03416" /><CodeLine lineNumber="3416"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// === After this transformation ===</span></CodeLine>
<Link id="l03417" /><CodeLine lineNumber="3417"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pred:</span></CodeLine>
<Link id="l03418" /><CodeLine lineNumber="3418"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   store %one, %x.dest, !DIAssignID !1</span></CodeLine>
<Link id="l03419" /><CodeLine lineNumber="3419"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   dbg.assign %one, &quot;x&quot;, ..., !1</span></CodeLine>
<Link id="l03420" /><CodeLine lineNumber="3420"><span class="doxyHighlightComment">    ///  ...</span></CodeLine>
<Link id="l03421" /><CodeLine lineNumber="3421"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   %merge = select %cond, %two, %one</span></CodeLine>
<Link id="l03422" /><CodeLine lineNumber="3422"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   store %merge, %x.dest, !DIAssignID !2</span></CodeLine>
<Link id="l03423" /><CodeLine lineNumber="3423"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   dbg.assign %merge, &quot;x&quot;, ..., !2</span></CodeLine>
<Link id="l03424" /><CodeLine lineNumber="3424"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> replaceVariable = &#91;OrigV, S&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DbgAssign) &#123;</span></CodeLine>
<Link id="l03425" /><CodeLine lineNumber="3425"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">llvm::is&#95;contained</a>(DbgAssign-&gt;location&#95;ops(), OrigV))</span></CodeLine>
<Link id="l03426" /><CodeLine lineNumber="3426"><span class="doxyHighlight">        DbgAssign-&gt;replaceVariableLocationOp(OrigV, S);</span></CodeLine>
<Link id="l03427" /><CodeLine lineNumber="3427"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l03428" /><CodeLine lineNumber="3428"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/at/#a3c90899e8f022656e511630de42b916c">at::getAssignmentMarkers</a>(SpeculatedStore), replaceVariable);</span></CodeLine>
<Link id="l03429" /><CodeLine lineNumber="3429"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a0b2a153b655ed78a07468297eb4c6256">for&#95;each</a>(<a href="/docs/api/namespaces/llvm/at/#aa992dd7420a71df6149dd3437c949245">at::getDVRAssignmentMarkers</a>(SpeculatedStore), replaceVariable);</span></CodeLine>
<Link id="l03430" /><CodeLine lineNumber="3430"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03431" /><CodeLine lineNumber="3431"></CodeLine>
<Link id="l03432" /><CodeLine lineNumber="3432"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Metadata can be dependent on the condition we are hoisting above.</span></CodeLine>
<Link id="l03433" /><CodeLine lineNumber="3433"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Strip all UB-implying metadata on the instruction. Drop the debug loc</span></CodeLine>
<Link id="l03434" /><CodeLine lineNumber="3434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to avoid making it appear as if the condition is a constant, which would</span></CodeLine>
<Link id="l03435" /><CodeLine lineNumber="3435"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be misleading while debugging.</span></CodeLine>
<Link id="l03436" /><CodeLine lineNumber="3436"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Similarly strip attributes that maybe dependent on condition we are</span></CodeLine>
<Link id="l03437" /><CodeLine lineNumber="3437"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// hoisting above.</span></CodeLine>
<Link id="l03438" /><CodeLine lineNumber="3438"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;ThenBB)) &#123;</span></CodeLine>
<Link id="l03439" /><CodeLine lineNumber="3439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SpeculatedStoreValue || &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != SpeculatedStore) &#123;</span></CodeLine>
<Link id="l03440" /><CodeLine lineNumber="3440"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t update the DILocation of dbg.assign intrinsics.</span></CodeLine>
<Link id="l03441" /><CodeLine lineNumber="3441"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgAssignIntrinsic&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03442" /><CodeLine lineNumber="3442"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setDebugLoc(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l03443" /><CodeLine lineNumber="3443"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03444" /><CodeLine lineNumber="3444"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.dropUBImplyingAttrsAndMetadata();</span></CodeLine>
<Link id="l03445" /><CodeLine lineNumber="3445"></CodeLine>
<Link id="l03446" /><CodeLine lineNumber="3446"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Drop ephemeral values.</span></CodeLine>
<Link id="l03447" /><CodeLine lineNumber="3447"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EphTracker.contains(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03448" /><CodeLine lineNumber="3448"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.replaceAllUsesWith(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()));</span></CodeLine>
<Link id="l03449" /><CodeLine lineNumber="3449"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.eraseFromParent();</span></CodeLine>
<Link id="l03450" /><CodeLine lineNumber="3450"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03451" /><CodeLine lineNumber="3451"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03452" /><CodeLine lineNumber="3452"></CodeLine>
<Link id="l03453" /><CodeLine lineNumber="3453"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Hoist the instructions.</span></CodeLine>
<Link id="l03454" /><CodeLine lineNumber="3454"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In &quot;RemoveDIs&quot; non-instr debug-info mode, drop DbgVariableRecords attached</span></CodeLine>
<Link id="l03455" /><CodeLine lineNumber="3455"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to these instructions, in the same way that dbg.value intrinsics are</span></CodeLine>
<Link id="l03456" /><CodeLine lineNumber="3456"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dropped at the end of this block.</span></CodeLine>
<Link id="l03457" /><CodeLine lineNumber="3457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;It : <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(ThenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), ThenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()))</span></CodeLine>
<Link id="l03458" /><CodeLine lineNumber="3458"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/dbgrecord">DbgRecord</a> &amp;DR : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(It.getDbgRecordRange()))</span></CodeLine>
<Link id="l03459" /><CodeLine lineNumber="3459"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Drop all records except assign-kind DbgVariableRecords (dbg.assign</span></CodeLine>
<Link id="l03460" /><CodeLine lineNumber="3460"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// equivalent).</span></CodeLine>
<Link id="l03461" /><CodeLine lineNumber="3461"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;DbgVariableRecord&gt;</a>(&amp;DR);</span></CodeLine>
<Link id="l03462" /><CodeLine lineNumber="3462"><span class="doxyHighlight">          !DVR || !DVR-&gt;isDbgAssign())</span></CodeLine>
<Link id="l03463" /><CodeLine lineNumber="3463"><span class="doxyHighlight">        It.dropOneDbgRecord(&amp;DR);</span></CodeLine>
<Link id="l03464" /><CodeLine lineNumber="3464"><span class="doxyHighlight">  BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#af29f89e91dfd0ae90950f0b1bf49798d">splice</a>(BI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), ThenBB, ThenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(),</span></CodeLine>
<Link id="l03465" /><CodeLine lineNumber="3465"><span class="doxyHighlight">             std::prev(ThenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()));</span></CodeLine>
<Link id="l03466" /><CodeLine lineNumber="3466"></CodeLine>
<Link id="l03467" /><CodeLine lineNumber="3467"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SpeculatedConditionalLoadsStores.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l03468" /><CodeLine lineNumber="3468"><span class="doxyHighlight">    <a href="#ab99310a04afb6c28186b1a6428eb75b0">hoistConditionalLoadsStores</a>(BI, SpeculatedConditionalLoadsStores, Invert);</span></CodeLine>
<Link id="l03469" /><CodeLine lineNumber="3469"></CodeLine>
<Link id="l03470" /><CodeLine lineNumber="3470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert selects and rewrite the PHI operands.</span></CodeLine>
<Link id="l03471" /><CodeLine lineNumber="3471"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;NoFolder&gt;</a> Builder(BI);</span></CodeLine>
<Link id="l03472" /><CodeLine lineNumber="3472"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : EndBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l03473" /><CodeLine lineNumber="3473"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OrigI = PN.getBasicBlockIndex(BB);</span></CodeLine>
<Link id="l03474" /><CodeLine lineNumber="3474"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ThenI = PN.getBasicBlockIndex(ThenBB);</span></CodeLine>
<Link id="l03475" /><CodeLine lineNumber="3475"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;OrigV = PN.getIncomingValue(OrigI);</span></CodeLine>
<Link id="l03476" /><CodeLine lineNumber="3476"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ThenV = PN.getIncomingValue(ThenI);</span></CodeLine>
<Link id="l03477" /><CodeLine lineNumber="3477"></CodeLine>
<Link id="l03478" /><CodeLine lineNumber="3478"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip PHIs which are trivial.</span></CodeLine>
<Link id="l03479" /><CodeLine lineNumber="3479"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OrigV == ThenV)</span></CodeLine>
<Link id="l03480" /><CodeLine lineNumber="3480"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03481" /><CodeLine lineNumber="3481"></CodeLine>
<Link id="l03482" /><CodeLine lineNumber="3482"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a select whose true value is the speculatively executed value and</span></CodeLine>
<Link id="l03483" /><CodeLine lineNumber="3483"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// false value is the pre-existing value. Swap them if the branch</span></CodeLine>
<Link id="l03484" /><CodeLine lineNumber="3484"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// destinations were inverted.</span></CodeLine>
<Link id="l03485" /><CodeLine lineNumber="3485"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;TrueV = ThenV, &#42;FalseV = OrigV;</span></CodeLine>
<Link id="l03486" /><CodeLine lineNumber="3486"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Invert)</span></CodeLine>
<Link id="l03487" /><CodeLine lineNumber="3487"><span class="doxyHighlight">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(TrueV, FalseV);</span></CodeLine>
<Link id="l03488" /><CodeLine lineNumber="3488"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(BrCond, TrueV, FalseV, </span><span class="doxyHighlightStringLiteral">&quot;spec.select&quot;</span><span class="doxyHighlight">, BI);</span></CodeLine>
<Link id="l03489" /><CodeLine lineNumber="3489"><span class="doxyHighlight">    PN.setIncomingValue(OrigI, V);</span></CodeLine>
<Link id="l03490" /><CodeLine lineNumber="3490"><span class="doxyHighlight">    PN.setIncomingValue(ThenI, V);</span></CodeLine>
<Link id="l03491" /><CodeLine lineNumber="3491"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03492" /><CodeLine lineNumber="3492"></CodeLine>
<Link id="l03493" /><CodeLine lineNumber="3493"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove speculated dbg intrinsics.</span></CodeLine>
<Link id="l03494" /><CodeLine lineNumber="3494"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Is it possible to do this in a more elegant way? Moving/merging the</span></CodeLine>
<Link id="l03495" /><CodeLine lineNumber="3495"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dbg value for the different flows and inserting it after the select.</span></CodeLine>
<Link id="l03496" /><CodeLine lineNumber="3496"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : SpeculatedDbgIntrinsics) &#123;</span></CodeLine>
<Link id="l03497" /><CodeLine lineNumber="3497"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We still want to know that an assignment took place so don&#39;t remove</span></CodeLine>
<Link id="l03498" /><CodeLine lineNumber="3498"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// dbg.assign intrinsics.</span></CodeLine>
<Link id="l03499" /><CodeLine lineNumber="3499"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgAssignIntrinsic&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03500" /><CodeLine lineNumber="3500"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l03501" /><CodeLine lineNumber="3501"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03502" /><CodeLine lineNumber="3502"></CodeLine>
<Link id="l03503" /><CodeLine lineNumber="3503"><span class="doxyHighlight">  ++NumSpeculations;</span></CodeLine>
<Link id="l03504" /><CodeLine lineNumber="3504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03505" /><CodeLine lineNumber="3505"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03506" /><CodeLine lineNumber="3506"></CodeLine>
<Link id="l03507" /><CodeLine lineNumber="3507"><span class="doxyHighlightComment">/// Return true if we can thread a branch across this block.</span></CodeLine>
<Link id="l03508" /><CodeLine lineNumber="3508" lineLink="#aee330f66887329eef3ddc7dc8ccda193"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aee330f66887329eef3ddc7dc8ccda193">blockIsSimpleEnoughToThreadThrough</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l03509" /><CodeLine lineNumber="3509"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = 0;</span></CodeLine>
<Link id="l03510" /><CodeLine lineNumber="3510"><span class="doxyHighlight">  EphemeralValueTracker EphTracker;</span></CodeLine>
<Link id="l03511" /><CodeLine lineNumber="3511"></CodeLine>
<Link id="l03512" /><CodeLine lineNumber="3512"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walk the loop in reverse so that we can identify ephemeral values properly</span></CodeLine>
<Link id="l03513" /><CodeLine lineNumber="3513"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (values only feeding assumes).</span></CodeLine>
<Link id="l03514" /><CodeLine lineNumber="3514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a2069641f358ef416658a2f321ca19d74">instructionsWithoutDebug</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">))) &#123;</span></CodeLine>
<Link id="l03515" /><CodeLine lineNumber="3515"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Can&#39;t fold blocks that contain noduplicate or convergent calls.</span></CodeLine>
<Link id="l03516" /><CodeLine lineNumber="3516"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03517" /><CodeLine lineNumber="3517"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI-&gt;cannotDuplicate() || CI-&gt;isConvergent())</span></CodeLine>
<Link id="l03518" /><CodeLine lineNumber="3518"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03519" /><CodeLine lineNumber="3519"></CodeLine>
<Link id="l03520" /><CodeLine lineNumber="3520"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ignore ephemeral values which are deleted during codegen.</span></CodeLine>
<Link id="l03521" /><CodeLine lineNumber="3521"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We will delete Phis while threading, so Phis should not be accounted in</span></CodeLine>
<Link id="l03522" /><CodeLine lineNumber="3522"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block&#39;s size.</span></CodeLine>
<Link id="l03523" /><CodeLine lineNumber="3523"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EphTracker.track(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03524" /><CodeLine lineNumber="3524"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>++ &gt; <a href="#a47aef60715560eb30f15d8c2edc4cae7">MaxSmallBlockSize</a>)</span></CodeLine>
<Link id="l03525" /><CodeLine lineNumber="3525"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Don&#39;t clone large BB&#39;s.</span></CodeLine>
<Link id="l03526" /><CodeLine lineNumber="3526"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03527" /><CodeLine lineNumber="3527"></CodeLine>
<Link id="l03528" /><CodeLine lineNumber="3528"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can only support instructions that do not define values that are</span></CodeLine>
<Link id="l03529" /><CodeLine lineNumber="3529"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// live outside of the current basic block.</span></CodeLine>
<Link id="l03530" /><CodeLine lineNumber="3530"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.users()) &#123;</span></CodeLine>
<Link id="l03531" /><CodeLine lineNumber="3531"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l03532" /><CodeLine lineNumber="3532"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != BB || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(UI))</span></CodeLine>
<Link id="l03533" /><CodeLine lineNumber="3533"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03534" /><CodeLine lineNumber="3534"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03535" /><CodeLine lineNumber="3535"></CodeLine>
<Link id="l03536" /><CodeLine lineNumber="3536"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Looks ok, continue checking.</span></CodeLine>
<Link id="l03537" /><CodeLine lineNumber="3537"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03538" /><CodeLine lineNumber="3538"></CodeLine>
<Link id="l03539" /><CodeLine lineNumber="3539"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03540" /><CodeLine lineNumber="3540"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03541" /><CodeLine lineNumber="3541"></CodeLine>
<Link id="l03542" /><CodeLine lineNumber="3542" lineLink="#afb9fd1f991a7503fe4fd7dc16bda6f30"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="#afb9fd1f991a7503fe4fd7dc16bda6f30">getKnownValueOnEdge</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;From,</span></CodeLine>
<Link id="l03543" /><CodeLine lineNumber="3543"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;To) &#123;</span></CodeLine>
<Link id="l03544" /><CodeLine lineNumber="3544"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t look past the block defining the value, we might get the value from</span></CodeLine>
<Link id="l03545" /><CodeLine lineNumber="3545"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a previous loop iteration.</span></CodeLine>
<Link id="l03546" /><CodeLine lineNumber="3546"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l03547" /><CodeLine lineNumber="3547"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == To)</span></CodeLine>
<Link id="l03548" /><CodeLine lineNumber="3548"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03549" /><CodeLine lineNumber="3549"></CodeLine>
<Link id="l03550" /><CodeLine lineNumber="3550"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We know the value if the From block branches on it.</span></CodeLine>
<Link id="l03551" /><CodeLine lineNumber="3551"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(From-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l03552" /><CodeLine lineNumber="3552"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI &amp;&amp; BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>() == V &amp;&amp;</span></CodeLine>
<Link id="l03553" /><CodeLine lineNumber="3553"><span class="doxyHighlight">      BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1))</span></CodeLine>
<Link id="l03554" /><CodeLine lineNumber="3554"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == To ? <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(BI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>())</span></CodeLine>
<Link id="l03555" /><CodeLine lineNumber="3555"><span class="doxyHighlight">                                     : <a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(BI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>());</span></CodeLine>
<Link id="l03556" /><CodeLine lineNumber="3556"></CodeLine>
<Link id="l03557" /><CodeLine lineNumber="3557"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03558" /><CodeLine lineNumber="3558"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03559" /><CodeLine lineNumber="3559"></CodeLine>
<Link id="l03560" /><CodeLine lineNumber="3560"><span class="doxyHighlightComment">/// If we have a conditional branch on something for which we know the constant</span></CodeLine>
<Link id="l03561" /><CodeLine lineNumber="3561"><span class="doxyHighlightComment">/// value in predecessors (e.g. a phi node in the current block), thread edges</span></CodeLine>
<Link id="l03562" /><CodeLine lineNumber="3562"><span class="doxyHighlightComment">/// from the predecessor to their ultimate destination.</span></CodeLine>
<Link id="l03563" /><CodeLine lineNumber="3563"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::optional&lt;bool&gt;</span></CodeLine>
<Link id="l03564" /><CodeLine lineNumber="3564" lineLink="#ac0fb2da7eaa616e8ef8a8f52b981334b"><span class="doxyHighlight"><a href="#ac0fb2da7eaa616e8ef8a8f52b981334b">foldCondBranchOnValueKnownInPredecessorImpl</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU,</span></CodeLine>
<Link id="l03565" /><CodeLine lineNumber="3565"><span class="doxyHighlight">                                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l03566" /><CodeLine lineNumber="3566"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC) &#123;</span></CodeLine>
<Link id="l03567" /><CodeLine lineNumber="3567"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/smallmapvector">SmallMapVector&lt;ConstantInt &#42;, SmallSetVector&lt;BasicBlock &#42;, 2&gt;</a>, 2&gt; KnownValues;</span></CodeLine>
<Link id="l03568" /><CodeLine lineNumber="3568"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l03569" /><CodeLine lineNumber="3569"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l03570" /><CodeLine lineNumber="3570"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l03571" /><CodeLine lineNumber="3571"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN &amp;&amp; PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == BB) &#123;</span></CodeLine>
<Link id="l03572" /><CodeLine lineNumber="3572"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Degenerate case of a single entry PHI.</span></CodeLine>
<Link id="l03573" /><CodeLine lineNumber="3573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>() == 1) &#123;</span></CodeLine>
<Link id="l03574" /><CodeLine lineNumber="3574"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ab7e8be1d1ae7e526ea156b60c51c10e5">FoldSingleEntryPHINodes</a>(PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l03575" /><CodeLine lineNumber="3575"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03576" /><CodeLine lineNumber="3576"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03577" /><CodeLine lineNumber="3577"></CodeLine>
<Link id="l03578" /><CodeLine lineNumber="3578"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a1f0ff79b64a40d383b891f1baba89c6b">incoming&#95;values</a>())</span></CodeLine>
<Link id="l03579" /><CodeLine lineNumber="3579"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(U))</span></CodeLine>
<Link id="l03580" /><CodeLine lineNumber="3580"><span class="doxyHighlight">        KnownValues&#91;CB&#93;.<a href="/docs/api/classes/llvm/mapvector/#abb6ea6cbdf19ab64bf0c8f65b2e6e8ce">insert</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(U));</span></CodeLine>
<Link id="l03581" /><CodeLine lineNumber="3581"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03582" /><CodeLine lineNumber="3582"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l03583" /><CodeLine lineNumber="3583"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CB = <a href="#afb9fd1f991a7503fe4fd7dc16bda6f30">getKnownValueOnEdge</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, Pred, BB))</span></CodeLine>
<Link id="l03584" /><CodeLine lineNumber="3584"><span class="doxyHighlight">        KnownValues&#91;CB&#93;.<a href="/docs/api/classes/llvm/mapvector/#abb6ea6cbdf19ab64bf0c8f65b2e6e8ce">insert</a>(Pred);</span></CodeLine>
<Link id="l03585" /><CodeLine lineNumber="3585"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03586" /><CodeLine lineNumber="3586"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03587" /><CodeLine lineNumber="3587"></CodeLine>
<Link id="l03588" /><CodeLine lineNumber="3588"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (KnownValues.<a href="/docs/api/classes/llvm/mapvector/#a8da97c44f514ad1ae9ccf4518b0f88aa">empty</a>())</span></CodeLine>
<Link id="l03589" /><CodeLine lineNumber="3589"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03590" /><CodeLine lineNumber="3590"></CodeLine>
<Link id="l03591" /><CodeLine lineNumber="3591"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now we know that this block has multiple preds and two succs.</span></CodeLine>
<Link id="l03592" /><CodeLine lineNumber="3592"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that the block is small enough and values defined in the block are</span></CodeLine>
<Link id="l03593" /><CodeLine lineNumber="3593"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// not used outside of it.</span></CodeLine>
<Link id="l03594" /><CodeLine lineNumber="3594"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#aee330f66887329eef3ddc7dc8ccda193">blockIsSimpleEnoughToThreadThrough</a>(BB))</span></CodeLine>
<Link id="l03595" /><CodeLine lineNumber="3595"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03596" /><CodeLine lineNumber="3596"></CodeLine>
<Link id="l03597" /><CodeLine lineNumber="3597"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pair : KnownValues) &#123;</span></CodeLine>
<Link id="l03598" /><CodeLine lineNumber="3598"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Okay, we now know that all edges from PredBB should be revectored to</span></CodeLine>
<Link id="l03599" /><CodeLine lineNumber="3599"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// branch to RealDest.</span></CodeLine>
<Link id="l03600" /><CodeLine lineNumber="3600"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CB = Pair.first;</span></CodeLine>
<Link id="l03601" /><CodeLine lineNumber="3601"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;BasicBlock &#42;&gt;</a> PredBBs = Pair.second.getArrayRef();</span></CodeLine>
<Link id="l03602" /><CodeLine lineNumber="3602"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;RealDest = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(!CB-&gt;<a href="/docs/api/classes/llvm/constantint/#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>());</span></CodeLine>
<Link id="l03603" /><CodeLine lineNumber="3603"></CodeLine>
<Link id="l03604" /><CodeLine lineNumber="3604"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RealDest == BB)</span></CodeLine>
<Link id="l03605" /><CodeLine lineNumber="3605"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Skip self loops.</span></CodeLine>
<Link id="l03606" /><CodeLine lineNumber="3606"></CodeLine>
<Link id="l03607" /><CodeLine lineNumber="3607"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip if the predecessor&#39;s terminator is an indirect branch.</span></CodeLine>
<Link id="l03608" /><CodeLine lineNumber="3608"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(PredBBs, &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB) &#123;</span></CodeLine>
<Link id="l03609" /><CodeLine lineNumber="3609"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IndirectBrInst&gt;</a>(PredBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l03610" /><CodeLine lineNumber="3610"><span class="doxyHighlight">        &#125;))</span></CodeLine>
<Link id="l03611" /><CodeLine lineNumber="3611"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03612" /><CodeLine lineNumber="3612"></CodeLine>
<Link id="l03613" /><CodeLine lineNumber="3613"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l03614" /><CodeLine lineNumber="3614"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Condition &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; in &quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l03615" /><CodeLine lineNumber="3615"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; has value &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Pair.first &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; in predecessors:\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03616" /><CodeLine lineNumber="3616"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB : Pair.second)</span></CodeLine>
<Link id="l03617" /><CodeLine lineNumber="3617"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  &quot;</span><span class="doxyHighlight"> &lt;&lt; PredBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03618" /><CodeLine lineNumber="3618"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Threading to destination &quot;</span><span class="doxyHighlight"> &lt;&lt; RealDest-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;.\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03619" /><CodeLine lineNumber="3619"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l03620" /><CodeLine lineNumber="3620"></CodeLine>
<Link id="l03621" /><CodeLine lineNumber="3621"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Split the predecessors we are threading into a new edge block. We&#39;ll</span></CodeLine>
<Link id="l03622" /><CodeLine lineNumber="3622"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// clone the instructions into this block, and then redirect it to RealDest.</span></CodeLine>
<Link id="l03623" /><CodeLine lineNumber="3623"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EdgeBB = <a href="/docs/api/namespaces/llvm/#a9d391b6acc6d90c9b8a8442324b1aa6f">SplitBlockPredecessors</a>(BB, PredBBs, </span><span class="doxyHighlightStringLiteral">&quot;.critedge&quot;</span><span class="doxyHighlight">, DTU);</span></CodeLine>
<Link id="l03624" /><CodeLine lineNumber="3624"></CodeLine>
<Link id="l03625" /><CodeLine lineNumber="3625"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: These just exist to reduce test diff, we can drop them if we like.</span></CodeLine>
<Link id="l03626" /><CodeLine lineNumber="3626"><span class="doxyHighlight">    EdgeBB-&gt;setName(RealDest-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.critedge&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03627" /><CodeLine lineNumber="3627"><span class="doxyHighlight">    EdgeBB-&gt;moveBefore(RealDest);</span></CodeLine>
<Link id="l03628" /><CodeLine lineNumber="3628"></CodeLine>
<Link id="l03629" /><CodeLine lineNumber="3629"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update PHI nodes.</span></CodeLine>
<Link id="l03630" /><CodeLine lineNumber="3630"><span class="doxyHighlight">    <a href="#a0375fe3378c23272b805320851744043">addPredecessorToBlock</a>(RealDest, EdgeBB, BB);</span></CodeLine>
<Link id="l03631" /><CodeLine lineNumber="3631"></CodeLine>
<Link id="l03632" /><CodeLine lineNumber="3632"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// BB may have instructions that are being threaded over.  Clone these</span></CodeLine>
<Link id="l03633" /><CodeLine lineNumber="3633"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions into EdgeBB.  We know that there will be no uses of the</span></CodeLine>
<Link id="l03634" /><CodeLine lineNumber="3634"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cloned instructions outside of EdgeBB.</span></CodeLine>
<Link id="l03635" /><CodeLine lineNumber="3635"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = EdgeBB-&gt;getFirstInsertionPt();</span></CodeLine>
<Link id="l03636" /><CodeLine lineNumber="3636"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> TranslateMap; </span><span class="doxyHighlightComment">// Track translated values.</span></CodeLine>
<Link id="l03637" /><CodeLine lineNumber="3637"><span class="doxyHighlight">    TranslateMap&#91;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>&#93; = CB;</span></CodeLine>
<Link id="l03638" /><CodeLine lineNumber="3638"></CodeLine>
<Link id="l03639" /><CodeLine lineNumber="3639"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// RemoveDIs: track instructions that we optimise away while folding, so</span></CodeLine>
<Link id="l03640" /><CodeLine lineNumber="3640"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that we can copy DbgVariableRecords from them later.</span></CodeLine>
<Link id="l03641" /><CodeLine lineNumber="3641"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> SrcDbgCursor = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l03642" /><CodeLine lineNumber="3642"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); &amp;&#42;BBI != BI; ++BBI) &#123;</span></CodeLine>
<Link id="l03643" /><CodeLine lineNumber="3643"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BBI)) &#123;</span></CodeLine>
<Link id="l03644" /><CodeLine lineNumber="3644"><span class="doxyHighlight">        TranslateMap&#91;PN&#93; = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(EdgeBB);</span></CodeLine>
<Link id="l03645" /><CodeLine lineNumber="3645"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03646" /><CodeLine lineNumber="3646"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03647" /><CodeLine lineNumber="3647"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Clone the instruction.</span></CodeLine>
<Link id="l03648" /><CodeLine lineNumber="3648"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = BBI-&gt;clone();</span></CodeLine>
<Link id="l03649" /><CodeLine lineNumber="3649"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Insert the new instruction into its new home.</span></CodeLine>
<Link id="l03650" /><CodeLine lineNumber="3650"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;insertInto(EdgeBB, InsertPt);</span></CodeLine>
<Link id="l03651" /><CodeLine lineNumber="3651"></CodeLine>
<Link id="l03652" /><CodeLine lineNumber="3652"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBI-&gt;hasName())</span></CodeLine>
<Link id="l03653" /><CodeLine lineNumber="3653"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;setName(BBI-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.c&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03654" /><CodeLine lineNumber="3654"></CodeLine>
<Link id="l03655" /><CodeLine lineNumber="3655"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Update operands due to translation.</span></CodeLine>
<Link id="l03656" /><CodeLine lineNumber="3656"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;operands()) &#123;</span></CodeLine>
<Link id="l03657" /><CodeLine lineNumber="3657"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;::iterator</a> PI = TranslateMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l03658" /><CodeLine lineNumber="3658"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PI != TranslateMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l03659" /><CodeLine lineNumber="3659"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = PI-&gt;second;</span></CodeLine>
<Link id="l03660" /><CodeLine lineNumber="3660"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03661" /><CodeLine lineNumber="3661"></CodeLine>
<Link id="l03662" /><CodeLine lineNumber="3662"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check for trivial simplification.</span></CodeLine>
<Link id="l03663" /><CodeLine lineNumber="3663"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a57feb935aaafd1bd4bfbb8dc56ad2129">simplifyInstruction</a>(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, &#123;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, AC&#125;)) &#123;</span></CodeLine>
<Link id="l03664" /><CodeLine lineNumber="3664"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BBI-&gt;use&#95;empty())</span></CodeLine>
<Link id="l03665" /><CodeLine lineNumber="3665"><span class="doxyHighlight">          TranslateMap&#91;&amp;&#42;BBI&#93; = V;</span></CodeLine>
<Link id="l03666" /><CodeLine lineNumber="3666"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;mayHaveSideEffects()) &#123;</span></CodeLine>
<Link id="l03667" /><CodeLine lineNumber="3667"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;eraseFromParent(); </span><span class="doxyHighlightComment">// Instruction folded away, don&#39;t need actual</span></CodeLine>
<Link id="l03668" /><CodeLine lineNumber="3668"><span class="doxyHighlight">                                </span><span class="doxyHighlightComment">// inst</span></CodeLine>
<Link id="l03669" /><CodeLine lineNumber="3669"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03670" /><CodeLine lineNumber="3670"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l03671" /><CodeLine lineNumber="3671"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03672" /><CodeLine lineNumber="3672"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BBI-&gt;use&#95;empty())</span></CodeLine>
<Link id="l03673" /><CodeLine lineNumber="3673"><span class="doxyHighlight">          TranslateMap&#91;&amp;&#42;BBI&#93; = <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>;</span></CodeLine>
<Link id="l03674" /><CodeLine lineNumber="3674"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03675" /><CodeLine lineNumber="3675"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>) &#123;</span></CodeLine>
<Link id="l03676" /><CodeLine lineNumber="3676"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Copy all debug-info attached to instructions from the last we</span></CodeLine>
<Link id="l03677" /><CodeLine lineNumber="3677"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// successfully clone, up to this instruction (they might have been</span></CodeLine>
<Link id="l03678" /><CodeLine lineNumber="3678"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// folded away).</span></CodeLine>
<Link id="l03679" /><CodeLine lineNumber="3679"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; SrcDbgCursor != BBI; ++SrcDbgCursor)</span></CodeLine>
<Link id="l03680" /><CodeLine lineNumber="3680"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;cloneDebugInfoFrom(&amp;&#42;SrcDbgCursor);</span></CodeLine>
<Link id="l03681" /><CodeLine lineNumber="3681"><span class="doxyHighlight">        SrcDbgCursor = std::next(BBI);</span></CodeLine>
<Link id="l03682" /><CodeLine lineNumber="3682"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Clone debug-info on this instruction too.</span></CodeLine>
<Link id="l03683" /><CodeLine lineNumber="3683"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>-&gt;cloneDebugInfoFrom(&amp;&#42;BBI);</span></CodeLine>
<Link id="l03684" /><CodeLine lineNumber="3684"></CodeLine>
<Link id="l03685" /><CodeLine lineNumber="3685"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Register the new instruction with the assumption cache if necessary.</span></CodeLine>
<Link id="l03686" /><CodeLine lineNumber="3686"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Assume = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AssumeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>))</span></CodeLine>
<Link id="l03687" /><CodeLine lineNumber="3687"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AC)</span></CodeLine>
<Link id="l03688" /><CodeLine lineNumber="3688"><span class="doxyHighlight">            AC-&gt;<a href="/docs/api/classes/llvm/assumptioncache/#a23187618f079555e127ba0e7b4581530">registerAssumption</a>(Assume);</span></CodeLine>
<Link id="l03689" /><CodeLine lineNumber="3689"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03690" /><CodeLine lineNumber="3690"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03691" /><CodeLine lineNumber="3691"></CodeLine>
<Link id="l03692" /><CodeLine lineNumber="3692"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; &amp;&#42;SrcDbgCursor != BI; ++SrcDbgCursor)</span></CodeLine>
<Link id="l03693" /><CodeLine lineNumber="3693"><span class="doxyHighlight">      InsertPt-&gt;cloneDebugInfoFrom(&amp;&#42;SrcDbgCursor);</span></CodeLine>
<Link id="l03694" /><CodeLine lineNumber="3694"><span class="doxyHighlight">    InsertPt-&gt;cloneDebugInfoFrom(BI);</span></CodeLine>
<Link id="l03695" /><CodeLine lineNumber="3695"></CodeLine>
<Link id="l03696" /><CodeLine lineNumber="3696"><span class="doxyHighlight">    BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(EdgeBB);</span></CodeLine>
<Link id="l03697" /><CodeLine lineNumber="3697"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;EdgeBI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(EdgeBB-&gt;getTerminator());</span></CodeLine>
<Link id="l03698" /><CodeLine lineNumber="3698"><span class="doxyHighlight">    EdgeBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(0, RealDest);</span></CodeLine>
<Link id="l03699" /><CodeLine lineNumber="3699"><span class="doxyHighlight">    EdgeBI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l03700" /><CodeLine lineNumber="3700"></CodeLine>
<Link id="l03701" /><CodeLine lineNumber="3701"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l03702" /><CodeLine lineNumber="3702"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType, 2&gt;</a> Updates;</span></CodeLine>
<Link id="l03703" /><CodeLine lineNumber="3703"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, EdgeBB, BB&#125;);</span></CodeLine>
<Link id="l03704" /><CodeLine lineNumber="3704"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, EdgeBB, RealDest&#125;);</span></CodeLine>
<Link id="l03705" /><CodeLine lineNumber="3705"><span class="doxyHighlight">      DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l03706" /><CodeLine lineNumber="3706"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03707" /><CodeLine lineNumber="3707"></CodeLine>
<Link id="l03708" /><CodeLine lineNumber="3708"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For simplicity, we created a separate basic block for the edge. Merge</span></CodeLine>
<Link id="l03709" /><CodeLine lineNumber="3709"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it back into the predecessor if possible. This not only avoids</span></CodeLine>
<Link id="l03710" /><CodeLine lineNumber="3710"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// unnecessary SimplifyCFG iterations, but also makes sure that we don&#39;t</span></CodeLine>
<Link id="l03711" /><CodeLine lineNumber="3711"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bypass the check for trivial cycles above.</span></CodeLine>
<Link id="l03712" /><CodeLine lineNumber="3712"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(EdgeBB, DTU);</span></CodeLine>
<Link id="l03713" /><CodeLine lineNumber="3713"></CodeLine>
<Link id="l03714" /><CodeLine lineNumber="3714"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Signal repeat, simplifying any other constants.</span></CodeLine>
<Link id="l03715" /><CodeLine lineNumber="3715"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l03716" /><CodeLine lineNumber="3716"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03717" /><CodeLine lineNumber="3717"></CodeLine>
<Link id="l03718" /><CodeLine lineNumber="3718"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03719" /><CodeLine lineNumber="3719"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03720" /><CodeLine lineNumber="3720"></CodeLine>
<Link id="l03721" /><CodeLine lineNumber="3721" lineLink="#a3f284045c53ed237131eb9153017c364"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a3f284045c53ed237131eb9153017c364">foldCondBranchOnValueKnownInPredecessor</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI,</span></CodeLine>
<Link id="l03722" /><CodeLine lineNumber="3722"><span class="doxyHighlight">                                                    <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU,</span></CodeLine>
<Link id="l03723" /><CodeLine lineNumber="3723"><span class="doxyHighlight">                                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l03724" /><CodeLine lineNumber="3724"><span class="doxyHighlight">                                                    <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC) &#123;</span></CodeLine>
<Link id="l03725" /><CodeLine lineNumber="3725"><span class="doxyHighlight">  std::optional&lt;bool&gt; Result;</span></CodeLine>
<Link id="l03726" /><CodeLine lineNumber="3726"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EverChanged = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03727" /><CodeLine lineNumber="3727"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03728" /><CodeLine lineNumber="3728"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that None means &quot;we changed things, but recurse further.&quot;</span></CodeLine>
<Link id="l03729" /><CodeLine lineNumber="3729"><span class="doxyHighlight">    Result = <a href="#ac0fb2da7eaa616e8ef8a8f52b981334b">foldCondBranchOnValueKnownInPredecessorImpl</a>(BI, DTU, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, AC);</span></CodeLine>
<Link id="l03730" /><CodeLine lineNumber="3730"><span class="doxyHighlight">    EverChanged |= Result == std::nullopt || &#42;Result;</span></CodeLine>
<Link id="l03731" /><CodeLine lineNumber="3731"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (Result == std::nullopt);</span></CodeLine>
<Link id="l03732" /><CodeLine lineNumber="3732"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EverChanged;</span></CodeLine>
<Link id="l03733" /><CodeLine lineNumber="3733"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03734" /><CodeLine lineNumber="3734"></CodeLine>
<Link id="l03735" /><CodeLine lineNumber="3735"><span class="doxyHighlightComment">/// Given a BB that starts with the specified two-entry PHI node,</span></CodeLine>
<Link id="l03736" /><CodeLine lineNumber="3736"><span class="doxyHighlightComment">/// see if we can eliminate it.</span></CodeLine>
<Link id="l03737" /><CodeLine lineNumber="3737" lineLink="#a92fe4b2aa97a12f4a947e5ce99f05b15"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a92fe4b2aa97a12f4a947e5ce99f05b15">foldTwoEntryPHINode</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l03738" /><CodeLine lineNumber="3738"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l03739" /><CodeLine lineNumber="3739"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l03740" /><CodeLine lineNumber="3740"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SpeculateUnpredictables) &#123;</span></CodeLine>
<Link id="l03741" /><CodeLine lineNumber="3741"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ok, this is a two entry PHI node.  Check to see if this is a simple &quot;if</span></CodeLine>
<Link id="l03742" /><CodeLine lineNumber="3742"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// statement&quot;, which has a very simple dominance structure.  Basically, we</span></CodeLine>
<Link id="l03743" /><CodeLine lineNumber="3743"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are trying to find the condition that is being branched on, which</span></CodeLine>
<Link id="l03744" /><CodeLine lineNumber="3744"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// subsequently causes this merge to happen.  We really want control</span></CodeLine>
<Link id="l03745" /><CodeLine lineNumber="3745"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dependence information for this check, but simplifycfg can&#39;t keep it up</span></CodeLine>
<Link id="l03746" /><CodeLine lineNumber="3746"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to date, and this catches most of the cases we care about anyway.</span></CodeLine>
<Link id="l03747" /><CodeLine lineNumber="3747"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l03748" /><CodeLine lineNumber="3748"></CodeLine>
<Link id="l03749" /><CodeLine lineNumber="3749"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IfTrue, &#42;IfFalse;</span></CodeLine>
<Link id="l03750" /><CodeLine lineNumber="3750"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;DomBI = <a href="/docs/api/namespaces/llvm/#a1a5751a2dd7306ff9a59eae6c1de8925">GetIfCondition</a>(BB, IfTrue, IfFalse);</span></CodeLine>
<Link id="l03751" /><CodeLine lineNumber="3751"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DomBI)</span></CodeLine>
<Link id="l03752" /><CodeLine lineNumber="3752"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03753" /><CodeLine lineNumber="3753"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;IfCond = DomBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l03754" /><CodeLine lineNumber="3754"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t bother if the branch will be constant folded trivially.</span></CodeLine>
<Link id="l03755" /><CodeLine lineNumber="3755"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(IfCond))</span></CodeLine>
<Link id="l03756" /><CodeLine lineNumber="3756"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03757" /><CodeLine lineNumber="3757"></CodeLine>
<Link id="l03758" /><CodeLine lineNumber="3758"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DomBlock = DomBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l03759" /><CodeLine lineNumber="3759"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 2&gt;</a> IfBlocks;</span></CodeLine>
<Link id="l03760" /><CodeLine lineNumber="3760"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a4d13fd05401d8eb0c97b9864a0eb6028">llvm::copy&#95;if</a>(</span></CodeLine>
<Link id="l03761" /><CodeLine lineNumber="3761"><span class="doxyHighlight">      PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a14cf6d7a36d091cb666cb83221b81d72">blocks</a>(), std::back&#95;inserter(IfBlocks), &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IfBlock) &#123;</span></CodeLine>
<Link id="l03762" /><CodeLine lineNumber="3762"><span class="doxyHighlight">        return cast&lt;BranchInst&gt;(IfBlock-&gt;getTerminator())-&gt;isUnconditional();</span></CodeLine>
<Link id="l03763" /><CodeLine lineNumber="3763"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l03764" /><CodeLine lineNumber="3764"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((IfBlocks.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 1 || IfBlocks.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 2) &amp;&amp;</span></CodeLine>
<Link id="l03765" /><CodeLine lineNumber="3765"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Will have either one or two blocks to speculate.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03766" /><CodeLine lineNumber="3766"></CodeLine>
<Link id="l03767" /><CodeLine lineNumber="3767"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the branch is non-unpredictable, see if we either predictably jump to</span></CodeLine>
<Link id="l03768" /><CodeLine lineNumber="3768"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the merge bb (if we have only a single &#39;then&#39; block), or if we predictably</span></CodeLine>
<Link id="l03769" /><CodeLine lineNumber="3769"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// jump to one specific &#39;then&#39; block (if we have two of them).</span></CodeLine>
<Link id="l03770" /><CodeLine lineNumber="3770"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It isn&#39;t beneficial to speculatively execute the code</span></CodeLine>
<Link id="l03771" /><CodeLine lineNumber="3771"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from the block that we know is predictably not entered.</span></CodeLine>
<Link id="l03772" /><CodeLine lineNumber="3772"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsUnpredictable = DomBI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;unpredictable);</span></CodeLine>
<Link id="l03773" /><CodeLine lineNumber="3773"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsUnpredictable) &#123;</span></CodeLine>
<Link id="l03774" /><CodeLine lineNumber="3774"><span class="doxyHighlight">    uint64&#95;t TWeight, FWeight;</span></CodeLine>
<Link id="l03775" /><CodeLine lineNumber="3775"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;DomBI, TWeight, FWeight) &amp;&amp;</span></CodeLine>
<Link id="l03776" /><CodeLine lineNumber="3776"><span class="doxyHighlight">        (TWeight + FWeight) != 0) &#123;</span></CodeLine>
<Link id="l03777" /><CodeLine lineNumber="3777"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> BITrueProb =</span></CodeLine>
<Link id="l03778" /><CodeLine lineNumber="3778"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(TWeight, TWeight + FWeight);</span></CodeLine>
<Link id="l03779" /><CodeLine lineNumber="3779"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> Likely = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getPredictableBranchThreshold();</span></CodeLine>
<Link id="l03780" /><CodeLine lineNumber="3780"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> BIFalseProb = BITrueProb.<a href="/docs/api/classes/llvm/branchprobability/#aaee6034264d5d0782e5d1489360730d9">getCompl</a>();</span></CodeLine>
<Link id="l03781" /><CodeLine lineNumber="3781"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfBlocks.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 1) &#123;</span></CodeLine>
<Link id="l03782" /><CodeLine lineNumber="3782"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> BIBBProb =</span></CodeLine>
<Link id="l03783" /><CodeLine lineNumber="3783"><span class="doxyHighlight">            DomBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BB ? BITrueProb : BIFalseProb;</span></CodeLine>
<Link id="l03784" /><CodeLine lineNumber="3784"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BIBBProb &gt;= Likely)</span></CodeLine>
<Link id="l03785" /><CodeLine lineNumber="3785"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03786" /><CodeLine lineNumber="3786"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03787" /><CodeLine lineNumber="3787"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BITrueProb &gt;= Likely || BIFalseProb &gt;= Likely)</span></CodeLine>
<Link id="l03788" /><CodeLine lineNumber="3788"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03789" /><CodeLine lineNumber="3789"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03790" /><CodeLine lineNumber="3790"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03791" /><CodeLine lineNumber="3791"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03792" /><CodeLine lineNumber="3792"></CodeLine>
<Link id="l03793" /><CodeLine lineNumber="3793"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t try to fold an unreachable block. For example, the phi node itself</span></CodeLine>
<Link id="l03794" /><CodeLine lineNumber="3794"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can&#39;t be the candidate if-condition for a select that we want to form.</span></CodeLine>
<Link id="l03795" /><CodeLine lineNumber="3795"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IfCondPhiInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(IfCond))</span></CodeLine>
<Link id="l03796" /><CodeLine lineNumber="3796"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfCondPhiInst-&gt;getParent() == BB)</span></CodeLine>
<Link id="l03797" /><CodeLine lineNumber="3797"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03798" /><CodeLine lineNumber="3798"></CodeLine>
<Link id="l03799" /><CodeLine lineNumber="3799"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, we found that we can merge this two-entry phi node into a select.</span></CodeLine>
<Link id="l03800" /><CodeLine lineNumber="3800"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Doing so would require us to fold &#42;all&#42; two entry phi nodes in this block.</span></CodeLine>
<Link id="l03801" /><CodeLine lineNumber="3801"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At some point this becomes non-profitable (particularly if the target</span></CodeLine>
<Link id="l03802" /><CodeLine lineNumber="3802"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// doesn&#39;t support cmov&#39;s).  Only do this transformation if there are two or</span></CodeLine>
<Link id="l03803" /><CodeLine lineNumber="3803"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// fewer PHI nodes in this block.</span></CodeLine>
<Link id="l03804" /><CodeLine lineNumber="3804"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumPhis = 0;</span></CodeLine>
<Link id="l03805" /><CodeLine lineNumber="3805"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++NumPhis, ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l03806" /><CodeLine lineNumber="3806"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumPhis &gt; 2)</span></CodeLine>
<Link id="l03807" /><CodeLine lineNumber="3807"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03808" /><CodeLine lineNumber="3808"></CodeLine>
<Link id="l03809" /><CodeLine lineNumber="3809"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loop over the PHI&#39;s seeing if we can promote them all to select</span></CodeLine>
<Link id="l03810" /><CodeLine lineNumber="3810"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions.  While we are at it, keep track of the instructions</span></CodeLine>
<Link id="l03811" /><CodeLine lineNumber="3811"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that need to be moved to the dominating block.</span></CodeLine>
<Link id="l03812" /><CodeLine lineNumber="3812"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 4&gt;</a> AggressiveInsts;</span></CodeLine>
<Link id="l03813" /><CodeLine lineNumber="3813"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = 0;</span></CodeLine>
<Link id="l03814" /><CodeLine lineNumber="3814"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> Budget =</span></CodeLine>
<Link id="l03815" /><CodeLine lineNumber="3815"><span class="doxyHighlight">      <a href="#a4060584a976cdd9ab251ce690690796c">TwoEntryPHINodeFoldingThreshold</a> &#42; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>;</span></CodeLine>
<Link id="l03816" /><CodeLine lineNumber="3816"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SpeculateUnpredictables &amp;&amp; IsUnpredictable)</span></CodeLine>
<Link id="l03817" /><CodeLine lineNumber="3817"><span class="doxyHighlight">    Budget += <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getBranchMispredictPenalty();</span></CodeLine>
<Link id="l03818" /><CodeLine lineNumber="3818"></CodeLine>
<Link id="l03819" /><CodeLine lineNumber="3819"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03820" /><CodeLine lineNumber="3820"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);) &#123;</span></CodeLine>
<Link id="l03821" /><CodeLine lineNumber="3821"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>++);</span></CodeLine>
<Link id="l03822" /><CodeLine lineNumber="3822"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a57feb935aaafd1bd4bfbb8dc56ad2129">simplifyInstruction</a>(PN, &#123;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, PN&#125;)) &#123;</span></CodeLine>
<Link id="l03823" /><CodeLine lineNumber="3823"><span class="doxyHighlight">      PN-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</span></CodeLine>
<Link id="l03824" /><CodeLine lineNumber="3824"><span class="doxyHighlight">      PN-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l03825" /><CodeLine lineNumber="3825"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03826" /><CodeLine lineNumber="3826"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03827" /><CodeLine lineNumber="3827"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03828" /><CodeLine lineNumber="3828"></CodeLine>
<Link id="l03829" /><CodeLine lineNumber="3829"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#af67eef9e8d101756a1a0164e63eb4556">dominatesMergePoint</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0), BB, DomBI,</span></CodeLine>
<Link id="l03830" /><CodeLine lineNumber="3830"><span class="doxyHighlight">                             AggressiveInsts, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>, Budget, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, AC) ||</span></CodeLine>
<Link id="l03831" /><CodeLine lineNumber="3831"><span class="doxyHighlight">        !<a href="#af67eef9e8d101756a1a0164e63eb4556">dominatesMergePoint</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(1), BB, DomBI,</span></CodeLine>
<Link id="l03832" /><CodeLine lineNumber="3832"><span class="doxyHighlight">                             AggressiveInsts, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>, Budget, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, AC))</span></CodeLine>
<Link id="l03833" /><CodeLine lineNumber="3833"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l03834" /><CodeLine lineNumber="3834"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03835" /><CodeLine lineNumber="3835"></CodeLine>
<Link id="l03836" /><CodeLine lineNumber="3836"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we folded the first phi, PN dangles at this point.  Refresh it.  If</span></CodeLine>
<Link id="l03837" /><CodeLine lineNumber="3837"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we ran out of PHIs then we simplified them all.</span></CodeLine>
<Link id="l03838" /><CodeLine lineNumber="3838"><span class="doxyHighlight">  PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l03839" /><CodeLine lineNumber="3839"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PN)</span></CodeLine>
<Link id="l03840" /><CodeLine lineNumber="3840"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03841" /><CodeLine lineNumber="3841"></CodeLine>
<Link id="l03842" /><CodeLine lineNumber="3842"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return true if at least one of these is a &#39;not&#39;, and another is either</span></CodeLine>
<Link id="l03843" /><CodeLine lineNumber="3843"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a &#39;not&#39; too, or a constant.</span></CodeLine>
<Link id="l03844" /><CodeLine lineNumber="3844"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CanHoistNotFromBothValues = &#91;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V0, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V1) &#123;</span></CodeLine>
<Link id="l03845" /><CodeLine lineNumber="3845"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V0, <a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())))</span></CodeLine>
<Link id="l03846" /><CodeLine lineNumber="3846"><span class="doxyHighlight">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(V0, V1);</span></CodeLine>
<Link id="l03847" /><CodeLine lineNumber="3847"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Invertible = <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()), <a href="/docs/api/namespaces/llvm/patternmatch/#a479033140375e2c57df4a8257f7f5995">m&#95;AnyIntegralConstant</a>());</span></CodeLine>
<Link id="l03848" /><CodeLine lineNumber="3848"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V0, <a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())) &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(V1, Invertible);</span></CodeLine>
<Link id="l03849" /><CodeLine lineNumber="3849"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03850" /><CodeLine lineNumber="3850"></CodeLine>
<Link id="l03851" /><CodeLine lineNumber="3851"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t fold i1 branches on PHIs which contain binary operators or</span></CodeLine>
<Link id="l03852" /><CodeLine lineNumber="3852"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (possibly inverted) select form of or/ands,  unless one of</span></CodeLine>
<Link id="l03853" /><CodeLine lineNumber="3853"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the incoming values is an &#39;not&#39; and another one is freely invertible.</span></CodeLine>
<Link id="l03854" /><CodeLine lineNumber="3854"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// These can often be turned into switches and other things.</span></CodeLine>
<Link id="l03855" /><CodeLine lineNumber="3855"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsBinOpOrAnd = &#91;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l03856" /><CodeLine lineNumber="3856"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(</span></CodeLine>
<Link id="l03857" /><CodeLine lineNumber="3857"><span class="doxyHighlight">        V, <a href="/docs/api/namespaces/llvm/patternmatch/#afc43bc5ec4b20c7c5d663bef90da6066">m&#95;CombineOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a660fc5ca09b2e6a5860842b39149f9a9">m&#95;c&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5f6c38f6f64c2118341c829f97e26396">m&#95;ImmConstant</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())));</span></CodeLine>
<Link id="l03858" /><CodeLine lineNumber="3858"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03859" /><CodeLine lineNumber="3859"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>(1) &amp;&amp;</span></CodeLine>
<Link id="l03860" /><CodeLine lineNumber="3860"><span class="doxyHighlight">      (IsBinOpOrAnd(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0)) ||</span></CodeLine>
<Link id="l03861" /><CodeLine lineNumber="3861"><span class="doxyHighlight">       IsBinOpOrAnd(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(1)) || IsBinOpOrAnd(IfCond)) &amp;&amp;</span></CodeLine>
<Link id="l03862" /><CodeLine lineNumber="3862"><span class="doxyHighlight">      !CanHoistNotFromBothValues(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(0),</span></CodeLine>
<Link id="l03863" /><CodeLine lineNumber="3863"><span class="doxyHighlight">                                 PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(1)))</span></CodeLine>
<Link id="l03864" /><CodeLine lineNumber="3864"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l03865" /><CodeLine lineNumber="3865"></CodeLine>
<Link id="l03866" /><CodeLine lineNumber="3866"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If all PHI nodes are promotable, check to make sure that all instructions</span></CodeLine>
<Link id="l03867" /><CodeLine lineNumber="3867"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in the predecessor blocks can be promoted as well. If not, we won&#39;t be able</span></CodeLine>
<Link id="l03868" /><CodeLine lineNumber="3868"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to get rid of the control flow, so it&#39;s not worth promoting to select</span></CodeLine>
<Link id="l03869" /><CodeLine lineNumber="3869"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions.</span></CodeLine>
<Link id="l03870" /><CodeLine lineNumber="3870"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IfBlock : IfBlocks)</span></CodeLine>
<Link id="l03871" /><CodeLine lineNumber="3871"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = IfBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l03872" /><CodeLine lineNumber="3872"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AggressiveInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isDebugOrPseudoInst()) &#123;</span></CodeLine>
<Link id="l03873" /><CodeLine lineNumber="3873"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// This is not an aggressive instruction that we can promote.</span></CodeLine>
<Link id="l03874" /><CodeLine lineNumber="3874"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Because of this, we won&#39;t be able to get rid of the control flow, so</span></CodeLine>
<Link id="l03875" /><CodeLine lineNumber="3875"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the xform is not worth it.</span></CodeLine>
<Link id="l03876" /><CodeLine lineNumber="3876"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l03877" /><CodeLine lineNumber="3877"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03878" /><CodeLine lineNumber="3878"></CodeLine>
<Link id="l03879" /><CodeLine lineNumber="3879"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If either of the blocks has it&#39;s address taken, we can&#39;t do this fold.</span></CodeLine>
<Link id="l03880" /><CodeLine lineNumber="3880"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(IfBlocks,</span></CodeLine>
<Link id="l03881" /><CodeLine lineNumber="3881"><span class="doxyHighlight">             &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IfBlock) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IfBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>(); &#125;))</span></CodeLine>
<Link id="l03882" /><CodeLine lineNumber="3882"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l03883" /><CodeLine lineNumber="3883"></CodeLine>
<Link id="l03884" /><CodeLine lineNumber="3884"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;FOUND IF CONDITION!  &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;IfCond;</span></CodeLine>
<Link id="l03885" /><CodeLine lineNumber="3885"><span class="doxyHighlight">             </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsUnpredictable) <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; (unpredictable)&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03886" /><CodeLine lineNumber="3886"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  T: &quot;</span><span class="doxyHighlight"> &lt;&lt; IfTrue-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l03887" /><CodeLine lineNumber="3887"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  F: &quot;</span><span class="doxyHighlight"> &lt;&lt; IfFalse-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03888" /><CodeLine lineNumber="3888"></CodeLine>
<Link id="l03889" /><CodeLine lineNumber="3889"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we can still promote the PHI nodes after this gauntlet of tests,</span></CodeLine>
<Link id="l03890" /><CodeLine lineNumber="3890"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// do all of the PHI&#39;s now.</span></CodeLine>
<Link id="l03891" /><CodeLine lineNumber="3891"></CodeLine>
<Link id="l03892" /><CodeLine lineNumber="3892"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Move all &#39;aggressive&#39; instructions, which are defined in the</span></CodeLine>
<Link id="l03893" /><CodeLine lineNumber="3893"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// conditional parts of the if&#39;s up to the dominating block.</span></CodeLine>
<Link id="l03894" /><CodeLine lineNumber="3894"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IfBlock : IfBlocks)</span></CodeLine>
<Link id="l03895" /><CodeLine lineNumber="3895"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aab4d6b37c7f97bad2b1f441dc3fd43e0">hoistAllInstructionsInto</a>(DomBlock, DomBI, IfBlock);</span></CodeLine>
<Link id="l03896" /><CodeLine lineNumber="3896"></CodeLine>
<Link id="l03897" /><CodeLine lineNumber="3897"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;NoFolder&gt;</a> Builder(DomBI);</span></CodeLine>
<Link id="l03898" /><CodeLine lineNumber="3898"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Propagate fast-math-flags from phi nodes to replacement selects.</span></CodeLine>
<Link id="l03899" /><CodeLine lineNumber="3899"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>())) &#123;</span></CodeLine>
<Link id="l03900" /><CodeLine lineNumber="3900"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Change the PHI node into a select instruction.</span></CodeLine>
<Link id="l03901" /><CodeLine lineNumber="3901"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;TrueVal = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(IfTrue);</span></CodeLine>
<Link id="l03902" /><CodeLine lineNumber="3902"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;FalseVal = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(IfFalse);</span></CodeLine>
<Link id="l03903" /><CodeLine lineNumber="3903"></CodeLine>
<Link id="l03904" /><CodeLine lineNumber="3904"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Sel = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3cd8a9205d8cc6d024b6e6344a72aca0">CreateSelectFMF</a>(IfCond, TrueVal, FalseVal,</span></CodeLine>
<Link id="l03905" /><CodeLine lineNumber="3905"><span class="doxyHighlight">                                         <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FPMathOperator&gt;</a>(PN) ? PN : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03906" /><CodeLine lineNumber="3906"><span class="doxyHighlight">                                         </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, DomBI);</span></CodeLine>
<Link id="l03907" /><CodeLine lineNumber="3907"><span class="doxyHighlight">    PN-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Sel);</span></CodeLine>
<Link id="l03908" /><CodeLine lineNumber="3908"><span class="doxyHighlight">    Sel-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(PN);</span></CodeLine>
<Link id="l03909" /><CodeLine lineNumber="3909"><span class="doxyHighlight">    PN-&gt;eraseFromParent();</span></CodeLine>
<Link id="l03910" /><CodeLine lineNumber="3910"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03911" /><CodeLine lineNumber="3911"></CodeLine>
<Link id="l03912" /><CodeLine lineNumber="3912"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At this point, all IfBlocks are empty, so our if statement</span></CodeLine>
<Link id="l03913" /><CodeLine lineNumber="3913"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// has been flattened.  Change DomBlock to jump directly to our new block to</span></CodeLine>
<Link id="l03914" /><CodeLine lineNumber="3914"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// avoid other simplifycfg&#39;s kicking in on the diamond.</span></CodeLine>
<Link id="l03915" /><CodeLine lineNumber="3915"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(BB);</span></CodeLine>
<Link id="l03916" /><CodeLine lineNumber="3916"></CodeLine>
<Link id="l03917" /><CodeLine lineNumber="3917"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType, 3&gt;</a> Updates;</span></CodeLine>
<Link id="l03918" /><CodeLine lineNumber="3918"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l03919" /><CodeLine lineNumber="3919"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, DomBlock, BB&#125;);</span></CodeLine>
<Link id="l03920" /><CodeLine lineNumber="3920"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a> : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(DomBlock))</span></CodeLine>
<Link id="l03921" /><CodeLine lineNumber="3921"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, DomBlock, <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>&#125;);</span></CodeLine>
<Link id="l03922" /><CodeLine lineNumber="3922"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03923" /><CodeLine lineNumber="3923"></CodeLine>
<Link id="l03924" /><CodeLine lineNumber="3924"><span class="doxyHighlight">  DomBI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l03925" /><CodeLine lineNumber="3925"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l03926" /><CodeLine lineNumber="3926"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l03927" /><CodeLine lineNumber="3927"></CodeLine>
<Link id="l03928" /><CodeLine lineNumber="3928"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03929" /><CodeLine lineNumber="3929"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03930" /><CodeLine lineNumber="3930"></CodeLine>
<Link id="l03931" /><CodeLine lineNumber="3931" lineLink="#a6092c4a20d4eba2072c849c5408b9435"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a6092c4a20d4eba2072c849c5408b9435">createLogicalOp</a>(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder,</span></CodeLine>
<Link id="l03932" /><CodeLine lineNumber="3932"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opc, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</span></CodeLine>
<Link id="l03933" /><CodeLine lineNumber="3933"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name = </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l03934" /><CodeLine lineNumber="3934"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to relax logical op to binary op.</span></CodeLine>
<Link id="l03935" /><CodeLine lineNumber="3935"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a71a4a4e0f6178682ef05a0d85891e5a9">impliesPoison</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>))</span></CodeLine>
<Link id="l03936" /><CodeLine lineNumber="3936"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aba5d97f3a14427982c1b86dafd033320">CreateBinOp</a>(Opc, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name);</span></CodeLine>
<Link id="l03937" /><CodeLine lineNumber="3937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opc == Instruction::And)</span></CodeLine>
<Link id="l03938" /><CodeLine lineNumber="3938"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abb42f81be3350e8f94849e8e6aceabab">CreateLogicalAnd</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name);</span></CodeLine>
<Link id="l03939" /><CodeLine lineNumber="3939"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opc == Instruction::Or)</span></CodeLine>
<Link id="l03940" /><CodeLine lineNumber="3940"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae1db5150fc798ca464de8923ba0b8e7f">CreateLogicalOr</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Name);</span></CodeLine>
<Link id="l03941" /><CodeLine lineNumber="3941"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Invalid logical opcode&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03942" /><CodeLine lineNumber="3942"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03943" /><CodeLine lineNumber="3943"></CodeLine>
<Link id="l03944" /><CodeLine lineNumber="3944"><span class="doxyHighlightComment">/// Return true if either PBI or BI has branch weight available, and store</span></CodeLine>
<Link id="l03945" /><CodeLine lineNumber="3945"><span class="doxyHighlightComment">/// the weights in &#123;Pred|Succ&#125;&#123;True|False&#125;Weight. If one of PBI and BI does</span></CodeLine>
<Link id="l03946" /><CodeLine lineNumber="3946"><span class="doxyHighlightComment">/// not have branch weight, use 1:1 as its weight.</span></CodeLine>
<Link id="l03947" /><CodeLine lineNumber="3947" lineLink="#a404f7a1827e4eb8c5ded5ce6dafecf07"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a404f7a1827e4eb8c5ded5ce6dafecf07">extractPredSuccWeights</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PBI, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI,</span></CodeLine>
<Link id="l03948" /><CodeLine lineNumber="3948"><span class="doxyHighlight">                                   uint64&#95;t &amp;PredTrueWeight,</span></CodeLine>
<Link id="l03949" /><CodeLine lineNumber="3949"><span class="doxyHighlight">                                   uint64&#95;t &amp;PredFalseWeight,</span></CodeLine>
<Link id="l03950" /><CodeLine lineNumber="3950"><span class="doxyHighlight">                                   uint64&#95;t &amp;SuccTrueWeight,</span></CodeLine>
<Link id="l03951" /><CodeLine lineNumber="3951"><span class="doxyHighlight">                                   uint64&#95;t &amp;SuccFalseWeight) &#123;</span></CodeLine>
<Link id="l03952" /><CodeLine lineNumber="3952"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PredHasWeights =</span></CodeLine>
<Link id="l03953" /><CodeLine lineNumber="3953"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;PBI, PredTrueWeight, PredFalseWeight);</span></CodeLine>
<Link id="l03954" /><CodeLine lineNumber="3954"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SuccHasWeights =</span></CodeLine>
<Link id="l03955" /><CodeLine lineNumber="3955"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;BI, SuccTrueWeight, SuccFalseWeight);</span></CodeLine>
<Link id="l03956" /><CodeLine lineNumber="3956"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredHasWeights || SuccHasWeights) &#123;</span></CodeLine>
<Link id="l03957" /><CodeLine lineNumber="3957"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredHasWeights)</span></CodeLine>
<Link id="l03958" /><CodeLine lineNumber="3958"><span class="doxyHighlight">      PredTrueWeight = PredFalseWeight = 1;</span></CodeLine>
<Link id="l03959" /><CodeLine lineNumber="3959"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SuccHasWeights)</span></CodeLine>
<Link id="l03960" /><CodeLine lineNumber="3960"><span class="doxyHighlight">      SuccTrueWeight = SuccFalseWeight = 1;</span></CodeLine>
<Link id="l03961" /><CodeLine lineNumber="3961"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03962" /><CodeLine lineNumber="3962"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03963" /><CodeLine lineNumber="3963"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03964" /><CodeLine lineNumber="3964"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03965" /><CodeLine lineNumber="3965"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03966" /><CodeLine lineNumber="3966"></CodeLine>
<Link id="l03967" /><CodeLine lineNumber="3967"><span class="doxyHighlightComment">/// Determine if the two branches share a common destination and deduce a glue</span></CodeLine>
<Link id="l03968" /><CodeLine lineNumber="3968"><span class="doxyHighlightComment">/// that joins the branches&#39; conditions to arrive at the common destination if</span></CodeLine>
<Link id="l03969" /><CodeLine lineNumber="3969"><span class="doxyHighlightComment">/// that would be profitable.</span></CodeLine>
<Link id="l03970" /><CodeLine lineNumber="3970"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::optional&lt;std::tuple&lt;BasicBlock &#42;, Instruction::BinaryOps, bool&gt;&gt;</span></CodeLine>
<Link id="l03971" /><CodeLine lineNumber="3971" lineLink="#a1c4994ac805321b7fa03617dff656ad8"><span class="doxyHighlight"><a href="#a1c4994ac805321b7fa03617dff656ad8">shouldFoldCondBranchesToCommonDestination</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PBI,</span></CodeLine>
<Link id="l03972" /><CodeLine lineNumber="3972"><span class="doxyHighlight">                                          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l03973" /><CodeLine lineNumber="3973"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI &amp;&amp; PBI &amp;&amp; BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp;</span></CodeLine>
<Link id="l03974" /><CodeLine lineNumber="3974"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Both blocks must end with a conditional branches.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03975" /><CodeLine lineNumber="3975"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()), PBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) &amp;&amp;</span></CodeLine>
<Link id="l03976" /><CodeLine lineNumber="3976"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;PredBB must be a predecessor of BB.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03977" /><CodeLine lineNumber="3977"></CodeLine>
<Link id="l03978" /><CodeLine lineNumber="3978"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We have the potential to fold the conditions together, but if the</span></CodeLine>
<Link id="l03979" /><CodeLine lineNumber="3979"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor branch is predictable, we may not want to merge them.</span></CodeLine>
<Link id="l03980" /><CodeLine lineNumber="3980"><span class="doxyHighlight">  uint64&#95;t PTWeight, PFWeight;</span></CodeLine>
<Link id="l03981" /><CodeLine lineNumber="3981"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> PBITrueProb, Likely;</span></CodeLine>
<Link id="l03982" /><CodeLine lineNumber="3982"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> &amp;&amp; !PBI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;unpredictable) &amp;&amp;</span></CodeLine>
<Link id="l03983" /><CodeLine lineNumber="3983"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;PBI, PTWeight, PFWeight) &amp;&amp;</span></CodeLine>
<Link id="l03984" /><CodeLine lineNumber="3984"><span class="doxyHighlight">      (PTWeight + PFWeight) != 0) &#123;</span></CodeLine>
<Link id="l03985" /><CodeLine lineNumber="3985"><span class="doxyHighlight">    PBITrueProb =</span></CodeLine>
<Link id="l03986" /><CodeLine lineNumber="3986"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(PTWeight, PTWeight + PFWeight);</span></CodeLine>
<Link id="l03987" /><CodeLine lineNumber="3987"><span class="doxyHighlight">    Likely = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getPredictableBranchThreshold();</span></CodeLine>
<Link id="l03988" /><CodeLine lineNumber="3988"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03989" /><CodeLine lineNumber="3989"></CodeLine>
<Link id="l03990" /><CodeLine lineNumber="3990"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)) &#123;</span></CodeLine>
<Link id="l03991" /><CodeLine lineNumber="3991"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Speculate the 2nd condition unless the 1st is probably true.</span></CodeLine>
<Link id="l03992" /><CodeLine lineNumber="3992"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBITrueProb.<a href="/docs/api/classes/llvm/branchprobability/#a7f41716b68c197b7cd7582d7a66201a3">isUnknown</a>() || PBITrueProb &lt; Likely)</span></CodeLine>
<Link id="l03993" /><CodeLine lineNumber="3993"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;&#123;BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0), Instruction::Or, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">&#125;&#125;;</span></CodeLine>
<Link id="l03994" /><CodeLine lineNumber="3994"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)) &#123;</span></CodeLine>
<Link id="l03995" /><CodeLine lineNumber="3995"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Speculate the 2nd condition unless the 1st is probably false.</span></CodeLine>
<Link id="l03996" /><CodeLine lineNumber="3996"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBITrueProb.<a href="/docs/api/classes/llvm/branchprobability/#a7f41716b68c197b7cd7582d7a66201a3">isUnknown</a>() || PBITrueProb.<a href="/docs/api/classes/llvm/branchprobability/#aaee6034264d5d0782e5d1489360730d9">getCompl</a>() &lt; Likely)</span></CodeLine>
<Link id="l03997" /><CodeLine lineNumber="3997"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;&#123;BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1), Instruction::And, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">&#125;&#125;;</span></CodeLine>
<Link id="l03998" /><CodeLine lineNumber="3998"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)) &#123;</span></CodeLine>
<Link id="l03999" /><CodeLine lineNumber="3999"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Speculate the 2nd condition unless the 1st is probably true.</span></CodeLine>
<Link id="l04000" /><CodeLine lineNumber="4000"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBITrueProb.<a href="/docs/api/classes/llvm/branchprobability/#a7f41716b68c197b7cd7582d7a66201a3">isUnknown</a>() || PBITrueProb &lt; Likely)</span></CodeLine>
<Link id="l04001" /><CodeLine lineNumber="4001"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;&#123;BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1), Instruction::And, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">&#125;&#125;;</span></CodeLine>
<Link id="l04002" /><CodeLine lineNumber="4002"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)) &#123;</span></CodeLine>
<Link id="l04003" /><CodeLine lineNumber="4003"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Speculate the 2nd condition unless the 1st is probably false.</span></CodeLine>
<Link id="l04004" /><CodeLine lineNumber="4004"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBITrueProb.<a href="/docs/api/classes/llvm/branchprobability/#a7f41716b68c197b7cd7582d7a66201a3">isUnknown</a>() || PBITrueProb.<a href="/docs/api/classes/llvm/branchprobability/#aaee6034264d5d0782e5d1489360730d9">getCompl</a>() &lt; Likely)</span></CodeLine>
<Link id="l04005" /><CodeLine lineNumber="4005"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;&#123;BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0), Instruction::Or, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">&#125;&#125;;</span></CodeLine>
<Link id="l04006" /><CodeLine lineNumber="4006"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04007" /><CodeLine lineNumber="4007"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l04008" /><CodeLine lineNumber="4008"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04009" /><CodeLine lineNumber="4009"></CodeLine>
<Link id="l04010" /><CodeLine lineNumber="4010" lineLink="#a31a4e5663521fd6944605496cbc32bbb"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a31a4e5663521fd6944605496cbc32bbb">performBranchToCommonDestFolding</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PBI,</span></CodeLine>
<Link id="l04011" /><CodeLine lineNumber="4011"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU,</span></CodeLine>
<Link id="l04012" /><CodeLine lineNumber="4012"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &#42;MSSAU,</span></CodeLine>
<Link id="l04013" /><CodeLine lineNumber="4013"><span class="doxyHighlight">                                             </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l04014" /><CodeLine lineNumber="4014"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l04015" /><CodeLine lineNumber="4015"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBlock = PBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l04016" /><CodeLine lineNumber="4016"></CodeLine>
<Link id="l04017" /><CodeLine lineNumber="4017"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine if the two branches share a common destination.</span></CodeLine>
<Link id="l04018" /><CodeLine lineNumber="4018"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CommonSucc;</span></CodeLine>
<Link id="l04019" /><CodeLine lineNumber="4019"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opc;</span></CodeLine>
<Link id="l04020" /><CodeLine lineNumber="4020"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InvertPredCond;</span></CodeLine>
<Link id="l04021" /><CodeLine lineNumber="4021"><span class="doxyHighlight">  std::tie(CommonSucc, Opc, InvertPredCond) =</span></CodeLine>
<Link id="l04022" /><CodeLine lineNumber="4022"><span class="doxyHighlight">      &#42;<a href="#a1c4994ac805321b7fa03617dff656ad8">shouldFoldCondBranchesToCommonDestination</a>(BI, PBI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l04023" /><CodeLine lineNumber="4023"></CodeLine>
<Link id="l04024" /><CodeLine lineNumber="4024"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;FOLDING BRANCH TO COMMON DEST:\\n&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PBI &lt;&lt; &#42;BB);</span></CodeLine>
<Link id="l04025" /><CodeLine lineNumber="4025"></CodeLine>
<Link id="l04026" /><CodeLine lineNumber="4026"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(PBI);</span></CodeLine>
<Link id="l04027" /><CodeLine lineNumber="4027"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The builder is used to create instructions to eliminate the branch in BB.</span></CodeLine>
<Link id="l04028" /><CodeLine lineNumber="4028"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If BB&#39;s terminator has !annotation metadata, add it to the new</span></CodeLine>
<Link id="l04029" /><CodeLine lineNumber="4029"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions.</span></CodeLine>
<Link id="l04030" /><CodeLine lineNumber="4030"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a7974ba4119283cc5bb39ea9f96658233">CollectMetadataToCopy</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(),</span></CodeLine>
<Link id="l04031" /><CodeLine lineNumber="4031"><span class="doxyHighlight">                                &#123;LLVMContext::MD&#95;annotation&#125;);</span></CodeLine>
<Link id="l04032" /><CodeLine lineNumber="4032"></CodeLine>
<Link id="l04033" /><CodeLine lineNumber="4033"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we need to invert the condition in the pred block to match, do so now.</span></CodeLine>
<Link id="l04034" /><CodeLine lineNumber="4034"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InvertPredCond) &#123;</span></CodeLine>
<Link id="l04035" /><CodeLine lineNumber="4035"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a70cdc32fcfc8ba3feaf026f4959e2c2a">InvertBranch</a>(PBI, Builder);</span></CodeLine>
<Link id="l04036" /><CodeLine lineNumber="4036"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04037" /><CodeLine lineNumber="4037"></CodeLine>
<Link id="l04038" /><CodeLine lineNumber="4038"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UniqueSucc =</span></CodeLine>
<Link id="l04039" /><CodeLine lineNumber="4039"><span class="doxyHighlight">      PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BB ? BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) : BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l04040" /><CodeLine lineNumber="4040"></CodeLine>
<Link id="l04041" /><CodeLine lineNumber="4041"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Before cloning instructions, notify the successor basic block that it</span></CodeLine>
<Link id="l04042" /><CodeLine lineNumber="4042"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is about to have a new predecessor. This will update PHI nodes,</span></CodeLine>
<Link id="l04043" /><CodeLine lineNumber="4043"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which will allow us to update live-out uses of bonus instructions.</span></CodeLine>
<Link id="l04044" /><CodeLine lineNumber="4044"><span class="doxyHighlight">  <a href="#a0375fe3378c23272b805320851744043">addPredecessorToBlock</a>(UniqueSucc, PredBlock, BB, MSSAU);</span></CodeLine>
<Link id="l04045" /><CodeLine lineNumber="4045"></CodeLine>
<Link id="l04046" /><CodeLine lineNumber="4046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to update branch weights.</span></CodeLine>
<Link id="l04047" /><CodeLine lineNumber="4047"><span class="doxyHighlight">  uint64&#95;t PredTrueWeight, PredFalseWeight, SuccTrueWeight, SuccFalseWeight;</span></CodeLine>
<Link id="l04048" /><CodeLine lineNumber="4048"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a404f7a1827e4eb8c5ded5ce6dafecf07">extractPredSuccWeights</a>(PBI, BI, PredTrueWeight, PredFalseWeight,</span></CodeLine>
<Link id="l04049" /><CodeLine lineNumber="4049"><span class="doxyHighlight">                             SuccTrueWeight, SuccFalseWeight)) &#123;</span></CodeLine>
<Link id="l04050" /><CodeLine lineNumber="4050"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint64&#95;t, 8&gt;</a> NewWeights;</span></CodeLine>
<Link id="l04051" /><CodeLine lineNumber="4051"></CodeLine>
<Link id="l04052" /><CodeLine lineNumber="4052"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BB) &#123;</span></CodeLine>
<Link id="l04053" /><CodeLine lineNumber="4053"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// PBI: br i1 %x, BB, FalseDest</span></CodeLine>
<Link id="l04054" /><CodeLine lineNumber="4054"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// BI:  br i1 %y, UniqueSucc, FalseDest</span></CodeLine>
<Link id="l04055" /><CodeLine lineNumber="4055"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TrueWeight is TrueWeight for PBI &#42; TrueWeight for BI.</span></CodeLine>
<Link id="l04056" /><CodeLine lineNumber="4056"><span class="doxyHighlight">      NewWeights.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PredTrueWeight &#42; SuccTrueWeight);</span></CodeLine>
<Link id="l04057" /><CodeLine lineNumber="4057"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FalseWeight is FalseWeight for PBI &#42; TotalWeight for BI +</span></CodeLine>
<Link id="l04058" /><CodeLine lineNumber="4058"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//               TrueWeight for PBI &#42; FalseWeight for BI.</span></CodeLine>
<Link id="l04059" /><CodeLine lineNumber="4059"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We assume that total weights of a BranchInst can fit into 32 bits.</span></CodeLine>
<Link id="l04060" /><CodeLine lineNumber="4060"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Therefore, we will not have overflow using 64-bit arithmetic.</span></CodeLine>
<Link id="l04061" /><CodeLine lineNumber="4061"><span class="doxyHighlight">      NewWeights.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PredFalseWeight &#42;</span></CodeLine>
<Link id="l04062" /><CodeLine lineNumber="4062"><span class="doxyHighlight">                               (SuccFalseWeight + SuccTrueWeight) +</span></CodeLine>
<Link id="l04063" /><CodeLine lineNumber="4063"><span class="doxyHighlight">                           PredTrueWeight &#42; SuccFalseWeight);</span></CodeLine>
<Link id="l04064" /><CodeLine lineNumber="4064"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04065" /><CodeLine lineNumber="4065"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// PBI: br i1 %x, TrueDest, BB</span></CodeLine>
<Link id="l04066" /><CodeLine lineNumber="4066"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// BI:  br i1 %y, TrueDest, UniqueSucc</span></CodeLine>
<Link id="l04067" /><CodeLine lineNumber="4067"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TrueWeight is TrueWeight for PBI &#42; TotalWeight for BI +</span></CodeLine>
<Link id="l04068" /><CodeLine lineNumber="4068"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//              FalseWeight for PBI &#42; TrueWeight for BI.</span></CodeLine>
<Link id="l04069" /><CodeLine lineNumber="4069"><span class="doxyHighlight">      NewWeights.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PredTrueWeight &#42; (SuccFalseWeight + SuccTrueWeight) +</span></CodeLine>
<Link id="l04070" /><CodeLine lineNumber="4070"><span class="doxyHighlight">                           PredFalseWeight &#42; SuccTrueWeight);</span></CodeLine>
<Link id="l04071" /><CodeLine lineNumber="4071"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FalseWeight is FalseWeight for PBI &#42; FalseWeight for BI.</span></CodeLine>
<Link id="l04072" /><CodeLine lineNumber="4072"><span class="doxyHighlight">      NewWeights.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PredFalseWeight &#42; SuccFalseWeight);</span></CodeLine>
<Link id="l04073" /><CodeLine lineNumber="4073"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04074" /><CodeLine lineNumber="4074"></CodeLine>
<Link id="l04075" /><CodeLine lineNumber="4075"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Halve the weights if any of them cannot fit in an uint32&#95;t</span></CodeLine>
<Link id="l04076" /><CodeLine lineNumber="4076"><span class="doxyHighlight">    <a href="#a7b05fae85db516bdd2df79cef5a6343d">fitWeights</a>(NewWeights);</span></CodeLine>
<Link id="l04077" /><CodeLine lineNumber="4077"></CodeLine>
<Link id="l04078" /><CodeLine lineNumber="4078"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint32&#95;t, 8&gt;</a> MDWeights(NewWeights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), NewWeights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l04079" /><CodeLine lineNumber="4079"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(PBI, MDWeights&#91;0&#93;, MDWeights&#91;1&#93;, </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04080" /><CodeLine lineNumber="4080"></CodeLine>
<Link id="l04081" /><CodeLine lineNumber="4081"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: If BB is reachable from all paths through PredBlock, then we</span></CodeLine>
<Link id="l04082" /><CodeLine lineNumber="4082"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// could replace PBI&#39;s branch probabilities with BI&#39;s.</span></CodeLine>
<Link id="l04083" /><CodeLine lineNumber="4083"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04084" /><CodeLine lineNumber="4084"><span class="doxyHighlight">    PBI-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;prof, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04085" /><CodeLine lineNumber="4085"></CodeLine>
<Link id="l04086" /><CodeLine lineNumber="4086"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now, update the CFG.</span></CodeLine>
<Link id="l04087" /><CodeLine lineNumber="4087"><span class="doxyHighlight">  PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != BB, UniqueSucc);</span></CodeLine>
<Link id="l04088" /><CodeLine lineNumber="4088"></CodeLine>
<Link id="l04089" /><CodeLine lineNumber="4089"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l04090" /><CodeLine lineNumber="4090"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(&#123;&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, PredBlock, UniqueSucc&#125;,</span></CodeLine>
<Link id="l04091" /><CodeLine lineNumber="4091"><span class="doxyHighlight">                       &#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, PredBlock, BB&#125;&#125;);</span></CodeLine>
<Link id="l04092" /><CodeLine lineNumber="4092"></CodeLine>
<Link id="l04093" /><CodeLine lineNumber="4093"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If BI was a loop latch, it may have had associated loop metadata.</span></CodeLine>
<Link id="l04094" /><CodeLine lineNumber="4094"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to copy it to the new latch, that is, PBI.</span></CodeLine>
<Link id="l04095" /><CodeLine lineNumber="4095"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;LoopMD = BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;loop))</span></CodeLine>
<Link id="l04096" /><CodeLine lineNumber="4096"><span class="doxyHighlight">    PBI-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;loop, LoopMD);</span></CodeLine>
<Link id="l04097" /><CodeLine lineNumber="4097"></CodeLine>
<Link id="l04098" /><CodeLine lineNumber="4098"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> VMap; </span><span class="doxyHighlightComment">// maps original values to cloned values</span></CodeLine>
<Link id="l04099" /><CodeLine lineNumber="4099"><span class="doxyHighlight">  <a href="#a2a8aa905f11fdce2fbbfd8e695d282b5">cloneInstructionsIntoPredecessorBlockAndUpdateSSAUses</a>(BB, PredBlock, VMap);</span></CodeLine>
<Link id="l04100" /><CodeLine lineNumber="4100"></CodeLine>
<Link id="l04101" /><CodeLine lineNumber="4101"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/module">Module</a> &#42;M = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#afc70e919c88c86159cc94cea29b6c210">getModule</a>();</span></CodeLine>
<Link id="l04102" /><CodeLine lineNumber="4102"></CodeLine>
<Link id="l04103" /><CodeLine lineNumber="4103"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab571b8358a3a8b6db1327d06bdc5e9f4">IsNewDbgInfoFormat</a>) &#123;</span></CodeLine>
<Link id="l04104" /><CodeLine lineNumber="4104"><span class="doxyHighlight">    PredBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a2c89a7c3adbeaf3cc5d02a41401801fb">cloneDebugInfoFrom</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l04105" /><CodeLine lineNumber="4105"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &amp;DVR :</span></CodeLine>
<Link id="l04106" /><CodeLine lineNumber="4106"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#ae876eb96b89c1afcc3e9cd285cc3f08c">filterDbgVars</a>(PredBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a431be97c0e4d03f713d927197cdcfff0">getDbgRecordRange</a>())) &#123;</span></CodeLine>
<Link id="l04107" /><CodeLine lineNumber="4107"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7f9da6836e29ef23fa74d3af96dad639">RemapDbgRecord</a>(M, &amp;DVR, VMap,</span></CodeLine>
<Link id="l04108" /><CodeLine lineNumber="4108"><span class="doxyHighlight">                     <a href="/docs/api/namespaces/llvm/#a77724415203930efd07d7098cb1e437da9a24bd8dba1bef2753bc3f087435ae7f">RF&#95;NoModuleLevelChanges</a> | <a href="/docs/api/namespaces/llvm/#a77724415203930efd07d7098cb1e437da5633028bc27ffa8eab39cc5de65b3108">RF&#95;IgnoreMissingLocals</a>);</span></CodeLine>
<Link id="l04109" /><CodeLine lineNumber="4109"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04110" /><CodeLine lineNumber="4110"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04111" /><CodeLine lineNumber="4111"></CodeLine>
<Link id="l04112" /><CodeLine lineNumber="4112"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that the Cond was cloned into the predecessor basic block,</span></CodeLine>
<Link id="l04113" /><CodeLine lineNumber="4113"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or/and the two conditions together.</span></CodeLine>
<Link id="l04114" /><CodeLine lineNumber="4114"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;BICond = VMap&#91;BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>()&#93;;</span></CodeLine>
<Link id="l04115" /><CodeLine lineNumber="4115"><span class="doxyHighlight">  PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a3505dab06f59c36142a234321cdc3411">setCondition</a>(</span></CodeLine>
<Link id="l04116" /><CodeLine lineNumber="4116"><span class="doxyHighlight">      <a href="#a6092c4a20d4eba2072c849c5408b9435">createLogicalOp</a>(Builder, Opc, PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>(), BICond, </span><span class="doxyHighlightStringLiteral">&quot;or.cond&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l04117" /><CodeLine lineNumber="4117"></CodeLine>
<Link id="l04118" /><CodeLine lineNumber="4118"><span class="doxyHighlight">  ++NumFoldBranchToCommonDest;</span></CodeLine>
<Link id="l04119" /><CodeLine lineNumber="4119"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04120" /><CodeLine lineNumber="4120"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04121" /><CodeLine lineNumber="4121"></CodeLine>
<Link id="l04122" /><CodeLine lineNumber="4122"><span class="doxyHighlightComment">/// Return if an instruction&#39;s type or any of its operands&#39; types are a vector</span></CodeLine>
<Link id="l04123" /><CodeLine lineNumber="4123"><span class="doxyHighlightComment">/// type.</span></CodeLine>
<Link id="l04124" /><CodeLine lineNumber="4124" lineLink="#a227525ceb37837d0076479b272b50aec"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a227525ceb37837d0076479b272b50aec">isVectorOp</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l04125" /><CodeLine lineNumber="4125"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType()-&gt;isVectorTy() || <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands(), &#91;&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) &#123;</span></CodeLine>
<Link id="l04126" /><CodeLine lineNumber="4126"><span class="doxyHighlight">           return U-&gt;getType()-&gt;isVectorTy();</span></CodeLine>
<Link id="l04127" /><CodeLine lineNumber="4127"><span class="doxyHighlight">         &#125;);</span></CodeLine>
<Link id="l04128" /><CodeLine lineNumber="4128"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04129" /><CodeLine lineNumber="4129"></CodeLine>
<Link id="l04130" /><CodeLine lineNumber="4130"><span class="doxyHighlightComment">/// If this basic block is simple enough, and if a predecessor branches to us</span></CodeLine>
<Link id="l04131" /><CodeLine lineNumber="4131"><span class="doxyHighlightComment">/// and one of our successors, fold the block into the predecessor and use</span></CodeLine>
<Link id="l04132" /><CodeLine lineNumber="4132"><span class="doxyHighlightComment">/// logical operations to pick the right destination.</span></CodeLine>
<Link id="l04133" /><CodeLine lineNumber="4133" lineLink="/docs/api/namespaces/llvm/#ad600d9077d7e1eadff1334ee14f7f25a"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ad600d9077d7e1eadff1334ee14f7f25a">llvm::foldBranchToCommonDest</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU,</span></CodeLine>
<Link id="l04134" /><CodeLine lineNumber="4134"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/memoryssaupdater">MemorySSAUpdater</a> &#42;MSSAU,</span></CodeLine>
<Link id="l04135" /><CodeLine lineNumber="4135"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l04136" /><CodeLine lineNumber="4136"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BonusInstThreshold) &#123;</span></CodeLine>
<Link id="l04137" /><CodeLine lineNumber="4137"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this block ends with an unconditional branch,</span></CodeLine>
<Link id="l04138" /><CodeLine lineNumber="4138"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// let speculativelyExecuteBB() deal with it.</span></CodeLine>
<Link id="l04139" /><CodeLine lineNumber="4139"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>())</span></CodeLine>
<Link id="l04140" /><CodeLine lineNumber="4140"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04141" /><CodeLine lineNumber="4141"></CodeLine>
<Link id="l04142" /><CodeLine lineNumber="4142"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l04143" /><CodeLine lineNumber="4143"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bb">TargetTransformInfo::TargetCostKind</a> <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a> =</span></CodeLine>
<Link id="l04144" /><CodeLine lineNumber="4144"><span class="doxyHighlight">    BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a548cfb9440f36ba67fc5566b8e967fc6">hasMinSize</a>() ? <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a></span></CodeLine>
<Link id="l04145" /><CodeLine lineNumber="4145"><span class="doxyHighlight">                                  : <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>;</span></CodeLine>
<Link id="l04146" /><CodeLine lineNumber="4146"></CodeLine>
<Link id="l04147" /><CodeLine lineNumber="4147"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</span></CodeLine>
<Link id="l04148" /><CodeLine lineNumber="4148"></CodeLine>
<Link id="l04149" /><CodeLine lineNumber="4149"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> ||</span></CodeLine>
<Link id="l04150" /><CodeLine lineNumber="4150"><span class="doxyHighlight">      (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>) &amp;&amp;</span></CodeLine>
<Link id="l04151" /><CodeLine lineNumber="4151"><span class="doxyHighlight">       !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) ||</span></CodeLine>
<Link id="l04152" /><CodeLine lineNumber="4152"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getParent() != BB || !<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;hasOneUse())</span></CodeLine>
<Link id="l04153" /><CodeLine lineNumber="4153"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04154" /><CodeLine lineNumber="4154"></CodeLine>
<Link id="l04155" /><CodeLine lineNumber="4155"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Finally, don&#39;t infinitely unroll conditional loops.</span></CodeLine>
<Link id="l04156" /><CodeLine lineNumber="4156"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB), BB))</span></CodeLine>
<Link id="l04157" /><CodeLine lineNumber="4157"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04158" /><CodeLine lineNumber="4158"></CodeLine>
<Link id="l04159" /><CodeLine lineNumber="4159"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// With which predecessors will we want to deal with?</span></CodeLine>
<Link id="l04160" /><CodeLine lineNumber="4160"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 8&gt;</a> Preds;</span></CodeLine>
<Link id="l04161" /><CodeLine lineNumber="4161"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBlock : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l04162" /><CodeLine lineNumber="4162"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PBI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PredBlock-&gt;getTerminator());</span></CodeLine>
<Link id="l04163" /><CodeLine lineNumber="4163"></CodeLine>
<Link id="l04164" /><CodeLine lineNumber="4164"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check that we have two conditional branches.  If there is a PHI node in</span></CodeLine>
<Link id="l04165" /><CodeLine lineNumber="4165"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the common successor, verify that the same value flows in from both</span></CodeLine>
<Link id="l04166" /><CodeLine lineNumber="4166"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// blocks.</span></CodeLine>
<Link id="l04167" /><CodeLine lineNumber="4167"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PBI || PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>() || !<a href="#a6b537c9f5fe8ee7d5950f9984fa5010a">safeToMergeTerminators</a>(BI, PBI))</span></CodeLine>
<Link id="l04168" /><CodeLine lineNumber="4168"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04169" /><CodeLine lineNumber="4169"></CodeLine>
<Link id="l04170" /><CodeLine lineNumber="4170"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Determine if the two branches share a common destination.</span></CodeLine>
<Link id="l04171" /><CodeLine lineNumber="4171"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CommonSucc;</span></CodeLine>
<Link id="l04172" /><CodeLine lineNumber="4172"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> Opc;</span></CodeLine>
<Link id="l04173" /><CodeLine lineNumber="4173"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InvertPredCond;</span></CodeLine>
<Link id="l04174" /><CodeLine lineNumber="4174"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Recipe = <a href="#a1c4994ac805321b7fa03617dff656ad8">shouldFoldCondBranchesToCommonDestination</a>(BI, PBI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l04175" /><CodeLine lineNumber="4175"><span class="doxyHighlight">      std::tie(CommonSucc, Opc, InvertPredCond) = &#42;Recipe;</span></CodeLine>
<Link id="l04176" /><CodeLine lineNumber="4176"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04177" /><CodeLine lineNumber="4177"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04178" /><CodeLine lineNumber="4178"></CodeLine>
<Link id="l04179" /><CodeLine lineNumber="4179"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check the cost of inserting the necessary logic before performing the</span></CodeLine>
<Link id="l04180" /><CodeLine lineNumber="4180"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// transformation.</span></CodeLine>
<Link id="l04181" /><CodeLine lineNumber="4181"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l04182" /><CodeLine lineNumber="4182"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l04183" /><CodeLine lineNumber="4183"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getArithmeticInstrCost(Opc, Ty, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>);</span></CodeLine>
<Link id="l04184" /><CodeLine lineNumber="4184"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InvertPredCond &amp;&amp; (!PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() ||</span></CodeLine>
<Link id="l04185" /><CodeLine lineNumber="4185"><span class="doxyHighlight">                             !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CmpInst&gt;</a>(PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>())))</span></CodeLine>
<Link id="l04186" /><CodeLine lineNumber="4186"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getArithmeticInstrCost(Instruction::Xor, Ty, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>);</span></CodeLine>
<Link id="l04187" /><CodeLine lineNumber="4187"></CodeLine>
<Link id="l04188" /><CodeLine lineNumber="4188"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> &gt; <a href="#a79acde6fd121317486a8a70fbc1e0c14">BranchFoldThreshold</a>)</span></CodeLine>
<Link id="l04189" /><CodeLine lineNumber="4189"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04190" /><CodeLine lineNumber="4190"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04191" /><CodeLine lineNumber="4191"></CodeLine>
<Link id="l04192" /><CodeLine lineNumber="4192"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ok, we do want to deal with this predecessor. Record it.</span></CodeLine>
<Link id="l04193" /><CodeLine lineNumber="4193"><span class="doxyHighlight">    Preds.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(PredBlock);</span></CodeLine>
<Link id="l04194" /><CodeLine lineNumber="4194"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04195" /><CodeLine lineNumber="4195"></CodeLine>
<Link id="l04196" /><CodeLine lineNumber="4196"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there aren&#39;t any predecessors into which we can fold,</span></CodeLine>
<Link id="l04197" /><CodeLine lineNumber="4197"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// don&#39;t bother checking the cost.</span></CodeLine>
<Link id="l04198" /><CodeLine lineNumber="4198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Preds.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l04199" /><CodeLine lineNumber="4199"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04200" /><CodeLine lineNumber="4200"></CodeLine>
<Link id="l04201" /><CodeLine lineNumber="4201"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only allow this transformation if computing the condition doesn&#39;t involve</span></CodeLine>
<Link id="l04202" /><CodeLine lineNumber="4202"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// too many instructions and these involved instructions can be executed</span></CodeLine>
<Link id="l04203" /><CodeLine lineNumber="4203"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unconditionally. We denote all involved instructions except the condition</span></CodeLine>
<Link id="l04204" /><CodeLine lineNumber="4204"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as &quot;bonus instructions&quot;, and only allow this transformation when the</span></CodeLine>
<Link id="l04205" /><CodeLine lineNumber="4205"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// number of the bonus instructions we&#39;ll need to create when cloning into</span></CodeLine>
<Link id="l04206" /><CodeLine lineNumber="4206"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// each predecessor does not exceed a certain threshold.</span></CodeLine>
<Link id="l04207" /><CodeLine lineNumber="4207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumBonusInsts = 0;</span></CodeLine>
<Link id="l04208" /><CodeLine lineNumber="4208"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SawVectorOp = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04209" /><CodeLine lineNumber="4209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PredCount = Preds.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l04210" /><CodeLine lineNumber="4210"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l04211" /><CodeLine lineNumber="4211"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t check the branch condition comparison itself.</span></CodeLine>
<Link id="l04212" /><CodeLine lineNumber="4212"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)</span></CodeLine>
<Link id="l04213" /><CodeLine lineNumber="4213"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04214" /><CodeLine lineNumber="4214"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ignore dbg intrinsics, and the terminator.</span></CodeLine>
<Link id="l04215" /><CodeLine lineNumber="4215"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l04216" /><CodeLine lineNumber="4216"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04217" /><CodeLine lineNumber="4217"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// I must be safe to execute unconditionally.</span></CodeLine>
<Link id="l04218" /><CodeLine lineNumber="4218"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l04219" /><CodeLine lineNumber="4219"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04220" /><CodeLine lineNumber="4220"><span class="doxyHighlight">    SawVectorOp |= <a href="#a227525ceb37837d0076479b272b50aec">isVectorOp</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l04221" /><CodeLine lineNumber="4221"></CodeLine>
<Link id="l04222" /><CodeLine lineNumber="4222"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Account for the cost of duplicating this instruction into each</span></CodeLine>
<Link id="l04223" /><CodeLine lineNumber="4223"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessor. Ignore free instructions.</span></CodeLine>
<Link id="l04224" /><CodeLine lineNumber="4224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> || <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getInstructionCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>) !=</span></CodeLine>
<Link id="l04225" /><CodeLine lineNumber="4225"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272ca89f768b1267e3083b4eb05b4ab77e717">TargetTransformInfo::TCC&#95;Free</a>) &#123;</span></CodeLine>
<Link id="l04226" /><CodeLine lineNumber="4226"><span class="doxyHighlight">      NumBonusInsts += PredCount;</span></CodeLine>
<Link id="l04227" /><CodeLine lineNumber="4227"></CodeLine>
<Link id="l04228" /><CodeLine lineNumber="4228"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Early exits once we reach the limit.</span></CodeLine>
<Link id="l04229" /><CodeLine lineNumber="4229"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumBonusInsts &gt;</span></CodeLine>
<Link id="l04230" /><CodeLine lineNumber="4230"><span class="doxyHighlight">          BonusInstThreshold &#42; <a href="#aebaf393c898e387f182c798412f13622">BranchFoldToCommonDestVectorMultiplier</a>)</span></CodeLine>
<Link id="l04231" /><CodeLine lineNumber="4231"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04232" /><CodeLine lineNumber="4232"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04233" /><CodeLine lineNumber="4233"></CodeLine>
<Link id="l04234" /><CodeLine lineNumber="4234"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsBCSSAUse = &#91;BB, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) &#123;</span></CodeLine>
<Link id="l04235" /><CodeLine lineNumber="4235"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l04236" /><CodeLine lineNumber="4236"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(UI))</span></CodeLine>
<Link id="l04237" /><CodeLine lineNumber="4237"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PN-&gt;getIncomingBlock(U) == BB;</span></CodeLine>
<Link id="l04238" /><CodeLine lineNumber="4238"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> UI-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>() == BB &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.comesBefore(UI);</span></CodeLine>
<Link id="l04239" /><CodeLine lineNumber="4239"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l04240" /><CodeLine lineNumber="4240"></CodeLine>
<Link id="l04241" /><CodeLine lineNumber="4241"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Does this instruction require rewriting of uses?</span></CodeLine>
<Link id="l04242" /><CodeLine lineNumber="4242"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.uses(), IsBCSSAUse))</span></CodeLine>
<Link id="l04243" /><CodeLine lineNumber="4243"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04244" /><CodeLine lineNumber="4244"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04245" /><CodeLine lineNumber="4245"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumBonusInsts &gt;</span></CodeLine>
<Link id="l04246" /><CodeLine lineNumber="4246"><span class="doxyHighlight">      BonusInstThreshold &#42;</span></CodeLine>
<Link id="l04247" /><CodeLine lineNumber="4247"><span class="doxyHighlight">          (SawVectorOp ? <a href="#aebaf393c898e387f182c798412f13622">BranchFoldToCommonDestVectorMultiplier</a> : 1))</span></CodeLine>
<Link id="l04248" /><CodeLine lineNumber="4248"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04249" /><CodeLine lineNumber="4249"></CodeLine>
<Link id="l04250" /><CodeLine lineNumber="4250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ok, we have the budget. Perform the transformation.</span></CodeLine>
<Link id="l04251" /><CodeLine lineNumber="4251"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBlock : Preds) &#123;</span></CodeLine>
<Link id="l04252" /><CodeLine lineNumber="4252"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PBI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(PredBlock-&gt;getTerminator());</span></CodeLine>
<Link id="l04253" /><CodeLine lineNumber="4253"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a31a4e5663521fd6944605496cbc32bbb">performBranchToCommonDestFolding</a>(BI, PBI, DTU, MSSAU, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l04254" /><CodeLine lineNumber="4254"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04255" /><CodeLine lineNumber="4255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04256" /><CodeLine lineNumber="4256"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04257" /><CodeLine lineNumber="4257"></CodeLine>
<Link id="l04258" /><CodeLine lineNumber="4258"><span class="doxyHighlightComment">// If there is only one store in BB1 and BB2, return it, otherwise return</span></CodeLine>
<Link id="l04259" /><CodeLine lineNumber="4259"><span class="doxyHighlightComment">// nullptr.</span></CodeLine>
<Link id="l04260" /><CodeLine lineNumber="4260" lineLink="#a068826fbd1f18b8ecd1b8798d957eca9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="#a068826fbd1f18b8ecd1b8798d957eca9">findUniqueStoreInBlocks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB1, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB2) &#123;</span></CodeLine>
<Link id="l04261" /><CodeLine lineNumber="4261"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;S = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04262" /><CodeLine lineNumber="4262"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : &#123;BB1, BB2&#125;) &#123;</span></CodeLine>
<Link id="l04263" /><CodeLine lineNumber="4263"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB)</span></CodeLine>
<Link id="l04264" /><CodeLine lineNumber="4264"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04265" /><CodeLine lineNumber="4265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB)</span></CodeLine>
<Link id="l04266" /><CodeLine lineNumber="4266"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l04267" /><CodeLine lineNumber="4267"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S)</span></CodeLine>
<Link id="l04268" /><CodeLine lineNumber="4268"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Multiple stores seen.</span></CodeLine>
<Link id="l04269" /><CodeLine lineNumber="4269"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04270" /><CodeLine lineNumber="4270"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04271" /><CodeLine lineNumber="4271"><span class="doxyHighlight">          S = <a href="/docs/api/namespaces/llvm/si">SI</a>;</span></CodeLine>
<Link id="l04272" /><CodeLine lineNumber="4272"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04273" /><CodeLine lineNumber="4273"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04274" /><CodeLine lineNumber="4274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> S;</span></CodeLine>
<Link id="l04275" /><CodeLine lineNumber="4275"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04276" /><CodeLine lineNumber="4276"></CodeLine>
<Link id="l04277" /><CodeLine lineNumber="4277" lineLink="#a5bb62631ba6a4be0ae02f7365ee4a7d7"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a5bb62631ba6a4be0ae02f7365ee4a7d7">ensureValueAvailableInSuccessor</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l04278" /><CodeLine lineNumber="4278"><span class="doxyHighlight">                                              <a href="/docs/api/classes/llvm/value">Value</a> &#42;AlternativeV = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l04279" /><CodeLine lineNumber="4279"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHI is going to be a PHI node that allows the value V that is defined in</span></CodeLine>
<Link id="l04280" /><CodeLine lineNumber="4280"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB to be referenced in BB&#39;s only successor.</span></CodeLine>
<Link id="l04281" /><CodeLine lineNumber="4281"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l04282" /><CodeLine lineNumber="4282"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If AlternativeV is nullptr, the only value we care about in PHI is V. It</span></CodeLine>
<Link id="l04283" /><CodeLine lineNumber="4283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// doesn&#39;t matter to us what the other operand is (it&#39;ll never get used). We</span></CodeLine>
<Link id="l04284" /><CodeLine lineNumber="4284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// could just create a new PHI with an undef incoming value, but that could</span></CodeLine>
<Link id="l04285" /><CodeLine lineNumber="4285"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// increase register pressure if EarlyCSE/InstCombine can&#39;t fold it with some</span></CodeLine>
<Link id="l04286" /><CodeLine lineNumber="4286"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// other PHI. So here we directly look for some PHI in BB&#39;s successor with V</span></CodeLine>
<Link id="l04287" /><CodeLine lineNumber="4287"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as an incoming operand. If we find one, we use it, else we create a new</span></CodeLine>
<Link id="l04288" /><CodeLine lineNumber="4288"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// one.</span></CodeLine>
<Link id="l04289" /><CodeLine lineNumber="4289"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l04290" /><CodeLine lineNumber="4290"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If AlternativeV is not nullptr, we care about both incoming values in PHI.</span></CodeLine>
<Link id="l04291" /><CodeLine lineNumber="4291"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHI must be exactly: phi &lt;ty&gt; &#91; %BB, %V &#93;, &#91; %OtherBB, %AlternativeV&#93;</span></CodeLine>
<Link id="l04292" /><CodeLine lineNumber="4292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// where OtherBB is the single other predecessor of BB&#39;s only successor.</span></CodeLine>
<Link id="l04293" /><CodeLine lineNumber="4293"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04294" /><CodeLine lineNumber="4294"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>();</span></CodeLine>
<Link id="l04295" /><CodeLine lineNumber="4295"></CodeLine>
<Link id="l04296" /><CodeLine lineNumber="4296"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l04297" /><CodeLine lineNumber="4297"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getIncomingValueForBlock(BB) == V) &#123;</span></CodeLine>
<Link id="l04298" /><CodeLine lineNumber="4298"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l04299" /><CodeLine lineNumber="4299"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AlternativeV)</span></CodeLine>
<Link id="l04300" /><CodeLine lineNumber="4300"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04301" /><CodeLine lineNumber="4301"></CodeLine>
<Link id="l04302" /><CodeLine lineNumber="4302"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a526630ff85b48f29ac5b4c519c6c2243">hasNPredecessors</a>(2));</span></CodeLine>
<Link id="l04303" /><CodeLine lineNumber="4303"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PredI = <a href="/docs/api/namespaces/llvm/#ac3e549d97549636a7f08779d5cd98540">pred&#95;begin</a>(Succ);</span></CodeLine>
<Link id="l04304" /><CodeLine lineNumber="4304"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OtherPredBB = &#42;PredI == BB ? &#42;++PredI : &#42;PredI;</span></CodeLine>
<Link id="l04305" /><CodeLine lineNumber="4305"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getIncomingValueForBlock(OtherPredBB) == AlternativeV)</span></CodeLine>
<Link id="l04306" /><CodeLine lineNumber="4306"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04307" /><CodeLine lineNumber="4307"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04308" /><CodeLine lineNumber="4308"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04309" /><CodeLine lineNumber="4309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)</span></CodeLine>
<Link id="l04310" /><CodeLine lineNumber="4310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</span></CodeLine>
<Link id="l04311" /><CodeLine lineNumber="4311"></CodeLine>
<Link id="l04312" /><CodeLine lineNumber="4312"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If V is not an instruction defined in BB, just return it.</span></CodeLine>
<Link id="l04313" /><CodeLine lineNumber="4313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AlternativeV &amp;&amp;</span></CodeLine>
<Link id="l04314" /><CodeLine lineNumber="4314"><span class="doxyHighlight">      (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(V) || <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() != BB))</span></CodeLine>
<Link id="l04315" /><CodeLine lineNumber="4315"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V;</span></CodeLine>
<Link id="l04316" /><CodeLine lineNumber="4316"></CodeLine>
<Link id="l04317" /><CodeLine lineNumber="4317"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(V-&gt;getType(), 2, </span><span class="doxyHighlightStringLiteral">&quot;simplifycfg.merge&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04318" /><CodeLine lineNumber="4318"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;insertBefore(Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l04319" /><CodeLine lineNumber="4319"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(V, BB);</span></CodeLine>
<Link id="l04320" /><CodeLine lineNumber="4320"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Succ))</span></CodeLine>
<Link id="l04321" /><CodeLine lineNumber="4321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBB != BB)</span></CodeLine>
<Link id="l04322" /><CodeLine lineNumber="4322"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(</span></CodeLine>
<Link id="l04323" /><CodeLine lineNumber="4323"><span class="doxyHighlight">          AlternativeV ? AlternativeV : <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(V-&gt;getType()), PredBB);</span></CodeLine>
<Link id="l04324" /><CodeLine lineNumber="4324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</span></CodeLine>
<Link id="l04325" /><CodeLine lineNumber="4325"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04326" /><CodeLine lineNumber="4326"></CodeLine>
<Link id="l04327" /><CodeLine lineNumber="4327" lineLink="#a1a5189be752e56bf8343fd72f45720ee"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a1a5189be752e56bf8343fd72f45720ee">mergeConditionalStoreToAddress</a>(</span></CodeLine>
<Link id="l04328" /><CodeLine lineNumber="4328"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PTB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PFB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;QTB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;QFB,</span></CodeLine>
<Link id="l04329" /><CodeLine lineNumber="4329"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PostBB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvemitnonsemanticdi-cpp/#ac168ee0c965117536e841dd35a716d36a43f2a8aab5cba317e9ad9fe8589df00a">Address</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InvertPCond, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InvertQCond,</span></CodeLine>
<Link id="l04330" /><CodeLine lineNumber="4330"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l04331" /><CodeLine lineNumber="4331"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For every pointer, there must be exactly two stores, one coming from</span></CodeLine>
<Link id="l04332" /><CodeLine lineNumber="4332"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PTB or PFB, and the other from QTB or QFB. We don&#39;t support more than one</span></CodeLine>
<Link id="l04333" /><CodeLine lineNumber="4333"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// store (to any address) in PTB,PFB or QTB,QFB.</span></CodeLine>
<Link id="l04334" /><CodeLine lineNumber="4334"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: We could relax this restriction with a bit more work and performance</span></CodeLine>
<Link id="l04335" /><CodeLine lineNumber="4335"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// testing.</span></CodeLine>
<Link id="l04336" /><CodeLine lineNumber="4336"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;PStore = <a href="#a068826fbd1f18b8ecd1b8798d957eca9">findUniqueStoreInBlocks</a>(PTB, PFB);</span></CodeLine>
<Link id="l04337" /><CodeLine lineNumber="4337"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;QStore = <a href="#a068826fbd1f18b8ecd1b8798d957eca9">findUniqueStoreInBlocks</a>(QTB, QFB);</span></CodeLine>
<Link id="l04338" /><CodeLine lineNumber="4338"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PStore || !QStore)</span></CodeLine>
<Link id="l04339" /><CodeLine lineNumber="4339"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04340" /><CodeLine lineNumber="4340"></CodeLine>
<Link id="l04341" /><CodeLine lineNumber="4341"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now check the stores are compatible.</span></CodeLine>
<Link id="l04342" /><CodeLine lineNumber="4342"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!QStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a8e2e13588202d0d79ceff0f1d8d35d86">isUnordered</a>() || !PStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a8e2e13588202d0d79ceff0f1d8d35d86">isUnordered</a>() ||</span></CodeLine>
<Link id="l04343" /><CodeLine lineNumber="4343"><span class="doxyHighlight">      PStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a89caf38fb409b0217360689351f3b457">getValueOperand</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() !=</span></CodeLine>
<Link id="l04344" /><CodeLine lineNumber="4344"><span class="doxyHighlight">          QStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a89caf38fb409b0217360689351f3b457">getValueOperand</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</span></CodeLine>
<Link id="l04345" /><CodeLine lineNumber="4345"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04346" /><CodeLine lineNumber="4346"></CodeLine>
<Link id="l04347" /><CodeLine lineNumber="4347"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that sinking the store won&#39;t cause program behavior changes. Sinking</span></CodeLine>
<Link id="l04348" /><CodeLine lineNumber="4348"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the store out of the Q blocks won&#39;t change any behavior as we&#39;re sinking</span></CodeLine>
<Link id="l04349" /><CodeLine lineNumber="4349"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from a block to its unconditional successor. But we&#39;re moving a store from</span></CodeLine>
<Link id="l04350" /><CodeLine lineNumber="4350"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the P blocks down through the middle block (QBI) and past both QFB and QTB.</span></CodeLine>
<Link id="l04351" /><CodeLine lineNumber="4351"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// So we need to check that there are no aliasing loads or stores in</span></CodeLine>
<Link id="l04352" /><CodeLine lineNumber="4352"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// QBI, QTB and QFB. We also need to check there are no conflicting memory</span></CodeLine>
<Link id="l04353" /><CodeLine lineNumber="4353"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// operations between PStore and the end of its parent block.</span></CodeLine>
<Link id="l04354" /><CodeLine lineNumber="4354"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l04355" /><CodeLine lineNumber="4355"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The ideal way to do this is to query AliasAnalysis, but we don&#39;t</span></CodeLine>
<Link id="l04356" /><CodeLine lineNumber="4356"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// preserve AA currently so that is dangerous. Be super safe and just</span></CodeLine>
<Link id="l04357" /><CodeLine lineNumber="4357"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// check there are no other memory operations at all.</span></CodeLine>
<Link id="l04358" /><CodeLine lineNumber="4358"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;QFB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>())</span></CodeLine>
<Link id="l04359" /><CodeLine lineNumber="4359"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayReadOrWriteMemory())</span></CodeLine>
<Link id="l04360" /><CodeLine lineNumber="4360"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04361" /><CodeLine lineNumber="4361"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;QFB)</span></CodeLine>
<Link id="l04362" /><CodeLine lineNumber="4362"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != QStore &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayReadOrWriteMemory())</span></CodeLine>
<Link id="l04363" /><CodeLine lineNumber="4363"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04364" /><CodeLine lineNumber="4364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (QTB)</span></CodeLine>
<Link id="l04365" /><CodeLine lineNumber="4365"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;QTB)</span></CodeLine>
<Link id="l04366" /><CodeLine lineNumber="4366"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != QStore &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayReadOrWriteMemory())</span></CodeLine>
<Link id="l04367" /><CodeLine lineNumber="4367"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04368" /><CodeLine lineNumber="4368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(PStore), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = PStore-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;end();</span></CodeLine>
<Link id="l04369" /><CodeLine lineNumber="4369"><span class="doxyHighlight">       <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l04370" /><CodeLine lineNumber="4370"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != PStore &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadOrWriteMemory())</span></CodeLine>
<Link id="l04371" /><CodeLine lineNumber="4371"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04372" /><CodeLine lineNumber="4372"></CodeLine>
<Link id="l04373" /><CodeLine lineNumber="4373"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we&#39;re not in aggressive mode, we only optimize if we have some</span></CodeLine>
<Link id="l04374" /><CodeLine lineNumber="4374"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// confidence that by optimizing we&#39;ll allow P and/or Q to be if-converted.</span></CodeLine>
<Link id="l04375" /><CodeLine lineNumber="4375"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsWorthwhile = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;StoreInst &#42;&gt;</a> FreeStores) &#123;</span></CodeLine>
<Link id="l04376" /><CodeLine lineNumber="4376"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB)</span></CodeLine>
<Link id="l04377" /><CodeLine lineNumber="4377"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04378" /><CodeLine lineNumber="4378"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Heuristic: if the block can be if-converted/phi-folded and the</span></CodeLine>
<Link id="l04379" /><CodeLine lineNumber="4379"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions inside are all cheap (arithmetic/GEPs), it&#39;s worthwhile to</span></CodeLine>
<Link id="l04380" /><CodeLine lineNumber="4380"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// thread this store.</span></CodeLine>
<Link id="l04381" /><CodeLine lineNumber="4381"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = 0;</span></CodeLine>
<Link id="l04382" /><CodeLine lineNumber="4382"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> Budget =</span></CodeLine>
<Link id="l04383" /><CodeLine lineNumber="4383"><span class="doxyHighlight">        <a href="#af03cfeeab17b16ab9c47da7686f9f632">PHINodeFoldingThreshold</a> &#42; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>;</span></CodeLine>
<Link id="l04384" /><CodeLine lineNumber="4384"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a2069641f358ef416658a2f321ca19d74">instructionsWithoutDebug</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l04385" /><CodeLine lineNumber="4385"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Consider terminator instruction to be free.</span></CodeLine>
<Link id="l04386" /><CodeLine lineNumber="4386"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isTerminator())</span></CodeLine>
<Link id="l04387" /><CodeLine lineNumber="4387"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04388" /><CodeLine lineNumber="4388"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this is one the stores that we want to speculate out of this BB,</span></CodeLine>
<Link id="l04389" /><CodeLine lineNumber="4389"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// then don&#39;t count it&#39;s cost, consider it to be free.</span></CodeLine>
<Link id="l04390" /><CodeLine lineNumber="4390"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;S = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l04391" /><CodeLine lineNumber="4391"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a086e9fbdb06276db7753101a08a63adf">llvm::find</a>(FreeStores, S))</span></CodeLine>
<Link id="l04392" /><CodeLine lineNumber="4392"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04393" /><CodeLine lineNumber="4393"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Else, we have a white-list of instructions that we are ak speculating.</span></CodeLine>
<Link id="l04394" /><CodeLine lineNumber="4394"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l04395" /><CodeLine lineNumber="4395"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Not in white-list - not worthwhile folding.</span></CodeLine>
<Link id="l04396" /><CodeLine lineNumber="4396"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// And finally, if this is a non-free instruction that we are okay</span></CodeLine>
<Link id="l04397" /><CodeLine lineNumber="4397"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// speculating, ensure that we consider the speculation budget.</span></CodeLine>
<Link id="l04398" /><CodeLine lineNumber="4398"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> +=</span></CodeLine>
<Link id="l04399" /><CodeLine lineNumber="4399"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getInstructionCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>);</span></CodeLine>
<Link id="l04400" /><CodeLine lineNumber="4400"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> &gt; Budget)</span></CodeLine>
<Link id="l04401" /><CodeLine lineNumber="4401"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Eagerly refuse to fold as soon as we&#39;re out of budget.</span></CodeLine>
<Link id="l04402" /><CodeLine lineNumber="4402"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04403" /><CodeLine lineNumber="4403"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> &lt;= Budget &amp;&amp;</span></CodeLine>
<Link id="l04404" /><CodeLine lineNumber="4404"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;When we run out of budget we will eagerly return from within the &quot;</span></CodeLine>
<Link id="l04405" /><CodeLine lineNumber="4405"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;per-instruction loop.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04406" /><CodeLine lineNumber="4406"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04407" /><CodeLine lineNumber="4407"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l04408" /><CodeLine lineNumber="4408"></CodeLine>
<Link id="l04409" /><CodeLine lineNumber="4409"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::array&lt;StoreInst &#42;, 2&gt; FreeStores = &#123;PStore, QStore&#125;;</span></CodeLine>
<Link id="l04410" /><CodeLine lineNumber="4410"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a3caffa5cefe8399ed3efb62e834b1528">MergeCondStoresAggressively</a> &amp;&amp;</span></CodeLine>
<Link id="l04411" /><CodeLine lineNumber="4411"><span class="doxyHighlight">      (!IsWorthwhile(PTB, FreeStores) || !IsWorthwhile(PFB, FreeStores) ||</span></CodeLine>
<Link id="l04412" /><CodeLine lineNumber="4412"><span class="doxyHighlight">       !IsWorthwhile(QTB, FreeStores) || !IsWorthwhile(QFB, FreeStores)))</span></CodeLine>
<Link id="l04413" /><CodeLine lineNumber="4413"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04414" /><CodeLine lineNumber="4414"></CodeLine>
<Link id="l04415" /><CodeLine lineNumber="4415"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If PostBB has more than two predecessors, we need to split it so we can</span></CodeLine>
<Link id="l04416" /><CodeLine lineNumber="4416"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sink the store.</span></CodeLine>
<Link id="l04417" /><CodeLine lineNumber="4417"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::next(<a href="/docs/api/namespaces/llvm/#ac3e549d97549636a7f08779d5cd98540">pred&#95;begin</a>(PostBB), 2) != <a href="/docs/api/namespaces/llvm/#a2103c335fa6ab933312c3871c82b0106">pred&#95;end</a>(PostBB)) &#123;</span></CodeLine>
<Link id="l04418" /><CodeLine lineNumber="4418"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We know that QFB&#39;s only successor is PostBB. And QFB has a single</span></CodeLine>
<Link id="l04419" /><CodeLine lineNumber="4419"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessor. If QTB exists, then its only successor is also PostBB.</span></CodeLine>
<Link id="l04420" /><CodeLine lineNumber="4420"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If QTB does not exist, then QFB&#39;s only predecessor has a conditional</span></CodeLine>
<Link id="l04421" /><CodeLine lineNumber="4421"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// branch to QFB and PostBB.</span></CodeLine>
<Link id="l04422" /><CodeLine lineNumber="4422"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TruePred = QTB ? QTB : QFB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l04423" /><CodeLine lineNumber="4423"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB =</span></CodeLine>
<Link id="l04424" /><CodeLine lineNumber="4424"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a9d391b6acc6d90c9b8a8442324b1aa6f">SplitBlockPredecessors</a>(PostBB, &#123;QFB, TruePred&#125;, </span><span class="doxyHighlightStringLiteral">&quot;condstore.split&quot;</span><span class="doxyHighlight">, DTU);</span></CodeLine>
<Link id="l04425" /><CodeLine lineNumber="4425"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewBB)</span></CodeLine>
<Link id="l04426" /><CodeLine lineNumber="4426"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04427" /><CodeLine lineNumber="4427"><span class="doxyHighlight">    PostBB = NewBB;</span></CodeLine>
<Link id="l04428" /><CodeLine lineNumber="4428"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04429" /><CodeLine lineNumber="4429"></CodeLine>
<Link id="l04430" /><CodeLine lineNumber="4430"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OK, we&#39;re going to sink the stores to PostBB. The store has to be</span></CodeLine>
<Link id="l04431" /><CodeLine lineNumber="4431"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// conditional though, so first create the predicate.</span></CodeLine>
<Link id="l04432" /><CodeLine lineNumber="4432"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;PCond = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(PFB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())</span></CodeLine>
<Link id="l04433" /><CodeLine lineNumber="4433"><span class="doxyHighlight">                     -&gt;getCondition();</span></CodeLine>
<Link id="l04434" /><CodeLine lineNumber="4434"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;QCond = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(QFB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())</span></CodeLine>
<Link id="l04435" /><CodeLine lineNumber="4435"><span class="doxyHighlight">                     -&gt;getCondition();</span></CodeLine>
<Link id="l04436" /><CodeLine lineNumber="4436"></CodeLine>
<Link id="l04437" /><CodeLine lineNumber="4437"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;PPHI = <a href="#a5bb62631ba6a4be0ae02f7365ee4a7d7">ensureValueAvailableInSuccessor</a>(PStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a89caf38fb409b0217360689351f3b457">getValueOperand</a>(),</span></CodeLine>
<Link id="l04438" /><CodeLine lineNumber="4438"><span class="doxyHighlight">                                                PStore-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l04439" /><CodeLine lineNumber="4439"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;QPHI = <a href="#a5bb62631ba6a4be0ae02f7365ee4a7d7">ensureValueAvailableInSuccessor</a>(QStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a89caf38fb409b0217360689351f3b457">getValueOperand</a>(),</span></CodeLine>
<Link id="l04440" /><CodeLine lineNumber="4440"><span class="doxyHighlight">                                                QStore-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), PPHI);</span></CodeLine>
<Link id="l04441" /><CodeLine lineNumber="4441"></CodeLine>
<Link id="l04442" /><CodeLine lineNumber="4442"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> PostBBFirst = PostBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>();</span></CodeLine>
<Link id="l04443" /><CodeLine lineNumber="4443"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> QB(PostBB, PostBBFirst);</span></CodeLine>
<Link id="l04444" /><CodeLine lineNumber="4444"><span class="doxyHighlight">  QB.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(PostBBFirst-&gt;getStableDebugLoc());</span></CodeLine>
<Link id="l04445" /><CodeLine lineNumber="4445"></CodeLine>
<Link id="l04446" /><CodeLine lineNumber="4446"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;PPred = PStore-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == PTB ? PCond : QB.<a href="/docs/api/classes/llvm/irbuilderbase/#a89f675aadae7232445c74ee4167ff591">CreateNot</a>(PCond);</span></CodeLine>
<Link id="l04447" /><CodeLine lineNumber="4447"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;QPred = QStore-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == QTB ? QCond : QB.<a href="/docs/api/classes/llvm/irbuilderbase/#a89f675aadae7232445c74ee4167ff591">CreateNot</a>(QCond);</span></CodeLine>
<Link id="l04448" /><CodeLine lineNumber="4448"></CodeLine>
<Link id="l04449" /><CodeLine lineNumber="4449"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InvertPCond)</span></CodeLine>
<Link id="l04450" /><CodeLine lineNumber="4450"><span class="doxyHighlight">    PPred = QB.<a href="/docs/api/classes/llvm/irbuilderbase/#a89f675aadae7232445c74ee4167ff591">CreateNot</a>(PPred);</span></CodeLine>
<Link id="l04451" /><CodeLine lineNumber="4451"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InvertQCond)</span></CodeLine>
<Link id="l04452" /><CodeLine lineNumber="4452"><span class="doxyHighlight">    QPred = QB.<a href="/docs/api/classes/llvm/irbuilderbase/#a89f675aadae7232445c74ee4167ff591">CreateNot</a>(QPred);</span></CodeLine>
<Link id="l04453" /><CodeLine lineNumber="4453"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CombinedPred = QB.<a href="/docs/api/classes/llvm/irbuilderbase/#ab61be8e3cf17e9848aeeeabacfa1b09a">CreateOr</a>(PPred, QPred);</span></CodeLine>
<Link id="l04454" /><CodeLine lineNumber="4454"></CodeLine>
<Link id="l04455" /><CodeLine lineNumber="4455"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = QB.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e5c1b91bf5e2860398e3fa35c96b5af">GetInsertPoint</a>();</span></CodeLine>
<Link id="l04456" /><CodeLine lineNumber="4456"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = <a href="/docs/api/namespaces/llvm/#ad957413955739c91204c96e33e0cc933">SplitBlockAndInsertIfThen</a>(CombinedPred, InsertPt,</span></CodeLine>
<Link id="l04457" /><CodeLine lineNumber="4457"><span class="doxyHighlight">                                      </span><span class="doxyHighlightComment">/&#42;Unreachable=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04458" /><CodeLine lineNumber="4458"><span class="doxyHighlight">                                      </span><span class="doxyHighlightComment">/&#42;BranchWeights=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DTU);</span></CodeLine>
<Link id="l04459" /><CodeLine lineNumber="4459"></CodeLine>
<Link id="l04460" /><CodeLine lineNumber="4460"><span class="doxyHighlight">  QB.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</span></CodeLine>
<Link id="l04461" /><CodeLine lineNumber="4461"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(QB.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(QPHI, <a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvemitnonsemanticdi-cpp/#ac168ee0c965117536e841dd35a716d36a43f2a8aab5cba317e9ad9fe8589df00a">Address</a>));</span></CodeLine>
<Link id="l04462" /><CodeLine lineNumber="4462"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;setAAMetadata(PStore-&gt;<a href="/docs/api/classes/llvm/instruction/#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>().<a href="/docs/api/structs/llvm/aamdnodes/#a6b173e97523275314f3f2b433a5f71a9">merge</a>(QStore-&gt;<a href="/docs/api/classes/llvm/instruction/#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>()));</span></CodeLine>
<Link id="l04463" /><CodeLine lineNumber="4463"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Choose the minimum alignment. If we could prove both stores execute, we</span></CodeLine>
<Link id="l04464" /><CodeLine lineNumber="4464"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// could use biggest one.  In this case, though, we only know that one of the</span></CodeLine>
<Link id="l04465" /><CodeLine lineNumber="4465"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stores executes.  And we don&#39;t know it&#39;s safe to take the alignment from a</span></CodeLine>
<Link id="l04466" /><CodeLine lineNumber="4466"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// store that doesn&#39;t execute.</span></CodeLine>
<Link id="l04467" /><CodeLine lineNumber="4467"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;setAlignment(std::min(PStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a3b47950858d6ed72efd1010a35b81caa">getAlign</a>(), QStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a3b47950858d6ed72efd1010a35b81caa">getAlign</a>()));</span></CodeLine>
<Link id="l04468" /><CodeLine lineNumber="4468"></CodeLine>
<Link id="l04469" /><CodeLine lineNumber="4469"><span class="doxyHighlight">  QStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l04470" /><CodeLine lineNumber="4470"><span class="doxyHighlight">  PStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l04471" /><CodeLine lineNumber="4471"></CodeLine>
<Link id="l04472" /><CodeLine lineNumber="4472"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04473" /><CodeLine lineNumber="4473"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04474" /><CodeLine lineNumber="4474"></CodeLine>
<Link id="l04475" /><CodeLine lineNumber="4475" lineLink="#a6a58dfc629e1b208cdd7b2bd76203184"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a6a58dfc629e1b208cdd7b2bd76203184">mergeConditionalStores</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PBI, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;QBI,</span></CodeLine>
<Link id="l04476" /><CodeLine lineNumber="4476"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l04477" /><CodeLine lineNumber="4477"><span class="doxyHighlight">                                   </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l04478" /><CodeLine lineNumber="4478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The intention here is to find diamonds or triangles (see below) where each</span></CodeLine>
<Link id="l04479" /><CodeLine lineNumber="4479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// conditional block contains a store to the same address. Both of these</span></CodeLine>
<Link id="l04480" /><CodeLine lineNumber="4480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stores are conditional, so they can&#39;t be unconditionally sunk. But it may</span></CodeLine>
<Link id="l04481" /><CodeLine lineNumber="4481"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be profitable to speculatively sink the stores into one merged store at the</span></CodeLine>
<Link id="l04482" /><CodeLine lineNumber="4482"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// end, and predicate the merged store on the union of the two conditions of</span></CodeLine>
<Link id="l04483" /><CodeLine lineNumber="4483"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PBI and QBI.</span></CodeLine>
<Link id="l04484" /><CodeLine lineNumber="4484"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l04485" /><CodeLine lineNumber="4485"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This can reduce the number of stores executed if both of the conditions are</span></CodeLine>
<Link id="l04486" /><CodeLine lineNumber="4486"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// true, and can allow the blocks to become small enough to be if-converted.</span></CodeLine>
<Link id="l04487" /><CodeLine lineNumber="4487"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This optimization will also chain, so that ladders of test-and-set</span></CodeLine>
<Link id="l04488" /><CodeLine lineNumber="4488"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sequences can be if-converted away.</span></CodeLine>
<Link id="l04489" /><CodeLine lineNumber="4489"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l04490" /><CodeLine lineNumber="4490"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We only deal with simple diamonds or triangles:</span></CodeLine>
<Link id="l04491" /><CodeLine lineNumber="4491"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l04492" /><CodeLine lineNumber="4492"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     PBI       or      PBI        or a combination of the two</span></CodeLine>
<Link id="l04493" /><CodeLine lineNumber="4493"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    /   \\               | \\</span></CodeLine>
<Link id="l04494" /><CodeLine lineNumber="4494"><span class="doxyHighlightComment">  //   PTB  PFB             |  PFB</span></CodeLine>
<Link id="l04495" /><CodeLine lineNumber="4495"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    \\   /               | /</span></CodeLine>
<Link id="l04496" /><CodeLine lineNumber="4496"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     QBI                QBI</span></CodeLine>
<Link id="l04497" /><CodeLine lineNumber="4497"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    /  \\                | \\</span></CodeLine>
<Link id="l04498" /><CodeLine lineNumber="4498"><span class="doxyHighlightComment">  //   QTB  QFB             |  QFB</span></CodeLine>
<Link id="l04499" /><CodeLine lineNumber="4499"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    \\  /                | /</span></CodeLine>
<Link id="l04500" /><CodeLine lineNumber="4500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    PostBB            PostBB</span></CodeLine>
<Link id="l04501" /><CodeLine lineNumber="4501"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l04502" /><CodeLine lineNumber="4502"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We model triangles as a type of diamond with a nullptr &quot;true&quot; block.</span></CodeLine>
<Link id="l04503" /><CodeLine lineNumber="4503"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Triangles are canonicalized so that the fallthrough edge is represented by</span></CodeLine>
<Link id="l04504" /><CodeLine lineNumber="4504"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a true condition, as in the diagram above.</span></CodeLine>
<Link id="l04505" /><CodeLine lineNumber="4505"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PTB = PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l04506" /><CodeLine lineNumber="4506"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PFB = PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l04507" /><CodeLine lineNumber="4507"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;QTB = QBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l04508" /><CodeLine lineNumber="4508"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;QFB = QBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l04509" /><CodeLine lineNumber="4509"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PostBB = QFB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>();</span></CodeLine>
<Link id="l04510" /><CodeLine lineNumber="4510"></CodeLine>
<Link id="l04511" /><CodeLine lineNumber="4511"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure we have a good guess for PostBB. If QTB&#39;s only successor is</span></CodeLine>
<Link id="l04512" /><CodeLine lineNumber="4512"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// QFB, then QFB is a better PostBB.</span></CodeLine>
<Link id="l04513" /><CodeLine lineNumber="4513"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (QTB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>() == QFB)</span></CodeLine>
<Link id="l04514" /><CodeLine lineNumber="4514"><span class="doxyHighlight">    PostBB = QFB;</span></CodeLine>
<Link id="l04515" /><CodeLine lineNumber="4515"></CodeLine>
<Link id="l04516" /><CodeLine lineNumber="4516"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we couldn&#39;t find a good PostBB, stop.</span></CodeLine>
<Link id="l04517" /><CodeLine lineNumber="4517"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PostBB)</span></CodeLine>
<Link id="l04518" /><CodeLine lineNumber="4518"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04519" /><CodeLine lineNumber="4519"></CodeLine>
<Link id="l04520" /><CodeLine lineNumber="4520"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InvertPCond = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, InvertQCond = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04521" /><CodeLine lineNumber="4521"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Canonicalize fallthroughs to the true branches.</span></CodeLine>
<Link id="l04522" /><CodeLine lineNumber="4522"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PFB == QBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) &#123;</span></CodeLine>
<Link id="l04523" /><CodeLine lineNumber="4523"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(PFB, PTB);</span></CodeLine>
<Link id="l04524" /><CodeLine lineNumber="4524"><span class="doxyHighlight">    InvertPCond = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04525" /><CodeLine lineNumber="4525"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04526" /><CodeLine lineNumber="4526"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (QFB == PostBB) &#123;</span></CodeLine>
<Link id="l04527" /><CodeLine lineNumber="4527"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(QFB, QTB);</span></CodeLine>
<Link id="l04528" /><CodeLine lineNumber="4528"><span class="doxyHighlight">    InvertQCond = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04529" /><CodeLine lineNumber="4529"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04530" /><CodeLine lineNumber="4530"></CodeLine>
<Link id="l04531" /><CodeLine lineNumber="4531"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// From this point on we can assume PTB or QTB may be fallthroughs but PFB</span></CodeLine>
<Link id="l04532" /><CodeLine lineNumber="4532"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and QFB may not. Model fallthroughs as a nullptr block.</span></CodeLine>
<Link id="l04533" /><CodeLine lineNumber="4533"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PTB == QBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</span></CodeLine>
<Link id="l04534" /><CodeLine lineNumber="4534"><span class="doxyHighlight">    PTB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04535" /><CodeLine lineNumber="4535"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (QTB == PostBB)</span></CodeLine>
<Link id="l04536" /><CodeLine lineNumber="4536"><span class="doxyHighlight">    QTB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04537" /><CodeLine lineNumber="4537"></CodeLine>
<Link id="l04538" /><CodeLine lineNumber="4538"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Legality bailouts. We must have at least the non-fallthrough blocks and</span></CodeLine>
<Link id="l04539" /><CodeLine lineNumber="4539"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the post-dominating block, and the non-fallthroughs must only have one</span></CodeLine>
<Link id="l04540" /><CodeLine lineNumber="4540"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor.</span></CodeLine>
<Link id="l04541" /><CodeLine lineNumber="4541"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> HasOnePredAndOneSucc = &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;S) &#123;</span></CodeLine>
<Link id="l04542" /><CodeLine lineNumber="4542"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>() == <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> &amp;&amp; BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>() == S;</span></CodeLine>
<Link id="l04543" /><CodeLine lineNumber="4543"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l04544" /><CodeLine lineNumber="4544"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasOnePredAndOneSucc(PFB, PBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), QBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) ||</span></CodeLine>
<Link id="l04545" /><CodeLine lineNumber="4545"><span class="doxyHighlight">      !HasOnePredAndOneSucc(QFB, QBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), PostBB))</span></CodeLine>
<Link id="l04546" /><CodeLine lineNumber="4546"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04547" /><CodeLine lineNumber="4547"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((PTB &amp;&amp; !HasOnePredAndOneSucc(PTB, PBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), QBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())) ||</span></CodeLine>
<Link id="l04548" /><CodeLine lineNumber="4548"><span class="doxyHighlight">      (QTB &amp;&amp; !HasOnePredAndOneSucc(QTB, QBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), PostBB)))</span></CodeLine>
<Link id="l04549" /><CodeLine lineNumber="4549"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04550" /><CodeLine lineNumber="4550"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!QBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;hasNUses(2))</span></CodeLine>
<Link id="l04551" /><CodeLine lineNumber="4551"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04552" /><CodeLine lineNumber="4552"></CodeLine>
<Link id="l04553" /><CodeLine lineNumber="4553"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OK, this is a sequence of two diamonds or triangles.</span></CodeLine>
<Link id="l04554" /><CodeLine lineNumber="4554"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if there are stores in PTB or PFB that are repeated in QTB or QFB.</span></CodeLine>
<Link id="l04555" /><CodeLine lineNumber="4555"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 4&gt;</a> PStoreAddresses, QStoreAddresses;</span></CodeLine>
<Link id="l04556" /><CodeLine lineNumber="4556"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : &#123;PTB, PFB&#125;) &#123;</span></CodeLine>
<Link id="l04557" /><CodeLine lineNumber="4557"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB)</span></CodeLine>
<Link id="l04558" /><CodeLine lineNumber="4558"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04559" /><CodeLine lineNumber="4559"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB)</span></CodeLine>
<Link id="l04560" /><CodeLine lineNumber="4560"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l04561" /><CodeLine lineNumber="4561"><span class="doxyHighlight">        PStoreAddresses.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l04562" /><CodeLine lineNumber="4562"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04563" /><CodeLine lineNumber="4563"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : &#123;QTB, QFB&#125;) &#123;</span></CodeLine>
<Link id="l04564" /><CodeLine lineNumber="4564"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB)</span></CodeLine>
<Link id="l04565" /><CodeLine lineNumber="4565"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04566" /><CodeLine lineNumber="4566"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB)</span></CodeLine>
<Link id="l04567" /><CodeLine lineNumber="4567"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l04568" /><CodeLine lineNumber="4568"><span class="doxyHighlight">        QStoreAddresses.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l04569" /><CodeLine lineNumber="4569"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04570" /><CodeLine lineNumber="4570"></CodeLine>
<Link id="l04571" /><CodeLine lineNumber="4571"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a2162d123f222998300d308bdefdb38b9">set&#95;intersect</a>(PStoreAddresses, QStoreAddresses);</span></CodeLine>
<Link id="l04572" /><CodeLine lineNumber="4572"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// set&#95;intersect mutates PStoreAddresses in place. Rename it here to make it</span></CodeLine>
<Link id="l04573" /><CodeLine lineNumber="4573"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// clear what it contains.</span></CodeLine>
<Link id="l04574" /><CodeLine lineNumber="4574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;CommonAddresses = PStoreAddresses;</span></CodeLine>
<Link id="l04575" /><CodeLine lineNumber="4575"></CodeLine>
<Link id="l04576" /><CodeLine lineNumber="4576"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04577" /><CodeLine lineNumber="4577"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvemitnonsemanticdi-cpp/#ac168ee0c965117536e841dd35a716d36a43f2a8aab5cba317e9ad9fe8589df00a">Address</a> : CommonAddresses)</span></CodeLine>
<Link id="l04578" /><CodeLine lineNumber="4578"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |=</span></CodeLine>
<Link id="l04579" /><CodeLine lineNumber="4579"><span class="doxyHighlight">        <a href="#a1a5189be752e56bf8343fd72f45720ee">mergeConditionalStoreToAddress</a>(PTB, PFB, QTB, QFB, PostBB, <a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvemitnonsemanticdi-cpp/#ac168ee0c965117536e841dd35a716d36a43f2a8aab5cba317e9ad9fe8589df00a">Address</a>,</span></CodeLine>
<Link id="l04580" /><CodeLine lineNumber="4580"><span class="doxyHighlight">                                       InvertPCond, InvertQCond, DTU, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l04581" /><CodeLine lineNumber="4581"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l04582" /><CodeLine lineNumber="4582"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04583" /><CodeLine lineNumber="4583"></CodeLine>
<Link id="l04584" /><CodeLine lineNumber="4584"><span class="doxyHighlightComment">/// If the previous block ended with a widenable branch, determine if reusing</span></CodeLine>
<Link id="l04585" /><CodeLine lineNumber="4585"><span class="doxyHighlightComment">/// the target block is profitable and legal.  This will have the effect of</span></CodeLine>
<Link id="l04586" /><CodeLine lineNumber="4586"><span class="doxyHighlightComment">/// &quot;widening&quot; PBI, but doesn&#39;t require us to reason about hosting safety.</span></CodeLine>
<Link id="l04587" /><CodeLine lineNumber="4587" lineLink="#ad98f06eded5a01ee8704f7d7d9ca4c5b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ad98f06eded5a01ee8704f7d7d9ca4c5b">tryWidenCondBranchToCondBranch</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PBI, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI,</span></CodeLine>
<Link id="l04588" /><CodeLine lineNumber="4588"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU) &#123;</span></CodeLine>
<Link id="l04589" /><CodeLine lineNumber="4589"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: This can be generalized in two important ways:</span></CodeLine>
<Link id="l04590" /><CodeLine lineNumber="4590"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1) We can allow phi nodes in IfFalseBB and simply reuse all the input</span></CodeLine>
<Link id="l04591" /><CodeLine lineNumber="4591"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    values from the PBI edge.</span></CodeLine>
<Link id="l04592" /><CodeLine lineNumber="4592"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2) We can sink side effecting instructions into BI&#39;s fallthrough</span></CodeLine>
<Link id="l04593" /><CodeLine lineNumber="4593"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    successor provided they doesn&#39;t contribute to computation of</span></CodeLine>
<Link id="l04594" /><CodeLine lineNumber="4594"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    BI&#39;s condition.</span></CodeLine>
<Link id="l04595" /><CodeLine lineNumber="4595"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IfTrueBB = PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l04596" /><CodeLine lineNumber="4596"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IfFalseBB = PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l04597" /><CodeLine lineNumber="4597"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a9d7f27a51d40f21ec17a854a6a5d5d4f">isWidenableBranch</a>(PBI) || IfTrueBB != BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() ||</span></CodeLine>
<Link id="l04598" /><CodeLine lineNumber="4598"><span class="doxyHighlight">      !BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getSinglePredecessor())</span></CodeLine>
<Link id="l04599" /><CodeLine lineNumber="4599"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04600" /><CodeLine lineNumber="4600"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IfFalseBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>().empty())</span></CodeLine>
<Link id="l04601" /><CodeLine lineNumber="4601"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// TODO</span></CodeLine>
<Link id="l04602" /><CodeLine lineNumber="4602"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This helps avoid infinite loop with SimplifyCondBranchToCondBranch which</span></CodeLine>
<Link id="l04603" /><CodeLine lineNumber="4603"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// may undo the transform done here.</span></CodeLine>
<Link id="l04604" /><CodeLine lineNumber="4604"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: There might be a more fine-grained solution to this.</span></CodeLine>
<Link id="l04605" /><CodeLine lineNumber="4605"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a126a78caf2176eb39d879c899bdd749c">llvm::succ&#95;empty</a>(IfFalseBB))</span></CodeLine>
<Link id="l04606" /><CodeLine lineNumber="4606"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04607" /><CodeLine lineNumber="4607"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use lambda to lazily compute expensive condition after cheap ones.</span></CodeLine>
<Link id="l04608" /><CodeLine lineNumber="4608"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> NoSideEffects = &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB) &#123;</span></CodeLine>
<Link id="l04609" /><CodeLine lineNumber="4609"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">llvm::none&#95;of</a>(BB, &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l04610" /><CodeLine lineNumber="4610"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayWriteToMemory() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayHaveSideEffects();</span></CodeLine>
<Link id="l04611" /><CodeLine lineNumber="4611"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l04612" /><CodeLine lineNumber="4612"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l04613" /><CodeLine lineNumber="4613"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) != IfFalseBB &amp;&amp; </span><span class="doxyHighlightComment">// no inf looping</span></CodeLine>
<Link id="l04614" /><CodeLine lineNumber="4614"><span class="doxyHighlight">      BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a6796a84f02394ce6ebef227c866cd5eb">getTerminatingDeoptimizeCall</a>() &amp;&amp; </span><span class="doxyHighlightComment">// profitability</span></CodeLine>
<Link id="l04615" /><CodeLine lineNumber="4615"><span class="doxyHighlight">      NoSideEffects(&#42;BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())) &#123;</span></CodeLine>
<Link id="l04616" /><CodeLine lineNumber="4616"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldSuccessor = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l04617" /><CodeLine lineNumber="4617"><span class="doxyHighlight">    OldSuccessor-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l04618" /><CodeLine lineNumber="4618"><span class="doxyHighlight">    BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(1, IfFalseBB);</span></CodeLine>
<Link id="l04619" /><CodeLine lineNumber="4619"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l04620" /><CodeLine lineNumber="4620"><span class="doxyHighlight">      DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(</span></CodeLine>
<Link id="l04621" /><CodeLine lineNumber="4621"><span class="doxyHighlight">          &#123;&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), IfFalseBB&#125;,</span></CodeLine>
<Link id="l04622" /><CodeLine lineNumber="4622"><span class="doxyHighlight">           &#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), OldSuccessor&#125;&#125;);</span></CodeLine>
<Link id="l04623" /><CodeLine lineNumber="4623"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04624" /><CodeLine lineNumber="4624"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04625" /><CodeLine lineNumber="4625"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != IfFalseBB &amp;&amp; </span><span class="doxyHighlightComment">// no inf looping</span></CodeLine>
<Link id="l04626" /><CodeLine lineNumber="4626"><span class="doxyHighlight">      BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a6796a84f02394ce6ebef227c866cd5eb">getTerminatingDeoptimizeCall</a>() &amp;&amp; </span><span class="doxyHighlightComment">// profitability</span></CodeLine>
<Link id="l04627" /><CodeLine lineNumber="4627"><span class="doxyHighlight">      NoSideEffects(&#42;BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())) &#123;</span></CodeLine>
<Link id="l04628" /><CodeLine lineNumber="4628"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldSuccessor = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l04629" /><CodeLine lineNumber="4629"><span class="doxyHighlight">    OldSuccessor-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l04630" /><CodeLine lineNumber="4630"><span class="doxyHighlight">    BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(0, IfFalseBB);</span></CodeLine>
<Link id="l04631" /><CodeLine lineNumber="4631"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l04632" /><CodeLine lineNumber="4632"><span class="doxyHighlight">      DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(</span></CodeLine>
<Link id="l04633" /><CodeLine lineNumber="4633"><span class="doxyHighlight">          &#123;&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), IfFalseBB&#125;,</span></CodeLine>
<Link id="l04634" /><CodeLine lineNumber="4634"><span class="doxyHighlight">           &#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), OldSuccessor&#125;&#125;);</span></CodeLine>
<Link id="l04635" /><CodeLine lineNumber="4635"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04636" /><CodeLine lineNumber="4636"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04637" /><CodeLine lineNumber="4637"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04638" /><CodeLine lineNumber="4638"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04639" /><CodeLine lineNumber="4639"></CodeLine>
<Link id="l04640" /><CodeLine lineNumber="4640"><span class="doxyHighlightComment">/// If we have a conditional branch as a predecessor of another block,</span></CodeLine>
<Link id="l04641" /><CodeLine lineNumber="4641"><span class="doxyHighlightComment">/// this function tries to simplify it.  We know</span></CodeLine>
<Link id="l04642" /><CodeLine lineNumber="4642"><span class="doxyHighlightComment">/// that PBI and BI are both conditional branches, and BI is in one of the</span></CodeLine>
<Link id="l04643" /><CodeLine lineNumber="4643"><span class="doxyHighlightComment">/// successor blocks of PBI - PBI branches to BI.</span></CodeLine>
<Link id="l04644" /><CodeLine lineNumber="4644" lineLink="#a40f7c70fc970f25f1c32e8b2c28662ec"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a40f7c70fc970f25f1c32e8b2c28662ec">SimplifyCondBranchToCondBranch</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PBI, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI,</span></CodeLine>
<Link id="l04645" /><CodeLine lineNumber="4645"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU,</span></CodeLine>
<Link id="l04646" /><CodeLine lineNumber="4646"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l04647" /><CodeLine lineNumber="4647"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l04648" /><CodeLine lineNumber="4648"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>());</span></CodeLine>
<Link id="l04649" /><CodeLine lineNumber="4649"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l04650" /><CodeLine lineNumber="4650"></CodeLine>
<Link id="l04651" /><CodeLine lineNumber="4651"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this block ends with a branch instruction, and if there is a</span></CodeLine>
<Link id="l04652" /><CodeLine lineNumber="4652"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor that ends on a branch of the same condition, make</span></CodeLine>
<Link id="l04653" /><CodeLine lineNumber="4653"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this conditional branch redundant.</span></CodeLine>
<Link id="l04654" /><CodeLine lineNumber="4654"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>() == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>() &amp;&amp;</span></CodeLine>
<Link id="l04655" /><CodeLine lineNumber="4655"><span class="doxyHighlight">      PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)) &#123;</span></CodeLine>
<Link id="l04656" /><CodeLine lineNumber="4656"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Okay, the outcome of this conditional branch is statically</span></CodeLine>
<Link id="l04657" /><CodeLine lineNumber="4657"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// knowable.  If this block had a single pred, handle specially, otherwise</span></CodeLine>
<Link id="l04658" /><CodeLine lineNumber="4658"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// foldCondBranchOnValueKnownInPredecessor() will handle it.</span></CodeLine>
<Link id="l04659" /><CodeLine lineNumber="4659"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()) &#123;</span></CodeLine>
<Link id="l04660" /><CodeLine lineNumber="4660"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Turn this into a branch on constant.</span></CodeLine>
<Link id="l04661" /><CodeLine lineNumber="4661"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CondIsTrue = PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BB;</span></CodeLine>
<Link id="l04662" /><CodeLine lineNumber="4662"><span class="doxyHighlight">      BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a3505dab06f59c36142a234321cdc3411">setCondition</a>(</span></CodeLine>
<Link id="l04663" /><CodeLine lineNumber="4663"><span class="doxyHighlight">          ConstantInt::get(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>()), CondIsTrue));</span></CodeLine>
<Link id="l04664" /><CodeLine lineNumber="4664"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Nuke the branch on constant.</span></CodeLine>
<Link id="l04665" /><CodeLine lineNumber="4665"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04666" /><CodeLine lineNumber="4666"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04667" /><CodeLine lineNumber="4667"></CodeLine>
<Link id="l04668" /><CodeLine lineNumber="4668"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the previous block ended with a widenable branch, determine if reusing</span></CodeLine>
<Link id="l04669" /><CodeLine lineNumber="4669"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the target block is profitable and legal.  This will have the effect of</span></CodeLine>
<Link id="l04670" /><CodeLine lineNumber="4670"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &quot;widening&quot; PBI, but doesn&#39;t require us to reason about hosting safety.</span></CodeLine>
<Link id="l04671" /><CodeLine lineNumber="4671"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ad98f06eded5a01ee8704f7d7d9ca4c5b">tryWidenCondBranchToCondBranch</a>(PBI, BI, DTU))</span></CodeLine>
<Link id="l04672" /><CodeLine lineNumber="4672"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04673" /><CodeLine lineNumber="4673"></CodeLine>
<Link id="l04674" /><CodeLine lineNumber="4674"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If both branches are conditional and both contain stores to the same</span></CodeLine>
<Link id="l04675" /><CodeLine lineNumber="4675"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// address, remove the stores from the conditionals and create a conditional</span></CodeLine>
<Link id="l04676" /><CodeLine lineNumber="4676"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// merged store at the end.</span></CodeLine>
<Link id="l04677" /><CodeLine lineNumber="4677"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ae848c33bb9817bf71288c58eb68f0e11">MergeCondStores</a> &amp;&amp; <a href="#a6a58dfc629e1b208cdd7b2bd76203184">mergeConditionalStores</a>(PBI, BI, DTU, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l04678" /><CodeLine lineNumber="4678"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04679" /><CodeLine lineNumber="4679"></CodeLine>
<Link id="l04680" /><CodeLine lineNumber="4680"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is a conditional branch in an empty block, and if any</span></CodeLine>
<Link id="l04681" /><CodeLine lineNumber="4681"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessors are a conditional branch to one of our destinations,</span></CodeLine>
<Link id="l04682" /><CodeLine lineNumber="4682"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// fold the conditions into logical ops and one cond br.</span></CodeLine>
<Link id="l04683" /><CodeLine lineNumber="4683"></CodeLine>
<Link id="l04684" /><CodeLine lineNumber="4684"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ignore dbg intrinsics.</span></CodeLine>
<Link id="l04685" /><CodeLine lineNumber="4685"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;&#42;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a2069641f358ef416658a2f321ca19d74">instructionsWithoutDebug</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">).begin() != BI)</span></CodeLine>
<Link id="l04686" /><CodeLine lineNumber="4686"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04687" /><CodeLine lineNumber="4687"></CodeLine>
<Link id="l04688" /><CodeLine lineNumber="4688"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> PBIOp, BIOp;</span></CodeLine>
<Link id="l04689" /><CodeLine lineNumber="4689"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)) &#123;</span></CodeLine>
<Link id="l04690" /><CodeLine lineNumber="4690"><span class="doxyHighlight">    PBIOp = 0;</span></CodeLine>
<Link id="l04691" /><CodeLine lineNumber="4691"><span class="doxyHighlight">    BIOp = 0;</span></CodeLine>
<Link id="l04692" /><CodeLine lineNumber="4692"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)) &#123;</span></CodeLine>
<Link id="l04693" /><CodeLine lineNumber="4693"><span class="doxyHighlight">    PBIOp = 0;</span></CodeLine>
<Link id="l04694" /><CodeLine lineNumber="4694"><span class="doxyHighlight">    BIOp = 1;</span></CodeLine>
<Link id="l04695" /><CodeLine lineNumber="4695"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)) &#123;</span></CodeLine>
<Link id="l04696" /><CodeLine lineNumber="4696"><span class="doxyHighlight">    PBIOp = 1;</span></CodeLine>
<Link id="l04697" /><CodeLine lineNumber="4697"><span class="doxyHighlight">    BIOp = 0;</span></CodeLine>
<Link id="l04698" /><CodeLine lineNumber="4698"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)) &#123;</span></CodeLine>
<Link id="l04699" /><CodeLine lineNumber="4699"><span class="doxyHighlight">    PBIOp = 1;</span></CodeLine>
<Link id="l04700" /><CodeLine lineNumber="4700"><span class="doxyHighlight">    BIOp = 1;</span></CodeLine>
<Link id="l04701" /><CodeLine lineNumber="4701"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04702" /><CodeLine lineNumber="4702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04703" /><CodeLine lineNumber="4703"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04704" /><CodeLine lineNumber="4704"></CodeLine>
<Link id="l04705" /><CodeLine lineNumber="4705"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check to make sure that the other destination of this branch</span></CodeLine>
<Link id="l04706" /><CodeLine lineNumber="4706"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// isn&#39;t BB itself.  If so, this is an infinite loop that will</span></CodeLine>
<Link id="l04707" /><CodeLine lineNumber="4707"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// keep getting unwound.</span></CodeLine>
<Link id="l04708" /><CodeLine lineNumber="4708"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(PBIOp) == BB)</span></CodeLine>
<Link id="l04709" /><CodeLine lineNumber="4709"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04710" /><CodeLine lineNumber="4710"></CodeLine>
<Link id="l04711" /><CodeLine lineNumber="4711"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If predecessor&#39;s branch probability to BB is too low don&#39;t merge branches.</span></CodeLine>
<Link id="l04712" /><CodeLine lineNumber="4712"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint32&#95;t, 2&gt;</a> PredWeights;</span></CodeLine>
<Link id="l04713" /><CodeLine lineNumber="4713"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PBI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;unpredictable) &amp;&amp;</span></CodeLine>
<Link id="l04714" /><CodeLine lineNumber="4714"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;PBI, PredWeights) &amp;&amp;</span></CodeLine>
<Link id="l04715" /><CodeLine lineNumber="4715"><span class="doxyHighlight">      (</span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">uint64&#95;t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(PredWeights&#91;0&#93;) + PredWeights&#91;1&#93;) != 0) &#123;</span></CodeLine>
<Link id="l04716" /><CodeLine lineNumber="4716"></CodeLine>
<Link id="l04717" /><CodeLine lineNumber="4717"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> CommonDestProb = <a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(</span></CodeLine>
<Link id="l04718" /><CodeLine lineNumber="4718"><span class="doxyHighlight">        PredWeights&#91;PBIOp&#93;,</span></CodeLine>
<Link id="l04719" /><CodeLine lineNumber="4719"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">uint64&#95;t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(PredWeights&#91;0&#93;) + PredWeights&#91;1&#93;);</span></CodeLine>
<Link id="l04720" /><CodeLine lineNumber="4720"></CodeLine>
<Link id="l04721" /><CodeLine lineNumber="4721"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> Likely = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getPredictableBranchThreshold();</span></CodeLine>
<Link id="l04722" /><CodeLine lineNumber="4722"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CommonDestProb &gt;= Likely)</span></CodeLine>
<Link id="l04723" /><CodeLine lineNumber="4723"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04724" /><CodeLine lineNumber="4724"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04725" /><CodeLine lineNumber="4725"></CodeLine>
<Link id="l04726" /><CodeLine lineNumber="4726"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not perform this transformation if it would require</span></CodeLine>
<Link id="l04727" /><CodeLine lineNumber="4727"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// insertion of a large number of select instructions. For targets</span></CodeLine>
<Link id="l04728" /><CodeLine lineNumber="4728"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// without predication/cmovs, this is a big pessimization.</span></CodeLine>
<Link id="l04729" /><CodeLine lineNumber="4729"></CodeLine>
<Link id="l04730" /><CodeLine lineNumber="4730"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CommonDest = PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(PBIOp);</span></CodeLine>
<Link id="l04731" /><CodeLine lineNumber="4731"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;RemovedDest = PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(PBIOp ^ 1);</span></CodeLine>
<Link id="l04732" /><CodeLine lineNumber="4732"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumPhis = 0;</span></CodeLine>
<Link id="l04733" /><CodeLine lineNumber="4733"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = CommonDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l04734" /><CodeLine lineNumber="4734"><span class="doxyHighlight">       ++<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, ++NumPhis) &#123;</span></CodeLine>
<Link id="l04735" /><CodeLine lineNumber="4735"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumPhis &gt; 2) </span><span class="doxyHighlightComment">// Disable this xform.</span></CodeLine>
<Link id="l04736" /><CodeLine lineNumber="4736"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04737" /><CodeLine lineNumber="4737"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04738" /><CodeLine lineNumber="4738"></CodeLine>
<Link id="l04739" /><CodeLine lineNumber="4739"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Finally, if everything is ok, fold the branches to logical ops.</span></CodeLine>
<Link id="l04740" /><CodeLine lineNumber="4740"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OtherDest = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(BIOp ^ 1);</span></CodeLine>
<Link id="l04741" /><CodeLine lineNumber="4741"></CodeLine>
<Link id="l04742" /><CodeLine lineNumber="4742"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;FOLDING BRs:&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()</span></CodeLine>
<Link id="l04743" /><CodeLine lineNumber="4743"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;AND: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l04744" /><CodeLine lineNumber="4744"></CodeLine>
<Link id="l04745" /><CodeLine lineNumber="4745"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType, 5&gt;</a> Updates;</span></CodeLine>
<Link id="l04746" /><CodeLine lineNumber="4746"></CodeLine>
<Link id="l04747" /><CodeLine lineNumber="4747"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If OtherDest &#42;is&#42; BB, then BB is a basic block with a single conditional</span></CodeLine>
<Link id="l04748" /><CodeLine lineNumber="4748"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branch in it, where one edge (OtherDest) goes back to itself but the other</span></CodeLine>
<Link id="l04749" /><CodeLine lineNumber="4749"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// exits.  We don&#39;t &#42;know&#42; that the program avoids the infinite loop</span></CodeLine>
<Link id="l04750" /><CodeLine lineNumber="4750"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (even though that seems likely).  If we do this xform naively, we&#39;ll end up</span></CodeLine>
<Link id="l04751" /><CodeLine lineNumber="4751"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// recursively unpeeling the loop.  Since we know that (after the xform is</span></CodeLine>
<Link id="l04752" /><CodeLine lineNumber="4752"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// done) that the block &#42;is&#42; infinite if reached, we just make it an obviously</span></CodeLine>
<Link id="l04753" /><CodeLine lineNumber="4753"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// infinite loop with no cond branch.</span></CodeLine>
<Link id="l04754" /><CodeLine lineNumber="4754"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OtherDest == BB) &#123;</span></CodeLine>
<Link id="l04755" /><CodeLine lineNumber="4755"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Insert it at the end of the function, because it&#39;s either code,</span></CodeLine>
<Link id="l04756" /><CodeLine lineNumber="4756"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// or it won&#39;t matter if it&#39;s hot. :)</span></CodeLine>
<Link id="l04757" /><CodeLine lineNumber="4757"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InfLoopBlock =</span></CodeLine>
<Link id="l04758" /><CodeLine lineNumber="4758"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;infloop&quot;</span><span class="doxyHighlight">, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l04759" /><CodeLine lineNumber="4759"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(InfLoopBlock, InfLoopBlock);</span></CodeLine>
<Link id="l04760" /><CodeLine lineNumber="4760"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l04761" /><CodeLine lineNumber="4761"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, InfLoopBlock, InfLoopBlock&#125;);</span></CodeLine>
<Link id="l04762" /><CodeLine lineNumber="4762"><span class="doxyHighlight">    OtherDest = InfLoopBlock;</span></CodeLine>
<Link id="l04763" /><CodeLine lineNumber="4763"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04764" /><CodeLine lineNumber="4764"></CodeLine>
<Link id="l04765" /><CodeLine lineNumber="4765"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; &#42;PBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent());</span></CodeLine>
<Link id="l04766" /><CodeLine lineNumber="4766"></CodeLine>
<Link id="l04767" /><CodeLine lineNumber="4767"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BI may have other predecessors.  Because of this, we leave</span></CodeLine>
<Link id="l04768" /><CodeLine lineNumber="4768"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it alone, but modify PBI.</span></CodeLine>
<Link id="l04769" /><CodeLine lineNumber="4769"></CodeLine>
<Link id="l04770" /><CodeLine lineNumber="4770"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure we get to CommonDest on True&amp;True directions.</span></CodeLine>
<Link id="l04771" /><CodeLine lineNumber="4771"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;PBICond = PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l04772" /><CodeLine lineNumber="4772"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;NoFolder&gt;</a> Builder(PBI);</span></CodeLine>
<Link id="l04773" /><CodeLine lineNumber="4773"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBIOp)</span></CodeLine>
<Link id="l04774" /><CodeLine lineNumber="4774"><span class="doxyHighlight">    PBICond = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a89f675aadae7232445c74ee4167ff591">CreateNot</a>(PBICond, PBICond-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.not&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04775" /><CodeLine lineNumber="4775"></CodeLine>
<Link id="l04776" /><CodeLine lineNumber="4776"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;BICond = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l04777" /><CodeLine lineNumber="4777"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BIOp)</span></CodeLine>
<Link id="l04778" /><CodeLine lineNumber="4778"><span class="doxyHighlight">    BICond = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a89f675aadae7232445c74ee4167ff591">CreateNot</a>(BICond, BICond-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.not&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04779" /><CodeLine lineNumber="4779"></CodeLine>
<Link id="l04780" /><CodeLine lineNumber="4780"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Merge the conditions.</span></CodeLine>
<Link id="l04781" /><CodeLine lineNumber="4781"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> =</span></CodeLine>
<Link id="l04782" /><CodeLine lineNumber="4782"><span class="doxyHighlight">      <a href="#a6092c4a20d4eba2072c849c5408b9435">createLogicalOp</a>(Builder, Instruction::Or, PBICond, BICond, </span><span class="doxyHighlightStringLiteral">&quot;brmerge&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04783" /><CodeLine lineNumber="4783"></CodeLine>
<Link id="l04784" /><CodeLine lineNumber="4784"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Modify PBI to branch on the new condition to the new dests.</span></CodeLine>
<Link id="l04785" /><CodeLine lineNumber="4785"><span class="doxyHighlight">  PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a3505dab06f59c36142a234321cdc3411">setCondition</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l04786" /><CodeLine lineNumber="4786"><span class="doxyHighlight">  PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(0, CommonDest);</span></CodeLine>
<Link id="l04787" /><CodeLine lineNumber="4787"><span class="doxyHighlight">  PBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(1, OtherDest);</span></CodeLine>
<Link id="l04788" /><CodeLine lineNumber="4788"></CodeLine>
<Link id="l04789" /><CodeLine lineNumber="4789"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l04790" /><CodeLine lineNumber="4790"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, PBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), OtherDest&#125;);</span></CodeLine>
<Link id="l04791" /><CodeLine lineNumber="4791"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, PBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), RemovedDest&#125;);</span></CodeLine>
<Link id="l04792" /><CodeLine lineNumber="4792"></CodeLine>
<Link id="l04793" /><CodeLine lineNumber="4793"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l04794" /><CodeLine lineNumber="4794"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04795" /><CodeLine lineNumber="4795"></CodeLine>
<Link id="l04796" /><CodeLine lineNumber="4796"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update branch weight for PBI.</span></CodeLine>
<Link id="l04797" /><CodeLine lineNumber="4797"><span class="doxyHighlight">  uint64&#95;t PredTrueWeight, PredFalseWeight, SuccTrueWeight, SuccFalseWeight;</span></CodeLine>
<Link id="l04798" /><CodeLine lineNumber="4798"><span class="doxyHighlight">  uint64&#95;t PredCommon, PredOther, SuccCommon, SuccOther;</span></CodeLine>
<Link id="l04799" /><CodeLine lineNumber="4799"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasWeights =</span></CodeLine>
<Link id="l04800" /><CodeLine lineNumber="4800"><span class="doxyHighlight">      <a href="#a404f7a1827e4eb8c5ded5ce6dafecf07">extractPredSuccWeights</a>(PBI, BI, PredTrueWeight, PredFalseWeight,</span></CodeLine>
<Link id="l04801" /><CodeLine lineNumber="4801"><span class="doxyHighlight">                             SuccTrueWeight, SuccFalseWeight);</span></CodeLine>
<Link id="l04802" /><CodeLine lineNumber="4802"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasWeights) &#123;</span></CodeLine>
<Link id="l04803" /><CodeLine lineNumber="4803"><span class="doxyHighlight">    PredCommon = PBIOp ? PredFalseWeight : PredTrueWeight;</span></CodeLine>
<Link id="l04804" /><CodeLine lineNumber="4804"><span class="doxyHighlight">    PredOther = PBIOp ? PredTrueWeight : PredFalseWeight;</span></CodeLine>
<Link id="l04805" /><CodeLine lineNumber="4805"><span class="doxyHighlight">    SuccCommon = BIOp ? SuccFalseWeight : SuccTrueWeight;</span></CodeLine>
<Link id="l04806" /><CodeLine lineNumber="4806"><span class="doxyHighlight">    SuccOther = BIOp ? SuccTrueWeight : SuccFalseWeight;</span></CodeLine>
<Link id="l04807" /><CodeLine lineNumber="4807"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The weight to CommonDest should be PredCommon &#42; SuccTotal +</span></CodeLine>
<Link id="l04808" /><CodeLine lineNumber="4808"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//                                    PredOther &#42; SuccCommon.</span></CodeLine>
<Link id="l04809" /><CodeLine lineNumber="4809"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The weight to OtherDest should be PredOther &#42; SuccOther.</span></CodeLine>
<Link id="l04810" /><CodeLine lineNumber="4810"><span class="doxyHighlight">    uint64&#95;t NewWeights&#91;2&#93; = &#123;PredCommon &#42; (SuccCommon + SuccOther) +</span></CodeLine>
<Link id="l04811" /><CodeLine lineNumber="4811"><span class="doxyHighlight">                                  PredOther &#42; SuccCommon,</span></CodeLine>
<Link id="l04812" /><CodeLine lineNumber="4812"><span class="doxyHighlight">                              PredOther &#42; SuccOther&#125;;</span></CodeLine>
<Link id="l04813" /><CodeLine lineNumber="4813"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Halve the weights if any of them cannot fit in an uint32&#95;t</span></CodeLine>
<Link id="l04814" /><CodeLine lineNumber="4814"><span class="doxyHighlight">    <a href="#a7b05fae85db516bdd2df79cef5a6343d">fitWeights</a>(NewWeights);</span></CodeLine>
<Link id="l04815" /><CodeLine lineNumber="4815"></CodeLine>
<Link id="l04816" /><CodeLine lineNumber="4816"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(PBI, NewWeights&#91;0&#93;, NewWeights&#91;1&#93;, </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04817" /><CodeLine lineNumber="4817"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04818" /><CodeLine lineNumber="4818"></CodeLine>
<Link id="l04819" /><CodeLine lineNumber="4819"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OtherDest may have phi nodes.  If so, add an entry from PBI&#39;s</span></CodeLine>
<Link id="l04820" /><CodeLine lineNumber="4820"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block that are identical to the entries for BI&#39;s block.</span></CodeLine>
<Link id="l04821" /><CodeLine lineNumber="4821"><span class="doxyHighlight">  <a href="#a0375fe3378c23272b805320851744043">addPredecessorToBlock</a>(OtherDest, PBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), BB);</span></CodeLine>
<Link id="l04822" /><CodeLine lineNumber="4822"></CodeLine>
<Link id="l04823" /><CodeLine lineNumber="4823"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We know that the CommonDest already had an edge from PBI to</span></CodeLine>
<Link id="l04824" /><CodeLine lineNumber="4824"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it.  If it has PHIs though, the PHIs may have different</span></CodeLine>
<Link id="l04825" /><CodeLine lineNumber="4825"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// entries for BB and PBI&#39;s BB.  If so, insert a select to make</span></CodeLine>
<Link id="l04826" /><CodeLine lineNumber="4826"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them agree.</span></CodeLine>
<Link id="l04827" /><CodeLine lineNumber="4827"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : CommonDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l04828" /><CodeLine lineNumber="4828"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;BIV = PN.getIncomingValueForBlock(BB);</span></CodeLine>
<Link id="l04829" /><CodeLine lineNumber="4829"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PBBIdx = PN.getBasicBlockIndex(PBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l04830" /><CodeLine lineNumber="4830"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;PBIV = PN.getIncomingValue(PBBIdx);</span></CodeLine>
<Link id="l04831" /><CodeLine lineNumber="4831"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BIV != PBIV) &#123;</span></CodeLine>
<Link id="l04832" /><CodeLine lineNumber="4832"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Insert a select in PBI to pick the right value.</span></CodeLine>
<Link id="l04833" /><CodeLine lineNumber="4833"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;NV = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(</span></CodeLine>
<Link id="l04834" /><CodeLine lineNumber="4834"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(PBICond, PBIV, BIV, PBIV-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.mux&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l04835" /><CodeLine lineNumber="4835"><span class="doxyHighlight">      PN.setIncomingValue(PBBIdx, NV);</span></CodeLine>
<Link id="l04836" /><CodeLine lineNumber="4836"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Although the select has the same condition as PBI, the original branch</span></CodeLine>
<Link id="l04837" /><CodeLine lineNumber="4837"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// weights for PBI do not apply to the new select because the select&#39;s</span></CodeLine>
<Link id="l04838" /><CodeLine lineNumber="4838"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// &#39;logical&#39; edges are incoming edges of the phi that is eliminated, not</span></CodeLine>
<Link id="l04839" /><CodeLine lineNumber="4839"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the outgoing edges of PBI.</span></CodeLine>
<Link id="l04840" /><CodeLine lineNumber="4840"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasWeights) &#123;</span></CodeLine>
<Link id="l04841" /><CodeLine lineNumber="4841"><span class="doxyHighlight">        uint64&#95;t PredCommon = PBIOp ? PredFalseWeight : PredTrueWeight;</span></CodeLine>
<Link id="l04842" /><CodeLine lineNumber="4842"><span class="doxyHighlight">        uint64&#95;t PredOther = PBIOp ? PredTrueWeight : PredFalseWeight;</span></CodeLine>
<Link id="l04843" /><CodeLine lineNumber="4843"><span class="doxyHighlight">        uint64&#95;t SuccCommon = BIOp ? SuccFalseWeight : SuccTrueWeight;</span></CodeLine>
<Link id="l04844" /><CodeLine lineNumber="4844"><span class="doxyHighlight">        uint64&#95;t SuccOther = BIOp ? SuccTrueWeight : SuccFalseWeight;</span></CodeLine>
<Link id="l04845" /><CodeLine lineNumber="4845"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The weight to PredCommonDest should be PredCommon &#42; SuccTotal.</span></CodeLine>
<Link id="l04846" /><CodeLine lineNumber="4846"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The weight to PredOtherDest should be PredOther &#42; SuccCommon.</span></CodeLine>
<Link id="l04847" /><CodeLine lineNumber="4847"><span class="doxyHighlight">        uint64&#95;t NewWeights&#91;2&#93; = &#123;PredCommon &#42; (SuccCommon + SuccOther),</span></CodeLine>
<Link id="l04848" /><CodeLine lineNumber="4848"><span class="doxyHighlight">                                  PredOther &#42; SuccCommon&#125;;</span></CodeLine>
<Link id="l04849" /><CodeLine lineNumber="4849"></CodeLine>
<Link id="l04850" /><CodeLine lineNumber="4850"><span class="doxyHighlight">        <a href="#a7b05fae85db516bdd2df79cef5a6343d">fitWeights</a>(NewWeights);</span></CodeLine>
<Link id="l04851" /><CodeLine lineNumber="4851"></CodeLine>
<Link id="l04852" /><CodeLine lineNumber="4852"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(NV, NewWeights&#91;0&#93;, NewWeights&#91;1&#93;,</span></CodeLine>
<Link id="l04853" /><CodeLine lineNumber="4853"><span class="doxyHighlight">                         </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04854" /><CodeLine lineNumber="4854"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04855" /><CodeLine lineNumber="4855"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04856" /><CodeLine lineNumber="4856"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04857" /><CodeLine lineNumber="4857"></CodeLine>
<Link id="l04858" /><CodeLine lineNumber="4858"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INTO: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l04859" /><CodeLine lineNumber="4859"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; &#42;PBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent());</span></CodeLine>
<Link id="l04860" /><CodeLine lineNumber="4860"></CodeLine>
<Link id="l04861" /><CodeLine lineNumber="4861"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This basic block is probably dead.  We know it has at least</span></CodeLine>
<Link id="l04862" /><CodeLine lineNumber="4862"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// one fewer predecessor.</span></CodeLine>
<Link id="l04863" /><CodeLine lineNumber="4863"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04864" /><CodeLine lineNumber="4864"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04865" /><CodeLine lineNumber="4865"></CodeLine>
<Link id="l04866" /><CodeLine lineNumber="4866"><span class="doxyHighlightComment">// Simplifies a terminator by replacing it with a branch to TrueBB if Cond is</span></CodeLine>
<Link id="l04867" /><CodeLine lineNumber="4867"><span class="doxyHighlightComment">// true or to FalseBB if Cond is false.</span></CodeLine>
<Link id="l04868" /><CodeLine lineNumber="4868"><span class="doxyHighlightComment">// Takes care of updating the successors and removing the old terminator.</span></CodeLine>
<Link id="l04869" /><CodeLine lineNumber="4869"><span class="doxyHighlightComment">// Also makes sure not to introduce new successors by assuming that edges to</span></CodeLine>
<Link id="l04870" /><CodeLine lineNumber="4870"><span class="doxyHighlightComment">// non-successor TrueBBs and FalseBBs aren&#39;t reachable.</span></CodeLine>
<Link id="l04871" /><CodeLine lineNumber="4871"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyTerminatorOnSelect(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OldTerm,</span></CodeLine>
<Link id="l04872" /><CodeLine lineNumber="4872"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueBB,</span></CodeLine>
<Link id="l04873" /><CodeLine lineNumber="4873"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FalseBB,</span></CodeLine>
<Link id="l04874" /><CodeLine lineNumber="4874"><span class="doxyHighlight">                                                uint32&#95;t TrueWeight,</span></CodeLine>
<Link id="l04875" /><CodeLine lineNumber="4875"><span class="doxyHighlight">                                                uint32&#95;t FalseWeight) &#123;</span></CodeLine>
<Link id="l04876" /><CodeLine lineNumber="4876"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB = OldTerm-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l04877" /><CodeLine lineNumber="4877"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove any superfluous successor edges from the CFG.</span></CodeLine>
<Link id="l04878" /><CodeLine lineNumber="4878"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First, figure out which successors to preserve.</span></CodeLine>
<Link id="l04879" /><CodeLine lineNumber="4879"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If TrueBB and FalseBB are equal, only try to preserve one copy of that</span></CodeLine>
<Link id="l04880" /><CodeLine lineNumber="4880"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// successor.</span></CodeLine>
<Link id="l04881" /><CodeLine lineNumber="4881"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;KeepEdge1 = TrueBB;</span></CodeLine>
<Link id="l04882" /><CodeLine lineNumber="4882"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;KeepEdge2 = TrueBB != FalseBB ? FalseBB : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04883" /><CodeLine lineNumber="4883"></CodeLine>
<Link id="l04884" /><CodeLine lineNumber="4884"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;BasicBlock &#42;, 2&gt;</a> RemovedSuccessors;</span></CodeLine>
<Link id="l04885" /><CodeLine lineNumber="4885"></CodeLine>
<Link id="l04886" /><CodeLine lineNumber="4886"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Then remove the rest.</span></CodeLine>
<Link id="l04887" /><CodeLine lineNumber="4887"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(OldTerm)) &#123;</span></CodeLine>
<Link id="l04888" /><CodeLine lineNumber="4888"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure only to keep exactly one copy of each edge.</span></CodeLine>
<Link id="l04889" /><CodeLine lineNumber="4889"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ == KeepEdge1)</span></CodeLine>
<Link id="l04890" /><CodeLine lineNumber="4890"><span class="doxyHighlight">      KeepEdge1 = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04891" /><CodeLine lineNumber="4891"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ == KeepEdge2)</span></CodeLine>
<Link id="l04892" /><CodeLine lineNumber="4892"><span class="doxyHighlight">      KeepEdge2 = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04893" /><CodeLine lineNumber="4893"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04894" /><CodeLine lineNumber="4894"><span class="doxyHighlight">      Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BB,</span></CodeLine>
<Link id="l04895" /><CodeLine lineNumber="4895"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;KeepOneInputPHIs=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04896" /><CodeLine lineNumber="4896"></CodeLine>
<Link id="l04897" /><CodeLine lineNumber="4897"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ != TrueBB &amp;&amp; Succ != FalseBB)</span></CodeLine>
<Link id="l04898" /><CodeLine lineNumber="4898"><span class="doxyHighlight">        RemovedSuccessors.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Succ);</span></CodeLine>
<Link id="l04899" /><CodeLine lineNumber="4899"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04900" /><CodeLine lineNumber="4900"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04901" /><CodeLine lineNumber="4901"></CodeLine>
<Link id="l04902" /><CodeLine lineNumber="4902"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(OldTerm);</span></CodeLine>
<Link id="l04903" /><CodeLine lineNumber="4903"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(OldTerm-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l04904" /><CodeLine lineNumber="4904"></CodeLine>
<Link id="l04905" /><CodeLine lineNumber="4905"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert an appropriate new terminator.</span></CodeLine>
<Link id="l04906" /><CodeLine lineNumber="4906"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!KeepEdge1 &amp;&amp; !KeepEdge2) &#123;</span></CodeLine>
<Link id="l04907" /><CodeLine lineNumber="4907"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrueBB == FalseBB) &#123;</span></CodeLine>
<Link id="l04908" /><CodeLine lineNumber="4908"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We were only looking for one successor, and it was present.</span></CodeLine>
<Link id="l04909" /><CodeLine lineNumber="4909"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Create an unconditional branch to it.</span></CodeLine>
<Link id="l04910" /><CodeLine lineNumber="4910"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(TrueBB);</span></CodeLine>
<Link id="l04911" /><CodeLine lineNumber="4911"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04912" /><CodeLine lineNumber="4912"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We found both of the successors we were looking for.</span></CodeLine>
<Link id="l04913" /><CodeLine lineNumber="4913"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Create a conditional branch sharing the condition of the select.</span></CodeLine>
<Link id="l04914" /><CodeLine lineNumber="4914"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;NewBI = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, TrueBB, FalseBB);</span></CodeLine>
<Link id="l04915" /><CodeLine lineNumber="4915"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrueWeight != FalseWeight)</span></CodeLine>
<Link id="l04916" /><CodeLine lineNumber="4916"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(NewBI, TrueWeight, FalseWeight, </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04917" /><CodeLine lineNumber="4917"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04918" /><CodeLine lineNumber="4918"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (KeepEdge1 &amp;&amp; (KeepEdge2 || TrueBB == FalseBB)) &#123;</span></CodeLine>
<Link id="l04919" /><CodeLine lineNumber="4919"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Neither of the selected blocks were successors, so this</span></CodeLine>
<Link id="l04920" /><CodeLine lineNumber="4920"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// terminator must be unreachable.</span></CodeLine>
<Link id="l04921" /><CodeLine lineNumber="4921"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(OldTerm-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), OldTerm-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l04922" /><CodeLine lineNumber="4922"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04923" /><CodeLine lineNumber="4923"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// One of the selected values was a successor, but the other wasn&#39;t.</span></CodeLine>
<Link id="l04924" /><CodeLine lineNumber="4924"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Insert an unconditional branch to the one that was found;</span></CodeLine>
<Link id="l04925" /><CodeLine lineNumber="4925"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the edge to the one that wasn&#39;t must be unreachable.</span></CodeLine>
<Link id="l04926" /><CodeLine lineNumber="4926"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!KeepEdge1) &#123;</span></CodeLine>
<Link id="l04927" /><CodeLine lineNumber="4927"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Only TrueBB was found.</span></CodeLine>
<Link id="l04928" /><CodeLine lineNumber="4928"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(TrueBB);</span></CodeLine>
<Link id="l04929" /><CodeLine lineNumber="4929"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04930" /><CodeLine lineNumber="4930"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Only FalseBB was found.</span></CodeLine>
<Link id="l04931" /><CodeLine lineNumber="4931"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(FalseBB);</span></CodeLine>
<Link id="l04932" /><CodeLine lineNumber="4932"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04933" /><CodeLine lineNumber="4933"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04934" /><CodeLine lineNumber="4934"></CodeLine>
<Link id="l04935" /><CodeLine lineNumber="4935"><span class="doxyHighlight">  <a href="#aa9dd0c9b2a49c91d814102c1d0c7b09d">eraseTerminatorAndDCECond</a>(OldTerm);</span></CodeLine>
<Link id="l04936" /><CodeLine lineNumber="4936"></CodeLine>
<Link id="l04937" /><CodeLine lineNumber="4937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l04938" /><CodeLine lineNumber="4938"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType, 2&gt;</a> Updates;</span></CodeLine>
<Link id="l04939" /><CodeLine lineNumber="4939"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(RemovedSuccessors.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>());</span></CodeLine>
<Link id="l04940" /><CodeLine lineNumber="4940"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RemovedSuccessor : RemovedSuccessors)</span></CodeLine>
<Link id="l04941" /><CodeLine lineNumber="4941"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, RemovedSuccessor&#125;);</span></CodeLine>
<Link id="l04942" /><CodeLine lineNumber="4942"><span class="doxyHighlight">    DTU-&gt;applyUpdates(Updates);</span></CodeLine>
<Link id="l04943" /><CodeLine lineNumber="4943"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04944" /><CodeLine lineNumber="4944"></CodeLine>
<Link id="l04945" /><CodeLine lineNumber="4945"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04946" /><CodeLine lineNumber="4946"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04947" /><CodeLine lineNumber="4947"></CodeLine>
<Link id="l04948" /><CodeLine lineNumber="4948"><span class="doxyHighlightComment">// Replaces</span></CodeLine>
<Link id="l04949" /><CodeLine lineNumber="4949"><span class="doxyHighlightComment">//   (switch (select cond, X, Y)) on constant X, Y</span></CodeLine>
<Link id="l04950" /><CodeLine lineNumber="4950"><span class="doxyHighlightComment">// with a branch - conditional if X and Y lead to distinct BBs,</span></CodeLine>
<Link id="l04951" /><CodeLine lineNumber="4951"><span class="doxyHighlightComment">// unconditional otherwise.</span></CodeLine>
<Link id="l04952" /><CodeLine lineNumber="4952"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifySwitchOnSelect(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>,</span></CodeLine>
<Link id="l04953" /><CodeLine lineNumber="4953"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>) &#123;</span></CodeLine>
<Link id="l04954" /><CodeLine lineNumber="4954"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for constant integer values in the select.</span></CodeLine>
<Link id="l04955" /><CodeLine lineNumber="4955"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a58b95af1ca96e109f85a0646a05fceb7">TrueVal</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getTrueValue());</span></CodeLine>
<Link id="l04956" /><CodeLine lineNumber="4956"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5aeb5a2908109c763377832cbb4726b6d4">FalseVal</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getFalseValue());</span></CodeLine>
<Link id="l04957" /><CodeLine lineNumber="4957"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TrueVal || !FalseVal)</span></CodeLine>
<Link id="l04958" /><CodeLine lineNumber="4958"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04959" /><CodeLine lineNumber="4959"></CodeLine>
<Link id="l04960" /><CodeLine lineNumber="4960"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find the relevant condition and destinations.</span></CodeLine>
<Link id="l04961" /><CodeLine lineNumber="4961"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Condition = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getCondition();</span></CodeLine>
<Link id="l04962" /><CodeLine lineNumber="4962"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueBB = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;findCaseValue(TrueVal)-&gt;getCaseSuccessor();</span></CodeLine>
<Link id="l04963" /><CodeLine lineNumber="4963"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FalseBB = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;findCaseValue(FalseVal)-&gt;getCaseSuccessor();</span></CodeLine>
<Link id="l04964" /><CodeLine lineNumber="4964"></CodeLine>
<Link id="l04965" /><CodeLine lineNumber="4965"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get weight for TrueBB and FalseBB.</span></CodeLine>
<Link id="l04966" /><CodeLine lineNumber="4966"><span class="doxyHighlight">  uint32&#95;t TrueWeight = 0, FalseWeight = 0;</span></CodeLine>
<Link id="l04967" /><CodeLine lineNumber="4967"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint64&#95;t, 8&gt;</a> Weights;</span></CodeLine>
<Link id="l04968" /><CodeLine lineNumber="4968"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasWeights = <a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l04969" /><CodeLine lineNumber="4969"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasWeights) &#123;</span></CodeLine>
<Link id="l04970" /><CodeLine lineNumber="4970"><span class="doxyHighlight">    <a href="#ad3e63520dcd2b8f8aa1b2e66e734a575">getBranchWeights</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, Weights);</span></CodeLine>
<Link id="l04971" /><CodeLine lineNumber="4971"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Weights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 1 + <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases()) &#123;</span></CodeLine>
<Link id="l04972" /><CodeLine lineNumber="4972"><span class="doxyHighlight">      TrueWeight =</span></CodeLine>
<Link id="l04973" /><CodeLine lineNumber="4973"><span class="doxyHighlight">          (uint32&#95;t)Weights&#91;<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;findCaseValue(TrueVal)-&gt;getSuccessorIndex()&#93;;</span></CodeLine>
<Link id="l04974" /><CodeLine lineNumber="4974"><span class="doxyHighlight">      FalseWeight =</span></CodeLine>
<Link id="l04975" /><CodeLine lineNumber="4975"><span class="doxyHighlight">          (uint32&#95;t)Weights&#91;<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;findCaseValue(FalseVal)-&gt;getSuccessorIndex()&#93;;</span></CodeLine>
<Link id="l04976" /><CodeLine lineNumber="4976"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04977" /><CodeLine lineNumber="4977"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04978" /><CodeLine lineNumber="4978"></CodeLine>
<Link id="l04979" /><CodeLine lineNumber="4979"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Perform the actual simplification.</span></CodeLine>
<Link id="l04980" /><CodeLine lineNumber="4980"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> simplifyTerminatorOnSelect(<a href="/docs/api/namespaces/llvm/si">SI</a>, Condition, TrueBB, FalseBB, TrueWeight,</span></CodeLine>
<Link id="l04981" /><CodeLine lineNumber="4981"><span class="doxyHighlight">                                    FalseWeight);</span></CodeLine>
<Link id="l04982" /><CodeLine lineNumber="4982"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04983" /><CodeLine lineNumber="4983"></CodeLine>
<Link id="l04984" /><CodeLine lineNumber="4984"><span class="doxyHighlightComment">// Replaces</span></CodeLine>
<Link id="l04985" /><CodeLine lineNumber="4985"><span class="doxyHighlightComment">//   (indirectbr (select cond, blockaddress(@fn, BlockA),</span></CodeLine>
<Link id="l04986" /><CodeLine lineNumber="4986"><span class="doxyHighlightComment">//                             blockaddress(@fn, BlockB)))</span></CodeLine>
<Link id="l04987" /><CodeLine lineNumber="4987"><span class="doxyHighlightComment">// with</span></CodeLine>
<Link id="l04988" /><CodeLine lineNumber="4988"><span class="doxyHighlightComment">//   (br cond, BlockA, BlockB).</span></CodeLine>
<Link id="l04989" /><CodeLine lineNumber="4989"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyIndirectBrOnSelect(<a href="/docs/api/classes/llvm/indirectbrinst">IndirectBrInst</a> &#42;IBI,</span></CodeLine>
<Link id="l04990" /><CodeLine lineNumber="4990"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</span></CodeLine>
<Link id="l04991" /><CodeLine lineNumber="4991"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that both operands of the select are block addresses.</span></CodeLine>
<Link id="l04992" /><CodeLine lineNumber="4992"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/blockaddress">BlockAddress</a> &#42;TBA = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BlockAddress&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getTrueValue());</span></CodeLine>
<Link id="l04993" /><CodeLine lineNumber="4993"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/blockaddress">BlockAddress</a> &#42;FBA = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BlockAddress&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getFalseValue());</span></CodeLine>
<Link id="l04994" /><CodeLine lineNumber="4994"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TBA || !FBA)</span></CodeLine>
<Link id="l04995" /><CodeLine lineNumber="4995"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04996" /><CodeLine lineNumber="4996"></CodeLine>
<Link id="l04997" /><CodeLine lineNumber="4997"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Extract the actual blocks.</span></CodeLine>
<Link id="l04998" /><CodeLine lineNumber="4998"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueBB = TBA-&gt;<a href="/docs/api/classes/llvm/blockaddress/#abcbecd821a6c5590f25efdf76406a3e8">getBasicBlock</a>();</span></CodeLine>
<Link id="l04999" /><CodeLine lineNumber="4999"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FalseBB = FBA-&gt;<a href="/docs/api/classes/llvm/blockaddress/#abcbecd821a6c5590f25efdf76406a3e8">getBasicBlock</a>();</span></CodeLine>
<Link id="l05000" /><CodeLine lineNumber="5000"></CodeLine>
<Link id="l05001" /><CodeLine lineNumber="5001"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Perform the actual simplification.</span></CodeLine>
<Link id="l05002" /><CodeLine lineNumber="5002"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> simplifyTerminatorOnSelect(IBI, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition(), TrueBB, FalseBB, 0,</span></CodeLine>
<Link id="l05003" /><CodeLine lineNumber="5003"><span class="doxyHighlight">                                    0);</span></CodeLine>
<Link id="l05004" /><CodeLine lineNumber="5004"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05005" /><CodeLine lineNumber="5005"></CodeLine>
<Link id="l05006" /><CodeLine lineNumber="5006"><span class="doxyHighlightComment">/// This is called when we find an icmp instruction</span></CodeLine>
<Link id="l05007" /><CodeLine lineNumber="5007"><span class="doxyHighlightComment">/// (a seteq/setne with a constant) as the only instruction in a</span></CodeLine>
<Link id="l05008" /><CodeLine lineNumber="5008"><span class="doxyHighlightComment">/// block that ends with an uncond branch.  We are looking for a very specific</span></CodeLine>
<Link id="l05009" /><CodeLine lineNumber="5009"><span class="doxyHighlightComment">/// pattern that occurs when &quot;A == 1 || A == 2 || A == 3&quot; gets simplified.  In</span></CodeLine>
<Link id="l05010" /><CodeLine lineNumber="5010"><span class="doxyHighlightComment">/// this case, we merge the first two &quot;or&#39;s of icmp&quot; into a switch, but then the</span></CodeLine>
<Link id="l05011" /><CodeLine lineNumber="5011"><span class="doxyHighlightComment">/// default value goes to an uncond block with a seteq in it, we get something</span></CodeLine>
<Link id="l05012" /><CodeLine lineNumber="5012"><span class="doxyHighlightComment">/// like:</span></CodeLine>
<Link id="l05013" /><CodeLine lineNumber="5013"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05014" /><CodeLine lineNumber="5014"><span class="doxyHighlightComment">///   switch i8 %A, label %DEFAULT &#91; i8 1, label %end    i8 2, label %end &#93;</span></CodeLine>
<Link id="l05015" /><CodeLine lineNumber="5015"><span class="doxyHighlightComment">/// DEFAULT:</span></CodeLine>
<Link id="l05016" /><CodeLine lineNumber="5016"><span class="doxyHighlightComment">///   %tmp = icmp eq i8 %A, 92</span></CodeLine>
<Link id="l05017" /><CodeLine lineNumber="5017"><span class="doxyHighlightComment">///   br label %end</span></CodeLine>
<Link id="l05018" /><CodeLine lineNumber="5018"><span class="doxyHighlightComment">/// end:</span></CodeLine>
<Link id="l05019" /><CodeLine lineNumber="5019"><span class="doxyHighlightComment">///   ... = phi i1 &#91; true, %entry &#93;, &#91; %tmp, %DEFAULT &#93;, &#91; true, %entry &#93;</span></CodeLine>
<Link id="l05020" /><CodeLine lineNumber="5020"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05021" /><CodeLine lineNumber="5021"><span class="doxyHighlightComment">/// We prefer to split the edge to &#39;end&#39; so that there is a true/false entry to</span></CodeLine>
<Link id="l05022" /><CodeLine lineNumber="5022"><span class="doxyHighlightComment">/// the PHI, merging the third icmp into the switch.</span></CodeLine>
<Link id="l05023" /><CodeLine lineNumber="5023"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::tryToSimplifyUncondBranchWithICmpInIt(</span></CodeLine>
<Link id="l05024" /><CodeLine lineNumber="5024"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICI, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l05025" /><CodeLine lineNumber="5025"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = ICI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l05026" /><CodeLine lineNumber="5026"></CodeLine>
<Link id="l05027" /><CodeLine lineNumber="5027"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the block has any PHIs in it or the icmp has multiple uses, it is too</span></CodeLine>
<Link id="l05028" /><CodeLine lineNumber="5028"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// complex.</span></CodeLine>
<Link id="l05029" /><CodeLine lineNumber="5029"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()) || !ICI-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</span></CodeLine>
<Link id="l05030" /><CodeLine lineNumber="5030"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05031" /><CodeLine lineNumber="5031"></CodeLine>
<Link id="l05032" /><CodeLine lineNumber="5032"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l05033" /><CodeLine lineNumber="5033"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Cst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l05034" /><CodeLine lineNumber="5034"></CodeLine>
<Link id="l05035" /><CodeLine lineNumber="5035"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The pattern we&#39;re looking for is where our only predecessor is a switch on</span></CodeLine>
<Link id="l05036" /><CodeLine lineNumber="5036"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#39;V&#39; and this block is the default case for the switch.  In this case we can</span></CodeLine>
<Link id="l05037" /><CodeLine lineNumber="5037"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// fold the compared value into the switch to simplify things.</span></CodeLine>
<Link id="l05038" /><CodeLine lineNumber="5038"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l05039" /><CodeLine lineNumber="5039"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Pred || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SwitchInst&gt;</a>(Pred-&gt;getTerminator()))</span></CodeLine>
<Link id="l05040" /><CodeLine lineNumber="5040"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05041" /><CodeLine lineNumber="5041"></CodeLine>
<Link id="l05042" /><CodeLine lineNumber="5042"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SwitchInst&gt;</a>(Pred-&gt;getTerminator());</span></CodeLine>
<Link id="l05043" /><CodeLine lineNumber="5043"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition() != V)</span></CodeLine>
<Link id="l05044" /><CodeLine lineNumber="5044"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05045" /><CodeLine lineNumber="5045"></CodeLine>
<Link id="l05046" /><CodeLine lineNumber="5046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If BB is reachable on a non-default case, then we simply know the value of</span></CodeLine>
<Link id="l05047" /><CodeLine lineNumber="5047"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// V in this block.  Substitute it and constant fold the icmp instruction</span></CodeLine>
<Link id="l05048" /><CodeLine lineNumber="5048"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// away.</span></CodeLine>
<Link id="l05049" /><CodeLine lineNumber="5049"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest() != BB) &#123;</span></CodeLine>
<Link id="l05050" /><CodeLine lineNumber="5050"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;VVal = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;findCaseDest(BB);</span></CodeLine>
<Link id="l05051" /><CodeLine lineNumber="5051"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VVal &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Should have a unique destination value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05052" /><CodeLine lineNumber="5052"><span class="doxyHighlight">    ICI-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, VVal);</span></CodeLine>
<Link id="l05053" /><CodeLine lineNumber="5053"></CodeLine>
<Link id="l05054" /><CodeLine lineNumber="5054"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/namespaces/llvm/#a57feb935aaafd1bd4bfbb8dc56ad2129">simplifyInstruction</a>(ICI, &#123;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ICI&#125;)) &#123;</span></CodeLine>
<Link id="l05055" /><CodeLine lineNumber="5055"><span class="doxyHighlight">      ICI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</span></CodeLine>
<Link id="l05056" /><CodeLine lineNumber="5056"><span class="doxyHighlight">      ICI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l05057" /><CodeLine lineNumber="5057"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05058" /><CodeLine lineNumber="5058"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// BB is now empty, so it is likely to simplify away.</span></CodeLine>
<Link id="l05059" /><CodeLine lineNumber="5059"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l05060" /><CodeLine lineNumber="5060"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05061" /><CodeLine lineNumber="5061"></CodeLine>
<Link id="l05062" /><CodeLine lineNumber="5062"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ok, the block is reachable from the default dest.  If the constant we&#39;re</span></CodeLine>
<Link id="l05063" /><CodeLine lineNumber="5063"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// comparing exists in one of the other edges, then we can constant fold ICI</span></CodeLine>
<Link id="l05064" /><CodeLine lineNumber="5064"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and zap it.</span></CodeLine>
<Link id="l05065" /><CodeLine lineNumber="5065"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;findCaseValue(Cst) != <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;case&#95;default()) &#123;</span></CodeLine>
<Link id="l05066" /><CodeLine lineNumber="5066"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V;</span></CodeLine>
<Link id="l05067" /><CodeLine lineNumber="5067"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICI-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>)</span></CodeLine>
<Link id="l05068" /><CodeLine lineNumber="5068"><span class="doxyHighlight">      V = <a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>());</span></CodeLine>
<Link id="l05069" /><CodeLine lineNumber="5069"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05070" /><CodeLine lineNumber="5070"><span class="doxyHighlight">      V = <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>());</span></CodeLine>
<Link id="l05071" /><CodeLine lineNumber="5071"></CodeLine>
<Link id="l05072" /><CodeLine lineNumber="5072"><span class="doxyHighlight">    ICI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(V);</span></CodeLine>
<Link id="l05073" /><CodeLine lineNumber="5073"><span class="doxyHighlight">    ICI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l05074" /><CodeLine lineNumber="5074"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// BB is now empty, so it is likely to simplify away.</span></CodeLine>
<Link id="l05075" /><CodeLine lineNumber="5075"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l05076" /><CodeLine lineNumber="5076"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05077" /><CodeLine lineNumber="5077"></CodeLine>
<Link id="l05078" /><CodeLine lineNumber="5078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The use of the icmp has to be in the &#39;end&#39; block, by the only PHI node in</span></CodeLine>
<Link id="l05079" /><CodeLine lineNumber="5079"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the block.</span></CodeLine>
<Link id="l05080" /><CodeLine lineNumber="5080"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBlock = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(0);</span></CodeLine>
<Link id="l05081" /><CodeLine lineNumber="5081"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PHIUse = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(ICI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>());</span></CodeLine>
<Link id="l05082" /><CodeLine lineNumber="5082"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHIUse == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> || PHIUse != &amp;SuccBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>() ||</span></CodeLine>
<Link id="l05083" /><CodeLine lineNumber="5083"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(++<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a>(PHIUse)))</span></CodeLine>
<Link id="l05084" /><CodeLine lineNumber="5084"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05085" /><CodeLine lineNumber="5085"></CodeLine>
<Link id="l05086" /><CodeLine lineNumber="5086"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the icmp is a SETEQ, then the default dest gets false, the new edge gets</span></CodeLine>
<Link id="l05087" /><CodeLine lineNumber="5087"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// true in the PHI.</span></CodeLine>
<Link id="l05088" /><CodeLine lineNumber="5088"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;DefaultCst = <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>());</span></CodeLine>
<Link id="l05089" /><CodeLine lineNumber="5089"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NewCst = <a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>());</span></CodeLine>
<Link id="l05090" /><CodeLine lineNumber="5090"></CodeLine>
<Link id="l05091" /><CodeLine lineNumber="5091"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICI-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>)</span></CodeLine>
<Link id="l05092" /><CodeLine lineNumber="5092"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(DefaultCst, NewCst);</span></CodeLine>
<Link id="l05093" /><CodeLine lineNumber="5093"></CodeLine>
<Link id="l05094" /><CodeLine lineNumber="5094"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace ICI (which is used by the PHI for the default value) with true or</span></CodeLine>
<Link id="l05095" /><CodeLine lineNumber="5095"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// false depending on if it is EQ or NE.</span></CodeLine>
<Link id="l05096" /><CodeLine lineNumber="5096"><span class="doxyHighlight">  ICI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(DefaultCst);</span></CodeLine>
<Link id="l05097" /><CodeLine lineNumber="5097"><span class="doxyHighlight">  ICI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l05098" /><CodeLine lineNumber="5098"></CodeLine>
<Link id="l05099" /><CodeLine lineNumber="5099"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType, 2&gt;</a> Updates;</span></CodeLine>
<Link id="l05100" /><CodeLine lineNumber="5100"></CodeLine>
<Link id="l05101" /><CodeLine lineNumber="5101"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, the switch goes to this block on a default value.  Add an edge from</span></CodeLine>
<Link id="l05102" /><CodeLine lineNumber="5102"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the switch to the merge point on the compared value.</span></CodeLine>
<Link id="l05103" /><CodeLine lineNumber="5103"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB =</span></CodeLine>
<Link id="l05104" /><CodeLine lineNumber="5104"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;switch.edge&quot;</span><span class="doxyHighlight">, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), BB);</span></CodeLine>
<Link id="l05105" /><CodeLine lineNumber="5105"><span class="doxyHighlight">  &#123;</span></CodeLine>
<Link id="l05106" /><CodeLine lineNumber="5106"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/switchinstprofupdatewrapper">SwitchInstProfUpdateWrapper</a> SIW(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l05107" /><CodeLine lineNumber="5107"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> W0 = SIW.getSuccessorWeight(0);</span></CodeLine>
<Link id="l05108" /><CodeLine lineNumber="5108"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/switchinstprofupdatewrapper/#acf60dfe9415b02d8da94b723e1ce87f8">SwitchInstProfUpdateWrapper::CaseWeightOpt</a> NewW;</span></CodeLine>
<Link id="l05109" /><CodeLine lineNumber="5109"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (W0) &#123;</span></CodeLine>
<Link id="l05110" /><CodeLine lineNumber="5110"><span class="doxyHighlight">      NewW = ((uint64&#95;t(&#42;W0) + 1) &gt;&gt; 1);</span></CodeLine>
<Link id="l05111" /><CodeLine lineNumber="5111"><span class="doxyHighlight">      SIW.setSuccessorWeight(0, &#42;NewW);</span></CodeLine>
<Link id="l05112" /><CodeLine lineNumber="5112"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05113" /><CodeLine lineNumber="5113"><span class="doxyHighlight">    SIW.addCase(Cst, NewBB, NewW);</span></CodeLine>
<Link id="l05114" /><CodeLine lineNumber="5114"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l05115" /><CodeLine lineNumber="5115"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, Pred, NewBB&#125;);</span></CodeLine>
<Link id="l05116" /><CodeLine lineNumber="5116"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05117" /><CodeLine lineNumber="5117"></CodeLine>
<Link id="l05118" /><CodeLine lineNumber="5118"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NewBB branches to the phi block, add the uncond branch and the phi entry.</span></CodeLine>
<Link id="l05119" /><CodeLine lineNumber="5119"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(NewBB);</span></CodeLine>
<Link id="l05120" /><CodeLine lineNumber="5120"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l05121" /><CodeLine lineNumber="5121"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(SuccBlock);</span></CodeLine>
<Link id="l05122" /><CodeLine lineNumber="5122"><span class="doxyHighlight">  PHIUse-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewCst, NewBB);</span></CodeLine>
<Link id="l05123" /><CodeLine lineNumber="5123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l05124" /><CodeLine lineNumber="5124"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, NewBB, SuccBlock&#125;);</span></CodeLine>
<Link id="l05125" /><CodeLine lineNumber="5125"><span class="doxyHighlight">    DTU-&gt;applyUpdates(Updates);</span></CodeLine>
<Link id="l05126" /><CodeLine lineNumber="5126"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05127" /><CodeLine lineNumber="5127"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05128" /><CodeLine lineNumber="5128"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05129" /><CodeLine lineNumber="5129"></CodeLine>
<Link id="l05130" /><CodeLine lineNumber="5130"><span class="doxyHighlightComment">/// The specified branch is a conditional branch.</span></CodeLine>
<Link id="l05131" /><CodeLine lineNumber="5131"><span class="doxyHighlightComment">/// Check to see if it is branching on an or/and chain of icmp instructions, and</span></CodeLine>
<Link id="l05132" /><CodeLine lineNumber="5132"><span class="doxyHighlightComment">/// fold it into a switch instruction if so.</span></CodeLine>
<Link id="l05133" /><CodeLine lineNumber="5133"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyBranchOnICmpChain(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI,</span></CodeLine>
<Link id="l05134" /><CodeLine lineNumber="5134"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder,</span></CodeLine>
<Link id="l05135" /><CodeLine lineNumber="5135"><span class="doxyHighlight">                                               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l05136" /><CodeLine lineNumber="5136"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</span></CodeLine>
<Link id="l05137" /><CodeLine lineNumber="5137"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)</span></CodeLine>
<Link id="l05138" /><CodeLine lineNumber="5138"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05139" /><CodeLine lineNumber="5139"></CodeLine>
<Link id="l05140" /><CodeLine lineNumber="5140"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Change br (X == 0 | X == 1), T, F into a switch instruction.</span></CodeLine>
<Link id="l05141" /><CodeLine lineNumber="5141"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is a bunch of seteq&#39;s or&#39;d together, or if it&#39;s a bunch of</span></CodeLine>
<Link id="l05142" /><CodeLine lineNumber="5142"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#39;setne&#39;s and&#39;ed together, collect them.</span></CodeLine>
<Link id="l05143" /><CodeLine lineNumber="5143"></CodeLine>
<Link id="l05144" /><CodeLine lineNumber="5144"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to gather values from a chain of and/or to be turned into a switch</span></CodeLine>
<Link id="l05145" /><CodeLine lineNumber="5145"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-simplifycfg-cpp-/constantcomparesgatherer/#a2d4d63c7f5734e71bb5bcf6fd36d6888">ConstantComparesGatherer</a> ConstantCompare(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l05146" /><CodeLine lineNumber="5146"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Unpack the result</span></CodeLine>
<Link id="l05147" /><CodeLine lineNumber="5147"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;ConstantInt &#42;&gt;</a> &amp;Values = ConstantCompare.Vals;</span></CodeLine>
<Link id="l05148" /><CodeLine lineNumber="5148"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CompVal = ConstantCompare.CompValue;</span></CodeLine>
<Link id="l05149" /><CodeLine lineNumber="5149"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UsedICmps = ConstantCompare.UsedICmps;</span></CodeLine>
<Link id="l05150" /><CodeLine lineNumber="5150"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExtraCase = ConstantCompare.Extra;</span></CodeLine>
<Link id="l05151" /><CodeLine lineNumber="5151"></CodeLine>
<Link id="l05152" /><CodeLine lineNumber="5152"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we didn&#39;t have a multiply compared value, fail.</span></CodeLine>
<Link id="l05153" /><CodeLine lineNumber="5153"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CompVal)</span></CodeLine>
<Link id="l05154" /><CodeLine lineNumber="5154"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05155" /><CodeLine lineNumber="5155"></CodeLine>
<Link id="l05156" /><CodeLine lineNumber="5156"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid turning single icmps into a switch.</span></CodeLine>
<Link id="l05157" /><CodeLine lineNumber="5157"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedICmps &lt;= 1)</span></CodeLine>
<Link id="l05158" /><CodeLine lineNumber="5158"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05159" /><CodeLine lineNumber="5159"></CodeLine>
<Link id="l05160" /><CodeLine lineNumber="5160"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TrueWhenEqual = <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()));</span></CodeLine>
<Link id="l05161" /><CodeLine lineNumber="5161"></CodeLine>
<Link id="l05162" /><CodeLine lineNumber="5162"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// There might be duplicate constants in the list, which the switch</span></CodeLine>
<Link id="l05163" /><CodeLine lineNumber="5163"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction can&#39;t handle, remove them now.</span></CodeLine>
<Link id="l05164" /><CodeLine lineNumber="5164"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#add1eb5637dd671428b6f138ed3db6428">array&#95;pod&#95;sort</a>(Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>(), <a href="#a2ab3a1c5bf0fff25a3254622107b9c9f">constantIntSortPredicate</a>);</span></CodeLine>
<Link id="l05165" /><CodeLine lineNumber="5165"><span class="doxyHighlight">  Values.<a href="/docs/api/classes/llvm/smallvectorimpl/#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(<a href="/docs/api/namespaces/llvm/#a48f85da577c6ce7d9aed90437dc0d07c">llvm::unique</a>(Values), Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l05166" /><CodeLine lineNumber="5166"></CodeLine>
<Link id="l05167" /><CodeLine lineNumber="5167"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If Extra was used, we require at least two switch values to do the</span></CodeLine>
<Link id="l05168" /><CodeLine lineNumber="5168"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// transformation.  A switch with one value is just a conditional branch.</span></CodeLine>
<Link id="l05169" /><CodeLine lineNumber="5169"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtraCase &amp;&amp; Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt; 2)</span></CodeLine>
<Link id="l05170" /><CodeLine lineNumber="5170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05171" /><CodeLine lineNumber="5171"></CodeLine>
<Link id="l05172" /><CodeLine lineNumber="5172"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Preserve branch weight metadata, similarly to how</span></CodeLine>
<Link id="l05173" /><CodeLine lineNumber="5173"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// foldValueComparisonIntoPredecessors preserves it.</span></CodeLine>
<Link id="l05174" /><CodeLine lineNumber="5174"></CodeLine>
<Link id="l05175" /><CodeLine lineNumber="5175"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Figure out which block is which destination.</span></CodeLine>
<Link id="l05176" /><CodeLine lineNumber="5176"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DefaultBB = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l05177" /><CodeLine lineNumber="5177"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EdgeBB = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l05178" /><CodeLine lineNumber="5178"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TrueWhenEqual)</span></CodeLine>
<Link id="l05179" /><CodeLine lineNumber="5179"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(DefaultBB, EdgeBB);</span></CodeLine>
<Link id="l05180" /><CodeLine lineNumber="5180"></CodeLine>
<Link id="l05181" /><CodeLine lineNumber="5181"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l05182" /><CodeLine lineNumber="5182"></CodeLine>
<Link id="l05183" /><CodeLine lineNumber="5183"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Converting &#39;icmp&#39; chain with &quot;</span><span class="doxyHighlight"> &lt;&lt; Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>()</span></CodeLine>
<Link id="l05184" /><CodeLine lineNumber="5184"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; cases into SWITCH.  BB is:\\n&quot;</span></CodeLine>
<Link id="l05185" /><CodeLine lineNumber="5185"><span class="doxyHighlight">                    &lt;&lt; &#42;BB);</span></CodeLine>
<Link id="l05186" /><CodeLine lineNumber="5186"></CodeLine>
<Link id="l05187" /><CodeLine lineNumber="5187"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType, 2&gt;</a> Updates;</span></CodeLine>
<Link id="l05188" /><CodeLine lineNumber="5188"></CodeLine>
<Link id="l05189" /><CodeLine lineNumber="5189"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are any extra values that couldn&#39;t be folded into the switch</span></CodeLine>
<Link id="l05190" /><CodeLine lineNumber="5190"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// then we evaluate them with an explicit branch first. Split the block</span></CodeLine>
<Link id="l05191" /><CodeLine lineNumber="5191"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// right before the condbr to handle it.</span></CodeLine>
<Link id="l05192" /><CodeLine lineNumber="5192"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtraCase) &#123;</span></CodeLine>
<Link id="l05193" /><CodeLine lineNumber="5193"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB = <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(BB, BI, DTU, </span><span class="doxyHighlightComment">/&#42;LI=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05194" /><CodeLine lineNumber="5194"><span class="doxyHighlight">                                   </span><span class="doxyHighlightComment">/&#42;MSSAU=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;switch.early.test&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05195" /><CodeLine lineNumber="5195"></CodeLine>
<Link id="l05196" /><CodeLine lineNumber="5196"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remove the uncond branch added to the old block.</span></CodeLine>
<Link id="l05197" /><CodeLine lineNumber="5197"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OldTI = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l05198" /><CodeLine lineNumber="5198"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(OldTI);</span></CodeLine>
<Link id="l05199" /><CodeLine lineNumber="5199"></CodeLine>
<Link id="l05200" /><CodeLine lineNumber="5200"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// There can be an unintended UB if extra values are Poison. Before the</span></CodeLine>
<Link id="l05201" /><CodeLine lineNumber="5201"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// transformation, extra values may not be evaluated according to the</span></CodeLine>
<Link id="l05202" /><CodeLine lineNumber="5202"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// condition, and it will not raise UB. But after transformation, we are</span></CodeLine>
<Link id="l05203" /><CodeLine lineNumber="5203"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// evaluating extra values before checking the condition, and it will raise</span></CodeLine>
<Link id="l05204" /><CodeLine lineNumber="5204"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// UB. It can be solved by adding freeze instruction to extra values.</span></CodeLine>
<Link id="l05205" /><CodeLine lineNumber="5205"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC = <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.AC;</span></CodeLine>
<Link id="l05206" /><CodeLine lineNumber="5206"></CodeLine>
<Link id="l05207" /><CodeLine lineNumber="5207"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab8a7ef433279aabf7f30fa5504a4d4ef">isGuaranteedNotToBeUndefOrPoison</a>(ExtraCase, AC, BI, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l05208" /><CodeLine lineNumber="5208"><span class="doxyHighlight">      ExtraCase = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a563ec77bbc82ad22aab9621dd14c01cd">CreateFreeze</a>(ExtraCase);</span></CodeLine>
<Link id="l05209" /><CodeLine lineNumber="5209"></CodeLine>
<Link id="l05210" /><CodeLine lineNumber="5210"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrueWhenEqual)</span></CodeLine>
<Link id="l05211" /><CodeLine lineNumber="5211"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(ExtraCase, EdgeBB, NewBB);</span></CodeLine>
<Link id="l05212" /><CodeLine lineNumber="5212"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05213" /><CodeLine lineNumber="5213"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(ExtraCase, NewBB, EdgeBB);</span></CodeLine>
<Link id="l05214" /><CodeLine lineNumber="5214"></CodeLine>
<Link id="l05215" /><CodeLine lineNumber="5215"><span class="doxyHighlight">    OldTI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l05216" /><CodeLine lineNumber="5216"></CodeLine>
<Link id="l05217" /><CodeLine lineNumber="5217"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l05218" /><CodeLine lineNumber="5218"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, BB, EdgeBB&#125;);</span></CodeLine>
<Link id="l05219" /><CodeLine lineNumber="5219"></CodeLine>
<Link id="l05220" /><CodeLine lineNumber="5220"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are PHI nodes in EdgeBB, then we need to add a new entry to them</span></CodeLine>
<Link id="l05221" /><CodeLine lineNumber="5221"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for the edge we just added.</span></CodeLine>
<Link id="l05222" /><CodeLine lineNumber="5222"><span class="doxyHighlight">    <a href="#a0375fe3378c23272b805320851744043">addPredecessorToBlock</a>(EdgeBB, BB, NewBB);</span></CodeLine>
<Link id="l05223" /><CodeLine lineNumber="5223"></CodeLine>
<Link id="l05224" /><CodeLine lineNumber="5224"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  &#42;&#42; &#39;icmp&#39; chain unhandled condition: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;ExtraCase</span></CodeLine>
<Link id="l05225" /><CodeLine lineNumber="5225"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nEXTRABB = &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BB);</span></CodeLine>
<Link id="l05226" /><CodeLine lineNumber="5226"><span class="doxyHighlight">    BB = NewBB;</span></CodeLine>
<Link id="l05227" /><CodeLine lineNumber="5227"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05228" /><CodeLine lineNumber="5228"></CodeLine>
<Link id="l05229" /><CodeLine lineNumber="5229"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(BI);</span></CodeLine>
<Link id="l05230" /><CodeLine lineNumber="5230"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convert pointer to int before we switch.</span></CodeLine>
<Link id="l05231" /><CodeLine lineNumber="5231"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CompVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) &#123;</span></CodeLine>
<Link id="l05232" /><CodeLine lineNumber="5232"><span class="doxyHighlight">    CompVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aae2c1bf70058f3665edaec525457030c">CreatePtrToInt</a>(</span></CodeLine>
<Link id="l05233" /><CodeLine lineNumber="5233"><span class="doxyHighlight">        CompVal, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getIntPtrType(CompVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()), </span><span class="doxyHighlightStringLiteral">&quot;magicptr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05234" /><CodeLine lineNumber="5234"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05235" /><CodeLine lineNumber="5235"></CodeLine>
<Link id="l05236" /><CodeLine lineNumber="5236"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the new switch instruction now.</span></CodeLine>
<Link id="l05237" /><CodeLine lineNumber="5237"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8b123015de85b2f41b0deda2aeaad9d3">CreateSwitch</a>(CompVal, DefaultBB, Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</span></CodeLine>
<Link id="l05238" /><CodeLine lineNumber="5238"></CodeLine>
<Link id="l05239" /><CodeLine lineNumber="5239"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add all of the &#39;cases&#39; to the switch instruction.</span></CodeLine>
<Link id="l05240" /><CodeLine lineNumber="5240"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); i != e; ++i)</span></CodeLine>
<Link id="l05241" /><CodeLine lineNumber="5241"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a>-&gt;addCase(Values&#91;i&#93;, EdgeBB);</span></CodeLine>
<Link id="l05242" /><CodeLine lineNumber="5242"></CodeLine>
<Link id="l05243" /><CodeLine lineNumber="5243"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We added edges from PI to the EdgeBB.  As such, if there were any</span></CodeLine>
<Link id="l05244" /><CodeLine lineNumber="5244"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHI nodes in EdgeBB, they need entries to be added corresponding to</span></CodeLine>
<Link id="l05245" /><CodeLine lineNumber="5245"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the number of edges added.</span></CodeLine>
<Link id="l05246" /><CodeLine lineNumber="5246"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI = EdgeBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(BBI); ++BBI) &#123;</span></CodeLine>
<Link id="l05247" /><CodeLine lineNumber="5247"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(BBI);</span></CodeLine>
<Link id="l05248" /><CodeLine lineNumber="5248"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;InVal = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(BB);</span></CodeLine>
<Link id="l05249" /><CodeLine lineNumber="5249"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() - 1; i != e; ++i)</span></CodeLine>
<Link id="l05250" /><CodeLine lineNumber="5250"><span class="doxyHighlight">      PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(InVal, BB);</span></CodeLine>
<Link id="l05251" /><CodeLine lineNumber="5251"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05252" /><CodeLine lineNumber="5252"></CodeLine>
<Link id="l05253" /><CodeLine lineNumber="5253"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Erase the old branch instruction.</span></CodeLine>
<Link id="l05254" /><CodeLine lineNumber="5254"><span class="doxyHighlight">  <a href="#aa9dd0c9b2a49c91d814102c1d0c7b09d">eraseTerminatorAndDCECond</a>(BI);</span></CodeLine>
<Link id="l05255" /><CodeLine lineNumber="5255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l05256" /><CodeLine lineNumber="5256"><span class="doxyHighlight">    DTU-&gt;applyUpdates(Updates);</span></CodeLine>
<Link id="l05257" /><CodeLine lineNumber="5257"></CodeLine>
<Link id="l05258" /><CodeLine lineNumber="5258"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  &#42;&#42; &#39;icmp&#39; chain result is:\\n&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BB &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05259" /><CodeLine lineNumber="5259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05260" /><CodeLine lineNumber="5260"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05261" /><CodeLine lineNumber="5261"></CodeLine>
<Link id="l05262" /><CodeLine lineNumber="5262"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyResume(<a href="/docs/api/classes/llvm/resumeinst">ResumeInst</a> &#42;RI, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l05263" /><CodeLine lineNumber="5263"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(RI-&gt;<a href="/docs/api/classes/llvm/resumeinst/#a796a53d6391a88b5280252cfed2f9615">getValue</a>()))</span></CodeLine>
<Link id="l05264" /><CodeLine lineNumber="5264"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> simplifyCommonResume(RI);</span></CodeLine>
<Link id="l05265" /><CodeLine lineNumber="5265"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LandingPadInst&gt;</a>(RI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getFirstNonPHIIt()) &amp;&amp;</span></CodeLine>
<Link id="l05266" /><CodeLine lineNumber="5266"><span class="doxyHighlight">           RI-&gt;<a href="/docs/api/classes/llvm/resumeinst/#a796a53d6391a88b5280252cfed2f9615">getValue</a>() == &amp;&#42;RI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getFirstNonPHIIt())</span></CodeLine>
<Link id="l05267" /><CodeLine lineNumber="5267"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The resume must unwind the exception that caused control to branch here.</span></CodeLine>
<Link id="l05268" /><CodeLine lineNumber="5268"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> simplifySingleResume(RI);</span></CodeLine>
<Link id="l05269" /><CodeLine lineNumber="5269"></CodeLine>
<Link id="l05270" /><CodeLine lineNumber="5270"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05271" /><CodeLine lineNumber="5271"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05272" /><CodeLine lineNumber="5272"></CodeLine>
<Link id="l05273" /><CodeLine lineNumber="5273"><span class="doxyHighlightComment">// Check if cleanup block is empty</span></CodeLine>
<Link id="l05274" /><CodeLine lineNumber="5274" lineLink="#a583f07468003b1c19e8227f1c0e63fb7"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a583f07468003b1c19e8227f1c0e63fb7">isCleanupBlockEmpty</a>(<a href="/docs/api/classes/llvm/iterator-range">iterator&#95;range&lt;BasicBlock::iterator&gt;</a> R) &#123;</span></CodeLine>
<Link id="l05275" /><CodeLine lineNumber="5275"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : R) &#123;</span></CodeLine>
<Link id="l05276" /><CodeLine lineNumber="5276"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05277" /><CodeLine lineNumber="5277"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)</span></CodeLine>
<Link id="l05278" /><CodeLine lineNumber="5278"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05279" /><CodeLine lineNumber="5279"></CodeLine>
<Link id="l05280" /><CodeLine lineNumber="5280"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrinsicID = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID();</span></CodeLine>
<Link id="l05281" /><CodeLine lineNumber="5281"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (IntrinsicID) &#123;</span></CodeLine>
<Link id="l05282" /><CodeLine lineNumber="5282"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::dbg&#95;declare:</span></CodeLine>
<Link id="l05283" /><CodeLine lineNumber="5283"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::dbg&#95;value:</span></CodeLine>
<Link id="l05284" /><CodeLine lineNumber="5284"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::dbg&#95;label:</span></CodeLine>
<Link id="l05285" /><CodeLine lineNumber="5285"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::lifetime&#95;end:</span></CodeLine>
<Link id="l05286" /><CodeLine lineNumber="5286"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05287" /><CodeLine lineNumber="5287"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l05288" /><CodeLine lineNumber="5288"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05289" /><CodeLine lineNumber="5289"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05290" /><CodeLine lineNumber="5290"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05291" /><CodeLine lineNumber="5291"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05292" /><CodeLine lineNumber="5292"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05293" /><CodeLine lineNumber="5293"></CodeLine>
<Link id="l05294" /><CodeLine lineNumber="5294"><span class="doxyHighlightComment">// Simplify resume that is shared by several landing pads (phi of landing pad).</span></CodeLine>
<Link id="l05295" /><CodeLine lineNumber="5295"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyCommonResume(<a href="/docs/api/classes/llvm/resumeinst">ResumeInst</a> &#42;RI) &#123;</span></CodeLine>
<Link id="l05296" /><CodeLine lineNumber="5296"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = RI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l05297" /><CodeLine lineNumber="5297"></CodeLine>
<Link id="l05298" /><CodeLine lineNumber="5298"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that there are no other instructions except for debug and lifetime</span></CodeLine>
<Link id="l05299" /><CodeLine lineNumber="5299"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// intrinsics between the phi&#39;s and resume instruction.</span></CodeLine>
<Link id="l05300" /><CodeLine lineNumber="5300"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a583f07468003b1c19e8227f1c0e63fb7">isCleanupBlockEmpty</a>(<a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(RI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getFirstNonPHIIt(),</span></CodeLine>
<Link id="l05301" /><CodeLine lineNumber="5301"><span class="doxyHighlight">                                      BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>())))</span></CodeLine>
<Link id="l05302" /><CodeLine lineNumber="5302"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05303" /><CodeLine lineNumber="5303"></CodeLine>
<Link id="l05304" /><CodeLine lineNumber="5304"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;BasicBlock &#42;, 4&gt;</a> TrivialUnwindBlocks;</span></CodeLine>
<Link id="l05305" /><CodeLine lineNumber="5305"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PhiLPInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(RI-&gt;<a href="/docs/api/classes/llvm/resumeinst/#a796a53d6391a88b5280252cfed2f9615">getValue</a>());</span></CodeLine>
<Link id="l05306" /><CodeLine lineNumber="5306"></CodeLine>
<Link id="l05307" /><CodeLine lineNumber="5307"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check incoming blocks to see if any of them are trivial.</span></CodeLine>
<Link id="l05308" /><CodeLine lineNumber="5308"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0, End = PhiLPInst-&gt;getNumIncomingValues(); Idx != End;</span></CodeLine>
<Link id="l05309" /><CodeLine lineNumber="5309"><span class="doxyHighlight">       Idx++) &#123;</span></CodeLine>
<Link id="l05310" /><CodeLine lineNumber="5310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IncomingBB = PhiLPInst-&gt;getIncomingBlock(Idx);</span></CodeLine>
<Link id="l05311" /><CodeLine lineNumber="5311"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IncomingValue = PhiLPInst-&gt;getIncomingValue(Idx);</span></CodeLine>
<Link id="l05312" /><CodeLine lineNumber="5312"></CodeLine>
<Link id="l05313" /><CodeLine lineNumber="5313"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the block has other successors, we can not delete it because</span></CodeLine>
<Link id="l05314" /><CodeLine lineNumber="5314"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it has other dependents.</span></CodeLine>
<Link id="l05315" /><CodeLine lineNumber="5315"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IncomingBB-&gt;getUniqueSuccessor() != BB)</span></CodeLine>
<Link id="l05316" /><CodeLine lineNumber="5316"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05317" /><CodeLine lineNumber="5317"></CodeLine>
<Link id="l05318" /><CodeLine lineNumber="5318"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LandingPad = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LandingPadInst&gt;</a>(IncomingBB-&gt;getFirstNonPHIIt());</span></CodeLine>
<Link id="l05319" /><CodeLine lineNumber="5319"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Not the landing pad that caused the control to branch here.</span></CodeLine>
<Link id="l05320" /><CodeLine lineNumber="5320"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IncomingValue != LandingPad)</span></CodeLine>
<Link id="l05321" /><CodeLine lineNumber="5321"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05322" /><CodeLine lineNumber="5322"></CodeLine>
<Link id="l05323" /><CodeLine lineNumber="5323"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a583f07468003b1c19e8227f1c0e63fb7">isCleanupBlockEmpty</a>(</span></CodeLine>
<Link id="l05324" /><CodeLine lineNumber="5324"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(LandingPad-&gt;getNextNode(), IncomingBB-&gt;getTerminator())))</span></CodeLine>
<Link id="l05325" /><CodeLine lineNumber="5325"><span class="doxyHighlight">      TrivialUnwindBlocks.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(IncomingBB);</span></CodeLine>
<Link id="l05326" /><CodeLine lineNumber="5326"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05327" /><CodeLine lineNumber="5327"></CodeLine>
<Link id="l05328" /><CodeLine lineNumber="5328"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If no trivial unwind blocks, don&#39;t do any simplifications.</span></CodeLine>
<Link id="l05329" /><CodeLine lineNumber="5329"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrivialUnwindBlocks.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>())</span></CodeLine>
<Link id="l05330" /><CodeLine lineNumber="5330"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05331" /><CodeLine lineNumber="5331"></CodeLine>
<Link id="l05332" /><CodeLine lineNumber="5332"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Turn all invokes that unwind here into calls.</span></CodeLine>
<Link id="l05333" /><CodeLine lineNumber="5333"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;TrivialBB : TrivialUnwindBlocks) &#123;</span></CodeLine>
<Link id="l05334" /><CodeLine lineNumber="5334"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Blocks that will be simplified should be removed from the phi node.</span></CodeLine>
<Link id="l05335" /><CodeLine lineNumber="5335"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note there could be multiple edges to the resume block, and we need</span></CodeLine>
<Link id="l05336" /><CodeLine lineNumber="5336"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to remove them all.</span></CodeLine>
<Link id="l05337" /><CodeLine lineNumber="5337"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (PhiLPInst-&gt;getBasicBlockIndex(TrivialBB) != -1)</span></CodeLine>
<Link id="l05338" /><CodeLine lineNumber="5338"><span class="doxyHighlight">      BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(TrivialBB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05339" /><CodeLine lineNumber="5339"></CodeLine>
<Link id="l05340" /><CodeLine lineNumber="5340"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred :</span></CodeLine>
<Link id="l05341" /><CodeLine lineNumber="5341"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(TrivialBB))) &#123;</span></CodeLine>
<Link id="l05342" /><CodeLine lineNumber="5342"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a83cbd0aa1465957c50eaea8374875b27">removeUnwindEdge</a>(Pred, DTU);</span></CodeLine>
<Link id="l05343" /><CodeLine lineNumber="5343"><span class="doxyHighlight">      ++NumInvokes;</span></CodeLine>
<Link id="l05344" /><CodeLine lineNumber="5344"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05345" /><CodeLine lineNumber="5345"></CodeLine>
<Link id="l05346" /><CodeLine lineNumber="5346"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In each SimplifyCFG run, only the current processed block can be erased.</span></CodeLine>
<Link id="l05347" /><CodeLine lineNumber="5347"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, it will break the iteration of SimplifyCFG pass. So instead</span></CodeLine>
<Link id="l05348" /><CodeLine lineNumber="5348"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of erasing TrivialBB, we only remove the branch to the common resume</span></CodeLine>
<Link id="l05349" /><CodeLine lineNumber="5349"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block so that we can later erase the resume block since it has no</span></CodeLine>
<Link id="l05350" /><CodeLine lineNumber="5350"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessors.</span></CodeLine>
<Link id="l05351" /><CodeLine lineNumber="5351"><span class="doxyHighlight">    TrivialBB-&gt;getTerminator()-&gt;eraseFromParent();</span></CodeLine>
<Link id="l05352" /><CodeLine lineNumber="5352"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(RI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), TrivialBB);</span></CodeLine>
<Link id="l05353" /><CodeLine lineNumber="5353"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l05354" /><CodeLine lineNumber="5354"><span class="doxyHighlight">      DTU-&gt;applyUpdates(&#123;&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, TrivialBB, BB&#125;&#125;);</span></CodeLine>
<Link id="l05355" /><CodeLine lineNumber="5355"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05356" /><CodeLine lineNumber="5356"></CodeLine>
<Link id="l05357" /><CodeLine lineNumber="5357"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Delete the resume block if all its predecessors have been removed.</span></CodeLine>
<Link id="l05358" /><CodeLine lineNumber="5358"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(BB))</span></CodeLine>
<Link id="l05359" /><CodeLine lineNumber="5359"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(BB, DTU);</span></CodeLine>
<Link id="l05360" /><CodeLine lineNumber="5360"></CodeLine>
<Link id="l05361" /><CodeLine lineNumber="5361"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !TrivialUnwindBlocks.empty();</span></CodeLine>
<Link id="l05362" /><CodeLine lineNumber="5362"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05363" /><CodeLine lineNumber="5363"></CodeLine>
<Link id="l05364" /><CodeLine lineNumber="5364"><span class="doxyHighlightComment">// Simplify resume that is only used by a single (non-phi) landing pad.</span></CodeLine>
<Link id="l05365" /><CodeLine lineNumber="5365"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifySingleResume(<a href="/docs/api/classes/llvm/resumeinst">ResumeInst</a> &#42;RI) &#123;</span></CodeLine>
<Link id="l05366" /><CodeLine lineNumber="5366"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = RI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l05367" /><CodeLine lineNumber="5367"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LPInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LandingPadInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>());</span></CodeLine>
<Link id="l05368" /><CodeLine lineNumber="5368"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RI-&gt;<a href="/docs/api/classes/llvm/resumeinst/#a796a53d6391a88b5280252cfed2f9615">getValue</a>() == LPInst &amp;&amp;</span></CodeLine>
<Link id="l05369" /><CodeLine lineNumber="5369"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Resume must unwind the exception that caused control to here&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05370" /><CodeLine lineNumber="5370"></CodeLine>
<Link id="l05371" /><CodeLine lineNumber="5371"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that there are no other instructions except for debug intrinsics.</span></CodeLine>
<Link id="l05372" /><CodeLine lineNumber="5372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a583f07468003b1c19e8227f1c0e63fb7">isCleanupBlockEmpty</a>(</span></CodeLine>
<Link id="l05373" /><CodeLine lineNumber="5373"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range&lt;Instruction &#42;&gt;</a>(LPInst-&gt;getNextNode(), RI)))</span></CodeLine>
<Link id="l05374" /><CodeLine lineNumber="5374"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05375" /><CodeLine lineNumber="5375"></CodeLine>
<Link id="l05376" /><CodeLine lineNumber="5376"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Turn all invokes that unwind here into calls and delete the basic block.</span></CodeLine>
<Link id="l05377" /><CodeLine lineNumber="5377"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB))) &#123;</span></CodeLine>
<Link id="l05378" /><CodeLine lineNumber="5378"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a83cbd0aa1465957c50eaea8374875b27">removeUnwindEdge</a>(Pred, DTU);</span></CodeLine>
<Link id="l05379" /><CodeLine lineNumber="5379"><span class="doxyHighlight">    ++NumInvokes;</span></CodeLine>
<Link id="l05380" /><CodeLine lineNumber="5380"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05381" /><CodeLine lineNumber="5381"></CodeLine>
<Link id="l05382" /><CodeLine lineNumber="5382"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The landingpad is now unreachable.  Zap it.</span></CodeLine>
<Link id="l05383" /><CodeLine lineNumber="5383"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(BB, DTU);</span></CodeLine>
<Link id="l05384" /><CodeLine lineNumber="5384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05385" /><CodeLine lineNumber="5385"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05386" /><CodeLine lineNumber="5386"></CodeLine>
<Link id="l05387" /><CodeLine lineNumber="5387" lineLink="#aedfe10b7b8a1008ddaa4104f54e0b483"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aedfe10b7b8a1008ddaa4104f54e0b483">removeEmptyCleanup</a>(<a href="/docs/api/classes/llvm/cleanupreturninst">CleanupReturnInst</a> &#42;RI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU) &#123;</span></CodeLine>
<Link id="l05388" /><CodeLine lineNumber="5388"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is a trivial cleanup pad that executes no instructions, it can be</span></CodeLine>
<Link id="l05389" /><CodeLine lineNumber="5389"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// eliminated.  If the cleanup pad continues to the caller, any predecessor</span></CodeLine>
<Link id="l05390" /><CodeLine lineNumber="5390"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that is an EH pad will be updated to continue to the caller and any</span></CodeLine>
<Link id="l05391" /><CodeLine lineNumber="5391"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor that terminates with an invoke instruction will have its invoke</span></CodeLine>
<Link id="l05392" /><CodeLine lineNumber="5392"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction converted to a call instruction.  If the cleanup pad being</span></CodeLine>
<Link id="l05393" /><CodeLine lineNumber="5393"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// simplified does not continue to the caller, each predecessor will be</span></CodeLine>
<Link id="l05394" /><CodeLine lineNumber="5394"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// updated to continue to the unwind destination of the cleanup pad being</span></CodeLine>
<Link id="l05395" /><CodeLine lineNumber="5395"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// simplified.</span></CodeLine>
<Link id="l05396" /><CodeLine lineNumber="5396"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = RI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l05397" /><CodeLine lineNumber="5397"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cleanuppadinst">CleanupPadInst</a> &#42;CPInst = RI-&gt;<a href="/docs/api/classes/llvm/cleanupreturninst/#a122380ccabb0e5c26e7c0e38f5c67235">getCleanupPad</a>();</span></CodeLine>
<Link id="l05398" /><CodeLine lineNumber="5398"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CPInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != BB)</span></CodeLine>
<Link id="l05399" /><CodeLine lineNumber="5399"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This isn&#39;t an empty cleanup.</span></CodeLine>
<Link id="l05400" /><CodeLine lineNumber="5400"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05401" /><CodeLine lineNumber="5401"></CodeLine>
<Link id="l05402" /><CodeLine lineNumber="5402"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We cannot kill the pad if it has multiple uses.  This typically arises</span></CodeLine>
<Link id="l05403" /><CodeLine lineNumber="5403"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from unreachable basic blocks.</span></CodeLine>
<Link id="l05404" /><CodeLine lineNumber="5404"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CPInst-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</span></CodeLine>
<Link id="l05405" /><CodeLine lineNumber="5405"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05406" /><CodeLine lineNumber="5406"></CodeLine>
<Link id="l05407" /><CodeLine lineNumber="5407"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that there are no other instructions except for benign intrinsics.</span></CodeLine>
<Link id="l05408" /><CodeLine lineNumber="5408"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a583f07468003b1c19e8227f1c0e63fb7">isCleanupBlockEmpty</a>(</span></CodeLine>
<Link id="l05409" /><CodeLine lineNumber="5409"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range&lt;Instruction &#42;&gt;</a>(CPInst-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>(), RI)))</span></CodeLine>
<Link id="l05410" /><CodeLine lineNumber="5410"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05411" /><CodeLine lineNumber="5411"></CodeLine>
<Link id="l05412" /><CodeLine lineNumber="5412"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the cleanup return we are simplifying unwinds to the caller, this will</span></CodeLine>
<Link id="l05413" /><CodeLine lineNumber="5413"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// set UnwindDest to nullptr.</span></CodeLine>
<Link id="l05414" /><CodeLine lineNumber="5414"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UnwindDest = RI-&gt;<a href="/docs/api/classes/llvm/cleanupreturninst/#a28752dcdba8534d4e32018a7a2bb289b">getUnwindDest</a>();</span></CodeLine>
<Link id="l05415" /><CodeLine lineNumber="5415"></CodeLine>
<Link id="l05416" /><CodeLine lineNumber="5416"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We&#39;re about to remove BB from the control flow.  Before we do, sink any</span></CodeLine>
<Link id="l05417" /><CodeLine lineNumber="5417"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHINodes into the unwind destination.  Doing this before changing the</span></CodeLine>
<Link id="l05418" /><CodeLine lineNumber="5418"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// control flow avoids some potentially slow checks, since we can currently</span></CodeLine>
<Link id="l05419" /><CodeLine lineNumber="5419"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be certain that UnwindDest and BB have no common predecessors (since they</span></CodeLine>
<Link id="l05420" /><CodeLine lineNumber="5420"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are both EH pads).</span></CodeLine>
<Link id="l05421" /><CodeLine lineNumber="5421"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UnwindDest) &#123;</span></CodeLine>
<Link id="l05422" /><CodeLine lineNumber="5422"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// First, go through the PHI nodes in UnwindDest and update any nodes that</span></CodeLine>
<Link id="l05423" /><CodeLine lineNumber="5423"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// reference the block we are removing</span></CodeLine>
<Link id="l05424" /><CodeLine lineNumber="5424"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;DestPN : UnwindDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l05425" /><CodeLine lineNumber="5425"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Idx = DestPN.getBasicBlockIndex(BB);</span></CodeLine>
<Link id="l05426" /><CodeLine lineNumber="5426"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Since BB unwinds to UnwindDest, it has to be in the PHI node.</span></CodeLine>
<Link id="l05427" /><CodeLine lineNumber="5427"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Idx != -1);</span></CodeLine>
<Link id="l05428" /><CodeLine lineNumber="5428"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This PHI node has an incoming value that corresponds to a control</span></CodeLine>
<Link id="l05429" /><CodeLine lineNumber="5429"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// path through the cleanup pad we are removing.  If the incoming</span></CodeLine>
<Link id="l05430" /><CodeLine lineNumber="5430"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// value is in the cleanup pad, it must be a PHINode (because we</span></CodeLine>
<Link id="l05431" /><CodeLine lineNumber="5431"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// verified above that the block is otherwise empty).  Otherwise, the</span></CodeLine>
<Link id="l05432" /><CodeLine lineNumber="5432"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// value is either a constant or a value that dominates the cleanup</span></CodeLine>
<Link id="l05433" /><CodeLine lineNumber="5433"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// pad being removed.</span></CodeLine>
<Link id="l05434" /><CodeLine lineNumber="5434"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l05435" /><CodeLine lineNumber="5435"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Because BB and UnwindDest are both EH pads, all of their</span></CodeLine>
<Link id="l05436" /><CodeLine lineNumber="5436"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// predecessors must unwind to these blocks, and since no instruction</span></CodeLine>
<Link id="l05437" /><CodeLine lineNumber="5437"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// can have multiple unwind destinations, there will be no overlap in</span></CodeLine>
<Link id="l05438" /><CodeLine lineNumber="5438"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// incoming blocks between SrcPN and DestPN.</span></CodeLine>
<Link id="l05439" /><CodeLine lineNumber="5439"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;SrcVal = DestPN.getIncomingValue(Idx);</span></CodeLine>
<Link id="l05440" /><CodeLine lineNumber="5440"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;SrcPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(SrcVal);</span></CodeLine>
<Link id="l05441" /><CodeLine lineNumber="5441"></CodeLine>
<Link id="l05442" /><CodeLine lineNumber="5442"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedPHITranslation = SrcPN &amp;&amp; SrcPN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == BB;</span></CodeLine>
<Link id="l05443" /><CodeLine lineNumber="5443"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l05444" /><CodeLine lineNumber="5444"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/llvm/incoming">Incoming</a> =</span></CodeLine>
<Link id="l05445" /><CodeLine lineNumber="5445"><span class="doxyHighlight">            NeedPHITranslation ? SrcPN-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(Pred) : SrcVal;</span></CodeLine>
<Link id="l05446" /><CodeLine lineNumber="5446"><span class="doxyHighlight">        DestPN.addIncoming(<a href="/docs/api/structs/llvm/incoming">Incoming</a>, Pred);</span></CodeLine>
<Link id="l05447" /><CodeLine lineNumber="5447"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05448" /><CodeLine lineNumber="5448"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05449" /><CodeLine lineNumber="5449"></CodeLine>
<Link id="l05450" /><CodeLine lineNumber="5450"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Sink any remaining PHI nodes directly into UnwindDest.</span></CodeLine>
<Link id="l05451" /><CodeLine lineNumber="5451"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt = UnwindDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>();</span></CodeLine>
<Link id="l05452" /><CodeLine lineNumber="5452"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>())) &#123;</span></CodeLine>
<Link id="l05453" /><CodeLine lineNumber="5453"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN.<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>() || !PN.<a href="/docs/api/classes/llvm/instruction/#a91dbffd0cc6b209fd2bfe9a0236d779c">isUsedOutsideOfBlock</a>(BB))</span></CodeLine>
<Link id="l05454" /><CodeLine lineNumber="5454"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the PHI node has no uses or all of its uses are in this basic</span></CodeLine>
<Link id="l05455" /><CodeLine lineNumber="5455"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// block (meaning they are debug or lifetime intrinsics), just leave</span></CodeLine>
<Link id="l05456" /><CodeLine lineNumber="5456"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// it.  It will be erased when we erase BB below.</span></CodeLine>
<Link id="l05457" /><CodeLine lineNumber="5457"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05458" /><CodeLine lineNumber="5458"></CodeLine>
<Link id="l05459" /><CodeLine lineNumber="5459"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Otherwise, sink this PHI node into UnwindDest.</span></CodeLine>
<Link id="l05460" /><CodeLine lineNumber="5460"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Any predecessors to UnwindDest which are not already represented</span></CodeLine>
<Link id="l05461" /><CodeLine lineNumber="5461"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// must be back edges which inherit the value from the path through</span></CodeLine>
<Link id="l05462" /><CodeLine lineNumber="5462"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// BB.  In this case, the PHI value must reference itself.</span></CodeLine>
<Link id="l05463" /><CodeLine lineNumber="5463"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagongenpredicate-cpp/#a0de1bf31f56b17312cc34b911d86faa4">pred</a> : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(UnwindDest))</span></CodeLine>
<Link id="l05464" /><CodeLine lineNumber="5464"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagongenpredicate-cpp/#a0de1bf31f56b17312cc34b911d86faa4">pred</a> != BB)</span></CodeLine>
<Link id="l05465" /><CodeLine lineNumber="5465"><span class="doxyHighlight">          PN.<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(&amp;PN, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagongenpredicate-cpp/#a0de1bf31f56b17312cc34b911d86faa4">pred</a>);</span></CodeLine>
<Link id="l05466" /><CodeLine lineNumber="5466"><span class="doxyHighlight">      PN.<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(InsertPt);</span></CodeLine>
<Link id="l05467" /><CodeLine lineNumber="5467"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Also, add a dummy incoming value for the original BB itself,</span></CodeLine>
<Link id="l05468" /><CodeLine lineNumber="5468"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// so that the PHI is well-formed until we drop said predecessor.</span></CodeLine>
<Link id="l05469" /><CodeLine lineNumber="5469"><span class="doxyHighlight">      PN.<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()), BB);</span></CodeLine>
<Link id="l05470" /><CodeLine lineNumber="5470"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05471" /><CodeLine lineNumber="5471"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05472" /><CodeLine lineNumber="5472"></CodeLine>
<Link id="l05473" /><CodeLine lineNumber="5473"><span class="doxyHighlight">  std::vector&lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l05474" /><CodeLine lineNumber="5474"></CodeLine>
<Link id="l05475" /><CodeLine lineNumber="5475"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We use make&#95;early&#95;inc&#95;range here because we will remove all predecessors.</span></CodeLine>
<Link id="l05476" /><CodeLine lineNumber="5476"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredBB : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB))) &#123;</span></CodeLine>
<Link id="l05477" /><CodeLine lineNumber="5477"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UnwindDest == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l05478" /><CodeLine lineNumber="5478"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l05479" /><CodeLine lineNumber="5479"><span class="doxyHighlight">        DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l05480" /><CodeLine lineNumber="5480"><span class="doxyHighlight">        Updates.clear();</span></CodeLine>
<Link id="l05481" /><CodeLine lineNumber="5481"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05482" /><CodeLine lineNumber="5482"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a83cbd0aa1465957c50eaea8374875b27">removeUnwindEdge</a>(PredBB, DTU);</span></CodeLine>
<Link id="l05483" /><CodeLine lineNumber="5483"><span class="doxyHighlight">      ++NumInvokes;</span></CodeLine>
<Link id="l05484" /><CodeLine lineNumber="5484"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05485" /><CodeLine lineNumber="5485"><span class="doxyHighlight">      BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(PredBB);</span></CodeLine>
<Link id="l05486" /><CodeLine lineNumber="5486"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI = PredBB-&gt;getTerminator();</span></CodeLine>
<Link id="l05487" /><CodeLine lineNumber="5487"><span class="doxyHighlight">      TI-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(BB, UnwindDest);</span></CodeLine>
<Link id="l05488" /><CodeLine lineNumber="5488"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l05489" /><CodeLine lineNumber="5489"><span class="doxyHighlight">        Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, PredBB, UnwindDest&#125;);</span></CodeLine>
<Link id="l05490" /><CodeLine lineNumber="5490"><span class="doxyHighlight">        Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, PredBB, BB&#125;);</span></CodeLine>
<Link id="l05491" /><CodeLine lineNumber="5491"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05492" /><CodeLine lineNumber="5492"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05493" /><CodeLine lineNumber="5493"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05494" /><CodeLine lineNumber="5494"></CodeLine>
<Link id="l05495" /><CodeLine lineNumber="5495"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l05496" /><CodeLine lineNumber="5496"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l05497" /><CodeLine lineNumber="5497"></CodeLine>
<Link id="l05498" /><CodeLine lineNumber="5498"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(BB, DTU);</span></CodeLine>
<Link id="l05499" /><CodeLine lineNumber="5499"></CodeLine>
<Link id="l05500" /><CodeLine lineNumber="5500"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05501" /><CodeLine lineNumber="5501"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05502" /><CodeLine lineNumber="5502"></CodeLine>
<Link id="l05503" /><CodeLine lineNumber="5503"><span class="doxyHighlightComment">// Try to merge two cleanuppads together.</span></CodeLine>
<Link id="l05504" /><CodeLine lineNumber="5504" lineLink="#a1f70470f7a7722fd55c58c81358107f2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a1f70470f7a7722fd55c58c81358107f2">mergeCleanupPad</a>(<a href="/docs/api/classes/llvm/cleanupreturninst">CleanupReturnInst</a> &#42;RI) &#123;</span></CodeLine>
<Link id="l05505" /><CodeLine lineNumber="5505"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Skip any cleanuprets which unwind to caller, there is nothing to merge</span></CodeLine>
<Link id="l05506" /><CodeLine lineNumber="5506"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with.</span></CodeLine>
<Link id="l05507" /><CodeLine lineNumber="5507"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UnwindDest = RI-&gt;<a href="/docs/api/classes/llvm/cleanupreturninst/#a28752dcdba8534d4e32018a7a2bb289b">getUnwindDest</a>();</span></CodeLine>
<Link id="l05508" /><CodeLine lineNumber="5508"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UnwindDest)</span></CodeLine>
<Link id="l05509" /><CodeLine lineNumber="5509"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05510" /><CodeLine lineNumber="5510"></CodeLine>
<Link id="l05511" /><CodeLine lineNumber="5511"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This cleanupret isn&#39;t the only predecessor of this cleanuppad, it wouldn&#39;t</span></CodeLine>
<Link id="l05512" /><CodeLine lineNumber="5512"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be safe to merge without code duplication.</span></CodeLine>
<Link id="l05513" /><CodeLine lineNumber="5513"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UnwindDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>() != RI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</span></CodeLine>
<Link id="l05514" /><CodeLine lineNumber="5514"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05515" /><CodeLine lineNumber="5515"></CodeLine>
<Link id="l05516" /><CodeLine lineNumber="5516"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Verify that our cleanuppad&#39;s unwind destination is another cleanuppad.</span></CodeLine>
<Link id="l05517" /><CodeLine lineNumber="5517"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SuccessorCleanupPad = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CleanupPadInst&gt;</a>(&amp;UnwindDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>());</span></CodeLine>
<Link id="l05518" /><CodeLine lineNumber="5518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SuccessorCleanupPad)</span></CodeLine>
<Link id="l05519" /><CodeLine lineNumber="5519"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05520" /><CodeLine lineNumber="5520"></CodeLine>
<Link id="l05521" /><CodeLine lineNumber="5521"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cleanuppadinst">CleanupPadInst</a> &#42;PredecessorCleanupPad = RI-&gt;<a href="/docs/api/classes/llvm/cleanupreturninst/#a122380ccabb0e5c26e7c0e38f5c67235">getCleanupPad</a>();</span></CodeLine>
<Link id="l05522" /><CodeLine lineNumber="5522"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace any uses of the successor cleanupad with the predecessor pad</span></CodeLine>
<Link id="l05523" /><CodeLine lineNumber="5523"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The only cleanuppad uses should be this cleanupret, it&#39;s cleanupret and</span></CodeLine>
<Link id="l05524" /><CodeLine lineNumber="5524"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// funclet bundle operands.</span></CodeLine>
<Link id="l05525" /><CodeLine lineNumber="5525"><span class="doxyHighlight">  SuccessorCleanupPad-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(PredecessorCleanupPad);</span></CodeLine>
<Link id="l05526" /><CodeLine lineNumber="5526"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove the old cleanuppad.</span></CodeLine>
<Link id="l05527" /><CodeLine lineNumber="5527"><span class="doxyHighlight">  SuccessorCleanupPad-&gt;eraseFromParent();</span></CodeLine>
<Link id="l05528" /><CodeLine lineNumber="5528"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now, we simply replace the cleanupret with a branch to the unwind</span></CodeLine>
<Link id="l05529" /><CodeLine lineNumber="5529"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// destination.</span></CodeLine>
<Link id="l05530" /><CodeLine lineNumber="5530"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(UnwindDest, RI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l05531" /><CodeLine lineNumber="5531"><span class="doxyHighlight">  RI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l05532" /><CodeLine lineNumber="5532"></CodeLine>
<Link id="l05533" /><CodeLine lineNumber="5533"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05534" /><CodeLine lineNumber="5534"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05535" /><CodeLine lineNumber="5535"></CodeLine>
<Link id="l05536" /><CodeLine lineNumber="5536"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyCleanupReturn(<a href="/docs/api/classes/llvm/cleanupreturninst">CleanupReturnInst</a> &#42;RI) &#123;</span></CodeLine>
<Link id="l05537" /><CodeLine lineNumber="5537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is possible to transiantly have an undef cleanuppad operand because we</span></CodeLine>
<Link id="l05538" /><CodeLine lineNumber="5538"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have deleted some, but not all, dead blocks.</span></CodeLine>
<Link id="l05539" /><CodeLine lineNumber="5539"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Eventually, this block will be deleted.</span></CodeLine>
<Link id="l05540" /><CodeLine lineNumber="5540"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(RI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)))</span></CodeLine>
<Link id="l05541" /><CodeLine lineNumber="5541"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05542" /><CodeLine lineNumber="5542"></CodeLine>
<Link id="l05543" /><CodeLine lineNumber="5543"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a1f70470f7a7722fd55c58c81358107f2">mergeCleanupPad</a>(RI))</span></CodeLine>
<Link id="l05544" /><CodeLine lineNumber="5544"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05545" /><CodeLine lineNumber="5545"></CodeLine>
<Link id="l05546" /><CodeLine lineNumber="5546"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aedfe10b7b8a1008ddaa4104f54e0b483">removeEmptyCleanup</a>(RI, DTU))</span></CodeLine>
<Link id="l05547" /><CodeLine lineNumber="5547"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05548" /><CodeLine lineNumber="5548"></CodeLine>
<Link id="l05549" /><CodeLine lineNumber="5549"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05550" /><CodeLine lineNumber="5550"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05551" /><CodeLine lineNumber="5551"></CodeLine>
<Link id="l05552" /><CodeLine lineNumber="5552"><span class="doxyHighlightComment">// WARNING: keep in sync with InstCombinerImpl::visitUnreachableInst()!</span></CodeLine>
<Link id="l05553" /><CodeLine lineNumber="5553"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyUnreachable(<a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a> &#42;UI) &#123;</span></CodeLine>
<Link id="l05554" /><CodeLine lineNumber="5554"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = UI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l05555" /><CodeLine lineNumber="5555"></CodeLine>
<Link id="l05556" /><CodeLine lineNumber="5556"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05557" /><CodeLine lineNumber="5557"></CodeLine>
<Link id="l05558" /><CodeLine lineNumber="5558"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ensure that any debug-info records that used to occur after the Unreachable</span></CodeLine>
<Link id="l05559" /><CodeLine lineNumber="5559"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are moved to in front of it -- otherwise they&#39;ll &quot;dangle&quot; at the end of</span></CodeLine>
<Link id="l05560" /><CodeLine lineNumber="5560"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the block.</span></CodeLine>
<Link id="l05561" /><CodeLine lineNumber="5561"><span class="doxyHighlight">  BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a7a7dc3732891611f559b06951a6ee85a">flushTerminatorDbgRecords</a>();</span></CodeLine>
<Link id="l05562" /><CodeLine lineNumber="5562"></CodeLine>
<Link id="l05563" /><CodeLine lineNumber="5563"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Debug-info records on the unreachable inst itself should be deleted, as</span></CodeLine>
<Link id="l05564" /><CodeLine lineNumber="5564"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// below we delete everything past the final executable instruction.</span></CodeLine>
<Link id="l05565" /><CodeLine lineNumber="5565"><span class="doxyHighlight">  UI-&gt;<a href="/docs/api/classes/llvm/instruction/#aef0129d256feb019adf09cd86b32ce91">dropDbgRecords</a>();</span></CodeLine>
<Link id="l05566" /><CodeLine lineNumber="5566"></CodeLine>
<Link id="l05567" /><CodeLine lineNumber="5567"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are any instructions immediately before the unreachable that can</span></CodeLine>
<Link id="l05568" /><CodeLine lineNumber="5568"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be removed, do so.</span></CodeLine>
<Link id="l05569" /><CodeLine lineNumber="5569"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (UI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>() != BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()) &#123;</span></CodeLine>
<Link id="l05570" /><CodeLine lineNumber="5570"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> BBI = UI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</span></CodeLine>
<Link id="l05571" /><CodeLine lineNumber="5571"><span class="doxyHighlight">    --BBI;</span></CodeLine>
<Link id="l05572" /><CodeLine lineNumber="5572"></CodeLine>
<Link id="l05573" /><CodeLine lineNumber="5573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(&amp;&#42;BBI))</span></CodeLine>
<Link id="l05574" /><CodeLine lineNumber="5574"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Can not drop any more instructions. We&#39;re done here.</span></CodeLine>
<Link id="l05575" /><CodeLine lineNumber="5575"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, this instruction can be freely erased,</span></CodeLine>
<Link id="l05576" /><CodeLine lineNumber="5576"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// even if it is not side-effect free.</span></CodeLine>
<Link id="l05577" /><CodeLine lineNumber="5577"></CodeLine>
<Link id="l05578" /><CodeLine lineNumber="5578"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that deleting EH&#39;s here is in fact okay, although it involves a bit</span></CodeLine>
<Link id="l05579" /><CodeLine lineNumber="5579"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of subtle reasoning. If this inst is an EH, all the predecessors of this</span></CodeLine>
<Link id="l05580" /><CodeLine lineNumber="5580"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block will be the unwind edges of Invoke/CatchSwitch/CleanupReturn,</span></CodeLine>
<Link id="l05581" /><CodeLine lineNumber="5581"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and we can therefore guarantee this block will be erased.</span></CodeLine>
<Link id="l05582" /><CodeLine lineNumber="5582"></CodeLine>
<Link id="l05583" /><CodeLine lineNumber="5583"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;re deleting this, we&#39;re deleting any subsequent debug info, so</span></CodeLine>
<Link id="l05584" /><CodeLine lineNumber="5584"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// delete DbgRecords.</span></CodeLine>
<Link id="l05585" /><CodeLine lineNumber="5585"><span class="doxyHighlight">    BBI-&gt;dropDbgRecords();</span></CodeLine>
<Link id="l05586" /><CodeLine lineNumber="5586"></CodeLine>
<Link id="l05587" /><CodeLine lineNumber="5587"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Delete this instruction (any uses are guaranteed to be dead)</span></CodeLine>
<Link id="l05588" /><CodeLine lineNumber="5588"><span class="doxyHighlight">    BBI-&gt;replaceAllUsesWith(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(BBI-&gt;getType()));</span></CodeLine>
<Link id="l05589" /><CodeLine lineNumber="5589"><span class="doxyHighlight">    BBI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l05590" /><CodeLine lineNumber="5590"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05591" /><CodeLine lineNumber="5591"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05592" /><CodeLine lineNumber="5592"></CodeLine>
<Link id="l05593" /><CodeLine lineNumber="5593"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the unreachable instruction is the first in the block, take a gander</span></CodeLine>
<Link id="l05594" /><CodeLine lineNumber="5594"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// at all of the predecessors of this instruction, and simplify them.</span></CodeLine>
<Link id="l05595" /><CodeLine lineNumber="5595"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>() != UI)</span></CodeLine>
<Link id="l05596" /><CodeLine lineNumber="5596"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l05597" /><CodeLine lineNumber="5597"></CodeLine>
<Link id="l05598" /><CodeLine lineNumber="5598"><span class="doxyHighlight">  std::vector&lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l05599" /><CodeLine lineNumber="5599"></CodeLine>
<Link id="l05600" /><CodeLine lineNumber="5600"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;BasicBlock &#42;, 8&gt;</a> Preds(<a href="/docs/api/namespaces/llvm/#ac3e549d97549636a7f08779d5cd98540">pred&#95;begin</a>(BB), <a href="/docs/api/namespaces/llvm/#a2103c335fa6ab933312c3871c82b0106">pred&#95;end</a>(BB));</span></CodeLine>
<Link id="l05601" /><CodeLine lineNumber="5601"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Predecessor : Preds) &#123;</span></CodeLine>
<Link id="l05602" /><CodeLine lineNumber="5602"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI = Predecessor-&gt;getTerminator();</span></CodeLine>
<Link id="l05603" /><CodeLine lineNumber="5603"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(TI);</span></CodeLine>
<Link id="l05604" /><CodeLine lineNumber="5604"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(TI)) &#123;</span></CodeLine>
<Link id="l05605" /><CodeLine lineNumber="5605"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We could either have a proper unconditional branch,</span></CodeLine>
<Link id="l05606" /><CodeLine lineNumber="5606"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// or a degenerate conditional branch with matching destinations.</span></CodeLine>
<Link id="l05607" /><CodeLine lineNumber="5607"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a254b2cfabe80269ee4f53f6698452db6">successors</a>(),</span></CodeLine>
<Link id="l05608" /><CodeLine lineNumber="5608"><span class="doxyHighlight">                 &#91;BB&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>) &#123; return Successor == BB; &#125;)) &#123;</span></CodeLine>
<Link id="l05609" /><CodeLine lineNumber="5609"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(TI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), TI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l05610" /><CodeLine lineNumber="5610"><span class="doxyHighlight">        TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l05611" /><CodeLine lineNumber="5611"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05612" /><CodeLine lineNumber="5612"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05613" /><CodeLine lineNumber="5613"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t get here with an uncond branch.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05614" /><CodeLine lineNumber="5614"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a>&#42; <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l05615" /><CodeLine lineNumber="5615"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) &amp;&amp;</span></CodeLine>
<Link id="l05616" /><CodeLine lineNumber="5616"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;The destinations are guaranteed to be different here.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05617" /><CodeLine lineNumber="5617"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;Assumption;</span></CodeLine>
<Link id="l05618" /><CodeLine lineNumber="5618"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BB) &#123;</span></CodeLine>
<Link id="l05619" /><CodeLine lineNumber="5619"><span class="doxyHighlight">          Assumption = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3e128b0b1ee770ce64350445c12492c7">CreateAssumption</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a89f675aadae7232445c74ee4167ff591">CreateNot</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>));</span></CodeLine>
<Link id="l05620" /><CodeLine lineNumber="5620"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1));</span></CodeLine>
<Link id="l05621" /><CodeLine lineNumber="5621"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05622" /><CodeLine lineNumber="5622"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) == BB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Incorrect CFG&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05623" /><CodeLine lineNumber="5623"><span class="doxyHighlight">          Assumption = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3e128b0b1ee770ce64350445c12492c7">CreateAssumption</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l05624" /><CodeLine lineNumber="5624"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0));</span></CodeLine>
<Link id="l05625" /><CodeLine lineNumber="5625"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05626" /><CodeLine lineNumber="5626"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.AC)</span></CodeLine>
<Link id="l05627" /><CodeLine lineNumber="5627"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.AC-&gt;registerAssumption(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;AssumeInst&gt;</a>(Assumption));</span></CodeLine>
<Link id="l05628" /><CodeLine lineNumber="5628"></CodeLine>
<Link id="l05629" /><CodeLine lineNumber="5629"><span class="doxyHighlight">        <a href="#aa9dd0c9b2a49c91d814102c1d0c7b09d">eraseTerminatorAndDCECond</a>(BI);</span></CodeLine>
<Link id="l05630" /><CodeLine lineNumber="5630"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05631" /><CodeLine lineNumber="5631"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05632" /><CodeLine lineNumber="5632"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l05633" /><CodeLine lineNumber="5633"><span class="doxyHighlight">        Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, Predecessor, BB&#125;);</span></CodeLine>
<Link id="l05634" /><CodeLine lineNumber="5634"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(TI)) &#123;</span></CodeLine>
<Link id="l05635" /><CodeLine lineNumber="5635"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/switchinstprofupdatewrapper">SwitchInstProfUpdateWrapper</a> SU(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l05636" /><CodeLine lineNumber="5636"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> i = SU-&gt;case&#95;begin(), e = SU-&gt;case&#95;end(); i != e;) &#123;</span></CodeLine>
<Link id="l05637" /><CodeLine lineNumber="5637"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (i-&gt;getCaseSuccessor() != BB) &#123;</span></CodeLine>
<Link id="l05638" /><CodeLine lineNumber="5638"><span class="doxyHighlight">          ++i;</span></CodeLine>
<Link id="l05639" /><CodeLine lineNumber="5639"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05640" /><CodeLine lineNumber="5640"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05641" /><CodeLine lineNumber="5641"><span class="doxyHighlight">        BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(SU-&gt;getParent());</span></CodeLine>
<Link id="l05642" /><CodeLine lineNumber="5642"><span class="doxyHighlight">        i = SU.removeCase(i);</span></CodeLine>
<Link id="l05643" /><CodeLine lineNumber="5643"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/numbers/#a92f4283d4e0e2ea1776894b3ae93640f">e</a> = SU-&gt;case&#95;end();</span></CodeLine>
<Link id="l05644" /><CodeLine lineNumber="5644"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05645" /><CodeLine lineNumber="5645"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05646" /><CodeLine lineNumber="5646"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Note that the default destination can&#39;t be removed!</span></CodeLine>
<Link id="l05647" /><CodeLine lineNumber="5647"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU &amp;&amp; <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest() != BB)</span></CodeLine>
<Link id="l05648" /><CodeLine lineNumber="5648"><span class="doxyHighlight">        Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, Predecessor, BB&#125;);</span></CodeLine>
<Link id="l05649" /><CodeLine lineNumber="5649"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(TI)) &#123;</span></CodeLine>
<Link id="l05650" /><CodeLine lineNumber="5650"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getUnwindDest() == BB) &#123;</span></CodeLine>
<Link id="l05651" /><CodeLine lineNumber="5651"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l05652" /><CodeLine lineNumber="5652"><span class="doxyHighlight">          DTU-&gt;applyUpdates(Updates);</span></CodeLine>
<Link id="l05653" /><CodeLine lineNumber="5653"><span class="doxyHighlight">          Updates.clear();</span></CodeLine>
<Link id="l05654" /><CodeLine lineNumber="5654"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05655" /><CodeLine lineNumber="5655"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#a83cbd0aa1465957c50eaea8374875b27">removeUnwindEdge</a>(TI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), DTU));</span></CodeLine>
<Link id="l05656" /><CodeLine lineNumber="5656"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CI-&gt;doesNotThrow())</span></CodeLine>
<Link id="l05657" /><CodeLine lineNumber="5657"><span class="doxyHighlight">          CI-&gt;setDoesNotThrow();</span></CodeLine>
<Link id="l05658" /><CodeLine lineNumber="5658"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05659" /><CodeLine lineNumber="5659"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05660" /><CodeLine lineNumber="5660"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CSI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CatchSwitchInst&gt;</a>(TI)) &#123;</span></CodeLine>
<Link id="l05661" /><CodeLine lineNumber="5661"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CSI-&gt;getUnwindDest() == BB) &#123;</span></CodeLine>
<Link id="l05662" /><CodeLine lineNumber="5662"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l05663" /><CodeLine lineNumber="5663"><span class="doxyHighlight">          DTU-&gt;applyUpdates(Updates);</span></CodeLine>
<Link id="l05664" /><CodeLine lineNumber="5664"><span class="doxyHighlight">          Updates.clear();</span></CodeLine>
<Link id="l05665" /><CodeLine lineNumber="5665"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05666" /><CodeLine lineNumber="5666"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a83cbd0aa1465957c50eaea8374875b27">removeUnwindEdge</a>(TI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), DTU);</span></CodeLine>
<Link id="l05667" /><CodeLine lineNumber="5667"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05668" /><CodeLine lineNumber="5668"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05669" /><CodeLine lineNumber="5669"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05670" /><CodeLine lineNumber="5670"></CodeLine>
<Link id="l05671" /><CodeLine lineNumber="5671"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/catchswitchinst/#a5f40b79e22fca07684580ea08af63746">CatchSwitchInst::handler&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = CSI-&gt;handler&#95;begin(),</span></CodeLine>
<Link id="l05672" /><CodeLine lineNumber="5672"><span class="doxyHighlight">                                             <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = CSI-&gt;handler&#95;end();</span></CodeLine>
<Link id="l05673" /><CodeLine lineNumber="5673"><span class="doxyHighlight">           <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l05674" /><CodeLine lineNumber="5674"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == BB) &#123;</span></CodeLine>
<Link id="l05675" /><CodeLine lineNumber="5675"><span class="doxyHighlight">          CSI-&gt;removeHandler(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05676" /><CodeLine lineNumber="5676"><span class="doxyHighlight">          --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l05677" /><CodeLine lineNumber="5677"><span class="doxyHighlight">          --<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;</span></CodeLine>
<Link id="l05678" /><CodeLine lineNumber="5678"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05679" /><CodeLine lineNumber="5679"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05680" /><CodeLine lineNumber="5680"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05681" /><CodeLine lineNumber="5681"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l05682" /><CodeLine lineNumber="5682"><span class="doxyHighlight">        Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, Predecessor, BB&#125;);</span></CodeLine>
<Link id="l05683" /><CodeLine lineNumber="5683"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CSI-&gt;getNumHandlers() == 0) &#123;</span></CodeLine>
<Link id="l05684" /><CodeLine lineNumber="5684"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CSI-&gt;hasUnwindDest()) &#123;</span></CodeLine>
<Link id="l05685" /><CodeLine lineNumber="5685"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Redirect all predecessors of the block containing CatchSwitchInst</span></CodeLine>
<Link id="l05686" /><CodeLine lineNumber="5686"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// to instead branch to the CatchSwitchInst&#39;s unwind destination.</span></CodeLine>
<Link id="l05687" /><CodeLine lineNumber="5687"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l05688" /><CodeLine lineNumber="5688"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PredecessorOfPredecessor : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Predecessor)) &#123;</span></CodeLine>
<Link id="l05689" /><CodeLine lineNumber="5689"><span class="doxyHighlight">              Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>,</span></CodeLine>
<Link id="l05690" /><CodeLine lineNumber="5690"><span class="doxyHighlight">                                 PredecessorOfPredecessor,</span></CodeLine>
<Link id="l05691" /><CodeLine lineNumber="5691"><span class="doxyHighlight">                                 CSI-&gt;getUnwindDest()&#125;);</span></CodeLine>
<Link id="l05692" /><CodeLine lineNumber="5692"><span class="doxyHighlight">              Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>,</span></CodeLine>
<Link id="l05693" /><CodeLine lineNumber="5693"><span class="doxyHighlight">                                 PredecessorOfPredecessor, Predecessor&#125;);</span></CodeLine>
<Link id="l05694" /><CodeLine lineNumber="5694"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l05695" /><CodeLine lineNumber="5695"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l05696" /><CodeLine lineNumber="5696"><span class="doxyHighlight">          Predecessor-&gt;replaceAllUsesWith(CSI-&gt;getUnwindDest());</span></CodeLine>
<Link id="l05697" /><CodeLine lineNumber="5697"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05698" /><CodeLine lineNumber="5698"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Rewrite all preds to unwind to caller (or from invoke to call).</span></CodeLine>
<Link id="l05699" /><CodeLine lineNumber="5699"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l05700" /><CodeLine lineNumber="5700"><span class="doxyHighlight">            DTU-&gt;applyUpdates(Updates);</span></CodeLine>
<Link id="l05701" /><CodeLine lineNumber="5701"><span class="doxyHighlight">            Updates.clear();</span></CodeLine>
<Link id="l05702" /><CodeLine lineNumber="5702"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l05703" /><CodeLine lineNumber="5703"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 8&gt;</a> EHPreds(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Predecessor));</span></CodeLine>
<Link id="l05704" /><CodeLine lineNumber="5704"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EHPred : EHPreds)</span></CodeLine>
<Link id="l05705" /><CodeLine lineNumber="5705"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a83cbd0aa1465957c50eaea8374875b27">removeUnwindEdge</a>(EHPred, DTU);</span></CodeLine>
<Link id="l05706" /><CodeLine lineNumber="5706"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05707" /><CodeLine lineNumber="5707"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The catchswitch is no longer reachable.</span></CodeLine>
<Link id="l05708" /><CodeLine lineNumber="5708"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(CSI-&gt;getContext(), CSI-&gt;getIterator());</span></CodeLine>
<Link id="l05709" /><CodeLine lineNumber="5709"><span class="doxyHighlight">        CSI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l05710" /><CodeLine lineNumber="5710"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05711" /><CodeLine lineNumber="5711"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05712" /><CodeLine lineNumber="5712"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CRI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CleanupReturnInst&gt;</a>(TI)) &#123;</span></CodeLine>
<Link id="l05713" /><CodeLine lineNumber="5713"><span class="doxyHighlight">      (void)CRI;</span></CodeLine>
<Link id="l05714" /><CodeLine lineNumber="5714"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CRI-&gt;hasUnwindDest() &amp;&amp; CRI-&gt;getUnwindDest() == BB &amp;&amp;</span></CodeLine>
<Link id="l05715" /><CodeLine lineNumber="5715"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Expected to always have an unwind to BB.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05716" /><CodeLine lineNumber="5716"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l05717" /><CodeLine lineNumber="5717"><span class="doxyHighlight">        Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, Predecessor, BB&#125;);</span></CodeLine>
<Link id="l05718" /><CodeLine lineNumber="5718"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(TI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), TI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l05719" /><CodeLine lineNumber="5719"><span class="doxyHighlight">      TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l05720" /><CodeLine lineNumber="5720"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05721" /><CodeLine lineNumber="5721"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05722" /><CodeLine lineNumber="5722"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05723" /><CodeLine lineNumber="5723"></CodeLine>
<Link id="l05724" /><CodeLine lineNumber="5724"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l05725" /><CodeLine lineNumber="5725"><span class="doxyHighlight">    DTU-&gt;applyUpdates(Updates);</span></CodeLine>
<Link id="l05726" /><CodeLine lineNumber="5726"></CodeLine>
<Link id="l05727" /><CodeLine lineNumber="5727"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this block is now dead, remove it.</span></CodeLine>
<Link id="l05728" /><CodeLine lineNumber="5728"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(BB) &amp;&amp; BB != &amp;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>()) &#123;</span></CodeLine>
<Link id="l05729" /><CodeLine lineNumber="5729"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(BB, DTU);</span></CodeLine>
<Link id="l05730" /><CodeLine lineNumber="5730"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05731" /><CodeLine lineNumber="5731"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05732" /><CodeLine lineNumber="5732"></CodeLine>
<Link id="l05733" /><CodeLine lineNumber="5733"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l05734" /><CodeLine lineNumber="5734"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05735" /><CodeLine lineNumber="5735"></CodeLine>
<Link id="l05736" /><CodeLine lineNumber="5736" lineLink="#a7e7374e59505b56b9bf65507fb90dd40"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a7e7374e59505b56b9bf65507fb90dd40">casesAreContiguous</a>(<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;ConstantInt &#42;&gt;</a> &amp;Cases) &#123;</span></CodeLine>
<Link id="l05737" /><CodeLine lineNumber="5737"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cases.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt;= 1);</span></CodeLine>
<Link id="l05738" /><CodeLine lineNumber="5738"></CodeLine>
<Link id="l05739" /><CodeLine lineNumber="5739"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#add1eb5637dd671428b6f138ed3db6428">array&#95;pod&#95;sort</a>(Cases.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Cases.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>(), <a href="#a2ab3a1c5bf0fff25a3254622107b9c9f">constantIntSortPredicate</a>);</span></CodeLine>
<Link id="l05740" /><CodeLine lineNumber="5740"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 1, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Cases.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l05741" /><CodeLine lineNumber="5741"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cases&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1&#93;-&gt;getValue() != Cases&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;-&gt;getValue() + 1)</span></CodeLine>
<Link id="l05742" /><CodeLine lineNumber="5742"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05743" /><CodeLine lineNumber="5743"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05744" /><CodeLine lineNumber="5744"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05745" /><CodeLine lineNumber="5745"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05746" /><CodeLine lineNumber="5746"></CodeLine>
<Link id="l05747" /><CodeLine lineNumber="5747" lineLink="#a7aa8025f73f4e06135e6ba7083ad7aab"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a7aa8025f73f4e06135e6ba7083ad7aab">createUnreachableSwitchDefault</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;Switch,</span></CodeLine>
<Link id="l05748" /><CodeLine lineNumber="5748"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU,</span></CodeLine>
<Link id="l05749" /><CodeLine lineNumber="5749"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RemoveOrigDefaultBlock = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l05750" /><CodeLine lineNumber="5750"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;SimplifyCFG: switch default is dead.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05751" /><CodeLine lineNumber="5751"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB = Switch-&gt;getParent();</span></CodeLine>
<Link id="l05752" /><CodeLine lineNumber="5752"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OrigDefaultBlock = Switch-&gt;getDefaultDest();</span></CodeLine>
<Link id="l05753" /><CodeLine lineNumber="5753"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RemoveOrigDefaultBlock)</span></CodeLine>
<Link id="l05754" /><CodeLine lineNumber="5754"><span class="doxyHighlight">    OrigDefaultBlock-&gt;removePredecessor(BB);</span></CodeLine>
<Link id="l05755" /><CodeLine lineNumber="5755"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewDefaultBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l05756" /><CodeLine lineNumber="5756"><span class="doxyHighlight">      BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.unreachabledefault&quot;</span><span class="doxyHighlight">, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(),</span></CodeLine>
<Link id="l05757" /><CodeLine lineNumber="5757"><span class="doxyHighlight">      OrigDefaultBlock);</span></CodeLine>
<Link id="l05758" /><CodeLine lineNumber="5758"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(Switch-&gt;getContext(), NewDefaultBlock);</span></CodeLine>
<Link id="l05759" /><CodeLine lineNumber="5759"><span class="doxyHighlight">  Switch-&gt;setDefaultDest(&amp;&#42;NewDefaultBlock);</span></CodeLine>
<Link id="l05760" /><CodeLine lineNumber="5760"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l05761" /><CodeLine lineNumber="5761"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType, 2&gt;</a> Updates;</span></CodeLine>
<Link id="l05762" /><CodeLine lineNumber="5762"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, BB, &amp;&#42;NewDefaultBlock&#125;);</span></CodeLine>
<Link id="l05763" /><CodeLine lineNumber="5763"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RemoveOrigDefaultBlock &amp;&amp;</span></CodeLine>
<Link id="l05764" /><CodeLine lineNumber="5764"><span class="doxyHighlight">        !<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB), OrigDefaultBlock))</span></CodeLine>
<Link id="l05765" /><CodeLine lineNumber="5765"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, &amp;&#42;OrigDefaultBlock&#125;);</span></CodeLine>
<Link id="l05766" /><CodeLine lineNumber="5766"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l05767" /><CodeLine lineNumber="5767"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05768" /><CodeLine lineNumber="5768"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05769" /><CodeLine lineNumber="5769"></CodeLine>
<Link id="l05770" /><CodeLine lineNumber="5770"><span class="doxyHighlightComment">/// Turn a switch into an integer range comparison and branch.</span></CodeLine>
<Link id="l05771" /><CodeLine lineNumber="5771"><span class="doxyHighlightComment">/// Switches with more than 2 destinations are ignored.</span></CodeLine>
<Link id="l05772" /><CodeLine lineNumber="5772"><span class="doxyHighlightComment">/// Switches with 1 destination are also ignored.</span></CodeLine>
<Link id="l05773" /><CodeLine lineNumber="5773"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::turnSwitchRangeIntoICmp(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>,</span></CodeLine>
<Link id="l05774" /><CodeLine lineNumber="5774"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l05775" /><CodeLine lineNumber="5775"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases() &gt; 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Degenerate switch?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05776" /><CodeLine lineNumber="5776"></CodeLine>
<Link id="l05777" /><CodeLine lineNumber="5777"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasDefault =</span></CodeLine>
<Link id="l05778" /><CodeLine lineNumber="5778"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UnreachableInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest()-&gt;getFirstNonPHIOrDbg());</span></CodeLine>
<Link id="l05779" /><CodeLine lineNumber="5779"></CodeLine>
<Link id="l05780" /><CodeLine lineNumber="5780"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent();</span></CodeLine>
<Link id="l05781" /><CodeLine lineNumber="5781"></CodeLine>
<Link id="l05782" /><CodeLine lineNumber="5782"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Partition the cases into two sets with different destinations.</span></CodeLine>
<Link id="l05783" /><CodeLine lineNumber="5783"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestA = HasDefault ? <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest() : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05784" /><CodeLine lineNumber="5784"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05785" /><CodeLine lineNumber="5785"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ConstantInt &#42;, 16&gt;</a> CasesA;</span></CodeLine>
<Link id="l05786" /><CodeLine lineNumber="5786"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ConstantInt &#42;, 16&gt;</a> CasesB;</span></CodeLine>
<Link id="l05787" /><CodeLine lineNumber="5787"></CodeLine>
<Link id="l05788" /><CodeLine lineNumber="5788"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l05789" /><CodeLine lineNumber="5789"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dest = Case.getCaseSuccessor();</span></CodeLine>
<Link id="l05790" /><CodeLine lineNumber="5790"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DestA)</span></CodeLine>
<Link id="l05791" /><CodeLine lineNumber="5791"><span class="doxyHighlight">      DestA = Dest;</span></CodeLine>
<Link id="l05792" /><CodeLine lineNumber="5792"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Dest == DestA) &#123;</span></CodeLine>
<Link id="l05793" /><CodeLine lineNumber="5793"><span class="doxyHighlight">      CasesA.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Case.getCaseValue());</span></CodeLine>
<Link id="l05794" /><CodeLine lineNumber="5794"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05795" /><CodeLine lineNumber="5795"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05796" /><CodeLine lineNumber="5796"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DestB)</span></CodeLine>
<Link id="l05797" /><CodeLine lineNumber="5797"><span class="doxyHighlight">      DestB = Dest;</span></CodeLine>
<Link id="l05798" /><CodeLine lineNumber="5798"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Dest == DestB) &#123;</span></CodeLine>
<Link id="l05799" /><CodeLine lineNumber="5799"><span class="doxyHighlight">      CasesB.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Case.getCaseValue());</span></CodeLine>
<Link id="l05800" /><CodeLine lineNumber="5800"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05801" /><CodeLine lineNumber="5801"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05802" /><CodeLine lineNumber="5802"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// More than two destinations.</span></CodeLine>
<Link id="l05803" /><CodeLine lineNumber="5803"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05804" /><CodeLine lineNumber="5804"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DestB)</span></CodeLine>
<Link id="l05805" /><CodeLine lineNumber="5805"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// All destinations are the same and the default is unreachable</span></CodeLine>
<Link id="l05806" /><CodeLine lineNumber="5806"></CodeLine>
<Link id="l05807" /><CodeLine lineNumber="5807"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DestA &amp;&amp; DestB &amp;&amp;</span></CodeLine>
<Link id="l05808" /><CodeLine lineNumber="5808"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Single-destination switch should have been folded.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05809" /><CodeLine lineNumber="5809"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DestA != DestB);</span></CodeLine>
<Link id="l05810" /><CodeLine lineNumber="5810"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DestB != <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest());</span></CodeLine>
<Link id="l05811" /><CodeLine lineNumber="5811"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!CasesB.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There must be non-default cases.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05812" /><CodeLine lineNumber="5812"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!CasesA.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() || HasDefault);</span></CodeLine>
<Link id="l05813" /><CodeLine lineNumber="5813"></CodeLine>
<Link id="l05814" /><CodeLine lineNumber="5814"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Figure out if one of the sets of cases form a contiguous range.</span></CodeLine>
<Link id="l05815" /><CodeLine lineNumber="5815"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;ConstantInt &#42;&gt;</a> &#42;ContiguousCases = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05816" /><CodeLine lineNumber="5816"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ContiguousDest = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05817" /><CodeLine lineNumber="5817"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OtherDest = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05818" /><CodeLine lineNumber="5818"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CasesA.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; <a href="#a7e7374e59505b56b9bf65507fb90dd40">casesAreContiguous</a>(CasesA)) &#123;</span></CodeLine>
<Link id="l05819" /><CodeLine lineNumber="5819"><span class="doxyHighlight">    ContiguousCases = &amp;CasesA;</span></CodeLine>
<Link id="l05820" /><CodeLine lineNumber="5820"><span class="doxyHighlight">    ContiguousDest = DestA;</span></CodeLine>
<Link id="l05821" /><CodeLine lineNumber="5821"><span class="doxyHighlight">    OtherDest = DestB;</span></CodeLine>
<Link id="l05822" /><CodeLine lineNumber="5822"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a7e7374e59505b56b9bf65507fb90dd40">casesAreContiguous</a>(CasesB)) &#123;</span></CodeLine>
<Link id="l05823" /><CodeLine lineNumber="5823"><span class="doxyHighlight">    ContiguousCases = &amp;CasesB;</span></CodeLine>
<Link id="l05824" /><CodeLine lineNumber="5824"><span class="doxyHighlight">    ContiguousDest = DestB;</span></CodeLine>
<Link id="l05825" /><CodeLine lineNumber="5825"><span class="doxyHighlight">    OtherDest = DestA;</span></CodeLine>
<Link id="l05826" /><CodeLine lineNumber="5826"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05827" /><CodeLine lineNumber="5827"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05828" /><CodeLine lineNumber="5828"></CodeLine>
<Link id="l05829" /><CodeLine lineNumber="5829"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Start building the compare and branch.</span></CodeLine>
<Link id="l05830" /><CodeLine lineNumber="5830"></CodeLine>
<Link id="l05831" /><CodeLine lineNumber="5831"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = <a href="/docs/api/classes/llvm/constantexpr/#aefdfcd6977f799b0f35e93d75114121c">ConstantExpr::getNeg</a>(ContiguousCases-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>());</span></CodeLine>
<Link id="l05832" /><CodeLine lineNumber="5832"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;NumCases =</span></CodeLine>
<Link id="l05833" /><CodeLine lineNumber="5833"><span class="doxyHighlight">      ConstantInt::get(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>-&gt;getType(), ContiguousCases-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</span></CodeLine>
<Link id="l05834" /><CodeLine lineNumber="5834"></CodeLine>
<Link id="l05835" /><CodeLine lineNumber="5835"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Sub = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l05836" /><CodeLine lineNumber="5836"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>-&gt;isNullValue())</span></CodeLine>
<Link id="l05837" /><CodeLine lineNumber="5837"><span class="doxyHighlight">    Sub = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(Sub, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, Sub-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.off&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05838" /><CodeLine lineNumber="5838"></CodeLine>
<Link id="l05839" /><CodeLine lineNumber="5839"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>;</span></CodeLine>
<Link id="l05840" /><CodeLine lineNumber="5840"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If NumCases overflowed, then all possible values jump to the successor.</span></CodeLine>
<Link id="l05841" /><CodeLine lineNumber="5841"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumCases-&gt;<a href="/docs/api/classes/llvm/constant/#ae4b6abe77abf42fb02081a6cc41a0132">isNullValue</a>() &amp;&amp; !ContiguousCases-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l05842" /><CodeLine lineNumber="5842"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getContext());</span></CodeLine>
<Link id="l05843" /><CodeLine lineNumber="5843"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05844" /><CodeLine lineNumber="5844"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a09b4daefdf5b73efba51ce7ae6cd45c5">CreateICmpULT</a>(Sub, NumCases, </span><span class="doxyHighlightStringLiteral">&quot;switch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05845" /><CodeLine lineNumber="5845"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;NewBI = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(Cmp, ContiguousDest, OtherDest);</span></CodeLine>
<Link id="l05846" /><CodeLine lineNumber="5846"></CodeLine>
<Link id="l05847" /><CodeLine lineNumber="5847"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update weight for the newly-created conditional branch.</span></CodeLine>
<Link id="l05848" /><CodeLine lineNumber="5848"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>)) &#123;</span></CodeLine>
<Link id="l05849" /><CodeLine lineNumber="5849"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint64&#95;t, 8&gt;</a> Weights;</span></CodeLine>
<Link id="l05850" /><CodeLine lineNumber="5850"><span class="doxyHighlight">    <a href="#ad3e63520dcd2b8f8aa1b2e66e734a575">getBranchWeights</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, Weights);</span></CodeLine>
<Link id="l05851" /><CodeLine lineNumber="5851"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Weights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 1 + <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases()) &#123;</span></CodeLine>
<Link id="l05852" /><CodeLine lineNumber="5852"><span class="doxyHighlight">      uint64&#95;t TrueWeight = 0;</span></CodeLine>
<Link id="l05853" /><CodeLine lineNumber="5853"><span class="doxyHighlight">      uint64&#95;t FalseWeight = 0;</span></CodeLine>
<Link id="l05854" /><CodeLine lineNumber="5854"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Weights.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l05855" /><CodeLine lineNumber="5855"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getSuccessor(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) == ContiguousDest)</span></CodeLine>
<Link id="l05856" /><CodeLine lineNumber="5856"><span class="doxyHighlight">          TrueWeight += Weights&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l05857" /><CodeLine lineNumber="5857"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05858" /><CodeLine lineNumber="5858"><span class="doxyHighlight">          FalseWeight += Weights&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l05859" /><CodeLine lineNumber="5859"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05860" /><CodeLine lineNumber="5860"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (TrueWeight &gt; UINT32&#95;MAX || FalseWeight &gt; UINT32&#95;MAX) &#123;</span></CodeLine>
<Link id="l05861" /><CodeLine lineNumber="5861"><span class="doxyHighlight">        TrueWeight /= 2;</span></CodeLine>
<Link id="l05862" /><CodeLine lineNumber="5862"><span class="doxyHighlight">        FalseWeight /= 2;</span></CodeLine>
<Link id="l05863" /><CodeLine lineNumber="5863"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05864" /><CodeLine lineNumber="5864"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(NewBI, TrueWeight, FalseWeight, </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05865" /><CodeLine lineNumber="5865"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05866" /><CodeLine lineNumber="5866"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05867" /><CodeLine lineNumber="5867"></CodeLine>
<Link id="l05868" /><CodeLine lineNumber="5868"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Prune obsolete incoming values off the successors&#39; PHI nodes.</span></CodeLine>
<Link id="l05869" /><CodeLine lineNumber="5869"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BBI = ContiguousDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(BBI); ++BBI) &#123;</span></CodeLine>
<Link id="l05870" /><CodeLine lineNumber="5870"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PreviousEdges = ContiguousCases-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l05871" /><CodeLine lineNumber="5871"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ContiguousDest == <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest())</span></CodeLine>
<Link id="l05872" /><CodeLine lineNumber="5872"><span class="doxyHighlight">      ++PreviousEdges;</span></CodeLine>
<Link id="l05873" /><CodeLine lineNumber="5873"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = PreviousEdges - 1; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l05874" /><CodeLine lineNumber="5874"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(BBI)-&gt;removeIncomingValue(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent());</span></CodeLine>
<Link id="l05875" /><CodeLine lineNumber="5875"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05876" /><CodeLine lineNumber="5876"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BBI = OtherDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(BBI); ++BBI) &#123;</span></CodeLine>
<Link id="l05877" /><CodeLine lineNumber="5877"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PreviousEdges = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases() - ContiguousCases-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l05878" /><CodeLine lineNumber="5878"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OtherDest == <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest())</span></CodeLine>
<Link id="l05879" /><CodeLine lineNumber="5879"><span class="doxyHighlight">      ++PreviousEdges;</span></CodeLine>
<Link id="l05880" /><CodeLine lineNumber="5880"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = PreviousEdges - 1; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l05881" /><CodeLine lineNumber="5881"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(BBI)-&gt;removeIncomingValue(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent());</span></CodeLine>
<Link id="l05882" /><CodeLine lineNumber="5882"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05883" /><CodeLine lineNumber="5883"></CodeLine>
<Link id="l05884" /><CodeLine lineNumber="5884"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clean up the default block - it may have phis or other instructions before</span></CodeLine>
<Link id="l05885" /><CodeLine lineNumber="5885"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the unreachable terminator.</span></CodeLine>
<Link id="l05886" /><CodeLine lineNumber="5886"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasDefault)</span></CodeLine>
<Link id="l05887" /><CodeLine lineNumber="5887"><span class="doxyHighlight">    <a href="#a7aa8025f73f4e06135e6ba7083ad7aab">createUnreachableSwitchDefault</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, DTU);</span></CodeLine>
<Link id="l05888" /><CodeLine lineNumber="5888"></CodeLine>
<Link id="l05889" /><CodeLine lineNumber="5889"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UnreachableDefault = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest();</span></CodeLine>
<Link id="l05890" /><CodeLine lineNumber="5890"></CodeLine>
<Link id="l05891" /><CodeLine lineNumber="5891"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Drop the switch.</span></CodeLine>
<Link id="l05892" /><CodeLine lineNumber="5892"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l05893" /><CodeLine lineNumber="5893"></CodeLine>
<Link id="l05894" /><CodeLine lineNumber="5894"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasDefault &amp;&amp; DTU)</span></CodeLine>
<Link id="l05895" /><CodeLine lineNumber="5895"><span class="doxyHighlight">    DTU-&gt;applyUpdates(&#123;&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, UnreachableDefault&#125;&#125;);</span></CodeLine>
<Link id="l05896" /><CodeLine lineNumber="5896"></CodeLine>
<Link id="l05897" /><CodeLine lineNumber="5897"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05898" /><CodeLine lineNumber="5898"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05899" /><CodeLine lineNumber="5899"></CodeLine>
<Link id="l05900" /><CodeLine lineNumber="5900"><span class="doxyHighlightComment">/// Compute masked bits for the condition of a switch</span></CodeLine>
<Link id="l05901" /><CodeLine lineNumber="5901"><span class="doxyHighlightComment">/// and use it to remove dead cases.</span></CodeLine>
<Link id="l05902" /><CodeLine lineNumber="5902" lineLink="#a83b0a34d940365e97b9a531c1f13f3b9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a83b0a34d940365e97b9a531c1f13f3b9">eliminateDeadSwitchCases</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU,</span></CodeLine>
<Link id="l05903" /><CodeLine lineNumber="5903"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l05904" /><CodeLine lineNumber="5904"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l05905" /><CodeLine lineNumber="5905"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l05906" /><CodeLine lineNumber="5906"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/knownbits">KnownBits</a> Known = <a href="/docs/api/namespaces/llvm/#ab2c2c51743fb4a1b17c59563909f3f24">computeKnownBits</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, 0, AC, <a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l05907" /><CodeLine lineNumber="5907"></CodeLine>
<Link id="l05908" /><CodeLine lineNumber="5908"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can also eliminate cases by determining that their values are outside of</span></CodeLine>
<Link id="l05909" /><CodeLine lineNumber="5909"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the limited range of the condition based on how many significant (non-sign)</span></CodeLine>
<Link id="l05910" /><CodeLine lineNumber="5910"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bits are in the condition value.</span></CodeLine>
<Link id="l05911" /><CodeLine lineNumber="5911"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxSignificantBitsInCond =</span></CodeLine>
<Link id="l05912" /><CodeLine lineNumber="5912"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ae95177e7337984f5bc961723ecf67169">ComputeMaxSignificantBits</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, 0, AC, <a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l05913" /><CodeLine lineNumber="5913"></CodeLine>
<Link id="l05914" /><CodeLine lineNumber="5914"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Gather dead cases.</span></CodeLine>
<Link id="l05915" /><CodeLine lineNumber="5915"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ConstantInt &#42;, 8&gt;</a> DeadCases;</span></CodeLine>
<Link id="l05916" /><CodeLine lineNumber="5916"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;BasicBlock &#42;, int, 8&gt;</a> NumPerSuccessorCases;</span></CodeLine>
<Link id="l05917" /><CodeLine lineNumber="5917"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 8&gt;</a> UniqueSuccessors;</span></CodeLine>
<Link id="l05918" /><CodeLine lineNumber="5918"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l05919" /><CodeLine lineNumber="5919"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a> = Case.getCaseSuccessor();</span></CodeLine>
<Link id="l05920" /><CodeLine lineNumber="5920"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l05921" /><CodeLine lineNumber="5921"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NumPerSuccessorCases.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>))</span></CodeLine>
<Link id="l05922" /><CodeLine lineNumber="5922"><span class="doxyHighlight">        UniqueSuccessors.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>);</span></CodeLine>
<Link id="l05923" /><CodeLine lineNumber="5923"><span class="doxyHighlight">      ++NumPerSuccessorCases&#91;<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>&#93;;</span></CodeLine>
<Link id="l05924" /><CodeLine lineNumber="5924"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05925" /><CodeLine lineNumber="5925"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;CaseVal = Case.getCaseValue()-&gt;getValue();</span></CodeLine>
<Link id="l05926" /><CodeLine lineNumber="5926"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Known.<a href="/docs/api/structs/llvm/knownbits/#ac67bca6c764da76f5e152330d92ed916">Zero</a>.<a href="/docs/api/classes/llvm/apint/#a6da514c588b2668280a861a59bfc9fa5">intersects</a>(CaseVal) || !Known.<a href="/docs/api/structs/llvm/knownbits/#aba205f553f24c184ea47fc1a6cb56537">One</a>.<a href="/docs/api/classes/llvm/apint/#acfae9bdee6027ffa8ffe244cc22e3a76">isSubsetOf</a>(CaseVal) ||</span></CodeLine>
<Link id="l05927" /><CodeLine lineNumber="5927"><span class="doxyHighlight">        (CaseVal.<a href="/docs/api/classes/llvm/apint/#a9f78d7e839322a6bfc0c665d29052242">getSignificantBits</a>() &gt; MaxSignificantBitsInCond)) &#123;</span></CodeLine>
<Link id="l05928" /><CodeLine lineNumber="5928"><span class="doxyHighlight">      DeadCases.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Case.getCaseValue());</span></CodeLine>
<Link id="l05929" /><CodeLine lineNumber="5929"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l05930" /><CodeLine lineNumber="5930"><span class="doxyHighlight">        --NumPerSuccessorCases&#91;<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>&#93;;</span></CodeLine>
<Link id="l05931" /><CodeLine lineNumber="5931"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;SimplifyCFG: switch case &quot;</span><span class="doxyHighlight"> &lt;&lt; CaseVal</span></CodeLine>
<Link id="l05932" /><CodeLine lineNumber="5932"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; is dead.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05933" /><CodeLine lineNumber="5933"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05934" /><CodeLine lineNumber="5934"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05935" /><CodeLine lineNumber="5935"></CodeLine>
<Link id="l05936" /><CodeLine lineNumber="5936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we can prove that the cases must cover all possible values, the</span></CodeLine>
<Link id="l05937" /><CodeLine lineNumber="5937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// default destination becomes dead and we can remove it.  If we know some</span></CodeLine>
<Link id="l05938" /><CodeLine lineNumber="5938"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the bits in the value, we can use that to more precisely compute the</span></CodeLine>
<Link id="l05939" /><CodeLine lineNumber="5939"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// number of possible unique case values.</span></CodeLine>
<Link id="l05940" /><CodeLine lineNumber="5940"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasDefault =</span></CodeLine>
<Link id="l05941" /><CodeLine lineNumber="5941"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UnreachableInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest()-&gt;getFirstNonPHIOrDbg());</span></CodeLine>
<Link id="l05942" /><CodeLine lineNumber="5942"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumUnknownBits =</span></CodeLine>
<Link id="l05943" /><CodeLine lineNumber="5943"><span class="doxyHighlight">      Known.<a href="/docs/api/structs/llvm/knownbits/#a4fdc09049a61f952b5d52788dbd2f69b">getBitWidth</a>() - (Known.<a href="/docs/api/structs/llvm/knownbits/#ac67bca6c764da76f5e152330d92ed916">Zero</a> | Known.<a href="/docs/api/structs/llvm/knownbits/#aba205f553f24c184ea47fc1a6cb56537">One</a>).<a href="/docs/api/namespaces/llvm/#a0eea77e7bfa82e0219d2ec7b4efbc94f">popcount</a>();</span></CodeLine>
<Link id="l05944" /><CodeLine lineNumber="5944"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumUnknownBits &lt;= Known.<a href="/docs/api/structs/llvm/knownbits/#a4fdc09049a61f952b5d52788dbd2f69b">getBitWidth</a>());</span></CodeLine>
<Link id="l05945" /><CodeLine lineNumber="5945"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasDefault &amp;&amp; DeadCases.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp;</span></CodeLine>
<Link id="l05946" /><CodeLine lineNumber="5946"><span class="doxyHighlight">      NumUnknownBits &lt; 64 </span><span class="doxyHighlightComment">/&#42; avoid overflow &#42;/</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l05947" /><CodeLine lineNumber="5947"><span class="doxyHighlight">    uint64&#95;t AllNumCases = 1ULL &lt;&lt; NumUnknownBits;</span></CodeLine>
<Link id="l05948" /><CodeLine lineNumber="5948"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases() == AllNumCases) &#123;</span></CodeLine>
<Link id="l05949" /><CodeLine lineNumber="5949"><span class="doxyHighlight">      <a href="#a7aa8025f73f4e06135e6ba7083ad7aab">createUnreachableSwitchDefault</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, DTU);</span></CodeLine>
<Link id="l05950" /><CodeLine lineNumber="5950"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05951" /><CodeLine lineNumber="5951"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05952" /><CodeLine lineNumber="5952"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// When only one case value is missing, replace default with that case.</span></CodeLine>
<Link id="l05953" /><CodeLine lineNumber="5953"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Eliminating the default branch will provide more opportunities for</span></CodeLine>
<Link id="l05954" /><CodeLine lineNumber="5954"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// optimization, such as lookup tables.</span></CodeLine>
<Link id="l05955" /><CodeLine lineNumber="5955"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases() == AllNumCases - 1) &#123;</span></CodeLine>
<Link id="l05956" /><CodeLine lineNumber="5956"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumUnknownBits &gt; 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Should be canonicalized to a branch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05957" /><CodeLine lineNumber="5957"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;CondTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getType());</span></CodeLine>
<Link id="l05958" /><CodeLine lineNumber="5958"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CondTy-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &gt; 64 ||</span></CodeLine>
<Link id="l05959" /><CodeLine lineNumber="5959"><span class="doxyHighlight">          !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.fitsInLegalInteger(CondTy-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>()))</span></CodeLine>
<Link id="l05960" /><CodeLine lineNumber="5960"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05961" /><CodeLine lineNumber="5961"></CodeLine>
<Link id="l05962" /><CodeLine lineNumber="5962"><span class="doxyHighlight">      uint64&#95;t MissingCaseVal = 0;</span></CodeLine>
<Link id="l05963" /><CodeLine lineNumber="5963"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases())</span></CodeLine>
<Link id="l05964" /><CodeLine lineNumber="5964"><span class="doxyHighlight">        MissingCaseVal ^= Case.getCaseValue()-&gt;getValue().getLimitedValue();</span></CodeLine>
<Link id="l05965" /><CodeLine lineNumber="5965"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MissingCase =</span></CodeLine>
<Link id="l05966" /><CodeLine lineNumber="5966"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(ConstantInt::get(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getType(), MissingCaseVal));</span></CodeLine>
<Link id="l05967" /><CodeLine lineNumber="5967"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/switchinstprofupdatewrapper">SwitchInstProfUpdateWrapper</a> SIW(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l05968" /><CodeLine lineNumber="5968"><span class="doxyHighlight">      SIW.<a href="/docs/api/classes/llvm/switchinstprofupdatewrapper/#a722eca444a919e1bc6af18b07941aad9">addCase</a>(MissingCase, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest(), SIW.<a href="/docs/api/classes/llvm/switchinstprofupdatewrapper/#aa78ac7cc796c2905e31c1ef6de35087d">getSuccessorWeight</a>(0));</span></CodeLine>
<Link id="l05969" /><CodeLine lineNumber="5969"><span class="doxyHighlight">      <a href="#a7aa8025f73f4e06135e6ba7083ad7aab">createUnreachableSwitchDefault</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, DTU, </span><span class="doxyHighlightComment">/&#42;RemoveOrigDefaultBlock&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05970" /><CodeLine lineNumber="5970"><span class="doxyHighlight">      SIW.<a href="/docs/api/classes/llvm/switchinstprofupdatewrapper/#a1a01b0843bc5ed009f7fdb2c8b8a41a5">setSuccessorWeight</a>(0, 0);</span></CodeLine>
<Link id="l05971" /><CodeLine lineNumber="5971"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05972" /><CodeLine lineNumber="5972"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05973" /><CodeLine lineNumber="5973"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05974" /><CodeLine lineNumber="5974"></CodeLine>
<Link id="l05975" /><CodeLine lineNumber="5975"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DeadCases.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l05976" /><CodeLine lineNumber="5976"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05977" /><CodeLine lineNumber="5977"></CodeLine>
<Link id="l05978" /><CodeLine lineNumber="5978"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/switchinstprofupdatewrapper">SwitchInstProfUpdateWrapper</a> SIW(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l05979" /><CodeLine lineNumber="5979"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;DeadCase : DeadCases) &#123;</span></CodeLine>
<Link id="l05980" /><CodeLine lineNumber="5980"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/switchinst/#a723af715edeaedc8ed1048f8c235ce9e">SwitchInst::CaseIt</a> CaseI = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;findCaseValue(DeadCase);</span></CodeLine>
<Link id="l05981" /><CodeLine lineNumber="5981"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CaseI != <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;case&#95;default() &amp;&amp;</span></CodeLine>
<Link id="l05982" /><CodeLine lineNumber="5982"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Case was not found. Probably mistake in DeadCases forming.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05983" /><CodeLine lineNumber="5983"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Prune unused values from PHI nodes.</span></CodeLine>
<Link id="l05984" /><CodeLine lineNumber="5984"><span class="doxyHighlight">    CaseI-&gt;getCaseSuccessor()-&gt;removePredecessor(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent());</span></CodeLine>
<Link id="l05985" /><CodeLine lineNumber="5985"><span class="doxyHighlight">    SIW.<a href="/docs/api/classes/llvm/switchinstprofupdatewrapper/#adf90515665080eadf537aff00bbf0594">removeCase</a>(CaseI);</span></CodeLine>
<Link id="l05986" /><CodeLine lineNumber="5986"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05987" /><CodeLine lineNumber="5987"></CodeLine>
<Link id="l05988" /><CodeLine lineNumber="5988"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l05989" /><CodeLine lineNumber="5989"><span class="doxyHighlight">    std::vector&lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l05990" /><CodeLine lineNumber="5990"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a> : UniqueSuccessors)</span></CodeLine>
<Link id="l05991" /><CodeLine lineNumber="5991"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumPerSuccessorCases&#91;<a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>&#93; == 0)</span></CodeLine>
<Link id="l05992" /><CodeLine lineNumber="5992"><span class="doxyHighlight">        Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent(), <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06add2496ae8d635f9f169602771c88d376">Successor</a>&#125;);</span></CodeLine>
<Link id="l05993" /><CodeLine lineNumber="5993"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l05994" /><CodeLine lineNumber="5994"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05995" /><CodeLine lineNumber="5995"></CodeLine>
<Link id="l05996" /><CodeLine lineNumber="5996"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05997" /><CodeLine lineNumber="5997"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05998" /><CodeLine lineNumber="5998"></CodeLine>
<Link id="l05999" /><CodeLine lineNumber="5999"><span class="doxyHighlightComment">/// If BB would be eligible for simplification by</span></CodeLine>
<Link id="l06000" /><CodeLine lineNumber="6000"><span class="doxyHighlightComment">/// TryToSimplifyUncondBranchFromEmptyBlock (i.e. it is empty and terminated</span></CodeLine>
<Link id="l06001" /><CodeLine lineNumber="6001"><span class="doxyHighlightComment">/// by an unconditional branch), look at the phi node for BB in the successor</span></CodeLine>
<Link id="l06002" /><CodeLine lineNumber="6002"><span class="doxyHighlightComment">/// block and see if the incoming value is equal to CaseValue. If so, return</span></CodeLine>
<Link id="l06003" /><CodeLine lineNumber="6003"><span class="doxyHighlightComment">/// the phi node, and set PhiIndex to BB&#39;s index in the phi node.</span></CodeLine>
<Link id="l06004" /><CodeLine lineNumber="6004" lineLink="#a48e98416c61da7bdde42d88ea460723c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="#a48e98416c61da7bdde42d88ea460723c">findPHIForConditionForwarding</a>(<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CaseValue,</span></CodeLine>
<Link id="l06005" /><CodeLine lineNumber="6005"><span class="doxyHighlight">                                              <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> &#42;PhiIndex) &#123;</span></CodeLine>
<Link id="l06006" /><CodeLine lineNumber="6006"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;&#42;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>() != BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())</span></CodeLine>
<Link id="l06007" /><CodeLine lineNumber="6007"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// BB must be empty to be a candidate for simplification.</span></CodeLine>
<Link id="l06008" /><CodeLine lineNumber="6008"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>())</span></CodeLine>
<Link id="l06009" /><CodeLine lineNumber="6009"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// BB must be dominated by the switch.</span></CodeLine>
<Link id="l06010" /><CodeLine lineNumber="6010"></CodeLine>
<Link id="l06011" /><CodeLine lineNumber="6011"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;Branch = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l06012" /><CodeLine lineNumber="6012"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Branch || !Branch-&gt;isUnconditional())</span></CodeLine>
<Link id="l06013" /><CodeLine lineNumber="6013"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Terminator must be unconditional branch.</span></CodeLine>
<Link id="l06014" /><CodeLine lineNumber="6014"></CodeLine>
<Link id="l06015" /><CodeLine lineNumber="6015"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ = Branch-&gt;getSuccessor(0);</span></CodeLine>
<Link id="l06016" /><CodeLine lineNumber="6016"></CodeLine>
<Link id="l06017" /><CodeLine lineNumber="6017"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l06018" /><CodeLine lineNumber="6018"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Idx = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getBasicBlockIndex(BB);</span></CodeLine>
<Link id="l06019" /><CodeLine lineNumber="6019"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Idx &gt;= 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;PHI has no entry for predecessor?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06020" /><CodeLine lineNumber="6020"></CodeLine>
<Link id="l06021" /><CodeLine lineNumber="6021"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;InValue = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingValue(Idx);</span></CodeLine>
<Link id="l06022" /><CodeLine lineNumber="6022"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InValue != CaseValue)</span></CodeLine>
<Link id="l06023" /><CodeLine lineNumber="6023"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06024" /><CodeLine lineNumber="6024"></CodeLine>
<Link id="l06025" /><CodeLine lineNumber="6025"><span class="doxyHighlight">    &#42;PhiIndex = Idx;</span></CodeLine>
<Link id="l06026" /><CodeLine lineNumber="6026"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</span></CodeLine>
<Link id="l06027" /><CodeLine lineNumber="6027"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06028" /><CodeLine lineNumber="6028"></CodeLine>
<Link id="l06029" /><CodeLine lineNumber="6029"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06030" /><CodeLine lineNumber="6030"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06031" /><CodeLine lineNumber="6031"></CodeLine>
<Link id="l06032" /><CodeLine lineNumber="6032"><span class="doxyHighlightComment">/// Try to forward the condition of a switch instruction to a phi node</span></CodeLine>
<Link id="l06033" /><CodeLine lineNumber="6033"><span class="doxyHighlightComment">/// dominated by the switch, if that would mean that some of the destination</span></CodeLine>
<Link id="l06034" /><CodeLine lineNumber="6034"><span class="doxyHighlightComment">/// blocks of the switch can be folded away. Return true if a change is made.</span></CodeLine>
<Link id="l06035" /><CodeLine lineNumber="6035" lineLink="#a480bd8ae64f6f3e4a9cc6e1a724b2ad0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a480bd8ae64f6f3e4a9cc6e1a724b2ad0">forwardSwitchConditionToPHI</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</span></CodeLine>
<Link id="l06036" /><CodeLine lineNumber="6036"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">ForwardingNodesMap = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;PHINode &#42;, SmallVector&lt;int, 4&gt;</a>&gt;;</span></CodeLine>
<Link id="l06037" /><CodeLine lineNumber="6037"></CodeLine>
<Link id="l06038" /><CodeLine lineNumber="6038"><span class="doxyHighlight">  ForwardingNodesMap ForwardingNodes;</span></CodeLine>
<Link id="l06039" /><CodeLine lineNumber="6039"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SwitchBlock = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent();</span></CodeLine>
<Link id="l06040" /><CodeLine lineNumber="6040"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06041" /><CodeLine lineNumber="6041"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l06042" /><CodeLine lineNumber="6042"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CaseValue = Case.getCaseValue();</span></CodeLine>
<Link id="l06043" /><CodeLine lineNumber="6043"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CaseDest = Case.getCaseSuccessor();</span></CodeLine>
<Link id="l06044" /><CodeLine lineNumber="6044"></CodeLine>
<Link id="l06045" /><CodeLine lineNumber="6045"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace phi operands in successor blocks that are using the constant case</span></CodeLine>
<Link id="l06046" /><CodeLine lineNumber="6046"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value rather than the switch condition variable:</span></CodeLine>
<Link id="l06047" /><CodeLine lineNumber="6047"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   switchbb:</span></CodeLine>
<Link id="l06048" /><CodeLine lineNumber="6048"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   switch i32 %x, label %default &#91;</span></CodeLine>
<Link id="l06049" /><CodeLine lineNumber="6049"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     i32 17, label %succ</span></CodeLine>
<Link id="l06050" /><CodeLine lineNumber="6050"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l06051" /><CodeLine lineNumber="6051"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   succ:</span></CodeLine>
<Link id="l06052" /><CodeLine lineNumber="6052"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     %r = phi i32 ... &#91; 17, %switchbb &#93; ...</span></CodeLine>
<Link id="l06053" /><CodeLine lineNumber="6053"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// --&gt;</span></CodeLine>
<Link id="l06054" /><CodeLine lineNumber="6054"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     %r = phi i32 ... &#91; %x, %switchbb &#93; ...</span></CodeLine>
<Link id="l06055" /><CodeLine lineNumber="6055"></CodeLine>
<Link id="l06056" /><CodeLine lineNumber="6056"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;Phi : CaseDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l06057" /><CodeLine lineNumber="6057"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This only works if there is exactly 1 incoming edge from the switch to</span></CodeLine>
<Link id="l06058" /><CodeLine lineNumber="6058"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// a phi. If there is &gt;1, that means multiple cases of the switch map to 1</span></CodeLine>
<Link id="l06059" /><CodeLine lineNumber="6059"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// value in the phi, and that phi value is not the switch condition. Thus,</span></CodeLine>
<Link id="l06060" /><CodeLine lineNumber="6060"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// this transform would not make sense (the phi would be invalid because</span></CodeLine>
<Link id="l06061" /><CodeLine lineNumber="6061"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// a phi can&#39;t have different incoming values from the same block).</span></CodeLine>
<Link id="l06062" /><CodeLine lineNumber="6062"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SwitchBBIdx = Phi.getBasicBlockIndex(SwitchBlock);</span></CodeLine>
<Link id="l06063" /><CodeLine lineNumber="6063"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Phi.getIncomingValue(SwitchBBIdx) == CaseValue &amp;&amp;</span></CodeLine>
<Link id="l06064" /><CodeLine lineNumber="6064"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ab1772fd431decccb7926d484ea223db7">count</a>(Phi.blocks(), SwitchBlock) == 1) &#123;</span></CodeLine>
<Link id="l06065" /><CodeLine lineNumber="6065"><span class="doxyHighlight">        Phi.setIncomingValue(SwitchBBIdx, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition());</span></CodeLine>
<Link id="l06066" /><CodeLine lineNumber="6066"><span class="doxyHighlight">        <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06067" /><CodeLine lineNumber="6067"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06068" /><CodeLine lineNumber="6068"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06069" /><CodeLine lineNumber="6069"></CodeLine>
<Link id="l06070" /><CodeLine lineNumber="6070"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Collect phi nodes that are indirectly using this switch&#39;s case constants.</span></CodeLine>
<Link id="l06071" /><CodeLine lineNumber="6071"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> PhiIdx;</span></CodeLine>
<Link id="l06072" /><CodeLine lineNumber="6072"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Phi = <a href="#a48e98416c61da7bdde42d88ea460723c">findPHIForConditionForwarding</a>(CaseValue, CaseDest, &amp;PhiIdx))</span></CodeLine>
<Link id="l06073" /><CodeLine lineNumber="6073"><span class="doxyHighlight">      ForwardingNodes&#91;Phi&#93;.push&#95;back(PhiIdx);</span></CodeLine>
<Link id="l06074" /><CodeLine lineNumber="6074"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06075" /><CodeLine lineNumber="6075"></CodeLine>
<Link id="l06076" /><CodeLine lineNumber="6076"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;ForwardingNode : ForwardingNodes) &#123;</span></CodeLine>
<Link id="l06077" /><CodeLine lineNumber="6077"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = ForwardingNode.first;</span></CodeLine>
<Link id="l06078" /><CodeLine lineNumber="6078"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;int&gt;</a> &amp;Indexes = ForwardingNode.second;</span></CodeLine>
<Link id="l06079" /><CodeLine lineNumber="6079"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if it helps to fold PHI.</span></CodeLine>
<Link id="l06080" /><CodeLine lineNumber="6080"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Indexes.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt; 2 &amp;&amp; !<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">llvm::is&#95;contained</a>(Phi-&gt;incoming&#95;values(), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition()))</span></CodeLine>
<Link id="l06081" /><CodeLine lineNumber="6081"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06082" /><CodeLine lineNumber="6082"></CodeLine>
<Link id="l06083" /><CodeLine lineNumber="6083"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Index : Indexes)</span></CodeLine>
<Link id="l06084" /><CodeLine lineNumber="6084"><span class="doxyHighlight">      Phi-&gt;setIncomingValue(Index, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition());</span></CodeLine>
<Link id="l06085" /><CodeLine lineNumber="6085"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06086" /><CodeLine lineNumber="6086"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06087" /><CodeLine lineNumber="6087"></CodeLine>
<Link id="l06088" /><CodeLine lineNumber="6088"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l06089" /><CodeLine lineNumber="6089"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06090" /><CodeLine lineNumber="6090"></CodeLine>
<Link id="l06091" /><CodeLine lineNumber="6091"><span class="doxyHighlightComment">/// Return true if the backend will be able to handle</span></CodeLine>
<Link id="l06092" /><CodeLine lineNumber="6092"><span class="doxyHighlightComment">/// initializing an array of constants like C.</span></CodeLine>
<Link id="l06093" /><CodeLine lineNumber="6093" lineLink="#a05c11986a2c95c43b7a1ae03b7f88d1d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a05c11986a2c95c43b7a1ae03b7f88d1d">validLookupTableConstant</a>(<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l06094" /><CodeLine lineNumber="6094"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isThreadDependent())</span></CodeLine>
<Link id="l06095" /><CodeLine lineNumber="6095"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06096" /><CodeLine lineNumber="6096"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isDLLImportDependent())</span></CodeLine>
<Link id="l06097" /><CodeLine lineNumber="6097"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06098" /><CodeLine lineNumber="6098"></CodeLine>
<Link id="l06099" /><CodeLine lineNumber="6099"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantFP&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &amp;&amp;</span></CodeLine>
<Link id="l06100" /><CodeLine lineNumber="6100"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantPointerNull&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GlobalValue&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &amp;&amp;</span></CodeLine>
<Link id="l06101" /><CodeLine lineNumber="6101"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantExpr&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))</span></CodeLine>
<Link id="l06102" /><CodeLine lineNumber="6102"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06103" /><CodeLine lineNumber="6103"></CodeLine>
<Link id="l06104" /><CodeLine lineNumber="6104"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantexpr">ConstantExpr</a> &#42;CE = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantExpr&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)) &#123;</span></CodeLine>
<Link id="l06105" /><CodeLine lineNumber="6105"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Pointer casts and in-bounds GEPs will not prohibit the backend from</span></CodeLine>
<Link id="l06106" /><CodeLine lineNumber="6106"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// materializing the array of constants.</span></CodeLine>
<Link id="l06107" /><CodeLine lineNumber="6107"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;StrippedC = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(CE-&gt;stripInBoundsConstantOffsets());</span></CodeLine>
<Link id="l06108" /><CodeLine lineNumber="6108"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StrippedC == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> || !<a href="#a05c11986a2c95c43b7a1ae03b7f88d1d">validLookupTableConstant</a>(StrippedC, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l06109" /><CodeLine lineNumber="6109"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06110" /><CodeLine lineNumber="6110"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06111" /><CodeLine lineNumber="6111"></CodeLine>
<Link id="l06112" /><CodeLine lineNumber="6112"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.shouldBuildLookupTablesForConstant(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))</span></CodeLine>
<Link id="l06113" /><CodeLine lineNumber="6113"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06114" /><CodeLine lineNumber="6114"></CodeLine>
<Link id="l06115" /><CodeLine lineNumber="6115"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06116" /><CodeLine lineNumber="6116"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06117" /><CodeLine lineNumber="6117"></CodeLine>
<Link id="l06118" /><CodeLine lineNumber="6118"><span class="doxyHighlightComment">/// If V is a Constant, return it. Otherwise, try to look up</span></CodeLine>
<Link id="l06119" /><CodeLine lineNumber="6119"><span class="doxyHighlightComment">/// its constant value in ConstantPool, returning 0 if it&#39;s not there.</span></CodeLine>
<Link id="l06120" /><CodeLine lineNumber="6120"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;</span></CodeLine>
<Link id="l06121" /><CodeLine lineNumber="6121" lineLink="#adc3fe6855d95097c6692cea63a747695"><span class="doxyHighlight"><a href="#adc3fe6855d95097c6692cea63a747695">lookupConstant</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V,</span></CodeLine>
<Link id="l06122" /><CodeLine lineNumber="6122"><span class="doxyHighlight">               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Value &#42;, Constant &#42;&gt;</a> &amp;<a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>) &#123;</span></CodeLine>
<Link id="l06123" /><CodeLine lineNumber="6123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V))</span></CodeLine>
<Link id="l06124" /><CodeLine lineNumber="6124"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l06125" /><CodeLine lineNumber="6125"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>.lookup(V);</span></CodeLine>
<Link id="l06126" /><CodeLine lineNumber="6126"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06127" /><CodeLine lineNumber="6127"></CodeLine>
<Link id="l06128" /><CodeLine lineNumber="6128"><span class="doxyHighlightComment">/// Try to fold instruction I into a constant. This works for</span></CodeLine>
<Link id="l06129" /><CodeLine lineNumber="6129"><span class="doxyHighlightComment">/// simple instructions such as binary operations where both operands are</span></CodeLine>
<Link id="l06130" /><CodeLine lineNumber="6130"><span class="doxyHighlightComment">/// constant or can be replaced by constants from the ConstantPool. Returns the</span></CodeLine>
<Link id="l06131" /><CodeLine lineNumber="6131"><span class="doxyHighlightComment">/// resulting constant on success, 0 otherwise.</span></CodeLine>
<Link id="l06132" /><CodeLine lineNumber="6132"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;</span></CodeLine>
<Link id="l06133" /><CodeLine lineNumber="6133" lineLink="#a40bb6295bf75ebb0f636376637ed518f"><span class="doxyHighlight"><a href="#a40bb6295bf75ebb0f636376637ed518f">constantFold</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l06134" /><CodeLine lineNumber="6134"><span class="doxyHighlight">             </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Value &#42;, Constant &#42;&gt;</a> &amp;<a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>) &#123;</span></CodeLine>
<Link id="l06135" /><CodeLine lineNumber="6135"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l06136" /><CodeLine lineNumber="6136"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="#adc3fe6855d95097c6692cea63a747695">lookupConstant</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getCondition(), <a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>);</span></CodeLine>
<Link id="l06137" /><CodeLine lineNumber="6137"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>)</span></CodeLine>
<Link id="l06138" /><CodeLine lineNumber="6138"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06139" /><CodeLine lineNumber="6139"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;isAllOnesValue())</span></CodeLine>
<Link id="l06140" /><CodeLine lineNumber="6140"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#adc3fe6855d95097c6692cea63a747695">lookupConstant</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getTrueValue(), <a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>);</span></CodeLine>
<Link id="l06141" /><CodeLine lineNumber="6141"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;isNullValue())</span></CodeLine>
<Link id="l06142" /><CodeLine lineNumber="6142"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#adc3fe6855d95097c6692cea63a747695">lookupConstant</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getFalseValue(), <a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>);</span></CodeLine>
<Link id="l06143" /><CodeLine lineNumber="6143"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06144" /><CodeLine lineNumber="6144"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06145" /><CodeLine lineNumber="6145"></CodeLine>
<Link id="l06146" /><CodeLine lineNumber="6146"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;, 4&gt;</a> COps;</span></CodeLine>
<Link id="l06147" /><CodeLine lineNumber="6147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getNumOperands(); <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>) &#123;</span></CodeLine>
<Link id="l06148" /><CodeLine lineNumber="6148"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="#adc3fe6855d95097c6692cea63a747695">lookupConstant</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>), <a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>))</span></CodeLine>
<Link id="l06149" /><CodeLine lineNumber="6149"><span class="doxyHighlight">      COps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</span></CodeLine>
<Link id="l06150" /><CodeLine lineNumber="6150"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06151" /><CodeLine lineNumber="6151"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06152" /><CodeLine lineNumber="6152"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06153" /><CodeLine lineNumber="6153"></CodeLine>
<Link id="l06154" /><CodeLine lineNumber="6154"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a8bd5f9b3852cfb092d927ef2b04c7f6b">ConstantFoldInstOperands</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, COps, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l06155" /><CodeLine lineNumber="6155"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06156" /><CodeLine lineNumber="6156"></CodeLine>
<Link id="l06157" /><CodeLine lineNumber="6157"><span class="doxyHighlightComment">/// Try to determine the resulting constant values in phi nodes</span></CodeLine>
<Link id="l06158" /><CodeLine lineNumber="6158"><span class="doxyHighlightComment">/// at the common destination basic block, &#42;CommonDest, for one of the case</span></CodeLine>
<Link id="l06159" /><CodeLine lineNumber="6159"><span class="doxyHighlightComment">/// destionations CaseDest corresponding to value CaseVal (0 for the default</span></CodeLine>
<Link id="l06160" /><CodeLine lineNumber="6160"><span class="doxyHighlightComment">/// case), of a switch instruction SI.</span></CodeLine>
<Link id="l06161" /><CodeLine lineNumber="6161"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l06162" /><CodeLine lineNumber="6162" lineLink="#a31070c67db84f4caef376dcb7906c4fb"><span class="doxyHighlight"><a href="#a31070c67db84f4caef376dcb7906c4fb">getCaseResults</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CaseVal, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CaseDest,</span></CodeLine>
<Link id="l06163" /><CodeLine lineNumber="6163"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;&#42;CommonDest,</span></CodeLine>
<Link id="l06164" /><CodeLine lineNumber="6164"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;PHINode &#42;, Constant &#42;&gt;&gt; &amp;Res,</span></CodeLine>
<Link id="l06165" /><CodeLine lineNumber="6165"><span class="doxyHighlight">               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l06166" /><CodeLine lineNumber="6166"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The block from which we enter the common destination.</span></CodeLine>
<Link id="l06167" /><CodeLine lineNumber="6167"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent();</span></CodeLine>
<Link id="l06168" /><CodeLine lineNumber="6168"></CodeLine>
<Link id="l06169" /><CodeLine lineNumber="6169"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If CaseDest is empty except for some side-effect free instructions through</span></CodeLine>
<Link id="l06170" /><CodeLine lineNumber="6170"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which we can constant-propagate the CaseVal, continue to its successor.</span></CodeLine>
<Link id="l06171" /><CodeLine lineNumber="6171"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Value &#42;, Constant &#42;&gt;</a> <a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>;</span></CodeLine>
<Link id="l06172" /><CodeLine lineNumber="6172"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>.insert(std::make&#95;pair(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition(), CaseVal));</span></CodeLine>
<Link id="l06173" /><CodeLine lineNumber="6173"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : CaseDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a2069641f358ef416658a2f321ca19d74">instructionsWithoutDebug</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l06174" /><CodeLine lineNumber="6174"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isTerminator()) &#123;</span></CodeLine>
<Link id="l06175" /><CodeLine lineNumber="6175"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the terminator is a simple branch, continue to the next block.</span></CodeLine>
<Link id="l06176" /><CodeLine lineNumber="6176"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getNumSuccessors() != 1 || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isSpecialTerminator())</span></CodeLine>
<Link id="l06177" /><CodeLine lineNumber="6177"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06178" /><CodeLine lineNumber="6178"><span class="doxyHighlight">      Pred = CaseDest;</span></CodeLine>
<Link id="l06179" /><CodeLine lineNumber="6179"><span class="doxyHighlight">      CaseDest = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getSuccessor(0);</span></CodeLine>
<Link id="l06180" /><CodeLine lineNumber="6180"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="#a40bb6295bf75ebb0f636376637ed518f">constantFold</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>)) &#123;</span></CodeLine>
<Link id="l06181" /><CodeLine lineNumber="6181"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Instruction is side-effect free and constant.</span></CodeLine>
<Link id="l06182" /><CodeLine lineNumber="6182"></CodeLine>
<Link id="l06183" /><CodeLine lineNumber="6183"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the instruction has uses outside this block or a phi node slot for</span></CodeLine>
<Link id="l06184" /><CodeLine lineNumber="6184"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the block, it is not safe to bypass the instruction since it would then</span></CodeLine>
<Link id="l06185" /><CodeLine lineNumber="6185"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// no longer dominate all its uses.</span></CodeLine>
<Link id="l06186" /><CodeLine lineNumber="6186"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/classes/llvm/use">Use</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.uses()) &#123;</span></CodeLine>
<Link id="l06187" /><CodeLine lineNumber="6187"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/user">User</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/classes/llvm/use">Use</a>.<a href="/docs/api/classes/llvm/use/#a53a48d67682705c5f7f06ffc850fd622">getUser</a>();</span></CodeLine>
<Link id="l06188" /><CodeLine lineNumber="6188"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>))</span></CodeLine>
<Link id="l06189" /><CodeLine lineNumber="6189"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == CaseDest)</span></CodeLine>
<Link id="l06190" /><CodeLine lineNumber="6190"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06191" /><CodeLine lineNumber="6191"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>))</span></CodeLine>
<Link id="l06192" /><CodeLine lineNumber="6192"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Phi-&gt;getIncomingBlock(<a href="/docs/api/classes/llvm/use">Use</a>) == CaseDest)</span></CodeLine>
<Link id="l06193" /><CodeLine lineNumber="6193"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06194" /><CodeLine lineNumber="6194"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06195" /><CodeLine lineNumber="6195"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06196" /><CodeLine lineNumber="6196"></CodeLine>
<Link id="l06197" /><CodeLine lineNumber="6197"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>.insert(std::make&#95;pair(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>));</span></CodeLine>
<Link id="l06198" /><CodeLine lineNumber="6198"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06199" /><CodeLine lineNumber="6199"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06200" /><CodeLine lineNumber="6200"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06201" /><CodeLine lineNumber="6201"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06202" /><CodeLine lineNumber="6202"></CodeLine>
<Link id="l06203" /><CodeLine lineNumber="6203"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we did not have a CommonDest before, use the current one.</span></CodeLine>
<Link id="l06204" /><CodeLine lineNumber="6204"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!&#42;CommonDest)</span></CodeLine>
<Link id="l06205" /><CodeLine lineNumber="6205"><span class="doxyHighlight">    &#42;CommonDest = CaseDest;</span></CodeLine>
<Link id="l06206" /><CodeLine lineNumber="6206"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the destination isn&#39;t the common one, abort.</span></CodeLine>
<Link id="l06207" /><CodeLine lineNumber="6207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CaseDest != &#42;CommonDest)</span></CodeLine>
<Link id="l06208" /><CodeLine lineNumber="6208"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06209" /><CodeLine lineNumber="6209"></CodeLine>
<Link id="l06210" /><CodeLine lineNumber="6210"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the values for this case from phi nodes in the destination block.</span></CodeLine>
<Link id="l06211" /><CodeLine lineNumber="6211"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : (&#42;CommonDest)-&gt;phis()) &#123;</span></CodeLine>
<Link id="l06212" /><CodeLine lineNumber="6212"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Idx = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getBasicBlockIndex(Pred);</span></CodeLine>
<Link id="l06213" /><CodeLine lineNumber="6213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Idx == -1)</span></CodeLine>
<Link id="l06214" /><CodeLine lineNumber="6214"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06215" /><CodeLine lineNumber="6215"></CodeLine>
<Link id="l06216" /><CodeLine lineNumber="6216"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ConstVal =</span></CodeLine>
<Link id="l06217" /><CodeLine lineNumber="6217"><span class="doxyHighlight">        <a href="#adc3fe6855d95097c6692cea63a747695">lookupConstant</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingValue(Idx), <a href="/docs/api/classes/llvm/constantpool">ConstantPool</a>);</span></CodeLine>
<Link id="l06218" /><CodeLine lineNumber="6218"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ConstVal)</span></CodeLine>
<Link id="l06219" /><CodeLine lineNumber="6219"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06220" /><CodeLine lineNumber="6220"></CodeLine>
<Link id="l06221" /><CodeLine lineNumber="6221"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Be conservative about which kinds of constants we support.</span></CodeLine>
<Link id="l06222" /><CodeLine lineNumber="6222"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a05c11986a2c95c43b7a1ae03b7f88d1d">validLookupTableConstant</a>(ConstVal, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l06223" /><CodeLine lineNumber="6223"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06224" /><CodeLine lineNumber="6224"></CodeLine>
<Link id="l06225" /><CodeLine lineNumber="6225"><span class="doxyHighlight">    Res.push&#95;back(std::make&#95;pair(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, ConstVal));</span></CodeLine>
<Link id="l06226" /><CodeLine lineNumber="6226"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06227" /><CodeLine lineNumber="6227"></CodeLine>
<Link id="l06228" /><CodeLine lineNumber="6228"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Res.<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>() &gt; 0;</span></CodeLine>
<Link id="l06229" /><CodeLine lineNumber="6229"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06230" /><CodeLine lineNumber="6230"></CodeLine>
<Link id="l06231" /><CodeLine lineNumber="6231"><span class="doxyHighlightComment">// Helper function used to add CaseVal to the list of cases that generate</span></CodeLine>
<Link id="l06232" /><CodeLine lineNumber="6232"><span class="doxyHighlightComment">// Result. Returns the updated number of cases that generate this result.</span></CodeLine>
<Link id="l06233" /><CodeLine lineNumber="6233" lineLink="#ac46c68ef01d64ec7e21b62016818063a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> <a href="#ac46c68ef01d64ec7e21b62016818063a">mapCaseToResult</a>(<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CaseVal,</span></CodeLine>
<Link id="l06234" /><CodeLine lineNumber="6234"><span class="doxyHighlight">                              <a href="/docs/api/namespaces/anonymous-simplifycfg-cpp-/#acc1b2160383f472d108b5eaa86ca3b23">SwitchCaseResultVectorTy</a> &amp;UniqueResults,</span></CodeLine>
<Link id="l06235" /><CodeLine lineNumber="6235"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Result) &#123;</span></CodeLine>
<Link id="l06236" /><CodeLine lineNumber="6236"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : UniqueResults) &#123;</span></CodeLine>
<Link id="l06237" /><CodeLine lineNumber="6237"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.first == Result) &#123;</span></CodeLine>
<Link id="l06238" /><CodeLine lineNumber="6238"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second.push&#95;back(CaseVal);</span></CodeLine>
<Link id="l06239" /><CodeLine lineNumber="6239"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second.size();</span></CodeLine>
<Link id="l06240" /><CodeLine lineNumber="6240"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06241" /><CodeLine lineNumber="6241"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06242" /><CodeLine lineNumber="6242"><span class="doxyHighlight">  UniqueResults.push&#95;back(</span></CodeLine>
<Link id="l06243" /><CodeLine lineNumber="6243"><span class="doxyHighlight">      std::make&#95;pair(Result, <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ConstantInt &#42;, 4&gt;</a>(1, CaseVal)));</span></CodeLine>
<Link id="l06244" /><CodeLine lineNumber="6244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 1;</span></CodeLine>
<Link id="l06245" /><CodeLine lineNumber="6245"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06246" /><CodeLine lineNumber="6246"></CodeLine>
<Link id="l06247" /><CodeLine lineNumber="6247"><span class="doxyHighlightComment">// Helper function that initializes a map containing</span></CodeLine>
<Link id="l06248" /><CodeLine lineNumber="6248"><span class="doxyHighlightComment">// results for the PHI node of the common destination block for a switch</span></CodeLine>
<Link id="l06249" /><CodeLine lineNumber="6249"><span class="doxyHighlightComment">// instruction. Returns false if multiple PHI nodes have been found or if</span></CodeLine>
<Link id="l06250" /><CodeLine lineNumber="6250"><span class="doxyHighlightComment">// there is not a common destination block for the switch.</span></CodeLine>
<Link id="l06251" /><CodeLine lineNumber="6251" lineLink="#a95851c48d68c2406ef12a7cca9c65f76"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a95851c48d68c2406ef12a7cca9c65f76">initializeUniqueCases</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>,</span></CodeLine>
<Link id="l06252" /><CodeLine lineNumber="6252"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;&amp;CommonDest,</span></CodeLine>
<Link id="l06253" /><CodeLine lineNumber="6253"><span class="doxyHighlight">                                  <a href="/docs/api/namespaces/anonymous-simplifycfg-cpp-/#acc1b2160383f472d108b5eaa86ca3b23">SwitchCaseResultVectorTy</a> &amp;UniqueResults,</span></CodeLine>
<Link id="l06254" /><CodeLine lineNumber="6254"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;&amp;DefaultResult,</span></CodeLine>
<Link id="l06255" /><CodeLine lineNumber="6255"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l06256" /><CodeLine lineNumber="6256"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l06257" /><CodeLine lineNumber="6257"><span class="doxyHighlight">                                  uintptr&#95;t MaxUniqueResults) &#123;</span></CodeLine>
<Link id="l06258" /><CodeLine lineNumber="6258"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l06259" /><CodeLine lineNumber="6259"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CaseVal = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCaseValue();</span></CodeLine>
<Link id="l06260" /><CodeLine lineNumber="6260"></CodeLine>
<Link id="l06261" /><CodeLine lineNumber="6261"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Resulting value at phi nodes for this case value.</span></CodeLine>
<Link id="l06262" /><CodeLine lineNumber="6262"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-simplifycfg-cpp-/#a52b27f5246c1976536740d7fdaeefe0e">SwitchCaseResultsTy</a> <a href="/docs/api/files/lib/lib/analysis/aliasanalysis-cpp/#a7e344cff0feadf0b02223fee63cc7475">Results</a>;</span></CodeLine>
<Link id="l06263" /><CodeLine lineNumber="6263"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a31070c67db84f4caef376dcb7906c4fb">getCaseResults</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, CaseVal, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCaseSuccessor(), &amp;CommonDest, <a href="/docs/api/files/lib/lib/analysis/aliasanalysis-cpp/#a7e344cff0feadf0b02223fee63cc7475">Results</a>,</span></CodeLine>
<Link id="l06264" /><CodeLine lineNumber="6264"><span class="doxyHighlight">                        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l06265" /><CodeLine lineNumber="6265"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06266" /><CodeLine lineNumber="6266"></CodeLine>
<Link id="l06267" /><CodeLine lineNumber="6267"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only one value per case is permitted.</span></CodeLine>
<Link id="l06268" /><CodeLine lineNumber="6268"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/aliasanalysis-cpp/#a7e344cff0feadf0b02223fee63cc7475">Results</a>.size() &gt; 1)</span></CodeLine>
<Link id="l06269" /><CodeLine lineNumber="6269"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06270" /><CodeLine lineNumber="6270"></CodeLine>
<Link id="l06271" /><CodeLine lineNumber="6271"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add the case-&gt;result mapping to UniqueResults.</span></CodeLine>
<Link id="l06272" /><CodeLine lineNumber="6272"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> NumCasesForResult =</span></CodeLine>
<Link id="l06273" /><CodeLine lineNumber="6273"><span class="doxyHighlight">        <a href="#ac46c68ef01d64ec7e21b62016818063a">mapCaseToResult</a>(CaseVal, UniqueResults, <a href="/docs/api/files/lib/lib/analysis/aliasanalysis-cpp/#a7e344cff0feadf0b02223fee63cc7475">Results</a>.begin()-&gt;second);</span></CodeLine>
<Link id="l06274" /><CodeLine lineNumber="6274"></CodeLine>
<Link id="l06275" /><CodeLine lineNumber="6275"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Early out if there are too many cases for this result.</span></CodeLine>
<Link id="l06276" /><CodeLine lineNumber="6276"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumCasesForResult &gt; <a href="#a25dbc1cc43ca0c2fa252ddd0255f86cf">MaxSwitchCasesPerResult</a>)</span></CodeLine>
<Link id="l06277" /><CodeLine lineNumber="6277"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06278" /><CodeLine lineNumber="6278"></CodeLine>
<Link id="l06279" /><CodeLine lineNumber="6279"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Early out if there are too many unique results.</span></CodeLine>
<Link id="l06280" /><CodeLine lineNumber="6280"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UniqueResults.size() &gt; MaxUniqueResults)</span></CodeLine>
<Link id="l06281" /><CodeLine lineNumber="6281"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06282" /><CodeLine lineNumber="6282"></CodeLine>
<Link id="l06283" /><CodeLine lineNumber="6283"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check the PHI consistency.</span></CodeLine>
<Link id="l06284" /><CodeLine lineNumber="6284"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)</span></CodeLine>
<Link id="l06285" /><CodeLine lineNumber="6285"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/files/lib/lib/analysis/aliasanalysis-cpp/#a7e344cff0feadf0b02223fee63cc7475">Results</a>&#91;0&#93;.first;</span></CodeLine>
<Link id="l06286" /><CodeLine lineNumber="6286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> != <a href="/docs/api/files/lib/lib/analysis/aliasanalysis-cpp/#a7e344cff0feadf0b02223fee63cc7475">Results</a>&#91;0&#93;.first)</span></CodeLine>
<Link id="l06287" /><CodeLine lineNumber="6287"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06288" /><CodeLine lineNumber="6288"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06289" /><CodeLine lineNumber="6289"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find the default result value.</span></CodeLine>
<Link id="l06290" /><CodeLine lineNumber="6290"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;PHINode &#42;, Constant &#42;&gt;</a>, 1&gt; DefaultResults;</span></CodeLine>
<Link id="l06291" /><CodeLine lineNumber="6291"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DefaultDest = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest();</span></CodeLine>
<Link id="l06292" /><CodeLine lineNumber="6292"><span class="doxyHighlight">  <a href="#a31070c67db84f4caef376dcb7906c4fb">getCaseResults</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest(), &amp;CommonDest, DefaultResults,</span></CodeLine>
<Link id="l06293" /><CodeLine lineNumber="6293"><span class="doxyHighlight">                 <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l06294" /><CodeLine lineNumber="6294"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the default value is not found abort unless the default destination</span></CodeLine>
<Link id="l06295" /><CodeLine lineNumber="6295"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is unreachable.</span></CodeLine>
<Link id="l06296" /><CodeLine lineNumber="6296"><span class="doxyHighlight">  DefaultResult =</span></CodeLine>
<Link id="l06297" /><CodeLine lineNumber="6297"><span class="doxyHighlight">      DefaultResults.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 1 ? DefaultResults.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>()-&gt;second : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06298" /><CodeLine lineNumber="6298"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((!DefaultResult &amp;&amp;</span></CodeLine>
<Link id="l06299" /><CodeLine lineNumber="6299"><span class="doxyHighlight">       !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UnreachableInst&gt;</a>(DefaultDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a50909227135ef69932bff39b8ea3f572">getFirstNonPHIOrDbg</a>())))</span></CodeLine>
<Link id="l06300" /><CodeLine lineNumber="6300"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06301" /><CodeLine lineNumber="6301"></CodeLine>
<Link id="l06302" /><CodeLine lineNumber="6302"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06303" /><CodeLine lineNumber="6303"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06304" /><CodeLine lineNumber="6304"></CodeLine>
<Link id="l06305" /><CodeLine lineNumber="6305"><span class="doxyHighlightComment">// Helper function that checks if it is possible to transform a switch with only</span></CodeLine>
<Link id="l06306" /><CodeLine lineNumber="6306"><span class="doxyHighlightComment">// two cases (or two cases + default) that produces a result into a select.</span></CodeLine>
<Link id="l06307" /><CodeLine lineNumber="6307"><span class="doxyHighlightComment">// TODO: Handle switches with more than 2 cases that map to the same result.</span></CodeLine>
<Link id="l06308" /><CodeLine lineNumber="6308" lineLink="#a53f06c06e81412900ac140caaf764ff8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a53f06c06e81412900ac140caaf764ff8">foldSwitchToSelect</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-simplifycfg-cpp-/#acc1b2160383f472d108b5eaa86ca3b23">SwitchCaseResultVectorTy</a> &amp;ResultVector,</span></CodeLine>
<Link id="l06309" /><CodeLine lineNumber="6309"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;DefaultResult, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Condition,</span></CodeLine>
<Link id="l06310" /><CodeLine lineNumber="6310"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l06311" /><CodeLine lineNumber="6311"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are selecting between only two cases transform into a simple</span></CodeLine>
<Link id="l06312" /><CodeLine lineNumber="6312"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// select or a two-way select if default is possible.</span></CodeLine>
<Link id="l06313" /><CodeLine lineNumber="6313"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Example:</span></CodeLine>
<Link id="l06314" /><CodeLine lineNumber="6314"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// switch (a) &#123;                  %0 = icmp eq i32 %a, 10</span></CodeLine>
<Link id="l06315" /><CodeLine lineNumber="6315"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   case 10: return 42;         %1 = select i1 %0, i32 42, i32 4</span></CodeLine>
<Link id="l06316" /><CodeLine lineNumber="6316"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   case 20: return 2;   ----&gt;  %2 = icmp eq i32 %a, 20</span></CodeLine>
<Link id="l06317" /><CodeLine lineNumber="6317"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   default: return 4;          %3 = select i1 %2, i32 2, i32 %1</span></CodeLine>
<Link id="l06318" /><CodeLine lineNumber="6318"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#125;</span></CodeLine>
<Link id="l06319" /><CodeLine lineNumber="6319"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ResultVector.size() == 2 &amp;&amp; ResultVector&#91;0&#93;.second.size() == 1 &amp;&amp;</span></CodeLine>
<Link id="l06320" /><CodeLine lineNumber="6320"><span class="doxyHighlight">      ResultVector&#91;1&#93;.second.size() == 1) &#123;</span></CodeLine>
<Link id="l06321" /><CodeLine lineNumber="6321"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;FirstCase = ResultVector&#91;0&#93;.second&#91;0&#93;;</span></CodeLine>
<Link id="l06322" /><CodeLine lineNumber="6322"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;SecondCase = ResultVector&#91;1&#93;.second&#91;0&#93;;</span></CodeLine>
<Link id="l06323" /><CodeLine lineNumber="6323"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;SelectValue = ResultVector&#91;1&#93;.first;</span></CodeLine>
<Link id="l06324" /><CodeLine lineNumber="6324"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefaultResult) &#123;</span></CodeLine>
<Link id="l06325" /><CodeLine lineNumber="6325"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;ValueCompare =</span></CodeLine>
<Link id="l06326" /><CodeLine lineNumber="6326"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(Condition, SecondCase, </span><span class="doxyHighlightStringLiteral">&quot;switch.selectcmp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06327" /><CodeLine lineNumber="6327"><span class="doxyHighlight">      SelectValue = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(ValueCompare, ResultVector&#91;1&#93;.first,</span></CodeLine>
<Link id="l06328" /><CodeLine lineNumber="6328"><span class="doxyHighlight">                                         DefaultResult, </span><span class="doxyHighlightStringLiteral">&quot;switch.select&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06329" /><CodeLine lineNumber="6329"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06330" /><CodeLine lineNumber="6330"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ValueCompare =</span></CodeLine>
<Link id="l06331" /><CodeLine lineNumber="6331"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(Condition, FirstCase, </span><span class="doxyHighlightStringLiteral">&quot;switch.selectcmp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06332" /><CodeLine lineNumber="6332"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(ValueCompare, ResultVector&#91;0&#93;.first,</span></CodeLine>
<Link id="l06333" /><CodeLine lineNumber="6333"><span class="doxyHighlight">                                SelectValue, </span><span class="doxyHighlightStringLiteral">&quot;switch.select&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06334" /><CodeLine lineNumber="6334"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06335" /><CodeLine lineNumber="6335"></CodeLine>
<Link id="l06336" /><CodeLine lineNumber="6336"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle the degenerate case where two cases have the same result value.</span></CodeLine>
<Link id="l06337" /><CodeLine lineNumber="6337"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ResultVector.size() == 1 &amp;&amp; DefaultResult) &#123;</span></CodeLine>
<Link id="l06338" /><CodeLine lineNumber="6338"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ConstantInt &#42;&gt;</a> CaseValues = ResultVector&#91;0&#93;.second;</span></CodeLine>
<Link id="l06339" /><CodeLine lineNumber="6339"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CaseCount = CaseValues.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</span></CodeLine>
<Link id="l06340" /><CodeLine lineNumber="6340"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// n bits group cases map to the same result:</span></CodeLine>
<Link id="l06341" /><CodeLine lineNumber="6341"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// case 0,4      -&gt; Cond &amp; 0b1..1011 == 0 ? result : default</span></CodeLine>
<Link id="l06342" /><CodeLine lineNumber="6342"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// case 0,2,4,6  -&gt; Cond &amp; 0b1..1001 == 0 ? result : default</span></CodeLine>
<Link id="l06343" /><CodeLine lineNumber="6343"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// case 0,2,8,10 -&gt; Cond &amp; 0b1..0101 == 0 ? result : default</span></CodeLine>
<Link id="l06344" /><CodeLine lineNumber="6344"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(CaseCount)) &#123;</span></CodeLine>
<Link id="l06345" /><CodeLine lineNumber="6345"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;MinCaseVal = CaseValues&#91;0&#93;;</span></CodeLine>
<Link id="l06346" /><CodeLine lineNumber="6346"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Find mininal value.</span></CodeLine>
<Link id="l06347" /><CodeLine lineNumber="6347"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Case : CaseValues)</span></CodeLine>
<Link id="l06348" /><CodeLine lineNumber="6348"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Case-&gt;getValue().slt(MinCaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>()))</span></CodeLine>
<Link id="l06349" /><CodeLine lineNumber="6349"><span class="doxyHighlight">          MinCaseVal = Case;</span></CodeLine>
<Link id="l06350" /><CodeLine lineNumber="6350"></CodeLine>
<Link id="l06351" /><CodeLine lineNumber="6351"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Mark the bits case number touched.</span></CodeLine>
<Link id="l06352" /><CodeLine lineNumber="6352"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a> BitMask = <a href="/docs/api/classes/llvm/apint/#add4e37b60ea64faafbc9a5bf3e27280f">APInt::getZero</a>(MinCaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#ab240d0d30dfa9b392ef9d813f3f9e4be">getBitWidth</a>());</span></CodeLine>
<Link id="l06353" /><CodeLine lineNumber="6353"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Case : CaseValues)</span></CodeLine>
<Link id="l06354" /><CodeLine lineNumber="6354"><span class="doxyHighlight">        BitMask |= (Case-&gt;getValue() - MinCaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>());</span></CodeLine>
<Link id="l06355" /><CodeLine lineNumber="6355"></CodeLine>
<Link id="l06356" /><CodeLine lineNumber="6356"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check if cases with the same result can cover all number</span></CodeLine>
<Link id="l06357" /><CodeLine lineNumber="6357"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// in touched bits.</span></CodeLine>
<Link id="l06358" /><CodeLine lineNumber="6358"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BitMask.<a href="/docs/api/classes/llvm/apint/#a27ad8ac0b3b15a21f86c5f89e0c9cdd0">popcount</a>() == <a href="/docs/api/namespaces/llvm/#a646986783f35e0fef8988f0f28d2589f">Log2&#95;32</a>(CaseCount)) &#123;</span></CodeLine>
<Link id="l06359" /><CodeLine lineNumber="6359"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MinCaseVal-&gt;<a href="/docs/api/classes/llvm/constant/#ae4b6abe77abf42fb02081a6cc41a0132">isNullValue</a>())</span></CodeLine>
<Link id="l06360" /><CodeLine lineNumber="6360"><span class="doxyHighlight">          Condition = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(Condition, MinCaseVal);</span></CodeLine>
<Link id="l06361" /><CodeLine lineNumber="6361"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(Condition, ~BitMask, </span><span class="doxyHighlightStringLiteral">&quot;switch.and&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06362" /><CodeLine lineNumber="6362"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(</span></CodeLine>
<Link id="l06363" /><CodeLine lineNumber="6363"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>, <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eac33315685a0cba3ce53be378b3c7874b">And</a>-&gt;getType()), </span><span class="doxyHighlightStringLiteral">&quot;switch.selectcmp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06364" /><CodeLine lineNumber="6364"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(Cmp, ResultVector&#91;0&#93;.first, DefaultResult);</span></CodeLine>
<Link id="l06365" /><CodeLine lineNumber="6365"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06366" /><CodeLine lineNumber="6366"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06367" /><CodeLine lineNumber="6367"></CodeLine>
<Link id="l06368" /><CodeLine lineNumber="6368"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Handle the degenerate case where two cases have the same value.</span></CodeLine>
<Link id="l06369" /><CodeLine lineNumber="6369"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CaseValues.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 2) &#123;</span></CodeLine>
<Link id="l06370" /><CodeLine lineNumber="6370"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cmp1 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(Condition, CaseValues&#91;0&#93;,</span></CodeLine>
<Link id="l06371" /><CodeLine lineNumber="6371"><span class="doxyHighlight">                                         </span><span class="doxyHighlightStringLiteral">&quot;switch.selectcmp.case1&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06372" /><CodeLine lineNumber="6372"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cmp2 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(Condition, CaseValues&#91;1&#93;,</span></CodeLine>
<Link id="l06373" /><CodeLine lineNumber="6373"><span class="doxyHighlight">                                         </span><span class="doxyHighlightStringLiteral">&quot;switch.selectcmp.case2&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06374" /><CodeLine lineNumber="6374"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab61be8e3cf17e9848aeeeabacfa1b09a">CreateOr</a>(Cmp1, Cmp2, </span><span class="doxyHighlightStringLiteral">&quot;switch.selectcmp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06375" /><CodeLine lineNumber="6375"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(Cmp, ResultVector&#91;0&#93;.first, DefaultResult);</span></CodeLine>
<Link id="l06376" /><CodeLine lineNumber="6376"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06377" /><CodeLine lineNumber="6377"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06378" /><CodeLine lineNumber="6378"></CodeLine>
<Link id="l06379" /><CodeLine lineNumber="6379"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06380" /><CodeLine lineNumber="6380"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06381" /><CodeLine lineNumber="6381"></CodeLine>
<Link id="l06382" /><CodeLine lineNumber="6382"><span class="doxyHighlightComment">// Helper function to cleanup a switch instruction that has been converted into</span></CodeLine>
<Link id="l06383" /><CodeLine lineNumber="6383"><span class="doxyHighlightComment">// a select, fixing up PHI nodes and basic blocks.</span></CodeLine>
<Link id="l06384" /><CodeLine lineNumber="6384" lineLink="#a0ceff22bcbbcc85abecced9a3a395ccf"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a0ceff22bcbbcc85abecced9a3a395ccf">removeSwitchAfterSelectFold</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>,</span></CodeLine>
<Link id="l06385" /><CodeLine lineNumber="6385"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/value">Value</a> &#42;SelectValue,</span></CodeLine>
<Link id="l06386" /><CodeLine lineNumber="6386"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder,</span></CodeLine>
<Link id="l06387" /><CodeLine lineNumber="6387"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU) &#123;</span></CodeLine>
<Link id="l06388" /><CodeLine lineNumber="6388"><span class="doxyHighlight">  std::vector&lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l06389" /><CodeLine lineNumber="6389"></CodeLine>
<Link id="l06390" /><CodeLine lineNumber="6390"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SelectBB = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent();</span></CodeLine>
<Link id="l06391" /><CodeLine lineNumber="6391"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DestBB = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent();</span></CodeLine>
<Link id="l06392" /><CodeLine lineNumber="6392"></CodeLine>
<Link id="l06393" /><CodeLine lineNumber="6393"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU &amp;&amp; !<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(DestBB), SelectBB))</span></CodeLine>
<Link id="l06394" /><CodeLine lineNumber="6394"><span class="doxyHighlight">    Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, SelectBB, DestBB&#125;);</span></CodeLine>
<Link id="l06395" /><CodeLine lineNumber="6395"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(DestBB);</span></CodeLine>
<Link id="l06396" /><CodeLine lineNumber="6396"></CodeLine>
<Link id="l06397" /><CodeLine lineNumber="6397"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove the switch.</span></CodeLine>
<Link id="l06398" /><CodeLine lineNumber="6398"></CodeLine>
<Link id="l06399" /><CodeLine lineNumber="6399"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;removeIncomingValueIf(</span></CodeLine>
<Link id="l06400" /><CodeLine lineNumber="6400"><span class="doxyHighlight">      &#91;&amp;&#93;(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getIncomingBlock(Idx) == SelectBB; &#125;);</span></CodeLine>
<Link id="l06401" /><CodeLine lineNumber="6401"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(SelectValue, SelectBB);</span></CodeLine>
<Link id="l06402" /><CodeLine lineNumber="6402"></CodeLine>
<Link id="l06403" /><CodeLine lineNumber="6403"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 4&gt;</a> RemovedSuccessors;</span></CodeLine>
<Link id="l06404" /><CodeLine lineNumber="6404"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumSuccessors(); i &lt; e; ++i) &#123;</span></CodeLine>
<Link id="l06405" /><CodeLine lineNumber="6405"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getSuccessor(i);</span></CodeLine>
<Link id="l06406" /><CodeLine lineNumber="6406"></CodeLine>
<Link id="l06407" /><CodeLine lineNumber="6407"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ == DestBB)</span></CodeLine>
<Link id="l06408" /><CodeLine lineNumber="6408"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06409" /><CodeLine lineNumber="6409"><span class="doxyHighlight">    Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(SelectBB);</span></CodeLine>
<Link id="l06410" /><CodeLine lineNumber="6410"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU &amp;&amp; RemovedSuccessors.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Succ).second)</span></CodeLine>
<Link id="l06411" /><CodeLine lineNumber="6411"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, SelectBB, Succ&#125;);</span></CodeLine>
<Link id="l06412" /><CodeLine lineNumber="6412"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06413" /><CodeLine lineNumber="6413"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l06414" /><CodeLine lineNumber="6414"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l06415" /><CodeLine lineNumber="6415"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l06416" /><CodeLine lineNumber="6416"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06417" /><CodeLine lineNumber="6417"></CodeLine>
<Link id="l06418" /><CodeLine lineNumber="6418"><span class="doxyHighlightComment">/// If a switch is only used to initialize one or more phi nodes in a common</span></CodeLine>
<Link id="l06419" /><CodeLine lineNumber="6419"><span class="doxyHighlightComment">/// successor block with only two different constant values, try to replace the</span></CodeLine>
<Link id="l06420" /><CodeLine lineNumber="6420"><span class="doxyHighlightComment">/// switch with a select. Returns true if the fold was made.</span></CodeLine>
<Link id="l06421" /><CodeLine lineNumber="6421" lineLink="#a794d3a5f46134c24aade41b327d8418e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a794d3a5f46134c24aade41b327d8418e">trySwitchToSelect</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder,</span></CodeLine>
<Link id="l06422" /><CodeLine lineNumber="6422"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l06423" /><CodeLine lineNumber="6423"><span class="doxyHighlight">                              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l06424" /><CodeLine lineNumber="6424"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l06425" /><CodeLine lineNumber="6425"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06426" /><CodeLine lineNumber="6426"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CommonDest = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06427" /><CodeLine lineNumber="6427"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;DefaultResult;</span></CodeLine>
<Link id="l06428" /><CodeLine lineNumber="6428"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-simplifycfg-cpp-/#acc1b2160383f472d108b5eaa86ca3b23">SwitchCaseResultVectorTy</a> UniqueResults;</span></CodeLine>
<Link id="l06429" /><CodeLine lineNumber="6429"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect all the cases that will deliver the same value from the switch.</span></CodeLine>
<Link id="l06430" /><CodeLine lineNumber="6430"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a95851c48d68c2406ef12a7cca9c65f76">initializeUniqueCases</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, CommonDest, UniqueResults, DefaultResult,</span></CodeLine>
<Link id="l06431" /><CodeLine lineNumber="6431"><span class="doxyHighlight">                             <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, </span><span class="doxyHighlightComment">/&#42;MaxUniqueResults&#42;/</span><span class="doxyHighlight"> 2))</span></CodeLine>
<Link id="l06432" /><CodeLine lineNumber="6432"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06433" /><CodeLine lineNumber="6433"></CodeLine>
<Link id="l06434" /><CodeLine lineNumber="6434"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;PHI for value select not found&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06435" /><CodeLine lineNumber="6435"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l06436" /><CodeLine lineNumber="6436"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SelectValue =</span></CodeLine>
<Link id="l06437" /><CodeLine lineNumber="6437"><span class="doxyHighlight">      <a href="#a53f06c06e81412900ac140caaf764ff8">foldSwitchToSelect</a>(UniqueResults, DefaultResult, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, Builder);</span></CodeLine>
<Link id="l06438" /><CodeLine lineNumber="6438"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SelectValue)</span></CodeLine>
<Link id="l06439" /><CodeLine lineNumber="6439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06440" /><CodeLine lineNumber="6440"></CodeLine>
<Link id="l06441" /><CodeLine lineNumber="6441"><span class="doxyHighlight">  <a href="#a0ceff22bcbbcc85abecced9a3a395ccf">removeSwitchAfterSelectFold</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, SelectValue, Builder, DTU);</span></CodeLine>
<Link id="l06442" /><CodeLine lineNumber="6442"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06443" /><CodeLine lineNumber="6443"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06444" /><CodeLine lineNumber="6444"></CodeLine>
<Link id="l06445" /><CodeLine lineNumber="6445"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l06446" /><CodeLine lineNumber="6446"></CodeLine>
<Link id="l06447" /><CodeLine lineNumber="6447"><span class="doxyHighlightComment">/// This class represents a lookup table that can be used to replace a switch.</span></CodeLine>
<Link id="l06448" /><CodeLine lineNumber="6448" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a36955f44027693881a174e8d3f1d3854">SwitchLookupTable</a> &#123;</span></CodeLine>
<Link id="l06449" /><CodeLine lineNumber="6449"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l06450" /><CodeLine lineNumber="6450"><span class="doxyHighlightComment">  /// Create a lookup table to use as a switch replacement with the contents</span></CodeLine>
<Link id="l06451" /><CodeLine lineNumber="6451"><span class="doxyHighlightComment">  /// of Values, using DefaultValue to fill any holes in the table.</span></CodeLine>
<Link id="l06452" /><CodeLine lineNumber="6452"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a36955f44027693881a174e8d3f1d3854">SwitchLookupTable</a>(</span></CodeLine>
<Link id="l06453" /><CodeLine lineNumber="6453"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/module">Module</a> &amp;M, uint64&#95;t TableSize, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>,</span></CodeLine>
<Link id="l06454" /><CodeLine lineNumber="6454"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;ConstantInt &#42;, Constant &#42;&gt;&gt; &amp;Values,</span></CodeLine>
<Link id="l06455" /><CodeLine lineNumber="6455"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;DefaultValue, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> &amp;FuncName);</span></CodeLine>
<Link id="l06456" /><CodeLine lineNumber="6456"></CodeLine>
<Link id="l06457" /><CodeLine lineNumber="6457"><span class="doxyHighlightComment">  /// Build instructions with Builder to retrieve the value at</span></CodeLine>
<Link id="l06458" /><CodeLine lineNumber="6458"><span class="doxyHighlightComment">  /// the position given by Index in the lookup table.</span></CodeLine>
<Link id="l06459" /><CodeLine lineNumber="6459"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a41f4145f819d062ed7c74067ad334808">buildLookup</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Index, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder);</span></CodeLine>
<Link id="l06460" /><CodeLine lineNumber="6460"></CodeLine>
<Link id="l06461" /><CodeLine lineNumber="6461"><span class="doxyHighlightComment">  /// Return true if a table with TableSize elements of</span></CodeLine>
<Link id="l06462" /><CodeLine lineNumber="6462"><span class="doxyHighlightComment">  /// type ElementType would fit in a target-legal register.</span></CodeLine>
<Link id="l06463" /><CodeLine lineNumber="6463"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a19f38e85c02e7293ac20cdfc25f776df">wouldFitInRegister</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, uint64&#95;t TableSize,</span></CodeLine>
<Link id="l06464" /><CodeLine lineNumber="6464"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/type">Type</a> &#42;ElementType);</span></CodeLine>
<Link id="l06465" /><CodeLine lineNumber="6465"></CodeLine>
<Link id="l06466" /><CodeLine lineNumber="6466"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l06467" /><CodeLine lineNumber="6467"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Depending on the contents of the table, it can be represented in</span></CodeLine>
<Link id="l06468" /><CodeLine lineNumber="6468"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// different ways.</span></CodeLine>
<Link id="l06469" /><CodeLine lineNumber="6469"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06470" /><CodeLine lineNumber="6470"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For tables where each element contains the same value, we just have to</span></CodeLine>
<Link id="l06471" /><CodeLine lineNumber="6471"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// store that single value and return it for each lookup.</span></CodeLine>
<Link id="l06472" /><CodeLine lineNumber="6472"><span class="doxyHighlight">    SingleValueKind,</span></CodeLine>
<Link id="l06473" /><CodeLine lineNumber="6473"></CodeLine>
<Link id="l06474" /><CodeLine lineNumber="6474"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For tables where there is a linear relationship between table index</span></CodeLine>
<Link id="l06475" /><CodeLine lineNumber="6475"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and values. We calculate the result with a simple multiplication</span></CodeLine>
<Link id="l06476" /><CodeLine lineNumber="6476"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and addition instead of a table lookup.</span></CodeLine>
<Link id="l06477" /><CodeLine lineNumber="6477"><span class="doxyHighlight">    LinearMapKind,</span></CodeLine>
<Link id="l06478" /><CodeLine lineNumber="6478"></CodeLine>
<Link id="l06479" /><CodeLine lineNumber="6479"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For small tables with integer elements, we can pack them into a bitmap</span></CodeLine>
<Link id="l06480" /><CodeLine lineNumber="6480"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that fits into a target-legal register. Values are retrieved by</span></CodeLine>
<Link id="l06481" /><CodeLine lineNumber="6481"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// shift and mask operations.</span></CodeLine>
<Link id="l06482" /><CodeLine lineNumber="6482"><span class="doxyHighlight">    BitMapKind,</span></CodeLine>
<Link id="l06483" /><CodeLine lineNumber="6483"></CodeLine>
<Link id="l06484" /><CodeLine lineNumber="6484"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The table is stored as an array of values. Values are retrieved by load</span></CodeLine>
<Link id="l06485" /><CodeLine lineNumber="6485"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions from the table.</span></CodeLine>
<Link id="l06486" /><CodeLine lineNumber="6486"><span class="doxyHighlight">    ArrayKind</span></CodeLine>
<Link id="l06487" /><CodeLine lineNumber="6487"><span class="doxyHighlight">  &#125; Kind;</span></CodeLine>
<Link id="l06488" /><CodeLine lineNumber="6488"></CodeLine>
<Link id="l06489" /><CodeLine lineNumber="6489"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For SingleValueKind, this is the single value.</span></CodeLine>
<Link id="l06490" /><CodeLine lineNumber="6490"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SingleValue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06491" /><CodeLine lineNumber="6491"></CodeLine>
<Link id="l06492" /><CodeLine lineNumber="6492"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For BitMapKind, this is the bitmap.</span></CodeLine>
<Link id="l06493" /><CodeLine lineNumber="6493"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;BitMap = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06494" /><CodeLine lineNumber="6494"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;BitMapElementTy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06495" /><CodeLine lineNumber="6495"></CodeLine>
<Link id="l06496" /><CodeLine lineNumber="6496"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For LinearMapKind, these are the constants used to derive the value.</span></CodeLine>
<Link id="l06497" /><CodeLine lineNumber="6497"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;LinearOffset = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06498" /><CodeLine lineNumber="6498"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;LinearMultiplier = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06499" /><CodeLine lineNumber="6499"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LinearMapValWrapped = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06500" /><CodeLine lineNumber="6500"></CodeLine>
<Link id="l06501" /><CodeLine lineNumber="6501"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For ArrayKind, this is the array.</span></CodeLine>
<Link id="l06502" /><CodeLine lineNumber="6502"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;Array = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06503" /><CodeLine lineNumber="6503"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l06504" /><CodeLine lineNumber="6504"></CodeLine>
<Link id="l06505" /><CodeLine lineNumber="6505"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l06506" /><CodeLine lineNumber="6506"></CodeLine>
<Link id="l06507" /><CodeLine lineNumber="6507" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a36955f44027693881a174e8d3f1d3854"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a36955f44027693881a174e8d3f1d3854">SwitchLookupTable::SwitchLookupTable</a>(</span></CodeLine>
<Link id="l06508" /><CodeLine lineNumber="6508"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/module">Module</a> &amp;M, uint64&#95;t TableSize, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>,</span></CodeLine>
<Link id="l06509" /><CodeLine lineNumber="6509"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;ConstantInt &#42;, Constant &#42;&gt;&gt; &amp;Values,</span></CodeLine>
<Link id="l06510" /><CodeLine lineNumber="6510"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;DefaultValue, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> &amp;FuncName) &#123;</span></CodeLine>
<Link id="l06511" /><CodeLine lineNumber="6511"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t build lookup table without values!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06512" /><CodeLine lineNumber="6512"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TableSize &gt;= Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t fit values in table!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06513" /><CodeLine lineNumber="6513"></CodeLine>
<Link id="l06514" /><CodeLine lineNumber="6514"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If all values in the table are equal, this is that value.</span></CodeLine>
<Link id="l06515" /><CodeLine lineNumber="6515"><span class="doxyHighlight">  SingleValue = Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>()-&gt;second;</span></CodeLine>
<Link id="l06516" /><CodeLine lineNumber="6516"></CodeLine>
<Link id="l06517" /><CodeLine lineNumber="6517"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a> = Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>()-&gt;second-&gt;getType();</span></CodeLine>
<Link id="l06518" /><CodeLine lineNumber="6518"></CodeLine>
<Link id="l06519" /><CodeLine lineNumber="6519"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build up the table contents.</span></CodeLine>
<Link id="l06520" /><CodeLine lineNumber="6520"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;, 64&gt;</a> TableContents(TableSize);</span></CodeLine>
<Link id="l06521" /><CodeLine lineNumber="6521"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l06522" /><CodeLine lineNumber="6522"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CaseVal = Values&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;.first;</span></CodeLine>
<Link id="l06523" /><CodeLine lineNumber="6523"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CaseRes = Values&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;.second;</span></CodeLine>
<Link id="l06524" /><CodeLine lineNumber="6524"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CaseRes-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == <a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>);</span></CodeLine>
<Link id="l06525" /><CodeLine lineNumber="6525"></CodeLine>
<Link id="l06526" /><CodeLine lineNumber="6526"><span class="doxyHighlight">    uint64&#95;t Idx = (CaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>() - <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>-&gt;getValue()).getLimitedValue();</span></CodeLine>
<Link id="l06527" /><CodeLine lineNumber="6527"><span class="doxyHighlight">    TableContents&#91;Idx&#93; = CaseRes;</span></CodeLine>
<Link id="l06528" /><CodeLine lineNumber="6528"></CodeLine>
<Link id="l06529" /><CodeLine lineNumber="6529"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SingleValue &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(CaseRes) &amp;&amp; CaseRes != SingleValue)</span></CodeLine>
<Link id="l06530" /><CodeLine lineNumber="6530"><span class="doxyHighlight">      SingleValue = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(SingleValue) ? CaseRes : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06531" /><CodeLine lineNumber="6531"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06532" /><CodeLine lineNumber="6532"></CodeLine>
<Link id="l06533" /><CodeLine lineNumber="6533"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Fill in any holes in the table with the default result.</span></CodeLine>
<Link id="l06534" /><CodeLine lineNumber="6534"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt; TableSize) &#123;</span></CodeLine>
<Link id="l06535" /><CodeLine lineNumber="6535"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DefaultValue &amp;&amp;</span></CodeLine>
<Link id="l06536" /><CodeLine lineNumber="6536"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Need a default value to fill the lookup table holes.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06537" /><CodeLine lineNumber="6537"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DefaultValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == <a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>);</span></CodeLine>
<Link id="l06538" /><CodeLine lineNumber="6538"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (uint64&#95;t <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; TableSize; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l06539" /><CodeLine lineNumber="6539"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TableContents&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;)</span></CodeLine>
<Link id="l06540" /><CodeLine lineNumber="6540"><span class="doxyHighlight">        TableContents&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = DefaultValue;</span></CodeLine>
<Link id="l06541" /><CodeLine lineNumber="6541"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06542" /><CodeLine lineNumber="6542"></CodeLine>
<Link id="l06543" /><CodeLine lineNumber="6543"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the default value is poison, all the holes are poison.</span></CodeLine>
<Link id="l06544" /><CodeLine lineNumber="6544"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DefaultValueIsPoison = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(DefaultValue);</span></CodeLine>
<Link id="l06545" /><CodeLine lineNumber="6545"></CodeLine>
<Link id="l06546" /><CodeLine lineNumber="6546"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefaultValue != SingleValue &amp;&amp; !DefaultValueIsPoison)</span></CodeLine>
<Link id="l06547" /><CodeLine lineNumber="6547"><span class="doxyHighlight">      SingleValue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06548" /><CodeLine lineNumber="6548"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06549" /><CodeLine lineNumber="6549"></CodeLine>
<Link id="l06550" /><CodeLine lineNumber="6550"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If each element in the table contains the same value, we only need to store</span></CodeLine>
<Link id="l06551" /><CodeLine lineNumber="6551"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that single value.</span></CodeLine>
<Link id="l06552" /><CodeLine lineNumber="6552"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SingleValue) &#123;</span></CodeLine>
<Link id="l06553" /><CodeLine lineNumber="6553"><span class="doxyHighlight">    Kind = SingleValueKind;</span></CodeLine>
<Link id="l06554" /><CodeLine lineNumber="6554"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06555" /><CodeLine lineNumber="6555"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06556" /><CodeLine lineNumber="6556"></CodeLine>
<Link id="l06557" /><CodeLine lineNumber="6557"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if we can derive the value with a linear transformation from the</span></CodeLine>
<Link id="l06558" /><CodeLine lineNumber="6558"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// table index.</span></CodeLine>
<Link id="l06559" /><CodeLine lineNumber="6559"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntegerType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>)) &#123;</span></CodeLine>
<Link id="l06560" /><CodeLine lineNumber="6560"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LinearMappingPossible = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06561" /><CodeLine lineNumber="6561"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/apint">APInt</a> PrevVal;</span></CodeLine>
<Link id="l06562" /><CodeLine lineNumber="6562"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/apint">APInt</a> DistToPrev;</span></CodeLine>
<Link id="l06563" /><CodeLine lineNumber="6563"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// When linear map is monotonic and signed overflow doesn&#39;t happen on</span></CodeLine>
<Link id="l06564" /><CodeLine lineNumber="6564"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// maximum index, we can attach nsw on Add and Mul.</span></CodeLine>
<Link id="l06565" /><CodeLine lineNumber="6565"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NonMonotonic = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06566" /><CodeLine lineNumber="6566"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TableSize &gt;= 2 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Should be a SingleValue table.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06567" /><CodeLine lineNumber="6567"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if there is the same distance between two consecutive values.</span></CodeLine>
<Link id="l06568" /><CodeLine lineNumber="6568"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (uint64&#95;t <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; TableSize; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l06569" /><CodeLine lineNumber="6569"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;ConstVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(TableContents&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</span></CodeLine>
<Link id="l06570" /><CodeLine lineNumber="6570"></CodeLine>
<Link id="l06571" /><CodeLine lineNumber="6571"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ConstVal &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PoisonValue&gt;</a>(TableContents&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;)) &#123;</span></CodeLine>
<Link id="l06572" /><CodeLine lineNumber="6572"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// This is an poison, so it&#39;s (probably) a lookup table hole.</span></CodeLine>
<Link id="l06573" /><CodeLine lineNumber="6573"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// To prevent any regressions from before we switched to using poison as</span></CodeLine>
<Link id="l06574" /><CodeLine lineNumber="6574"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the default value, holes will fall back to using the first value.</span></CodeLine>
<Link id="l06575" /><CodeLine lineNumber="6575"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// This can be removed once we add proper handling for poisons in lookup</span></CodeLine>
<Link id="l06576" /><CodeLine lineNumber="6576"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// tables.</span></CodeLine>
<Link id="l06577" /><CodeLine lineNumber="6577"><span class="doxyHighlight">        ConstVal = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Values&#91;0&#93;.second);</span></CodeLine>
<Link id="l06578" /><CodeLine lineNumber="6578"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06579" /><CodeLine lineNumber="6579"></CodeLine>
<Link id="l06580" /><CodeLine lineNumber="6580"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ConstVal) &#123;</span></CodeLine>
<Link id="l06581" /><CodeLine lineNumber="6581"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// This is an undef. We could deal with it, but undefs in lookup tables</span></CodeLine>
<Link id="l06582" /><CodeLine lineNumber="6582"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// are very seldom. It&#39;s probably not worth the additional complexity.</span></CodeLine>
<Link id="l06583" /><CodeLine lineNumber="6583"><span class="doxyHighlight">        LinearMappingPossible = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06584" /><CodeLine lineNumber="6584"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06585" /><CodeLine lineNumber="6585"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06586" /><CodeLine lineNumber="6586"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;Val = ConstVal-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>();</span></CodeLine>
<Link id="l06587" /><CodeLine lineNumber="6587"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != 0) &#123;</span></CodeLine>
<Link id="l06588" /><CodeLine lineNumber="6588"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/apint">APInt</a> Dist = Val - PrevVal;</span></CodeLine>
<Link id="l06589" /><CodeLine lineNumber="6589"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == 1) &#123;</span></CodeLine>
<Link id="l06590" /><CodeLine lineNumber="6590"><span class="doxyHighlight">          DistToPrev = Dist;</span></CodeLine>
<Link id="l06591" /><CodeLine lineNumber="6591"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Dist != DistToPrev) &#123;</span></CodeLine>
<Link id="l06592" /><CodeLine lineNumber="6592"><span class="doxyHighlight">          LinearMappingPossible = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06593" /><CodeLine lineNumber="6593"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06594" /><CodeLine lineNumber="6594"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l06595" /><CodeLine lineNumber="6595"><span class="doxyHighlight">        NonMonotonic |=</span></CodeLine>
<Link id="l06596" /><CodeLine lineNumber="6596"><span class="doxyHighlight">            Dist.<a href="/docs/api/classes/llvm/apint/#aa17c104fbda554c818cf87e53f32f20a">isStrictlyPositive</a>() ? Val.<a href="/docs/api/classes/llvm/apint/#a7e8226e6453c8bcf7e5c06d28b1e207b">sle</a>(PrevVal) : Val.<a href="/docs/api/classes/llvm/apint/#a3d430216d32f4363e4df154599b98055">sgt</a>(PrevVal);</span></CodeLine>
<Link id="l06597" /><CodeLine lineNumber="6597"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06598" /><CodeLine lineNumber="6598"><span class="doxyHighlight">      PrevVal = Val;</span></CodeLine>
<Link id="l06599" /><CodeLine lineNumber="6599"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06600" /><CodeLine lineNumber="6600"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LinearMappingPossible) &#123;</span></CodeLine>
<Link id="l06601" /><CodeLine lineNumber="6601"><span class="doxyHighlight">      LinearOffset = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(TableContents&#91;0&#93;);</span></CodeLine>
<Link id="l06602" /><CodeLine lineNumber="6602"><span class="doxyHighlight">      LinearMultiplier = ConstantInt::get(M.getContext(), DistToPrev);</span></CodeLine>
<Link id="l06603" /><CodeLine lineNumber="6603"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a> M = LinearMultiplier-&gt;getValue();</span></CodeLine>
<Link id="l06604" /><CodeLine lineNumber="6604"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MayWrap = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06605" /><CodeLine lineNumber="6605"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aad80b46c754cc7216244a866ec9b1cb0">isIntN</a>(M.getBitWidth(), TableSize - 1))</span></CodeLine>
<Link id="l06606" /><CodeLine lineNumber="6606"><span class="doxyHighlight">        (void)M.<a href="/docs/api/classes/llvm/apint/#ac155d7c568fc1aba25723e77b6888908">smul&#95;ov</a>(<a href="/docs/api/classes/llvm/apint">APInt</a>(M.getBitWidth(), TableSize - 1), MayWrap);</span></CodeLine>
<Link id="l06607" /><CodeLine lineNumber="6607"><span class="doxyHighlight">      LinearMapValWrapped = NonMonotonic || MayWrap;</span></CodeLine>
<Link id="l06608" /><CodeLine lineNumber="6608"><span class="doxyHighlight">      Kind = LinearMapKind;</span></CodeLine>
<Link id="l06609" /><CodeLine lineNumber="6609"><span class="doxyHighlight">      ++NumLinearMaps;</span></CodeLine>
<Link id="l06610" /><CodeLine lineNumber="6610"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06611" /><CodeLine lineNumber="6611"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06612" /><CodeLine lineNumber="6612"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06613" /><CodeLine lineNumber="6613"></CodeLine>
<Link id="l06614" /><CodeLine lineNumber="6614"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the type is integer and the table fits in a register, build a bitmap.</span></CodeLine>
<Link id="l06615" /><CodeLine lineNumber="6615"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a19f38e85c02e7293ac20cdfc25f776df">wouldFitInRegister</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TableSize, <a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>)) &#123;</span></CodeLine>
<Link id="l06616" /><CodeLine lineNumber="6616"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>);</span></CodeLine>
<Link id="l06617" /><CodeLine lineNumber="6617"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/apint">APInt</a> TableInt(TableSize &#42; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>-&gt;getBitWidth(), 0);</span></CodeLine>
<Link id="l06618" /><CodeLine lineNumber="6618"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (uint64&#95;t <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = TableSize; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt; 0; --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l06619" /><CodeLine lineNumber="6619"><span class="doxyHighlight">      TableInt &lt;&lt;= <a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>-&gt;getBitWidth();</span></CodeLine>
<Link id="l06620" /><CodeLine lineNumber="6620"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Insert values into the bitmap. Undef values are set to zero.</span></CodeLine>
<Link id="l06621" /><CodeLine lineNumber="6621"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(TableContents&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1&#93;)) &#123;</span></CodeLine>
<Link id="l06622" /><CodeLine lineNumber="6622"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Val = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(TableContents&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> - 1&#93;);</span></CodeLine>
<Link id="l06623" /><CodeLine lineNumber="6623"><span class="doxyHighlight">        TableInt |= Val-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#a1dc76cc8bf703e6ada68bededcbb9573">zext</a>(TableInt.<a href="/docs/api/classes/llvm/apint/#a512fe2c15ea651294688eeec1341644c">getBitWidth</a>());</span></CodeLine>
<Link id="l06624" /><CodeLine lineNumber="6624"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06625" /><CodeLine lineNumber="6625"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06626" /><CodeLine lineNumber="6626"><span class="doxyHighlight">    BitMap = ConstantInt::get(M.getContext(), TableInt);</span></CodeLine>
<Link id="l06627" /><CodeLine lineNumber="6627"><span class="doxyHighlight">    BitMapElementTy = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>;</span></CodeLine>
<Link id="l06628" /><CodeLine lineNumber="6628"><span class="doxyHighlight">    Kind = BitMapKind;</span></CodeLine>
<Link id="l06629" /><CodeLine lineNumber="6629"><span class="doxyHighlight">    ++NumBitMaps;</span></CodeLine>
<Link id="l06630" /><CodeLine lineNumber="6630"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06631" /><CodeLine lineNumber="6631"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06632" /><CodeLine lineNumber="6632"></CodeLine>
<Link id="l06633" /><CodeLine lineNumber="6633"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Store the table in an array.</span></CodeLine>
<Link id="l06634" /><CodeLine lineNumber="6634"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/arraytype">ArrayType</a> &#42;ArrayTy = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(<a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>, TableSize);</span></CodeLine>
<Link id="l06635" /><CodeLine lineNumber="6635"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Initializer = <a href="/docs/api/classes/llvm/constantarray/#a0900dacdc7ad8e3ea0cc92993c7fd422">ConstantArray::get</a>(ArrayTy, TableContents);</span></CodeLine>
<Link id="l06636" /><CodeLine lineNumber="6636"></CodeLine>
<Link id="l06637" /><CodeLine lineNumber="6637"><span class="doxyHighlight">  Array = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(M, ArrayTy, </span><span class="doxyHighlightComment">/&#42;isConstant=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06638" /><CodeLine lineNumber="6638"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca04ed141708c0fd16723d212502b046ae">GlobalVariable::PrivateLinkage</a>, Initializer,</span></CodeLine>
<Link id="l06639" /><CodeLine lineNumber="6639"><span class="doxyHighlight">                             </span><span class="doxyHighlightStringLiteral">&quot;switch.table.&quot;</span><span class="doxyHighlight"> + FuncName);</span></CodeLine>
<Link id="l06640" /><CodeLine lineNumber="6640"><span class="doxyHighlight">  Array-&gt;setUnnamedAddr(<a href="/docs/api/classes/llvm/globalvalue/#ae8df4be75bfc50b1eadd74e85c25fa45a4cc6684df7b4a92b1dec6fce3264fac8">GlobalValue::UnnamedAddr::Global</a>);</span></CodeLine>
<Link id="l06641" /><CodeLine lineNumber="6641"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set the alignment to that of an array items. We will be only loading one</span></CodeLine>
<Link id="l06642" /><CodeLine lineNumber="6642"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// value out of it.</span></CodeLine>
<Link id="l06643" /><CodeLine lineNumber="6643"><span class="doxyHighlight">  Array-&gt;setAlignment(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPrefTypeAlign(<a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>));</span></CodeLine>
<Link id="l06644" /><CodeLine lineNumber="6644"><span class="doxyHighlight">  Kind = ArrayKind;</span></CodeLine>
<Link id="l06645" /><CodeLine lineNumber="6645"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06646" /><CodeLine lineNumber="6646"></CodeLine>
<Link id="l06647" /><CodeLine lineNumber="6647" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a41f4145f819d062ed7c74067ad334808"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a41f4145f819d062ed7c74067ad334808">SwitchLookupTable::buildLookup</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Index, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l06648" /><CodeLine lineNumber="6648"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Kind) &#123;</span></CodeLine>
<Link id="l06649" /><CodeLine lineNumber="6649"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> SingleValueKind:</span></CodeLine>
<Link id="l06650" /><CodeLine lineNumber="6650"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SingleValue;</span></CodeLine>
<Link id="l06651" /><CodeLine lineNumber="6651"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> LinearMapKind: &#123;</span></CodeLine>
<Link id="l06652" /><CodeLine lineNumber="6652"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Derive the result value from the input value.</span></CodeLine>
<Link id="l06653" /><CodeLine lineNumber="6653"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Result = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac79ca3c2d2d74cf33684397a91846564">CreateIntCast</a>(Index, LinearMultiplier-&gt;getType(),</span></CodeLine>
<Link id="l06654" /><CodeLine lineNumber="6654"><span class="doxyHighlight">                                          </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;switch.idx.cast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06655" /><CodeLine lineNumber="6655"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LinearMultiplier-&gt;isOne())</span></CodeLine>
<Link id="l06656" /><CodeLine lineNumber="6656"><span class="doxyHighlight">      Result = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aecd40f9a16dc0ef1e0bc416599f89277">CreateMul</a>(Result, LinearMultiplier, </span><span class="doxyHighlightStringLiteral">&quot;switch.idx.mult&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06657" /><CodeLine lineNumber="6657"><span class="doxyHighlight">                                 </span><span class="doxyHighlightComment">/&#42;HasNUW = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06658" /><CodeLine lineNumber="6658"><span class="doxyHighlight">                                 </span><span class="doxyHighlightComment">/&#42;HasNSW = &#42;/</span><span class="doxyHighlight"> !LinearMapValWrapped);</span></CodeLine>
<Link id="l06659" /><CodeLine lineNumber="6659"></CodeLine>
<Link id="l06660" /><CodeLine lineNumber="6660"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LinearOffset-&gt;isZero())</span></CodeLine>
<Link id="l06661" /><CodeLine lineNumber="6661"><span class="doxyHighlight">      Result = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(Result, LinearOffset, </span><span class="doxyHighlightStringLiteral">&quot;switch.offset&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06662" /><CodeLine lineNumber="6662"><span class="doxyHighlight">                                 </span><span class="doxyHighlightComment">/&#42;HasNUW = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06663" /><CodeLine lineNumber="6663"><span class="doxyHighlight">                                 </span><span class="doxyHighlightComment">/&#42;HasNSW = &#42;/</span><span class="doxyHighlight"> !LinearMapValWrapped);</span></CodeLine>
<Link id="l06664" /><CodeLine lineNumber="6664"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l06665" /><CodeLine lineNumber="6665"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06666" /><CodeLine lineNumber="6666"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> BitMapKind: &#123;</span></CodeLine>
<Link id="l06667" /><CodeLine lineNumber="6667"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Type of the bitmap (e.g. i59).</span></CodeLine>
<Link id="l06668" /><CodeLine lineNumber="6668"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;MapTy = BitMap-&gt;getIntegerType();</span></CodeLine>
<Link id="l06669" /><CodeLine lineNumber="6669"></CodeLine>
<Link id="l06670" /><CodeLine lineNumber="6670"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Cast Index to the same type as the bitmap.</span></CodeLine>
<Link id="l06671" /><CodeLine lineNumber="6671"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note: The Index is &lt;= the number of elements in the table, so</span></CodeLine>
<Link id="l06672" /><CodeLine lineNumber="6672"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// truncating it to the width of the bitmask is safe.</span></CodeLine>
<Link id="l06673" /><CodeLine lineNumber="6673"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ShiftAmt = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a36742c35a8fff5f74bb3d76c9c19dd47">CreateZExtOrTrunc</a>(Index, MapTy, </span><span class="doxyHighlightStringLiteral">&quot;switch.cast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06674" /><CodeLine lineNumber="6674"></CodeLine>
<Link id="l06675" /><CodeLine lineNumber="6675"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Multiply the shift amount by the element width. NUW/NSW can always be</span></CodeLine>
<Link id="l06676" /><CodeLine lineNumber="6676"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// set, because wouldFitInRegister guarantees Index &#42; ShiftAmt is in</span></CodeLine>
<Link id="l06677" /><CodeLine lineNumber="6677"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// BitMap&#39;s bit width.</span></CodeLine>
<Link id="l06678" /><CodeLine lineNumber="6678"><span class="doxyHighlight">    ShiftAmt = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aecd40f9a16dc0ef1e0bc416599f89277">CreateMul</a>(</span></CodeLine>
<Link id="l06679" /><CodeLine lineNumber="6679"><span class="doxyHighlight">        ShiftAmt, ConstantInt::get(MapTy, BitMapElementTy-&gt;getBitWidth()),</span></CodeLine>
<Link id="l06680" /><CodeLine lineNumber="6680"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;switch.shiftamt&quot;</span><span class="doxyHighlight">,</span><span class="doxyHighlightComment">/&#42;HasNUW =&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span><span class="doxyHighlightComment">/&#42;HasNSW =&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06681" /><CodeLine lineNumber="6681"></CodeLine>
<Link id="l06682" /><CodeLine lineNumber="6682"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Shift down.</span></CodeLine>
<Link id="l06683" /><CodeLine lineNumber="6683"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;DownShifted =</span></CodeLine>
<Link id="l06684" /><CodeLine lineNumber="6684"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5849d19e500f8c6713ec44889058f424">CreateLShr</a>(BitMap, ShiftAmt, </span><span class="doxyHighlightStringLiteral">&quot;switch.downshift&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06685" /><CodeLine lineNumber="6685"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Mask off.</span></CodeLine>
<Link id="l06686" /><CodeLine lineNumber="6686"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(DownShifted, BitMapElementTy, </span><span class="doxyHighlightStringLiteral">&quot;switch.masked&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06687" /><CodeLine lineNumber="6687"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06688" /><CodeLine lineNumber="6688"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> ArrayKind: &#123;</span></CodeLine>
<Link id="l06689" /><CodeLine lineNumber="6689"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure the table index will not overflow when treated as signed.</span></CodeLine>
<Link id="l06690" /><CodeLine lineNumber="6690"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(Index-&gt;getType());</span></CodeLine>
<Link id="l06691" /><CodeLine lineNumber="6691"><span class="doxyHighlight">    uint64&#95;t TableSize =</span></CodeLine>
<Link id="l06692" /><CodeLine lineNumber="6692"><span class="doxyHighlight">        Array-&gt;getInitializer()-&gt;getType()-&gt;getArrayNumElements();</span></CodeLine>
<Link id="l06693" /><CodeLine lineNumber="6693"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TableSize &gt; (1ULL &lt;&lt; std::min(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>-&gt;getBitWidth() - 1, 63u)))</span></CodeLine>
<Link id="l06694" /><CodeLine lineNumber="6694"><span class="doxyHighlight">      Index = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9e6950f7f17700d5c0d61ad0b846ec5c">CreateZExt</a>(</span></CodeLine>
<Link id="l06695" /><CodeLine lineNumber="6695"><span class="doxyHighlight">          Index, <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>-&gt;getContext(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>-&gt;getBitWidth() + 1),</span></CodeLine>
<Link id="l06696" /><CodeLine lineNumber="6696"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;switch.tableidx.zext&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06697" /><CodeLine lineNumber="6697"></CodeLine>
<Link id="l06698" /><CodeLine lineNumber="6698"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;GEPIndices&#91;&#93; = &#123;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(0), Index&#125;;</span></CodeLine>
<Link id="l06699" /><CodeLine lineNumber="6699"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(Array-&gt;getValueType(), Array,</span></CodeLine>
<Link id="l06700" /><CodeLine lineNumber="6700"><span class="doxyHighlight">                                           GEPIndices, </span><span class="doxyHighlightStringLiteral">&quot;switch.gep&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06701" /><CodeLine lineNumber="6701"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(</span></CodeLine>
<Link id="l06702" /><CodeLine lineNumber="6702"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ArrayType&gt;</a>(Array-&gt;getValueType())-&gt;getElementType(), <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</span></CodeLine>
<Link id="l06703" /><CodeLine lineNumber="6703"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;switch.load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06704" /><CodeLine lineNumber="6704"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06705" /><CodeLine lineNumber="6705"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06706" /><CodeLine lineNumber="6706"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unknown lookup table kind!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06707" /><CodeLine lineNumber="6707"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06708" /><CodeLine lineNumber="6708"></CodeLine>
<Link id="l06709" /><CodeLine lineNumber="6709" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a19f38e85c02e7293ac20cdfc25f776df"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a19f38e85c02e7293ac20cdfc25f776df">SwitchLookupTable::wouldFitInRegister</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l06710" /><CodeLine lineNumber="6710"><span class="doxyHighlight">                                           uint64&#95;t TableSize,</span></CodeLine>
<Link id="l06711" /><CodeLine lineNumber="6711"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/type">Type</a> &#42;ElementType) &#123;</span></CodeLine>
<Link id="l06712" /><CodeLine lineNumber="6712"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntegerType&gt;</a>(ElementType);</span></CodeLine>
<Link id="l06713" /><CodeLine lineNumber="6713"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>)</span></CodeLine>
<Link id="l06714" /><CodeLine lineNumber="6714"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06715" /><CodeLine lineNumber="6715"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: If the type is wider than it needs to be, e.g. i8 but all values</span></CodeLine>
<Link id="l06716" /><CodeLine lineNumber="6716"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are &lt;= 15, we could try to narrow the type.</span></CodeLine>
<Link id="l06717" /><CodeLine lineNumber="6717"></CodeLine>
<Link id="l06718" /><CodeLine lineNumber="6718"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid overflow, fitsInLegalInteger uses unsigned int for the width.</span></CodeLine>
<Link id="l06719" /><CodeLine lineNumber="6719"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TableSize &gt;= UINT&#95;MAX / <a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>-&gt;getBitWidth())</span></CodeLine>
<Link id="l06720" /><CodeLine lineNumber="6720"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06721" /><CodeLine lineNumber="6721"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.fitsInLegalInteger(TableSize &#42; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>-&gt;getBitWidth());</span></CodeLine>
<Link id="l06722" /><CodeLine lineNumber="6722"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06723" /><CodeLine lineNumber="6723"></CodeLine>
<Link id="l06724" /><CodeLine lineNumber="6724" lineLink="#a7ef36c3b9f5334218cf1b3b7e8e33569"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a7ef36c3b9f5334218cf1b3b7e8e33569">isTypeLegalForLookupTable</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l06725" /><CodeLine lineNumber="6725"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l06726" /><CodeLine lineNumber="6726"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Allow any legal type.</span></CodeLine>
<Link id="l06727" /><CodeLine lineNumber="6727"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.isTypeLegal(Ty))</span></CodeLine>
<Link id="l06728" /><CodeLine lineNumber="6728"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06729" /><CodeLine lineNumber="6729"></CodeLine>
<Link id="l06730" /><CodeLine lineNumber="6730"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntegerType&gt;</a>(Ty);</span></CodeLine>
<Link id="l06731" /><CodeLine lineNumber="6731"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>)</span></CodeLine>
<Link id="l06732" /><CodeLine lineNumber="6732"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06733" /><CodeLine lineNumber="6733"></CodeLine>
<Link id="l06734" /><CodeLine lineNumber="6734"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Also allow power of 2 integer types that have at least 8 bits and fit in</span></CodeLine>
<Link id="l06735" /><CodeLine lineNumber="6735"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a register. These types are common in frontend languages and targets</span></CodeLine>
<Link id="l06736" /><CodeLine lineNumber="6736"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// usually support loads of these types.</span></CodeLine>
<Link id="l06737" /><CodeLine lineNumber="6737"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We could relax this to any integer that fits in a register and rely</span></CodeLine>
<Link id="l06738" /><CodeLine lineNumber="6738"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// on ABI alignment and padding in the table to allow the load to be widened.</span></CodeLine>
<Link id="l06739" /><CodeLine lineNumber="6739"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Or we could widen the constants and truncate the load.</span></CodeLine>
<Link id="l06740" /><CodeLine lineNumber="6740"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>-&gt;getBitWidth();</span></CodeLine>
<Link id="l06741" /><CodeLine lineNumber="6741"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> &gt;= 8 &amp;&amp; <a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>) &amp;&amp;</span></CodeLine>
<Link id="l06742" /><CodeLine lineNumber="6742"><span class="doxyHighlight">         <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.fitsInLegalInteger(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>-&gt;getBitWidth());</span></CodeLine>
<Link id="l06743" /><CodeLine lineNumber="6743"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06744" /><CodeLine lineNumber="6744"></CodeLine>
<Link id="l06745" /><CodeLine lineNumber="6745" lineLink="#a7c6e64e4a4dbba951d47fe2b1d188b2c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(uint64&#95;t NumCases, uint64&#95;t CaseRange) &#123;</span></CodeLine>
<Link id="l06746" /><CodeLine lineNumber="6746"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 40% is the default density for building a jump table in optsize/minsize</span></CodeLine>
<Link id="l06747" /><CodeLine lineNumber="6747"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// mode. See also TargetLoweringBase::isSuitableForJumpTable(), which this</span></CodeLine>
<Link id="l06748" /><CodeLine lineNumber="6748"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function was based on.</span></CodeLine>
<Link id="l06749" /><CodeLine lineNumber="6749"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t MinDensity = 40;</span></CodeLine>
<Link id="l06750" /><CodeLine lineNumber="6750"></CodeLine>
<Link id="l06751" /><CodeLine lineNumber="6751"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CaseRange &gt;= <a href="/docs/api/files/include/include/llvm-c/datatypes-h/#a30654b4b67d97c42ca3f9b6052dda916">UINT64&#95;MAX</a> / 100)</span></CodeLine>
<Link id="l06752" /><CodeLine lineNumber="6752"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Avoid multiplication overflows below.</span></CodeLine>
<Link id="l06753" /><CodeLine lineNumber="6753"></CodeLine>
<Link id="l06754" /><CodeLine lineNumber="6754"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NumCases &#42; 100 &gt;= CaseRange &#42; MinDensity;</span></CodeLine>
<Link id="l06755" /><CodeLine lineNumber="6755"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06756" /><CodeLine lineNumber="6756"></CodeLine>
<Link id="l06757" /><CodeLine lineNumber="6757" lineLink="#aa28651c1e85585ae702f652a8df06019"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;int64&#95;t&gt;</a> Values) &#123;</span></CodeLine>
<Link id="l06758" /><CodeLine lineNumber="6758"><span class="doxyHighlight">  uint64&#95;t Diff = (uint64&#95;t)Values.<a href="/docs/api/classes/llvm/arrayref/#a291ac49156942529f159a9ec003cc25f">back</a>() - (uint64&#95;t)Values.<a href="/docs/api/classes/llvm/arrayref/#a721fc555cb3d8dc2a1a680dcc2ce69b2">front</a>();</span></CodeLine>
<Link id="l06759" /><CodeLine lineNumber="6759"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a> = Diff + 1;</span></CodeLine>
<Link id="l06760" /><CodeLine lineNumber="6760"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a> &lt; Diff)</span></CodeLine>
<Link id="l06761" /><CodeLine lineNumber="6761"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// Overflow.</span></CodeLine>
<Link id="l06762" /><CodeLine lineNumber="6762"></CodeLine>
<Link id="l06763" /><CodeLine lineNumber="6763"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(Values.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</span></CodeLine>
<Link id="l06764" /><CodeLine lineNumber="6764"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06765" /><CodeLine lineNumber="6765"></CodeLine>
<Link id="l06766" /><CodeLine lineNumber="6766"><span class="doxyHighlightComment">/// Determine whether a lookup table should be built for this switch, based on</span></CodeLine>
<Link id="l06767" /><CodeLine lineNumber="6767"><span class="doxyHighlightComment">/// the number of cases, size of the table, and the types of the results.</span></CodeLine>
<Link id="l06768" /><CodeLine lineNumber="6768"><span class="doxyHighlightComment">// TODO: We could support larger than legal types by limiting based on the</span></CodeLine>
<Link id="l06769" /><CodeLine lineNumber="6769"><span class="doxyHighlightComment">// number of loads required and/or table size. If the constants are small we</span></CodeLine>
<Link id="l06770" /><CodeLine lineNumber="6770"><span class="doxyHighlightComment">// could use smaller table entries and extend after the load.</span></CodeLine>
<Link id="l06771" /><CodeLine lineNumber="6771"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l06772" /><CodeLine lineNumber="6772" lineLink="#a5efd178c4162515b93c85a967395564e"><span class="doxyHighlight"><a href="#a5efd178c4162515b93c85a967395564e">shouldBuildLookupTable</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, uint64&#95;t TableSize,</span></CodeLine>
<Link id="l06773" /><CodeLine lineNumber="6773"><span class="doxyHighlight">                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l06774" /><CodeLine lineNumber="6774"><span class="doxyHighlight">                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;PHINode &#42;, Type &#42;&gt;</a> &amp;ResultTypes) &#123;</span></CodeLine>
<Link id="l06775" /><CodeLine lineNumber="6775"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases() &gt; TableSize)</span></CodeLine>
<Link id="l06776" /><CodeLine lineNumber="6776"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// TableSize overflowed.</span></CodeLine>
<Link id="l06777" /><CodeLine lineNumber="6777"></CodeLine>
<Link id="l06778" /><CodeLine lineNumber="6778"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllTablesFitInRegister = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06779" /><CodeLine lineNumber="6779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasIllegalType = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06780" /><CodeLine lineNumber="6780"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : ResultTypes) &#123;</span></CodeLine>
<Link id="l06781" /><CodeLine lineNumber="6781"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second;</span></CodeLine>
<Link id="l06782" /><CodeLine lineNumber="6782"></CodeLine>
<Link id="l06783" /><CodeLine lineNumber="6783"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Saturate this flag to true.</span></CodeLine>
<Link id="l06784" /><CodeLine lineNumber="6784"><span class="doxyHighlight">    HasIllegalType = HasIllegalType || !<a href="#a7ef36c3b9f5334218cf1b3b7e8e33569">isTypeLegalForLookupTable</a>(Ty, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l06785" /><CodeLine lineNumber="6785"></CodeLine>
<Link id="l06786" /><CodeLine lineNumber="6786"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Saturate this flag to false.</span></CodeLine>
<Link id="l06787" /><CodeLine lineNumber="6787"><span class="doxyHighlight">    AllTablesFitInRegister =</span></CodeLine>
<Link id="l06788" /><CodeLine lineNumber="6788"><span class="doxyHighlight">        AllTablesFitInRegister &amp;&amp;</span></CodeLine>
<Link id="l06789" /><CodeLine lineNumber="6789"><span class="doxyHighlight">        <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a19f38e85c02e7293ac20cdfc25f776df">SwitchLookupTable::wouldFitInRegister</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TableSize, Ty);</span></CodeLine>
<Link id="l06790" /><CodeLine lineNumber="6790"></CodeLine>
<Link id="l06791" /><CodeLine lineNumber="6791"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If both flags saturate, we&#39;re done. NOTE: This &#42;only&#42; works with</span></CodeLine>
<Link id="l06792" /><CodeLine lineNumber="6792"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// saturating flags, and all flags have to saturate first due to the</span></CodeLine>
<Link id="l06793" /><CodeLine lineNumber="6793"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// non-deterministic behavior of iterating over a dense map.</span></CodeLine>
<Link id="l06794" /><CodeLine lineNumber="6794"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasIllegalType &amp;&amp; !AllTablesFitInRegister)</span></CodeLine>
<Link id="l06795" /><CodeLine lineNumber="6795"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06796" /><CodeLine lineNumber="6796"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06797" /><CodeLine lineNumber="6797"></CodeLine>
<Link id="l06798" /><CodeLine lineNumber="6798"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If each table would fit in a register, we should build it anyway.</span></CodeLine>
<Link id="l06799" /><CodeLine lineNumber="6799"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllTablesFitInRegister)</span></CodeLine>
<Link id="l06800" /><CodeLine lineNumber="6800"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06801" /><CodeLine lineNumber="6801"></CodeLine>
<Link id="l06802" /><CodeLine lineNumber="6802"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t build a table that doesn&#39;t fit in-register if it has illegal types.</span></CodeLine>
<Link id="l06803" /><CodeLine lineNumber="6803"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasIllegalType)</span></CodeLine>
<Link id="l06804" /><CodeLine lineNumber="6804"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06805" /><CodeLine lineNumber="6805"></CodeLine>
<Link id="l06806" /><CodeLine lineNumber="6806"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases(), TableSize);</span></CodeLine>
<Link id="l06807" /><CodeLine lineNumber="6807"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06808" /><CodeLine lineNumber="6808"></CodeLine>
<Link id="l06809" /><CodeLine lineNumber="6809" lineLink="#a9bb113178ba0769ba9abbfa1e896f6f0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a9bb113178ba0769ba9abbfa1e896f6f0">shouldUseSwitchConditionAsTableIndex</a>(</span></CodeLine>
<Link id="l06810" /><CodeLine lineNumber="6810"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &amp;MinCaseVal, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &amp;MaxCaseVal,</span></CodeLine>
<Link id="l06811" /><CodeLine lineNumber="6811"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasDefaultResults, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;PHINode &#42;, Type &#42;&gt;</a> &amp;ResultTypes,</span></CodeLine>
<Link id="l06812" /><CodeLine lineNumber="6812"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l06813" /><CodeLine lineNumber="6813"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MinCaseVal.<a href="/docs/api/classes/llvm/constant/#ae4b6abe77abf42fb02081a6cc41a0132">isNullValue</a>())</span></CodeLine>
<Link id="l06814" /><CodeLine lineNumber="6814"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06815" /><CodeLine lineNumber="6815"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MinCaseVal.<a href="/docs/api/classes/llvm/constantint/#a2a8c8be274f3bd351e083ab3828c14c7">isNegative</a>() ||</span></CodeLine>
<Link id="l06816" /><CodeLine lineNumber="6816"><span class="doxyHighlight">      MaxCaseVal.<a href="/docs/api/classes/llvm/constantint/#a31e8da5adf63afd38b4ab94bca823150">getLimitedValue</a>() == std::numeric&#95;limits&lt;uint64&#95;t&gt;::max() ||</span></CodeLine>
<Link id="l06817" /><CodeLine lineNumber="6817"><span class="doxyHighlight">      !HasDefaultResults)</span></CodeLine>
<Link id="l06818" /><CodeLine lineNumber="6818"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06819" /><CodeLine lineNumber="6819"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(ResultTypes, &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;KV) &#123;</span></CodeLine>
<Link id="l06820" /><CodeLine lineNumber="6820"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a19f38e85c02e7293ac20cdfc25f776df">SwitchLookupTable::wouldFitInRegister</a>(</span></CodeLine>
<Link id="l06821" /><CodeLine lineNumber="6821"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, MaxCaseVal.<a href="/docs/api/classes/llvm/constantint/#a31e8da5adf63afd38b4ab94bca823150">getLimitedValue</a>() + 1 </span><span class="doxyHighlightComment">/&#42; TableSize &#42;/</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06822" /><CodeLine lineNumber="6822"><span class="doxyHighlight">        KV.second </span><span class="doxyHighlightComment">/&#42; ResultType &#42;/</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06823" /><CodeLine lineNumber="6823"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l06824" /><CodeLine lineNumber="6824"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06825" /><CodeLine lineNumber="6825"></CodeLine>
<Link id="l06826" /><CodeLine lineNumber="6826"><span class="doxyHighlightComment">/// Try to reuse the switch table index compare. Following pattern:</span></CodeLine>
<Link id="l06827" /><CodeLine lineNumber="6827"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l06828" /><CodeLine lineNumber="6828"><span class="doxyHighlightComment">///     if (idx &lt; tablesize)</span></CodeLine>
<Link id="l06829" /><CodeLine lineNumber="6829"><span class="doxyHighlightComment">///        r = table&#91;idx&#93;; // table does not contain default&#95;value</span></CodeLine>
<Link id="l06830" /><CodeLine lineNumber="6830"><span class="doxyHighlightComment">///     else</span></CodeLine>
<Link id="l06831" /><CodeLine lineNumber="6831"><span class="doxyHighlightComment">///        r = default&#95;value;</span></CodeLine>
<Link id="l06832" /><CodeLine lineNumber="6832"><span class="doxyHighlightComment">///     if (r != default&#95;value)</span></CodeLine>
<Link id="l06833" /><CodeLine lineNumber="6833"><span class="doxyHighlightComment">///        ...</span></CodeLine>
<Link id="l06834" /><CodeLine lineNumber="6834"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l06835" /><CodeLine lineNumber="6835"><span class="doxyHighlightComment">/// Is optimized to:</span></CodeLine>
<Link id="l06836" /><CodeLine lineNumber="6836"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l06837" /><CodeLine lineNumber="6837"><span class="doxyHighlightComment">///     cond = idx &lt; tablesize;</span></CodeLine>
<Link id="l06838" /><CodeLine lineNumber="6838"><span class="doxyHighlightComment">///     if (cond)</span></CodeLine>
<Link id="l06839" /><CodeLine lineNumber="6839"><span class="doxyHighlightComment">///        r = table&#91;idx&#93;;</span></CodeLine>
<Link id="l06840" /><CodeLine lineNumber="6840"><span class="doxyHighlightComment">///     else</span></CodeLine>
<Link id="l06841" /><CodeLine lineNumber="6841"><span class="doxyHighlightComment">///        r = default&#95;value;</span></CodeLine>
<Link id="l06842" /><CodeLine lineNumber="6842"><span class="doxyHighlightComment">///     if (cond)</span></CodeLine>
<Link id="l06843" /><CodeLine lineNumber="6843"><span class="doxyHighlightComment">///        ...</span></CodeLine>
<Link id="l06844" /><CodeLine lineNumber="6844"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l06845" /><CodeLine lineNumber="6845"><span class="doxyHighlightComment">/// Jump threading will then eliminate the second if(cond).</span></CodeLine>
<Link id="l06846" /><CodeLine lineNumber="6846" lineLink="#ad75372cc26ff6f641159aed90d5fc11e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ad75372cc26ff6f641159aed90d5fc11e">reuseTableCompare</a>(</span></CodeLine>
<Link id="l06847" /><CodeLine lineNumber="6847"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/user">User</a> &#42;PhiUser, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PhiBlock, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;RangeCheckBranch,</span></CodeLine>
<Link id="l06848" /><CodeLine lineNumber="6848"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;DefaultValue,</span></CodeLine>
<Link id="l06849" /><CodeLine lineNumber="6849"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;ConstantInt &#42;, Constant &#42;&gt;&gt; &amp;Values) &#123;</span></CodeLine>
<Link id="l06850" /><CodeLine lineNumber="6850"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(PhiUser);</span></CodeLine>
<Link id="l06851" /><CodeLine lineNumber="6851"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a>)</span></CodeLine>
<Link id="l06852" /><CodeLine lineNumber="6852"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06853" /><CodeLine lineNumber="6853"></CodeLine>
<Link id="l06854" /><CodeLine lineNumber="6854"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We require that the compare is in the same block as the phi so that jump</span></CodeLine>
<Link id="l06855" /><CodeLine lineNumber="6855"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// threading can do its work afterwards.</span></CodeLine>
<Link id="l06856" /><CodeLine lineNumber="6856"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a>-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != PhiBlock)</span></CodeLine>
<Link id="l06857" /><CodeLine lineNumber="6857"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06858" /><CodeLine lineNumber="6858"></CodeLine>
<Link id="l06859" /><CodeLine lineNumber="6859"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CmpOp1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(<a href="/docs/api/classes/llvm/cmpinst">CmpInst</a>-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l06860" /><CodeLine lineNumber="6860"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CmpOp1)</span></CodeLine>
<Link id="l06861" /><CodeLine lineNumber="6861"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06862" /><CodeLine lineNumber="6862"></CodeLine>
<Link id="l06863" /><CodeLine lineNumber="6863"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RangeCmp = RangeCheckBranch-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l06864" /><CodeLine lineNumber="6864"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;TrueConst = <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(RangeCmp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l06865" /><CodeLine lineNumber="6865"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;FalseConst = <a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(RangeCmp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l06866" /><CodeLine lineNumber="6866"></CodeLine>
<Link id="l06867" /><CodeLine lineNumber="6867"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if the compare with the default value is constant true or false.</span></CodeLine>
<Link id="l06868" /><CodeLine lineNumber="6868"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = PhiBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a858cab21fd29000697171b2f5b4bde31">getDataLayout</a>();</span></CodeLine>
<Link id="l06869" /><CodeLine lineNumber="6869"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;DefaultConst = <a href="/docs/api/namespaces/llvm/#a3cd3a3ec28036937ecebe767498ba55d">ConstantFoldCompareInstOperands</a>(</span></CodeLine>
<Link id="l06870" /><CodeLine lineNumber="6870"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a>-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>(), DefaultValue, CmpOp1, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l06871" /><CodeLine lineNumber="6871"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefaultConst != TrueConst &amp;&amp; DefaultConst != FalseConst)</span></CodeLine>
<Link id="l06872" /><CodeLine lineNumber="6872"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06873" /><CodeLine lineNumber="6873"></CodeLine>
<Link id="l06874" /><CodeLine lineNumber="6874"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if the compare with the case values is distinct from the default</span></CodeLine>
<Link id="l06875" /><CodeLine lineNumber="6875"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// compare result.</span></CodeLine>
<Link id="l06876" /><CodeLine lineNumber="6876"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ValuePair : Values) &#123;</span></CodeLine>
<Link id="l06877" /><CodeLine lineNumber="6877"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CaseConst = <a href="/docs/api/namespaces/llvm/#a3cd3a3ec28036937ecebe767498ba55d">ConstantFoldCompareInstOperands</a>(</span></CodeLine>
<Link id="l06878" /><CodeLine lineNumber="6878"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a>-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>(), ValuePair.second, CmpOp1, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l06879" /><CodeLine lineNumber="6879"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CaseConst || CaseConst == DefaultConst ||</span></CodeLine>
<Link id="l06880" /><CodeLine lineNumber="6880"><span class="doxyHighlight">        (CaseConst != TrueConst &amp;&amp; CaseConst != FalseConst))</span></CodeLine>
<Link id="l06881" /><CodeLine lineNumber="6881"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06882" /><CodeLine lineNumber="6882"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06883" /><CodeLine lineNumber="6883"></CodeLine>
<Link id="l06884" /><CodeLine lineNumber="6884"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if the branch instruction dominates the phi node. It&#39;s a simple</span></CodeLine>
<Link id="l06885" /><CodeLine lineNumber="6885"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dominance check, but sufficient for our needs.</span></CodeLine>
<Link id="l06886" /><CodeLine lineNumber="6886"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Although this check is invariant in the calling loops, it&#39;s better to do it</span></CodeLine>
<Link id="l06887" /><CodeLine lineNumber="6887"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// at this late stage. Practically we do it at most once for a switch.</span></CodeLine>
<Link id="l06888" /><CodeLine lineNumber="6888"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BranchBlock = RangeCheckBranch-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l06889" /><CodeLine lineNumber="6889"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(PhiBlock)) &#123;</span></CodeLine>
<Link id="l06890" /><CodeLine lineNumber="6890"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred != BranchBlock &amp;&amp; Pred-&gt;<a href="/docs/api/classes/llvm/basicblock/#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>() != BranchBlock)</span></CodeLine>
<Link id="l06891" /><CodeLine lineNumber="6891"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06892" /><CodeLine lineNumber="6892"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06893" /><CodeLine lineNumber="6893"></CodeLine>
<Link id="l06894" /><CodeLine lineNumber="6894"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefaultConst == FalseConst) &#123;</span></CodeLine>
<Link id="l06895" /><CodeLine lineNumber="6895"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The compare yields the same result. We can replace it.</span></CodeLine>
<Link id="l06896" /><CodeLine lineNumber="6896"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a>-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(RangeCmp);</span></CodeLine>
<Link id="l06897" /><CodeLine lineNumber="6897"><span class="doxyHighlight">    ++NumTableCmpReuses;</span></CodeLine>
<Link id="l06898" /><CodeLine lineNumber="6898"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06899" /><CodeLine lineNumber="6899"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The compare yields the same result, just inverted. We can replace it.</span></CodeLine>
<Link id="l06900" /><CodeLine lineNumber="6900"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;InvertedTableCmp = BinaryOperator::CreateXor(</span></CodeLine>
<Link id="l06901" /><CodeLine lineNumber="6901"><span class="doxyHighlight">        RangeCmp, ConstantInt::get(RangeCmp-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 1), </span><span class="doxyHighlightStringLiteral">&quot;inverted.cmp&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06902" /><CodeLine lineNumber="6902"><span class="doxyHighlight">        RangeCheckBranch-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l06903" /><CodeLine lineNumber="6903"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/cmpinst">CmpInst</a>-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(InvertedTableCmp);</span></CodeLine>
<Link id="l06904" /><CodeLine lineNumber="6904"><span class="doxyHighlight">    ++NumTableCmpReuses;</span></CodeLine>
<Link id="l06905" /><CodeLine lineNumber="6905"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06906" /><CodeLine lineNumber="6906"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06907" /><CodeLine lineNumber="6907"></CodeLine>
<Link id="l06908" /><CodeLine lineNumber="6908"><span class="doxyHighlightComment">/// If the switch is only used to initialize one or more phi nodes in a common</span></CodeLine>
<Link id="l06909" /><CodeLine lineNumber="6909"><span class="doxyHighlightComment">/// successor block with different constant values, replace the switch with</span></CodeLine>
<Link id="l06910" /><CodeLine lineNumber="6910"><span class="doxyHighlightComment">/// lookup tables.</span></CodeLine>
<Link id="l06911" /><CodeLine lineNumber="6911" lineLink="#a4abbfca67cb7fc77432aa8cd48af8b0a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a4abbfca67cb7fc77432aa8cd48af8b0a">switchToLookupTable</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder,</span></CodeLine>
<Link id="l06912" /><CodeLine lineNumber="6912"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l06913" /><CodeLine lineNumber="6913"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l06914" /><CodeLine lineNumber="6914"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases() &gt; 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Degenerate switch?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06915" /><CodeLine lineNumber="6915"></CodeLine>
<Link id="l06916" /><CodeLine lineNumber="6916"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent();</span></CodeLine>
<Link id="l06917" /><CodeLine lineNumber="6917"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Fn = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l06918" /><CodeLine lineNumber="6918"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only build lookup table when we have a target that supports it or the</span></CodeLine>
<Link id="l06919" /><CodeLine lineNumber="6919"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// attribute is not set.</span></CodeLine>
<Link id="l06920" /><CodeLine lineNumber="6920"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.shouldBuildLookupTables() ||</span></CodeLine>
<Link id="l06921" /><CodeLine lineNumber="6921"><span class="doxyHighlight">      (Fn-&gt;<a href="/docs/api/classes/llvm/function/#a4c319db4fe05c27cfe55bd133a87414d">getFnAttribute</a>(</span><span class="doxyHighlightStringLiteral">&quot;no-jump-tables&quot;</span><span class="doxyHighlight">).<a href="/docs/api/classes/llvm/attribute/#a70f42ed02a8993b84bdf97da5d54d097">getValueAsBool</a>()))</span></CodeLine>
<Link id="l06922" /><CodeLine lineNumber="6922"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06923" /><CodeLine lineNumber="6923"></CodeLine>
<Link id="l06924" /><CodeLine lineNumber="6924"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: If the switch is too sparse for a lookup table, perhaps we could</span></CodeLine>
<Link id="l06925" /><CodeLine lineNumber="6925"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// split off a dense part and build a lookup table for that.</span></CodeLine>
<Link id="l06926" /><CodeLine lineNumber="6926"></CodeLine>
<Link id="l06927" /><CodeLine lineNumber="6927"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: This creates arrays of GEPs to constant strings, which means each</span></CodeLine>
<Link id="l06928" /><CodeLine lineNumber="6928"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// GEP needs a runtime relocation in PIC code. We should just build one big</span></CodeLine>
<Link id="l06929" /><CodeLine lineNumber="6929"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// string and lookup indices into that.</span></CodeLine>
<Link id="l06930" /><CodeLine lineNumber="6930"></CodeLine>
<Link id="l06931" /><CodeLine lineNumber="6931"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ignore switches with less than three cases. Lookup tables will not make</span></CodeLine>
<Link id="l06932" /><CodeLine lineNumber="6932"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them faster, so we don&#39;t analyze them.</span></CodeLine>
<Link id="l06933" /><CodeLine lineNumber="6933"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases() &lt; 3)</span></CodeLine>
<Link id="l06934" /><CodeLine lineNumber="6934"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06935" /><CodeLine lineNumber="6935"></CodeLine>
<Link id="l06936" /><CodeLine lineNumber="6936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Figure out the corresponding result for each case value and phi node in the</span></CodeLine>
<Link id="l06937" /><CodeLine lineNumber="6937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// common destination, as well as the min and max case values.</span></CodeLine>
<Link id="l06938" /><CodeLine lineNumber="6938"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases().empty());</span></CodeLine>
<Link id="l06939" /><CodeLine lineNumber="6939"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/switchinst/#a723af715edeaedc8ed1048f8c235ce9e">SwitchInst::CaseIt</a> CI = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;case&#95;begin();</span></CodeLine>
<Link id="l06940" /><CodeLine lineNumber="6940"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;MinCaseVal = CI-&gt;getCaseValue();</span></CodeLine>
<Link id="l06941" /><CodeLine lineNumber="6941"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;MaxCaseVal = CI-&gt;getCaseValue();</span></CodeLine>
<Link id="l06942" /><CodeLine lineNumber="6942"></CodeLine>
<Link id="l06943" /><CodeLine lineNumber="6943"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CommonDest = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06944" /><CodeLine lineNumber="6944"></CodeLine>
<Link id="l06945" /><CodeLine lineNumber="6945"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">ResultListTy = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;ConstantInt &#42;, Constant &#42;&gt;</a>, 4&gt;;</span></CodeLine>
<Link id="l06946" /><CodeLine lineNumber="6946"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;PHINode &#42;, ResultListTy&gt;</a> ResultLists;</span></CodeLine>
<Link id="l06947" /><CodeLine lineNumber="6947"></CodeLine>
<Link id="l06948" /><CodeLine lineNumber="6948"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;PHINode &#42;, Constant &#42;&gt;</a> DefaultResults;</span></CodeLine>
<Link id="l06949" /><CodeLine lineNumber="6949"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;PHINode &#42;, Type &#42;&gt;</a> ResultTypes;</span></CodeLine>
<Link id="l06950" /><CodeLine lineNumber="6950"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHINode &#42;, 4&gt;</a> PHIs;</span></CodeLine>
<Link id="l06951" /><CodeLine lineNumber="6951"></CodeLine>
<Link id="l06952" /><CodeLine lineNumber="6952"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/switchinst/#a723af715edeaedc8ed1048f8c235ce9e">SwitchInst::CaseIt</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;case&#95;end(); CI != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++CI) &#123;</span></CodeLine>
<Link id="l06953" /><CodeLine lineNumber="6953"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CaseVal = CI-&gt;getCaseValue();</span></CodeLine>
<Link id="l06954" /><CodeLine lineNumber="6954"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#adafa9575780f9246d1df0b7e2a619356">slt</a>(MinCaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>()))</span></CodeLine>
<Link id="l06955" /><CodeLine lineNumber="6955"><span class="doxyHighlight">      MinCaseVal = CaseVal;</span></CodeLine>
<Link id="l06956" /><CodeLine lineNumber="6956"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#a3d430216d32f4363e4df154599b98055">sgt</a>(MaxCaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>()))</span></CodeLine>
<Link id="l06957" /><CodeLine lineNumber="6957"><span class="doxyHighlight">      MaxCaseVal = CaseVal;</span></CodeLine>
<Link id="l06958" /><CodeLine lineNumber="6958"></CodeLine>
<Link id="l06959" /><CodeLine lineNumber="6959"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Resulting value at phi nodes for this case value.</span></CodeLine>
<Link id="l06960" /><CodeLine lineNumber="6960"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">ResultsTy = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;PHINode &#42;, Constant &#42;&gt;</a>, 4&gt;;</span></CodeLine>
<Link id="l06961" /><CodeLine lineNumber="6961"><span class="doxyHighlight">    ResultsTy <a href="/docs/api/files/lib/lib/analysis/aliasanalysis-cpp/#a7e344cff0feadf0b02223fee63cc7475">Results</a>;</span></CodeLine>
<Link id="l06962" /><CodeLine lineNumber="6962"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a31070c67db84f4caef376dcb7906c4fb">getCaseResults</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, CaseVal, CI-&gt;getCaseSuccessor(), &amp;CommonDest,</span></CodeLine>
<Link id="l06963" /><CodeLine lineNumber="6963"><span class="doxyHighlight">                        <a href="/docs/api/files/lib/lib/analysis/aliasanalysis-cpp/#a7e344cff0feadf0b02223fee63cc7475">Results</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l06964" /><CodeLine lineNumber="6964"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06965" /><CodeLine lineNumber="6965"></CodeLine>
<Link id="l06966" /><CodeLine lineNumber="6966"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Append the result from this case to the list for each phi.</span></CodeLine>
<Link id="l06967" /><CodeLine lineNumber="6967"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/files/lib/lib/analysis/aliasanalysis-cpp/#a7e344cff0feadf0b02223fee63cc7475">Results</a>) &#123;</span></CodeLine>
<Link id="l06968" /><CodeLine lineNumber="6968"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.first;</span></CodeLine>
<Link id="l06969" /><CodeLine lineNumber="6969"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/classes/llvm/value">Value</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second;</span></CodeLine>
<Link id="l06970" /><CodeLine lineNumber="6970"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ResultLists.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>))</span></CodeLine>
<Link id="l06971" /><CodeLine lineNumber="6971"><span class="doxyHighlight">        PHIs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>);</span></CodeLine>
<Link id="l06972" /><CodeLine lineNumber="6972"><span class="doxyHighlight">      ResultLists&#91;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>&#93;.push&#95;back(std::make&#95;pair(CaseVal, <a href="/docs/api/classes/llvm/value">Value</a>));</span></CodeLine>
<Link id="l06973" /><CodeLine lineNumber="6973"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06974" /><CodeLine lineNumber="6974"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06975" /><CodeLine lineNumber="6975"></CodeLine>
<Link id="l06976" /><CodeLine lineNumber="6976"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep track of the result types.</span></CodeLine>
<Link id="l06977" /><CodeLine lineNumber="6977"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : PHIs) &#123;</span></CodeLine>
<Link id="l06978" /><CodeLine lineNumber="6978"><span class="doxyHighlight">    ResultTypes&#91;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>&#93; = ResultLists&#91;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>&#93;&#91;0&#93;.second-&gt;getType();</span></CodeLine>
<Link id="l06979" /><CodeLine lineNumber="6979"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06980" /><CodeLine lineNumber="6980"></CodeLine>
<Link id="l06981" /><CodeLine lineNumber="6981"><span class="doxyHighlight">  uint64&#95;t NumResults = ResultLists&#91;PHIs&#91;0&#93;&#93;.<a href="/docs/api/classes/llvm/densemapbase/#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>();</span></CodeLine>
<Link id="l06982" /><CodeLine lineNumber="6982"></CodeLine>
<Link id="l06983" /><CodeLine lineNumber="6983"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the table has holes, we need a constant result for the default case</span></CodeLine>
<Link id="l06984" /><CodeLine lineNumber="6984"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or a bitmask that fits in a register.</span></CodeLine>
<Link id="l06985" /><CodeLine lineNumber="6985"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;PHINode &#42;, Constant &#42;&gt;</a>, 4&gt; DefaultResultsList;</span></CodeLine>
<Link id="l06986" /><CodeLine lineNumber="6986"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasDefaultResults =</span></CodeLine>
<Link id="l06987" /><CodeLine lineNumber="6987"><span class="doxyHighlight">      <a href="#a31070c67db84f4caef376dcb7906c4fb">getCaseResults</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest(), &amp;CommonDest,</span></CodeLine>
<Link id="l06988" /><CodeLine lineNumber="6988"><span class="doxyHighlight">                     DefaultResultsList, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l06989" /><CodeLine lineNumber="6989"></CodeLine>
<Link id="l06990" /><CodeLine lineNumber="6990"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DefaultResultsList) &#123;</span></CodeLine>
<Link id="l06991" /><CodeLine lineNumber="6991"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.first;</span></CodeLine>
<Link id="l06992" /><CodeLine lineNumber="6992"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Result = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second;</span></CodeLine>
<Link id="l06993" /><CodeLine lineNumber="6993"><span class="doxyHighlight">    DefaultResults&#91;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>&#93; = Result;</span></CodeLine>
<Link id="l06994" /><CodeLine lineNumber="6994"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06995" /><CodeLine lineNumber="6995"></CodeLine>
<Link id="l06996" /><CodeLine lineNumber="6996"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseSwitchConditionAsTableIndex = <a href="#a9bb113178ba0769ba9abbfa1e896f6f0">shouldUseSwitchConditionAsTableIndex</a>(</span></CodeLine>
<Link id="l06997" /><CodeLine lineNumber="6997"><span class="doxyHighlight">      &#42;MinCaseVal, &#42;MaxCaseVal, HasDefaultResults, ResultTypes, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l06998" /><CodeLine lineNumber="6998"><span class="doxyHighlight">  uint64&#95;t TableSize;</span></CodeLine>
<Link id="l06999" /><CodeLine lineNumber="6999"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseSwitchConditionAsTableIndex)</span></CodeLine>
<Link id="l07000" /><CodeLine lineNumber="7000"><span class="doxyHighlight">    TableSize = MaxCaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#a31e8da5adf63afd38b4ab94bca823150">getLimitedValue</a>() + 1;</span></CodeLine>
<Link id="l07001" /><CodeLine lineNumber="7001"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l07002" /><CodeLine lineNumber="7002"><span class="doxyHighlight">    TableSize =</span></CodeLine>
<Link id="l07003" /><CodeLine lineNumber="7003"><span class="doxyHighlight">        (MaxCaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>() - MinCaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>()).getLimitedValue() + 1;</span></CodeLine>
<Link id="l07004" /><CodeLine lineNumber="7004"></CodeLine>
<Link id="l07005" /><CodeLine lineNumber="7005"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the default destination is unreachable, or if the lookup table covers</span></CodeLine>
<Link id="l07006" /><CodeLine lineNumber="7006"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// all values of the conditional variable, branch directly to the lookup table</span></CodeLine>
<Link id="l07007" /><CodeLine lineNumber="7007"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// BB. Otherwise, check that the condition is within the case range.</span></CodeLine>
<Link id="l07008" /><CodeLine lineNumber="7008"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DefaultIsReachable = !<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;defaultDestUndefined();</span></CodeLine>
<Link id="l07009" /><CodeLine lineNumber="7009"></CodeLine>
<Link id="l07010" /><CodeLine lineNumber="7010"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TableHasHoles = (NumResults &lt; TableSize);</span></CodeLine>
<Link id="l07011" /><CodeLine lineNumber="7011"></CodeLine>
<Link id="l07012" /><CodeLine lineNumber="7012"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the table has holes but the default destination doesn&#39;t produce any</span></CodeLine>
<Link id="l07013" /><CodeLine lineNumber="7013"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// constant results, the lookup table entries corresponding to the holes will</span></CodeLine>
<Link id="l07014" /><CodeLine lineNumber="7014"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// contain poison.</span></CodeLine>
<Link id="l07015" /><CodeLine lineNumber="7015"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllHolesArePoison = TableHasHoles &amp;&amp; !HasDefaultResults;</span></CodeLine>
<Link id="l07016" /><CodeLine lineNumber="7016"></CodeLine>
<Link id="l07017" /><CodeLine lineNumber="7017"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the default destination doesn&#39;t produce a constant result but is still</span></CodeLine>
<Link id="l07018" /><CodeLine lineNumber="7018"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reachable, and the lookup table has holes, we need to use a mask to</span></CodeLine>
<Link id="l07019" /><CodeLine lineNumber="7019"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// determine if the current index should load from the lookup table or jump</span></CodeLine>
<Link id="l07020" /><CodeLine lineNumber="7020"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to the default case.</span></CodeLine>
<Link id="l07021" /><CodeLine lineNumber="7021"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The mask is unnecessary if the table has holes but the default destination</span></CodeLine>
<Link id="l07022" /><CodeLine lineNumber="7022"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is unreachable, as in that case the holes must also be unreachable.</span></CodeLine>
<Link id="l07023" /><CodeLine lineNumber="7023"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedMask = AllHolesArePoison &amp;&amp; DefaultIsReachable;</span></CodeLine>
<Link id="l07024" /><CodeLine lineNumber="7024"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedMask) &#123;</span></CodeLine>
<Link id="l07025" /><CodeLine lineNumber="7025"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// As an extra penalty for the validity test we require more cases.</span></CodeLine>
<Link id="l07026" /><CodeLine lineNumber="7026"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases() &lt; 4) </span><span class="doxyHighlightComment">// FIXME: Find best threshold value (benchmark).</span></CodeLine>
<Link id="l07027" /><CodeLine lineNumber="7027"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07028" /><CodeLine lineNumber="7028"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.fitsInLegalInteger(TableSize))</span></CodeLine>
<Link id="l07029" /><CodeLine lineNumber="7029"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07030" /><CodeLine lineNumber="7030"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07031" /><CodeLine lineNumber="7031"></CodeLine>
<Link id="l07032" /><CodeLine lineNumber="7032"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a5efd178c4162515b93c85a967395564e">shouldBuildLookupTable</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, TableSize, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ResultTypes))</span></CodeLine>
<Link id="l07033" /><CodeLine lineNumber="7033"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07034" /><CodeLine lineNumber="7034"></CodeLine>
<Link id="l07035" /><CodeLine lineNumber="7035"><span class="doxyHighlight">  std::vector&lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l07036" /><CodeLine lineNumber="7036"></CodeLine>
<Link id="l07037" /><CodeLine lineNumber="7037"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute the maximum table size representable by the integer type we are</span></CodeLine>
<Link id="l07038" /><CodeLine lineNumber="7038"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// switching upon.</span></CodeLine>
<Link id="l07039" /><CodeLine lineNumber="7039"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CaseSize = MinCaseVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a833daf718a49c5cd637d8c9ddeaebe07">getPrimitiveSizeInBits</a>();</span></CodeLine>
<Link id="l07040" /><CodeLine lineNumber="7040"><span class="doxyHighlight">  uint64&#95;t MaxTableSize = CaseSize &gt; 63 ? <a href="/docs/api/files/include/include/llvm-c/datatypes-h/#a30654b4b67d97c42ca3f9b6052dda916">UINT64&#95;MAX</a> : 1ULL &lt;&lt; CaseSize;</span></CodeLine>
<Link id="l07041" /><CodeLine lineNumber="7041"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MaxTableSize &gt;= TableSize &amp;&amp;</span></CodeLine>
<Link id="l07042" /><CodeLine lineNumber="7042"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;It is impossible for a switch to have more entries than the max &quot;</span></CodeLine>
<Link id="l07043" /><CodeLine lineNumber="7043"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;representable value of its input integer type&#39;s size.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07044" /><CodeLine lineNumber="7044"></CodeLine>
<Link id="l07045" /><CodeLine lineNumber="7045"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the BB that does the lookups.</span></CodeLine>
<Link id="l07046" /><CodeLine lineNumber="7046"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/module">Module</a> &amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a> = &#42;CommonDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>();</span></CodeLine>
<Link id="l07047" /><CodeLine lineNumber="7047"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LookupBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l07048" /><CodeLine lineNumber="7048"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;switch.lookup&quot;</span><span class="doxyHighlight">, CommonDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), CommonDest);</span></CodeLine>
<Link id="l07049" /><CodeLine lineNumber="7049"></CodeLine>
<Link id="l07050" /><CodeLine lineNumber="7050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute the table index value.</span></CodeLine>
<Link id="l07051" /><CodeLine lineNumber="7051"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l07052" /><CodeLine lineNumber="7052"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;TableIndex;</span></CodeLine>
<Link id="l07053" /><CodeLine lineNumber="7053"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;TableIndexOffset;</span></CodeLine>
<Link id="l07054" /><CodeLine lineNumber="7054"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseSwitchConditionAsTableIndex) &#123;</span></CodeLine>
<Link id="l07055" /><CodeLine lineNumber="7055"><span class="doxyHighlight">    TableIndexOffset = ConstantInt::get(MaxCaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#a4f9d007abe180fd0a5d2ed7cbec50e58">getIntegerType</a>(), 0);</span></CodeLine>
<Link id="l07056" /><CodeLine lineNumber="7056"><span class="doxyHighlight">    TableIndex = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l07057" /><CodeLine lineNumber="7057"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07058" /><CodeLine lineNumber="7058"><span class="doxyHighlight">    TableIndexOffset = MinCaseVal;</span></CodeLine>
<Link id="l07059" /><CodeLine lineNumber="7059"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the default is unreachable, all case values are s&gt;= MinCaseVal. Then</span></CodeLine>
<Link id="l07060" /><CodeLine lineNumber="7060"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we can try to attach nsw.</span></CodeLine>
<Link id="l07061" /><CodeLine lineNumber="7061"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MayWrap = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07062" /><CodeLine lineNumber="7062"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DefaultIsReachable) &#123;</span></CodeLine>
<Link id="l07063" /><CodeLine lineNumber="7063"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a> Res = MaxCaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>().<a href="/docs/api/classes/llvm/apint/#ae324de5041feaf7eb8433221cdaca9aa">ssub&#95;ov</a>(MinCaseVal-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>(), MayWrap);</span></CodeLine>
<Link id="l07064" /><CodeLine lineNumber="7064"><span class="doxyHighlight">      (void)Res;</span></CodeLine>
<Link id="l07065" /><CodeLine lineNumber="7065"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07066" /><CodeLine lineNumber="7066"></CodeLine>
<Link id="l07067" /><CodeLine lineNumber="7067"><span class="doxyHighlight">    TableIndex = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition(), TableIndexOffset,</span></CodeLine>
<Link id="l07068" /><CodeLine lineNumber="7068"><span class="doxyHighlight">                                   </span><span class="doxyHighlightStringLiteral">&quot;switch.tableidx&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;HasNUW =&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07069" /><CodeLine lineNumber="7069"><span class="doxyHighlight">                                   </span><span class="doxyHighlightComment">/&#42;HasNSW =&#42;/</span><span class="doxyHighlight">!MayWrap);</span></CodeLine>
<Link id="l07070" /><CodeLine lineNumber="7070"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07071" /><CodeLine lineNumber="7071"></CodeLine>
<Link id="l07072" /><CodeLine lineNumber="7072"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;RangeCheckBranch = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07073" /><CodeLine lineNumber="7073"></CodeLine>
<Link id="l07074" /><CodeLine lineNumber="7074"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Grow the table to cover all possible index values to avoid the range check.</span></CodeLine>
<Link id="l07075" /><CodeLine lineNumber="7075"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It will use the default result to fill in the table hole later, so make</span></CodeLine>
<Link id="l07076" /><CodeLine lineNumber="7076"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sure it exist.</span></CodeLine>
<Link id="l07077" /><CodeLine lineNumber="7077"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseSwitchConditionAsTableIndex &amp;&amp; HasDefaultResults) &#123;</span></CodeLine>
<Link id="l07078" /><CodeLine lineNumber="7078"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantrange">ConstantRange</a> CR = <a href="/docs/api/namespaces/llvm/#a546e6f5ba8f510c3e7ed2e20013548d9">computeConstantRange</a>(TableIndex, </span><span class="doxyHighlightComment">/&#42; ForSigned &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07079" /><CodeLine lineNumber="7079"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Grow the table shouldn&#39;t have any size impact by checking</span></CodeLine>
<Link id="l07080" /><CodeLine lineNumber="7080"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// wouldFitInRegister.</span></CodeLine>
<Link id="l07081" /><CodeLine lineNumber="7081"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Consider growing the table also when it doesn&#39;t fit in a register</span></CodeLine>
<Link id="l07082" /><CodeLine lineNumber="7082"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// if no optsize is specified.</span></CodeLine>
<Link id="l07083" /><CodeLine lineNumber="7083"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint64&#95;t UpperBound = CR.<a href="/docs/api/classes/llvm/constantrange/#aa1955c426e1ff66455b4bb6657ee995d">getUpper</a>().<a href="/docs/api/classes/llvm/apint/#ab01d8694a759a934e01f1c558c3ce862">getLimitedValue</a>();</span></CodeLine>
<Link id="l07084" /><CodeLine lineNumber="7084"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CR.<a href="/docs/api/classes/llvm/constantrange/#aa1a0c35225268e93dc3afd67e079f826">isUpperWrapped</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(ResultTypes, &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;KV) &#123;</span></CodeLine>
<Link id="l07085" /><CodeLine lineNumber="7085"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a19f38e85c02e7293ac20cdfc25f776df">SwitchLookupTable::wouldFitInRegister</a>(</span></CodeLine>
<Link id="l07086" /><CodeLine lineNumber="7086"><span class="doxyHighlight">              <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, UpperBound, KV.second </span><span class="doxyHighlightComment">/&#42; ResultType &#42;/</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07087" /><CodeLine lineNumber="7087"><span class="doxyHighlight">        &#125;)) &#123;</span></CodeLine>
<Link id="l07088" /><CodeLine lineNumber="7088"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// There may be some case index larger than the UpperBound (unreachable</span></CodeLine>
<Link id="l07089" /><CodeLine lineNumber="7089"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// case), so make sure the table size does not get smaller.</span></CodeLine>
<Link id="l07090" /><CodeLine lineNumber="7090"><span class="doxyHighlight">      TableSize = std::max(UpperBound, TableSize);</span></CodeLine>
<Link id="l07091" /><CodeLine lineNumber="7091"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The default branch is unreachable after we enlarge the lookup table.</span></CodeLine>
<Link id="l07092" /><CodeLine lineNumber="7092"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Adjust DefaultIsReachable to reuse code path.</span></CodeLine>
<Link id="l07093" /><CodeLine lineNumber="7093"><span class="doxyHighlight">      DefaultIsReachable = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07094" /><CodeLine lineNumber="7094"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07095" /><CodeLine lineNumber="7095"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07096" /><CodeLine lineNumber="7096"></CodeLine>
<Link id="l07097" /><CodeLine lineNumber="7097"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> GeneratingCoveredLookupTable = (MaxTableSize == TableSize);</span></CodeLine>
<Link id="l07098" /><CodeLine lineNumber="7098"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DefaultIsReachable || GeneratingCoveredLookupTable) &#123;</span></CodeLine>
<Link id="l07099" /><CodeLine lineNumber="7099"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(LookupBB);</span></CodeLine>
<Link id="l07100" /><CodeLine lineNumber="7100"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l07101" /><CodeLine lineNumber="7101"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, BB, LookupBB&#125;);</span></CodeLine>
<Link id="l07102" /><CodeLine lineNumber="7102"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note: We call removeProdecessor later since we need to be able to get the</span></CodeLine>
<Link id="l07103" /><CodeLine lineNumber="7103"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// PHI value for the default case in case we&#39;re using a bit mask.</span></CodeLine>
<Link id="l07104" /><CodeLine lineNumber="7104"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07105" /><CodeLine lineNumber="7105"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a09b4daefdf5b73efba51ce7ae6cd45c5">CreateICmpULT</a>(</span></CodeLine>
<Link id="l07106" /><CodeLine lineNumber="7106"><span class="doxyHighlight">        TableIndex, ConstantInt::get(MinCaseVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), TableSize));</span></CodeLine>
<Link id="l07107" /><CodeLine lineNumber="7107"><span class="doxyHighlight">    RangeCheckBranch =</span></CodeLine>
<Link id="l07108" /><CodeLine lineNumber="7108"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(Cmp, LookupBB, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest());</span></CodeLine>
<Link id="l07109" /><CodeLine lineNumber="7109"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l07110" /><CodeLine lineNumber="7110"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, BB, LookupBB&#125;);</span></CodeLine>
<Link id="l07111" /><CodeLine lineNumber="7111"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07112" /><CodeLine lineNumber="7112"></CodeLine>
<Link id="l07113" /><CodeLine lineNumber="7113"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Populate the BB that does the lookups.</span></CodeLine>
<Link id="l07114" /><CodeLine lineNumber="7114"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(LookupBB);</span></CodeLine>
<Link id="l07115" /><CodeLine lineNumber="7115"></CodeLine>
<Link id="l07116" /><CodeLine lineNumber="7116"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedMask) &#123;</span></CodeLine>
<Link id="l07117" /><CodeLine lineNumber="7117"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Before doing the lookup, we do the hole check. The LookupBB is therefore</span></CodeLine>
<Link id="l07118" /><CodeLine lineNumber="7118"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// re-purposed to do the hole check, and we create a new LookupBB.</span></CodeLine>
<Link id="l07119" /><CodeLine lineNumber="7119"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;MaskBB = LookupBB;</span></CodeLine>
<Link id="l07120" /><CodeLine lineNumber="7120"><span class="doxyHighlight">    MaskBB-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</span><span class="doxyHighlightStringLiteral">&quot;switch.hole&#95;check&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07121" /><CodeLine lineNumber="7121"><span class="doxyHighlight">    LookupBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;switch.lookup&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07122" /><CodeLine lineNumber="7122"><span class="doxyHighlight">                                  CommonDest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), CommonDest);</span></CodeLine>
<Link id="l07123" /><CodeLine lineNumber="7123"></CodeLine>
<Link id="l07124" /><CodeLine lineNumber="7124"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make the mask&#39;s bitwidth at least 8-bit and a power-of-2 to avoid</span></CodeLine>
<Link id="l07125" /><CodeLine lineNumber="7125"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// unnecessary illegal types.</span></CodeLine>
<Link id="l07126" /><CodeLine lineNumber="7126"><span class="doxyHighlight">    uint64&#95;t TableSizePowOf2 = <a href="/docs/api/namespaces/llvm/#afb65eef479f0473d0fe1666b80155237">NextPowerOf2</a>(std::max(7ULL, TableSize - 1ULL));</span></CodeLine>
<Link id="l07127" /><CodeLine lineNumber="7127"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/apint">APInt</a> MaskInt(TableSizePowOf2, 0);</span></CodeLine>
<Link id="l07128" /><CodeLine lineNumber="7128"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/apint">APInt</a> One(TableSizePowOf2, 1);</span></CodeLine>
<Link id="l07129" /><CodeLine lineNumber="7129"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Build bitmask; fill in a 1 bit for every case.</span></CodeLine>
<Link id="l07130" /><CodeLine lineNumber="7130"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ResultListTy &amp;ResultList = ResultLists&#91;PHIs&#91;0&#93;&#93;;</span></CodeLine>
<Link id="l07131" /><CodeLine lineNumber="7131"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = ResultList.size(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l07132" /><CodeLine lineNumber="7132"><span class="doxyHighlight">      uint64&#95;t Idx = (ResultList&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;.first-&gt;getValue() - TableIndexOffset-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>())</span></CodeLine>
<Link id="l07133" /><CodeLine lineNumber="7133"><span class="doxyHighlight">                         .getLimitedValue();</span></CodeLine>
<Link id="l07134" /><CodeLine lineNumber="7134"><span class="doxyHighlight">      MaskInt |= One &lt;&lt; Idx;</span></CodeLine>
<Link id="l07135" /><CodeLine lineNumber="7135"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07136" /><CodeLine lineNumber="7136"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;TableMask = ConstantInt::get(<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a>.getContext(), MaskInt);</span></CodeLine>
<Link id="l07137" /><CodeLine lineNumber="7137"></CodeLine>
<Link id="l07138" /><CodeLine lineNumber="7138"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Get the TableIndex&#39;th bit of the bitmask.</span></CodeLine>
<Link id="l07139" /><CodeLine lineNumber="7139"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this bit is 0 (meaning hole) jump to the default destination,</span></CodeLine>
<Link id="l07140" /><CodeLine lineNumber="7140"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// else continue with table lookup.</span></CodeLine>
<Link id="l07141" /><CodeLine lineNumber="7141"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;MapTy = TableMask-&gt;<a href="/docs/api/classes/llvm/constantint/#a4f9d007abe180fd0a5d2ed7cbec50e58">getIntegerType</a>();</span></CodeLine>
<Link id="l07142" /><CodeLine lineNumber="7142"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;MaskIndex =</span></CodeLine>
<Link id="l07143" /><CodeLine lineNumber="7143"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a36742c35a8fff5f74bb3d76c9c19dd47">CreateZExtOrTrunc</a>(TableIndex, MapTy, </span><span class="doxyHighlightStringLiteral">&quot;switch.maskindex&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07144" /><CodeLine lineNumber="7144"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Shifted = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5849d19e500f8c6713ec44889058f424">CreateLShr</a>(TableMask, MaskIndex, </span><span class="doxyHighlightStringLiteral">&quot;switch.shifted&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07145" /><CodeLine lineNumber="7145"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;LoBit = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(</span></CodeLine>
<Link id="l07146" /><CodeLine lineNumber="7146"><span class="doxyHighlight">        Shifted, <a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a>.getContext()), </span><span class="doxyHighlightStringLiteral">&quot;switch.lobit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07147" /><CodeLine lineNumber="7147"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(LoBit, LookupBB, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest());</span></CodeLine>
<Link id="l07148" /><CodeLine lineNumber="7148"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l07149" /><CodeLine lineNumber="7149"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, MaskBB, LookupBB&#125;);</span></CodeLine>
<Link id="l07150" /><CodeLine lineNumber="7150"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, MaskBB, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest()&#125;);</span></CodeLine>
<Link id="l07151" /><CodeLine lineNumber="7151"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07152" /><CodeLine lineNumber="7152"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(LookupBB);</span></CodeLine>
<Link id="l07153" /><CodeLine lineNumber="7153"><span class="doxyHighlight">    <a href="#a0375fe3378c23272b805320851744043">addPredecessorToBlock</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest(), MaskBB, BB);</span></CodeLine>
<Link id="l07154" /><CodeLine lineNumber="7154"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07155" /><CodeLine lineNumber="7155"></CodeLine>
<Link id="l07156" /><CodeLine lineNumber="7156"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DefaultIsReachable || GeneratingCoveredLookupTable) &#123;</span></CodeLine>
<Link id="l07157" /><CodeLine lineNumber="7157"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We cached PHINodes in PHIs. To avoid accessing deleted PHINodes later,</span></CodeLine>
<Link id="l07158" /><CodeLine lineNumber="7158"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// do not delete PHINodes here.</span></CodeLine>
<Link id="l07159" /><CodeLine lineNumber="7159"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest()-&gt;removePredecessor(BB,</span></CodeLine>
<Link id="l07160" /><CodeLine lineNumber="7160"><span class="doxyHighlight">                                            </span><span class="doxyHighlightComment">/&#42;KeepOneInputPHIs=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07161" /><CodeLine lineNumber="7161"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l07162" /><CodeLine lineNumber="7162"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest()&#125;);</span></CodeLine>
<Link id="l07163" /><CodeLine lineNumber="7163"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07164" /><CodeLine lineNumber="7164"></CodeLine>
<Link id="l07165" /><CodeLine lineNumber="7165"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : PHIs) &#123;</span></CodeLine>
<Link id="l07166" /><CodeLine lineNumber="7166"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ResultListTy &amp;ResultList = ResultLists&#91;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>&#93;;</span></CodeLine>
<Link id="l07167" /><CodeLine lineNumber="7167"></CodeLine>
<Link id="l07168" /><CodeLine lineNumber="7168"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ResultType = ResultList.begin()-&gt;second-&gt;getType();</span></CodeLine>
<Link id="l07169" /><CodeLine lineNumber="7169"></CodeLine>
<Link id="l07170" /><CodeLine lineNumber="7170"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Use any value to fill the lookup table holes.</span></CodeLine>
<Link id="l07171" /><CodeLine lineNumber="7171"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;DV =</span></CodeLine>
<Link id="l07172" /><CodeLine lineNumber="7172"><span class="doxyHighlight">        AllHolesArePoison ? <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(ResultType) : DefaultResults&#91;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>&#93;;</span></CodeLine>
<Link id="l07173" /><CodeLine lineNumber="7173"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/stringref">StringRef</a> FuncName = Fn-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>();</span></CodeLine>
<Link id="l07174" /><CodeLine lineNumber="7174"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/switchlookuptable/#a36955f44027693881a174e8d3f1d3854">SwitchLookupTable</a> Table(<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a>, TableSize, TableIndexOffset, ResultList, DV,</span></CodeLine>
<Link id="l07175" /><CodeLine lineNumber="7175"><span class="doxyHighlight">                            <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, FuncName);</span></CodeLine>
<Link id="l07176" /><CodeLine lineNumber="7176"></CodeLine>
<Link id="l07177" /><CodeLine lineNumber="7177"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Result = Table.buildLookup(TableIndex, Builder);</span></CodeLine>
<Link id="l07178" /><CodeLine lineNumber="7178"></CodeLine>
<Link id="l07179" /><CodeLine lineNumber="7179"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do a small peephole optimization: re-use the switch table compare if</span></CodeLine>
<Link id="l07180" /><CodeLine lineNumber="7180"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// possible.</span></CodeLine>
<Link id="l07181" /><CodeLine lineNumber="7181"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TableHasHoles &amp;&amp; HasDefaultResults &amp;&amp; RangeCheckBranch) &#123;</span></CodeLine>
<Link id="l07182" /><CodeLine lineNumber="7182"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PhiBlock = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getParent();</span></CodeLine>
<Link id="l07183" /><CodeLine lineNumber="7183"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Search for compare instructions which use the phi.</span></CodeLine>
<Link id="l07184" /><CodeLine lineNumber="7184"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/user">User</a> : <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;users()) &#123;</span></CodeLine>
<Link id="l07185" /><CodeLine lineNumber="7185"><span class="doxyHighlight">        <a href="#ad75372cc26ff6f641159aed90d5fc11e">reuseTableCompare</a>(<a href="/docs/api/classes/llvm/user">User</a>, PhiBlock, RangeCheckBranch, DV, ResultList);</span></CodeLine>
<Link id="l07186" /><CodeLine lineNumber="7186"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07187" /><CodeLine lineNumber="7187"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07188" /><CodeLine lineNumber="7188"></CodeLine>
<Link id="l07189" /><CodeLine lineNumber="7189"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(Result, LookupBB);</span></CodeLine>
<Link id="l07190" /><CodeLine lineNumber="7190"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07191" /><CodeLine lineNumber="7191"></CodeLine>
<Link id="l07192" /><CodeLine lineNumber="7192"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(CommonDest);</span></CodeLine>
<Link id="l07193" /><CodeLine lineNumber="7193"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l07194" /><CodeLine lineNumber="7194"><span class="doxyHighlight">    Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, LookupBB, CommonDest&#125;);</span></CodeLine>
<Link id="l07195" /><CodeLine lineNumber="7195"></CodeLine>
<Link id="l07196" /><CodeLine lineNumber="7196"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove the switch.</span></CodeLine>
<Link id="l07197" /><CodeLine lineNumber="7197"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 8&gt;</a> RemovedSuccessors;</span></CodeLine>
<Link id="l07198" /><CodeLine lineNumber="7198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumSuccessors(); i &lt; e; ++i) &#123;</span></CodeLine>
<Link id="l07199" /><CodeLine lineNumber="7199"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getSuccessor(i);</span></CodeLine>
<Link id="l07200" /><CodeLine lineNumber="7200"></CodeLine>
<Link id="l07201" /><CodeLine lineNumber="7201"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ == <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest())</span></CodeLine>
<Link id="l07202" /><CodeLine lineNumber="7202"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07203" /><CodeLine lineNumber="7203"><span class="doxyHighlight">    Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BB);</span></CodeLine>
<Link id="l07204" /><CodeLine lineNumber="7204"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU &amp;&amp; RemovedSuccessors.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Succ).second)</span></CodeLine>
<Link id="l07205" /><CodeLine lineNumber="7205"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, Succ&#125;);</span></CodeLine>
<Link id="l07206" /><CodeLine lineNumber="7206"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07207" /><CodeLine lineNumber="7207"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l07208" /><CodeLine lineNumber="7208"></CodeLine>
<Link id="l07209" /><CodeLine lineNumber="7209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l07210" /><CodeLine lineNumber="7210"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l07211" /><CodeLine lineNumber="7211"></CodeLine>
<Link id="l07212" /><CodeLine lineNumber="7212"><span class="doxyHighlight">  ++NumLookupTables;</span></CodeLine>
<Link id="l07213" /><CodeLine lineNumber="7213"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedMask)</span></CodeLine>
<Link id="l07214" /><CodeLine lineNumber="7214"><span class="doxyHighlight">    ++NumLookupTablesHoles;</span></CodeLine>
<Link id="l07215" /><CodeLine lineNumber="7215"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07216" /><CodeLine lineNumber="7216"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07217" /><CodeLine lineNumber="7217"></CodeLine>
<Link id="l07218" /><CodeLine lineNumber="7218"><span class="doxyHighlightComment">/// Try to transform a switch that has &quot;holes&quot; in it to a contiguous sequence</span></CodeLine>
<Link id="l07219" /><CodeLine lineNumber="7219"><span class="doxyHighlightComment">/// of cases.</span></CodeLine>
<Link id="l07220" /><CodeLine lineNumber="7220"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l07221" /><CodeLine lineNumber="7221"><span class="doxyHighlightComment">/// A switch such as: switch(i) &#123;case 5: case 9: case 13: case 17:&#125; can be</span></CodeLine>
<Link id="l07222" /><CodeLine lineNumber="7222"><span class="doxyHighlightComment">/// range-reduced to: switch ((i-5) / 4) &#123;case 0: case 1: case 2: case 3:&#125;.</span></CodeLine>
<Link id="l07223" /><CodeLine lineNumber="7223"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l07224" /><CodeLine lineNumber="7224"><span class="doxyHighlightComment">/// This converts a sparse switch into a dense switch which allows better</span></CodeLine>
<Link id="l07225" /><CodeLine lineNumber="7225"><span class="doxyHighlightComment">/// lowering and could also allow transforming into a lookup table.</span></CodeLine>
<Link id="l07226" /><CodeLine lineNumber="7226" lineLink="#a6860a87b20545e2f53641a1bf33f6c4c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a6860a87b20545e2f53641a1bf33f6c4c">reduceSwitchRange</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder,</span></CodeLine>
<Link id="l07227" /><CodeLine lineNumber="7227"><span class="doxyHighlight">                              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l07228" /><CodeLine lineNumber="7228"><span class="doxyHighlight">                              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l07229" /><CodeLine lineNumber="7229"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CondTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition()-&gt;getType());</span></CodeLine>
<Link id="l07230" /><CodeLine lineNumber="7230"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CondTy-&gt;getIntegerBitWidth() &gt; 64 ||</span></CodeLine>
<Link id="l07231" /><CodeLine lineNumber="7231"><span class="doxyHighlight">      !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.fitsInLegalInteger(CondTy-&gt;getIntegerBitWidth()))</span></CodeLine>
<Link id="l07232" /><CodeLine lineNumber="7232"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07233" /><CodeLine lineNumber="7233"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only bother with this optimization if there are more than 3 switch cases;</span></CodeLine>
<Link id="l07234" /><CodeLine lineNumber="7234"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SDAG will only bother creating jump tables for 4 or more cases.</span></CodeLine>
<Link id="l07235" /><CodeLine lineNumber="7235"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases() &lt; 4)</span></CodeLine>
<Link id="l07236" /><CodeLine lineNumber="7236"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07237" /><CodeLine lineNumber="7237"></CodeLine>
<Link id="l07238" /><CodeLine lineNumber="7238"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This transform is agnostic to the signedness of the input or case values. We</span></CodeLine>
<Link id="l07239" /><CodeLine lineNumber="7239"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can treat the case values as signed or unsigned. We can optimize more common</span></CodeLine>
<Link id="l07240" /><CodeLine lineNumber="7240"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cases such as a sequence crossing zero &#123;-4,0,4,8&#125; if we interpret case values</span></CodeLine>
<Link id="l07241" /><CodeLine lineNumber="7241"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as signed.</span></CodeLine>
<Link id="l07242" /><CodeLine lineNumber="7242"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int64&#95;t,4&gt;</a> Values;</span></CodeLine>
<Link id="l07243" /><CodeLine lineNumber="7243"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases())</span></CodeLine>
<Link id="l07244" /><CodeLine lineNumber="7244"><span class="doxyHighlight">    Values.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getCaseValue()-&gt;getValue().getSExtValue());</span></CodeLine>
<Link id="l07245" /><CodeLine lineNumber="7245"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(Values);</span></CodeLine>
<Link id="l07246" /><CodeLine lineNumber="7246"></CodeLine>
<Link id="l07247" /><CodeLine lineNumber="7247"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the switch is already dense, there&#39;s nothing useful to do here.</span></CodeLine>
<Link id="l07248" /><CodeLine lineNumber="7248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(Values))</span></CodeLine>
<Link id="l07249" /><CodeLine lineNumber="7249"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07250" /><CodeLine lineNumber="7250"></CodeLine>
<Link id="l07251" /><CodeLine lineNumber="7251"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First, transform the values such that they start at zero and ascend.</span></CodeLine>
<Link id="l07252" /><CodeLine lineNumber="7252"><span class="doxyHighlight">  int64&#95;t <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = Values&#91;0&#93;;</span></CodeLine>
<Link id="l07253" /><CodeLine lineNumber="7253"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;V : Values)</span></CodeLine>
<Link id="l07254" /><CodeLine lineNumber="7254"><span class="doxyHighlight">    V -= (uint64&#95;t)(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</span></CodeLine>
<Link id="l07255" /><CodeLine lineNumber="7255"></CodeLine>
<Link id="l07256" /><CodeLine lineNumber="7256"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now we have signed numbers that have been shifted so that, given enough</span></CodeLine>
<Link id="l07257" /><CodeLine lineNumber="7257"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// precision, there are no negative values. Since the rest of the transform</span></CodeLine>
<Link id="l07258" /><CodeLine lineNumber="7258"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is bitwise only, we switch now to an unsigned representation.</span></CodeLine>
<Link id="l07259" /><CodeLine lineNumber="7259"></CodeLine>
<Link id="l07260" /><CodeLine lineNumber="7260"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This transform can be done speculatively because it is so cheap - it</span></CodeLine>
<Link id="l07261" /><CodeLine lineNumber="7261"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// results in a single rotate operation being inserted.</span></CodeLine>
<Link id="l07262" /><CodeLine lineNumber="7262"></CodeLine>
<Link id="l07263" /><CodeLine lineNumber="7263"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// countTrailingZeros(0) returns 64 As Values is guaranteed to have more than</span></CodeLine>
<Link id="l07264" /><CodeLine lineNumber="7264"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// one element and LLVM disallows duplicate cases, Shift is guaranteed to be</span></CodeLine>
<Link id="l07265" /><CodeLine lineNumber="7265"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// less than 64</span></CodeLine>
<Link id="l07266" /><CodeLine lineNumber="7266"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Shift = 64;</span></CodeLine>
<Link id="l07267" /><CodeLine lineNumber="7267"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;V : Values)</span></CodeLine>
<Link id="l07268" /><CodeLine lineNumber="7268"><span class="doxyHighlight">    Shift = std::min(Shift, (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">)<a href="/docs/api/namespaces/llvm/#a57d2f9ee99e9e68cff564d0d579c8163">llvm::countr&#95;zero</a>((uint64&#95;t)V));</span></CodeLine>
<Link id="l07269" /><CodeLine lineNumber="7269"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Shift &lt; 64);</span></CodeLine>
<Link id="l07270" /><CodeLine lineNumber="7270"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Shift &gt; 0)</span></CodeLine>
<Link id="l07271" /><CodeLine lineNumber="7271"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;V : Values)</span></CodeLine>
<Link id="l07272" /><CodeLine lineNumber="7272"><span class="doxyHighlight">      V = (int64&#95;t)((uint64&#95;t)V &gt;&gt; Shift);</span></CodeLine>
<Link id="l07273" /><CodeLine lineNumber="7273"></CodeLine>
<Link id="l07274" /><CodeLine lineNumber="7274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(Values))</span></CodeLine>
<Link id="l07275" /><CodeLine lineNumber="7275"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Transform didn&#39;t create a dense switch.</span></CodeLine>
<Link id="l07276" /><CodeLine lineNumber="7276"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07277" /><CodeLine lineNumber="7277"></CodeLine>
<Link id="l07278" /><CodeLine lineNumber="7278"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The obvious transform is to shift the switch condition right and emit a</span></CodeLine>
<Link id="l07279" /><CodeLine lineNumber="7279"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// check that the condition actually cleanly divided by GCD, i.e.</span></CodeLine>
<Link id="l07280" /><CodeLine lineNumber="7280"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   C &amp; (1 &lt;&lt; Shift - 1) == 0</span></CodeLine>
<Link id="l07281" /><CodeLine lineNumber="7281"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// inserting a new CFG edge to handle the case where it didn&#39;t divide cleanly.</span></CodeLine>
<Link id="l07282" /><CodeLine lineNumber="7282"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07283" /><CodeLine lineNumber="7283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A cheaper way of doing this is a simple ROTR(C, Shift). This performs the</span></CodeLine>
<Link id="l07284" /><CodeLine lineNumber="7284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// shift and puts the shifted-off bits in the uppermost bits. If any of these</span></CodeLine>
<Link id="l07285" /><CodeLine lineNumber="7285"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are nonzero then the switch condition will be very large and will hit the</span></CodeLine>
<Link id="l07286" /><CodeLine lineNumber="7286"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// default case.</span></CodeLine>
<Link id="l07287" /><CodeLine lineNumber="7287"></CodeLine>
<Link id="l07288" /><CodeLine lineNumber="7288"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Ty = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition()-&gt;getType());</span></CodeLine>
<Link id="l07289" /><CodeLine lineNumber="7289"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l07290" /><CodeLine lineNumber="7290"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Sub =</span></CodeLine>
<Link id="l07291" /><CodeLine lineNumber="7291"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition(), ConstantInt::get(Ty, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>));</span></CodeLine>
<Link id="l07292" /><CodeLine lineNumber="7292"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Rot = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a80eec4efbded89b11092babf42a65b82">CreateIntrinsic</a>(</span></CodeLine>
<Link id="l07293" /><CodeLine lineNumber="7293"><span class="doxyHighlight">      Ty, Intrinsic::fshl,</span></CodeLine>
<Link id="l07294" /><CodeLine lineNumber="7294"><span class="doxyHighlight">      &#123;Sub, Sub, ConstantInt::get(Ty, Ty-&gt;getBitWidth() - Shift)&#125;);</span></CodeLine>
<Link id="l07295" /><CodeLine lineNumber="7295"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;replaceUsesOfWith(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition(), Rot);</span></CodeLine>
<Link id="l07296" /><CodeLine lineNumber="7296"></CodeLine>
<Link id="l07297" /><CodeLine lineNumber="7297"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l07298" /><CodeLine lineNumber="7298"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Orig = Case.getCaseValue();</span></CodeLine>
<Link id="l07299" /><CodeLine lineNumber="7299"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Sub = Orig-&gt;getValue() - <a href="/docs/api/classes/llvm/apint">APInt</a>(Ty-&gt;getBitWidth(), <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07300" /><CodeLine lineNumber="7300"><span class="doxyHighlight">    Case.setValue(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(ConstantInt::get(Ty, Sub.lshr(Shift))));</span></CodeLine>
<Link id="l07301" /><CodeLine lineNumber="7301"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07302" /><CodeLine lineNumber="7302"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07303" /><CodeLine lineNumber="7303"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07304" /><CodeLine lineNumber="7304"></CodeLine>
<Link id="l07305" /><CodeLine lineNumber="7305"><span class="doxyHighlightComment">/// Tries to transform switch of powers of two to reduce switch range.</span></CodeLine>
<Link id="l07306" /><CodeLine lineNumber="7306"><span class="doxyHighlightComment">/// For example, switch like:</span></CodeLine>
<Link id="l07307" /><CodeLine lineNumber="7307"><span class="doxyHighlightComment">/// switch (C) &#123; case 1: case 2: case 64: case 128: &#125;</span></CodeLine>
<Link id="l07308" /><CodeLine lineNumber="7308"><span class="doxyHighlightComment">/// will be transformed to:</span></CodeLine>
<Link id="l07309" /><CodeLine lineNumber="7309"><span class="doxyHighlightComment">/// switch (count&#95;trailing&#95;zeros(C)) &#123; case 0: case 1: case 6: case 7: &#125;</span></CodeLine>
<Link id="l07310" /><CodeLine lineNumber="7310"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l07311" /><CodeLine lineNumber="7311"><span class="doxyHighlightComment">/// This transformation allows better lowering and could allow transforming into</span></CodeLine>
<Link id="l07312" /><CodeLine lineNumber="7312"><span class="doxyHighlightComment">/// a lookup table.</span></CodeLine>
<Link id="l07313" /><CodeLine lineNumber="7313" lineLink="#adc11c5fbec9bf293b000637357da66e4"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#adc11c5fbec9bf293b000637357da66e4">simplifySwitchOfPowersOfTwo</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder,</span></CodeLine>
<Link id="l07314" /><CodeLine lineNumber="7314"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l07315" /><CodeLine lineNumber="7315"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l07316" /><CodeLine lineNumber="7316"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Condition = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l07317" /><CodeLine lineNumber="7317"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Context = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getContext();</span></CodeLine>
<Link id="l07318" /><CodeLine lineNumber="7318"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CondTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(Condition-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l07319" /><CodeLine lineNumber="7319"></CodeLine>
<Link id="l07320" /><CodeLine lineNumber="7320"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CondTy-&gt;getIntegerBitWidth() &gt; 64 ||</span></CodeLine>
<Link id="l07321" /><CodeLine lineNumber="7321"><span class="doxyHighlight">      !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.fitsInLegalInteger(CondTy-&gt;getIntegerBitWidth()))</span></CodeLine>
<Link id="l07322" /><CodeLine lineNumber="7322"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07323" /><CodeLine lineNumber="7323"></CodeLine>
<Link id="l07324" /><CodeLine lineNumber="7324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CttzIntrinsicCost = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getIntrinsicInstrCost(</span></CodeLine>
<Link id="l07325" /><CodeLine lineNumber="7325"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/intrinsiccostattributes">IntrinsicCostAttributes</a>(Intrinsic::cttz, CondTy,</span></CodeLine>
<Link id="l07326" /><CodeLine lineNumber="7326"><span class="doxyHighlight">                              &#123;Condition, <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(Context)&#125;),</span></CodeLine>
<Link id="l07327" /><CodeLine lineNumber="7327"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TTI::TCK&#95;SizeAndLatency</a>);</span></CodeLine>
<Link id="l07328" /><CodeLine lineNumber="7328"></CodeLine>
<Link id="l07329" /><CodeLine lineNumber="7329"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CttzIntrinsicCost &gt; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TTI::TCC&#95;Basic</a>)</span></CodeLine>
<Link id="l07330" /><CodeLine lineNumber="7330"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Inserting intrinsic is too expensive.</span></CodeLine>
<Link id="l07331" /><CodeLine lineNumber="7331"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07332" /><CodeLine lineNumber="7332"></CodeLine>
<Link id="l07333" /><CodeLine lineNumber="7333"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only bother with this optimization if there are more than 3 switch cases.</span></CodeLine>
<Link id="l07334" /><CodeLine lineNumber="7334"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SDAG will only bother creating jump tables for 4 or more cases.</span></CodeLine>
<Link id="l07335" /><CodeLine lineNumber="7335"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases() &lt; 4)</span></CodeLine>
<Link id="l07336" /><CodeLine lineNumber="7336"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07337" /><CodeLine lineNumber="7337"></CodeLine>
<Link id="l07338" /><CodeLine lineNumber="7338"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We perform this optimization only for switches with</span></CodeLine>
<Link id="l07339" /><CodeLine lineNumber="7339"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unreachable default case.</span></CodeLine>
<Link id="l07340" /><CodeLine lineNumber="7340"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This assumtion will save us from checking if &#96;Condition&#96; is a power of two.</span></CodeLine>
<Link id="l07341" /><CodeLine lineNumber="7341"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UnreachableInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest()-&gt;getFirstNonPHIOrDbg()))</span></CodeLine>
<Link id="l07342" /><CodeLine lineNumber="7342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07343" /><CodeLine lineNumber="7343"></CodeLine>
<Link id="l07344" /><CodeLine lineNumber="7344"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that switch cases are powers of two.</span></CodeLine>
<Link id="l07345" /><CodeLine lineNumber="7345"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint64&#95;t, 4&gt;</a> Values;</span></CodeLine>
<Link id="l07346" /><CodeLine lineNumber="7346"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l07347" /><CodeLine lineNumber="7347"><span class="doxyHighlight">    uint64&#95;t CaseValue = Case.getCaseValue()-&gt;getValue().getZExtValue();</span></CodeLine>
<Link id="l07348" /><CodeLine lineNumber="7348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a617c1c04cfa1325ad04eb69339d92188">llvm::has&#95;single&#95;bit</a>(CaseValue))</span></CodeLine>
<Link id="l07349" /><CodeLine lineNumber="7349"><span class="doxyHighlight">      Values.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CaseValue);</span></CodeLine>
<Link id="l07350" /><CodeLine lineNumber="7350"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l07351" /><CodeLine lineNumber="7351"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07352" /><CodeLine lineNumber="7352"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07353" /><CodeLine lineNumber="7353"></CodeLine>
<Link id="l07354" /><CodeLine lineNumber="7354"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// isSwichDense requires case values to be sorted.</span></CodeLine>
<Link id="l07355" /><CodeLine lineNumber="7355"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(Values);</span></CodeLine>
<Link id="l07356" /><CodeLine lineNumber="7356"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a7c6e64e4a4dbba951d47fe2b1d188b2c">isSwitchDense</a>(Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(), <a href="/docs/api/namespaces/llvm/#a57d2f9ee99e9e68cff564d0d579c8163">llvm::countr&#95;zero</a>(Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>()) -</span></CodeLine>
<Link id="l07357" /><CodeLine lineNumber="7357"><span class="doxyHighlight">                                        <a href="/docs/api/namespaces/llvm/#a57d2f9ee99e9e68cff564d0d579c8163">llvm::countr&#95;zero</a>(Values.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a58dc840fc84420b7f0b773794b8101c1">front</a>()) + 1))</span></CodeLine>
<Link id="l07358" /><CodeLine lineNumber="7358"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Transform is unable to generate dense switch.</span></CodeLine>
<Link id="l07359" /><CodeLine lineNumber="7359"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07360" /><CodeLine lineNumber="7360"></CodeLine>
<Link id="l07361" /><CodeLine lineNumber="7361"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l07362" /><CodeLine lineNumber="7362"></CodeLine>
<Link id="l07363" /><CodeLine lineNumber="7363"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace each case with its trailing zeros number.</span></CodeLine>
<Link id="l07364" /><CodeLine lineNumber="7364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l07365" /><CodeLine lineNumber="7365"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OrigValue = Case.getCaseValue();</span></CodeLine>
<Link id="l07366" /><CodeLine lineNumber="7366"><span class="doxyHighlight">    Case.setValue(ConstantInt::get(OrigValue-&gt;getIntegerType(),</span></CodeLine>
<Link id="l07367" /><CodeLine lineNumber="7367"><span class="doxyHighlight">                                   OrigValue-&gt;getValue().countr&#95;zero()));</span></CodeLine>
<Link id="l07368" /><CodeLine lineNumber="7368"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07369" /><CodeLine lineNumber="7369"></CodeLine>
<Link id="l07370" /><CodeLine lineNumber="7370"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace condition with its trailing zeros number.</span></CodeLine>
<Link id="l07371" /><CodeLine lineNumber="7371"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ConditionTrailingZeros = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a80eec4efbded89b11092babf42a65b82">CreateIntrinsic</a>(</span></CodeLine>
<Link id="l07372" /><CodeLine lineNumber="7372"><span class="doxyHighlight">      Intrinsic::cttz, &#123;CondTy&#125;, &#123;Condition, <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(Context)&#125;);</span></CodeLine>
<Link id="l07373" /><CodeLine lineNumber="7373"></CodeLine>
<Link id="l07374" /><CodeLine lineNumber="7374"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;setCondition(ConditionTrailingZeros);</span></CodeLine>
<Link id="l07375" /><CodeLine lineNumber="7375"></CodeLine>
<Link id="l07376" /><CodeLine lineNumber="7376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07377" /><CodeLine lineNumber="7377"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07378" /><CodeLine lineNumber="7378"></CodeLine>
<Link id="l07379" /><CodeLine lineNumber="7379"><span class="doxyHighlightComment">/// Fold switch over ucmp/scmp intrinsic to br if two of the switch arms have</span></CodeLine>
<Link id="l07380" /><CodeLine lineNumber="7380"><span class="doxyHighlightComment">/// the same destination.</span></CodeLine>
<Link id="l07381" /><CodeLine lineNumber="7381" lineLink="#a3e8ca2c20b8c4c14c72c49d98f3801ed"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a3e8ca2c20b8c4c14c72c49d98f3801ed">simplifySwitchOfCmpIntrinsic</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder,</span></CodeLine>
<Link id="l07382" /><CodeLine lineNumber="7382"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU) &#123;</span></CodeLine>
<Link id="l07383" /><CodeLine lineNumber="7383"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpIntrinsic&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition());</span></CodeLine>
<Link id="l07384" /><CodeLine lineNumber="7384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Cmp || !Cmp-&gt;hasOneUse())</span></CodeLine>
<Link id="l07385" /><CodeLine lineNumber="7385"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07386" /><CodeLine lineNumber="7386"></CodeLine>
<Link id="l07387" /><CodeLine lineNumber="7387"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint32&#95;t, 4&gt;</a> Weights;</span></CodeLine>
<Link id="l07388" /><CodeLine lineNumber="7388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasWeights = <a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(<a href="/docs/api/namespaces/llvm/#a3475c6d4bdcc4da34ea01a05f01becf2">getBranchWeightMDNode</a>(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>), Weights);</span></CodeLine>
<Link id="l07389" /><CodeLine lineNumber="7389"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasWeights)</span></CodeLine>
<Link id="l07390" /><CodeLine lineNumber="7390"><span class="doxyHighlight">    Weights.<a href="/docs/api/classes/llvm/smallvectorimpl/#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(4); </span><span class="doxyHighlightComment">// Avoid checking HasWeights everywhere.</span></CodeLine>
<Link id="l07391" /><CodeLine lineNumber="7391"></CodeLine>
<Link id="l07392" /><CodeLine lineNumber="7392"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Normalize to &#91;us&#93;cmp == Res ? Succ : OtherSucc.</span></CodeLine>
<Link id="l07393" /><CodeLine lineNumber="7393"><span class="doxyHighlight">  int64&#95;t Res;</span></CodeLine>
<Link id="l07394" /><CodeLine lineNumber="7394"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armisellowering-cpp/#a8b40fbeafc509f3002aa980e2a0662a1">OtherSucc</a>;</span></CodeLine>
<Link id="l07395" /><CodeLine lineNumber="7395"><span class="doxyHighlight">  uint32&#95;t SuccWeight = 0, OtherSuccWeight = 0;</span></CodeLine>
<Link id="l07396" /><CodeLine lineNumber="7396"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Unreachable = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07397" /><CodeLine lineNumber="7397"></CodeLine>
<Link id="l07398" /><CodeLine lineNumber="7398"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases() == 2) &#123;</span></CodeLine>
<Link id="l07399" /><CodeLine lineNumber="7399"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Find which of 1, 0 or -1 is missing (handled by default dest).</span></CodeLine>
<Link id="l07400" /><CodeLine lineNumber="7400"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;int64&#95;t, 3&gt;</a> Missing;</span></CodeLine>
<Link id="l07401" /><CodeLine lineNumber="7401"><span class="doxyHighlight">    Missing.insert(1);</span></CodeLine>
<Link id="l07402" /><CodeLine lineNumber="7402"><span class="doxyHighlight">    Missing.insert(0);</span></CodeLine>
<Link id="l07403" /><CodeLine lineNumber="7403"><span class="doxyHighlight">    Missing.insert(-1);</span></CodeLine>
<Link id="l07404" /><CodeLine lineNumber="7404"></CodeLine>
<Link id="l07405" /><CodeLine lineNumber="7405"><span class="doxyHighlight">    Succ = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest();</span></CodeLine>
<Link id="l07406" /><CodeLine lineNumber="7406"><span class="doxyHighlight">    SuccWeight = Weights&#91;0&#93;;</span></CodeLine>
<Link id="l07407" /><CodeLine lineNumber="7407"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armisellowering-cpp/#a8b40fbeafc509f3002aa980e2a0662a1">OtherSucc</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07408" /><CodeLine lineNumber="7408"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l07409" /><CodeLine lineNumber="7409"><span class="doxyHighlight">      std::optional&lt;int64&#95;t&gt; Val =</span></CodeLine>
<Link id="l07410" /><CodeLine lineNumber="7410"><span class="doxyHighlight">          Case.getCaseValue()-&gt;getValue().trySExtValue();</span></CodeLine>
<Link id="l07411" /><CodeLine lineNumber="7411"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Val)</span></CodeLine>
<Link id="l07412" /><CodeLine lineNumber="7412"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07413" /><CodeLine lineNumber="7413"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Missing.erase(&#42;Val))</span></CodeLine>
<Link id="l07414" /><CodeLine lineNumber="7414"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07415" /><CodeLine lineNumber="7415"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armisellowering-cpp/#a8b40fbeafc509f3002aa980e2a0662a1">OtherSucc</a> &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armisellowering-cpp/#a8b40fbeafc509f3002aa980e2a0662a1">OtherSucc</a> != Case.getCaseSuccessor())</span></CodeLine>
<Link id="l07416" /><CodeLine lineNumber="7416"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07417" /><CodeLine lineNumber="7417"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armisellowering-cpp/#a8b40fbeafc509f3002aa980e2a0662a1">OtherSucc</a> = Case.getCaseSuccessor();</span></CodeLine>
<Link id="l07418" /><CodeLine lineNumber="7418"><span class="doxyHighlight">      OtherSuccWeight += Weights&#91;Case.getSuccessorIndex()&#93;;</span></CodeLine>
<Link id="l07419" /><CodeLine lineNumber="7419"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07420" /><CodeLine lineNumber="7420"></CodeLine>
<Link id="l07421" /><CodeLine lineNumber="7421"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Missing.size() == 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Should have one case left&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07422" /><CodeLine lineNumber="7422"><span class="doxyHighlight">    Res = &#42;Missing.begin();</span></CodeLine>
<Link id="l07423" /><CodeLine lineNumber="7423"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumCases() == 3 &amp;&amp; <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;defaultDestUndefined()) &#123;</span></CodeLine>
<Link id="l07424" /><CodeLine lineNumber="7424"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Normalize so that Succ is taken once and OtherSucc twice.</span></CodeLine>
<Link id="l07425" /><CodeLine lineNumber="7425"><span class="doxyHighlight">    Unreachable = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest();</span></CodeLine>
<Link id="l07426" /><CodeLine lineNumber="7426"><span class="doxyHighlight">    Succ = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armisellowering-cpp/#a8b40fbeafc509f3002aa980e2a0662a1">OtherSucc</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07427" /><CodeLine lineNumber="7427"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l07428" /><CodeLine lineNumber="7428"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewSucc = Case.getCaseSuccessor();</span></CodeLine>
<Link id="l07429" /><CodeLine lineNumber="7429"><span class="doxyHighlight">      uint32&#95;t Weight = Weights&#91;Case.getSuccessorIndex()&#93;;</span></CodeLine>
<Link id="l07430" /><CodeLine lineNumber="7430"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armisellowering-cpp/#a8b40fbeafc509f3002aa980e2a0662a1">OtherSucc</a> || <a href="/docs/api/files/lib/lib/target/lib/target/arm/armisellowering-cpp/#a8b40fbeafc509f3002aa980e2a0662a1">OtherSucc</a> == NewSucc) &#123;</span></CodeLine>
<Link id="l07431" /><CodeLine lineNumber="7431"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armisellowering-cpp/#a8b40fbeafc509f3002aa980e2a0662a1">OtherSucc</a> = NewSucc;</span></CodeLine>
<Link id="l07432" /><CodeLine lineNumber="7432"><span class="doxyHighlight">        OtherSuccWeight += Weight;</span></CodeLine>
<Link id="l07433" /><CodeLine lineNumber="7433"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Succ) &#123;</span></CodeLine>
<Link id="l07434" /><CodeLine lineNumber="7434"><span class="doxyHighlight">        Succ = NewSucc;</span></CodeLine>
<Link id="l07435" /><CodeLine lineNumber="7435"><span class="doxyHighlight">        SuccWeight = Weight;</span></CodeLine>
<Link id="l07436" /><CodeLine lineNumber="7436"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ == NewSucc) &#123;</span></CodeLine>
<Link id="l07437" /><CodeLine lineNumber="7437"><span class="doxyHighlight">        <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Succ, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armisellowering-cpp/#a8b40fbeafc509f3002aa980e2a0662a1">OtherSucc</a>);</span></CodeLine>
<Link id="l07438" /><CodeLine lineNumber="7438"><span class="doxyHighlight">        <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(SuccWeight, OtherSuccWeight);</span></CodeLine>
<Link id="l07439" /><CodeLine lineNumber="7439"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l07440" /><CodeLine lineNumber="7440"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07441" /><CodeLine lineNumber="7441"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07442" /><CodeLine lineNumber="7442"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l07443" /><CodeLine lineNumber="7443"><span class="doxyHighlight">      std::optional&lt;int64&#95;t&gt; Val =</span></CodeLine>
<Link id="l07444" /><CodeLine lineNumber="7444"><span class="doxyHighlight">          Case.getCaseValue()-&gt;getValue().trySExtValue();</span></CodeLine>
<Link id="l07445" /><CodeLine lineNumber="7445"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Val || (Val != 1 &amp;&amp; Val != 0 &amp;&amp; Val != -1))</span></CodeLine>
<Link id="l07446" /><CodeLine lineNumber="7446"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07447" /><CodeLine lineNumber="7447"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Case.getCaseSuccessor() == Succ) &#123;</span></CodeLine>
<Link id="l07448" /><CodeLine lineNumber="7448"><span class="doxyHighlight">        Res = &#42;Val;</span></CodeLine>
<Link id="l07449" /><CodeLine lineNumber="7449"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07450" /><CodeLine lineNumber="7450"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07451" /><CodeLine lineNumber="7451"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07452" /><CodeLine lineNumber="7452"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07453" /><CodeLine lineNumber="7453"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07454" /><CodeLine lineNumber="7454"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07455" /><CodeLine lineNumber="7455"></CodeLine>
<Link id="l07456" /><CodeLine lineNumber="7456"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine predicate for the missing case.</span></CodeLine>
<Link id="l07457" /><CodeLine lineNumber="7457"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred;</span></CodeLine>
<Link id="l07458" /><CodeLine lineNumber="7458"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Res) &#123;</span></CodeLine>
<Link id="l07459" /><CodeLine lineNumber="7459"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> 1:</span></CodeLine>
<Link id="l07460" /><CodeLine lineNumber="7460"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">ICmpInst::ICMP&#95;UGT</a>;</span></CodeLine>
<Link id="l07461" /><CodeLine lineNumber="7461"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07462" /><CodeLine lineNumber="7462"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> 0:</span></CodeLine>
<Link id="l07463" /><CodeLine lineNumber="7463"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>;</span></CodeLine>
<Link id="l07464" /><CodeLine lineNumber="7464"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07465" /><CodeLine lineNumber="7465"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> -1:</span></CodeLine>
<Link id="l07466" /><CodeLine lineNumber="7466"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</span></CodeLine>
<Link id="l07467" /><CodeLine lineNumber="7467"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07468" /><CodeLine lineNumber="7468"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07469" /><CodeLine lineNumber="7469"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cmp-&gt;isSigned())</span></CodeLine>
<Link id="l07470" /><CodeLine lineNumber="7470"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/icmpinst/#a9d5f70171d811078c4d263811f13c121">ICmpInst::getSignedPredicate</a>(Pred);</span></CodeLine>
<Link id="l07471" /><CodeLine lineNumber="7471"></CodeLine>
<Link id="l07472" /><CodeLine lineNumber="7472"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;NewWeights = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07473" /><CodeLine lineNumber="7473"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasWeights)</span></CodeLine>
<Link id="l07474" /><CodeLine lineNumber="7474"><span class="doxyHighlight">    NewWeights = <a href="/docs/api/classes/llvm/mdbuilder">MDBuilder</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getContext())</span></CodeLine>
<Link id="l07475" /><CodeLine lineNumber="7475"><span class="doxyHighlight">                     .<a href="/docs/api/classes/llvm/mdbuilder/#a75043d12a76b84200e9ed593719dc5eb">createBranchWeights</a>(SuccWeight, OtherSuccWeight);</span></CodeLine>
<Link id="l07476" /><CodeLine lineNumber="7476"></CodeLine>
<Link id="l07477" /><CodeLine lineNumber="7477"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent();</span></CodeLine>
<Link id="l07478" /><CodeLine lineNumber="7478"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getIterator());</span></CodeLine>
<Link id="l07479" /><CodeLine lineNumber="7479"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ICmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae0bd6c2fab2d18443038a8f3a2b64856">CreateICmp</a>(Pred, Cmp-&gt;getLHS(), Cmp-&gt;getRHS());</span></CodeLine>
<Link id="l07480" /><CodeLine lineNumber="7480"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(ICmp, Succ, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armisellowering-cpp/#a8b40fbeafc509f3002aa980e2a0662a1">OtherSucc</a>, NewWeights,</span></CodeLine>
<Link id="l07481" /><CodeLine lineNumber="7481"><span class="doxyHighlight">                       <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getMetadata(LLVMContext::MD&#95;unpredictable));</span></CodeLine>
<Link id="l07482" /><CodeLine lineNumber="7482"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/arm/armisellowering-cpp/#a8b40fbeafc509f3002aa980e2a0662a1">OtherSucc</a>-&gt;removePredecessor(BB);</span></CodeLine>
<Link id="l07483" /><CodeLine lineNumber="7483"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Unreachable)</span></CodeLine>
<Link id="l07484" /><CodeLine lineNumber="7484"><span class="doxyHighlight">    Unreachable-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BB);</span></CodeLine>
<Link id="l07485" /><CodeLine lineNumber="7485"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l07486" /><CodeLine lineNumber="7486"><span class="doxyHighlight">  Cmp-&gt;eraseFromParent();</span></CodeLine>
<Link id="l07487" /><CodeLine lineNumber="7487"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU &amp;&amp; Unreachable)</span></CodeLine>
<Link id="l07488" /><CodeLine lineNumber="7488"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(&#123;&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, Unreachable&#125;&#125;);</span></CodeLine>
<Link id="l07489" /><CodeLine lineNumber="7489"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07490" /><CodeLine lineNumber="7490"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07491" /><CodeLine lineNumber="7491"></CodeLine>
<Link id="l07492" /><CodeLine lineNumber="7492"><span class="doxyHighlightComment">/// Checking whether two cases of SI are equal depends on the contents of the</span></CodeLine>
<Link id="l07493" /><CodeLine lineNumber="7493"><span class="doxyHighlightComment">/// BasicBlock and the incoming values of their successor PHINodes.</span></CodeLine>
<Link id="l07494" /><CodeLine lineNumber="7494"><span class="doxyHighlightComment">/// PHINode::getIncomingValueForBlock is O(|Preds|), so we&#39;d like to avoid</span></CodeLine>
<Link id="l07495" /><CodeLine lineNumber="7495"><span class="doxyHighlightComment">/// calling this function on each BasicBlock every time isEqual is called,</span></CodeLine>
<Link id="l07496" /><CodeLine lineNumber="7496"><span class="doxyHighlightComment">/// especially since the same BasicBlock may be passed as an argument multiple</span></CodeLine>
<Link id="l07497" /><CodeLine lineNumber="7497"><span class="doxyHighlightComment">/// times. To do this, we can precompute a map of PHINode -&gt; Pred BasicBlock -&gt;</span></CodeLine>
<Link id="l07498" /><CodeLine lineNumber="7498"><span class="doxyHighlightComment">/// IncomingValue and add it in the Wrapper so isEqual can do O(1) checking</span></CodeLine>
<Link id="l07499" /><CodeLine lineNumber="7499"><span class="doxyHighlightComment">/// of the incoming values.</span></CodeLine>
<Link id="l07500" /><CodeLine lineNumber="7500" lineLink="/docs/api/structs/switchsuccwrapper"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/switchsuccwrapper">SwitchSuccWrapper</a> &#123;</span></CodeLine>
<Link id="l07501" /><CodeLine lineNumber="7501" lineLink="/docs/api/structs/switchsuccwrapper/#a0765647c64190b61909606646061c314"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/switchsuccwrapper/#a0765647c64190b61909606646061c314">Dest</a>;</span></CodeLine>
<Link id="l07502" /><CodeLine lineNumber="7502" lineLink="/docs/api/structs/switchsuccwrapper/#a0d0092e0f010e6f8831d0b4797f1a8d3"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;PHINode &#42;, SmallDenseMap&lt;BasicBlock &#42;, Value &#42;, 8&gt;</a>&gt; &#42;<a href="/docs/api/structs/switchsuccwrapper/#a0d0092e0f010e6f8831d0b4797f1a8d3">PhiPredIVs</a>;</span></CodeLine>
<Link id="l07503" /><CodeLine lineNumber="7503"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l07504" /><CodeLine lineNumber="7504"></CodeLine>
<Link id="l07505" /><CodeLine lineNumber="7505"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</span></CodeLine>
<Link id="l07506" /><CodeLine lineNumber="7506" lineLink="/docs/api/structs/llvm/densemapinfo-aa60992bff446bfaa212c7392dde9918"><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;&gt; </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/llvm/densemapinfo">DenseMapInfo</a>&lt;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/switchsuccwrapper">SwitchSuccWrapper</a> &#42;&gt; &#123;</span></CodeLine>
<Link id="l07507" /><CodeLine lineNumber="7507" lineLink="/docs/api/structs/llvm/densemapinfo-aa60992bff446bfaa212c7392dde9918/#a18c61803796493f72b0586769c4a4411"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/switchsuccwrapper">SwitchSuccWrapper</a> &#42;<a href="/docs/api/structs/llvm/densemapinfo-aa60992bff446bfaa212c7392dde9918/#a18c61803796493f72b0586769c4a4411">getEmptyKey</a>() &#123;</span></CodeLine>
<Link id="l07508" /><CodeLine lineNumber="7508"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/structs/switchsuccwrapper">SwitchSuccWrapper</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l07509" /><CodeLine lineNumber="7509"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-gvnsink-cpp-/densemapinfo/#a1423601a8e4ec304e0756df4e761ebbb">DenseMapInfo&lt;void &#42;&gt;::getEmptyKey</a>());</span></CodeLine>
<Link id="l07510" /><CodeLine lineNumber="7510"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07511" /><CodeLine lineNumber="7511" lineLink="/docs/api/structs/llvm/densemapinfo-aa60992bff446bfaa212c7392dde9918/#a363139e6f6560336e87f213cc356cc29"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/switchsuccwrapper">SwitchSuccWrapper</a> &#42;<a href="/docs/api/structs/llvm/densemapinfo-aa60992bff446bfaa212c7392dde9918/#a363139e6f6560336e87f213cc356cc29">getTombstoneKey</a>() &#123;</span></CodeLine>
<Link id="l07512" /><CodeLine lineNumber="7512"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/structs/switchsuccwrapper">SwitchSuccWrapper</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l07513" /><CodeLine lineNumber="7513"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-gvnsink-cpp-/densemapinfo/#a9571e26b946751eaf015a9b8dc508be9">DenseMapInfo&lt;void &#42;&gt;::getTombstoneKey</a>());</span></CodeLine>
<Link id="l07514" /><CodeLine lineNumber="7514"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07515" /><CodeLine lineNumber="7515" lineLink="/docs/api/structs/llvm/densemapinfo-aa60992bff446bfaa212c7392dde9918/#ade1da0b29f5e3cb310ac591da00699c3"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/densemapinfo-aa60992bff446bfaa212c7392dde9918/#ade1da0b29f5e3cb310ac591da00699c3">getHashValue</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/switchsuccwrapper">SwitchSuccWrapper</a> &#42;SSW) &#123;</span></CodeLine>
<Link id="l07516" /><CodeLine lineNumber="7516"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ = SSW-&gt;<a href="/docs/api/structs/switchsuccwrapper/#a0765647c64190b61909606646061c314">Dest</a>;</span></CodeLine>
<Link id="l07517" /><CodeLine lineNumber="7517"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l07518" /><CodeLine lineNumber="7518"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>() &amp;&amp;</span></CodeLine>
<Link id="l07519" /><CodeLine lineNumber="7519"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Only supporting unconditional branches for now&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07520" /><CodeLine lineNumber="7520"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a96b8f11f6f21ca0321294669dab83b35">getNumSuccessors</a>() == 1 &amp;&amp;</span></CodeLine>
<Link id="l07521" /><CodeLine lineNumber="7521"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Expected unconditional branches to have one successor&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07522" /><CodeLine lineNumber="7522"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>() == 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected just a single branch in the BB&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07523" /><CodeLine lineNumber="7523"></CodeLine>
<Link id="l07524" /><CodeLine lineNumber="7524"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Since we assume the BB is just a single BranchInst with a single</span></CodeLine>
<Link id="l07525" /><CodeLine lineNumber="7525"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// successor, we hash as the BB and the incoming Values of its successor</span></CodeLine>
<Link id="l07526" /><CodeLine lineNumber="7526"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// PHIs. Initially, we tried to just use the successor BB as the hash, but</span></CodeLine>
<Link id="l07527" /><CodeLine lineNumber="7527"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// including the incoming PHI values leads to better performance.</span></CodeLine>
<Link id="l07528" /><CodeLine lineNumber="7528"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We also tried to build a map from BB -&gt; Succs.IncomingValues ahead of</span></CodeLine>
<Link id="l07529" /><CodeLine lineNumber="7529"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// time and passing it in SwitchSuccWrapper, but this slowed down the</span></CodeLine>
<Link id="l07530" /><CodeLine lineNumber="7530"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// average compile time without having any impact on the worst case compile</span></CodeLine>
<Link id="l07531" /><CodeLine lineNumber="7531"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// time.</span></CodeLine>
<Link id="l07532" /><CodeLine lineNumber="7532"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l07533" /><CodeLine lineNumber="7533"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> PhiValsForBB;</span></CodeLine>
<Link id="l07534" /><CodeLine lineNumber="7534"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;Phi : BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>())</span></CodeLine>
<Link id="l07535" /><CodeLine lineNumber="7535"><span class="doxyHighlight">      PhiValsForBB.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>((&#42;SSW-&gt;<a href="/docs/api/structs/switchsuccwrapper/#a0d0092e0f010e6f8831d0b4797f1a8d3">PhiPredIVs</a>)&#91;&amp;Phi&#93;&#91;BB&#93;);</span></CodeLine>
<Link id="l07536" /><CodeLine lineNumber="7536"></CodeLine>
<Link id="l07537" /><CodeLine lineNumber="7537"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#add71474638430694c84640146383fc44">hash&#95;combine</a>(</span></CodeLine>
<Link id="l07538" /><CodeLine lineNumber="7538"><span class="doxyHighlight">        BB, <a href="/docs/api/namespaces/llvm/#af80edfc5e42059e045aa7bf7fe42bee3">hash&#95;combine&#95;range</a>(PhiValsForBB.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), PhiValsForBB.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>()));</span></CodeLine>
<Link id="l07539" /><CodeLine lineNumber="7539"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07540" /><CodeLine lineNumber="7540" lineLink="/docs/api/structs/llvm/densemapinfo-aa60992bff446bfaa212c7392dde9918/#afd0535a9a9691fbeaf8a97077837bff9"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/densemapinfo-aa60992bff446bfaa212c7392dde9918/#afd0535a9a9691fbeaf8a97077837bff9">isEqual</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/switchsuccwrapper">SwitchSuccWrapper</a> &#42;LHS,</span></CodeLine>
<Link id="l07541" /><CodeLine lineNumber="7541"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/switchsuccwrapper">SwitchSuccWrapper</a> &#42;RHS) &#123;</span></CodeLine>
<Link id="l07542" /><CodeLine lineNumber="7542"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EKey = <a href="/docs/api/structs/anonymous-namespace-gvnsink-cpp-/densemapinfo/#a1423601a8e4ec304e0756df4e761ebbb">DenseMapInfo&lt;SwitchSuccWrapper &#42;&gt;::getEmptyKey</a>();</span></CodeLine>
<Link id="l07543" /><CodeLine lineNumber="7543"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TKey = <a href="/docs/api/structs/anonymous-namespace-gvnsink-cpp-/densemapinfo/#a9571e26b946751eaf015a9b8dc508be9">DenseMapInfo&lt;SwitchSuccWrapper &#42;&gt;::getTombstoneKey</a>();</span></CodeLine>
<Link id="l07544" /><CodeLine lineNumber="7544"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LHS == EKey || RHS == EKey || LHS == TKey || RHS == TKey)</span></CodeLine>
<Link id="l07545" /><CodeLine lineNumber="7545"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LHS == RHS;</span></CodeLine>
<Link id="l07546" /><CodeLine lineNumber="7546"></CodeLine>
<Link id="l07547" /><CodeLine lineNumber="7547"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = LHS-&gt;Dest;</span></CodeLine>
<Link id="l07548" /><CodeLine lineNumber="7548"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = RHS-&gt;Dest;</span></CodeLine>
<Link id="l07549" /><CodeLine lineNumber="7549"></CodeLine>
<Link id="l07550" /><CodeLine lineNumber="7550"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: we checked that the size of A and B are both 1 in</span></CodeLine>
<Link id="l07551" /><CodeLine lineNumber="7551"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// simplifyDuplicateSwitchArms to make the Case list smaller to</span></CodeLine>
<Link id="l07552" /><CodeLine lineNumber="7552"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// improve performance. If we decide to support BasicBlocks with more</span></CodeLine>
<Link id="l07553" /><CodeLine lineNumber="7553"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// than just a single instruction, we need to check that A.size() ==</span></CodeLine>
<Link id="l07554" /><CodeLine lineNumber="7554"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// B.size() here, and we need to check more than just the BranchInsts</span></CodeLine>
<Link id="l07555" /><CodeLine lineNumber="7555"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for equality.</span></CodeLine>
<Link id="l07556" /><CodeLine lineNumber="7556"></CodeLine>
<Link id="l07557" /><CodeLine lineNumber="7557"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;ABI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getTerminator());</span></CodeLine>
<Link id="l07558" /><CodeLine lineNumber="7558"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BBI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;getTerminator());</span></CodeLine>
<Link id="l07559" /><CodeLine lineNumber="7559"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ABI-&gt;isUnconditional() &amp;&amp; BBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>() &amp;&amp;</span></CodeLine>
<Link id="l07560" /><CodeLine lineNumber="7560"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Only supporting unconditional branches for now&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07561" /><CodeLine lineNumber="7561"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ABI-&gt;getSuccessor(0) != BBI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0))</span></CodeLine>
<Link id="l07562" /><CodeLine lineNumber="7562"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07563" /><CodeLine lineNumber="7563"></CodeLine>
<Link id="l07564" /><CodeLine lineNumber="7564"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Need to check that PHIs in successor have matching values</span></CodeLine>
<Link id="l07565" /><CodeLine lineNumber="7565"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ = ABI-&gt;getSuccessor(0);</span></CodeLine>
<Link id="l07566" /><CodeLine lineNumber="7566"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;Phi : Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l07567" /><CodeLine lineNumber="7567"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;PredIVs = (&#42;LHS-&gt;PhiPredIVs)&#91;&amp;Phi&#93;;</span></CodeLine>
<Link id="l07568" /><CodeLine lineNumber="7568"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredIVs&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>&#93; != PredIVs&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>&#93;)</span></CodeLine>
<Link id="l07569" /><CodeLine lineNumber="7569"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07570" /><CodeLine lineNumber="7570"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07571" /><CodeLine lineNumber="7571"></CodeLine>
<Link id="l07572" /><CodeLine lineNumber="7572"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07573" /><CodeLine lineNumber="7573"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07574" /><CodeLine lineNumber="7574"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l07575" /><CodeLine lineNumber="7575"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace llvm</span></CodeLine>
<Link id="l07576" /><CodeLine lineNumber="7576"></CodeLine>
<Link id="l07577" /><CodeLine lineNumber="7577"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyDuplicateSwitchArms(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>,</span></CodeLine>
<Link id="l07578" /><CodeLine lineNumber="7578"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU) &#123;</span></CodeLine>
<Link id="l07579" /><CodeLine lineNumber="7579"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build Cases. Skip BBs that are not candidates for simplification. Mark</span></CodeLine>
<Link id="l07580" /><CodeLine lineNumber="7580"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHINodes which need to be processed into PhiPredIVs. We decide to process</span></CodeLine>
<Link id="l07581" /><CodeLine lineNumber="7581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// an entire PHI at once after the loop, opposed to calling</span></CodeLine>
<Link id="l07582" /><CodeLine lineNumber="7582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// getIncomingValueForBlock inside this loop, since each call to</span></CodeLine>
<Link id="l07583" /><CodeLine lineNumber="7583"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// getIncomingValueForBlock is O(|Preds|).</span></CodeLine>
<Link id="l07584" /><CodeLine lineNumber="7584"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;PHINode &#42;, 8&gt;</a> Phis;</span></CodeLine>
<Link id="l07585" /><CodeLine lineNumber="7585"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 8&gt;</a> Seen;</span></CodeLine>
<Link id="l07586" /><CodeLine lineNumber="7586"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;PHINode &#42;, SmallDenseMap&lt;BasicBlock &#42;, Value &#42;, 8&gt;</a>&gt; PhiPredIVs;</span></CodeLine>
<Link id="l07587" /><CodeLine lineNumber="7587"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, SmallVector&lt;unsigned, 4&gt;</a>&gt; BBToSuccessorIndexes;</span></CodeLine>
<Link id="l07588" /><CodeLine lineNumber="7588"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SwitchSuccWrapper&gt;</a> Cases;</span></CodeLine>
<Link id="l07589" /><CodeLine lineNumber="7589"><span class="doxyHighlight">  Cases.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumSuccessors());</span></CodeLine>
<Link id="l07590" /><CodeLine lineNumber="7590"></CodeLine>
<Link id="l07591" /><CodeLine lineNumber="7591"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getNumSuccessors(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l07592" /><CodeLine lineNumber="7592"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getSuccessor(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07593" /><CodeLine lineNumber="7593"></CodeLine>
<Link id="l07594" /><CodeLine lineNumber="7594"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Support more than just a single BranchInst. One way we could do</span></CodeLine>
<Link id="l07595" /><CodeLine lineNumber="7595"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this is by taking a hashing approach of all insts in BB.</span></CodeLine>
<Link id="l07596" /><CodeLine lineNumber="7596"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>() != 1)</span></CodeLine>
<Link id="l07597" /><CodeLine lineNumber="7597"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07598" /><CodeLine lineNumber="7598"></CodeLine>
<Link id="l07599" /><CodeLine lineNumber="7599"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: This case needs some extra care because the terminators other than</span></CodeLine>
<Link id="l07600" /><CodeLine lineNumber="7600"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SI need to be updated. For now, consider only backedges to the SI.</span></CodeLine>
<Link id="l07601" /><CodeLine lineNumber="7601"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ae020673b5ca2bae358005b8980413c4c">hasNPredecessorsOrMore</a>(4) ||</span></CodeLine>
<Link id="l07602" /><CodeLine lineNumber="7602"><span class="doxyHighlight">        BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>() != <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent())</span></CodeLine>
<Link id="l07603" /><CodeLine lineNumber="7603"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07604" /><CodeLine lineNumber="7604"></CodeLine>
<Link id="l07605" /><CodeLine lineNumber="7605"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Relax that the terminator is a BranchInst by checking for equality</span></CodeLine>
<Link id="l07606" /><CodeLine lineNumber="7606"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// on other kinds of terminators. We decide to only support unconditional</span></CodeLine>
<Link id="l07607" /><CodeLine lineNumber="7607"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// branches for now for compile time reasons.</span></CodeLine>
<Link id="l07608" /><CodeLine lineNumber="7608"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l07609" /><CodeLine lineNumber="7609"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI || BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>())</span></CodeLine>
<Link id="l07610" /><CodeLine lineNumber="7610"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07611" /><CodeLine lineNumber="7611"></CodeLine>
<Link id="l07612" /><CodeLine lineNumber="7612"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Seen.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(BB).second) &#123;</span></CodeLine>
<Link id="l07613" /><CodeLine lineNumber="7613"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Keep track of which PHIs we need as keys in PhiPredIVs below.</span></CodeLine>
<Link id="l07614" /><CodeLine lineNumber="7614"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a254b2cfabe80269ee4f53f6698452db6">successors</a>())</span></CodeLine>
<Link id="l07615" /><CodeLine lineNumber="7615"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;Phi : Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>())</span></CodeLine>
<Link id="l07616" /><CodeLine lineNumber="7616"><span class="doxyHighlight">          Phis.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&amp;Phi);</span></CodeLine>
<Link id="l07617" /><CodeLine lineNumber="7617"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add the successor only if not previously visited.</span></CodeLine>
<Link id="l07618" /><CodeLine lineNumber="7618"><span class="doxyHighlight">      Cases.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(<a href="/docs/api/structs/switchsuccwrapper">SwitchSuccWrapper</a>&#123;BB, &amp;PhiPredIVs&#125;);</span></CodeLine>
<Link id="l07619" /><CodeLine lineNumber="7619"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07620" /><CodeLine lineNumber="7620"></CodeLine>
<Link id="l07621" /><CodeLine lineNumber="7621"><span class="doxyHighlight">    BBToSuccessorIndexes&#91;BB&#93;.emplace&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07622" /><CodeLine lineNumber="7622"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07623" /><CodeLine lineNumber="7623"></CodeLine>
<Link id="l07624" /><CodeLine lineNumber="7624"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Precompute a data structure to improve performance of isEqual for</span></CodeLine>
<Link id="l07625" /><CodeLine lineNumber="7625"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SwitchSuccWrapper.</span></CodeLine>
<Link id="l07626" /><CodeLine lineNumber="7626"><span class="doxyHighlight">  PhiPredIVs.<a href="/docs/api/classes/llvm/densemapbase/#ae292a4b96e7f74eb95a4176ddba7b821">reserve</a>(Phis.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>());</span></CodeLine>
<Link id="l07627" /><CodeLine lineNumber="7627"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi : Phis) &#123;</span></CodeLine>
<Link id="l07628" /><CodeLine lineNumber="7628"><span class="doxyHighlight">    PhiPredIVs&#91;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>&#93; =</span></CodeLine>
<Link id="l07629" /><CodeLine lineNumber="7629"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;BasicBlock &#42;, Value &#42;, 8&gt;</a>(<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getNumIncomingValues());</span></CodeLine>
<Link id="l07630" /><CodeLine lineNumber="7630"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> : <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;incoming&#95;values())</span></CodeLine>
<Link id="l07631" /><CodeLine lineNumber="7631"><span class="doxyHighlight">      PhiPredIVs&#91;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>&#93;.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingBlock(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>), <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>.get()&#125;);</span></CodeLine>
<Link id="l07632" /><CodeLine lineNumber="7632"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07633" /><CodeLine lineNumber="7633"></CodeLine>
<Link id="l07634" /><CodeLine lineNumber="7634"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build a set such that if the SwitchSuccWrapper exists in the set and</span></CodeLine>
<Link id="l07635" /><CodeLine lineNumber="7635"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// another SwitchSuccWrapper isEqual, then the equivalent SwitchSuccWrapper</span></CodeLine>
<Link id="l07636" /><CodeLine lineNumber="7636"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which is not in the set should be replaced with the one in the set. If the</span></CodeLine>
<Link id="l07637" /><CodeLine lineNumber="7637"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SwitchSuccWrapper is not in the set, then it should be added to the set so</span></CodeLine>
<Link id="l07638" /><CodeLine lineNumber="7638"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// other SwitchSuccWrappers can check against it in the same manner. We use</span></CodeLine>
<Link id="l07639" /><CodeLine lineNumber="7639"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SwitchSuccWrapper instead of just BasicBlock because we&#39;d like to pass</span></CodeLine>
<Link id="l07640" /><CodeLine lineNumber="7640"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// around information to isEquality, getHashValue, and when doing the</span></CodeLine>
<Link id="l07641" /><CodeLine lineNumber="7641"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// replacement with better performance.</span></CodeLine>
<Link id="l07642" /><CodeLine lineNumber="7642"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;const SwitchSuccWrapper &#42;&gt;</a> ReplaceWith;</span></CodeLine>
<Link id="l07643" /><CodeLine lineNumber="7643"><span class="doxyHighlight">  ReplaceWith.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a5b0a15cec07aa8f0f9e60cd343676bca">reserve</a>(Cases.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</span></CodeLine>
<Link id="l07644" /><CodeLine lineNumber="7644"></CodeLine>
<Link id="l07645" /><CodeLine lineNumber="7645"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType&gt;</a> Updates;</span></CodeLine>
<Link id="l07646" /><CodeLine lineNumber="7646"><span class="doxyHighlight">  Updates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(ReplaceWith.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a9a025cb106832026cd05c2b4648a699f">size</a>());</span></CodeLine>
<Link id="l07647" /><CodeLine lineNumber="7647"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07648" /><CodeLine lineNumber="7648"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;SSW : Cases) &#123;</span></CodeLine>
<Link id="l07649" /><CodeLine lineNumber="7649"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SSW is a candidate for simplification. If we find a duplicate BB,</span></CodeLine>
<Link id="l07650" /><CodeLine lineNumber="7650"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// replace it.</span></CodeLine>
<Link id="l07651" /><CodeLine lineNumber="7651"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;It, <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa157d034f9c98a305eb73776582550027">Inserted</a>&#93; = ReplaceWith.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(&amp;SSW);</span></CodeLine>
<Link id="l07652" /><CodeLine lineNumber="7652"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inserted) &#123;</span></CodeLine>
<Link id="l07653" /><CodeLine lineNumber="7653"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We know that SI&#39;s parent BB no longer dominates the old case successor</span></CodeLine>
<Link id="l07654" /><CodeLine lineNumber="7654"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// since we are making it dead.</span></CodeLine>
<Link id="l07655" /><CodeLine lineNumber="7655"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent(), SSW.Dest&#125;);</span></CodeLine>
<Link id="l07656" /><CodeLine lineNumber="7656"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Successors = BBToSuccessorIndexes.<a href="/docs/api/classes/llvm/densemapbase/#a6cf1231457e9dca2d160ee236da9dfaa">at</a>(SSW.Dest);</span></CodeLine>
<Link id="l07657" /><CodeLine lineNumber="7657"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx : Successors)</span></CodeLine>
<Link id="l07658" /><CodeLine lineNumber="7658"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;setSuccessor(Idx, (&#42;It)-&gt;Dest);</span></CodeLine>
<Link id="l07659" /><CodeLine lineNumber="7659"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07660" /><CodeLine lineNumber="7660"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07661" /><CodeLine lineNumber="7661"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07662" /><CodeLine lineNumber="7662"></CodeLine>
<Link id="l07663" /><CodeLine lineNumber="7663"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l07664" /><CodeLine lineNumber="7664"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l07665" /><CodeLine lineNumber="7665"></CodeLine>
<Link id="l07666" /><CodeLine lineNumber="7666"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l07667" /><CodeLine lineNumber="7667"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07668" /><CodeLine lineNumber="7668"></CodeLine>
<Link id="l07669" /><CodeLine lineNumber="7669"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifySwitch(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l07670" /><CodeLine lineNumber="7670"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent();</span></CodeLine>
<Link id="l07671" /><CodeLine lineNumber="7671"></CodeLine>
<Link id="l07672" /><CodeLine lineNumber="7672"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isValueEqualityComparison(<a href="/docs/api/namespaces/llvm/si">SI</a>)) &#123;</span></CodeLine>
<Link id="l07673" /><CodeLine lineNumber="7673"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we only have one predecessor, and if it is a branch on this value,</span></CodeLine>
<Link id="l07674" /><CodeLine lineNumber="7674"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// see if that predecessor totally determines the outcome of this switch.</span></CodeLine>
<Link id="l07675" /><CodeLine lineNumber="7675"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OnlyPred = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>())</span></CodeLine>
<Link id="l07676" /><CodeLine lineNumber="7676"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (simplifyEqualityComparisonWithOnlyPredecessor(<a href="/docs/api/namespaces/llvm/si">SI</a>, OnlyPred, Builder))</span></CodeLine>
<Link id="l07677" /><CodeLine lineNumber="7677"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07678" /><CodeLine lineNumber="7678"></CodeLine>
<Link id="l07679" /><CodeLine lineNumber="7679"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition();</span></CodeLine>
<Link id="l07680" /><CodeLine lineNumber="7680"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>))</span></CodeLine>
<Link id="l07681" /><CodeLine lineNumber="7681"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (simplifySwitchOnSelect(<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>))</span></CodeLine>
<Link id="l07682" /><CodeLine lineNumber="7682"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07683" /><CodeLine lineNumber="7683"></CodeLine>
<Link id="l07684" /><CodeLine lineNumber="7684"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the block only contains the switch, see if we can fold the block</span></CodeLine>
<Link id="l07685" /><CodeLine lineNumber="7685"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// away into any preds.</span></CodeLine>
<Link id="l07686" /><CodeLine lineNumber="7686"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a> == &amp;&#42;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a2069641f358ef416658a2f321ca19d74">instructionsWithoutDebug</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">).begin())</span></CodeLine>
<Link id="l07687" /><CodeLine lineNumber="7687"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (foldValueComparisonIntoPredecessors(<a href="/docs/api/namespaces/llvm/si">SI</a>, Builder))</span></CodeLine>
<Link id="l07688" /><CodeLine lineNumber="7688"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07689" /><CodeLine lineNumber="7689"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07690" /><CodeLine lineNumber="7690"></CodeLine>
<Link id="l07691" /><CodeLine lineNumber="7691"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to transform the switch into an icmp and a branch.</span></CodeLine>
<Link id="l07692" /><CodeLine lineNumber="7692"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The conversion from switch to comparison may lose information on</span></CodeLine>
<Link id="l07693" /><CodeLine lineNumber="7693"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// impossible switch values, so disable it early in the pipeline.</span></CodeLine>
<Link id="l07694" /><CodeLine lineNumber="7694"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.ConvertSwitchRangeToICmp &amp;&amp; turnSwitchRangeIntoICmp(<a href="/docs/api/namespaces/llvm/si">SI</a>, Builder))</span></CodeLine>
<Link id="l07695" /><CodeLine lineNumber="7695"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07696" /><CodeLine lineNumber="7696"></CodeLine>
<Link id="l07697" /><CodeLine lineNumber="7697"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove unreachable cases.</span></CodeLine>
<Link id="l07698" /><CodeLine lineNumber="7698"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a83b0a34d940365e97b9a531c1f13f3b9">eliminateDeadSwitchCases</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, DTU, <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.AC, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l07699" /><CodeLine lineNumber="7699"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07700" /><CodeLine lineNumber="7700"></CodeLine>
<Link id="l07701" /><CodeLine lineNumber="7701"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a3e8ca2c20b8c4c14c72c49d98f3801ed">simplifySwitchOfCmpIntrinsic</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, Builder, DTU))</span></CodeLine>
<Link id="l07702" /><CodeLine lineNumber="7702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07703" /><CodeLine lineNumber="7703"></CodeLine>
<Link id="l07704" /><CodeLine lineNumber="7704"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a794d3a5f46134c24aade41b327d8418e">trySwitchToSelect</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, Builder, DTU, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l07705" /><CodeLine lineNumber="7705"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07706" /><CodeLine lineNumber="7706"></CodeLine>
<Link id="l07707" /><CodeLine lineNumber="7707"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.ForwardSwitchCondToPhi &amp;&amp; <a href="#a480bd8ae64f6f3e4a9cc6e1a724b2ad0">forwardSwitchConditionToPHI</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>))</span></CodeLine>
<Link id="l07708" /><CodeLine lineNumber="7708"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07709" /><CodeLine lineNumber="7709"></CodeLine>
<Link id="l07710" /><CodeLine lineNumber="7710"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The conversion from switch to lookup tables results in difficult-to-analyze</span></CodeLine>
<Link id="l07711" /><CodeLine lineNumber="7711"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// code and makes pruning branches much harder. This is a problem if the</span></CodeLine>
<Link id="l07712" /><CodeLine lineNumber="7712"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// switch expression itself can still be restricted as a result of inlining or</span></CodeLine>
<Link id="l07713" /><CodeLine lineNumber="7713"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// CVP. Therefore, only apply this transformation during late stages of the</span></CodeLine>
<Link id="l07714" /><CodeLine lineNumber="7714"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimisation pipeline.</span></CodeLine>
<Link id="l07715" /><CodeLine lineNumber="7715"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.ConvertSwitchToLookupTable &amp;&amp;</span></CodeLine>
<Link id="l07716" /><CodeLine lineNumber="7716"><span class="doxyHighlight">      <a href="#a4abbfca67cb7fc77432aa8cd48af8b0a">switchToLookupTable</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, Builder, DTU, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l07717" /><CodeLine lineNumber="7717"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07718" /><CodeLine lineNumber="7718"></CodeLine>
<Link id="l07719" /><CodeLine lineNumber="7719"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#adc11c5fbec9bf293b000637357da66e4">simplifySwitchOfPowersOfTwo</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, Builder, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l07720" /><CodeLine lineNumber="7720"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07721" /><CodeLine lineNumber="7721"></CodeLine>
<Link id="l07722" /><CodeLine lineNumber="7722"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a6860a87b20545e2f53641a1bf33f6c4c">reduceSwitchRange</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, Builder, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l07723" /><CodeLine lineNumber="7723"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07724" /><CodeLine lineNumber="7724"></CodeLine>
<Link id="l07725" /><CodeLine lineNumber="7725"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a8e8073e7ef8737b21cdf98608bbd17b9">HoistCommon</a> &amp;&amp;</span></CodeLine>
<Link id="l07726" /><CodeLine lineNumber="7726"><span class="doxyHighlight">      hoistCommonCodeFromSuccessors(<a href="/docs/api/namespaces/llvm/si">SI</a>, !<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.HoistCommonInsts))</span></CodeLine>
<Link id="l07727" /><CodeLine lineNumber="7727"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07728" /><CodeLine lineNumber="7728"></CodeLine>
<Link id="l07729" /><CodeLine lineNumber="7729"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (simplifyDuplicateSwitchArms(<a href="/docs/api/namespaces/llvm/si">SI</a>, DTU))</span></CodeLine>
<Link id="l07730" /><CodeLine lineNumber="7730"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07731" /><CodeLine lineNumber="7731"></CodeLine>
<Link id="l07732" /><CodeLine lineNumber="7732"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07733" /><CodeLine lineNumber="7733"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07734" /><CodeLine lineNumber="7734"></CodeLine>
<Link id="l07735" /><CodeLine lineNumber="7735"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyIndirectBr(<a href="/docs/api/classes/llvm/indirectbrinst">IndirectBrInst</a> &#42;IBI) &#123;</span></CodeLine>
<Link id="l07736" /><CodeLine lineNumber="7736"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = IBI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l07737" /><CodeLine lineNumber="7737"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07738" /><CodeLine lineNumber="7738"></CodeLine>
<Link id="l07739" /><CodeLine lineNumber="7739"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Eliminate redundant destinations.</span></CodeLine>
<Link id="l07740" /><CodeLine lineNumber="7740"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 8&gt;</a> Succs;</span></CodeLine>
<Link id="l07741" /><CodeLine lineNumber="7741"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;BasicBlock &#42;, 8&gt;</a> RemovedSuccs;</span></CodeLine>
<Link id="l07742" /><CodeLine lineNumber="7742"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = IBI-&gt;<a href="/docs/api/classes/llvm/indirectbrinst/#abd4f6893d4f810f4162a70f89b2452fe">getNumDestinations</a>(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l07743" /><CodeLine lineNumber="7743"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dest = IBI-&gt;<a href="/docs/api/classes/llvm/indirectbrinst/#a1a53ee48e5f0d2aff838d12c367feb5b">getDestination</a>(i);</span></CodeLine>
<Link id="l07744" /><CodeLine lineNumber="7744"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Dest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>() || !Succs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Dest).second) &#123;</span></CodeLine>
<Link id="l07745" /><CodeLine lineNumber="7745"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Dest-&gt;<a href="/docs/api/classes/llvm/basicblock/#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>())</span></CodeLine>
<Link id="l07746" /><CodeLine lineNumber="7746"><span class="doxyHighlight">        RemovedSuccs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Dest);</span></CodeLine>
<Link id="l07747" /><CodeLine lineNumber="7747"><span class="doxyHighlight">      Dest-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BB);</span></CodeLine>
<Link id="l07748" /><CodeLine lineNumber="7748"><span class="doxyHighlight">      IBI-&gt;<a href="/docs/api/classes/llvm/indirectbrinst/#ac0cc9b34e16910d245245642350d4456">removeDestination</a>(i);</span></CodeLine>
<Link id="l07749" /><CodeLine lineNumber="7749"><span class="doxyHighlight">      --i;</span></CodeLine>
<Link id="l07750" /><CodeLine lineNumber="7750"><span class="doxyHighlight">      --<a href="/docs/api/namespaces/llvm/numbers/#a92f4283d4e0e2ea1776894b3ae93640f">e</a>;</span></CodeLine>
<Link id="l07751" /><CodeLine lineNumber="7751"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07752" /><CodeLine lineNumber="7752"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07753" /><CodeLine lineNumber="7753"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07754" /><CodeLine lineNumber="7754"></CodeLine>
<Link id="l07755" /><CodeLine lineNumber="7755"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l07756" /><CodeLine lineNumber="7756"><span class="doxyHighlight">    std::vector&lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l07757" /><CodeLine lineNumber="7757"><span class="doxyHighlight">    Updates.reserve(RemovedSuccs.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>());</span></CodeLine>
<Link id="l07758" /><CodeLine lineNumber="7758"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RemovedSucc : RemovedSuccs)</span></CodeLine>
<Link id="l07759" /><CodeLine lineNumber="7759"><span class="doxyHighlight">      Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, RemovedSucc&#125;);</span></CodeLine>
<Link id="l07760" /><CodeLine lineNumber="7760"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l07761" /><CodeLine lineNumber="7761"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07762" /><CodeLine lineNumber="7762"></CodeLine>
<Link id="l07763" /><CodeLine lineNumber="7763"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IBI-&gt;<a href="/docs/api/classes/llvm/indirectbrinst/#abd4f6893d4f810f4162a70f89b2452fe">getNumDestinations</a>() == 0) &#123;</span></CodeLine>
<Link id="l07764" /><CodeLine lineNumber="7764"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the indirectbr has no successors, change it to unreachable.</span></CodeLine>
<Link id="l07765" /><CodeLine lineNumber="7765"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(IBI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), IBI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l07766" /><CodeLine lineNumber="7766"><span class="doxyHighlight">    <a href="#aa9dd0c9b2a49c91d814102c1d0c7b09d">eraseTerminatorAndDCECond</a>(IBI);</span></CodeLine>
<Link id="l07767" /><CodeLine lineNumber="7767"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07768" /><CodeLine lineNumber="7768"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07769" /><CodeLine lineNumber="7769"></CodeLine>
<Link id="l07770" /><CodeLine lineNumber="7770"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IBI-&gt;<a href="/docs/api/classes/llvm/indirectbrinst/#abd4f6893d4f810f4162a70f89b2452fe">getNumDestinations</a>() == 1) &#123;</span></CodeLine>
<Link id="l07771" /><CodeLine lineNumber="7771"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the indirectbr has one successor, change it to a direct branch.</span></CodeLine>
<Link id="l07772" /><CodeLine lineNumber="7772"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(IBI-&gt;<a href="/docs/api/classes/llvm/indirectbrinst/#a1a53ee48e5f0d2aff838d12c367feb5b">getDestination</a>(0), IBI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l07773" /><CodeLine lineNumber="7773"><span class="doxyHighlight">    <a href="#aa9dd0c9b2a49c91d814102c1d0c7b09d">eraseTerminatorAndDCECond</a>(IBI);</span></CodeLine>
<Link id="l07774" /><CodeLine lineNumber="7774"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07775" /><CodeLine lineNumber="7775"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07776" /><CodeLine lineNumber="7776"></CodeLine>
<Link id="l07777" /><CodeLine lineNumber="7777"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(IBI-&gt;<a href="/docs/api/classes/llvm/indirectbrinst/#a47ee004c9106856aaea0fc3e063105a7">getAddress</a>())) &#123;</span></CodeLine>
<Link id="l07778" /><CodeLine lineNumber="7778"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (simplifyIndirectBrOnSelect(IBI, <a href="/docs/api/namespaces/llvm/si">SI</a>))</span></CodeLine>
<Link id="l07779" /><CodeLine lineNumber="7779"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07780" /><CodeLine lineNumber="7780"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07781" /><CodeLine lineNumber="7781"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l07782" /><CodeLine lineNumber="7782"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07783" /><CodeLine lineNumber="7783"></CodeLine>
<Link id="l07784" /><CodeLine lineNumber="7784"><span class="doxyHighlightComment">/// Given an block with only a single landing pad and a unconditional branch</span></CodeLine>
<Link id="l07785" /><CodeLine lineNumber="7785"><span class="doxyHighlightComment">/// try to find another basic block which this one can be merged with.  This</span></CodeLine>
<Link id="l07786" /><CodeLine lineNumber="7786"><span class="doxyHighlightComment">/// handles cases where we have multiple invokes with unique landing pads, but</span></CodeLine>
<Link id="l07787" /><CodeLine lineNumber="7787"><span class="doxyHighlightComment">/// a shared handler.</span></CodeLine>
<Link id="l07788" /><CodeLine lineNumber="7788"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l07789" /><CodeLine lineNumber="7789"><span class="doxyHighlightComment">/// We specifically choose to not worry about merging non-empty blocks</span></CodeLine>
<Link id="l07790" /><CodeLine lineNumber="7790"><span class="doxyHighlightComment">/// here.  That is a PRE/scheduling problem and is best solved elsewhere.  In</span></CodeLine>
<Link id="l07791" /><CodeLine lineNumber="7791"><span class="doxyHighlightComment">/// practice, the optimizer produces empty landing pad blocks quite frequently</span></CodeLine>
<Link id="l07792" /><CodeLine lineNumber="7792"><span class="doxyHighlightComment">/// when dealing with exception dense code.  (see: instcombine, gvn, if-else</span></CodeLine>
<Link id="l07793" /><CodeLine lineNumber="7793"><span class="doxyHighlightComment">/// sinking in this file)</span></CodeLine>
<Link id="l07794" /><CodeLine lineNumber="7794"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l07795" /><CodeLine lineNumber="7795"><span class="doxyHighlightComment">/// This is primarily a code size optimization.  We need to avoid performing</span></CodeLine>
<Link id="l07796" /><CodeLine lineNumber="7796"><span class="doxyHighlightComment">/// any transform which might inhibit optimization (such as our ability to</span></CodeLine>
<Link id="l07797" /><CodeLine lineNumber="7797"><span class="doxyHighlightComment">/// specialize a particular handler via tail commoning).  We do this by not</span></CodeLine>
<Link id="l07798" /><CodeLine lineNumber="7798"><span class="doxyHighlightComment">/// merging any blocks which require us to introduce a phi.  Since the same</span></CodeLine>
<Link id="l07799" /><CodeLine lineNumber="7799"><span class="doxyHighlightComment">/// values are flowing through both blocks, we don&#39;t lose any ability to</span></CodeLine>
<Link id="l07800" /><CodeLine lineNumber="7800"><span class="doxyHighlightComment">/// specialize.  If anything, we make such specialization more likely.</span></CodeLine>
<Link id="l07801" /><CodeLine lineNumber="7801"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l07802" /><CodeLine lineNumber="7802"><span class="doxyHighlightComment">/// TODO - This transformation could remove entries from a phi in the target</span></CodeLine>
<Link id="l07803" /><CodeLine lineNumber="7803"><span class="doxyHighlightComment">/// block when the inputs in the phi are the same for the two blocks being</span></CodeLine>
<Link id="l07804" /><CodeLine lineNumber="7804"><span class="doxyHighlightComment">/// merged.  In some cases, this could result in removal of the PHI entirely.</span></CodeLine>
<Link id="l07805" /><CodeLine lineNumber="7805" lineLink="#a428f7b53e32934ae46a9aa35d3028d87"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a428f7b53e32934ae46a9aa35d3028d87">tryToMergeLandingPad</a>(<a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &#42;LPad, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI,</span></CodeLine>
<Link id="l07806" /><CodeLine lineNumber="7806"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU) &#123;</span></CodeLine>
<Link id="l07807" /><CodeLine lineNumber="7807"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Succ = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a57f1945911ca1e95d0f51d7c3516b529">getUniqueSuccessor</a>();</span></CodeLine>
<Link id="l07808" /><CodeLine lineNumber="7808"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Succ);</span></CodeLine>
<Link id="l07809" /><CodeLine lineNumber="7809"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there&#39;s a phi in the successor block, we&#39;d likely have to introduce</span></CodeLine>
<Link id="l07810" /><CodeLine lineNumber="7810"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a phi into the merged landing pad block.</span></CodeLine>
<Link id="l07811" /><CodeLine lineNumber="7811"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(&#42;Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()))</span></CodeLine>
<Link id="l07812" /><CodeLine lineNumber="7812"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07813" /><CodeLine lineNumber="7813"></CodeLine>
<Link id="l07814" /><CodeLine lineNumber="7814"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OtherPred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Succ)) &#123;</span></CodeLine>
<Link id="l07815" /><CodeLine lineNumber="7815"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB == OtherPred)</span></CodeLine>
<Link id="l07816" /><CodeLine lineNumber="7816"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07817" /><CodeLine lineNumber="7817"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = OtherPred-&gt;begin();</span></CodeLine>
<Link id="l07818" /><CodeLine lineNumber="7818"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &#42;LPad2 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LandingPadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07819" /><CodeLine lineNumber="7819"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LPad2 || !LPad2-&gt;<a href="/docs/api/classes/llvm/instruction/#ad848bd0184fc7bcb7b71e19248f08f34">isIdenticalTo</a>(LPad))</span></CodeLine>
<Link id="l07820" /><CodeLine lineNumber="7820"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07821" /><CodeLine lineNumber="7821"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l07822" /><CodeLine lineNumber="7822"><span class="doxyHighlight">      ;</span></CodeLine>
<Link id="l07823" /><CodeLine lineNumber="7823"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI2 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07824" /><CodeLine lineNumber="7824"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI2 || !BI2-&gt;<a href="/docs/api/classes/llvm/instruction/#ad848bd0184fc7bcb7b71e19248f08f34">isIdenticalTo</a>(BI))</span></CodeLine>
<Link id="l07825" /><CodeLine lineNumber="7825"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07826" /><CodeLine lineNumber="7826"></CodeLine>
<Link id="l07827" /><CodeLine lineNumber="7827"><span class="doxyHighlight">    std::vector&lt;DominatorTree::UpdateType&gt; Updates;</span></CodeLine>
<Link id="l07828" /><CodeLine lineNumber="7828"></CodeLine>
<Link id="l07829" /><CodeLine lineNumber="7829"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We&#39;ve found an identical block.  Update our predecessors to take that</span></CodeLine>
<Link id="l07830" /><CodeLine lineNumber="7830"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// path instead and make ourselves dead.</span></CodeLine>
<Link id="l07831" /><CodeLine lineNumber="7831"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;BasicBlock &#42;, 16&gt;</a> UniquePreds(<a href="/docs/api/namespaces/llvm/#ac3e549d97549636a7f08779d5cd98540">pred&#95;begin</a>(BB), <a href="/docs/api/namespaces/llvm/#a2103c335fa6ab933312c3871c82b0106">pred&#95;end</a>(BB));</span></CodeLine>
<Link id="l07832" /><CodeLine lineNumber="7832"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : UniquePreds) &#123;</span></CodeLine>
<Link id="l07833" /><CodeLine lineNumber="7833"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/invokeinst">InvokeInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;InvokeInst&gt;</a>(Pred-&gt;getTerminator());</span></CodeLine>
<Link id="l07834" /><CodeLine lineNumber="7834"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getNormalDest() != BB &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getUnwindDest() == BB &amp;&amp;</span></CodeLine>
<Link id="l07835" /><CodeLine lineNumber="7835"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;unexpected successor&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07836" /><CodeLine lineNumber="7836"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;setUnwindDest(OtherPred);</span></CodeLine>
<Link id="l07837" /><CodeLine lineNumber="7837"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l07838" /><CodeLine lineNumber="7838"><span class="doxyHighlight">        Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, Pred, OtherPred&#125;);</span></CodeLine>
<Link id="l07839" /><CodeLine lineNumber="7839"><span class="doxyHighlight">        Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, Pred, BB&#125;);</span></CodeLine>
<Link id="l07840" /><CodeLine lineNumber="7840"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07841" /><CodeLine lineNumber="7841"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07842" /><CodeLine lineNumber="7842"></CodeLine>
<Link id="l07843" /><CodeLine lineNumber="7843"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The debug info in OtherPred doesn&#39;t cover the merged control flow that</span></CodeLine>
<Link id="l07844" /><CodeLine lineNumber="7844"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// used to go through BB.  We need to delete it or update it.</span></CodeLine>
<Link id="l07845" /><CodeLine lineNumber="7845"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(&#42;OtherPred))</span></CodeLine>
<Link id="l07846" /><CodeLine lineNumber="7846"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(Inst))</span></CodeLine>
<Link id="l07847" /><CodeLine lineNumber="7847"><span class="doxyHighlight">        Inst.eraseFromParent();</span></CodeLine>
<Link id="l07848" /><CodeLine lineNumber="7848"></CodeLine>
<Link id="l07849" /><CodeLine lineNumber="7849"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;BasicBlock &#42;, 16&gt;</a> UniqueSuccs(<a href="/docs/api/namespaces/llvm/#a9aa408bc83db2292cc1a57a3e6b206c2">succ&#95;begin</a>(BB), <a href="/docs/api/namespaces/llvm/#aa5684e4976198c1b64b694d3972ddf78">succ&#95;end</a>(BB));</span></CodeLine>
<Link id="l07850" /><CodeLine lineNumber="7850"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : UniqueSuccs) &#123;</span></CodeLine>
<Link id="l07851" /><CodeLine lineNumber="7851"><span class="doxyHighlight">      Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BB);</span></CodeLine>
<Link id="l07852" /><CodeLine lineNumber="7852"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l07853" /><CodeLine lineNumber="7853"><span class="doxyHighlight">        Updates.push&#95;back(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, Succ&#125;);</span></CodeLine>
<Link id="l07854" /><CodeLine lineNumber="7854"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07855" /><CodeLine lineNumber="7855"></CodeLine>
<Link id="l07856" /><CodeLine lineNumber="7856"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(BI);</span></CodeLine>
<Link id="l07857" /><CodeLine lineNumber="7857"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a39acc29443d48968a798fb22a76fa4c0">CreateUnreachable</a>();</span></CodeLine>
<Link id="l07858" /><CodeLine lineNumber="7858"><span class="doxyHighlight">    BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l07859" /><CodeLine lineNumber="7859"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l07860" /><CodeLine lineNumber="7860"><span class="doxyHighlight">      DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l07861" /><CodeLine lineNumber="7861"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07862" /><CodeLine lineNumber="7862"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07863" /><CodeLine lineNumber="7863"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07864" /><CodeLine lineNumber="7864"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07865" /><CodeLine lineNumber="7865"></CodeLine>
<Link id="l07866" /><CodeLine lineNumber="7866"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyBranch(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;Branch, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l07867" /><CodeLine lineNumber="7867"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>-&gt;isUnconditional() ? simplifyUncondBranch(Branch, Builder)</span></CodeLine>
<Link id="l07868" /><CodeLine lineNumber="7868"><span class="doxyHighlight">                                   : simplifyCondBranch(<a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a>, Builder);</span></CodeLine>
<Link id="l07869" /><CodeLine lineNumber="7869"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07870" /><CodeLine lineNumber="7870"></CodeLine>
<Link id="l07871" /><CodeLine lineNumber="7871"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyUncondBranch(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI,</span></CodeLine>
<Link id="l07872" /><CodeLine lineNumber="7872"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l07873" /><CodeLine lineNumber="7873"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l07874" /><CodeLine lineNumber="7874"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l07875" /><CodeLine lineNumber="7875"></CodeLine>
<Link id="l07876" /><CodeLine lineNumber="7876"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the Terminator is the only non-phi instruction, simplify the block.</span></CodeLine>
<Link id="l07877" /><CodeLine lineNumber="7877"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If LoopHeader is provided, check if the block or its successor is a loop</span></CodeLine>
<Link id="l07878" /><CodeLine lineNumber="7878"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// header. (This is for early invocations before loop simplify and</span></CodeLine>
<Link id="l07879" /><CodeLine lineNumber="7879"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorization to keep canonical loop forms for nested loops. These blocks</span></CodeLine>
<Link id="l07880" /><CodeLine lineNumber="7880"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can be eliminated when the pass is invoked later in the back-end.)</span></CodeLine>
<Link id="l07881" /><CodeLine lineNumber="7881"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that if BB has only one predecessor then we do not introduce new</span></CodeLine>
<Link id="l07882" /><CodeLine lineNumber="7882"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// backedge, so we can eliminate BB.</span></CodeLine>
<Link id="l07883" /><CodeLine lineNumber="7883"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedCanonicalLoop =</span></CodeLine>
<Link id="l07884" /><CodeLine lineNumber="7884"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.NeedCanonicalLoop &amp;&amp;</span></CodeLine>
<Link id="l07885" /><CodeLine lineNumber="7885"><span class="doxyHighlight">      (!LoopHeaders.empty() &amp;&amp; BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ae020673b5ca2bae358005b8980413c4c">hasNPredecessorsOrMore</a>(2) &amp;&amp;</span></CodeLine>
<Link id="l07886" /><CodeLine lineNumber="7886"><span class="doxyHighlight">       (<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(LoopHeaders, BB) || <a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(LoopHeaders, Succ)));</span></CodeLine>
<Link id="l07887" /><CodeLine lineNumber="7887"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a50909227135ef69932bff39b8ea3f572">getFirstNonPHIOrDbg</a>();</span></CodeLine>
<Link id="l07888" /><CodeLine lineNumber="7888"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator() &amp;&amp; BB != &amp;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>() &amp;&amp;</span></CodeLine>
<Link id="l07889" /><CodeLine lineNumber="7889"><span class="doxyHighlight">      !NeedCanonicalLoop &amp;&amp; <a href="/docs/api/namespaces/llvm/#a67474fe1bb82a093f3ad2e9ad2d7f7c4">TryToSimplifyUncondBranchFromEmptyBlock</a>(BB, DTU))</span></CodeLine>
<Link id="l07890" /><CodeLine lineNumber="7890"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07891" /><CodeLine lineNumber="7891"></CodeLine>
<Link id="l07892" /><CodeLine lineNumber="7892"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the only instruction in the block is a seteq/setne comparison against a</span></CodeLine>
<Link id="l07893" /><CodeLine lineNumber="7893"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// constant, try to simplify the block.</span></CodeLine>
<Link id="l07894" /><CodeLine lineNumber="7894"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l07895" /><CodeLine lineNumber="7895"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICI-&gt;<a href="/docs/api/classes/llvm/icmpinst/#abe8988eef2e6fc2baba032cb22afedd7">isEquality</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))) &#123;</span></CodeLine>
<Link id="l07896" /><CodeLine lineNumber="7896"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l07897" /><CodeLine lineNumber="7897"><span class="doxyHighlight">        ;</span></CodeLine>
<Link id="l07898" /><CodeLine lineNumber="7898"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator() &amp;&amp;</span></CodeLine>
<Link id="l07899" /><CodeLine lineNumber="7899"><span class="doxyHighlight">          tryToSimplifyUncondBranchWithICmpInIt(ICI, Builder))</span></CodeLine>
<Link id="l07900" /><CodeLine lineNumber="7900"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07901" /><CodeLine lineNumber="7901"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07902" /><CodeLine lineNumber="7902"></CodeLine>
<Link id="l07903" /><CodeLine lineNumber="7903"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if we can merge an empty landing pad block with another which is</span></CodeLine>
<Link id="l07904" /><CodeLine lineNumber="7904"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// equivalent.</span></CodeLine>
<Link id="l07905" /><CodeLine lineNumber="7905"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &#42;LPad = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LandingPadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l07906" /><CodeLine lineNumber="7906"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l07907" /><CodeLine lineNumber="7907"><span class="doxyHighlight">      ;</span></CodeLine>
<Link id="l07908" /><CodeLine lineNumber="7908"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator() &amp;&amp; <a href="#a428f7b53e32934ae46a9aa35d3028d87">tryToMergeLandingPad</a>(LPad, BI, BB, DTU))</span></CodeLine>
<Link id="l07909" /><CodeLine lineNumber="7909"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07910" /><CodeLine lineNumber="7910"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07911" /><CodeLine lineNumber="7911"></CodeLine>
<Link id="l07912" /><CodeLine lineNumber="7912"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this basic block is ONLY a compare and a branch, and if a predecessor</span></CodeLine>
<Link id="l07913" /><CodeLine lineNumber="7913"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branches to us and our successor, fold the comparison into the</span></CodeLine>
<Link id="l07914" /><CodeLine lineNumber="7914"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor and use logical operations to update the incoming value</span></CodeLine>
<Link id="l07915" /><CodeLine lineNumber="7915"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for PHI nodes in common successor.</span></CodeLine>
<Link id="l07916" /><CodeLine lineNumber="7916"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.SpeculateBlocks &amp;&amp;</span></CodeLine>
<Link id="l07917" /><CodeLine lineNumber="7917"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ad600d9077d7e1eadff1334ee14f7f25a">foldBranchToCommonDest</a>(BI, DTU, </span><span class="doxyHighlightComment">/&#42;MSSAU=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l07918" /><CodeLine lineNumber="7918"><span class="doxyHighlight">                             <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.BonusInstThreshold))</span></CodeLine>
<Link id="l07919" /><CodeLine lineNumber="7919"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l07920" /><CodeLine lineNumber="7920"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07921" /><CodeLine lineNumber="7921"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07922" /><CodeLine lineNumber="7922"></CodeLine>
<Link id="l07923" /><CodeLine lineNumber="7923" lineLink="#a265306d8985def49c26247e9006878de"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="#a265306d8985def49c26247e9006878de">allPredecessorsComeFromSameSource</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l07924" /><CodeLine lineNumber="7924"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PredPred = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07925" /><CodeLine lineNumber="7925"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l07926" /><CodeLine lineNumber="7926"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PPred = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;getSinglePredecessor();</span></CodeLine>
<Link id="l07927" /><CodeLine lineNumber="7927"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PPred || (PredPred &amp;&amp; PredPred != PPred))</span></CodeLine>
<Link id="l07928" /><CodeLine lineNumber="7928"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07929" /><CodeLine lineNumber="7929"><span class="doxyHighlight">    PredPred = PPred;</span></CodeLine>
<Link id="l07930" /><CodeLine lineNumber="7930"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07931" /><CodeLine lineNumber="7931"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PredPred;</span></CodeLine>
<Link id="l07932" /><CodeLine lineNumber="7932"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07933" /><CodeLine lineNumber="7933"></CodeLine>
<Link id="l07934" /><CodeLine lineNumber="7934"><span class="doxyHighlightComment">/// Fold the following pattern:</span></CodeLine>
<Link id="l07935" /><CodeLine lineNumber="7935"><span class="doxyHighlightComment">/// bb0:</span></CodeLine>
<Link id="l07936" /><CodeLine lineNumber="7936"><span class="doxyHighlightComment">///   br i1 %cond1, label %bb1, label %bb2</span></CodeLine>
<Link id="l07937" /><CodeLine lineNumber="7937"><span class="doxyHighlightComment">/// bb1:</span></CodeLine>
<Link id="l07938" /><CodeLine lineNumber="7938"><span class="doxyHighlightComment">///   br i1 %cond2, label %bb3, label %bb4</span></CodeLine>
<Link id="l07939" /><CodeLine lineNumber="7939"><span class="doxyHighlightComment">/// bb2:</span></CodeLine>
<Link id="l07940" /><CodeLine lineNumber="7940"><span class="doxyHighlightComment">///   br i1 %cond2, label %bb4, label %bb3</span></CodeLine>
<Link id="l07941" /><CodeLine lineNumber="7941"><span class="doxyHighlightComment">/// bb3:</span></CodeLine>
<Link id="l07942" /><CodeLine lineNumber="7942"><span class="doxyHighlightComment">///   ...</span></CodeLine>
<Link id="l07943" /><CodeLine lineNumber="7943"><span class="doxyHighlightComment">/// bb4:</span></CodeLine>
<Link id="l07944" /><CodeLine lineNumber="7944"><span class="doxyHighlightComment">///   ...</span></CodeLine>
<Link id="l07945" /><CodeLine lineNumber="7945"><span class="doxyHighlightComment">/// into</span></CodeLine>
<Link id="l07946" /><CodeLine lineNumber="7946"><span class="doxyHighlightComment">/// bb0:</span></CodeLine>
<Link id="l07947" /><CodeLine lineNumber="7947"><span class="doxyHighlightComment">///   %cond = xor i1 %cond1, %cond2</span></CodeLine>
<Link id="l07948" /><CodeLine lineNumber="7948"><span class="doxyHighlightComment">///   br i1 %cond, label %bb4, label %bb3</span></CodeLine>
<Link id="l07949" /><CodeLine lineNumber="7949"><span class="doxyHighlightComment">/// bb3:</span></CodeLine>
<Link id="l07950" /><CodeLine lineNumber="7950"><span class="doxyHighlightComment">///   ...</span></CodeLine>
<Link id="l07951" /><CodeLine lineNumber="7951"><span class="doxyHighlightComment">/// bb4:</span></CodeLine>
<Link id="l07952" /><CodeLine lineNumber="7952"><span class="doxyHighlightComment">///   ...</span></CodeLine>
<Link id="l07953" /><CodeLine lineNumber="7953"><span class="doxyHighlightComment">/// NOTE: %cond2 always dominates the terminator of bb0.</span></CodeLine>
<Link id="l07954" /><CodeLine lineNumber="7954" lineLink="#ad9d19d00519eec89a553d376d72c9520"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ad9d19d00519eec89a553d376d72c9520">mergeNestedCondBranch</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU) &#123;</span></CodeLine>
<Link id="l07955" /><CodeLine lineNumber="7955"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l07956" /><CodeLine lineNumber="7956"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB1 = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l07957" /><CodeLine lineNumber="7957"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB2 = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l07958" /><CodeLine lineNumber="7958"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsSimpleSuccessor = &#91;BB&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ, <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;&amp;SuccBI) &#123;</span></CodeLine>
<Link id="l07959" /><CodeLine lineNumber="7959"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ == BB)</span></CodeLine>
<Link id="l07960" /><CodeLine lineNumber="7960"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07961" /><CodeLine lineNumber="7961"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>() != Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())</span></CodeLine>
<Link id="l07962" /><CodeLine lineNumber="7962"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07963" /><CodeLine lineNumber="7963"><span class="doxyHighlight">    SuccBI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l07964" /><CodeLine lineNumber="7964"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SuccBI || !SuccBI-&gt;isConditional())</span></CodeLine>
<Link id="l07965" /><CodeLine lineNumber="7965"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07966" /><CodeLine lineNumber="7966"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ1 = SuccBI-&gt;getSuccessor(0);</span></CodeLine>
<Link id="l07967" /><CodeLine lineNumber="7967"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ2 = SuccBI-&gt;getSuccessor(1);</span></CodeLine>
<Link id="l07968" /><CodeLine lineNumber="7968"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Succ1 != Succ &amp;&amp; Succ2 != Succ &amp;&amp; Succ1 != BB &amp;&amp; Succ2 != BB &amp;&amp;</span></CodeLine>
<Link id="l07969" /><CodeLine lineNumber="7969"><span class="doxyHighlight">           !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(Succ1-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>()) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(Succ2-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>());</span></CodeLine>
<Link id="l07970" /><CodeLine lineNumber="7970"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l07971" /><CodeLine lineNumber="7971"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BB1BI, &#42;BB2BI;</span></CodeLine>
<Link id="l07972" /><CodeLine lineNumber="7972"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsSimpleSuccessor(BB1, BB1BI) || !IsSimpleSuccessor(BB2, BB2BI))</span></CodeLine>
<Link id="l07973" /><CodeLine lineNumber="7973"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07974" /><CodeLine lineNumber="7974"></CodeLine>
<Link id="l07975" /><CodeLine lineNumber="7975"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB1BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>() != BB2BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>() ||</span></CodeLine>
<Link id="l07976" /><CodeLine lineNumber="7976"><span class="doxyHighlight">      BB1BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != BB2BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) ||</span></CodeLine>
<Link id="l07977" /><CodeLine lineNumber="7977"><span class="doxyHighlight">      BB1BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) != BB2BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0))</span></CodeLine>
<Link id="l07978" /><CodeLine lineNumber="7978"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07979" /><CodeLine lineNumber="7979"></CodeLine>
<Link id="l07980" /><CodeLine lineNumber="7980"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB3 = BB1BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l07981" /><CodeLine lineNumber="7981"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB4 = BB1BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l07982" /><CodeLine lineNumber="7982"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(BI);</span></CodeLine>
<Link id="l07983" /><CodeLine lineNumber="7983"><span class="doxyHighlight">  BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a3505dab06f59c36142a234321cdc3411">setCondition</a>(</span></CodeLine>
<Link id="l07984" /><CodeLine lineNumber="7984"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#add2225af2af25968f26ed4cb0db94dbe">CreateXor</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>(), BB1BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>()));</span></CodeLine>
<Link id="l07985" /><CodeLine lineNumber="7985"><span class="doxyHighlight">  BB1-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BB);</span></CodeLine>
<Link id="l07986" /><CodeLine lineNumber="7986"><span class="doxyHighlight">  BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(0, BB4);</span></CodeLine>
<Link id="l07987" /><CodeLine lineNumber="7987"><span class="doxyHighlight">  BB2-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(BB);</span></CodeLine>
<Link id="l07988" /><CodeLine lineNumber="7988"><span class="doxyHighlight">  BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(1, BB3);</span></CodeLine>
<Link id="l07989" /><CodeLine lineNumber="7989"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU) &#123;</span></CodeLine>
<Link id="l07990" /><CodeLine lineNumber="7990"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DominatorTree::UpdateType, 4&gt;</a> Updates;</span></CodeLine>
<Link id="l07991" /><CodeLine lineNumber="7991"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, BB1&#125;);</span></CodeLine>
<Link id="l07992" /><CodeLine lineNumber="7992"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, BB, BB4&#125;);</span></CodeLine>
<Link id="l07993" /><CodeLine lineNumber="7993"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, BB, BB2&#125;);</span></CodeLine>
<Link id="l07994" /><CodeLine lineNumber="7994"><span class="doxyHighlight">    Updates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, BB, BB3&#125;);</span></CodeLine>
<Link id="l07995" /><CodeLine lineNumber="7995"></CodeLine>
<Link id="l07996" /><CodeLine lineNumber="7996"><span class="doxyHighlight">    DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(Updates);</span></CodeLine>
<Link id="l07997" /><CodeLine lineNumber="7997"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07998" /><CodeLine lineNumber="7998"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasWeight = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07999" /><CodeLine lineNumber="7999"><span class="doxyHighlight">  uint64&#95;t BBTWeight, BBFWeight;</span></CodeLine>
<Link id="l08000" /><CodeLine lineNumber="8000"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;BI, BBTWeight, BBFWeight))</span></CodeLine>
<Link id="l08001" /><CodeLine lineNumber="8001"><span class="doxyHighlight">    HasWeight = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08002" /><CodeLine lineNumber="8002"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08003" /><CodeLine lineNumber="8003"><span class="doxyHighlight">    BBTWeight = BBFWeight = 1;</span></CodeLine>
<Link id="l08004" /><CodeLine lineNumber="8004"><span class="doxyHighlight">  uint64&#95;t BB1TWeight, BB1FWeight;</span></CodeLine>
<Link id="l08005" /><CodeLine lineNumber="8005"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;BB1BI, BB1TWeight, BB1FWeight))</span></CodeLine>
<Link id="l08006" /><CodeLine lineNumber="8006"><span class="doxyHighlight">    HasWeight = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08007" /><CodeLine lineNumber="8007"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08008" /><CodeLine lineNumber="8008"><span class="doxyHighlight">    BB1TWeight = BB1FWeight = 1;</span></CodeLine>
<Link id="l08009" /><CodeLine lineNumber="8009"><span class="doxyHighlight">  uint64&#95;t BB2TWeight, BB2FWeight;</span></CodeLine>
<Link id="l08010" /><CodeLine lineNumber="8010"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac19cbbc4935a23e1d44f65e1eaba6b1d">extractBranchWeights</a>(&#42;BB2BI, BB2TWeight, BB2FWeight))</span></CodeLine>
<Link id="l08011" /><CodeLine lineNumber="8011"><span class="doxyHighlight">    HasWeight = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08012" /><CodeLine lineNumber="8012"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08013" /><CodeLine lineNumber="8013"><span class="doxyHighlight">    BB2TWeight = BB2FWeight = 1;</span></CodeLine>
<Link id="l08014" /><CodeLine lineNumber="8014"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasWeight) &#123;</span></CodeLine>
<Link id="l08015" /><CodeLine lineNumber="8015"><span class="doxyHighlight">    uint64&#95;t Weights&#91;2&#93; = &#123;BBTWeight &#42; BB1FWeight + BBFWeight &#42; BB2TWeight,</span></CodeLine>
<Link id="l08016" /><CodeLine lineNumber="8016"><span class="doxyHighlight">                           BBTWeight &#42; BB1TWeight + BBFWeight &#42; BB2FWeight&#125;;</span></CodeLine>
<Link id="l08017" /><CodeLine lineNumber="8017"><span class="doxyHighlight">    <a href="#a7b05fae85db516bdd2df79cef5a6343d">fitWeights</a>(Weights);</span></CodeLine>
<Link id="l08018" /><CodeLine lineNumber="8018"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(BI, Weights&#91;0&#93;, Weights&#91;1&#93;, </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08019" /><CodeLine lineNumber="8019"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08020" /><CodeLine lineNumber="8020"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08021" /><CodeLine lineNumber="8021"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08022" /><CodeLine lineNumber="8022"></CodeLine>
<Link id="l08023" /><CodeLine lineNumber="8023"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SimplifyCFGOpt::simplifyCondBranch(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l08024" /><CodeLine lineNumber="8024"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l08025" /><CodeLine lineNumber="8025"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>()) &amp;&amp;</span></CodeLine>
<Link id="l08026" /><CodeLine lineNumber="8026"><span class="doxyHighlight">      BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1) &amp;&amp;</span></CodeLine>
<Link id="l08027" /><CodeLine lineNumber="8027"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;Tautological conditional branch should have been eliminated already.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08028" /><CodeLine lineNumber="8028"></CodeLine>
<Link id="l08029" /><CodeLine lineNumber="8029"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l08030" /><CodeLine lineNumber="8030"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.SimplifyCondBranch ||</span></CodeLine>
<Link id="l08031" /><CodeLine lineNumber="8031"><span class="doxyHighlight">      BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(Attribute::OptForFuzzing))</span></CodeLine>
<Link id="l08032" /><CodeLine lineNumber="8032"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08033" /><CodeLine lineNumber="8033"></CodeLine>
<Link id="l08034" /><CodeLine lineNumber="8034"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Conditional branch</span></CodeLine>
<Link id="l08035" /><CodeLine lineNumber="8035"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isValueEqualityComparison(BI)) &#123;</span></CodeLine>
<Link id="l08036" /><CodeLine lineNumber="8036"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we only have one predecessor, and if it is a branch on this value,</span></CodeLine>
<Link id="l08037" /><CodeLine lineNumber="8037"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// see if that predecessor totally determines the outcome of this</span></CodeLine>
<Link id="l08038" /><CodeLine lineNumber="8038"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// switch.</span></CodeLine>
<Link id="l08039" /><CodeLine lineNumber="8039"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OnlyPred = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>())</span></CodeLine>
<Link id="l08040" /><CodeLine lineNumber="8040"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (simplifyEqualityComparisonWithOnlyPredecessor(BI, OnlyPred, Builder))</span></CodeLine>
<Link id="l08041" /><CodeLine lineNumber="8041"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08042" /><CodeLine lineNumber="8042"></CodeLine>
<Link id="l08043" /><CodeLine lineNumber="8043"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This block must be empty, except for the setcond inst, if it exists.</span></CodeLine>
<Link id="l08044" /><CodeLine lineNumber="8044"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ignore dbg and pseudo intrinsics.</span></CodeLine>
<Link id="l08045" /><CodeLine lineNumber="8045"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a2069641f358ef416658a2f321ca19d74">instructionsWithoutDebug</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">).begin();</span></CodeLine>
<Link id="l08046" /><CodeLine lineNumber="8046"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == BI) &#123;</span></CodeLine>
<Link id="l08047" /><CodeLine lineNumber="8047"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (foldValueComparisonIntoPredecessors(BI, Builder))</span></CodeLine>
<Link id="l08048" /><CodeLine lineNumber="8048"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08049" /><CodeLine lineNumber="8049"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>())) &#123;</span></CodeLine>
<Link id="l08050" /><CodeLine lineNumber="8050"><span class="doxyHighlight">      ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l08051" /><CodeLine lineNumber="8051"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == BI &amp;&amp; foldValueComparisonIntoPredecessors(BI, Builder))</span></CodeLine>
<Link id="l08052" /><CodeLine lineNumber="8052"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08053" /><CodeLine lineNumber="8053"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08054" /><CodeLine lineNumber="8054"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08055" /><CodeLine lineNumber="8055"></CodeLine>
<Link id="l08056" /><CodeLine lineNumber="8056"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to turn &quot;br (X == 0 | X == 1), T, F&quot; into a switch instruction.</span></CodeLine>
<Link id="l08057" /><CodeLine lineNumber="8057"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (simplifyBranchOnICmpChain(BI, Builder, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l08058" /><CodeLine lineNumber="8058"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08059" /><CodeLine lineNumber="8059"></CodeLine>
<Link id="l08060" /><CodeLine lineNumber="8060"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this basic block has dominating predecessor blocks and the dominating</span></CodeLine>
<Link id="l08061" /><CodeLine lineNumber="8061"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// blocks&#39; conditions imply BI&#39;s condition, we know the direction of BI.</span></CodeLine>
<Link id="l08062" /><CodeLine lineNumber="8062"><span class="doxyHighlight">  std::optional&lt;bool&gt; Imp = <a href="/docs/api/namespaces/llvm/#adbc4e5b23d7154e30b03717a470e8178">isImpliedByDomCondition</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>(), BI, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l08063" /><CodeLine lineNumber="8063"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Imp) &#123;</span></CodeLine>
<Link id="l08064" /><CodeLine lineNumber="8064"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Turn this into a branch on constant.</span></CodeLine>
<Link id="l08065" /><CodeLine lineNumber="8065"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldCond = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l08066" /><CodeLine lineNumber="8066"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;TorF = &#42;Imp ? <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>())</span></CodeLine>
<Link id="l08067" /><CodeLine lineNumber="8067"><span class="doxyHighlight">                             : <a href="/docs/api/classes/llvm/constantint">ConstantInt</a>::<a href="/docs/api/files/lib/lib/analysis/instructionsimplify-cpp/#a774f686ad651b962a54ad231e2212f64">getFalse</a>(BB-&gt;<a href="/docs/api/namespaces/llvm/sandboxir/#a16ef7ef1c4bb934e4d6f5dbd6e5fef6f">getContext</a>());</span></CodeLine>
<Link id="l08068" /><CodeLine lineNumber="8068"><span class="doxyHighlight">    BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a3505dab06f59c36142a234321cdc3411">setCondition</a>(TorF);</span></CodeLine>
<Link id="l08069" /><CodeLine lineNumber="8069"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(OldCond);</span></CodeLine>
<Link id="l08070" /><CodeLine lineNumber="8070"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08071" /><CodeLine lineNumber="8071"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08072" /><CodeLine lineNumber="8072"></CodeLine>
<Link id="l08073" /><CodeLine lineNumber="8073"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this basic block is ONLY a compare and a branch, and if a predecessor</span></CodeLine>
<Link id="l08074" /><CodeLine lineNumber="8074"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branches to us and one of our successors, fold the comparison into the</span></CodeLine>
<Link id="l08075" /><CodeLine lineNumber="8075"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor and use logical operations to pick the right destination.</span></CodeLine>
<Link id="l08076" /><CodeLine lineNumber="8076"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.SpeculateBlocks &amp;&amp;</span></CodeLine>
<Link id="l08077" /><CodeLine lineNumber="8077"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ad600d9077d7e1eadff1334ee14f7f25a">foldBranchToCommonDest</a>(BI, DTU, </span><span class="doxyHighlightComment">/&#42;MSSAU=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l08078" /><CodeLine lineNumber="8078"><span class="doxyHighlight">                             <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.BonusInstThreshold))</span></CodeLine>
<Link id="l08079" /><CodeLine lineNumber="8079"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08080" /><CodeLine lineNumber="8080"></CodeLine>
<Link id="l08081" /><CodeLine lineNumber="8081"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We have a conditional branch to two blocks that are only reachable</span></CodeLine>
<Link id="l08082" /><CodeLine lineNumber="8082"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from BI.  We know that the condbr dominates the two blocks, so see if</span></CodeLine>
<Link id="l08083" /><CodeLine lineNumber="8083"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// there is any identical code in the &quot;then&quot; and &quot;else&quot; blocks.  If so, we</span></CodeLine>
<Link id="l08084" /><CodeLine lineNumber="8084"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can hoist it up to the branching block.</span></CodeLine>
<Link id="l08085" /><CodeLine lineNumber="8085"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()) &#123;</span></CodeLine>
<Link id="l08086" /><CodeLine lineNumber="8086"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()) &#123;</span></CodeLine>
<Link id="l08087" /><CodeLine lineNumber="8087"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a8e8073e7ef8737b21cdf98608bbd17b9">HoistCommon</a> &amp;&amp;</span></CodeLine>
<Link id="l08088" /><CodeLine lineNumber="8088"><span class="doxyHighlight">          hoistCommonCodeFromSuccessors(BI, !<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.HoistCommonInsts))</span></CodeLine>
<Link id="l08089" /><CodeLine lineNumber="8089"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08090" /><CodeLine lineNumber="8090"></CodeLine>
<Link id="l08091" /><CodeLine lineNumber="8091"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI &amp;&amp; <a href="#a004c0d539d69756950a2dcd676799e0c">HoistLoadsStoresWithCondFaulting</a> &amp;&amp;</span></CodeLine>
<Link id="l08092" /><CodeLine lineNumber="8092"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.HoistLoadsStoresWithCondFaulting &amp;&amp;</span></CodeLine>
<Link id="l08093" /><CodeLine lineNumber="8093"><span class="doxyHighlight">          <a href="#a08cd264874d8deee9a2bdda9b9461e29">isProfitableToSpeculate</a>(BI, std::nullopt, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>)) &#123;</span></CodeLine>
<Link id="l08094" /><CodeLine lineNumber="8094"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 2&gt;</a> SpeculatedConditionalLoadsStores;</span></CodeLine>
<Link id="l08095" /><CodeLine lineNumber="8095"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CanSpeculateConditionalLoadsStores = &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l08096" /><CodeLine lineNumber="8096"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB)) &#123;</span></CodeLine>
<Link id="l08097" /><CodeLine lineNumber="8097"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;Succ) &#123;</span></CodeLine>
<Link id="l08098" /><CodeLine lineNumber="8098"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isTerminator()) &#123;</span></CodeLine>
<Link id="l08099" /><CodeLine lineNumber="8099"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getNumSuccessors() &gt; 1)</span></CodeLine>
<Link id="l08100" /><CodeLine lineNumber="8100"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08101" /><CodeLine lineNumber="8101"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08102" /><CodeLine lineNumber="8102"><span class="doxyHighlight">              &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#af7700655934807d2b707112f79217377">isSafeCheapLoadStore</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) ||</span></CodeLine>
<Link id="l08103" /><CodeLine lineNumber="8103"><span class="doxyHighlight">                         SpeculatedConditionalLoadsStores.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() ==</span></CodeLine>
<Link id="l08104" /><CodeLine lineNumber="8104"><span class="doxyHighlight">                             <a href="#afcc2d83294ce3af8abbfda0a3ea248ea">HoistLoadsStoresWithCondFaultingThreshold</a>) &#123;</span></CodeLine>
<Link id="l08105" /><CodeLine lineNumber="8105"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08106" /><CodeLine lineNumber="8106"><span class="doxyHighlight">              &#125;</span></CodeLine>
<Link id="l08107" /><CodeLine lineNumber="8107"><span class="doxyHighlight">              SpeculatedConditionalLoadsStores.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08108" /><CodeLine lineNumber="8108"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l08109" /><CodeLine lineNumber="8109"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l08110" /><CodeLine lineNumber="8110"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !SpeculatedConditionalLoadsStores.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>();</span></CodeLine>
<Link id="l08111" /><CodeLine lineNumber="8111"><span class="doxyHighlight">        &#125;;</span></CodeLine>
<Link id="l08112" /><CodeLine lineNumber="8112"></CodeLine>
<Link id="l08113" /><CodeLine lineNumber="8113"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CanSpeculateConditionalLoadsStores()) &#123;</span></CodeLine>
<Link id="l08114" /><CodeLine lineNumber="8114"><span class="doxyHighlight">          <a href="#ab99310a04afb6c28186b1a6428eb75b0">hoistConditionalLoadsStores</a>(BI, SpeculatedConditionalLoadsStores,</span></CodeLine>
<Link id="l08115" /><CodeLine lineNumber="8115"><span class="doxyHighlight">                                      std::nullopt);</span></CodeLine>
<Link id="l08116" /><CodeLine lineNumber="8116"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08117" /><CodeLine lineNumber="8117"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l08118" /><CodeLine lineNumber="8118"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08119" /><CodeLine lineNumber="8119"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08120" /><CodeLine lineNumber="8120"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If Successor #1 has multiple preds, we may be able to conditionally</span></CodeLine>
<Link id="l08121" /><CodeLine lineNumber="8121"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// execute Successor #0 if it branches to Successor #1.</span></CodeLine>
<Link id="l08122" /><CodeLine lineNumber="8122"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Succ0TI = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l08123" /><CodeLine lineNumber="8123"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ0TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>() == 1 &amp;&amp;</span></CodeLine>
<Link id="l08124" /><CodeLine lineNumber="8124"><span class="doxyHighlight">          Succ0TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(0) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1))</span></CodeLine>
<Link id="l08125" /><CodeLine lineNumber="8125"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (speculativelyExecuteBB(BI, BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)))</span></CodeLine>
<Link id="l08126" /><CodeLine lineNumber="8126"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08127" /><CodeLine lineNumber="8127"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08128" /><CodeLine lineNumber="8128"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()) &#123;</span></CodeLine>
<Link id="l08129" /><CodeLine lineNumber="8129"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If Successor #0 has multiple preds, we may be able to conditionally</span></CodeLine>
<Link id="l08130" /><CodeLine lineNumber="8130"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// execute Successor #1 if it branches to Successor #0.</span></CodeLine>
<Link id="l08131" /><CodeLine lineNumber="8131"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Succ1TI = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l08132" /><CodeLine lineNumber="8132"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ1TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>() == 1 &amp;&amp;</span></CodeLine>
<Link id="l08133" /><CodeLine lineNumber="8133"><span class="doxyHighlight">        Succ1TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(0) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0))</span></CodeLine>
<Link id="l08134" /><CodeLine lineNumber="8134"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (speculativelyExecuteBB(BI, BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)))</span></CodeLine>
<Link id="l08135" /><CodeLine lineNumber="8135"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08136" /><CodeLine lineNumber="8136"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08137" /><CodeLine lineNumber="8137"></CodeLine>
<Link id="l08138" /><CodeLine lineNumber="8138"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is a branch on something for which we know the constant value in</span></CodeLine>
<Link id="l08139" /><CodeLine lineNumber="8139"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessors (e.g. a phi node in the current block), thread control</span></CodeLine>
<Link id="l08140" /><CodeLine lineNumber="8140"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// through this block.</span></CodeLine>
<Link id="l08141" /><CodeLine lineNumber="8141"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a3f284045c53ed237131eb9153017c364">foldCondBranchOnValueKnownInPredecessor</a>(BI, DTU, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>.AC))</span></CodeLine>
<Link id="l08142" /><CodeLine lineNumber="8142"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08143" /><CodeLine lineNumber="8143"></CodeLine>
<Link id="l08144" /><CodeLine lineNumber="8144"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan predecessor blocks for conditional branches.</span></CodeLine>
<Link id="l08145" /><CodeLine lineNumber="8145"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB))</span></CodeLine>
<Link id="l08146" /><CodeLine lineNumber="8146"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PBI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(Pred-&gt;getTerminator()))</span></CodeLine>
<Link id="l08147" /><CodeLine lineNumber="8147"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI != BI &amp;&amp; PBI-&gt;isConditional())</span></CodeLine>
<Link id="l08148" /><CodeLine lineNumber="8148"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a40f7c70fc970f25f1c32e8b2c28662ec">SimplifyCondBranchToCondBranch</a>(PBI, BI, DTU, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l08149" /><CodeLine lineNumber="8149"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08150" /><CodeLine lineNumber="8150"></CodeLine>
<Link id="l08151" /><CodeLine lineNumber="8151"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for diamond patterns.</span></CodeLine>
<Link id="l08152" /><CodeLine lineNumber="8152"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ae848c33bb9817bf71288c58eb68f0e11">MergeCondStores</a>)</span></CodeLine>
<Link id="l08153" /><CodeLine lineNumber="8153"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PrevBB = <a href="#a265306d8985def49c26247e9006878de">allPredecessorsComeFromSameSource</a>(BB))</span></CodeLine>
<Link id="l08154" /><CodeLine lineNumber="8154"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PBI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PrevBB-&gt;getTerminator()))</span></CodeLine>
<Link id="l08155" /><CodeLine lineNumber="8155"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBI != BI &amp;&amp; PBI-&gt;isConditional())</span></CodeLine>
<Link id="l08156" /><CodeLine lineNumber="8156"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a6a58dfc629e1b208cdd7b2bd76203184">mergeConditionalStores</a>(PBI, BI, DTU, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l08157" /><CodeLine lineNumber="8157"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08158" /><CodeLine lineNumber="8158"></CodeLine>
<Link id="l08159" /><CodeLine lineNumber="8159"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for nested conditional branches.</span></CodeLine>
<Link id="l08160" /><CodeLine lineNumber="8160"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ad9d19d00519eec89a553d376d72c9520">mergeNestedCondBranch</a>(BI, DTU))</span></CodeLine>
<Link id="l08161" /><CodeLine lineNumber="8161"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08162" /><CodeLine lineNumber="8162"></CodeLine>
<Link id="l08163" /><CodeLine lineNumber="8163"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08164" /><CodeLine lineNumber="8164"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08165" /><CodeLine lineNumber="8165"></CodeLine>
<Link id="l08166" /><CodeLine lineNumber="8166"><span class="doxyHighlightComment">/// Check if passing a value to an instruction will cause undefined behavior.</span></CodeLine>
<Link id="l08167" /><CodeLine lineNumber="8167" lineLink="#a32c2973fa0babdd440d3ab7dd160664a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PtrValueMayBeModified) &#123;</span></CodeLine>
<Link id="l08168" /><CodeLine lineNumber="8168"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V);</span></CodeLine>
<Link id="l08169" /><CodeLine lineNumber="8169"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)</span></CodeLine>
<Link id="l08170" /><CodeLine lineNumber="8170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08171" /><CodeLine lineNumber="8171"></CodeLine>
<Link id="l08172" /><CodeLine lineNumber="8172"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;use&#95;empty())</span></CodeLine>
<Link id="l08173" /><CodeLine lineNumber="8173"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08174" /><CodeLine lineNumber="8174"></CodeLine>
<Link id="l08175" /><CodeLine lineNumber="8175"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isNullValue() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)) &#123;</span></CodeLine>
<Link id="l08176" /><CodeLine lineNumber="8176"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only look at the first use we can handle, avoid hurting compile time with</span></CodeLine>
<Link id="l08177" /><CodeLine lineNumber="8177"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// long uselists</span></CodeLine>
<Link id="l08178" /><CodeLine lineNumber="8178"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FindUse = <a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">llvm::find&#95;if</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users(), &#91;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U) &#123;</span></CodeLine>
<Link id="l08179" /><CodeLine lineNumber="8179"><span class="doxyHighlight">      auto &#42;Use = cast&lt;Instruction&gt;(U);</span></CodeLine>
<Link id="l08180" /><CodeLine lineNumber="8180"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Change this list when we want to add new instructions.</span></CodeLine>
<Link id="l08181" /><CodeLine lineNumber="8181"><span class="doxyHighlight">      switch (Use-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l08182" /><CodeLine lineNumber="8182"><span class="doxyHighlight">      default:</span></CodeLine>
<Link id="l08183" /><CodeLine lineNumber="8183"><span class="doxyHighlight">        return false;</span></CodeLine>
<Link id="l08184" /><CodeLine lineNumber="8184"><span class="doxyHighlight">      case Instruction::GetElementPtr:</span></CodeLine>
<Link id="l08185" /><CodeLine lineNumber="8185"><span class="doxyHighlight">      case Instruction::Ret:</span></CodeLine>
<Link id="l08186" /><CodeLine lineNumber="8186"><span class="doxyHighlight">      case Instruction::BitCast:</span></CodeLine>
<Link id="l08187" /><CodeLine lineNumber="8187"><span class="doxyHighlight">      case Instruction::Load:</span></CodeLine>
<Link id="l08188" /><CodeLine lineNumber="8188"><span class="doxyHighlight">      case Instruction::Store:</span></CodeLine>
<Link id="l08189" /><CodeLine lineNumber="8189"><span class="doxyHighlight">      case Instruction::Call:</span></CodeLine>
<Link id="l08190" /><CodeLine lineNumber="8190"><span class="doxyHighlight">      case Instruction::CallBr:</span></CodeLine>
<Link id="l08191" /><CodeLine lineNumber="8191"><span class="doxyHighlight">      case Instruction::Invoke:</span></CodeLine>
<Link id="l08192" /><CodeLine lineNumber="8192"><span class="doxyHighlight">      case Instruction::UDiv:</span></CodeLine>
<Link id="l08193" /><CodeLine lineNumber="8193"><span class="doxyHighlight">      case Instruction::URem:</span></CodeLine>
<Link id="l08194" /><CodeLine lineNumber="8194"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Note: signed div/rem of INT&#95;MIN / -1 is also immediate UB, not</span></CodeLine>
<Link id="l08195" /><CodeLine lineNumber="8195"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// implemented to avoid code complexity as it is unclear how useful such</span></CodeLine>
<Link id="l08196" /><CodeLine lineNumber="8196"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// logic is.</span></CodeLine>
<Link id="l08197" /><CodeLine lineNumber="8197"><span class="doxyHighlight">      case Instruction::SDiv:</span></CodeLine>
<Link id="l08198" /><CodeLine lineNumber="8198"><span class="doxyHighlight">      case Instruction::SRem:</span></CodeLine>
<Link id="l08199" /><CodeLine lineNumber="8199"><span class="doxyHighlight">        return true;</span></CodeLine>
<Link id="l08200" /><CodeLine lineNumber="8200"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08201" /><CodeLine lineNumber="8201"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l08202" /><CodeLine lineNumber="8202"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FindUse == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;user&#95;end())</span></CodeLine>
<Link id="l08203" /><CodeLine lineNumber="8203"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08204" /><CodeLine lineNumber="8204"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/use">Use</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(&#42;FindUse);</span></CodeLine>
<Link id="l08205" /><CodeLine lineNumber="8205"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Bail out if Use is not in the same BB as I or Use == I or Use comes</span></CodeLine>
<Link id="l08206" /><CodeLine lineNumber="8206"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// before I in the block. The latter two can be the case if Use is a</span></CodeLine>
<Link id="l08207" /><CodeLine lineNumber="8207"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// PHI node.</span></CodeLine>
<Link id="l08208" /><CodeLine lineNumber="8208"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a>-&gt;getParent() != <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() || <a href="/docs/api/classes/llvm/use">Use</a> == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || <a href="/docs/api/classes/llvm/use">Use</a>-&gt;comesBefore(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l08209" /><CodeLine lineNumber="8209"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08210" /><CodeLine lineNumber="8210"></CodeLine>
<Link id="l08211" /><CodeLine lineNumber="8211"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now make sure that there are no instructions in between that can alter</span></CodeLine>
<Link id="l08212" /><CodeLine lineNumber="8212"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// control flow (eg. calls)</span></CodeLine>
<Link id="l08213" /><CodeLine lineNumber="8213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InstrRange =</span></CodeLine>
<Link id="l08214" /><CodeLine lineNumber="8214"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(std::next(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIterator()), <a href="/docs/api/classes/llvm/use">Use</a>-&gt;getIterator());</span></CodeLine>
<Link id="l08215" /><CodeLine lineNumber="8215"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(InstrRange, &#91;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l08216" /><CodeLine lineNumber="8216"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/namespaces/llvm/#abff5a423c1f45e23958dde8ee695c9a9">isGuaranteedToTransferExecutionToSuccessor</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08217" /><CodeLine lineNumber="8217"><span class="doxyHighlight">        &#125;))</span></CodeLine>
<Link id="l08218" /><CodeLine lineNumber="8218"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08219" /><CodeLine lineNumber="8219"></CodeLine>
<Link id="l08220" /><CodeLine lineNumber="8220"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Look through GEPs. A load from a GEP derived from NULL is still undefined</span></CodeLine>
<Link id="l08221" /><CodeLine lineNumber="8221"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/classes/llvm/use">Use</a>))</span></CodeLine>
<Link id="l08222" /><CodeLine lineNumber="8222"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerOperand() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l08223" /><CodeLine lineNumber="8223"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The current base address is null, there are four cases to consider:</span></CodeLine>
<Link id="l08224" /><CodeLine lineNumber="8224"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// getelementptr (TY, null, 0)                 -&gt; null</span></CodeLine>
<Link id="l08225" /><CodeLine lineNumber="8225"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// getelementptr (TY, null, not zero)          -&gt; may be modified</span></CodeLine>
<Link id="l08226" /><CodeLine lineNumber="8226"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// getelementptr inbounds (TY, null, 0)        -&gt; null</span></CodeLine>
<Link id="l08227" /><CodeLine lineNumber="8227"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// getelementptr inbounds (TY, null, not zero) -&gt; poison iff null is</span></CodeLine>
<Link id="l08228" /><CodeLine lineNumber="8228"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// undefined?</span></CodeLine>
<Link id="l08229" /><CodeLine lineNumber="8229"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;hasAllZeroIndices() &amp;&amp;</span></CodeLine>
<Link id="l08230" /><CodeLine lineNumber="8230"><span class="doxyHighlight">            (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;isInBounds() ||</span></CodeLine>
<Link id="l08231" /><CodeLine lineNumber="8231"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/#a7b03ed78a8e299bde6d26a8793cd4e06">NullPointerIsDefined</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getFunction(),</span></CodeLine>
<Link id="l08232" /><CodeLine lineNumber="8232"><span class="doxyHighlight">                                  <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getPointerAddressSpace())))</span></CodeLine>
<Link id="l08233" /><CodeLine lineNumber="8233"><span class="doxyHighlight">          PtrValueMayBeModified = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08234" /><CodeLine lineNumber="8234"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(V, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, PtrValueMayBeModified);</span></CodeLine>
<Link id="l08235" /><CodeLine lineNumber="8235"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08236" /><CodeLine lineNumber="8236"></CodeLine>
<Link id="l08237" /><CodeLine lineNumber="8237"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Look through return.</span></CodeLine>
<Link id="l08238" /><CodeLine lineNumber="8238"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;Ret = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(<a href="/docs/api/classes/llvm/use">Use</a>)) &#123;</span></CodeLine>
<Link id="l08239" /><CodeLine lineNumber="8239"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasNoUndefAttr =</span></CodeLine>
<Link id="l08240" /><CodeLine lineNumber="8240"><span class="doxyHighlight">          Ret-&gt;getFunction()-&gt;hasRetAttribute(Attribute::NoUndef);</span></CodeLine>
<Link id="l08241" /><CodeLine lineNumber="8241"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Return undefined to a noundef return value is undefined.</span></CodeLine>
<Link id="l08242" /><CodeLine lineNumber="8242"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &amp;&amp; HasNoUndefAttr)</span></CodeLine>
<Link id="l08243" /><CodeLine lineNumber="8243"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08244" /><CodeLine lineNumber="8244"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Return null to a nonnull+noundef return value is undefined.</span></CodeLine>
<Link id="l08245" /><CodeLine lineNumber="8245"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isNullValue() &amp;&amp; HasNoUndefAttr &amp;&amp;</span></CodeLine>
<Link id="l08246" /><CodeLine lineNumber="8246"><span class="doxyHighlight">          Ret-&gt;getFunction()-&gt;hasRetAttribute(Attribute::NonNull)) &#123;</span></CodeLine>
<Link id="l08247" /><CodeLine lineNumber="8247"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !PtrValueMayBeModified;</span></CodeLine>
<Link id="l08248" /><CodeLine lineNumber="8248"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08249" /><CodeLine lineNumber="8249"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08250" /><CodeLine lineNumber="8250"></CodeLine>
<Link id="l08251" /><CodeLine lineNumber="8251"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Load from null is undefined.</span></CodeLine>
<Link id="l08252" /><CodeLine lineNumber="8252"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/classes/llvm/use">Use</a>))</span></CodeLine>
<Link id="l08253" /><CodeLine lineNumber="8253"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI-&gt;isVolatile())</span></CodeLine>
<Link id="l08254" /><CodeLine lineNumber="8254"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/namespaces/llvm/#a7b03ed78a8e299bde6d26a8793cd4e06">NullPointerIsDefined</a>(LI-&gt;getFunction(),</span></CodeLine>
<Link id="l08255" /><CodeLine lineNumber="8255"><span class="doxyHighlight">                                     LI-&gt;getPointerAddressSpace());</span></CodeLine>
<Link id="l08256" /><CodeLine lineNumber="8256"></CodeLine>
<Link id="l08257" /><CodeLine lineNumber="8257"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Store to null is undefined.</span></CodeLine>
<Link id="l08258" /><CodeLine lineNumber="8258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(<a href="/docs/api/classes/llvm/use">Use</a>))</span></CodeLine>
<Link id="l08259" /><CodeLine lineNumber="8259"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isVolatile())</span></CodeLine>
<Link id="l08260" /><CodeLine lineNumber="8260"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a7b03ed78a8e299bde6d26a8793cd4e06">NullPointerIsDefined</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getFunction(),</span></CodeLine>
<Link id="l08261" /><CodeLine lineNumber="8261"><span class="doxyHighlight">                                      <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerAddressSpace())) &amp;&amp;</span></CodeLine>
<Link id="l08262" /><CodeLine lineNumber="8262"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l08263" /><CodeLine lineNumber="8263"></CodeLine>
<Link id="l08264" /><CodeLine lineNumber="8264"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// llvm.assume(false/undef) always triggers immediate UB.</span></CodeLine>
<Link id="l08265" /><CodeLine lineNumber="8265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Assume = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AssumeInst&gt;</a>(<a href="/docs/api/classes/llvm/use">Use</a>)) &#123;</span></CodeLine>
<Link id="l08266" /><CodeLine lineNumber="8266"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Ignore assume operand bundles.</span></CodeLine>
<Link id="l08267" /><CodeLine lineNumber="8267"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == Assume-&gt;getArgOperand(0))</span></CodeLine>
<Link id="l08268" /><CodeLine lineNumber="8268"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08269" /><CodeLine lineNumber="8269"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08270" /><CodeLine lineNumber="8270"></CodeLine>
<Link id="l08271" /><CodeLine lineNumber="8271"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(<a href="/docs/api/classes/llvm/use">Use</a>)) &#123;</span></CodeLine>
<Link id="l08272" /><CodeLine lineNumber="8272"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isNullValue() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a7b03ed78a8e299bde6d26a8793cd4e06">NullPointerIsDefined</a>(CB-&gt;getFunction()))</span></CodeLine>
<Link id="l08273" /><CodeLine lineNumber="8273"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08274" /><CodeLine lineNumber="8274"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// A call to null is undefined.</span></CodeLine>
<Link id="l08275" /><CodeLine lineNumber="8275"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CB-&gt;getCalledOperand() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l08276" /><CodeLine lineNumber="8276"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08277" /><CodeLine lineNumber="8277"></CodeLine>
<Link id="l08278" /><CodeLine lineNumber="8278"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isNullValue()) &#123;</span></CodeLine>
<Link id="l08279" /><CodeLine lineNumber="8279"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/use">llvm::Use</a> &amp;Arg : CB-&gt;args())</span></CodeLine>
<Link id="l08280" /><CodeLine lineNumber="8280"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Arg == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l08281" /><CodeLine lineNumber="8281"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ArgIdx = CB-&gt;getArgOperandNo(&amp;Arg);</span></CodeLine>
<Link id="l08282" /><CodeLine lineNumber="8282"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CB-&gt;isPassingUndefUB(ArgIdx) &amp;&amp;</span></CodeLine>
<Link id="l08283" /><CodeLine lineNumber="8283"><span class="doxyHighlight">                CB-&gt;paramHasAttr(ArgIdx, Attribute::NonNull)) &#123;</span></CodeLine>
<Link id="l08284" /><CodeLine lineNumber="8284"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// Passing null to a nonnnull+noundef argument is undefined.</span></CodeLine>
<Link id="l08285" /><CodeLine lineNumber="8285"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !PtrValueMayBeModified;</span></CodeLine>
<Link id="l08286" /><CodeLine lineNumber="8286"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l08287" /><CodeLine lineNumber="8287"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l08288" /><CodeLine lineNumber="8288"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)) &#123;</span></CodeLine>
<Link id="l08289" /><CodeLine lineNumber="8289"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Passing undef to a noundef argument is undefined.</span></CodeLine>
<Link id="l08290" /><CodeLine lineNumber="8290"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/use">llvm::Use</a> &amp;Arg : CB-&gt;args())</span></CodeLine>
<Link id="l08291" /><CodeLine lineNumber="8291"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Arg == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l08292" /><CodeLine lineNumber="8292"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ArgIdx = CB-&gt;getArgOperandNo(&amp;Arg);</span></CodeLine>
<Link id="l08293" /><CodeLine lineNumber="8293"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CB-&gt;isPassingUndefUB(ArgIdx)) &#123;</span></CodeLine>
<Link id="l08294" /><CodeLine lineNumber="8294"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// Passing undef to a noundef argument is undefined.</span></CodeLine>
<Link id="l08295" /><CodeLine lineNumber="8295"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08296" /><CodeLine lineNumber="8296"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l08297" /><CodeLine lineNumber="8297"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l08298" /><CodeLine lineNumber="8298"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08299" /><CodeLine lineNumber="8299"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08300" /><CodeLine lineNumber="8300"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Div/Rem by zero is immediate UB</span></CodeLine>
<Link id="l08301" /><CodeLine lineNumber="8301"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/classes/llvm/use">Use</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a0698afabe907d2d3b87889d2e0349d47">m&#95;BinOp</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))) &amp;&amp; <a href="/docs/api/classes/llvm/use">Use</a>-&gt;isIntDivRem())</span></CodeLine>
<Link id="l08302" /><CodeLine lineNumber="8302"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08303" /><CodeLine lineNumber="8303"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08304" /><CodeLine lineNumber="8304"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08305" /><CodeLine lineNumber="8305"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08306" /><CodeLine lineNumber="8306"></CodeLine>
<Link id="l08307" /><CodeLine lineNumber="8307"><span class="doxyHighlightComment">/// If BB has an incoming value that will always trigger undefined behavior</span></CodeLine>
<Link id="l08308" /><CodeLine lineNumber="8308"><span class="doxyHighlightComment">/// (eg. null pointer dereference), remove the branch leading here.</span></CodeLine>
<Link id="l08309" /><CodeLine lineNumber="8309" lineLink="#af04adca83664ebd947723470c4da58aa"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#af04adca83664ebd947723470c4da58aa">removeUndefIntroducingPredecessor</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l08310" /><CodeLine lineNumber="8310"><span class="doxyHighlight">                                              <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU,</span></CodeLine>
<Link id="l08311" /><CodeLine lineNumber="8311"><span class="doxyHighlight">                                              <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC) &#123;</span></CodeLine>
<Link id="l08312" /><CodeLine lineNumber="8312"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> : BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>())</span></CodeLine>
<Link id="l08313" /><CodeLine lineNumber="8313"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getNumIncomingValues(); i != e; ++i)</span></CodeLine>
<Link id="l08314" /><CodeLine lineNumber="8314"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a32c2973fa0babdd440d3ab7dd160664a">passingValueIsAlwaysUndefined</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingValue(i), &amp;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)) &#123;</span></CodeLine>
<Link id="l08315" /><CodeLine lineNumber="8315"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Predecessor = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.getIncomingBlock(i);</span></CodeLine>
<Link id="l08316" /><CodeLine lineNumber="8316"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = Predecessor-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l08317" /><CodeLine lineNumber="8317"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</span></CodeLine>
<Link id="l08318" /><CodeLine lineNumber="8318"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>)) &#123;</span></CodeLine>
<Link id="l08319" /><CodeLine lineNumber="8319"><span class="doxyHighlight">          BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(Predecessor);</span></CodeLine>
<Link id="l08320" /><CodeLine lineNumber="8320"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Turn unconditional branches into unreachables and remove the dead</span></CodeLine>
<Link id="l08321" /><CodeLine lineNumber="8321"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// destination from conditional branches.</span></CodeLine>
<Link id="l08322" /><CodeLine lineNumber="8322"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#ad56f6a9b5cd05940017c4544df48bc30">isUnconditional</a>())</span></CodeLine>
<Link id="l08323" /><CodeLine lineNumber="8323"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a39acc29443d48968a798fb22a76fa4c0">CreateUnreachable</a>();</span></CodeLine>
<Link id="l08324" /><CodeLine lineNumber="8324"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08325" /><CodeLine lineNumber="8325"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Preserve guarding condition in assume, because it might not be</span></CodeLine>
<Link id="l08326" /><CodeLine lineNumber="8326"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// inferrable from any dominating condition.</span></CodeLine>
<Link id="l08327" /><CodeLine lineNumber="8327"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>();</span></CodeLine>
<Link id="l08328" /><CodeLine lineNumber="8328"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;Assumption;</span></CodeLine>
<Link id="l08329" /><CodeLine lineNumber="8329"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BB)</span></CodeLine>
<Link id="l08330" /><CodeLine lineNumber="8330"><span class="doxyHighlight">              Assumption = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3e128b0b1ee770ce64350445c12492c7">CreateAssumption</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a89f675aadae7232445c74ee4167ff591">CreateNot</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>));</span></CodeLine>
<Link id="l08331" /><CodeLine lineNumber="8331"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08332" /><CodeLine lineNumber="8332"><span class="doxyHighlight">              Assumption = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3e128b0b1ee770ce64350445c12492c7">CreateAssumption</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l08333" /><CodeLine lineNumber="8333"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AC)</span></CodeLine>
<Link id="l08334" /><CodeLine lineNumber="8334"><span class="doxyHighlight">              AC-&gt;<a href="/docs/api/classes/llvm/assumptioncache/#a23187618f079555e127ba0e7b4581530">registerAssumption</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;AssumeInst&gt;</a>(Assumption));</span></CodeLine>
<Link id="l08335" /><CodeLine lineNumber="8335"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BB ? BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1)</span></CodeLine>
<Link id="l08336" /><CodeLine lineNumber="8336"><span class="doxyHighlight">                                                       : BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0));</span></CodeLine>
<Link id="l08337" /><CodeLine lineNumber="8337"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l08338" /><CodeLine lineNumber="8338"><span class="doxyHighlight">          BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l08339" /><CodeLine lineNumber="8339"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l08340" /><CodeLine lineNumber="8340"><span class="doxyHighlight">            DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(&#123;&#123;<a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, Predecessor, BB&#125;&#125;);</span></CodeLine>
<Link id="l08341" /><CodeLine lineNumber="8341"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08342" /><CodeLine lineNumber="8342"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>)) &#123;</span></CodeLine>
<Link id="l08343" /><CodeLine lineNumber="8343"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Redirect all branches leading to UB into</span></CodeLine>
<Link id="l08344" /><CodeLine lineNumber="8344"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// a newly created unreachable block.</span></CodeLine>
<Link id="l08345" /><CodeLine lineNumber="8345"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Unreachable = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l08346" /><CodeLine lineNumber="8346"><span class="doxyHighlight">              Predecessor-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;unreachable&quot;</span><span class="doxyHighlight">, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), BB);</span></CodeLine>
<Link id="l08347" /><CodeLine lineNumber="8347"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Unreachable);</span></CodeLine>
<Link id="l08348" /><CodeLine lineNumber="8348"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// The new block contains only one instruction: Unreachable</span></CodeLine>
<Link id="l08349" /><CodeLine lineNumber="8349"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a39acc29443d48968a798fb22a76fa4c0">CreateUnreachable</a>();</span></CodeLine>
<Link id="l08350" /><CodeLine lineNumber="8350"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Case : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases())</span></CodeLine>
<Link id="l08351" /><CodeLine lineNumber="8351"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Case.getCaseSuccessor() == BB) &#123;</span></CodeLine>
<Link id="l08352" /><CodeLine lineNumber="8352"><span class="doxyHighlight">              BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(Predecessor);</span></CodeLine>
<Link id="l08353" /><CodeLine lineNumber="8353"><span class="doxyHighlight">              Case.setSuccessor(Unreachable);</span></CodeLine>
<Link id="l08354" /><CodeLine lineNumber="8354"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l08355" /><CodeLine lineNumber="8355"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest() == BB) &#123;</span></CodeLine>
<Link id="l08356" /><CodeLine lineNumber="8356"><span class="doxyHighlight">            BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(Predecessor);</span></CodeLine>
<Link id="l08357" /><CodeLine lineNumber="8357"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;setDefaultDest(Unreachable);</span></CodeLine>
<Link id="l08358" /><CodeLine lineNumber="8358"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l08359" /><CodeLine lineNumber="8359"></CodeLine>
<Link id="l08360" /><CodeLine lineNumber="8360"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DTU)</span></CodeLine>
<Link id="l08361" /><CodeLine lineNumber="8361"><span class="doxyHighlight">            DTU-&gt;<a href="/docs/api/classes/llvm/genericdomtreeupdater/#a363d442ff7f9a13eafaee275aad9f54c">applyUpdates</a>(</span></CodeLine>
<Link id="l08362" /><CodeLine lineNumber="8362"><span class="doxyHighlight">                &#123; &#123; <a href="/docs/api/classes/llvm/dominatortreebase/#a9aeeca2833810f01b20545a46fe22503">DominatorTree::Insert</a>, Predecessor, Unreachable &#125;,</span></CodeLine>
<Link id="l08363" /><CodeLine lineNumber="8363"><span class="doxyHighlight">                  &#123; <a href="/docs/api/classes/llvm/dominatortreebase/#a71c91cbbfc1c0ecf9a69e10ccf739bd7">DominatorTree::Delete</a>, Predecessor, BB &#125; &#125;);</span></CodeLine>
<Link id="l08364" /><CodeLine lineNumber="8364"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08365" /><CodeLine lineNumber="8365"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l08366" /><CodeLine lineNumber="8366"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08367" /><CodeLine lineNumber="8367"></CodeLine>
<Link id="l08368" /><CodeLine lineNumber="8368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08369" /><CodeLine lineNumber="8369"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08370" /><CodeLine lineNumber="8370"></CodeLine>
<Link id="l08371" /><CodeLine lineNumber="8371" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a0cadca6f494db1ccdccb2256e49cb7fe"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a0cadca6f494db1ccdccb2256e49cb7fe">SimplifyCFGOpt::simplifyOnce</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l08372" /><CodeLine lineNumber="8372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08373" /><CodeLine lineNumber="8373"></CodeLine>
<Link id="l08374" /><CodeLine lineNumber="8374"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BB &amp;&amp; BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Block not embedded in function!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08375" /><CodeLine lineNumber="8375"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Degenerate basic block encountered!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08376" /><CodeLine lineNumber="8376"></CodeLine>
<Link id="l08377" /><CodeLine lineNumber="8377"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove basic blocks that have no predecessors (except the entry block)...</span></CodeLine>
<Link id="l08378" /><CodeLine lineNumber="8378"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or that just have themself as a predecessor.  These are unreachable.</span></CodeLine>
<Link id="l08379" /><CodeLine lineNumber="8379"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/#ad66c4759666aab78529658362b498c74">pred&#95;empty</a>(BB) &amp;&amp; BB != &amp;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>()) ||</span></CodeLine>
<Link id="l08380" /><CodeLine lineNumber="8380"><span class="doxyHighlight">      BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>() == BB) &#123;</span></CodeLine>
<Link id="l08381" /><CodeLine lineNumber="8381"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Removing BB: \\n&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;BB);</span></CodeLine>
<Link id="l08382" /><CodeLine lineNumber="8382"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a458b4709ebedccb846a179f1e422265b">DeleteDeadBlock</a>(BB, DTU);</span></CodeLine>
<Link id="l08383" /><CodeLine lineNumber="8383"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08384" /><CodeLine lineNumber="8384"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08385" /><CodeLine lineNumber="8385"></CodeLine>
<Link id="l08386" /><CodeLine lineNumber="8386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check to see if we can constant propagate this terminator instruction</span></CodeLine>
<Link id="l08387" /><CodeLine lineNumber="8387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// away...</span></CodeLine>
<Link id="l08388" /><CodeLine lineNumber="8388"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/namespaces/llvm/#a152d8c380cc937c9dceb402ceec943b6">ConstantFoldTerminator</a>(BB, </span><span class="doxyHighlightComment">/&#42;DeleteDeadConditions=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l08389" /><CodeLine lineNumber="8389"><span class="doxyHighlight">                                    </span><span class="doxyHighlightComment">/&#42;TLI=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, DTU);</span></CodeLine>
<Link id="l08390" /><CodeLine lineNumber="8390"></CodeLine>
<Link id="l08391" /><CodeLine lineNumber="8391"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for and eliminate duplicate PHI nodes in this block.</span></CodeLine>
<Link id="l08392" /><CodeLine lineNumber="8392"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/namespaces/llvm/#aed498f056a09006219c59ee9fab0450f">EliminateDuplicatePHINodes</a>(BB);</span></CodeLine>
<Link id="l08393" /><CodeLine lineNumber="8393"></CodeLine>
<Link id="l08394" /><CodeLine lineNumber="8394"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check for and remove branches that will always cause undefined behavior.</span></CodeLine>
<Link id="l08395" /><CodeLine lineNumber="8395"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#af04adca83664ebd947723470c4da58aa">removeUndefIntroducingPredecessor</a>(BB, DTU, Options.AC))</span></CodeLine>
<Link id="l08396" /><CodeLine lineNumber="8396"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a7230df2d676505a7ac34922feab24c6a">requestResimplify</a>();</span></CodeLine>
<Link id="l08397" /><CodeLine lineNumber="8397"></CodeLine>
<Link id="l08398" /><CodeLine lineNumber="8398"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Merge basic blocks into their predecessor if there is only one distinct</span></CodeLine>
<Link id="l08399" /><CodeLine lineNumber="8399"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pred, and if there is only one distinct successor of the predecessor, and</span></CodeLine>
<Link id="l08400" /><CodeLine lineNumber="8400"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if there are no PHI nodes.</span></CodeLine>
<Link id="l08401" /><CodeLine lineNumber="8401"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(BB, DTU))</span></CodeLine>
<Link id="l08402" /><CodeLine lineNumber="8402"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08403" /><CodeLine lineNumber="8403"></CodeLine>
<Link id="l08404" /><CodeLine lineNumber="8404"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a0cca1e07e2a0f1f96f02d60bc5cb7a88">SinkCommon</a> &amp;&amp; Options.SinkCommonInsts)</span></CodeLine>
<Link id="l08405" /><CodeLine lineNumber="8405"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a7da8333874d1ad28bd987d4e7c474e53">sinkCommonCodeFromPredecessors</a>(BB, DTU) ||</span></CodeLine>
<Link id="l08406" /><CodeLine lineNumber="8406"><span class="doxyHighlight">        <a href="#aa7e215bdd027461da0d8205cf5ef0e32">mergeCompatibleInvokes</a>(BB, DTU)) &#123;</span></CodeLine>
<Link id="l08407" /><CodeLine lineNumber="8407"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// sinkCommonCodeFromPredecessors() does not automatically CSE PHI&#39;s,</span></CodeLine>
<Link id="l08408" /><CodeLine lineNumber="8408"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// so we may now how duplicate PHI&#39;s.</span></CodeLine>
<Link id="l08409" /><CodeLine lineNumber="8409"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Let&#39;s rerun EliminateDuplicatePHINodes() first,</span></CodeLine>
<Link id="l08410" /><CodeLine lineNumber="8410"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// before foldTwoEntryPHINode() potentially converts them into select&#39;s,</span></CodeLine>
<Link id="l08411" /><CodeLine lineNumber="8411"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// after which we&#39;d need a whole EarlyCSE pass run to cleanup them.</span></CodeLine>
<Link id="l08412" /><CodeLine lineNumber="8412"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08413" /><CodeLine lineNumber="8413"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08414" /><CodeLine lineNumber="8414"></CodeLine>
<Link id="l08415" /><CodeLine lineNumber="8415"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(BB);</span></CodeLine>
<Link id="l08416" /><CodeLine lineNumber="8416"></CodeLine>
<Link id="l08417" /><CodeLine lineNumber="8417"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Options.SpeculateBlocks &amp;&amp;</span></CodeLine>
<Link id="l08418" /><CodeLine lineNumber="8418"><span class="doxyHighlight">      !BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(Attribute::OptForFuzzing)) &#123;</span></CodeLine>
<Link id="l08419" /><CodeLine lineNumber="8419"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there is a trivial two-entry PHI node in this basic block, and we can</span></CodeLine>
<Link id="l08420" /><CodeLine lineNumber="8420"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// eliminate it, do so now.</span></CodeLine>
<Link id="l08421" /><CodeLine lineNumber="8421"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()))</span></CodeLine>
<Link id="l08422" /><CodeLine lineNumber="8422"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>() == 2)</span></CodeLine>
<Link id="l08423" /><CodeLine lineNumber="8423"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a92fe4b2aa97a12f4a947e5ce99f05b15">foldTwoEntryPHINode</a>(PN, TTI, DTU, Options.AC, DL,</span></CodeLine>
<Link id="l08424" /><CodeLine lineNumber="8424"><span class="doxyHighlight">                                Options.SpeculateUnpredictables))</span></CodeLine>
<Link id="l08425" /><CodeLine lineNumber="8425"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08426" /><CodeLine lineNumber="8426"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08427" /><CodeLine lineNumber="8427"></CodeLine>
<Link id="l08428" /><CodeLine lineNumber="8428"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Terminator = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l08429" /><CodeLine lineNumber="8429"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Terminator);</span></CodeLine>
<Link id="l08430" /><CodeLine lineNumber="8430"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Terminator-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l08431" /><CodeLine lineNumber="8431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Br:</span></CodeLine>
<Link id="l08432" /><CodeLine lineNumber="8432"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= simplifyBranch(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Terminator), Builder);</span></CodeLine>
<Link id="l08433" /><CodeLine lineNumber="8433"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08434" /><CodeLine lineNumber="8434"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Resume:</span></CodeLine>
<Link id="l08435" /><CodeLine lineNumber="8435"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= simplifyResume(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ResumeInst&gt;</a>(Terminator), Builder);</span></CodeLine>
<Link id="l08436" /><CodeLine lineNumber="8436"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08437" /><CodeLine lineNumber="8437"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::CleanupRet:</span></CodeLine>
<Link id="l08438" /><CodeLine lineNumber="8438"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= simplifyCleanupReturn(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CleanupReturnInst&gt;</a>(Terminator));</span></CodeLine>
<Link id="l08439" /><CodeLine lineNumber="8439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08440" /><CodeLine lineNumber="8440"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Switch:</span></CodeLine>
<Link id="l08441" /><CodeLine lineNumber="8441"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= simplifySwitch(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SwitchInst&gt;</a>(Terminator), Builder);</span></CodeLine>
<Link id="l08442" /><CodeLine lineNumber="8442"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08443" /><CodeLine lineNumber="8443"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Unreachable:</span></CodeLine>
<Link id="l08444" /><CodeLine lineNumber="8444"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= simplifyUnreachable(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;UnreachableInst&gt;</a>(Terminator));</span></CodeLine>
<Link id="l08445" /><CodeLine lineNumber="8445"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08446" /><CodeLine lineNumber="8446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::IndirectBr:</span></CodeLine>
<Link id="l08447" /><CodeLine lineNumber="8447"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= simplifyIndirectBr(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IndirectBrInst&gt;</a>(Terminator));</span></CodeLine>
<Link id="l08448" /><CodeLine lineNumber="8448"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08449" /><CodeLine lineNumber="8449"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08450" /><CodeLine lineNumber="8450"></CodeLine>
<Link id="l08451" /><CodeLine lineNumber="8451"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l08452" /><CodeLine lineNumber="8452"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08453" /><CodeLine lineNumber="8453"></CodeLine>
<Link id="l08454" /><CodeLine lineNumber="8454" lineLink="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a9a5886e80041fbdee3dd0c44b6d6bbf2"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a9a5886e80041fbdee3dd0c44b6d6bbf2">SimplifyCFGOpt::run</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l08455" /><CodeLine lineNumber="8455"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08456" /><CodeLine lineNumber="8456"></CodeLine>
<Link id="l08457" /><CodeLine lineNumber="8457"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Repeated simplify BB as long as resimplification is requested.</span></CodeLine>
<Link id="l08458" /><CodeLine lineNumber="8458"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08459" /><CodeLine lineNumber="8459"><span class="doxyHighlight">    Resimplify = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08460" /><CodeLine lineNumber="8460"></CodeLine>
<Link id="l08461" /><CodeLine lineNumber="8461"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Perform one round of simplifcation. Resimplify flag will be set if</span></CodeLine>
<Link id="l08462" /><CodeLine lineNumber="8462"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// another iteration is requested.</span></CodeLine>
<Link id="l08463" /><CodeLine lineNumber="8463"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a0cadca6f494db1ccdccb2256e49cb7fe">simplifyOnce</a>(BB);</span></CodeLine>
<Link id="l08464" /><CodeLine lineNumber="8464"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (Resimplify);</span></CodeLine>
<Link id="l08465" /><CodeLine lineNumber="8465"></CodeLine>
<Link id="l08466" /><CodeLine lineNumber="8466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l08467" /><CodeLine lineNumber="8467"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08468" /><CodeLine lineNumber="8468"></CodeLine>
<Link id="l08469" /><CodeLine lineNumber="8469" lineLink="/docs/api/namespaces/llvm/#ac2a5d254b5ec303b4d47ac3f0f578f09"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac2a5d254b5ec303b4d47ac3f0f578f09">llvm::simplifyCFG</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l08470" /><CodeLine lineNumber="8470"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/domtreeupdater">DomTreeUpdater</a> &#42;DTU, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/simplifycfgoptions">SimplifyCFGOptions</a> &amp;<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>,</span></CodeLine>
<Link id="l08471" /><CodeLine lineNumber="8471"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;WeakVH&gt;</a> LoopHeaders) &#123;</span></CodeLine>
<Link id="l08472" /><CodeLine lineNumber="8472"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifycfg-cpp-/simplifycfgopt/#a5d499c25e889b8f1b09536dacabf828d">SimplifyCFGOpt</a>(<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, DTU, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a858cab21fd29000697171b2f5b4bde31">getDataLayout</a>(), LoopHeaders,</span></CodeLine>
<Link id="l08473" /><CodeLine lineNumber="8473"><span class="doxyHighlight">                        <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>)</span></CodeLine>
<Link id="l08474" /><CodeLine lineNumber="8474"><span class="doxyHighlight">      .run(BB);</span></CodeLine>
<Link id="l08475" /><CodeLine lineNumber="8475"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
