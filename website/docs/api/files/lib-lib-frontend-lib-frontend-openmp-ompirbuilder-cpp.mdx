---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `OMPIRBuilder.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>

This file implements the <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> class, which is used as a convenient way to create LLVM instructions for OpenMP directives. <a href="#details">More...</a>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Frontend/OpenMP/OMPIRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/frontend/include/llvm/frontend/openmp/ompirbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallBitVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallbitvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/StringExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stringextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/StringRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AssumptionCache.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CodeMetrics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/codemetrics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/OptimizationRemarkEmitter.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolution.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetLibraryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Bitcode/BitcodeReader.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/bitcode/bitcodereader-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Frontend/Offloading/Utility.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/frontend/include/llvm/frontend/offloading/utility-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Frontend/OpenMP/OMPGridValues.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/frontend/include/llvm/frontend/openmp/ompgridvalues-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Attributes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CallingConv.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/callingconv-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DIBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfoMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalVariable.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/MDBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Metadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PassInstrumentation.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/passinstrumentation-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PassManager.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ReplaceConstant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/replaceconstant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/MC/TargetRegistry.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/mc/targetregistry-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/FileSystem.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/filesystem-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetMachine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetOptions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Cloning.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/cloning-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/CodeExtractor.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/codeextractor-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopPeel.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looppeel-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/UnrollLoop.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/unrollloop-h"
  isLocal="true" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="llvm/Frontend/OpenMP/OMPKinds.def"
  permalink=""
  isLocal="true" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-ompirbuilder-cpp-">anonymous&#123;OMPIRBuilder.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#ac36177cea684b1e36fdbc92d692f69d0">addBasicBlockMetadata</a> (BasicBlock &#42;BB, ArrayRef&lt; Metadata &#42; &gt; Properties)</>}>
Attach metadata <code>Properties</code> to the basic block described by <code>BB</code>. <a href="#ac36177cea684b1e36fdbc92d692f69d0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#adf813540e363817b85e9eecef51269b5">addLoopMetadata</a> (CanonicalLoopInfo &#42;Loop, ArrayRef&lt; Metadata &#42; &gt; Properties)</>}>
Attach loop metadata <code>Properties</code> to the loop described by <code><a href="/docs/api/classes/llvm/loop">Loop</a></code>. <a href="#adf813540e363817b85e9eecef51269b5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a545cc7eb4f94d0957ba9960a69b10a90">addSimdMetadata</a> (BasicBlock &#42;Block, MDNode &#42;AccessGroup, LoopInfo &amp;LI)</>}>
Attach llvm.access.group metadata to the memref instructions of <code>Block</code>. <a href="#a545cc7eb4f94d0957ba9960a69b10a90">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a75e12544ba3cf3438ac62e2065e4941d">checkReductionInfos</a> (ArrayRef&lt; OpenMPIRBuilder::ReductionInfo &gt; ReductionInfos, bool IsGPU)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>int32&#95;t</>}
  name={<><a href="#a946282957319b8c23ab9f169abb504c4">computeHeuristicUnrollFactor</a> (CanonicalLoopInfo &#42;CLI)</>}>
Heuristically determine the best-performant unroll factor for <code>CLI</code>. <a href="#a946282957319b8c23ab9f169abb504c4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a></>}
  name={<><a href="#a554000c782275642b783964853720bee">computeOpenMPScheduleType</a> (ScheduleKind ClauseKind, bool HasChunks, bool HasSimdModifier, bool HasMonotonicModifier, bool HasNonmonotonicModifier, bool HasOrderedClause)</>}>
Determine the schedule type using schedule and ordering clause arguments. <a href="#a554000c782275642b783964853720bee">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a35409dbaffc2cf38fefec12e3cf9094d">createFakeIntVal</a> (IRBuilderBase &amp;Builder, OpenMPIRBuilder::InsertPointTy OuterAllocaIP, llvm::SmallVectorImpl&lt; Instruction &#42; &gt; &amp;ToBeDeleted, OpenMPIRBuilder::InsertPointTy InnerAllocaIP, const Twine &amp;Name=&quot;&quot;, bool AsPtr=true)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/expected">Expected</a>&lt; <a href="/docs/api/classes/llvm/function">Function</a> &#42; &gt;</>}
  name={<><a href="#a3ea33750ee7de55492a5083c347e2ddb">createOutlinedFunction</a> (OpenMPIRBuilder &amp;OMPBuilder, IRBuilderBase &amp;Builder, const OpenMPIRBuilder::TargetKernelDefaultAttrs &amp;DefaultAttrs, StringRef FuncName, SmallVectorImpl&lt; Value &#42; &gt; &amp;Inputs, OpenMPIRBuilder::TargetBodyGenCallbackTy &amp;CBFunc, OpenMPIRBuilder::TargetGenArgAccessorsCallbackTy &amp;ArgAccessorFuncCB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#acae95016bcdeb105bcbcaaa872893f5f">createTargetLoopWorkshareCall</a> (OpenMPIRBuilder &#42;OMPBuilder, WorksharingLoopType LoopType, BasicBlock &#42;InsertBlock, Value &#42;Ident, Value &#42;LoopBodyArg, Type &#42;ParallelTaskPtr, Value &#42;TripCount, Function &amp;LoopBodyFn)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::unique&#95;ptr&lt; <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> &gt;</>}
  name={<><a href="#abfc7ebfffc7baaf23279854fec1412ac">createTargetMachine</a> (Function &#42;F, CodeGenOptLevel OptLevel)</>}>
Create the <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> object to query the backend for optimization preferences. <a href="#abfc7ebfffc7baaf23279854fec1412ac">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;</>}
  name={<><a href="#a91b7eb2a05d10c788413bec7977f3474">emitImplicitCast</a> (IRBuilder&lt;&gt; &amp;Builder, llvm::Value &#42;XRead, llvm::Value &#42;V)</>}>
Emit an implicit cast to convert <code>XRead</code> to type of variable <code>V</code>. <a href="#a91b7eb2a05d10c788413bec7977f3474">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a9acb4faf91112542d5ecf41230e9b64a">emitTargetCall</a> (OpenMPIRBuilder &amp;OMPBuilder, IRBuilderBase &amp;Builder, OpenMPIRBuilder::InsertPointTy AllocaIP, const OpenMPIRBuilder::TargetKernelDefaultAttrs &amp;DefaultAttrs, const OpenMPIRBuilder::TargetKernelRuntimeAttrs &amp;RuntimeAttrs, Value &#42;IfCond, Function &#42;OutlinedFn, Constant &#42;OutlinedFnID, SmallVectorImpl&lt; Value &#42; &gt; &amp;Args, OpenMPIRBuilder::GenMapInfoCallbackTy GenMapInfoCB, SmallVector&lt; llvm::OpenMPIRBuilder::DependData &gt; Dependencies=&#123;&#125;, bool HasNoWait=false)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/error">Error</a></>}
  name={<><a href="#aa33db5ef74d376fb331f9549fb3cd9b3">emitTargetOutlinedFunction</a> (OpenMPIRBuilder &amp;OMPBuilder, IRBuilderBase &amp;Builder, bool IsOffloadEntry, TargetRegionEntryInfo &amp;EntryInfo, const OpenMPIRBuilder::TargetKernelDefaultAttrs &amp;DefaultAttrs, Function &#42;&amp;OutlinedFn, Constant &#42;&amp;OutlinedFnID, SmallVectorImpl&lt; Value &#42; &gt; &amp;Inputs, OpenMPIRBuilder::TargetBodyGenCallbackTy &amp;CBFunc, OpenMPIRBuilder::TargetGenArgAccessorsCallbackTy &amp;ArgAccessorFuncCB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/function">Function</a> &#42;</>}
  name={<><a href="#a3fb4884285f5bcb9a37d9378d1e33cd5">emitTargetTaskProxyFunction</a> (OpenMPIRBuilder &amp;OMPBuilder, IRBuilderBase &amp;Builder, CallInst &#42;StaleCI)</>}>
Create an entry point for a target task with the following. <a href="#a3fb4884285f5bcb9a37d9378d1e33cd5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a9702d30c99a5459e9565631adf1fdf1b">emitTaskDependencies</a> (OpenMPIRBuilder &amp;OMPBuilder, const SmallVectorImpl&lt; OpenMPIRBuilder::DependData &gt; &amp;Dependencies)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/function">Function</a> &#42;</>}
  name={<><a href="#a669fae0a15d7219ef3ca3f3b16e3f5a0">getFreshReductionFunc</a> (Module &amp;M)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/omp/gv">omp::GV</a> &amp;</>}
  name={<><a href="#ad52342fdd467389643191fdac7abcd40">getGridValue</a> (const Triple &amp;T, Function &#42;Kernel)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a></>}
  name={<><a href="#ab5fa59567e3acc860411770354a1603a">getInsertPointAfterInstr</a> (Instruction &#42;I)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a></>}
  name={<><a href="#a3d17252beff7921e40622170990c89ab">getKmpcForDynamicFiniForType</a> (Type &#42;Ty, Module &amp;M, OpenMPIRBuilder &amp;OMPBuilder)</>}>
Returns an LLVM function to call for finalizing the dynamic loop using depending on <code>type</code>. <a href="#a3d17252beff7921e40622170990c89ab">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a></>}
  name={<><a href="#a7a68322ba864bccb8736e42fbc915a8a">getKmpcForDynamicInitForType</a> (Type &#42;Ty, Module &amp;M, OpenMPIRBuilder &amp;OMPBuilder)</>}>
Returns an LLVM function to call for initializing loop bounds using OpenMP dynamic scheduling depending on <code>type</code>. <a href="#a7a68322ba864bccb8736e42fbc915a8a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a></>}
  name={<><a href="#a74bf2240e1da04168d57a7534c9613f7">getKmpcForDynamicNextForType</a> (Type &#42;Ty, Module &amp;M, OpenMPIRBuilder &amp;OMPBuilder)</>}>
Returns an LLVM function to call for updating the next loop using OpenMP dynamic scheduling depending on <code>type</code>. <a href="#a74bf2240e1da04168d57a7534c9613f7">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a></>}
  name={<><a href="#ac04904b32ea7f45e108b8752b1a940e7">getKmpcForStaticInitForType</a> (Type &#42;Ty, Module &amp;M, OpenMPIRBuilder &amp;OMPBuilder)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a></>}
  name={<><a href="#aca27639a720491c7c7ea13c2bbe8c162">getKmpcForStaticLoopForType</a> (Type &#42;Ty, OpenMPIRBuilder &#42;OMPBuilder, WorksharingLoopType LoopType)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;</>}
  name={<><a href="#a749d7f5580e6a5b6214d911bad2a0b36">getNVPTXMDNode</a> (Function &amp;Kernel, StringRef Name)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a></>}
  name={<><a href="#a065b0b31e5ca4c10b1cef45581efb8dc">getOpenMPBaseScheduleType</a> (llvm::omp::ScheduleKind ClauseKind, bool HasChunks, bool HasSimdModifier)</>}>
Determine which scheduling algorithm to use, determined from schedule clause arguments. <a href="#a065b0b31e5ca4c10b1cef45581efb8dc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a></>}
  name={<><a href="#a4b64de5bc0d090cc76ddb989acabf0f3">getOpenMPMonotonicityScheduleType</a> (OMPScheduleType ScheduleType, bool HasSimdModifier, bool HasMonotonic, bool HasNonmonotonic, bool HasOrderedClause)</>}>
Adds monotonicity modifier flags to schedule type. <a href="#a4b64de5bc0d090cc76ddb989acabf0f3">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a></>}
  name={<><a href="#a4a87dd5af95eb64807ad77405e4f4654">getOpenMPOrderingScheduleType</a> (OMPScheduleType BaseScheduleType, bool HasOrderedClause)</>}>
Adds ordering modifier flags to schedule type. <a href="#a4a87dd5af95eb64807ad77405e4f4654">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#afffa0ff2e1527ab545cef33be915c656">hostParallelCallback</a> (OpenMPIRBuilder &#42;OMPIRBuilder, Function &amp;OutlinedFn, Function &#42;OuterFn, Value &#42;Ident, Value &#42;IfCondition, Instruction &#42;PrivTID, AllocaInst &#42;PrivTIDAddr, const SmallVector&lt; Instruction &#42;, 4 &gt; &amp;ToBeDeleted)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a756b28f370cd5a39bc0ee3e5333b9c9b">isConflictIP</a> (IRBuilder&lt;&gt;::InsertPoint IP1, IRBuilder&lt;&gt;::InsertPoint IP2)</>}>
Return whether IP1 and IP2 are ambiguous, i.e. <a href="#a756b28f370cd5a39bc0ee3e5333b9c9b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a596dcc3bb2ae8b7561e94095584e0f1e">isValidWorkshareLoopScheduleType</a> (OMPScheduleType SchedType)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a6e4c46869d9d198562f7b8628814e407">raiseUserConstantDataAllocasToEntryBlock</a> (IRBuilderBase &amp;Builder, Function &#42;Function)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#abdcdbfc178873f5055fbcf98bad92f53">redirectAllPredecessorsTo</a> (BasicBlock &#42;OldTarget, BasicBlock &#42;NewTarget, DebugLoc DL)</>}>
Redirect all edges that branch to <code>OldTarget</code> to <code>NewTarget</code>. <a href="#abdcdbfc178873f5055fbcf98bad92f53">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a> (BasicBlock &#42;Source, BasicBlock &#42;Target, DebugLoc DL)</>}>
Make <code>Source</code> branch to <code><a href="/docs/api/classes/llvm/target">Target</a></code>. <a href="#a3057c2b7e1e25de160497b1ef3985c2a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#af0ce60c4a958016f62ce78f1eda423af">removeUnusedBlocksFromParent</a> (ArrayRef&lt; BasicBlock &#42; &gt; BBs)</>}>
Determine which blocks in <code>BBs</code> are reachable from outside and remove the ones that are not reachable from the function. <a href="#af0ce60c4a958016f62ce78f1eda423af">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#af7668ce8080668a4f0ceac24e70c9f00">targetParallelCallback</a> (OpenMPIRBuilder &#42;OMPIRBuilder, Function &amp;OutlinedFn, Function &#42;OuterFn, BasicBlock &#42;OuterAllocaBB, Value &#42;Ident, Value &#42;IfCondition, Value &#42;NumThreads, Instruction &#42;PrivTID, AllocaInst &#42;PrivTIDAddr, Value &#42;ThreadID, const SmallVector&lt; Instruction &#42;, 4 &gt; &amp;ToBeDeleted)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a457f42a32df73079ac4526c572a2d7fd">updateNVPTXMetadata</a> (Function &amp;Kernel, StringRef Name, int32&#95;t Value, bool Min)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aa2a5199bf39360e25f40b93cd5f9468a">workshareLoopTargetCallback</a> (OpenMPIRBuilder &#42;OMPIRBuilder, CanonicalLoopInfo &#42;CLI, Value &#42;Ident, Function &amp;OutlinedFn, Type &#42;ParallelTaskPtr, const SmallVector&lt; Instruction &#42;, 4 &gt; &amp;ToBeDeleted, WorksharingLoopType LoopType)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ac7b0d6b394df409e7550fb21aa7d9e5c">OptimisticAttributes</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; double &gt;</>}
  name={<><a href="#a87dfce8f7ae9d7942d55ac782438dbf8">UnrollThresholdFactor</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;openmp-<a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp/#a3d3459f5796b9b9f0253f71d5620e958">ir</a>-builder&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#aafa57f1c2700b16129c83badeb165f9c">OMP&#95;ARRAY&#95;TYPE</a>&nbsp;&nbsp;&nbsp;  VarName##Ty = ArrayType::get(ElemTy, ArraySize);                             \\
  VarName##PtrTy = PointerType::getUnqual(Ctx);</>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#a7a441e887365f90092c254b19e7bcfef">OMP&#95;ATTRS&#95;SET</a>&nbsp;&nbsp;&nbsp;AttributeSet VarName = AttrSet;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#a6f431cf29bc502bb66b702e9d36dea91">OMP&#95;CANCEL&#95;KIND</a>&nbsp;&nbsp;&nbsp;  case DirectiveEnum:                                                          \\
    CancelKind = Builder.getInt32(Value);                                      \\
    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/ehstreamer-cpp/#a91cf6fbebedd86150a36e5ac3d5d3bfc">break</a>;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad08bb874382ad7ded92c133a57714c49">OMP&#95;FUNCTION&#95;TYPE</a>&nbsp;&nbsp;&nbsp;  VarName = FunctionType::get(ReturnType, &#123;&#95;&#95;VA&#95;ARGS&#95;&#95;&#125;, IsVarArg);            \\
  VarName##<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = PointerType::getUnqual(Ctx);</>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#a02ddde535a0ac37557b1a1907c8de422">OMP&#95;RTL</a>&nbsp;&nbsp;&nbsp;  case Enum:                                                                   \\
    FnTy = FunctionType::get(ReturnType, ArrayRef&lt;Type &#42;&gt;&#123;&#95;&#95;VA&#95;ARGS&#95;&#95;&#125;,        \\
                             IsVarArg);                                        \\
    Fn = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/evaluator-cpp/#a92efb02157b6836e1232c577d34678d6">M.getFunction</a>(Str);                                                   \\
    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/ehstreamer-cpp/#a91cf6fbebedd86150a36e5ac3d5d3bfc">break</a>;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#a8e0948ab2a7acb4aa9997fd1a5b8fbb7">OMP&#95;RTL</a>&nbsp;&nbsp;&nbsp;  case Enum:                                                                   \\
    Fn = Function::Create(FnTy, GlobalValue::ExternalLinkage, Str, M);         \\
    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/ehstreamer-cpp/#a91cf6fbebedd86150a36e5ac3d5d3bfc">break</a>;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#afef4eeef2878c8a4a7ca0f8dd522141f">OMP&#95;RTL&#95;ATTRS</a>&nbsp;&nbsp;&nbsp;  case Enum:                                                                   \\
    FnAttrs = FnAttrs.addAttributes(Ctx, FnAttrSet);                           \\
    addAttrSet(RetAttrs, RetAttrSet, /&#42;Param&#42;/ false);                         \\
    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> (size&#95;t ArgNo = 0; ArgNo &lt; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmreflect-cpp/#ac934769d93af95250952646a3829df4c">ArgAttrSets.size</a>(); ++ArgNo)                \\
      addAttrSet(ArgAttrs&#91;ArgNo&#93;, ArgAttrSets&#91;ArgNo&#93;);                         \\
    Fn.setAttributes(AttributeList::get(Ctx, FnAttrs, RetAttrs, ArgAttrs));    \\
    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/ehstreamer-cpp/#a91cf6fbebedd86150a36e5ac3d5d3bfc">break</a>;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#aab9e6bf3a40b4ccf0272542c0ce58d16">OMP&#95;STRUCT&#95;TYPE</a>&nbsp;&nbsp;&nbsp;  T = StructType::getTypeByName(Ctx, <a href="/docs/api/files/lib/lib/object/machouniversalwriter-cpp/#a26ecfcee41769620d62e904e7f142499">StructName</a>);                              \\
  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#acdfbcf188e2d4a80837e89de2ccdffab">if</a> (!T)                                                                      \\
    T = StructType::create(Ctx, &#123;&#95;&#95;VA&#95;ARGS&#95;&#95;&#125;, <a href="/docs/api/files/lib/lib/object/machouniversalwriter-cpp/#a26ecfcee41769620d62e904e7f142499">StructName</a>, Packed);            \\
  VarName = T;                                                                 \\
  VarName##<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = PointerType::getUnqual(Ctx);</>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#afd21bf6bbf67e4d7213a29ade471a8ee">OMP&#95;TYPE</a>&nbsp;&nbsp;&nbsp;VarName = InitValue;</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

This file implements the <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> class, which is used as a convenient way to create LLVM instructions for OpenMP directives.

<SectionDefinition>

## Functions

### addBasicBlockMetadata() {#ac36177cea684b1e36fdbc92d692f69d0}

<MemberDefinition
  prototype={<>static void addBasicBlockMetadata (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42; &gt; Properties)</>}
  labels = {["static"]}>
Attach metadata <code>Properties</code> to the basic block described by <code>BB</code>.

If the basic block already has metadata, the basic block properties are appended.

Definition at line <a href="#l05207">5207</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### addLoopMetadata() {#adf813540e363817b85e9eecef51269b5}

<MemberDefinition
  prototype={<>static void addLoopMetadata (<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42; Loop, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42; &gt; Properties)</>}
  labels = {["static"]}>
Attach loop metadata <code>Properties</code> to the loop described by <code><a href="/docs/api/classes/llvm/loop">Loop</a></code>.

If the loop already has metadata, the loop properties are appended.

Definition at line <a href="#l05231">5231</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### addSimdMetadata() {#a545cc7eb4f94d0957ba9960a69b10a90}

<MemberDefinition
  prototype={<>static void addSimdMetadata (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; Block, <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42; AccessGroup, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp; LI)</>}
  labels = {["static"]}>
Attach llvm.access.group metadata to the memref instructions of <code>Block</code>.

Definition at line <a href="#l05242">5242</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### checkReductionInfos() {#a75e12544ba3cf3438ac62e2065e4941d}

<MemberDefinition
  prototype={<>static void checkReductionInfos (<a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; OpenMPIRBuilder::ReductionInfo &gt; ReductionInfos, bool IsGPU)</>}
  labels = {["static"]}>

Definition at line <a href="#l03515">3515</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### computeHeuristicUnrollFactor() {#a946282957319b8c23ab9f169abb504c4}

<MemberDefinition
  prototype={<>static int32&#95;t computeHeuristicUnrollFactor (<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42; CLI)</>}
  labels = {["static"]}>
Heuristically determine the best-performant unroll factor for <code>CLI</code>.

This depends on the target processor. We are re-using the same heuristics as the <a href="/docs/api/classes/llvm/loopunrollpass">LoopUnrollPass</a>.

Definition at line <a href="#l05484">5484</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### computeOpenMPScheduleType() {#a554000c782275642b783964853720bee}

<MemberDefinition
  prototype="static OMPScheduleType computeOpenMPScheduleType (ScheduleKind ClauseKind, bool HasChunks, bool HasSimdModifier, bool HasMonotonicModifier, bool HasNonmonotonicModifier, bool HasOrderedClause)"
  labels = {["static"]}>
Determine the schedule type using schedule and ordering clause arguments.

Definition at line <a href="#l00252">252</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### createFakeIntVal() {#a35409dbaffc2cf38fefec12e3cf9094d}

<MemberDefinition
  prototype={<>Value &#42; createFakeIntVal (<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; Builder, <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> OuterAllocaIP, <a href="/docs/api/classes/llvm/smallvectorimpl">llvm::SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &gt; &amp; ToBeDeleted, <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> InnerAllocaIP, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp; Name=&quot;&quot;, bool AsPtr=<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a>)</>}>

Definition at line <a href="#l00391">391</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### createOutlinedFunction() {#a3ea33750ee7de55492a5083c347e2ddb}

<MemberDefinition
  prototype={<>static Expected&lt; Function &#42; &gt; createOutlinedFunction (<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp; OMPBuilder, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; Builder, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> OpenMPIRBuilder::TargetKernelDefaultAttrs &amp; DefaultAttrs, <a href="/docs/api/classes/llvm/stringref">StringRef</a> FuncName, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; Inputs, OpenMPIRBuilder::TargetBodyGenCallbackTy &amp; CBFunc, OpenMPIRBuilder::TargetGenArgAccessorsCallbackTy &amp; ArgAccessorFuncCB)</>}
  labels = {["static"]}>

Definition at line <a href="#l06807">6807</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### createTargetLoopWorkshareCall() {#acae95016bcdeb105bcbcaaa872893f5f}

<MemberDefinition
  prototype={<>static void createTargetLoopWorkshareCall (<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &#42; OMPBuilder, <a href="/docs/api/namespaces/llvm/omp/#ab6fb146c332fd3f3d677ee65081fe669">WorksharingLoopType</a> LoopType, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; InsertBlock, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Ident, <a href="/docs/api/classes/llvm/value">Value</a> &#42; LoopBodyArg, <a href="/docs/api/classes/llvm/type">Type</a> &#42; ParallelTaskPtr, <a href="/docs/api/classes/llvm/value">Value</a> &#42; TripCount, <a href="/docs/api/classes/llvm/function">Function</a> &amp; LoopBodyFn)</>}
  labels = {["static"]}>

Definition at line <a href="#l04433">4433</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### createTargetMachine() {#abfc7ebfffc7baaf23279854fec1412ac}

<MemberDefinition
  prototype={<>static std::unique&#95;ptr&lt; TargetMachine &gt; createTargetMachine (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F, <a href="/docs/api/namespaces/llvm/#a8ec1bf8d7b792ca9fac56f8514db18d2">CodeGenOptLevel</a> OptLevel)</>}
  labels = {["static"]}>
Create the <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> object to query the backend for optimization preferences.

Ideally, this would be passed from the front-end to the OpenMPBuilder, but e.g. Clang does not pass it to its CodeGen layer and creates it only when needed for the LLVM pass pipline. We use some default options to avoid having to pass too many settings from the frontend that probably do not matter.

Currently, <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> is only used sometimes by the unrollLoopPartial method. If we are going to use <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> for more purposes, especially those that are sensitive to <a href="/docs/api/classes/llvm/targetoptions">TargetOptions</a>, RelocModel and <a href="/docs/api/namespaces/llvm/codemodel">CodeModel</a>, it might become be worth requiring front-ends to pass on their <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a>, or at least cache it between methods. Note that while fontends such as Clang have just a single main <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> per translation unit, &quot;target-cpu&quot; and &quot;target-features&quot; that determine the <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> are per-function and can be overrided using <b>attribute</b>((target(&quot;OPTIONS&quot;))).

Definition at line <a href="#l05463">5463</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### emitImplicitCast() {#a91b7eb2a05d10c788413bec7977f3474}

<MemberDefinition
  prototype={<>static llvm::Value &#42; emitImplicitCast (<a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt; &amp; Builder, <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42; XRead, <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42; V)</>}
  labels = {["static"]}>
Emit an implicit cast to convert <code>XRead</code> to type of variable <code>V</code>.

Definition at line <a href="#l00268">268</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### emitTargetCall() {#a9acb4faf91112542d5ecf41230e9b64a}

<MemberDefinition
  prototype={<>static void emitTargetCall (<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp; OMPBuilder, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; Builder, <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> AllocaIP, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> OpenMPIRBuilder::TargetKernelDefaultAttrs &amp; DefaultAttrs, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> OpenMPIRBuilder::TargetKernelRuntimeAttrs &amp; RuntimeAttrs, <a href="/docs/api/classes/llvm/value">Value</a> &#42; IfCond, <a href="/docs/api/classes/llvm/function">Function</a> &#42; OutlinedFn, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; OutlinedFnID, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; Args, OpenMPIRBuilder::GenMapInfoCallbackTy GenMapInfoCB, <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/structs/llvm/openmpirbuilder/dependdata">llvm::OpenMPIRBuilder::DependData</a> &gt; Dependencies=&#123;&#125;, bool HasNoWait=false)</>}
  labels = {["static"]}>

Definition at line <a href="#l07404">7404</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### emitTargetOutlinedFunction() {#aa33db5ef74d376fb331f9549fb3cd9b3}

<MemberDefinition
  prototype={<>static Error emitTargetOutlinedFunction (<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp; OMPBuilder, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; Builder, bool IsOffloadEntry, <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> &amp; EntryInfo, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> OpenMPIRBuilder::TargetKernelDefaultAttrs &amp; DefaultAttrs, <a href="/docs/api/classes/llvm/function">Function</a> &#42;&amp; OutlinedFn, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;&amp; OutlinedFnID, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; Inputs, OpenMPIRBuilder::TargetBodyGenCallbackTy &amp; CBFunc, OpenMPIRBuilder::TargetGenArgAccessorsCallbackTy &amp; ArgAccessorFuncCB)</>}
  labels = {["static"]}>

Definition at line <a href="#l07092">7092</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### emitTargetTaskProxyFunction() {#a3fb4884285f5bcb9a37d9378d1e33cd5}

<MemberDefinition
  prototype={<>static Function &#42; emitTargetTaskProxyFunction (<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp; OMPBuilder, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; Builder, <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; StaleCI)</>}
  labels = {["static"]}>
Create an entry point for a target task with the following.

It&#39;ll have the following signature void .omp&#95;target&#95;task&#95;proxy&#95;func(i32 thread.id, ptr task) This function is called from emitTargetTask once the code to launch the target kernel has been outlined already.

Definition at line <a href="#l07012">7012</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### emitTaskDependencies() {#a9702d30c99a5459e9565631adf1fdf1b}

<MemberDefinition
  prototype={<>static Value &#42; emitTaskDependencies (<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp; OMPBuilder, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/structs/llvm/openmpirbuilder/dependdata">OpenMPIRBuilder::DependData</a> &gt; &amp; Dependencies)</>}
  labels = {["static"]}>

Definition at line <a href="#l01814">1814</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### getFreshReductionFunc() {#a669fae0a15d7219ef3ca3f3b16e3f5a0}

<MemberDefinition
  prototype={<>static Function &#42; getFreshReductionFunc (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M)</>}
  labels = {["static"]}>

Definition at line <a href="#l03721">3721</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### getGridValue() {#ad52342fdd467389643191fdac7abcd40}

<MemberDefinition
  prototype={<>static const omp::GV &amp; getGridValue (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/triple">Triple</a> &amp; T, <a href="/docs/api/classes/llvm/function">Function</a> &#42; Kernel)</>}
  labels = {["static"]}>

Definition at line <a href="#l00152">152</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### getInsertPointAfterInstr() {#ab5fa59567e3acc860411770354a1603a}

<MemberDefinition
  prototype={<>static OpenMPIRBuilder::InsertPointTy getInsertPointAfterInstr (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I)</>}
  labels = {["static"]}>

Definition at line <a href="#l02348">2348</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### getKmpcForDynamicFiniForType() {#a3d17252beff7921e40622170990c89ab}

<MemberDefinition
  prototype={<>static FunctionCallee getKmpcForDynamicFiniForType (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, <a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp; OMPBuilder)</>}
  labels = {["static"]}>
Returns an LLVM function to call for finalizing the dynamic loop using depending on <code>type</code>.

Only i32 and i64 are supported by the runtime. Always interpret integers as unsigned similarly to <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a>.

Definition at line <a href="#l04711">4711</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### getKmpcForDynamicInitForType() {#a7a68322ba864bccb8736e42fbc915a8a}

<MemberDefinition
  prototype={<>static FunctionCallee getKmpcForDynamicInitForType (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, <a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp; OMPBuilder)</>}
  labels = {["static"]}>
Returns an LLVM function to call for initializing loop bounds using OpenMP dynamic scheduling depending on <code>type</code>.

Only i32 and i64 are supported by the runtime. Always interpret integers as unsigned similarly to <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a>.

Definition at line <a href="#l04680">4680</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### getKmpcForDynamicNextForType() {#a74bf2240e1da04168d57a7534c9613f7}

<MemberDefinition
  prototype={<>static FunctionCallee getKmpcForDynamicNextForType (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, <a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp; OMPBuilder)</>}
  labels = {["static"]}>
Returns an LLVM function to call for updating the next loop using OpenMP dynamic scheduling depending on <code>type</code>.

Only i32 and i64 are supported by the runtime. Always interpret integers as unsigned similarly to <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a>.

Definition at line <a href="#l04696">4696</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### getKmpcForStaticInitForType() {#ac04904b32ea7f45e108b8752b1a940e7}

<MemberDefinition
  prototype={<>static FunctionCallee getKmpcForStaticInitForType (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, <a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp; OMPBuilder)</>}
  labels = {["static"]}>

Definition at line <a href="#l04130">4130</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### getKmpcForStaticLoopForType() {#aca27639a720491c7c7ea13c2bbe8c162}

<MemberDefinition
  prototype={<>static FunctionCallee getKmpcForStaticLoopForType (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &#42; OMPBuilder, <a href="/docs/api/namespaces/llvm/omp/#ab6fb146c332fd3f3d677ee65081fe669">WorksharingLoopType</a> LoopType)</>}
  labels = {["static"]}>

Definition at line <a href="#l04395">4395</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### getNVPTXMDNode() {#a749d7f5580e6a5b6214d911bad2a0b36}

<MemberDefinition
  prototype={<>static MDNode &#42; getNVPTXMDNode (<a href="/docs/api/classes/llvm/function">Function</a> &amp; Kernel, <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name)</>}
  labels = {["static"]}>

Definition at line <a href="#l06363">6363</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### getOpenMPBaseScheduleType() {#a065b0b31e5ca4c10b1cef45581efb8dc}

<MemberDefinition
  prototype="static OMPScheduleType getOpenMPBaseScheduleType (llvm::omp::ScheduleKind ClauseKind, bool HasChunks, bool HasSimdModifier)"
  labels = {["static"]}>
Determine which scheduling algorithm to use, determined from schedule clause arguments.

Definition at line <a href="#l00168">168</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### getOpenMPMonotonicityScheduleType() {#a4b64de5bc0d090cc76ddb989acabf0f3}

<MemberDefinition
  prototype={<>static OMPScheduleType getOpenMPMonotonicityScheduleType (<a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> ScheduleType, bool HasSimdModifier, bool HasMonotonic, bool HasNonmonotonic, bool HasOrderedClause)</>}
  labels = {["static"]}>
Adds monotonicity modifier flags to schedule type.

Definition at line <a href="#l00216">216</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### getOpenMPOrderingScheduleType() {#a4a87dd5af95eb64807ad77405e4f4654}

<MemberDefinition
  prototype={<>static OMPScheduleType getOpenMPOrderingScheduleType (<a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> BaseScheduleType, bool HasOrderedClause)</>}
  labels = {["static"]}>
Adds ordering modifier flags to schedule type.

Definition at line <a href="#l00192">192</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### hostParallelCallback() {#afffa0ff2e1527ab545cef33be915c656}

<MemberDefinition
  prototype={<>static void hostParallelCallback (<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &#42; OMPIRBuilder, <a href="/docs/api/classes/llvm/function">Function</a> &amp; OutlinedFn, <a href="/docs/api/classes/llvm/function">Function</a> &#42; OuterFn, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Ident, <a href="/docs/api/classes/llvm/value">Value</a> &#42; IfCondition, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; PrivTID, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; PrivTIDAddr, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, 4 &gt; &amp; ToBeDeleted)</>}
  labels = {["static"]}>

Definition at line <a href="#l01344">1344</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### isConflictIP() {#a756b28f370cd5a39bc0ee3e5333b9c9b}

<MemberDefinition
  prototype={<>static bool isConflictIP (<a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt;<a href="/docs/api/classes/llvm/irbuilder">::InsertPoint</a> IP1, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt;<a href="/docs/api/classes/llvm/irbuilder">::InsertPoint</a> IP2)</>}
  labels = {["static"]}>
Return whether IP1 and IP2 are ambiguous, i.e.

that inserting instructions at position IP1 may change the meaning of IP2 or vice-versa. This is because an <a href="/docs/api/classes/llvm/irbuilder">InsertPoint</a> stores the instruction before something is inserted. For instance, if both point to the same instruction, two IRBuilders alternating creating instruction will cause the instructions to be interleaved.

Definition at line <a href="#l00086">86</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### isValidWorkshareLoopScheduleType() {#a596dcc3bb2ae8b7561e94095584e0f1e}

<MemberDefinition
  prototype={<>static bool isValidWorkshareLoopScheduleType (<a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> SchedType)</>}
  labels = {["static"]}>

Definition at line <a href="#l00093">93</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### raiseUserConstantDataAllocasToEntryBlock() {#a6e4c46869d9d198562f7b8628814e407}

<MemberDefinition
  prototype={<>static void raiseUserConstantDataAllocasToEntryBlock (<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; Builder, <a href="/docs/api/classes/llvm/function">Function</a> &#42; Function)</>}
  labels = {["static"]}>

Definition at line <a href="#l00678">678</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### redirectAllPredecessorsTo() {#abdcdbfc178873f5055fbcf98bad92f53}

<MemberDefinition
  prototype={<>static void redirectAllPredecessorsTo (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; OldTarget, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; NewTarget, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> DL)</>}
  labels = {["static"]}>
Redirect all edges that branch to <code>OldTarget</code> to <code>NewTarget</code>.

That is, after this <code>OldTarget</code> will be orphaned.

Definition at line <a href="#l04856">4856</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### redirectTo() {#a3057c2b7e1e25de160497b1ef3985c2a}

<MemberDefinition
  prototype={<>static void redirectTo (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; Source, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; Target, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> DL)</>}
  labels = {["static"]}>
Make <code>Source</code> branch to <code><a href="/docs/api/classes/llvm/target">Target</a></code>.

Handles two situations:
<ul>
<li><code>Source</code> already has an unconditional branch.</li>
<li><code>Source</code> is a degenerate block (no terminator because the BB is the current head of the IR construction).</li>
</ul>

Definition at line <a href="#l00300">300</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### removeUnusedBlocksFromParent() {#af0ce60c4a958016f62ce78f1eda423af}

<MemberDefinition
  prototype={<>static void removeUnusedBlocksFromParent (<a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; BBs)</>}
  labels = {["static"]}>
Determine which blocks in <code>BBs</code> are reachable from outside and remove the ones that are not reachable from the function.

Definition at line <a href="#l04864">4864</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### targetParallelCallback() {#af7668ce8080668a4f0ceac24e70c9f00}

<MemberDefinition
  prototype={<>static void targetParallelCallback (<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &#42; OMPIRBuilder, <a href="/docs/api/classes/llvm/function">Function</a> &amp; OutlinedFn, <a href="/docs/api/classes/llvm/function">Function</a> &#42; OuterFn, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; OuterAllocaBB, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Ident, <a href="/docs/api/classes/llvm/value">Value</a> &#42; IfCondition, <a href="/docs/api/classes/llvm/value">Value</a> &#42; NumThreads, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; PrivTID, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42; PrivTIDAddr, <a href="/docs/api/classes/llvm/value">Value</a> &#42; ThreadID, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, 4 &gt; &amp; ToBeDeleted)</>}
  labels = {["static"]}>

Definition at line <a href="#l01255">1255</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### updateNVPTXMetadata() {#a457f42a32df73079ac4526c572a2d7fd}

<MemberDefinition
  prototype={<>static void updateNVPTXMetadata (<a href="/docs/api/classes/llvm/function">Function</a> &amp; Kernel, <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name, int32&#95;t Value, bool Min)</>}
  labels = {["static"]}>

Definition at line <a href="#l06380">6380</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### workshareLoopTargetCallback() {#aa2a5199bf39360e25f40b93cd5f9468a}

<MemberDefinition
  prototype={<>static void workshareLoopTargetCallback (<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &#42; OMPIRBuilder, <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42; CLI, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Ident, <a href="/docs/api/classes/llvm/function">Function</a> &amp; OutlinedFn, <a href="/docs/api/classes/llvm/type">Type</a> &#42; ParallelTaskPtr, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;, 4 &gt; &amp; ToBeDeleted, <a href="/docs/api/namespaces/llvm/omp/#ab6fb146c332fd3f3d677ee65081fe669">WorksharingLoopType</a> LoopType)</>}
  labels = {["static"]}>

Definition at line <a href="#l04468">4468</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### OptimisticAttributes {#ac7b0d6b394df409e7550fb21aa7d9e5c}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; OptimisticAttributes(&quot;openmp-ir-builder-optimistic-attributes&quot;, cl::Hidden, cl::desc(&quot;Use optimistic attributes describing &quot; &quot;&#39;as-if&#39; properties of runtime calls.&quot;), cl::init(false))</>}
  labels = {["static"]}>

Definition at line <a href="#l00069">69</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### UnrollThresholdFactor {#a87dfce8f7ae9d7942d55ac782438dbf8}

<MemberDefinition
  prototype={<>cl::opt&lt; double &gt; UnrollThresholdFactor(&quot;openmp-ir-builder-unroll-threshold-factor&quot;, cl::Hidden, cl::desc(&quot;Factor for the unroll threshold to account for code &quot; &quot;simplifications still taking place&quot;), cl::init(1.5))</>}
  labels = {["static"]}>

Definition at line <a href="#l00074">74</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;openmp-<a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp/#a3d3459f5796b9b9f0253f71d5620e958">ir</a>-builder&quot;</>}>

Definition at line <a href="#l00063">63</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### OMP&#95;ARRAY&#95;TYPE {#aafa57f1c2700b16129c83badeb165f9c}

<MemberDefinition
  prototype={<>#define OMP&#95;ARRAY&#95;TYPE&nbsp;&nbsp;&nbsp;  VarName##Ty = ArrayType::get(ElemTy, ArraySize);                             \\
  VarName##PtrTy = PointerType::getUnqual(Ctx);</>}>

Definition at line <a href="#l09184">9184</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### OMP&#95;ATTRS&#95;SET {#a7a441e887365f90092c254b19e7bcfef}

<MemberDefinition
  prototype={<>#define OMP&#95;ATTRS&#95;SET&nbsp;&nbsp;&nbsp;AttributeSet VarName = AttrSet;</>}>

Definition at line <a href="#l00592">592</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### OMP&#95;CANCEL&#95;KIND {#a6f431cf29bc502bb66b702e9d36dea91}

<MemberDefinition
  prototype={<>#define OMP&#95;CANCEL&#95;KIND&nbsp;&nbsp;&nbsp;  case DirectiveEnum:                                                          \\
    CancelKind = Builder.getInt32(Value);                                      \\
    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/ehstreamer-cpp/#a91cf6fbebedd86150a36e5ac3d5d3bfc">break</a>;</>}>

Definition at line <a href="#l01076">1076</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### OMP&#95;FUNCTION&#95;TYPE {#ad08bb874382ad7ded92c133a57714c49}

<MemberDefinition
  prototype={<>#define OMP&#95;FUNCTION&#95;TYPE&nbsp;&nbsp;&nbsp;  VarName = FunctionType::get(ReturnType, &#123;&#95;&#95;VA&#95;ARGS&#95;&#95;&#125;, IsVarArg);            \\
  VarName##<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = PointerType::getUnqual(Ctx);</>}>

Definition at line <a href="#l09187">9187</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### OMP&#95;RTL {#a02ddde535a0ac37557b1a1907c8de422}

<MemberDefinition
  prototype={<>#define OMP&#95;RTL&nbsp;&nbsp;&nbsp;  case Enum:                                                                   \\
    FnTy = FunctionType::get(ReturnType, ArrayRef&lt;Type &#42;&gt;&#123;&#95;&#95;VA&#95;ARGS&#95;&#95;&#125;,        \\
                             IsVarArg);                                        \\
    Fn = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/evaluator-cpp/#a92efb02157b6836e1232c577d34678d6">M.getFunction</a>(Str);                                                   \\
    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/ehstreamer-cpp/#a91cf6fbebedd86150a36e5ac3d5d3bfc">break</a>;</>}>

Definition at line <a href="#l00619">619</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### OMP&#95;RTL {#a8e0948ab2a7acb4aa9997fd1a5b8fbb7}

<MemberDefinition
  prototype={<>#define OMP&#95;RTL&nbsp;&nbsp;&nbsp;  case Enum:                                                                   \\
    Fn = Function::Create(FnTy, GlobalValue::ExternalLinkage, Str, M);         \\
    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/ehstreamer-cpp/#a91cf6fbebedd86150a36e5ac3d5d3bfc">break</a>;</>}>

Definition at line <a href="#l00631">631</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### OMP&#95;RTL&#95;ATTRS {#afef4eeef2878c8a4a7ca0f8dd522141f}

<MemberDefinition
  prototype={<>#define OMP&#95;RTL&#95;ATTRS&nbsp;&nbsp;&nbsp;  case Enum:                                                                   \\
    FnAttrs = FnAttrs.addAttributes(Ctx, FnAttrSet);                           \\
    addAttrSet(RetAttrs, RetAttrSet, /&#42;Param&#42;/ false);                         \\
    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> (size&#95;t ArgNo = 0; ArgNo &lt; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmreflect-cpp/#ac934769d93af95250952646a3829df4c">ArgAttrSets.size</a>(); ++ArgNo)                \\
      addAttrSet(ArgAttrs&#91;ArgNo&#93;, ArgAttrSets&#91;ArgNo&#93;);                         \\
    Fn.setAttributes(AttributeList::get(Ctx, FnAttrs, RetAttrs, ArgAttrs));    \\
    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/ehstreamer-cpp/#a91cf6fbebedd86150a36e5ac3d5d3bfc">break</a>;</>}>

Definition at line <a href="#l00597">597</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### OMP&#95;STRUCT&#95;TYPE {#aab9e6bf3a40b4ccf0272542c0ce58d16}

<MemberDefinition
  prototype={<>#define OMP&#95;STRUCT&#95;TYPE&nbsp;&nbsp;&nbsp;  T = StructType::getTypeByName(Ctx, <a href="/docs/api/files/lib/lib/object/machouniversalwriter-cpp/#a26ecfcee41769620d62e904e7f142499">StructName</a>);                              \\
  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#acdfbcf188e2d4a80837e89de2ccdffab">if</a> (!T)                                                                      \\
    T = StructType::create(Ctx, &#123;&#95;&#95;VA&#95;ARGS&#95;&#95;&#125;, <a href="/docs/api/files/lib/lib/object/machouniversalwriter-cpp/#a26ecfcee41769620d62e904e7f142499">StructName</a>, Packed);            \\
  VarName = T;                                                                 \\
  VarName##<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = PointerType::getUnqual(Ctx);</>}>

Definition at line <a href="#l09190">9190</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

### OMP&#95;TYPE {#afd21bf6bbf67e4d7213a29ade471a8ee}

<MemberDefinition
  prototype={<>#define OMP&#95;TYPE&nbsp;&nbsp;&nbsp;VarName = InitValue;</>}>

Definition at line <a href="#l09183">9183</a> of file <a href="/docs/api/files/lib/lib/frontend/lib/frontend/openmp/ompirbuilder-cpp">OMPIRBuilder.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- OpenMPIRBuilder.cpp - Builder for LLVM-IR for OpenMP directives ----===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">/// \\file</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">/// This file implements the OpenMPIRBuilder class, which is used as a</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">/// convenient way to create LLVM instructions for OpenMP directives.</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/frontend/include/llvm/frontend/openmp/ompirbuilder-h">llvm/Frontend/OpenMP/OMPIRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallbitvector-h">llvm/ADT/SmallBitVector.h</a>&quot;</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallset-h">llvm/ADT/SmallSet.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stringextras-h">llvm/ADT/StringExtras.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h">llvm/ADT/StringRef.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h">llvm/Analysis/AssumptionCache.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/codemetrics-h">llvm/Analysis/CodeMetrics.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h">llvm/Analysis/LoopInfo.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h">llvm/Analysis/ScalarEvolution.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/bitcode/bitcodereader-h">llvm/Bitcode/BitcodeReader.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/frontend/include/llvm/frontend/offloading/utility-h">llvm/Frontend/Offloading/Utility.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/frontend/include/llvm/frontend/openmp/ompgridvalues-h">llvm/Frontend/OpenMP/OMPGridValues.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h">llvm/IR/Attributes.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h">llvm/IR/CFG.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/callingconv-h">llvm/IR/CallingConv.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h">llvm/IR/DIBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h">llvm/IR/DebugInfoMetadata.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h">llvm/IR/GlobalVariable.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h">llvm/IR/MDBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h">llvm/IR/Metadata.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/passinstrumentation-h">llvm/IR/PassInstrumentation.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h">llvm/IR/PassManager.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/replaceconstant-h">llvm/IR/ReplaceConstant.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/mc/targetregistry-h">llvm/MC/TargetRegistry.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/filesystem-h">llvm/Support/FileSystem.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h">llvm/Target/TargetMachine.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h">llvm/Target/TargetOptions.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/cloning-h">llvm/Transforms/Utils/Cloning.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/codeextractor-h">llvm/Transforms/Utils/CodeExtractor.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looppeel-h">llvm/Transforms/Utils/LoopPeel.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/unrollloop-h">llvm/Transforms/Utils/UnrollLoop.h</a>&quot;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &lt;cstdint&gt;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &lt;optional&gt;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;openmp-ir-builder&quot;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/omp">omp</a>;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69" lineLink="#ac7b0d6b394df409e7550fb21aa7d9e5c"><span class="doxyHighlight">    <a href="#ac7b0d6b394df409e7550fb21aa7d9e5c">OptimisticAttributes</a>(</span><span class="doxyHighlightStringLiteral">&quot;openmp-ir-builder-optimistic-attributes&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">                         <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Use optimistic attributes describing &quot;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlight">                                  </span><span class="doxyHighlightStringLiteral">&quot;&#39;as-if&#39; properties of runtime calls.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlight">                         <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74" lineLink="#a87dfce8f7ae9d7942d55ac782438dbf8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;double&gt;</a> <a href="#a87dfce8f7ae9d7942d55ac782438dbf8">UnrollThresholdFactor</a>(</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;openmp-ir-builder-unroll-threshold-factor&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Factor for the unroll threshold to account for code &quot;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;simplifications still taking place&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(1.5));</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightComment">/// Return whether IP1 and IP2 are ambiguous, i.e. that inserting instructions</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightComment">/// at position IP1 may change the meaning of IP2 or vice-versa. This is because</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightComment">/// an InsertPoint stores the instruction before something is inserted. For</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightComment">/// instance, if both point to the same instruction, two IRBuilders alternating</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightComment">/// creating instruction will cause the instructions to be interleaved.</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86" lineLink="#a756b28f370cd5a39bc0ee3e5333b9c9b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a756b28f370cd5a39bc0ee3e5333b9c9b">isConflictIP</a>(<a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;::InsertPoint</a> IP1,</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;::InsertPoint</a> IP2) &#123;</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IP1.isSet() || !IP2.isSet())</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IP1.getBlock() == IP2.getBlock() &amp;&amp; IP1.getPoint() == IP2.getPoint();</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93" lineLink="#a596dcc3bb2ae8b7561e94095584e0f1e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a596dcc3bb2ae8b7561e94095584e0f1e">isValidWorkshareLoopScheduleType</a>(<a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> SchedType) &#123;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Valid ordered/unordered and base algorithm combinations.</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (SchedType &amp; ~OMPScheduleType::MonotonicityMask) &#123;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedStaticChunked:</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedStatic:</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedDynamicChunked:</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedGuidedChunked:</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedRuntime:</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedAuto:</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedTrapezoidal:</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedGreedy:</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedBalanced:</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedGuidedIterativeChunked:</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedGuidedAnalyticalChunked:</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedSteal:</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedStaticBalancedChunked:</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedGuidedSimd:</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::UnorderedRuntimeSimd:</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::OrderedStaticChunked:</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::OrderedStatic:</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::OrderedDynamicChunked:</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::OrderedGuidedChunked:</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::OrderedRuntime:</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::OrderedAuto:</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::OrderdTrapezoidal:</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeUnorderedStaticChunked:</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeUnorderedStatic:</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeUnorderedDynamicChunked:</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeUnorderedGuidedChunked:</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeUnorderedRuntime:</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeUnorderedAuto:</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeUnorderedTrapezoidal:</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeUnorderedGreedy:</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeUnorderedBalanced:</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeUnorderedGuidedIterativeChunked:</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeUnorderedGuidedAnalyticalChunked:</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeUnorderedSteal:</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeOrderedStaticChunked:</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeOrderedStatic:</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeOrderedDynamicChunked:</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeOrderedGuidedChunked:</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeOrderedRuntime:</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeOrderedAuto:</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::NomergeOrderedTrapezoidal:</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Must not set both monotonicity modifiers at the same time.</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> MonotonicityFlags =</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">      SchedType &amp; OMPScheduleType::MonotonicityMask;</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MonotonicityFlags == OMPScheduleType::MonotonicityMask)</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152" lineLink="#ad52342fdd467389643191fdac7abcd40"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/omp/gv">omp::GV</a> &amp;<a href="#ad52342fdd467389643191fdac7abcd40">getGridValue</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/triple">Triple</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>) &#123;</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>.isAMDGPU()) &#123;</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/stringref">StringRef</a> Features =</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>-&gt;getFnAttribute(</span><span class="doxyHighlightStringLiteral">&quot;target-features&quot;</span><span class="doxyHighlight">).getValueAsString();</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Features.<a href="/docs/api/classes/llvm/stringref/#ac2c31b7b3c778d12aa176f9253511f37">count</a>(</span><span class="doxyHighlightStringLiteral">&quot;+wavefrontsize64&quot;</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/omp/#a54d82933792ec7eef3f24eb847c6acd9">omp::getAMDGPUGridValues&lt;64&gt;</a>();</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/omp/#a54d82933792ec7eef3f24eb847c6acd9">omp::getAMDGPUGridValues&lt;32&gt;</a>();</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>.isNVPTX())</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/omp/#a82196e4d5e3224c1cdd60f16e40af476">omp::NVPTXGridValues</a>;</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;No grid value available for this architecture!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlightComment">/// Determine which scheduling algorithm to use, determined from schedule clause</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlightComment">/// arguments.</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a></span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168" lineLink="#a065b0b31e5ca4c10b1cef45581efb8dc"><span class="doxyHighlight"><a href="#a065b0b31e5ca4c10b1cef45581efb8dc">getOpenMPBaseScheduleType</a>(llvm::omp::ScheduleKind ClauseKind, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasChunks,</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasSimdModifier) &#123;</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Currently, the default schedule it static.</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (ClauseKind) &#123;</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMP&#95;SCHEDULE&#95;Default:</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMP&#95;SCHEDULE&#95;Static:</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> HasChunks ? OMPScheduleType::BaseStaticChunked</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">                     : OMPScheduleType::BaseStatic;</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMP&#95;SCHEDULE&#95;Dynamic:</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPScheduleType::BaseDynamicChunked;</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMP&#95;SCHEDULE&#95;Guided:</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> HasSimdModifier ? OMPScheduleType::BaseGuidedSimd</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">                           : OMPScheduleType::BaseGuidedChunked;</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMP&#95;SCHEDULE&#95;Auto:</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7a377f624764cdf5386a71e8efa9a1033d">llvm::omp::OMPScheduleType::BaseAuto</a>;</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMP&#95;SCHEDULE&#95;Runtime:</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> HasSimdModifier ? OMPScheduleType::BaseRuntimeSimd</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">                           : OMPScheduleType::BaseRuntime;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;unhandled schedule clause argument&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlightComment">/// Adds ordering modifier flags to schedule type.</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a></span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192" lineLink="#a4a87dd5af95eb64807ad77405e4f4654"><span class="doxyHighlight"><a href="#a4a87dd5af95eb64807ad77405e4f4654">getOpenMPOrderingScheduleType</a>(<a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> BaseScheduleType,</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">                              </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasOrderedClause) &#123;</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((BaseScheduleType &amp; OMPScheduleType::ModifierMask) ==</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">             OMPScheduleType::None &amp;&amp;</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Must not have ordering nor monotonicity flags already set&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> OrderingModifier = HasOrderedClause</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">                                         ? OMPScheduleType::ModifierOrdered</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">                                         : OMPScheduleType::ModifierUnordered;</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> OrderingScheduleType = BaseScheduleType | OrderingModifier;</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Unsupported combinations</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OrderingScheduleType ==</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">      (OMPScheduleType::BaseGuidedSimd | OMPScheduleType::ModifierOrdered))</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPScheduleType::OrderedGuidedChunked;</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OrderingScheduleType == (OMPScheduleType::BaseRuntimeSimd |</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">                                    OMPScheduleType::ModifierOrdered))</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPScheduleType::OrderedRuntime;</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OrderingScheduleType;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlightComment">/// Adds monotonicity modifier flags to schedule type.</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a></span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216" lineLink="#a4b64de5bc0d090cc76ddb989acabf0f3"><span class="doxyHighlight"><a href="#a4b64de5bc0d090cc76ddb989acabf0f3">getOpenMPMonotonicityScheduleType</a>(<a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> ScheduleType,</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasSimdModifier, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasMonotonic,</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasNonmonotonic, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasOrderedClause) &#123;</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((ScheduleType &amp; OMPScheduleType::MonotonicityMask) ==</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">             OMPScheduleType::None &amp;&amp;</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Must not have monotonicity flags already set&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!HasMonotonic || !HasNonmonotonic) &amp;&amp;</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Monotonic and Nonmonotonic are contradicting each other&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasMonotonic) &#123;</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ScheduleType | OMPScheduleType::ModifierMonotonic;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasNonmonotonic) &#123;</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ScheduleType | OMPScheduleType::ModifierNonmonotonic;</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// OpenMP 5.1, 2.11.4 Worksharing-Loop Construct, Description.</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the static schedule kind is specified or if the ordered clause is</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// specified, and if the nonmonotonic modifier is not specified, the</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// effect is as if the monotonic modifier is specified. Otherwise, unless</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the monotonic modifier is specified, the effect is as if the</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// nonmonotonic modifier is specified.</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> BaseScheduleType =</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">        ScheduleType &amp; <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">~OMPScheduleType</a><a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7a4aabfa64277fa15805937e3812fa1161">::ModifierMask</a>;</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((BaseScheduleType == OMPScheduleType::BaseStatic) ||</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">        (BaseScheduleType == OMPScheduleType::BaseStaticChunked) ||</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">        HasOrderedClause) &#123;</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The monotonic is used by default in openmp runtime library, so no need</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to set it.</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ScheduleType;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ScheduleType | OMPScheduleType::ModifierNonmonotonic;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlightComment">/// Determine the schedule type using schedule and ordering clause arguments.</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a></span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252" lineLink="#a554000c782275642b783964853720bee"><span class="doxyHighlight"><a href="#a554000c782275642b783964853720bee">computeOpenMPScheduleType</a>(ScheduleKind ClauseKind, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasChunks,</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasSimdModifier, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasMonotonicModifier,</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">                          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasNonmonotonicModifier, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasOrderedClause) &#123;</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> BaseSchedule =</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">      <a href="#a065b0b31e5ca4c10b1cef45581efb8dc">getOpenMPBaseScheduleType</a>(ClauseKind, HasChunks, HasSimdModifier);</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> OrderedSchedule =</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">      <a href="#a4a87dd5af95eb64807ad77405e4f4654">getOpenMPOrderingScheduleType</a>(BaseSchedule, HasOrderedClause);</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> Result = <a href="#a4b64de5bc0d090cc76ddb989acabf0f3">getOpenMPMonotonicityScheduleType</a>(</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">      OrderedSchedule, HasSimdModifier, HasMonotonicModifier,</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">      HasNonmonotonicModifier, HasOrderedClause);</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#a596dcc3bb2ae8b7561e94095584e0f1e">isValidWorkshareLoopScheduleType</a>(Result));</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlightComment">/// Emit an implicit cast to convert \\p XRead to type of variable \\p V</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268" lineLink="#a91b7eb2a05d10c788413bec7977f3474"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;<a href="#a91b7eb2a05d10c788413bec7977f3474">emitImplicitCast</a>(<a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder, <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;XRead,</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Add this functionality to the &#96;AtomicInfo&#96; interface</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">llvm::Type</a> &#42;XReadType = XRead-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">llvm::Type</a> &#42;VType = V-&gt;getType();</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/allocainst">llvm::AllocaInst</a> &#42;vAlloca = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;llvm::AllocaInst&gt;</a>(V))</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">    VType = vAlloca-&gt;getAllocatedType();</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XReadType-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>() &amp;&amp; VType-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>())</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// No need to extract or convert. A direct</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#96;store&#96; will suffice.</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> XRead;</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XReadType-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>())</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">    XRead = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a41cf66866b0b0e5a10038bfb77477419">CreateExtractValue</a>(XRead, </span><span class="doxyHighlightComment">/&#42;Idxs=&#42;/</span><span class="doxyHighlight">0);</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VType-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; XReadType-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>())</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">    XRead = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#afd0b5a07710757874fa84076969537b0">CreateFPToSI</a>(XRead, VType);</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VType-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>() &amp;&amp; XReadType-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>())</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    XRead = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a2e19b7738daed96724457c786521e5e1">CreateSIToFP</a>(XRead, VType);</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VType-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; XReadType-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>())</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">    XRead = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac79ca3c2d2d74cf33684397a91846564">CreateIntCast</a>(XRead, VType, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VType-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>() &amp;&amp; XReadType-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>())</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">    XRead = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a85da0abb1e43779210427c14a9bd9311">CreateFPCast</a>(XRead, VType);</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> XRead;</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlightComment">/// Make \\p Source branch to \\p Target.</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlightComment">/// Handles two situations:</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlightComment">/// &#42; \\p Source already has an unconditional branch.</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlightComment">/// &#42; \\p Source is a degenerate block (no terminator because the BB is</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlightComment">///             the current head of the IR construction).</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300" lineLink="#a3057c2b7e1e25de160497b1ef3985c2a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Source, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/target">Target</a>, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Term = Source-&gt;getTerminator()) &#123;</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Br = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Term);</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Br-&gt;isConditional() &amp;&amp;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;BB&#39;s terminator must be an unconditional branch (or degenerate)&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ = Br-&gt;getSuccessor(0);</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">    Succ-&gt;<a href="/docs/api/classes/llvm/basicblock/#afe7af0c3ec2ef1f525173acd2ea4ba60">removePredecessor</a>(Source, </span><span class="doxyHighlightComment">/&#42;KeepOneInputPHIs=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">    Br-&gt;setSuccessor(0, <a href="/docs/api/classes/llvm/target">Target</a>);</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewBr = <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(<a href="/docs/api/classes/llvm/target">Target</a>, Source);</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">  NewBr-&gt;setDebugLoc(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315" lineLink="/docs/api/namespaces/llvm/#a78e14f66d8a8405c6882b5ff6a3b7617"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a78e14f66d8a8405c6882b5ff6a3b7617">llvm::spliceBB</a>(<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint">IRBuilderBase::InsertPoint</a> IP, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;New,</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CreateBranch) &#123;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(New-&gt;getFirstInsertionPt() == New-&gt;begin() &amp;&amp;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Target BB must not have PHI nodes&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Move instructions to new block.</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Old = IP.<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint/#a3d072f8ac5e1b0724c4bb5a77adae9da">getBlock</a>();</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">  New-&gt;splice(New-&gt;begin(), Old, IP.<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint/#add3c04c7d2a93c82846f7bea3ce2fe16">getPoint</a>(), Old-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CreateBranch)</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(New, Old);</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328" lineLink="/docs/api/namespaces/llvm/#afae3b747fc0c20f869df931130c534fa"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a78e14f66d8a8405c6882b5ff6a3b7617">llvm::spliceBB</a>(<a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;New, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CreateBranch) &#123;</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a90a3242eeb2a7d1afbb5ab5bc5bfb20d">getCurrentDebugLocation</a>();</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Old = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a78e14f66d8a8405c6882b5ff6a3b7617">spliceBB</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), New, CreateBranch);</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CreateBranch)</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Old-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Old);</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SetInsertPoint also updates the Builder&#39;s debug location, but we want to</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// keep the one the Builder was configured to use.</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a>);</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343" lineLink="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">llvm::splitBB</a>(<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint">IRBuilderBase::InsertPoint</a> IP, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CreateBranch,</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/twine">llvm::Twine</a> Name) &#123;</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Old = IP.<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint/#a3d072f8ac5e1b0724c4bb5a77adae9da">getBlock</a>();</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;New = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">      Old-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), Name.isTriviallyEmpty() ? Old-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() : Name,</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">      Old-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), Old-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>());</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a78e14f66d8a8405c6882b5ff6a3b7617">spliceBB</a>(IP, New, CreateBranch);</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">  New-&gt;replaceSuccessorsPhiUsesWith(Old, New);</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> New;</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354" lineLink="/docs/api/namespaces/llvm/#a7e8bd8939aed271b684b21231da918ee"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">llvm::splitBB</a>(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CreateBranch,</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/twine">llvm::Twine</a> Name) &#123;</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a90a3242eeb2a7d1afbb5ab5bc5bfb20d">getCurrentDebugLocation</a>();</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;New = <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), CreateBranch, Name);</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CreateBranch)</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>());</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SetInsertPoint also updates the Builder&#39;s debug location, but we want to</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// keep the one the Builder was configured to use.</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a>);</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> New;</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368" lineLink="/docs/api/namespaces/llvm/#a2522258b740c5c76b6f9354663773c7c"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">llvm::splitBB</a>(<a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CreateBranch,</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/twine">llvm::Twine</a> Name) &#123;</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a90a3242eeb2a7d1afbb5ab5bc5bfb20d">getCurrentDebugLocation</a>();</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;New = <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), CreateBranch, Name);</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CreateBranch)</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>());</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SetInsertPoint also updates the Builder&#39;s debug location, but we want to</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// keep the one the Builder was configured to use.</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a>);</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> New;</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382" lineLink="/docs/api/namespaces/llvm/#a03f30f48490558525cd5458201d13afe"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#a03f30f48490558525cd5458201d13afe">llvm::splitBBWithSuffix</a>(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CreateBranch,</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/twine">llvm::Twine</a> Suffix) &#123;</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Old = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, CreateBranch, Old-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + Suffix);</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlightComment">// This function creates a fake integer value and a fake use for the integer</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlightComment">// value. It returns the fake value created. This is useful in modeling the</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlightComment">// extra arguments to the outlined functions.</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391" lineLink="#a35409dbaffc2cf38fefec12e3cf9094d"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a35409dbaffc2cf38fefec12e3cf9094d">createFakeIntVal</a>(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder,</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> OuterAllocaIP,</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/smallvectorimpl">llvm::SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;ToBeDeleted,</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> InnerAllocaIP,</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name = </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AsPtr = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(OuterAllocaIP);</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;FakeVal;</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;FakeValAddr =</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, Name + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">  ToBeDeleted.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FakeValAddr);</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AsPtr) &#123;</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">    FakeVal = FakeValAddr;</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">    FakeVal =</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), FakeValAddr, Name + </span><span class="doxyHighlightStringLiteral">&quot;.val&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">    ToBeDeleted.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FakeVal);</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate a fake use of this value</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(InnerAllocaIP);</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseFakeVal;</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AsPtr) &#123;</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">    UseFakeVal =</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), FakeVal, Name + </span><span class="doxyHighlightStringLiteral">&quot;.use&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">    UseFakeVal =</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(FakeVal, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(10)));</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">  ToBeDeleted.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(UseFakeVal);</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FakeVal;</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlightComment">// OpenMPIRBuilderConfig</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428" lineLink="/docs/api/namespaces/anonymous-ompirbuilder-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429" lineLink="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a5b6a7e92a601fa5fffd86f5d29df35fa"><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/#a344add483f0f71ecd426dd6c2d471e99">LLVM&#95;ENABLE&#95;BITMASK&#95;ENUMS&#95;IN&#95;NAMESPACE</a>();</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlightComment">/// Values for bit flags for marking which requires clauses have been used.</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431" lineLink="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59"><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59">OpenMPOffloadingRequiresDirFlags</a> &#123;</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlightComment">  /// flag undefined.</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433" lineLink="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59a7972c62027157095f27334a175046ec8"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59a7972c62027157095f27334a175046ec8">OMP&#95;REQ&#95;UNDEFINED</a> = 0x000,</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlightComment">  /// no requires directive present.</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435" lineLink="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59a133a116519cf4d083bd62fe903222233"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59a133a116519cf4d083bd62fe903222233">OMP&#95;REQ&#95;NONE</a> = 0x001,</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlightComment">  /// reverse&#95;offload clause.</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437" lineLink="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59a9fc383d39ee53daf5acd732e83f612ac"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59a9fc383d39ee53daf5acd732e83f612ac">OMP&#95;REQ&#95;REVERSE&#95;OFFLOAD</a> = 0x002,</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlightComment">  /// unified&#95;address clause.</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439" lineLink="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59adea434f369cc7e932a9a8a6794cf4d30"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59adea434f369cc7e932a9a8a6794cf4d30">OMP&#95;REQ&#95;UNIFIED&#95;ADDRESS</a> = 0x004,</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlightComment">  /// unified&#95;shared&#95;memory clause.</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441" lineLink="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59a181e4e34f98a2ff557a47da8eba82652"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59a181e4e34f98a2ff557a47da8eba82652">OMP&#95;REQ&#95;UNIFIED&#95;SHARED&#95;MEMORY</a> = 0x008,</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlightComment">  /// dynamic&#95;allocators clause.</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443" lineLink="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59ae27c8208560d202db5844b7de3667d76"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59ae27c8208560d202db5844b7de3667d76">OMP&#95;REQ&#95;DYNAMIC&#95;ALLOCATORS</a> = 0x010,</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a9db8c44b250b90e3ab7e4d144e7c9c2eaab882f7771b12a605e94c8abb12db9cf">LLVM&#95;MARK&#95;AS&#95;BITMASK&#95;ENUM</a>(</span><span class="doxyHighlightComment">/&#42;LargestValue=&#42;/</span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59ae27c8208560d202db5844b7de3667d76">OMP&#95;REQ&#95;DYNAMIC&#95;ALLOCATORS</a>)</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// anonymous namespace</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449" lineLink="/docs/api/classes/llvm/openmpirbuilderconfig/#a700297913ed317f4442b189b1efdd454"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a700297913ed317f4442b189b1efdd454">OpenMPIRBuilderConfig::OpenMPIRBuilderConfig</a>()</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">    : RequiresFlags(<a href="/docs/api/namespaces/anonymous-ompirbuilder-cpp-/#a6c4c036b1f33a03ce42152b5eb9c3f59a7972c62027157095f27334a175046ec8">OMP&#95;REQ&#95;UNDEFINED</a>) &#123;&#125;</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452" lineLink="/docs/api/classes/llvm/openmpirbuilderconfig/#a3940df3db367cce0bfbe2aaae338b2d3"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a700297913ed317f4442b189b1efdd454">OpenMPIRBuilderConfig::OpenMPIRBuilderConfig</a>(</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a22e985ea690b791910dc19186b63cc37">IsTargetDevice</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a24001aad64c43839eee308e15ad21166">IsGPU</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a467a56dc1fad02dbb0540d9b7d68faa6">OpenMPOffloadMandatory</a>,</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasRequiresReverseOffload, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasRequiresUnifiedAddress,</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasRequiresUnifiedSharedMemory, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasRequiresDynamicAllocators)</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">    : <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a22e985ea690b791910dc19186b63cc37">IsTargetDevice</a>(<a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a22e985ea690b791910dc19186b63cc37">IsTargetDevice</a>), <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a24001aad64c43839eee308e15ad21166">IsGPU</a>(<a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a24001aad64c43839eee308e15ad21166">IsGPU</a>),</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a467a56dc1fad02dbb0540d9b7d68faa6">OpenMPOffloadMandatory</a>(<a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a467a56dc1fad02dbb0540d9b7d68faa6">OpenMPOffloadMandatory</a>),</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">      RequiresFlags(OMP&#95;REQ&#95;UNDEFINED) &#123;</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasRequiresReverseOffload)</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">    RequiresFlags |= OMP&#95;REQ&#95;REVERSE&#95;OFFLOAD;</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasRequiresUnifiedAddress)</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">    RequiresFlags |= OMP&#95;REQ&#95;UNIFIED&#95;ADDRESS;</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasRequiresUnifiedSharedMemory)</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">    RequiresFlags |= OMP&#95;REQ&#95;UNIFIED&#95;SHARED&#95;MEMORY;</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasRequiresDynamicAllocators)</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">    RequiresFlags |= OMP&#95;REQ&#95;DYNAMIC&#95;ALLOCATORS;</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469" lineLink="/docs/api/classes/llvm/openmpirbuilderconfig/#af53cf29288858444e087718f5f8cb089"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#af53cf29288858444e087718f5f8cb089">OpenMPIRBuilderConfig::hasRequiresReverseOffload</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RequiresFlags &amp; OMP&#95;REQ&#95;REVERSE&#95;OFFLOAD;</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473" lineLink="/docs/api/classes/llvm/openmpirbuilderconfig/#af5ab024ecdc82f9f43003f49fbc63821"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#af5ab024ecdc82f9f43003f49fbc63821">OpenMPIRBuilderConfig::hasRequiresUnifiedAddress</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RequiresFlags &amp; OMP&#95;REQ&#95;UNIFIED&#95;ADDRESS;</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477" lineLink="/docs/api/classes/llvm/openmpirbuilderconfig/#a8004b86f0e2c956fbdba73021821cae7"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a8004b86f0e2c956fbdba73021821cae7">OpenMPIRBuilderConfig::hasRequiresUnifiedSharedMemory</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RequiresFlags &amp; OMP&#95;REQ&#95;UNIFIED&#95;SHARED&#95;MEMORY;</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481" lineLink="/docs/api/classes/llvm/openmpirbuilderconfig/#a8f00d1b04fd6cec310f24bd50fbe7f93"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a8f00d1b04fd6cec310f24bd50fbe7f93">OpenMPIRBuilderConfig::hasRequiresDynamicAllocators</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RequiresFlags &amp; OMP&#95;REQ&#95;DYNAMIC&#95;ALLOCATORS;</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485" lineLink="/docs/api/classes/llvm/openmpirbuilderconfig/#a3550c2ca911ccadf62de0b831a8d51f2"><span class="doxyHighlight">int64&#95;t <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a3550c2ca911ccadf62de0b831a8d51f2">OpenMPIRBuilderConfig::getRequiresFlags</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#af555ff2fc75e765e341217f0c531e3f2">hasRequiresFlags</a>() ? RequiresFlags</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">                            : </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">int64&#95;t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(OMP&#95;REQ&#95;NONE);</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490" lineLink="/docs/api/classes/llvm/openmpirbuilderconfig/#a5d46c8aef9772e3f5a8897b48f0bc818"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a5d46c8aef9772e3f5a8897b48f0bc818">OpenMPIRBuilderConfig::setHasRequiresReverseOffload</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a>) &#123;</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a>)</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">    RequiresFlags |= OMP&#95;REQ&#95;REVERSE&#95;OFFLOAD;</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">    RequiresFlags &amp;= ~OMP&#95;REQ&#95;REVERSE&#95;OFFLOAD;</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497" lineLink="/docs/api/classes/llvm/openmpirbuilderconfig/#a97578e61977a91c51a3482a5964e7259"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a97578e61977a91c51a3482a5964e7259">OpenMPIRBuilderConfig::setHasRequiresUnifiedAddress</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a>) &#123;</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a>)</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">    RequiresFlags |= OMP&#95;REQ&#95;UNIFIED&#95;ADDRESS;</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">    RequiresFlags &amp;= ~OMP&#95;REQ&#95;UNIFIED&#95;ADDRESS;</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504" lineLink="/docs/api/classes/llvm/openmpirbuilderconfig/#a842f04d6d6f5a942d28b0fd26b6b17a8"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#a842f04d6d6f5a942d28b0fd26b6b17a8">OpenMPIRBuilderConfig::setHasRequiresUnifiedSharedMemory</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a>) &#123;</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a>)</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">    RequiresFlags |= OMP&#95;REQ&#95;UNIFIED&#95;SHARED&#95;MEMORY;</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">    RequiresFlags &amp;= ~OMP&#95;REQ&#95;UNIFIED&#95;SHARED&#95;MEMORY;</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511" lineLink="/docs/api/classes/llvm/openmpirbuilderconfig/#adc9e390779faa4da74c5176a945b2afe"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilderconfig/#adc9e390779faa4da74c5176a945b2afe">OpenMPIRBuilderConfig::setHasRequiresDynamicAllocators</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a>) &#123;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a>)</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">    RequiresFlags |= OMP&#95;REQ&#95;DYNAMIC&#95;ALLOCATORS;</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">    RequiresFlags &amp;= ~OMP&#95;REQ&#95;DYNAMIC&#95;ALLOCATORS;</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlightComment">// OpenMPIRBuilder</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::getKernelArgsVector(TargetKernelArgs &amp;KernelArgs,</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder,</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> &amp;ArgsVector) &#123;</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a689a023f54d38d41f6d952cac41ee538">Version</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/frontend/include/llvm/frontend/openmp/ompconstants-h/#a893a8cf8f1e26701b29719386c42c9a7">OMP&#95;KERNEL&#95;ARG&#95;VERSION</a>);</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;PointerNum = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(KernelArgs.NumTargetItems);</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a23f9ec4bb2576ca8738f3edc9c4f5cdf">Int32Ty</a> = <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>());</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">constexpr</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> MaxDim = 3;</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ZeroArray = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(<a href="/docs/api/namespaces/llvm/#a23f9ec4bb2576ca8738f3edc9c4f5cdf">Int32Ty</a>, MaxDim));</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Flags = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(KernelArgs.HasNoWait);</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!KernelArgs.NumTeams.empty() &amp;&amp; !KernelArgs.NumThreads.empty());</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumTeams3D =</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a20833e358e38f9a86074bb4cc72b0d14">CreateInsertValue</a>(ZeroArray, KernelArgs.NumTeams&#91;0&#93;, &#123;0&#125;);</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumThreads3D =</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a20833e358e38f9a86074bb4cc72b0d14">CreateInsertValue</a>(ZeroArray, KernelArgs.NumThreads&#91;0&#93;, &#123;0&#125;);</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> :</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">       <a href="/docs/api/namespaces/llvm/#adc4eb8be6f7a12ede962987fb9cabb47">seq&lt;unsigned&gt;</a>(1, std::min(KernelArgs.NumTeams.size(), MaxDim)))</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">    NumTeams3D =</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a20833e358e38f9a86074bb4cc72b0d14">CreateInsertValue</a>(NumTeams3D, KernelArgs.NumTeams&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;, &#123;I&#125;);</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> :</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">       <a href="/docs/api/namespaces/llvm/#adc4eb8be6f7a12ede962987fb9cabb47">seq&lt;unsigned&gt;</a>(1, std::min(KernelArgs.NumThreads.size(), MaxDim)))</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">    NumThreads3D =</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a20833e358e38f9a86074bb4cc72b0d14">CreateInsertValue</a>(NumThreads3D, KernelArgs.NumThreads&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;, &#123;I&#125;);</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">  ArgsVector = &#123;<a href="/docs/api/namespaces/llvm/#a689a023f54d38d41f6d952cac41ee538">Version</a>,</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">                PointerNum,</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">                KernelArgs.RTArgs.BasePointersArray,</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">                KernelArgs.RTArgs.PointersArray,</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">                KernelArgs.RTArgs.SizesArray,</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">                KernelArgs.RTArgs.MapTypesArray,</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">                KernelArgs.RTArgs.MapNamesArray,</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">                KernelArgs.RTArgs.MappersArray,</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">                KernelArgs.NumIterations,</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">                Flags,</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">                NumTeams3D,</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">                NumThreads3D,</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">                KernelArgs.DynCGGroupMem&#125;;</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a50c6490cf353f064946c4e32673ac098"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#a50c6490cf353f064946c4e32673ac098">OpenMPIRBuilder::addAttributes</a>(<a href="/docs/api/namespaces/llvm/omp/#a4c503140c7f851151906d85b515330e9">omp::RuntimeFunction</a> FnID, <a href="/docs/api/classes/llvm/function">Function</a> &amp;Fn) &#123;</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = Fn.<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>();</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the function&#39;s current attributes.</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Attrs = Fn.<a href="/docs/api/classes/llvm/function/#a7477aafbbe989ad35b96fac186d8e9fd">getAttributes</a>();</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FnAttrs = Attrs.getFnAttrs();</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RetAttrs = Attrs.getRetAttrs();</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;AttributeSet, 4&gt;</a> ArgAttrs;</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> ArgNo = 0; ArgNo &lt; Fn.<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>(); ++ArgNo)</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">    ArgAttrs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Attrs.getParamAttrs(ArgNo));</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add AS to FnAS while taking special care with integer extensions.</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> addAttrSet = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/attributeset">AttributeSet</a> &amp;FnAS, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/attributeset">AttributeSet</a> &amp;AS,</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Param = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) -&gt; </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasSignExt = AS.hasAttribute(Attribute::SExt);</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasZeroExt = AS.hasAttribute(Attribute::ZExt);</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasSignExt || HasZeroExt) &#123;</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AS.getNumAttributes() == 1 &amp;&amp;</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Currently not handling extension attr combined with others.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Param) &#123;</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AK = TargetLibraryInfo::getExtAttrForI32Param(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, HasSignExt))</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">          FnAS = FnAS.<a href="/docs/api/classes/llvm/attributeset/#af2b9418751d1f1f1b99e5b05d0ed7efa">addAttribute</a>(Ctx, AK);</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AK =</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">                     TargetLibraryInfo::getExtAttrForI32Return(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, HasSignExt))</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">        FnAS = FnAS.<a href="/docs/api/classes/llvm/attributeset/#af2b9418751d1f1f1b99e5b05d0ed7efa">addAttribute</a>(Ctx, AK);</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">      FnAS = FnAS.<a href="/docs/api/classes/llvm/attributeset/#a46f189c4026ace551d70a16566e641b1">addAttributes</a>(Ctx, AS);</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlightPreprocessor">#define OMP&#95;ATTRS&#95;SET(VarName, AttrSet) AttributeSet VarName = AttrSet;</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlightPreprocessor">#include &quot;llvm/Frontend/OpenMP/OMPKinds.def&quot;</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add attributes to the function declaration.</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (FnID) &#123;</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlightPreprocessor">#define OMP&#95;RTL&#95;ATTRS(Enum, FnAttrSet, RetAttrSet, ArgAttrSets)                \\</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlightPreprocessor">  case Enum:                                                                   \\</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlightPreprocessor">    FnAttrs = FnAttrs.addAttributes(Ctx, FnAttrSet);                           \\</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlightPreprocessor">    addAttrSet(RetAttrs, RetAttrSet, </span><span class="doxyHighlightComment">/&#42;Param&#42;/</span><span class="doxyHighlightPreprocessor"> false);                         \\</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlightPreprocessor">    for (size&#95;t ArgNo = 0; ArgNo &lt; ArgAttrSets.size(); ++ArgNo)                \\</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlightPreprocessor">      addAttrSet(ArgAttrs&#91;ArgNo&#93;, ArgAttrSets&#91;ArgNo&#93;);                         \\</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlightPreprocessor">    Fn.setAttributes(AttributeList::get(Ctx, FnAttrs, RetAttrs, ArgAttrs));    \\</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlightPreprocessor">    break;</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlightPreprocessor">#include &quot;llvm/Frontend/OpenMP/OMPKinds.def&quot;</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Attributes are optional.</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a></span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">OpenMPIRBuilder::getOrCreateRuntimeFunction(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/namespaces/llvm/omp/#a4c503140c7f851151906d85b515330e9">RuntimeFunction</a> FnID) &#123;</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;FnTy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Fn = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to find the declation in the module first.</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (FnID) &#123;</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlightPreprocessor">#define OMP&#95;RTL(Enum, Str, IsVarArg, ReturnType, ...)                          \\</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlightPreprocessor">  case Enum:                                                                   \\</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlightPreprocessor">    FnTy = FunctionType::get(ReturnType, ArrayRef&lt;Type &#42;&gt;&#123;&#95;&#95;VA&#95;ARGS&#95;&#95;&#125;,        \\</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlightPreprocessor">                             IsVarArg);                                        \\</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlightPreprocessor">    Fn = M.getFunction(Str);                                                   \\</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlightPreprocessor">    break;</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlightPreprocessor">#include &quot;llvm/Frontend/OpenMP/OMPKinds.def&quot;</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Fn) &#123;</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a new declaration if we need one.</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (FnID) &#123;</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlightPreprocessor">#define OMP&#95;RTL(Enum, Str, ...)                                                \\</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlightPreprocessor">  case Enum:                                                                   \\</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlightPreprocessor">    Fn = Function::Create(FnTy, GlobalValue::ExternalLinkage, Str, M);         \\</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlightPreprocessor">    break;</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlightPreprocessor">#include &quot;llvm/Frontend/OpenMP/OMPKinds.def&quot;</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add information if the runtime function takes a callback function</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FnID == OMPRTL&#95;&#95;&#95;kmpc&#95;fork&#95;call || FnID == OMPRTL&#95;&#95;&#95;kmpc&#95;fork&#95;teams) &#123;</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Fn-&gt;<a href="/docs/api/classes/llvm/globalobject/#a1f496e54accb2cbe919fb456cb703f1a">hasMetadata</a>(LLVMContext::MD&#95;callback)) &#123;</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">        LLVMContext &amp;Ctx = Fn-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>();</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">        MDBuilder MDB(Ctx);</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Annotate the callback behavior of the runtime function:</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//  - The callback callee is argument number 2 (microtask).</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//  - The first two arguments of the callback callee are unknown (-1).</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//  - All variadic arguments to the runtime function are passed to the</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//    callback callee.</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">        Fn-&gt;<a href="/docs/api/classes/llvm/globalobject/#aa1b0638c63ba711320b3bb9c69367ed6">addMetadata</a>(</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">            LLVMContext::MD&#95;callback,</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">            &#42;<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, &#123;MDB.createCallbackEncoding(</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">                                  2, &#123;-1, -1&#125;, </span><span class="doxyHighlightComment">/&#42; VarArgsArePassed &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)&#125;));</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Created OpenMP runtime function &quot;</span><span class="doxyHighlight"> &lt;&lt; Fn-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with type &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Fn-&gt;<a href="/docs/api/classes/llvm/function/#a21075305f0e463b24aafc2fb99514ace">getFunctionType</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#a50c6490cf353f064946c4e32673ac098">addAttributes</a>(FnID, &#42;Fn);</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Found OpenMP runtime function &quot;</span><span class="doxyHighlight"> &lt;&lt; Fn-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with type &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Fn-&gt;<a href="/docs/api/classes/llvm/function/#a21075305f0e463b24aafc2fb99514ace">getFunctionType</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Fn &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Failed to create OpenMP runtime function&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;FnTy, Fn&#125;;</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/function">Function</a> &#42;OpenMPIRBuilder::getOrCreateRuntimeFunctionPtr(<a href="/docs/api/namespaces/llvm/omp/#a4c503140c7f851151906d85b515330e9">RuntimeFunction</a> FnID) &#123;</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">  FunctionCallee RTLFn = getOrCreateRuntimeFunction(M, FnID);</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Fn = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;llvm::Function&gt;</a>(RTLFn.<a href="/docs/api/classes/llvm/functioncallee/#ac5d8da677233fa2e1e7039508ed56e0e">getCallee</a>());</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Fn &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Failed to create OpenMP runtime function pointer&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Fn;</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a1af99f6f33b0db83a3e941fcb819fa29"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#a1af99f6f33b0db83a3e941fcb819fa29">OpenMPIRBuilder::initialize</a>() &#123; initializeTypes(M); &#125;</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678" lineLink="#a6e4c46869d9d198562f7b8628814e407"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a6e4c46869d9d198562f7b8628814e407">raiseUserConstantDataAllocasToEntryBlock</a>(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder,</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/classes/llvm/function">Function</a>) &#123;</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;EntryBlock = <a href="/docs/api/classes/llvm/function">Function</a>-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>();</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> MoveLocInst = EntryBlock.<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>();</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loop over blocks looking for constant allocas, skipping the entry block</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as any allocas there are already in the desired location.</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> = std::next(<a href="/docs/api/classes/llvm/function">Function</a>-&gt;<a href="/docs/api/classes/llvm/function/#a88a5e60837674780a9d812d661897ac5">begin</a>(), 1); <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> != <a href="/docs/api/classes/llvm/function">Function</a>-&gt;<a href="/docs/api/classes/llvm/function/#ae4ca2261b8b901e415fda7feac5051ea">end</a>();</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">       <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>++) &#123;</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Inst = <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>-&gt;getReverseIterator()-&gt;begin();</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">         Inst != <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>-&gt;getReverseIterator()-&gt;end();) &#123;</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> = <a href="/docs/api/namespaces/llvm/#a3377eac88526e806d9d887c4a0ba2a73">dyn&#95;cast&#95;if&#95;present&lt;llvm::AllocaInst&gt;</a>(Inst)) &#123;</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">        Inst++;</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantData&gt;</a>(<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a>-&gt;<a href="/docs/api/classes/llvm/allocainst/#af4283a4cef4e2b88f565d827d5857e14">getArraySize</a>()))</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a>-&gt;<a href="/docs/api/classes/llvm/instruction/#ae3c2accff1fc7b0c4fc5ab15915573af">moveBeforePreserving</a>(MoveLocInst);</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">        Inst++;</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a784adc2347b72f745ff1239aef3a3c26"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#a784adc2347b72f745ff1239aef3a3c26">OpenMPIRBuilder::finalize</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;Fn) &#123;</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 32&gt;</a> ParallelRegionBlockSet;</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 32&gt;</a> Blocks;</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;OutlineInfo, 16&gt;</a> DeferredOutlines;</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (OutlineInfo &amp;OI : OutlineInfos) &#123;</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip functions that have not finalized yet; may happen with nested</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// function generation.</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Fn &amp;&amp; OI.<a href="/docs/api/classes/llvm/function/#a8743c58384e11cb6228f6f871304ad35">getFunction</a>() != Fn) &#123;</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">      DeferredOutlines.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OI);</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">    ParallelRegionBlockSet.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a16413f1a88d8baca228d0a1b4cc0bfc6">clear</a>();</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">    Blocks.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">    OI.collectBlocks(ParallelRegionBlockSet, Blocks);</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;OuterFn = OI.<a href="/docs/api/classes/llvm/function/#a8743c58384e11cb6228f6f871304ad35">getFunction</a>();</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/codeextractoranalysiscache">CodeExtractorAnalysisCache</a> CEAC(&#42;OuterFn);</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we generate code for the target device, we need to allocate</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// struct for aggregate params in the device default alloca address space.</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// OpenMP runtime requires that the params of the extracted functions are</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// passed as zero address space pointers. This flag ensures that</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// CodeExtractor generates correct code for extracted functions</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// which are used by OpenMP runtime.</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ArgsInZeroAddressSpace = Config.isTargetDevice();</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a> Extractor(Blocks, </span><span class="doxyHighlightComment">/&#42; DominatorTree &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">/&#42; AggregateArgs &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">/&#42; BlockFrequencyInfo &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">/&#42; BranchProbabilityInfo &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">/&#42; AssumptionCache &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">/&#42; AllowVarArgs &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">/&#42; AllowAlloca &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">/&#42; AllocaBlock&#42;/</span><span class="doxyHighlight"> OI.OuterAllocaBB,</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">/&#42; Suffix &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;.omp&#95;par&quot;</span><span class="doxyHighlight">, ArgsInZeroAddressSpace);</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Before     outlining: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OuterFn &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Entry &quot;</span><span class="doxyHighlight"> &lt;&lt; OI.EntryBB-&gt;getName()</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; Exit: &quot;</span><span class="doxyHighlight"> &lt;&lt; OI.ExitBB-&gt;getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Extractor.isEligible() &amp;&amp;</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Expected OpenMP outlining to be possible!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;V : OI.ExcludeArgsFromAggregate)</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">      Extractor.excludeArgFromAggregate(V);</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;OutlinedFn = Extractor.extractCodeRegion(CEAC);</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Forward target-cpu, target-features attributes to the outlined function.</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TargetCpuAttr = OuterFn-&gt;<a href="/docs/api/classes/llvm/function/#a4c319db4fe05c27cfe55bd133a87414d">getFnAttribute</a>(</span><span class="doxyHighlightStringLiteral">&quot;target-cpu&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TargetCpuAttr.isStringAttribute())</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">      OutlinedFn-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(TargetCpuAttr);</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TargetFeaturesAttr = OuterFn-&gt;<a href="/docs/api/classes/llvm/function/#a4c319db4fe05c27cfe55bd133a87414d">getFnAttribute</a>(</span><span class="doxyHighlightStringLiteral">&quot;target-features&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TargetFeaturesAttr.isStringAttribute())</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">      OutlinedFn-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(TargetFeaturesAttr);</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;After      outlining: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OuterFn &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;   Outlined function: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OutlinedFn &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFn-&gt;<a href="/docs/api/classes/llvm/function/#acdd05db170cbfee8a0fcbc047b8504e5">getReturnType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;OpenMP outlined functions should not return a value!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For compability with the clang CG we move the outlined function after the</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// one with the parallel region.</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">    OutlinedFn-&gt;<a href="/docs/api/classes/llvm/function/#a29e0a562beb4b5d20eb0c426b363ceed">removeFromParent</a>();</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">    M.getFunctionList().insertAfter(OuterFn-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), OutlinedFn);</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remove the artificial entry introduced by the extractor right away, we</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// made our own entry block after all.</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">    &#123;</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;ArtificialEntry = OutlinedFn-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>();</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ArtificialEntry.<a href="/docs/api/classes/llvm/basicblock/#a57f1945911ca1e95d0f51d7c3516b529">getUniqueSuccessor</a>() == OI.EntryBB);</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OI.EntryBB-&gt;getUniquePredecessor() == &amp;ArtificialEntry);</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Move instructions from the to-be-deleted ArtificialEntry to the entry</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// basic block of the parallel region. CodeExtractor generates</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instructions to unwrap the aggregate argument and may sink</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// allocas/bitcasts for values that are solely used in the outlined region</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// and do not escape.</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!ArtificialEntry.<a href="/docs/api/classes/llvm/basicblock/#a266367eb01c634406b32f816d2d9c6bf">empty</a>() &amp;&amp;</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Expected instructions to add in the outlined region entry&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a6d3231fb84ed4182ec22e9442a87dbf8">BasicBlock::reverse&#95;iterator</a> It = ArtificialEntry.<a href="/docs/api/classes/llvm/basicblock/#a1c2af7a9e501d399f06ca7e10eef46e4">rbegin</a>(),</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">                                        End = ArtificialEntry.<a href="/docs/api/classes/llvm/basicblock/#a9237251072bf6816163abc2d053212ee">rend</a>();</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">           It != End;) &#123;</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = &#42;It;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">        It++;</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isTerminator())</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.moveBeforePreserving(&#42;OI.EntryBB, OI.EntryBB-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">      OI.EntryBB-&gt;moveBefore(&amp;ArtificialEntry);</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">      ArtificialEntry.<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&amp;OutlinedFn-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>() == OI.EntryBB);</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFn &amp;&amp; OutlinedFn-&gt;<a href="/docs/api/classes/llvm/value/#aba0055050d741f60b6e0523507a2c79f">getNumUses</a>() == 1);</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Run a user callback, e.g. to add attributes.</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OI.PostOutlineCB)</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">      OI.PostOutlineCB(&#42;OutlinedFn);</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove work items that have been completed.</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">  OutlineInfos = std::move(DeferredOutlines);</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The createTarget functions embeds user written code into</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the target region which may inject allocas which need to</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be moved to the entry block of our target or risk malformed</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimisations by later passes, this is only relevant for</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the device pass which appears to be a little more delicate</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// when it comes to optimisations (however, we do not block on</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that here, it&#39;s up to the inserter to the list to do so).</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This notbaly has to occur after the OutlinedInfo candidates</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have been extracted so we have an end product that will not</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be implicitly adversely affected by any raises unless</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// intentionally appended to the list.</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NOTE: This only does so for ConstantData, it could be extended</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to ConstantExpr&#39;s with further effort, however, they should</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// largely be folded when they get here. Extending it to runtime</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// defined/read+writeable allocation sizes would be non-trivial</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (need to factor in movement of any stores to variables the</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allocation size depends on, as well as the usual loads,</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// otherwise it&#39;ll yield the wrong result after movement) and</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// likely be more suitable as an LLVM optimisation pass.</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : ConstantAllocaRaiseCandidates)</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">    <a href="#a6e4c46869d9d198562f7b8628814e407">raiseUserConstantDataAllocasToEntryBlock</a>(Builder, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">  EmitMetadataErrorReportFunctionTy &amp;&amp;ErrorReportFn =</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">      &#91;&#93;(EmitMetadataErrorKind Kind,</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">         </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> &amp;EntryInfo) -&gt; </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Error of kind: &quot;</span><span class="doxyHighlight"> &lt;&lt; Kind</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; when emitting offload entries and metadata during &quot;</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">              </span><span class="doxyHighlightStringLiteral">&quot;OMPIRBuilder finalization \\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OffloadInfoManager.empty())</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">    createOffloadEntriesAndInfoMetadata(ErrorReportFn);</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Config.EmitLLVMUsedMetaInfo.value&#95;or(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">    std::vector&lt;WeakTrackingVH&gt; LLVMCompilerUsed = &#123;</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">        M.getGlobalVariable(</span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;openmp&#95;nvptx&#95;data&#95;transfer&#95;temporary&#95;storage&quot;</span><span class="doxyHighlight">)&#125;;</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">    emitUsed(</span><span class="doxyHighlightStringLiteral">&quot;llvm.compiler.used&quot;</span><span class="doxyHighlight">, LLVMCompilerUsed);</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845" lineLink="/docs/api/classes/llvm/openmpirbuilder/#ad66949e2e846451e61d9c8f34014ea31"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#ad66949e2e846451e61d9c8f34014ea31">OpenMPIRBuilder::~OpenMPIRBuilder</a>() &#123;</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlineInfos.empty() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There must be no outstanding outlinings&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;OpenMPIRBuilder::createGlobalFlag(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a>, <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name) &#123;</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;I32Ty = <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(M.getContext());</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/structs/llvm/omp/gv">GV</a> =</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(M, I32Ty,</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">                         </span><span class="doxyHighlightComment">/&#42; isConstant = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca696bb1c9b0b0e76bb70c61f68866452a">GlobalValue::WeakODRLinkage</a>,</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">                         ConstantInt::get(I32Ty, <a href="/docs/api/classes/llvm/value">Value</a>), Name);</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/omp/gv">GV</a>-&gt;setVisibility(<a href="/docs/api/classes/llvm/globalvalue/#a9141f967188383108a69cc1b8ed3c195a7eade123587a08e674f2ca72e2443771">GlobalValue::HiddenVisibility</a>);</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/omp/gv">GV</a>;</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitUsed(<a href="/docs/api/classes/llvm/stringref">StringRef</a> Name, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;WeakTrackingVH&gt;</a> List) &#123;</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (List.empty())</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convert List to what ConstantArray needs.</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;, 8&gt;</a> UsedArray;</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">  UsedArray.<a href="/docs/api/classes/llvm/smallvectorimpl/#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(List.size());</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = List.size(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">    UsedArray&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = <a href="/docs/api/classes/llvm/constantexpr/#a28bf8984fbfb08fd27df435e631e6832">ConstantExpr::getPointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(&amp;&#42;List&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;), Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedArray.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">  <a href="/docs/api/classes/arraytype">ArrayType</a> &#42;ATy = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), UsedArray.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/structs/llvm/omp/gv">GV</a> = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(M, ATy, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca96ad6314ba9210b223b93dc3e15baf99">GlobalValue::AppendingLinkage</a>,</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/constantarray/#a0900dacdc7ad8e3ea0cc92993c7fd422">ConstantArray::get</a>(ATy, UsedArray), Name);</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/omp/gv">GV</a>-&gt;setSection(</span><span class="doxyHighlightStringLiteral">&quot;llvm.metadata&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">OpenMPIRBuilder::emitKernelExecutionMode(<a href="/docs/api/classes/llvm/stringref">StringRef</a> KernelName,</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">                                         <a href="/docs/api/namespaces/llvm/omp/#aa0c0d79dafb0d22308ce48808689f430">OMPTgtExecModeFlags</a> <a href="/docs/api/files/lib/lib/codegen/regallocevictionadvisor-cpp/#aef71c4b21823f236e70cc6d62375adcd">Mode</a>) &#123;</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Int8Ty = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7be2e1490f01c049d748436f03760c5">getInt8Ty</a>();</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;GVMode = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> GlobalVariable(</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">      M, Int8Ty, </span><span class="doxyHighlightComment">/&#42;isConstant=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca8d13a9bcecfac72febceb1103afa048f">GlobalValue::WeakAnyLinkage</a>,</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">      ConstantInt::get(Int8Ty, <a href="/docs/api/files/lib/lib/codegen/regallocevictionadvisor-cpp/#aef71c4b21823f236e70cc6d62375adcd">Mode</a>), Twine(KernelName, </span><span class="doxyHighlightStringLiteral">&quot;&#95;exec&#95;mode&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">  GVMode-&gt;setVisibility(<a href="/docs/api/classes/llvm/globalvalue/#a9141f967188383108a69cc1b8ed3c195ae1cc9a390520055573d459de25747caa">GlobalVariable::ProtectedVisibility</a>);</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> GVMode;</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;OpenMPIRBuilder::getOrCreateIdent(<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SrcLocStr,</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">                                            uint32&#95;t SrcLocStrSize,</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">                                            <a href="/docs/api/namespaces/llvm/omp/#a0e821d8251c97d66ca185efe2f8ffde2">IdentFlag</a> LocFlags,</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">                                            </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Reserve2Flags) &#123;</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Enable &quot;C-mode&quot;.</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">  LocFlags |= OMP&#95;IDENT&#95;FLAG&#95;KMPC;</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;&amp;Ident =</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">      IdentMap&#91;&#123;SrcLocStr, uint64&#95;t(LocFlags) &lt;&lt; 31 | Reserve2Flags&#125;&#93;;</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Ident) &#123;</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;I32Null = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">ConstantInt::getNullValue</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>);</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;IdentData&#91;&#93; = &#123;I32Null,</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">                             ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, uint32&#95;t(LocFlags)),</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">                             ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, Reserve2Flags),</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">                             ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, SrcLocStrSize), SrcLocStr&#125;;</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;Initializer =</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constantstruct/#a54fcfa620deb80373f489ba2fdad7643">ConstantStruct::get</a>(OpenMPIRBuilder::Ident, IdentData);</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Look for existing encoding of the location + flags, not needed but</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// minimizes the difference to the existing solution while we transition.</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (GlobalVariable &amp;GV : <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.globals())</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GV.getValueType() == OpenMPIRBuilder::Ident &amp;&amp; GV.hasInitializer())</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GV.getInitializer() == Initializer)</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">          Ident = &amp;GV;</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Ident) &#123;</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;GV = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> GlobalVariable(</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">          M, OpenMPIRBuilder::Ident,</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">/&#42; isConstant = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca04ed141708c0fd16723d212502b046ae">GlobalValue::PrivateLinkage</a>, Initializer, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0">GlobalValue::NotThreadLocal</a>,</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getDefaultGlobalsAddressSpace());</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">      GV-&gt;setUnnamedAddr(<a href="/docs/api/classes/llvm/globalvalue/#ae8df4be75bfc50b1eadd74e85c25fa45a4cc6684df7b4a92b1dec6fce3264fac8">GlobalValue::UnnamedAddr::Global</a>);</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">      GV-&gt;setAlignment(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a>(8));</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">      Ident = GV;</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantexpr/#a28bf8984fbfb08fd27df435e631e6832">ConstantExpr::getPointerBitCastOrAddrSpaceCast</a>(Ident, IdentPtr);</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;OpenMPIRBuilder::getOrCreateSrcLocStr(<a href="/docs/api/classes/llvm/stringref">StringRef</a> LocStr,</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">                                                uint32&#95;t &amp;SrcLocStrSize) &#123;</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">  SrcLocStrSize = LocStr.<a href="/docs/api/classes/llvm/stringref/#a5db9240c74644c67759dd0f901fc3c7d">size</a>();</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;&amp;SrcLocStr = SrcLocStrMap&#91;LocStr&#93;;</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SrcLocStr) &#123;</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;Initializer =</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constantdataarray/#a3edef3fa47c611d3d10606591213e57b">ConstantDataArray::getString</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), LocStr);</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Look for existing encoding of the location, not needed but minimizes the</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// difference to the existing solution while we transition.</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (GlobalVariable &amp;GV : <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.globals())</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GV.isConstant() &amp;&amp; GV.hasInitializer() &amp;&amp;</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">          GV.getInitializer() == Initializer)</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SrcLocStr = <a href="/docs/api/classes/llvm/constantexpr/#a1f469b1f703519ae25ce564c8704310f">ConstantExpr::getPointerCast</a>(&amp;GV, Int8Ptr);</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">    SrcLocStr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#af377188a476a2d71184b0498a136fd1d">CreateGlobalString</a>(LocStr, </span><span class="doxyHighlightComment">/&#42; Name &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">                                           </span><span class="doxyHighlightComment">/&#42; AddressSpace &#42;/</span><span class="doxyHighlight"> 0, &amp;M);</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SrcLocStr;</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;OpenMPIRBuilder::getOrCreateSrcLocStr(<a href="/docs/api/classes/llvm/stringref">StringRef</a> FunctionName,</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/stringref">StringRef</a> FileName,</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">                                                </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Line, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Column,</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">                                                uint32&#95;t &amp;SrcLocStrSize) &#123;</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">  SmallString&lt;128&gt; Buffer;</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">  Buffer.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span><span class="doxyHighlightCharLiteral">&#39;;&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">  Buffer.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(FileName);</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">  Buffer.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span><span class="doxyHighlightCharLiteral">&#39;;&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">  Buffer.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(FunctionName);</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">  Buffer.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span><span class="doxyHighlightCharLiteral">&#39;;&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">  Buffer.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(std::to&#95;string(Line));</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">  Buffer.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span><span class="doxyHighlightCharLiteral">&#39;;&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">  Buffer.<a href="/docs/api/classes/llvm/smallstring/#ac22cf1a1c08b7ccaefc51508536312a4">append</a>(std::to&#95;string(Column));</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">  Buffer.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span><span class="doxyHighlightCharLiteral">&#39;;&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">  Buffer.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span><span class="doxyHighlightCharLiteral">&#39;;&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> getOrCreateSrcLocStr(Buffer.<a href="/docs/api/classes/llvm/smallstring/#af5dd7241878be5eed07736eb156bb10b">str</a>(), SrcLocStrSize);</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">OpenMPIRBuilder::getOrCreateDefaultSrcLocStr(uint32&#95;t &amp;SrcLocStrSize) &#123;</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">  StringRef UnknownLoc = </span><span class="doxyHighlightStringLiteral">&quot;;unknown;unknown;0;0;;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> getOrCreateSrcLocStr(UnknownLoc, SrcLocStrSize);</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;OpenMPIRBuilder::getOrCreateSrcLocStr(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">                                                uint32&#95;t &amp;SrcLocStrSize,</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">  DILocation &#42;DIL = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.get();</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DIL)</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> getOrCreateDefaultSrcLocStr(SrcLocStrSize);</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">  StringRef FileName = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getName();</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DIFile &#42;DIF = DIL-&gt;getFile())</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::optional&lt;StringRef&gt; Source = DIF-&gt;getSource())</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">      FileName = &#42;<a href="/docs/api/namespaces/llvm/sched/#ab8d854a5ce2331586bcc6830cca52f0fac13545a6345c7d5b3c9cc8932ad3b0e9">Source</a>;</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">  StringRef <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> = DIL-&gt;getScope()-&gt;getSubprogram()-&gt;getName();</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a>.empty() &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName();</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> getOrCreateSrcLocStr(Function, FileName, DIL-&gt;getLine(),</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">                              DIL-&gt;getColumn(), SrcLocStrSize);</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;OpenMPIRBuilder::getOrCreateSrcLocStr(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">                                                uint32&#95;t &amp;SrcLocStrSize) &#123;</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> getOrCreateSrcLocStr(Loc.DL, SrcLocStrSize,</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">                              Loc.IP.getBlock()-&gt;getParent());</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;OpenMPIRBuilder::getOrCreateThreadID(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident) &#123;</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">      getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;global&#95;thread&#95;num), Ident,</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;global&#95;thread&#95;num&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a></span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007" lineLink="/docs/api/classes/llvm/openmpirbuilder/#abca6530c9099bd1b1c3e0a5c32381f07"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#abca6530c9099bd1b1c3e0a5c32381f07">OpenMPIRBuilder::createBarrier</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/classes/llvm/directive">Directive</a> Kind,</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ForceSimpleCall, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CheckCancelFlag) &#123;</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP;</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build call &#95;&#95;kmpc&#95;cancel&#95;barrier(loc, thread&#95;id) or</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//            &#95;&#95;kmpc&#95;barrier(loc, thread&#95;id);</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a0e821d8251c97d66ca185efe2f8ffde2">IdentFlag</a> BarrierLocFlags;</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Kind) &#123;</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPD&#95;for:</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">    BarrierLocFlags = OMP&#95;IDENT&#95;FLAG&#95;BARRIER&#95;IMPL&#95;FOR;</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPD&#95;sections:</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">    BarrierLocFlags = OMP&#95;IDENT&#95;FLAG&#95;BARRIER&#95;IMPL&#95;SECTIONS;</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPD&#95;single:</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">    BarrierLocFlags = OMP&#95;IDENT&#95;FLAG&#95;BARRIER&#95;IMPL&#95;SINGLE;</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPD&#95;barrier:</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">    BarrierLocFlags = OMP&#95;IDENT&#95;FLAG&#95;BARRIER&#95;EXPL;</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">    BarrierLocFlags = OMP&#95;IDENT&#95;FLAG&#95;BARRIER&#95;IMPL;</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, SrcLocStrSize);</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Args&#91;&#93; = &#123;</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">      getOrCreateIdent(SrcLocStr, SrcLocStrSize, BarrierLocFlags),</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">      getOrCreateThreadID(getOrCreateIdent(SrcLocStr, SrcLocStrSize))&#125;;</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are in a cancellable parallel region, barriers are cancellation</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// points.</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Check why we would force simple calls or to ignore the cancel flag.</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseCancelBarrier =</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">      !ForceSimpleCall &amp;&amp; isLastFinalizationInfoCancellable(OMPD&#95;parallel);</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Result =</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">                             UseCancelBarrier ? OMPRTL&#95;&#95;&#95;kmpc&#95;cancel&#95;barrier</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">                                              : OMPRTL&#95;&#95;&#95;kmpc&#95;barrier),</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">                         Args);</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseCancelBarrier &amp;&amp; CheckCancelFlag)</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/error">Error</a> Err = emitCancelationCheckImpl(Result, OMPD&#95;parallel))</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a></span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a04285415a321e48322c08f3b9185540e"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#a04285415a321e48322c08f3b9185540e">OpenMPIRBuilder::createCancel</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/value">Value</a> &#42;IfCondition,</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">                              omp::Directive CanceledDirective) &#123;</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP;</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LLVM utilities like blocks with terminators.</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a39acc29443d48968a798fb22a76fa4c0">CreateUnreachable</a>();</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ThenTI = UI, &#42;ElseTI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfCondition)</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7ac00229d8c59902686f52ed061cdc80">SplitBlockAndInsertIfThenElse</a>(IfCondition, UI, &amp;ThenTI, &amp;ElseTI);</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ThenTI);</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CancelKind = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (CanceledDirective) &#123;</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlightPreprocessor">#define OMP&#95;CANCEL&#95;KIND(Enum, Str, DirectiveEnum, Value)                       \\</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlightPreprocessor">  case DirectiveEnum:                                                          \\</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlightPreprocessor">    CancelKind = Builder.getInt32(Value);                                      \\</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlightPreprocessor">    break;</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlightPreprocessor">#include &quot;llvm/Frontend/OpenMP/OMPKinds.def&quot;</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unknown cancel kind!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, SrcLocStrSize);</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Args&#91;&#93; = &#123;Ident, getOrCreateThreadID(Ident), CancelKind&#125;;</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Result = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">      getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;cancel), Args);</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ExitCB = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, CanceledDirective, <a href="/docs/api/namespaces/llvm/loc">Loc</a>&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> IP) -&gt; <a href="/docs/api/classes/llvm/error">Error</a> &#123;</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CanceledDirective == OMPD&#95;parallel) &#123;</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/irbuilderbase/insertpointguard">IRBuilder&lt;&gt;::InsertPointGuard</a> IPG(Builder);</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(IP);</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#abca6530c9099bd1b1c3e0a5c32381f07">createBarrier</a>(<a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), <a href="/docs/api/namespaces/llvm/loc">Loc</a>.DL),</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">                           omp::Directive::OMPD&#95;unknown,</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">                           </span><span class="doxyHighlightComment">/&#42; ForceSimpleCall &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">                           </span><span class="doxyHighlightComment">/&#42; CheckCancelFlag &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/expected/#a94789df4ebd03dc008e8adebaa66ac1f">takeError</a>();</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The actual cancel logic is shared with others, e.g., cancel&#95;barriers.</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/error">Error</a> Err = emitCancelationCheckImpl(Result, CanceledDirective, ExitCB))</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the insertion point and remove the terminator we introduced.</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(UI-&gt;getParent());</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">  UI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> OpenMPIRBuilder::emitTargetKernel(</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, InsertPointTy AllocaIP, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;Return,</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident, <a href="/docs/api/classes/llvm/value">Value</a> &#42;DeviceID, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumTeams, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumThreads,</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;HostPtr, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value &#42;&gt;</a> KernelArgs) &#123;</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP;</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;KernelArgsPtr =</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(OpenMPIRBuilder::KernelArgs, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;kernel&#95;args&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP);</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = KernelArgs.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;Arg =</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e95ff363c20e1f51b673230538e10fd">CreateStructGEP</a>(OpenMPIRBuilder::KernelArgs, KernelArgsPtr, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">        KernelArgs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;, Arg,</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">        M.getDataLayout().getPrefTypeAlign(KernelArgs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;-&gt;getType()));</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> OffloadingArgs&#123;Ident,      DeviceID, NumTeams,</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">                                      NumThreads, HostPtr,  KernelArgsPtr&#125;;</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a5416d9f1bd5f533efddadf17d713e469">Return</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">      getOrCreateRuntimeFunction(M, OMPRTL&#95;&#95;&#95;tgt&#95;target&#95;kernel),</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">      OffloadingArgs);</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> OpenMPIRBuilder::emitKernelLaunch(</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;OutlinedFnID,</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">    EmitFallbackCallbackTy EmitTargetCallFallbackCB, TargetKernelArgs &amp;Args,</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;DeviceID, <a href="/docs/api/classes/llvm/value">Value</a> &#42;RTLoc, InsertPointTy AllocaIP) &#123;</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Loc.IP;</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(Loc.IP);</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// On top of the arrays that were filled up, the target offloading call</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// takes as arguments the device id as well as the host pointer. The host</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pointer is used by the runtime library to identify the current target</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// region, so it only has to be unique and not necessarily point to</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// anything. It could be the pointer to the outlined function that</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// implements the target region, but we aren&#39;t using that so that the</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// compiler doesn&#39;t need to keep that, and could therefore inline the host</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function if proven worthwhile during optimization.</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// From this point on, we need to have an ID of the target region defined.</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFnID &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Invalid outlined function ID!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">  (void)OutlinedFnID;</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return value of the runtime offloading call.</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a5416d9f1bd5f533efddadf17d713e469">Return</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Arguments for the target kernel.</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">  SmallVector&lt;Value &#42;&gt; ArgsVector;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">  getKernelArgsVector(Args, Builder, ArgsVector);</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The target region is an outlined function launched by the runtime</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// via calls to &#95;&#95;tgt&#95;target&#95;kernel().</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that on the host and CPU targets, the runtime implementation of</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// these calls simply call the outlined function without forking threads.</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The outlined functions themselves have runtime calls to</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#95;&#95;kmpc&#95;fork&#95;teams() and &#95;&#95;kmpc&#95;fork() for this purpose, codegen&#39;d by</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the compiler in emitTeamsCall() and emitParallelCall().</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In contrast, on the NVPTX target, the implementation of</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#95;&#95;tgt&#95;target&#95;teams() launches a GPU kernel with the requested number</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of teams and threads so no additional calls to the runtime are required.</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check the error code and execute the host version if required.</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(emitTargetKernel(</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">      Builder, AllocaIP, Return, RTLoc, DeviceID, <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>.NumTeams.front(),</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>.NumThreads.front(), OutlinedFnID, ArgsVector));</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;OffloadFailedBlock =</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;offload.failed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;OffloadContBlock =</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;offload.cont&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a2cd7b2e49608a96ba42f59f642cf99ac">Failed</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aafd864f39fd28e235eea03ae424ab8e0">CreateIsNotNull</a>(Return);</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(<a href="/docs/api/namespaces/llvm/#a2cd7b2e49608a96ba42f59f642cf99ac">Failed</a>, OffloadFailedBlock, OffloadContBlock);</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CurFn = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">  emitBlock(OffloadFailedBlock, CurFn);</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP = EmitTargetCallFallbackCB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>());</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#42;AfterIP);</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">  emitBranch(OffloadContBlock);</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">  emitBlock(OffloadContBlock, CurFn, </span><span class="doxyHighlightComment">/&#42;IsFinished=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/error">Error</a> OpenMPIRBuilder::emitCancelationCheckImpl(</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CancelFlag, omp::Directive CanceledDirective,</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">    FinalizeCallbackTy ExitCB) &#123;</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(isLastFinalizationInfoCancellable(CanceledDirective) &amp;&amp;</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected cancellation!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For a cancel barrier we create two new blocks.</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;BB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;NonCancellationBlock;</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e5c1b91bf5e2860398e3fa35c96b5af">GetInsertPoint</a>() == BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()) &#123;</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: This branch will not be needed once we moved to the</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// OpenMPIRBuilder codegen completely.</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">    NonCancellationBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">        BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.cont&quot;</span><span class="doxyHighlight">, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">    NonCancellationBlock = <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(BB, &amp;&#42;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e5c1b91bf5e2860398e3fa35c96b5af">GetInsertPoint</a>());</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">    BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(BB);</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CancellationBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">      BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.cncl&quot;</span><span class="doxyHighlight">, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Jump to them based on the return value.</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac9843b4f9f9cb144c608c48785a394a8">CreateIsNull</a>(CancelFlag);</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(Cmp, NonCancellationBlock, CancellationBlock,</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">                       </span><span class="doxyHighlightComment">/&#42; TODO weight &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// From the cancellation block we finalize all variables and go to the</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// post finalization block that is known to the FiniCB callback.</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(CancellationBlock);</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExitCB)</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = ExitCB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>()))</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;FI = FinalizationStack.back();</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = FI.FiniCB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>()))</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The continuation block is where code generation continues.</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(NonCancellationBlock, NonCancellationBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlightComment">// Callback used to create OpenMP runtime calls to support</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlightComment">// omp parallel clause for the device.</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlightComment">// We need to use this callback to replace call to the OutlinedFn in OuterFn</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlightComment">// by the call to the OpenMP DeviceRTL runtime function (kmpc&#95;parallel&#95;51)</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255" lineLink="#af7668ce8080668a4f0ceac24e70c9f00"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#af7668ce8080668a4f0ceac24e70c9f00">targetParallelCallback</a>(</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &#42;OMPIRBuilder, <a href="/docs/api/classes/llvm/function">Function</a> &amp;OutlinedFn, <a href="/docs/api/classes/llvm/function">Function</a> &#42;OuterFn,</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OuterAllocaBB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident, <a href="/docs/api/classes/llvm/value">Value</a> &#42;IfCondition,</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumThreads, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PrivTID, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;PrivTIDAddr,</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ThreadID, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> &amp;ToBeDeleted) &#123;</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add some known attributes.</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder = OMPIRBuilder-&gt;Builder;</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">  OutlinedFn.<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(0, Attribute::NoAlias);</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">  OutlinedFn.<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(1, Attribute::NoAlias);</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">  OutlinedFn.<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(0, Attribute::NoUndef);</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">  OutlinedFn.<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(1, Attribute::NoUndef);</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">  OutlinedFn.<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(Attribute::NoUnwind);</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFn.<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() &gt;= 2 &amp;&amp;</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected at least tid and bounded tid as arguments&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumCapturedVars = OutlinedFn.<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() - </span><span class="doxyHighlightComment">/&#42; tid &amp; bounded tid &#42;/</span><span class="doxyHighlight"> 2;</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(OutlinedFn.<a href="/docs/api/classes/llvm/value/#a46db903db2484e1ef5062d094d6b0854">user&#95;back</a>());</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CI &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected call instruction to outlined function&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">  CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;setName(</span><span class="doxyHighlightStringLiteral">&quot;omp&#95;parallel&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(CI);</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;PtrTy = OMPIRBuilder-&gt;VoidPtr;</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NullPtrValue = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(PtrTy);</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add alloca for kernel args</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">  OpenMPIRBuilder ::InsertPointTy CurrentIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(OuterAllocaBB, OuterAllocaBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;ArgsAlloca =</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(<a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(PtrTy, NumCapturedVars));</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Args = ArgsAlloca;</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add address space cast if array for storing arguments is not allocated</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in address space 0</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgsAlloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#ad2fb148dfac3182fce33be95fc4e9159">getAddressSpace</a>())</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">    Args = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3ef26a11123d639b64307cc3c1b869b9">CreatePointerCast</a>(ArgsAlloca, PtrTy);</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CurrentIP);</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Store captured vars which are used by kmpc&#95;parallel&#95;51</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0; Idx &lt; NumCapturedVars; Idx++) &#123;</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = &#42;(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a4fb513d744ca72275932b2c7003f16f6">arg&#95;begin</a>() + 2 + Idx);</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;StoreAddress = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa8ee5dc4e4a1b26c4bdf1a574eefe2fc">CreateConstInBoundsGEP2&#95;64</a>(</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(PtrTy, NumCapturedVars), Args, 0, Idx);</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(V, StoreAddress);</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> =</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">      IfCondition ? Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aeb11a01107c6be1f52ba01902a165d71">CreateSExtOrTrunc</a>(IfCondition, OMPIRBuilder-&gt;Int32)</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">                  : Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(1);</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build kmpc&#95;parallel&#95;51 call</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Parallel51CallArgs&#91;&#93; = &#123;</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; identifier&#42;/</span><span class="doxyHighlight"> Ident,</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; global thread num&#42;/</span><span class="doxyHighlight"> ThreadID,</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; if expression &#42;/</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>,</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; number of threads &#42;/</span><span class="doxyHighlight"> NumThreads ? NumThreads : Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(-1),</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; Proc bind &#42;/</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(-1),</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; outlined function &#42;/</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(&amp;OutlinedFn, OMPIRBuilder-&gt;ParallelTaskPtr),</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; wrapper function &#42;/</span><span class="doxyHighlight"> NullPtrValue,</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; arguments of the outlined funciton&#42;/</span><span class="doxyHighlight"> Args,</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; number of arguments &#42;/</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(NumCapturedVars)&#125;;</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a> RTLFn =</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">      OMPIRBuilder-&gt;getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;parallel&#95;51);</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(RTLFn, Parallel51CallArgs);</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;With kmpc&#95;parallel&#95;51 placed: &quot;</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">                    &lt;&lt; &#42;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Initialize the local TID stack location with the argument value.</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(PrivTID);</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function/#a1c9f2f058966db1f8ca270398bda8362">Function::arg&#95;iterator</a> OutlinedAI = OutlinedFn.<a href="/docs/api/classes/llvm/function/#a8bf193a781a92cae52d7f9216d0824f8">arg&#95;begin</a>();</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(OMPIRBuilder-&gt;Int32, OutlinedAI),</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">                      PrivTIDAddr);</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove redundant call to the outlined function.</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">  CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : ToBeDeleted) &#123;</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlightComment">// Callback used to create OpenMP runtime calls to support</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlightComment">// omp parallel clause for the host.</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlightComment">// We need to use this callback to replace call to the OutlinedFn in OuterFn</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlightComment">// by the call to the OpenMP host runtime function ( &#95;&#95;kmpc&#95;fork&#95;call&#91;&#95;if&#93;)</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344" lineLink="#afffa0ff2e1527ab545cef33be915c656"><span class="doxyHighlight"><a href="#afffa0ff2e1527ab545cef33be915c656">hostParallelCallback</a>(<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &#42;OMPIRBuilder, <a href="/docs/api/classes/llvm/function">Function</a> &amp;OutlinedFn,</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/function">Function</a> &#42;OuterFn, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident, <a href="/docs/api/classes/llvm/value">Value</a> &#42;IfCondition,</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PrivTID, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;PrivTIDAddr,</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> &amp;ToBeDeleted) &#123;</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder = OMPIRBuilder-&gt;Builder;</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a> RTLFn;</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfCondition) &#123;</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">    RTLFn =</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">        OMPIRBuilder-&gt;getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;fork&#95;call&#95;if);</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">    RTLFn =</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">        OMPIRBuilder-&gt;getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;fork&#95;call);</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Function&gt;</a>(RTLFn.<a href="/docs/api/classes/llvm/functioncallee/#ac5d8da677233fa2e1e7039508ed56e0e">getCallee</a>())) &#123;</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasMetadata(LLVMContext::MD&#95;callback)) &#123;</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext();</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/mdbuilder">MDBuilder</a> MDB(Ctx);</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Annotate the callback behavior of the &#95;&#95;kmpc&#95;fork&#95;call:</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  - The callback callee is argument number 2 (microtask).</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  - The first two arguments of the callback callee are unknown (-1).</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  - All variadic arguments to the &#95;&#95;kmpc&#95;fork&#95;call are passed to the</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//    callback callee.</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;addMetadata(LLVMContext::MD&#95;callback,</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">                     &#42;<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, &#123;MDB.<a href="/docs/api/classes/llvm/mdbuilder/#a1d51e11adfffd05afe252d3398f50d4e">createCallbackEncoding</a>(</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">                                           2, &#123;-1, -1&#125;,</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">                                           </span><span class="doxyHighlightComment">/&#42; VarArgsArePassed &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)&#125;));</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add some known attributes.</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">  OutlinedFn.<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(0, Attribute::NoAlias);</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">  OutlinedFn.<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(1, Attribute::NoAlias);</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">  OutlinedFn.<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(Attribute::NoUnwind);</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFn.<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() &gt;= 2 &amp;&amp;</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected at least tid and bounded tid as arguments&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumCapturedVars = OutlinedFn.<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() - </span><span class="doxyHighlightComment">/&#42; tid &amp; bounded tid &#42;/</span><span class="doxyHighlight"> 2;</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(OutlinedFn.<a href="/docs/api/classes/llvm/value/#a46db903db2484e1ef5062d094d6b0854">user&#95;back</a>());</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">  CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;setName(</span><span class="doxyHighlightStringLiteral">&quot;omp&#95;parallel&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(CI);</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build call &#95;&#95;kmpc&#95;fork&#95;call&#91;&#95;if&#93;(Ident, n, microtask, var1, .., varn);</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ForkCallArgs&#91;&#93; = &#123;</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">      Ident, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(NumCapturedVars),</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(&amp;OutlinedFn, OMPIRBuilder-&gt;ParallelTaskPtr)&#125;;</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 16&gt;</a> RealArgs;</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">  RealArgs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(std::begin(ForkCallArgs), std::end(ForkCallArgs));</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfCondition) &#123;</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aeb11a01107c6be1f52ba01902a165d71">CreateSExtOrTrunc</a>(IfCondition, OMPIRBuilder-&gt;Int32);</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">    RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">  RealArgs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a4fb513d744ca72275932b2c7003f16f6">arg&#95;begin</a>() + </span><span class="doxyHighlightComment">/&#42; tid &amp; bound tid &#42;/</span><span class="doxyHighlight"> 2, CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ac0f11b96f81b2769dd23d028e3189075">arg&#95;end</a>());</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#95;&#95;kmpc&#95;fork&#95;call&#95;if always expects a void ptr as the last argument</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are no arguments, pass a null pointer.</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PtrTy = OMPIRBuilder-&gt;VoidPtr;</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfCondition &amp;&amp; NumCapturedVars == 0) &#123;</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NullPtrValue = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(PtrTy);</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">    RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(NullPtrValue);</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfCondition &amp;&amp; RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>()-&gt;getType() != PtrTy)</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">    RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>() = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>(), PtrTy);</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(RTLFn, RealArgs);</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;With fork&#95;call placed: &quot;</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">                    &lt;&lt; &#42;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Initialize the local TID stack location with the argument value.</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(PrivTID);</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function/#a1c9f2f058966db1f8ca270398bda8362">Function::arg&#95;iterator</a> OutlinedAI = OutlinedFn.<a href="/docs/api/classes/llvm/function/#a8bf193a781a92cae52d7f9216d0824f8">arg&#95;begin</a>();</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(OMPIRBuilder-&gt;Int32, OutlinedAI),</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">                      PrivTIDAddr);</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove redundant call to the outlined function.</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">  CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : ToBeDeleted) &#123;</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a4f81b9940e1869e146636dc533455929"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> <a href="/docs/api/classes/llvm/openmpirbuilder/#a4f81b9940e1869e146636dc533455929">OpenMPIRBuilder::createParallel</a>(</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> OuterAllocaIP,</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#a49e35e3ee470add16efcde1ab5d5556b">BodyGenCallbackTy</a> BodyGenCB, <a href="/docs/api/classes/llvm/openmpirbuilder/#a71b5ba020f68829f5a1fd99f48b63d42">PrivatizeCallbackTy</a> PrivCB,</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#a0c571620ff53fdb78e7404f5261dbd23">FinalizeCallbackTy</a> FiniCB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;IfCondition, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumThreads,</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">    omp::ProcBindKind ProcBind, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsCancellable) &#123;</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="#a756b28f370cd5a39bc0ee3e5333b9c9b">isConflictIP</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP, OuterAllocaIP) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;IPs must not be ambiguous&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP;</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, SrcLocStrSize);</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ThreadID = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we generate code for the target device, we need to allocate</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// struct for aggregate params in the device default alloca address space.</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OpenMP runtime requires that the params of the extracted functions are</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// passed as zero address space pointers. This flag ensures that extracted</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function arguments are declared in zero address space</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ArgsInZeroAddressSpace = Config.isTargetDevice();</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build call &#95;&#95;kmpc&#95;push&#95;num&#95;threads(&amp;Ident, global&#95;tid, num&#95;threads)</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// only if we compile for host side.</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumThreads &amp;&amp; !Config.isTargetDevice()) &#123;</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Args&#91;&#93; = &#123;</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">        Ident, ThreadID,</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac79ca3c2d2d74cf33684397a91846564">CreateIntCast</a>(NumThreads, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, </span><span class="doxyHighlightComment">/&#42;isSigned&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)&#125;;</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">        getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;push&#95;num&#95;threads), Args);</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ProcBind != OMP&#95;PROC&#95;BIND&#95;default) &#123;</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Build call &#95;&#95;kmpc&#95;push&#95;proc&#95;bind(&amp;Ident, global&#95;tid, proc&#95;bind)</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Args&#91;&#93; = &#123;</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">        Ident, ThreadID,</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlight">        ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">(ProcBind), </span><span class="doxyHighlightComment">/&#42;isSigned=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)&#125;;</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">        getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;push&#95;proc&#95;bind), Args);</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InsertBB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;OuterFn = InsertBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Save the outer alloca block because the insertion iterator may get</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// invalidated and we still need this later.</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OuterAllocaBlock = OuterAllocaIP.<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint/#a3d072f8ac5e1b0724c4bb5a77adae9da">getBlock</a>();</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Vector to remember instructions we used only during the modeling but which</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we want to delete at the end.</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> ToBeDeleted;</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Change the location to the outer alloca insertion point to create and</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// initialize the allocas we pass into the parallel region.</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> NewOuter(OuterAllocaBlock, OuterAllocaBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(NewOuter);</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;TIDAddrAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;tid.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;ZeroAddrAlloca =</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;zero.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TIDAddr = TIDAddrAlloca;</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ZeroAddr = ZeroAddrAlloca;</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgsInZeroAddressSpace &amp;&amp; M.getDataLayout().getAllocaAddrSpace() != 0) &#123;</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add additional casts to enforce pointers in zero address space</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">    TIDAddr = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/addrspacecastinst">AddrSpaceCastInst</a>(</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">        TIDAddrAlloca, PointerType ::get(M.getContext(), 0), </span><span class="doxyHighlightStringLiteral">&quot;tid.addr.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">    TIDAddr-&gt;<a href="/docs/api/classes/llvm/instruction/#af09e4096de244d2fb345891328714a63">insertAfter</a>(TIDAddrAlloca-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">    ToBeDeleted.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(TIDAddr);</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">    ZeroAddr = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/addrspacecastinst">AddrSpaceCastInst</a>(ZeroAddrAlloca,</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">                                     PointerType ::get(M.getContext(), 0),</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">                                     </span><span class="doxyHighlightStringLiteral">&quot;zero.addr.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">    ZeroAddr-&gt;<a href="/docs/api/classes/llvm/instruction/#af09e4096de244d2fb345891328714a63">insertAfter</a>(ZeroAddrAlloca-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">    ToBeDeleted.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ZeroAddr);</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We only need TIDAddr and ZeroAddr for modeling purposes to get the</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// associated arguments in the outlined function, so we delete them later.</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">  ToBeDeleted.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(TIDAddrAlloca);</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">  ToBeDeleted.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ZeroAddrAlloca);</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create an artificial insertion point that will also ensure the blocks we</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are about to split are not degenerated.</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>(), InsertBB);</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EntryBB = UI-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PRegEntryBB = EntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(UI, </span><span class="doxyHighlightStringLiteral">&quot;omp.par.entry&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PRegBodyBB = PRegEntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(UI, </span><span class="doxyHighlightStringLiteral">&quot;omp.par.region&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PRegPreFiniBB =</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">      PRegBodyBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(UI, </span><span class="doxyHighlightStringLiteral">&quot;omp.par.pre&#95;finalize&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PRegExitBB = PRegPreFiniBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(UI, </span><span class="doxyHighlightStringLiteral">&quot;omp.par.exit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FiniCBWrapper = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> IP) &#123;</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Hide &quot;open-ended&quot; blocks from the given FiniCB by setting the right jump</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// target to the region exit block.</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IP.getBlock()-&gt;end() == IP.getPoint()) &#123;</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/irbuilderbase/insertpointguard">IRBuilder&lt;&gt;::InsertPointGuard</a> IPG(Builder);</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(IP);</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(PRegExitBB);</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">      IP = <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIterator());</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IP.getBlock()-&gt;getTerminator()-&gt;getNumSuccessors() == 1 &amp;&amp;</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">           IP.getBlock()-&gt;getTerminator()-&gt;getSuccessor(0) == PRegExitBB &amp;&amp;</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Unexpected insertion point for finalization call!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FiniCB(IP);</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">  FinalizationStack.push&#95;back(&#123;FiniCBWrapper, OMPD&#95;parallel, IsCancellable&#125;);</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate the privatization allocas in the block that will become the entry</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the outlined function.</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(PRegEntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> InnerAllocaIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;PrivTIDAddr =</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;tid.addr.local&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PrivTID = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, PrivTIDAddr, </span><span class="doxyHighlightStringLiteral">&quot;tid&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add some fake uses for OpenMP provided arguments.</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">  ToBeDeleted.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, TIDAddr, </span><span class="doxyHighlightStringLiteral">&quot;tid.addr.use&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ZeroAddrUse =</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, ZeroAddr, </span><span class="doxyHighlightStringLiteral">&quot;zero.addr.use&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlight">  ToBeDeleted.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ZeroAddrUse);</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// EntryBB</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   |</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   V</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PRegionEntryBB         &lt;- Privatization allocas are placed here.</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   |</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   V</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PRegionBodyBB          &lt;- BodeGen is invoked here.</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   |</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   V</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PRegPreFiniBB          &lt;- The block we will start finalization from.</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   |</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   V</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PRegionExitBB          &lt;- A common exit to simplify block collection.</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Before body codegen: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OuterFn &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Let the caller create the body.</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BodyGenCB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected body generation callback!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> CodeGenIP(PRegBodyBB, PRegBodyBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/error">Error</a> Err = BodyGenCB(InnerAllocaIP, CodeGenIP))</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;After  body codegen: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OuterFn &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">  OutlineInfo OI;</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Config.isTargetDevice()) &#123;</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Generate OpenMP target specific runtime call</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">    OI.PostOutlineCB = &#91;=, ToBeDeletedVec =</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">                               std::move(ToBeDeleted)&#93;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;OutlinedFn) &#123;</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlight">      <a href="#af7668ce8080668a4f0ceac24e70c9f00">targetParallelCallback</a>(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, OutlinedFn, OuterFn, OuterAllocaBlock, Ident,</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">                             IfCondition, NumThreads, PrivTID, PrivTIDAddr,</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">                             ThreadID, ToBeDeletedVec);</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Generate OpenMP host runtime call</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">    OI.PostOutlineCB = &#91;=, ToBeDeletedVec =</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">                               std::move(ToBeDeleted)&#93;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;OutlinedFn) &#123;</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">      <a href="#afffa0ff2e1527ab545cef33be915c656">hostParallelCallback</a>(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, OutlinedFn, OuterFn, Ident, IfCondition,</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">                           PrivTID, PrivTIDAddr, ToBeDeletedVec);</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">  OI.OuterAllocaBB = OuterAllocaBlock;</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">  OI.EntryBB = PRegEntryBB;</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">  OI.ExitBB = PRegExitBB;</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 32&gt;</a> ParallelRegionBlockSet;</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 32&gt;</a> Blocks;</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">  OI.collectBlocks(ParallelRegionBlockSet, Blocks);</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ensure a single exit node for the outlined region by creating one.</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We might have multiple incoming edges to the exit now due to finalizations,</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// e.g., cancel calls that cause the control flow to leave the region.</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PRegOutlinedExitBB = PRegExitBB;</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">  PRegExitBB = <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(PRegExitBB, &amp;&#42;PRegExitBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">  PRegOutlinedExitBB-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</span><span class="doxyHighlightStringLiteral">&quot;omp.par.outlined.exit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">  Blocks.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PRegOutlinedExitBB);</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/codeextractoranalysiscache">CodeExtractorAnalysisCache</a> CEAC(&#42;OuterFn);</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a> Extractor(Blocks, </span><span class="doxyHighlightComment">/&#42; DominatorTree &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; AggregateArgs &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; BlockFrequencyInfo &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; BranchProbabilityInfo &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; AssumptionCache &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; AllowVarArgs &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; AllowAlloca &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; AllocationBlock &#42;/</span><span class="doxyHighlight"> OuterAllocaBlock,</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; Suffix &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;.omp&#95;par&quot;</span><span class="doxyHighlight">, ArgsInZeroAddressSpace);</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find inputs to, outputs from the code region.</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CommonExit = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> Inputs, Outputs, SinkingCands, HoistingCands;</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><span class="doxyHighlight">  Extractor.findAllocas(CEAC, SinkingCands, HoistingCands, CommonExit);</span></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">  Extractor.findInputsOutputs(Inputs, Outputs, SinkingCands,</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;CollectGlobalInputs=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">  Inputs.<a href="/docs/api/classes/llvm/setvector/#a14d9be6f03ca789eb7489fa89273aa40">remove&#95;if</a>(&#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/structs/llvm/omp/gv">GV</a> = <a href="/docs/api/namespaces/llvm/#a3377eac88526e806d9d887c4a0ba2a73">dyn&#95;cast&#95;if&#95;present&lt;GlobalVariable&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/omp/gv">GV</a>-&gt;getValueType() == OpenMPIRBuilder::Ident;</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Before privatization: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OuterFn &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a> TIDRTLFn =</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">      getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;global&#95;thread&#95;num);</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PrivHelper = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &amp;V) -&gt; <a href="/docs/api/classes/llvm/error">Error</a> &#123;</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;V == TIDAddr || &amp;V == ZeroAddr) &#123;</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlight">      OI.ExcludeArgsFromAggregate.push&#95;back(&amp;V);</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Use &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>;</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : V.uses())</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UserI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U.getUser()))</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ParallelRegionBlockSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(UserI-&gt;getParent()))</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.insert(&amp;U);</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#95;&#95;kmpc&#95;fork&#95;call expects extra arguments as pointers. If the input</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// already has a pointer type, everything is fine. Otherwise, store the</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value onto stack and load it back inside the to-be-outlined region. This</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will ensure only the pointer will be passed to the function.</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: if there are more than 15 trailing arguments, they must be</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// additionally packed in a struct.</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Inner = &amp;V;</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!V.getType()-&gt;isPointerTy()) &#123;</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/irbuilderbase/insertpointguard">IRBuilder&lt;&gt;::InsertPointGuard</a> Guard(Builder);</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">llvm::dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Forwarding input as pointer: &quot;</span><span class="doxyHighlight"> &lt;&lt; V &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(OuterAllocaIP);</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> =</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(V.getType(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, V.getName() + </span><span class="doxyHighlightStringLiteral">&quot;.reloaded&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Store to stack at end of the block that currently branches to the entry</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// block of the to-be-outlined region.</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(InsertBB,</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">                             InsertBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(&amp;V, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Load back next to allocations in the to-be-outlined region.</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(InnerAllocaIP);</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">      Inner = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(V.getType(), <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ReplacementValue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;V);</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CI &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>() == TIDRTLFn.<a href="/docs/api/classes/llvm/functioncallee/#ac5d8da677233fa2e1e7039508ed56e0e">getCallee</a>()) &#123;</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">      ReplacementValue = PrivTID;</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">          PrivCB(InnerAllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), V, &#42;Inner, ReplacementValue);</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.<a href="/docs/api/classes/llvm/expected/#a94789df4ebd03dc008e8adebaa66ac1f">takeError</a>();</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#42;AfterIP);</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">      InnerAllocaIP = &#123;</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">          InnerAllocaIP.<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint/#a3d072f8ac5e1b0724c4bb5a77adae9da">getBlock</a>(),</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">          InnerAllocaIP.<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint/#a3d072f8ac5e1b0724c4bb5a77adae9da">getBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>()&#125;;</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ReplacementValue &amp;&amp;</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Expected copy/create callback to set replacement value!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReplacementValue == &amp;V)</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &#42;UPtr : <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>)</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">      UPtr-&gt;set(ReplacementValue);</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reset the inner alloca insertion as it will be used for loading the values</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// wrapped into pointers before passing them into the to-be-outlined region.</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Configure it to insert immediately after the fake use of zero address so</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that they are available in the generated body and so that the</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OpenMP-related values (thread ID and zero address pointers) remain leading</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in the argument list.</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">  InnerAllocaIP = <a href="/docs/api/classes/llvm/irbuilderbase/insertpoint">IRBuilder&lt;&gt;::InsertPoint</a>(</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">      ZeroAddrUse-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), ZeroAddrUse-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reset the outer alloca insertion point to the entry of the relevant block</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in case it was invalidated.</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">  OuterAllocaIP = <a href="/docs/api/classes/llvm/irbuilderbase/insertpoint">IRBuilder&lt;&gt;::InsertPoint</a>(</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">      OuterAllocaBlock, OuterAllocaBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/input">Input</a> : Inputs) &#123;</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Captured input: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/classes/input">Input</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/error">Error</a> Err = PrivHelper(&#42;<a href="/docs/api/classes/input">Input</a>))</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;Output : Outputs)</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Captured output: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Output &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Outputs.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>() &amp;&amp;</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;OpenMP outlining should not produce live-out values!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;After  privatization: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OuterFn &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : Blocks)</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; PBR: &quot;</span><span class="doxyHighlight"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Adjust the finalization stack, verify the adjustment, and call the</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// finalize function a last time to finalize values between the pre-fini</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block and the exit block if we left the parallel &quot;the normal way&quot;.</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FiniInfo = FinalizationStack.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">  (void)FiniInfo;</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FiniInfo.DK == OMPD&#95;parallel &amp;&amp;</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected finalization stack state!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PRegPreFiniTI = PRegPreFiniBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> PreFiniIP(PRegPreFiniBB, PRegPreFiniTI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/error">Error</a> Err = FiniCB(PreFiniIP))</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Register the outlined info.</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">  addOutlineInfo(std::move(OI));</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AfterIP(UI-&gt;getParent(), UI-&gt;getParent()-&gt;end());</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">  UI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP;</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitFlush(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>) &#123;</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build call void &#95;&#95;kmpc&#95;flush(ident&#95;t &#42;loc)</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, SrcLocStrSize);</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Args&#91;&#93; = &#123;getOrCreateIdent(SrcLocStr, SrcLocStrSize)&#125;;</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;flush), Args);</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766" lineLink="/docs/api/classes/llvm/openmpirbuilder/#afc2cc623eda981e1b3fbb61a44e80ef8"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#afc2cc623eda981e1b3fbb61a44e80ef8">OpenMPIRBuilder::createFlush</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>) &#123;</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">  emitFlush(<a href="/docs/api/namespaces/llvm/loc">Loc</a>);</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitTaskwaitImpl(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>) &#123;</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build call kmp&#95;int32 &#95;&#95;kmpc&#95;omp&#95;taskwait(ident&#95;t &#42;loc, kmp&#95;int32</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// global&#95;tid);</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, SrcLocStrSize);</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Args&#91;&#93; = &#123;Ident, getOrCreateThreadID(Ident)&#125;;</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ignore return result until untied tasks are supported.</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;taskwait),</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">                     Args);</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a419ffad9e4d59275e299ce1ad3c73cd4"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#a419ffad9e4d59275e299ce1ad3c73cd4">OpenMPIRBuilder::createTaskwait</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>) &#123;</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlight">  emitTaskwaitImpl(<a href="/docs/api/namespaces/llvm/loc">Loc</a>);</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitTaskyieldImpl(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>) &#123;</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build call &#95;&#95;kmpc&#95;omp&#95;taskyield(loc, thread&#95;id, 0);</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, SrcLocStrSize);</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;I32Null = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">ConstantInt::getNullValue</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>);</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Args&#91;&#93; = &#123;Ident, getOrCreateThreadID(Ident), I32Null&#125;;</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;taskyield),</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlight">                     Args);</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a0b0ed7f600549e4239bf10b5b85de66c"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#a0b0ed7f600549e4239bf10b5b85de66c">OpenMPIRBuilder::createTaskyield</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>) &#123;</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlight">  emitTaskyieldImpl(<a href="/docs/api/namespaces/llvm/loc">Loc</a>);</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlightComment">// Processes the dependencies in Dependencies and does the following</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlightComment">// - Allocates space on the stack of an array of DependInfo objects</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlightComment">// - Populates each DependInfo object with relevant information of</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlightComment">//   the corresponding dependence.</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlightComment">// - All code is inserted in the entry block of the current function.</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814" lineLink="#a9702d30c99a5459e9565631adf1fdf1b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a9702d30c99a5459e9565631adf1fdf1b">emitTaskDependencies</a>(</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp;OMPBuilder,</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;OpenMPIRBuilder::DependData&gt;</a> &amp;Dependencies) &#123;</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Early return if we have no dependencies to process</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Dependencies.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Given a vector of DependData objects, in this function we create an</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// array on the stack that holds kmp&#95;dep&#95;info objects corresponding</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to each dependency. This is then passed to the OpenMP runtime.</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For example, if there are &#39;n&#39; dependencies then the following psedo</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// code is generated. Assume the first dependence is on a variable &#39;a&#39;</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// \\code&#123;c&#125;</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DepArray = alloc(n x sizeof(kmp&#95;depend&#95;info);</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// idx = 0;</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DepArray&#91;idx&#93;.base&#95;addr = ptrtoint(&amp;a);</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DepArray&#91;idx&#93;.len = 8;</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DepArray&#91;idx&#93;.flags = Dep.DepKind; /&#42;(See OMPContants.h for DepKind)&#42;/</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ++idx;</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DepArray&#91;idx&#93;.base&#95;addr = ...;</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// \\endcode</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder = OMPBuilder.Builder;</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DependInfo = OMPBuilder.DependInfo;</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/module">Module</a> &amp;M = OMPBuilder.M;</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;DepArray = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> OldIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">      OldIP.<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint/#a3d072f8ac5e1b0724c4bb5a77adae9da">getBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>().<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DepArrayTy = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(DependInfo, Dependencies.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">  DepArray = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(DepArrayTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.dep.arr.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;DepIdx, Dep&#93; : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(Dependencies)) &#123;</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> =</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa8ee5dc4e4a1b26c4bdf1a574eefe2fc">CreateConstInBoundsGEP2&#95;64</a>(DepArrayTy, DepArray, 0, DepIdx);</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Store the pointer to the variable</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Addr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e95ff363c20e1f51b673230538e10fd">CreateStructGEP</a>(</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">        DependInfo, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>,</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(RTLDependInfoFields::BaseAddr));</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;DepValPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aae2c1bf70058f3665edaec525457030c">CreatePtrToInt</a>(Dep.DepVal, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64748b5a9f8d8dd4499f84312e2c1336">getInt64Ty</a>());</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(DepValPtr, Addr);</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Store the size of the variable</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e95ff363c20e1f51b673230538e10fd">CreateStructGEP</a>(</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">        DependInfo, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(RTLDependInfoFields::Len));</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(M.getDataLayout().getTypeStoreSize(Dep.DepValueType)),</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>);</span></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Store the dependency kind</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Flags = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e95ff363c20e1f51b673230538e10fd">CreateStructGEP</a>(</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">        DependInfo, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>,</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(RTLDependInfoFields::Flags));</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">        ConstantInt::get(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7be2e1490f01c049d748436f03760c5">getInt8Ty</a>(),</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">                         </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(Dep.DepKind)),</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">        Flags);</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(OldIP);</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DepArray;</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> OpenMPIRBuilder::createTask(</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">    BodyGenCallbackTy BodyGenCB, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Tied, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Final, <a href="/docs/api/classes/llvm/value">Value</a> &#42;IfCondition,</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DependData&gt;</a> Dependencies, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Mergeable, <a href="/docs/api/classes/llvm/value">Value</a> &#42;EventHandle,</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Priority) &#123;</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>();</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The current basic block is split into four basic blocks. After outlining,</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// they will be mapped as follows:</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#96;&#96;&#96;</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// def current&#95;fn() &#123;</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   current&#95;basic&#95;block:</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     br label %task.exit</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   task.exit:</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     ; instructions after task</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#125;</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// def outlined&#95;fn() &#123;</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   task.alloca:</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     br label %task.body</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   task.body:</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     ret void</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#125;</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#96;&#96;&#96;</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;TaskExitBB = <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;task.exit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;TaskBodyBB = <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;task.body&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;TaskAllocaBB =</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;task.alloca&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> TaskAllocaIP =</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>(TaskAllocaBB, TaskAllocaBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> TaskBodyIP = <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>(TaskBodyBB, TaskBodyBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = BodyGenCB(TaskAllocaIP, TaskBodyIP))</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">  OutlineInfo OI;</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">  OI.EntryBB = TaskAllocaBB;</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">  OI.OuterAllocaBB = AllocaIP.getBlock();</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">  OI.ExitBB = TaskExitBB;</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add the thread ID argument.</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;, 4&gt; ToBeDeleted;</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">  OI.ExcludeArgsFromAggregate.push&#95;back(<a href="#a35409dbaffc2cf38fefec12e3cf9094d">createFakeIntVal</a>(</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">      Builder, AllocaIP, ToBeDeleted, TaskAllocaIP, </span><span class="doxyHighlightStringLiteral">&quot;global.tid&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">  OI.PostOutlineCB = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, Ident, Tied, Final, IfCondition, Dependencies,</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">                      Mergeable, Priority, EventHandle, TaskAllocaBB,</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">                      ToBeDeleted&#93;(<a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &amp;OutlinedFn) </span><span class="doxyHighlightKeyword">mutable</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace the Stale CI by appropriate RTL function call.</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFn.getNumUses() == 1 &amp;&amp;</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;there must be a single user for the outlined function&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">    CallInst &#42;StaleCI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(OutlinedFn.user&#95;back());</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// HasShareds is true if any variables are captured in the outlined region,</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// false otherwise.</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasShareds = StaleCI-&gt;<a href="/docs/api/classes/llvm/callbase/#adde2ea00dd2613ee41bfe91908e4e68e">arg&#95;size</a>() &gt; 1;</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(StaleCI);</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Gather the arguments for emitting the runtime call for</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// @&#95;&#95;kmpc&#95;omp&#95;task&#95;alloc</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskAllocFn =</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">        getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;task&#95;alloc);</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Arguments - &#96;loc&#95;ref&#96; (Ident) and &#96;gtid&#96; (ThreadID)</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// call.</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadID = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Argument - &#96;flags&#96;</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Task is tied iff (Flags &amp; 1) == 1</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Task is untied iff (Flags &amp; 1) == 0</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Task is final iff (Flags &amp; 2) == 2</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Task is not final iff (Flags &amp; 2) == 0</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Task is mergeable iff (Flags &amp; 4) == 4</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Task is not mergeable iff (Flags &amp; 4) == 0</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Task is priority iff (Flags &amp; 32) == 32</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Task is not priority iff (Flags &amp; 32) == 0</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Handle the other flags.</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(Tied);</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Final) &#123;</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;FinalFlag =</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(Final, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(2), Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(0));</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab61be8e3cf17e9848aeeeabacfa1b09a">CreateOr</a>(FinalFlag, <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a>);</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Mergeable)</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab61be8e3cf17e9848aeeeabacfa1b09a">CreateOr</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(4), <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a>);</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Priority)</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab61be8e3cf17e9848aeeeabacfa1b09a">CreateOr</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(32), <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a>);</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Argument - &#96;sizeof&#95;kmp&#95;task&#95;t&#96; (TaskSize)</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Tasksize refers to the size in bytes of kmp&#95;task&#95;t data structure</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// including private vars accessed in task.</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: add kmp&#95;task&#95;t&#95;with&#95;privates (privates)</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TaskSize = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a9dda4472ee0b7ea92ab49eedf6e13d50">divideCeil</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeSizeInBits(Task), 8));</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Argument - &#96;sizeof&#95;shareds&#96; (SharedsSize)</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SharedsSize refers to the shareds array size in the kmp&#95;task&#95;t data</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// structure.</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SharedsSize = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(0);</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasShareds) &#123;</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlight">      AllocaInst &#42;ArgStructAlloca =</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(StaleCI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(1));</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ArgStructAlloca &amp;&amp;</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Unable to find the alloca instruction corresponding to arguments &quot;</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;for extracted function&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">      StructType &#42;ArgStructType =</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StructType&gt;</a>(ArgStructAlloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>());</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ArgStructType &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unable to find struct type corresponding to &quot;</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">                              </span><span class="doxyHighlightStringLiteral">&quot;arguments for extracted function&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">      SharedsSize =</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(ArgStructType));</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Emit the @&#95;&#95;kmpc&#95;omp&#95;task&#95;alloc runtime call</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The runtime call returns a pointer to an area where the task captured</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// variables must be copied before the task is run (TaskData)</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">    CallInst &#42;TaskData = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">        TaskAllocFn, &#123;</span><span class="doxyHighlightComment">/&#42;loc&#95;ref=&#42;/</span><span class="doxyHighlight">Ident, </span><span class="doxyHighlightComment">/&#42;gtid=&#42;/</span><span class="doxyHighlight">ThreadID, </span><span class="doxyHighlightComment">/&#42;flags=&#42;/</span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a>,</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">                      </span><span class="doxyHighlightComment">/&#42;sizeof&#95;task=&#42;/</span><span class="doxyHighlight">TaskSize, </span><span class="doxyHighlightComment">/&#42;sizeof&#95;shared=&#42;/</span><span class="doxyHighlight">SharedsSize,</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">                      </span><span class="doxyHighlightComment">/&#42;task&#95;func=&#42;/</span><span class="doxyHighlight">&amp;OutlinedFn&#125;);</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Emit detach clause initialization.</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// evt = (typeof(evt))&#95;&#95;kmpc&#95;task&#95;allow&#95;completion&#95;event(loc, tid,</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// task&#95;descriptor);</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EventHandle) &#123;</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskDetachFn = getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">          OMPRTL&#95;&#95;&#95;kmpc&#95;task&#95;allow&#95;completion&#95;event);</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">llvm::Value</a> &#42;EventVal =</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(TaskDetachFn, &#123;Ident, ThreadID, TaskData&#125;);</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">llvm::Value</a> &#42;EventHandleAddr =</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(EventHandle,</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">                                                      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(0));</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">      EventVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aae2c1bf70058f3665edaec525457030c">CreatePtrToInt</a>(EventVal, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64748b5a9f8d8dd4499f84312e2c1336">getInt64Ty</a>());</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(EventVal, EventHandleAddr);</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Copy the arguments for outlined function</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasShareds) &#123;</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Shareds = StaleCI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(1);</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> Alignment = TaskData-&gt;<a href="/docs/api/classes/llvm/value/#a47f5c74e1b14ba4a61db057400644acc">getPointerAlignment</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout());</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TaskShareds = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(VoidPtr, TaskData);</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae9f2730f66215fdb82f4e41e45124811">CreateMemCpy</a>(TaskShareds, Alignment, Shareds, Alignment,</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">                           SharedsSize);</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Priority) &#123;</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The return type of &quot;&#95;&#95;kmpc&#95;omp&#95;task&#95;alloc&quot; is &quot;kmp&#95;task&#95;t &#42;&quot;,</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we populate the priority information into the &quot;kmp&#95;task&#95;t&quot; here</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The struct &quot;kmp&#95;task&#95;t&quot; definition is available in kmp.h</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// kmp&#95;task&#95;t = &#123; shareds, routine, part&#95;id, data1, data2 &#125;</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// data2 is used for priority</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;<a href="/docs/api/namespaces/llvm/#a23f9ec4bb2576ca8738f3edc9c4f5cdf">Int32Ty</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>();</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefad7ed4ee1df437474d005188535f74875">Zero</a> = ConstantInt::get(<a href="/docs/api/namespaces/llvm/#a23f9ec4bb2576ca8738f3edc9c4f5cdf">Int32Ty</a>, 0);</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// kmp&#95;task&#95;t&#42; =&gt; &#123; ptr &#125;</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TaskPtr = <a href="/docs/api/classes/llvm/structtype/#a18fc4545474c6ebb6f7c547f64f4fb31">StructType::get</a>(VoidPtr);</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TaskGEP =</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(TaskPtr, TaskData, &#123;<a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefad7ed4ee1df437474d005188535f74875">Zero</a>, <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefad7ed4ee1df437474d005188535f74875">Zero</a>&#125;);</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// kmp&#95;task&#95;t =&gt; &#123; ptr, ptr, i32, ptr, ptr &#125;</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;TaskStructType = <a href="/docs/api/classes/llvm/structtype/#a18fc4545474c6ebb6f7c547f64f4fb31">StructType::get</a>(</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">          VoidPtr, VoidPtr, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), VoidPtr, VoidPtr);</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PriorityData = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">          TaskStructType, TaskGEP, &#123;<a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefad7ed4ee1df437474d005188535f74875">Zero</a>, ConstantInt::get(<a href="/docs/api/namespaces/llvm/#a23f9ec4bb2576ca8738f3edc9c4f5cdf">Int32Ty</a>, 4)&#125;);</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// kmp&#95;cmplrdata&#95;t =&gt; &#123; ptr, ptr &#125;</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;CmplrStructType = <a href="/docs/api/classes/llvm/structtype/#a18fc4545474c6ebb6f7c547f64f4fb31">StructType::get</a>(VoidPtr, VoidPtr);</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CmplrData = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(CmplrStructType,</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">                                                   PriorityData, &#123;<a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefad7ed4ee1df437474d005188535f74875">Zero</a>, <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefad7ed4ee1df437474d005188535f74875">Zero</a>&#125;);</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Priority, CmplrData);</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DepArray = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Dependencies.size()) &#123;</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> OldIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">          &amp;OldIP.getBlock()-&gt;getParent()-&gt;getEntryBlock().back());</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;DepArrayTy = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(DependInfo, Dependencies.size());</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">      DepArray = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(DepArrayTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.dep.arr.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = 0;</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/dependdata">DependData</a> &amp;Dep : Dependencies) &#123;</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> =</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa8ee5dc4e4a1b26c4bdf1a574eefe2fc">CreateConstInBoundsGEP2&#95;64</a>(DepArrayTy, DepArray, 0, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Store the pointer to the variable</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Addr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e95ff363c20e1f51b673230538e10fd">CreateStructGEP</a>(</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">            DependInfo, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>,</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(RTLDependInfoFields::BaseAddr));</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DepValPtr =</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aae2c1bf70058f3665edaec525457030c">CreatePtrToInt</a>(Dep.DepVal, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64748b5a9f8d8dd4499f84312e2c1336">getInt64Ty</a>());</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(DepValPtr, Addr);</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Store the size of the variable</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e95ff363c20e1f51b673230538e10fd">CreateStructGEP</a>(</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">            DependInfo, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>,</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(RTLDependInfoFields::Len));</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">                                Dep.DepValueType)),</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">                            <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>);</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Store the dependency kind</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e95ff363c20e1f51b673230538e10fd">CreateStructGEP</a>(</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">            DependInfo, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>,</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(RTLDependInfoFields::Flags));</span></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">            ConstantInt::get(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7be2e1490f01c049d748436f03760c5">getInt8Ty</a>(),</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(Dep.DepKind)),</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a>);</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">        ++<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>;</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(OldIP);</span></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In the presence of the &#96;if&#96; clause, the following IR is generated:</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    ...</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    %data = call @&#95;&#95;kmpc&#95;omp&#95;task&#95;alloc(...)</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    br i1 %if&#95;condition, label %then, label %else</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  then:</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    call @&#95;&#95;kmpc&#95;omp&#95;task(...)</span></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    br label %exit</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  else:</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    ;; Wait for resolution of dependencies, if any, before</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    ;; beginning the task</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    call @&#95;&#95;kmpc&#95;omp&#95;wait&#95;deps(...)</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    call @&#95;&#95;kmpc&#95;omp&#95;task&#95;begin&#95;if0(...)</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    call @outlined&#95;fn(...)</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    call @&#95;&#95;kmpc&#95;omp&#95;task&#95;complete&#95;if0(...)</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    br label %exit</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  exit:</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    ...</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfCondition) &#123;</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// &#96;SplitBlockAndInsertIfThenElse&#96; requires the block to have a</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// terminator.</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;if.end&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;IfTerminator =</span></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e5c1b91bf5e2860398e3fa35c96b5af">GetInsertPoint</a>()-&gt;getParent()-&gt;getTerminator();</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ThenTI = IfTerminator, &#42;ElseTI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(IfTerminator);</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7ac00229d8c59902686f52ed061cdc80">SplitBlockAndInsertIfThenElse</a>(IfCondition, IfTerminator, &amp;ThenTI,</span></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><span class="doxyHighlight">                                    &amp;ElseTI);</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ElseTI);</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Dependencies.size()) &#123;</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskWaitFn =</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">            getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;wait&#95;deps);</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><span class="doxyHighlight">            TaskWaitFn,</span></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">            &#123;Ident, ThreadID, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(Dependencies.size()), DepArray,</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">             ConstantInt::get(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), 0),</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext()))&#125;);</span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskBeginFn =</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">          getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;task&#95;begin&#95;if0);</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskCompleteFn =</span></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlight">          getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;task&#95;complete&#95;if0);</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(TaskBeginFn, &#123;Ident, ThreadID, TaskData&#125;);</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><span class="doxyHighlight">      CallInst &#42;CI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasShareds)</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><span class="doxyHighlight">        CI = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(&amp;OutlinedFn, &#123;ThreadID, TaskData&#125;);</span></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlight">        CI = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(&amp;OutlinedFn, &#123;ThreadID&#125;);</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlight">      CI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(StaleCI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(TaskCompleteFn, &#123;Ident, ThreadID, TaskData&#125;);</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ThenTI);</span></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Dependencies.size()) &#123;</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskFn =</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlight">          getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;task&#95;with&#95;deps);</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><span class="doxyHighlight">          TaskFn,</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><span class="doxyHighlight">          &#123;Ident, ThreadID, TaskData, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(Dependencies.size()),</span></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlight">           DepArray, ConstantInt::get(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), 0),</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlight">           <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext()))&#125;);</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Emit the @&#95;&#95;kmpc&#95;omp&#95;task runtime call to spawn the task</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;task);</span></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(TaskFn, &#123;Ident, ThreadID, TaskData&#125;);</span></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlight">    StaleCI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(TaskAllocaBB, TaskAllocaBB-&gt;begin());</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasShareds) &#123;</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlight">      LoadInst &#42;Shareds = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(VoidPtr, OutlinedFn.getArg(1));</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlight">      OutlinedFn.getArg(1)-&gt;<a href="/docs/api/classes/llvm/value/#a7e8dad1701aa6445be4a29f654b0473c">replaceUsesWithIf</a>(</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><span class="doxyHighlight">          Shareds, &#91;Shareds&#93;(Use &amp;U) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser() != Shareds; &#125;);</span></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(ToBeDeleted))</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">  addOutlineInfo(std::move(OI));</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(TaskExitBB, TaskExitBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a></span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">OpenMPIRBuilder::createTaskgroup(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><span class="doxyHighlight">                                 InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><span class="doxyHighlight">                                 BodyGenCallbackTy BodyGenCB) &#123;</span></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>();</span></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadID = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit the @&#95;&#95;kmpc&#95;taskgroup runtime call to start the taskgroup</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskgroupFn =</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">      getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;taskgroup);</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(TaskgroupFn, &#123;Ident, ThreadID&#125;);</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;TaskgroupExitBB = <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;taskgroup.exit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = BodyGenCB(AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>()))</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(TaskgroupExitBB);</span></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit the @&#95;&#95;kmpc&#95;end&#95;taskgroup runtime call to end the taskgroup</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;EndTaskgroupFn =</span></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlight">      getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;end&#95;taskgroup);</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(EndTaskgroupFn, &#123;Ident, ThreadID&#125;);</span></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> OpenMPIRBuilder::createSections(</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;StorableBodyGenCallbackTy&gt;</a> SectionCBs, PrivatizeCallbackTy PrivCB,</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><span class="doxyHighlight">    FinalizeCallbackTy FiniCB, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsCancellable, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNowait) &#123;</span></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="#a756b28f370cd5a39bc0ee3e5333b9c9b">isConflictIP</a>(AllocaIP, Loc.IP) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Dedicated IP allocas required&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Loc.IP;</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FiniCBWrapper = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> IP) &#123;</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IP.getBlock()-&gt;end() != IP.getPoint())</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FiniCB(IP);</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This must be done otherwise any nested constructs using FinalizeOMPRegion</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will fail because that function requires the Finalization Basic Block to</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// have a terminator, which is already removed by EmitOMPRegionBody.</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// IP is currently at cancelation block.</span></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We need to backtrack to the condition block to fetch</span></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the exit block and create a branch from cancelation</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to exit block.</span></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><span class="doxyHighlight">    IRBuilder&lt;&gt;::InsertPointGuard IPG(Builder);</span></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(IP);</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CaseBB = IP.getBlock()-&gt;getSinglePredecessor();</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CondBB = CaseBB-&gt;getSinglePredecessor()-&gt;getSinglePredecessor();</span></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExitBB = CondBB-&gt;getTerminator()-&gt;getSuccessor(1);</span></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(ExitBB);</span></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlight">    IP = <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIterator());</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FiniCB(IP);</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlight">  FinalizationStack.push&#95;back(&#123;FiniCBWrapper, OMPD&#95;sections, IsCancellable&#125;);</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Each section is emitted as a switch case</span></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Each finalization callback is handled from clang.EmitOMPSectionDirective()</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// -&gt; OMP.createSection() which generates the IR for each section</span></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate through all sections and emit a switch construct:</span></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// switch (IV) &#123;</span></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   case 0:</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     &lt;SectionStmt&#91;0&#93;&gt;;</span></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     break;</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ...</span></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   case &lt;NumSection&gt; - 1:</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     &lt;SectionStmt&#91;&lt;NumSection&gt; - 1&#93;&gt;;</span></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     break;</span></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#125;</span></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ...</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// section&#95;loop.after:</span></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &lt;FiniCB&gt;;</span></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> LoopBodyGenCB = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> CodeGenIP, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IndVar) -&gt; <a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> &#123;</span></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#ada72881d16e555ca8525a916364048f9a69820949e2fb6d1d719487d27f0df883">Continue</a> =</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a03f30f48490558525cd5458201d13afe">splitBBWithSuffix</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.sections.after&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;CurFn = <a href="/docs/api/namespaces/llvm/#ada72881d16e555ca8525a916364048f9a69820949e2fb6d1d719487d27f0df883">Continue</a>-&gt;getParent();</span></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><span class="doxyHighlight">    SwitchInst &#42;SwitchStmt = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8b123015de85b2f41b0deda2aeaad9d3">CreateSwitch</a>(IndVar, <a href="/docs/api/namespaces/llvm/#ada72881d16e555ca8525a916364048f9a69820949e2fb6d1d719487d27f0df883">Continue</a>);</span></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CaseNumber = 0;</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SectionCB : SectionCBs) &#123;</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CaseBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;section&#95;loop.body.case&quot;</span><span class="doxyHighlight">, CurFn, <a href="/docs/api/namespaces/llvm/#ada72881d16e555ca8525a916364048f9a69820949e2fb6d1d719487d27f0df883">Continue</a>);</span></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><span class="doxyHighlight">      SwitchStmt-&gt;<a href="/docs/api/classes/llvm/switchinst/#a62abc2475d09c01d583ba24a487898fd">addCase</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(CaseNumber), CaseBB);</span></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(CaseBB);</span></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlight">      BranchInst &#42;CaseEndBr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(<a href="/docs/api/namespaces/llvm/#ada72881d16e555ca8525a916364048f9a69820949e2fb6d1d719487d27f0df883">Continue</a>);</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = SectionCB(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>(), &#123;CaseEndBr-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(),</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlight">                                                  CaseEndBr-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>()&#125;))</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><span class="doxyHighlight">      CaseNumber++;</span></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// remove the existing terminator from body BB since there can be no</span></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// terminators after switch/case</span></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loop body ends here</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LowerBound, UpperBound, and STride for createCanonicalLoop</span></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;I32Ty = <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext());</span></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LB = ConstantInt::get(I32Ty, 0);</span></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;UB = ConstantInt::get(I32Ty, SectionCBs.size());</span></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/arm-mb/#ad70272e2a9ec2a7e3a497458e1edbc85aed0b9bef861c96eee19e89db753db7b2">ST</a> = ConstantInt::get(I32Ty, 1);</span></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><span class="doxyHighlight">  Expected&lt;CanonicalLoopInfo &#42;&gt; LoopInfo = <a href="/docs/api/classes/llvm/openmpirbuilder/#ae0287686a5ffe03bc264972c862726ea">createCanonicalLoop</a>(</span></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><span class="doxyHighlight">      Loc, LoopBodyGenCB, LB, UB, ST, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, AllocaIP, </span><span class="doxyHighlightStringLiteral">&quot;section&#95;loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LoopInfo)</span></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LoopInfo.<a href="/docs/api/classes/llvm/expected/#a94789df4ebd03dc008e8adebaa66ac1f">takeError</a>();</span></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> WsloopIP =</span></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><span class="doxyHighlight">      applyStaticWorkshareLoop(Loc.DL, &#42;LoopInfo, AllocaIP, !IsNowait);</span></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WsloopIP)</span></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WsloopIP.takeError();</span></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AfterIP = &#42;WsloopIP;</span></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Apply the finalization callback in LoopAfterBB</span></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FiniInfo = FinalizationStack.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FiniInfo.DK == OMPD&#95;sections &amp;&amp;</span></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected finalization stack state!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/openmpirbuilder/#a0c571620ff53fdb78e7404f5261dbd23">FinalizeCallbackTy</a> &amp;CB = FiniInfo.FiniCB) &#123;</span></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AfterIP);</span></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FiniBB =</span></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a03f30f48490558525cd5458201d13afe">splitBBWithSuffix</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;sections.fini&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = CB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>()))</span></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><span class="doxyHighlight">    AfterIP = &#123;FiniBB, FiniBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()&#125;;</span></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP;</span></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a></span></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><span class="doxyHighlight">OpenMPIRBuilder::createSection(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><span class="doxyHighlight">                               BodyGenCallbackTy BodyGenCB,</span></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><span class="doxyHighlight">                               FinalizeCallbackTy FiniCB) &#123;</span></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Loc.IP;</span></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FiniCBWrapper = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> IP) &#123;</span></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IP.getBlock()-&gt;end() != IP.getPoint())</span></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FiniCB(IP);</span></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This must be done otherwise any nested constructs using FinalizeOMPRegion</span></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will fail because that function requires the Finalization Basic Block to</span></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// have a terminator, which is already removed by EmitOMPRegionBody.</span></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// IP is currently at cancelation block.</span></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We need to backtrack to the condition block to fetch</span></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the exit block and create a branch from cancelation</span></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to exit block.</span></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><span class="doxyHighlight">    IRBuilder&lt;&gt;::InsertPointGuard IPG(Builder);</span></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(IP);</span></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CaseBB = Loc.IP.getBlock();</span></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CondBB = CaseBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExitBB = CondBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(1);</span></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(ExitBB);</span></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><span class="doxyHighlight">    IP = <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIterator());</span></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FiniCB(IP);</span></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><span class="doxyHighlight">  Directive OMPD = Directive::OMPD&#95;sections;</span></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Since we are using Finalization Callback here, HasFinalize</span></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and IsCancellable have to be true</span></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EmitOMPInlinedRegion(OMPD, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, BodyGenCB, FiniCBWrapper,</span></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;Conditional&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;hasFinalize&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;IsCancellable&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348" lineLink="#ab5fa59567e3acc860411770354a1603a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> <a href="#ab5fa59567e3acc860411770354a1603a">getInsertPointAfterInstr</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>++;</span></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armsubtarget-cpp/#a6f57985fa144303082fa7517a52e6db9">IT</a>);</span></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;OpenMPIRBuilder::getGPUThreadID() &#123;</span></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><span class="doxyHighlight">      getOrCreateRuntimeFunction(M,</span></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><span class="doxyHighlight">                                 OMPRTL&#95;&#95;&#95;kmpc&#95;get&#95;hardware&#95;thread&#95;id&#95;in&#95;block),</span></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><span class="doxyHighlight">      &#123;&#125;);</span></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;OpenMPIRBuilder::getGPUWarpSize() &#123;</span></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><span class="doxyHighlight">      getOrCreateRuntimeFunction(M, OMPRTL&#95;&#95;&#95;kmpc&#95;get&#95;warp&#95;size), &#123;&#125;);</span></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;OpenMPIRBuilder::getNVPTXWarpID() &#123;</span></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LaneIDBits = <a href="/docs/api/namespaces/llvm/#a646986783f35e0fef8988f0f28d2589f">Log2&#95;32</a>(Config.getGridValue().GV&#95;Warp&#95;Size);</span></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#adc6a2686b807c18e4a7f7fc58e68d423">CreateAShr</a>(getGPUThreadID(), LaneIDBits, </span><span class="doxyHighlightStringLiteral">&quot;nvptx&#95;warp&#95;id&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;OpenMPIRBuilder::getNVPTXLaneID() &#123;</span></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LaneIDBits = <a href="/docs/api/namespaces/llvm/#a646986783f35e0fef8988f0f28d2589f">Log2&#95;32</a>(Config.getGridValue().GV&#95;Warp&#95;Size);</span></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LaneIDBits &lt; 32 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Invalid LaneIDBits size in NVPTX device.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LaneIDMask = ~0<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea7b774effe4a349c6dd82ad4f4f21d34c">u</a> &gt;&gt; (32u - LaneIDBits);</span></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(getGPUThreadID(), Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(LaneIDMask),</span></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;nvptx&#95;lane&#95;id&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;OpenMPIRBuilder::castValueToType(InsertPointTy AllocaIP, <a href="/docs/api/classes/llvm/value">Value</a> &#42;From,</span></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/type">Type</a> &#42;ToType) &#123;</span></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;<a href="/docs/api/namespaces/llvm/nvptx/ptxldstinstcode/#a0c4e2aa2235abdd10d2beffa32cd9b14">FromType</a> = From-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><span class="doxyHighlight">  uint64&#95;t FromSize = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(FromType);</span></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><span class="doxyHighlight">  uint64&#95;t ToSize = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(ToType);</span></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FromSize &gt; 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;From size must be greater than zero&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ToSize &gt; 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;To size must be greater than zero&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FromType == ToType)</span></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> From;</span></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FromSize == ToSize)</span></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(From, ToType);</span></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ToType-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/nvptx/ptxldstinstcode/#a0c4e2aa2235abdd10d2beffa32cd9b14">FromType</a>-&gt;isIntegerTy())</span></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac79ca3c2d2d74cf33684397a91846564">CreateIntCast</a>(From, ToType, </span><span class="doxyHighlightComment">/&#42;isSigned&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> SaveIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CastItem = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(ToType);</span></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(SaveIP);</span></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ValCastItem = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><span class="doxyHighlight">      CastItem, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(0));</span></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(From, ValCastItem);</span></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(ToType, CastItem);</span></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;OpenMPIRBuilder::createRuntimeShuffleFunction(InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/value">Value</a> &#42;Element,</span></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/type">Type</a> &#42;ElementType,</span></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>) &#123;</span></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(ElementType);</span></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &lt;= 8 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unsupported bitwidth in shuffle instruction&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Cast all types to 32- or 64-bit values before calling shuffle routines.</span></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;CastTy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a31e2db8d1b315202d2c19e711b5365fd">getIntNTy</a>(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &lt;= 4 ? 32 : 64);</span></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ElemCast = castValueToType(AllocaIP, Element, CastTy);</span></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;WarpSize =</span></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac79ca3c2d2d74cf33684397a91846564">CreateIntCast</a>(getGPUWarpSize(), Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a7325c05ca5ad3b239d1e88b933324c01">getInt16Ty</a>(), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;ShuffleFunc = getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &lt;= 4 ? RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;shuffle&#95;int32</span></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><span class="doxyHighlight">                : RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;shuffle&#95;int64);</span></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;WarpSizeCast =</span></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac79ca3c2d2d74cf33684397a91846564">CreateIntCast</a>(WarpSize, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a7325c05ca5ad3b239d1e88b933324c01">getInt16Ty</a>(), </span><span class="doxyHighlightComment">/&#42;isSigned=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ShuffleCall =</span></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(ShuffleFunc, &#123;ElemCast, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, WarpSizeCast&#125;);</span></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> castValueToType(AllocaIP, ShuffleCall, CastTy);</span></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::shuffleAndStore(InsertPointTy AllocaIP, <a href="/docs/api/classes/llvm/value">Value</a> &#42;SrcAddr,</span></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/value">Value</a> &#42;DstAddr, <a href="/docs/api/classes/llvm/type">Type</a> &#42;ElemType,</span></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;ReductionArrayTy) &#123;</span></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(ElemType);</span></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the loop over the big sized data.</span></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ptr = (void&#42;)Elem;</span></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ptrEnd = (void&#42;) Elem + 1;</span></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step = 8;</span></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// while (ptr + Step &lt; ptrEnd)</span></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   shuffle((int64&#95;t)&#42;ptr);</span></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step = 4;</span></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// while (ptr + Step &lt; ptrEnd)</span></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   shuffle((int32&#95;t)&#42;ptr);</span></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ...</span></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IndexTy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a50cf39b25a9fc8862b6361e22168dce7">getIndexTy</a>(</span></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout(), <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getDefaultGlobalsAddressSpace());</span></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ElemPtr = DstAddr;</span></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = SrcAddr;</span></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IntSize = 8; IntSize &gt;= 1; IntSize /= 2) &#123;</span></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &lt; IntSize)</span></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IntType = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a31e2db8d1b315202d2c19e711b5365fd">getIntNTy</a>(IntSize &#42; 8);</span></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(0), <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcAddrGEP =</span></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(ElemType, SrcAddr, &#123;ConstantInt::get(IndexTy, 1)&#125;);</span></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><span class="doxyHighlight">    ElemPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><span class="doxyHighlight">        ElemPtr, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(0), ElemPtr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;CurFunc = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> / IntSize) &gt; 1) &#123;</span></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PtrEnd = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><span class="doxyHighlight">          SrcAddrGEP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;PreCondBB =</span></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;.shuffle.pre&#95;cond&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ThenBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;.shuffle.then&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ExitBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;.shuffle.exit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CurrentBB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><span class="doxyHighlight">      emitBlock(PreCondBB, CurFunc);</span></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><span class="doxyHighlight">      PHINode &#42;PhiSrc =</span></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType(), </span><span class="doxyHighlightComment">/&#42;NumReservedValues=&#42;/</span><span class="doxyHighlight">2);</span></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><span class="doxyHighlight">      PhiSrc-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, CurrentBB);</span></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><span class="doxyHighlight">      PHINode &#42;PhiDest =</span></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(ElemPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightComment">/&#42;NumReservedValues=&#42;/</span><span class="doxyHighlight">2);</span></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><span class="doxyHighlight">      PhiDest-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(ElemPtr, CurrentBB);</span></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = PhiSrc;</span></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><span class="doxyHighlight">      ElemPtr = PhiDest;</span></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PtrDiff = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a08252ccfac4481c88092435e56a0fb3b">CreatePtrDiff</a>(</span></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7be2e1490f01c049d748436f03760c5">getInt8Ty</a>(), PtrEnd,</span></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>()));</span></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(</span></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3280551f1232a760cb7b21e85fdd5eca">CreateICmpSGT</a>(PtrDiff, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(IntSize - 1)), ThenBB,</span></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><span class="doxyHighlight">          ExitBB);</span></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><span class="doxyHighlight">      emitBlock(ThenBB, CurFunc);</span></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Res = createRuntimeShuffleFunction(</span></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><span class="doxyHighlight">          AllocaIP,</span></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3313ae2d314fb689cebdaf062d86eec5">CreateAlignedLoad</a>(</span></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><span class="doxyHighlight">              IntType, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(ElemType)),</span></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><span class="doxyHighlight">          IntType, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(Res, ElemPtr,</span></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><span class="doxyHighlight">                                 <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(ElemType));</span></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LocalPtr =</span></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(IntType, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, &#123;ConstantInt::get(IndexTy, 1)&#125;);</span></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LocalElemPtr =</span></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(IntType, ElemPtr, &#123;ConstantInt::get(IndexTy, 1)&#125;);</span></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><span class="doxyHighlight">      PhiSrc-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(LocalPtr, ThenBB);</span></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><span class="doxyHighlight">      PhiDest-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(LocalElemPtr, ThenBB);</span></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><span class="doxyHighlight">      emitBranch(PreCondBB);</span></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><span class="doxyHighlight">      emitBlock(ExitBB, CurFunc);</span></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Res = createRuntimeShuffleFunction(</span></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><span class="doxyHighlight">          AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(IntType, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>), IntType, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ElemType-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; ElemType-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &lt;</span></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><span class="doxyHighlight">                                         Res-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>())</span></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><span class="doxyHighlight">        Res = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(Res, ElemType);</span></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Res, ElemPtr);</span></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(IntType, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, &#123;ConstantInt::get(IndexTy, 1)&#125;);</span></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><span class="doxyHighlight">      ElemPtr =</span></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(IntType, ElemPtr, &#123;ConstantInt::get(IndexTy, 1)&#125;);</span></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> % IntSize;</span></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitReductionListCopy(</span></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><span class="doxyHighlight">    InsertPointTy AllocaIP, CopyAction Action, <a href="/docs/api/classes/llvm/type">Type</a> &#42;ReductionArrayTy,</span></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ReductionInfo&gt;</a> ReductionInfos, <a href="/docs/api/classes/llvm/value">Value</a> &#42;SrcBase, <a href="/docs/api/classes/llvm/value">Value</a> &#42;DestBase,</span></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><span class="doxyHighlight">    CopyOptionsTy CopyOptions) &#123;</span></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IndexTy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a50cf39b25a9fc8862b6361e22168dce7">getIndexTy</a>(</span></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout(), <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getDefaultGlobalsAddressSpace());</span></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RemoteLaneOffset = CopyOptions.RemoteLaneOffset;</span></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterates, element-by-element, through the source Reduce list and</span></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// make a copy.</span></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI = En.value();</span></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcElementAddr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DestElementAddr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DestElementPtrAddr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Should we shuffle in an element from a remote lane?</span></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ShuffleInElement = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Set to true to update the pointer in the dest Reduce list to a</span></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// newly created element.</span></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UpdateDestListPtr = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Step 1.1: Get the address for the src element in the Reduce list.</span></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcElementPtrAddr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><span class="doxyHighlight">        ReductionArrayTy, SrcBase,</span></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><span class="doxyHighlight">        &#123;ConstantInt::get(IndexTy, 0), ConstantInt::get(IndexTy, En.index())&#125;);</span></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><span class="doxyHighlight">    SrcElementAddr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), SrcElementPtrAddr);</span></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Step 1.2: Create a temporary to store the element in the destination</span></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reduce list.</span></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><span class="doxyHighlight">    DestElementPtrAddr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><span class="doxyHighlight">        ReductionArrayTy, DestBase,</span></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><span class="doxyHighlight">        &#123;ConstantInt::get(IndexTy, 0), ConstantInt::get(IndexTy, En.index())&#125;);</span></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Action) &#123;</span></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> CopyAction::RemoteLaneToThread: &#123;</span></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> CurIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><span class="doxyHighlight">      AllocaInst &#42;DestAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(RI.ElementType, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><span class="doxyHighlight">                                                    </span><span class="doxyHighlightStringLiteral">&quot;.omp.reduction.element&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><span class="doxyHighlight">      DestAlloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#af3bb24b322533dbe8a63c84b18568fe1">setAlignment</a>(</span></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(RI.ElementType));</span></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><span class="doxyHighlight">      DestElementAddr = DestAlloca;</span></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><span class="doxyHighlight">      DestElementAddr =</span></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aeb6ccc122c2f6868fc3a1e68e1ae157c">CreateAddrSpaceCast</a>(DestElementAddr, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><span class="doxyHighlight">                                      DestElementAddr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CurIP);</span></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><span class="doxyHighlight">      ShuffleInElement = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><span class="doxyHighlight">      UpdateDestListPtr = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> CopyAction::ThreadCopy: &#123;</span></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><span class="doxyHighlight">      DestElementAddr =</span></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), DestElementPtrAddr);</span></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now that all active lanes have read the element in the</span></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reduce list, shuffle over the value from the remote lane.</span></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShuffleInElement) &#123;</span></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><span class="doxyHighlight">      shuffleAndStore(AllocaIP, SrcElementAddr, DestElementAddr, RI.ElementType,</span></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><span class="doxyHighlight">                      RemoteLaneOffset, ReductionArrayTy);</span></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (RI.EvaluationKind) &#123;</span></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> EvalKind::Scalar: &#123;</span></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Elem = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(RI.ElementType, SrcElementAddr);</span></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Store the source element value to the dest element address.</span></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Elem, DestElementAddr);</span></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> EvalKind::Complex: &#123;</span></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcRealPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><span class="doxyHighlight">            RI.ElementType, SrcElementAddr, 0, 0, </span><span class="doxyHighlightStringLiteral">&quot;.realp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcReal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(</span></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><span class="doxyHighlight">            RI.ElementType-&gt;getStructElementType(0), SrcRealPtr, </span><span class="doxyHighlightStringLiteral">&quot;.real&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcImgPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><span class="doxyHighlight">            RI.ElementType, SrcElementAddr, 0, 1, </span><span class="doxyHighlightStringLiteral">&quot;.imagp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcImg = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(</span></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><span class="doxyHighlight">            RI.ElementType-&gt;getStructElementType(1), SrcImgPtr, </span><span class="doxyHighlightStringLiteral">&quot;.imag&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DestRealPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><span class="doxyHighlight">            RI.ElementType, DestElementAddr, 0, 0, </span><span class="doxyHighlightStringLiteral">&quot;.realp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DestImgPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><span class="doxyHighlight">            RI.ElementType, DestElementAddr, 0, 1, </span><span class="doxyHighlightStringLiteral">&quot;.imagp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(SrcReal, DestRealPtr);</span></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(SrcImg, DestImgPtr);</span></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> EvalKind::Aggregate: &#123;</span></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SizeVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(RI.ElementType));</span></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae9f2730f66215fdb82f4e41e45124811">CreateMemCpy</a>(</span></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><span class="doxyHighlight">            DestElementAddr, <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(RI.ElementType),</span></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><span class="doxyHighlight">            SrcElementAddr, <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(RI.ElementType),</span></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><span class="doxyHighlight">            SizeVal, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Step 3.1: Modify reference in dest Reduce list as needed.</span></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Modifying the reference in Reduce list to point to the newly</span></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// created element.  The element is live in the current function</span></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scope and that of functions it invokes (i.e., reduce&#95;function).</span></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// RemoteReduceData&#91;i&#93; = (void&#42;)&amp;RemoteElem</span></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UpdateDestListPtr) &#123;</span></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CastDestAddr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><span class="doxyHighlight">          DestElementAddr, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><span class="doxyHighlight">          DestElementAddr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(CastDestAddr, DestElementPtrAddr);</span></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/expected">Expected&lt;Function &#42;&gt;</a> OpenMPIRBuilder::emitInterWarpCopyFunction(</span></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ReductionInfo&gt;</a> ReductionInfos,</span></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><span class="doxyHighlight">    AttributeList FuncAttrs) &#123;</span></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> SavedIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><span class="doxyHighlight">  LLVMContext &amp;Ctx = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext();</span></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><span class="doxyHighlight">  FunctionType &#42;FuncTy = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(</span></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad0243f1634f75e231041023ffaa8501a">getVoidTy</a>(), &#123;Builder.getPtrTy(), Builder.getInt32Ty()&#125;,</span></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; IsVarArg &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;WcFunc =</span></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(FuncTy, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</span></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;&#95;omp&#95;reduction&#95;inter&#95;warp&#95;copy&#95;func&quot;</span><span class="doxyHighlight">, &amp;M);</span></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><span class="doxyHighlight">  WcFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9e4c6c67f4b2528b5648299db4a86926">setAttributes</a>(FuncAttrs);</span></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><span class="doxyHighlight">  WcFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(0, Attribute::NoUndef);</span></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><span class="doxyHighlight">  WcFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(1, Attribute::NoUndef);</span></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EntryBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;entry&quot;</span><span class="doxyHighlight">, WcFunc);</span></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EntryBB);</span></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ReduceList: thread local Reduce list.</span></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At the stage of the computation when this function is called, partially</span></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// aggregated values reside in the first lane of every active warp.</span></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;ReduceListArg = WcFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(0);</span></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NumWarps: number of warps active in the parallel region.  This could</span></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be smaller than 32 (max warps in a CTA) for partial block reduction.</span></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;NumWarpsArg = WcFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(1);</span></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This array is used as a medium to transfer, one reduce element at a time,</span></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the data from the first lane of every warp to lanes in the first warp</span></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in order to perform the final step of a reduction in a parallel region</span></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (reduction across warps).  The array is placed in NVPTX &#95;&#95;shared&#95;&#95; memory</span></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for reduced latency, as well as to have a distinct copy for concurrently</span></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// executing target regions.  The array is declared with common linkage so</span></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as to be shared across compilation units.</span></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><span class="doxyHighlight">  StringRef TransferMediumName =</span></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;openmp&#95;nvptx&#95;data&#95;transfer&#95;temporary&#95;storage&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><span class="doxyHighlight">  GlobalVariable &#42;TransferMedium = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getGlobalVariable(TransferMediumName);</span></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> WarpSize = Config.getGridValue().GV&#95;Warp&#95;Size;</span></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bacb17ff5177bb277ed8dd79480aad9c27">ArrayType</a> &#42;ArrayTy = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), WarpSize);</span></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TransferMedium) &#123;</span></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><span class="doxyHighlight">    TransferMedium = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> GlobalVariable(</span></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><span class="doxyHighlight">        M, ArrayTy, </span><span class="doxyHighlightComment">/&#42;isConstant=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca8d13a9bcecfac72febceb1103afa048f">GlobalVariable::WeakAnyLinkage</a>,</span></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/undefvalue/#a4ae5ff22b700a42bcc5d889233721335">UndefValue::get</a>(ArrayTy), TransferMediumName,</span></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;InsertBefore=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0">GlobalVariable::NotThreadLocal</a>,</span></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;AddressSpace=&#42;/</span><span class="doxyHighlight">3);</span></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the CUDA thread id of the current OpenMP thread on the GPU.</span></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;GPUThreadID = getGPUThreadID();</span></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// nvptx&#95;lane&#95;id = nvptx&#95;id % warpsize</span></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LaneID = getNVPTXLaneID();</span></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// nvptx&#95;warp&#95;id = nvptx&#95;id / warpsize</span></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;WarpID = getNVPTXWarpID();</span></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AllocaIP =</span></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>(),</span></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><span class="doxyHighlight">                    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Arg0Type = ReduceListArg-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Arg1Type = NumWarpsArg-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><span class="doxyHighlight">  AllocaInst &#42;ReduceListAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><span class="doxyHighlight">      Arg0Type, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ReduceListArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><span class="doxyHighlight">  AllocaInst &#42;NumWarpsAlloca =</span></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Arg1Type, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, NumWarpsArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceListAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><span class="doxyHighlight">      ReduceListAlloca, Arg0Type, ReduceListAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NumWarpsAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><span class="doxyHighlight">      NumWarpsAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(0),</span></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><span class="doxyHighlight">      NumWarpsAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(ReduceListArg, ReduceListAddrCast);</span></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(NumWarpsArg, NumWarpsAddrCast);</span></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><span class="doxyHighlight">  AllocaIP = <a href="#ab5fa59567e3acc860411770354a1603a">getInsertPointAfterInstr</a>(NumWarpsAlloca);</span></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> CodeGenIP =</span></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><span class="doxyHighlight">      <a href="#ab5fa59567e3acc860411770354a1603a">getInsertPointAfterInstr</a>(&amp;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a2d071e661a02790177ba05f62c7c27d1">back</a>());</span></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceList =</span></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ReduceListAddrCast);</span></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Warp master copies reduce element to transfer medium in &#95;&#95;shared&#95;&#95;</span></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// memory.</span></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI = En.value();</span></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> RealTySize = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeAllocSize(RI.ElementType);</span></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TySize = 4; TySize &gt; 0 &amp;&amp; RealTySize &gt; 0; TySize /= 2) &#123;</span></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;CType = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a31e2db8d1b315202d2c19e711b5365fd">getIntNTy</a>(TySize &#42; 8);</span></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumIters = RealTySize / TySize;</span></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumIters == 0)</span></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Cnt = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CntAddr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;PrecondBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ExitBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumIters &gt; 1) &#123;</span></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><span class="doxyHighlight">        CodeGenIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><span class="doxyHighlight">        CntAddr =</span></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.cnt.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><span class="doxyHighlight">        CntAddr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aeb6ccc122c2f6868fc3a1e68e1ae157c">CreateAddrSpaceCast</a>(CntAddr, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><span class="doxyHighlight">                                              CntAddr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(<a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>()),</span></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><span class="doxyHighlight">                            CntAddr,</span></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">/&#42;Volatile=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><span class="doxyHighlight">        PrecondBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;precond&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><span class="doxyHighlight">        ExitBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;exit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;BodyBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;body&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><span class="doxyHighlight">        emitBlock(PrecondBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><span class="doxyHighlight">        Cnt = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), CntAddr,</span></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><span class="doxyHighlight">                                 </span><span class="doxyHighlightComment">/&#42;Volatile=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a09b4daefdf5b73efba51ce7ae6cd45c5">CreateICmpULT</a>(</span></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><span class="doxyHighlight">            Cnt, ConstantInt::get(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), NumIters));</span></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(Cmp, BodyBB, ExitBB);</span></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><span class="doxyHighlight">        emitBlock(BodyBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// kmpc&#95;barrier.</span></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> BarrierIP1 =</span></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/openmpirbuilder/#abca6530c9099bd1b1c3e0a5c32381f07">createBarrier</a>(<a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), Loc.DL),</span></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><span class="doxyHighlight">                        omp::Directive::OMPD&#95;unknown,</span></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42; ForceSimpleCall &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42; CheckCancelFlag &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BarrierIP1)</span></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BarrierIP1.takeError();</span></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ThenBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;then&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ElseBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;else&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;MergeBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;ifcont&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// if (lane&#95;id  == 0)</span></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IsWarpMaster = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac9843b4f9f9cb144c608c48785a394a8">CreateIsNull</a>(LaneID, </span><span class="doxyHighlightStringLiteral">&quot;warp&#95;master&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(IsWarpMaster, ThenBB, ElseBB);</span></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><span class="doxyHighlight">      emitBlock(ThenBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Reduce element = LocalReduceList&#91;i&#93;</span></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RedListArrayTy =</span></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ReductionInfos.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</span></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IndexTy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a50cf39b25a9fc8862b6361e22168dce7">getIndexTy</a>(</span></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout(), <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getDefaultGlobalsAddressSpace());</span></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ElemPtrPtr =</span></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(RedListArrayTy, ReduceList,</span></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><span class="doxyHighlight">                                    &#123;ConstantInt::get(IndexTy, 0),</span></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><span class="doxyHighlight">                                     ConstantInt::get(IndexTy, En.index())&#125;);</span></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// elemptr = ((CopyType&#42;)(elemptrptr)) + I</span></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ElemPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ElemPtrPtr);</span></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumIters &gt; 1)</span></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><span class="doxyHighlight">        ElemPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), ElemPtr, Cnt);</span></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Get pointer to location in transfer medium.</span></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// MediumPtr = &amp;medium&#91;warp&#95;id&#93;</span></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;MediumPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><span class="doxyHighlight">          ArrayTy, TransferMedium, &#123;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(0), WarpID&#125;);</span></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// elem = &#42;elemptr</span></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//&#42;MediumPtr = elem</span></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Elem = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(CType, ElemPtr);</span></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Store the source element value to the dest element address.</span></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Elem, MediumPtr,</span></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42;IsVolatile&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(MergeBB);</span></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// else</span></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><span class="doxyHighlight">      emitBlock(ElseBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(MergeBB);</span></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// endif</span></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><span class="doxyHighlight">      emitBlock(MergeBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> BarrierIP2 =</span></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/openmpirbuilder/#abca6530c9099bd1b1c3e0a5c32381f07">createBarrier</a>(<a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), Loc.DL),</span></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><span class="doxyHighlight">                        omp::Directive::OMPD&#95;unknown,</span></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42; ForceSimpleCall &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42; CheckCancelFlag &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BarrierIP2)</span></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BarrierIP2.takeError();</span></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Warp 0 copies reduce element from transfer medium</span></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;W0ThenBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;then&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;W0ElseBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;else&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;W0MergeBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;ifcont&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NumWarpsVal =</span></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), NumWarpsAddrCast);</span></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Up to 32 threads in warp 0 are active.</span></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IsActiveThread =</span></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a09b4daefdf5b73efba51ce7ae6cd45c5">CreateICmpULT</a>(GPUThreadID, NumWarpsVal, </span><span class="doxyHighlightStringLiteral">&quot;is&#95;active&#95;thread&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(IsActiveThread, W0ThenBB, W0ElseBB);</span></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><span class="doxyHighlight">      emitBlock(W0ThenBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// SecMediumPtr = &amp;medium&#91;tid&#93;</span></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// SrcMediumVal = &#42;SrcMediumPtr</span></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcMediumPtrVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><span class="doxyHighlight">          ArrayTy, TransferMedium, &#123;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(0), GPUThreadID&#125;);</span></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TargetElemPtr = (CopyType&#42;)(SrcDataAddr&#91;i&#93;) + I</span></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TargetElemPtrPtr =</span></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(RedListArrayTy, ReduceList,</span></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><span class="doxyHighlight">                                    &#123;ConstantInt::get(IndexTy, 0),</span></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><span class="doxyHighlight">                                     ConstantInt::get(IndexTy, En.index())&#125;);</span></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TargetElemPtrVal =</span></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), TargetElemPtrPtr);</span></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TargetElemPtr = TargetElemPtrVal;</span></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumIters &gt; 1)</span></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><span class="doxyHighlight">        TargetElemPtr =</span></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), TargetElemPtr, Cnt);</span></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// &#42;TargetElemPtr = SrcMediumVal;</span></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcMediumValue =</span></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(CType, SrcMediumPtrVal, </span><span class="doxyHighlightComment">/&#42;IsVolatile&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(SrcMediumValue, TargetElemPtr);</span></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(W0MergeBB);</span></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><span class="doxyHighlight">      emitBlock(W0ElseBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(W0MergeBB);</span></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><span class="doxyHighlight">      emitBlock(W0MergeBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumIters &gt; 1) &#123;</span></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><span class="doxyHighlight">        Cnt = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5d708ffeb74e4eb145b9dca1bfd5627f">CreateNSWAdd</a>(</span></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><span class="doxyHighlight">            Cnt, ConstantInt::get(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), </span><span class="doxyHighlightComment">/&#42;V=&#42;/</span><span class="doxyHighlight">1));</span></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Cnt, CntAddr, </span><span class="doxyHighlightComment">/&#42;Volatile=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CurFn = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><span class="doxyHighlight">        emitBranch(PrecondBB);</span></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><span class="doxyHighlight">        emitBlock(ExitBB, CurFn);</span></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><span class="doxyHighlight">      RealTySize %= TySize;</span></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(SavedIP);</span></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WcFunc;</span></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/function">Function</a> &#42;OpenMPIRBuilder::emitShuffleAndReduceFunction(</span></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ReductionInfo&gt;</a> ReductionInfos, <a href="/docs/api/classes/llvm/function">Function</a> &#42;ReduceFn,</span></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><span class="doxyHighlight">    AttributeList FuncAttrs) &#123;</span></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><span class="doxyHighlight">  LLVMContext &amp;Ctx = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext();</span></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><span class="doxyHighlight">  FunctionType &#42;FuncTy =</span></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad0243f1634f75e231041023ffaa8501a">getVoidTy</a>(),</span></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><span class="doxyHighlight">                        &#123;Builder.getPtrTy(), Builder.getInt16Ty(),</span></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><span class="doxyHighlight">                         Builder.getInt16Ty(), Builder.getInt16Ty()&#125;,</span></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42; IsVarArg &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;SarFunc =</span></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(FuncTy, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</span></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;&#95;omp&#95;reduction&#95;shuffle&#95;and&#95;reduce&#95;func&quot;</span><span class="doxyHighlight">, &amp;M);</span></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><span class="doxyHighlight">  SarFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9e4c6c67f4b2528b5648299db4a86926">setAttributes</a>(FuncAttrs);</span></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><span class="doxyHighlight">  SarFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(0, Attribute::NoUndef);</span></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><span class="doxyHighlight">  SarFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(1, Attribute::NoUndef);</span></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><span class="doxyHighlight">  SarFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(2, Attribute::NoUndef);</span></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><span class="doxyHighlight">  SarFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(3, Attribute::NoUndef);</span></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><span class="doxyHighlight">  SarFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(1, Attribute::SExt);</span></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><span class="doxyHighlight">  SarFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(2, Attribute::SExt);</span></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><span class="doxyHighlight">  SarFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(3, Attribute::SExt);</span></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EntryBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;entry&quot;</span><span class="doxyHighlight">, SarFunc);</span></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EntryBB);</span></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Thread local Reduce list used to host the values of data to be reduced.</span></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;ReduceListArg = SarFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(0);</span></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Current lane id; could be logical.</span></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;LaneIDArg = SarFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(1);</span></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Offset of the remote source lane relative to the current lane.</span></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;RemoteLaneOffsetArg = SarFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(2);</span></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Algorithm version.  This is expected to be known at compile time.</span></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;AlgoVerArg = SarFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(3);</span></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ReduceListArgType = ReduceListArg-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;LaneIDArgType = LaneIDArg-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;LaneIDArgPtrType = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(0);</span></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceListAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><span class="doxyHighlight">      ReduceListArgType, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ReduceListArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LaneIdAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(LaneIDArgType, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><span class="doxyHighlight">                                             LaneIDArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RemoteLaneOffsetAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><span class="doxyHighlight">      LaneIDArgType, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, RemoteLaneOffsetArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;AlgoVerAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(LaneIDArgType, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><span class="doxyHighlight">                                              AlgoVerArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bacb17ff5177bb277ed8dd79480aad9c27">ArrayType</a> &#42;RedListArrayTy =</span></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ReductionInfos.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</span></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a local thread-private variable to host the Reduce list</span></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from a remote lane.</span></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;RemoteReductionListAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><span class="doxyHighlight">      RedListArrayTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.omp.reduction.remote&#95;reduce&#95;list&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceListAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><span class="doxyHighlight">      ReduceListAlloca, ReduceListArgType,</span></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><span class="doxyHighlight">      ReduceListAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LaneIdAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><span class="doxyHighlight">      LaneIdAlloca, LaneIDArgPtrType, LaneIdAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RemoteLaneOffsetAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><span class="doxyHighlight">      RemoteLaneOffsetAlloca, LaneIDArgPtrType,</span></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><span class="doxyHighlight">      RemoteLaneOffsetAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;AlgoVerAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><span class="doxyHighlight">      AlgoVerAlloca, LaneIDArgPtrType, AlgoVerAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RemoteListAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><span class="doxyHighlight">      RemoteReductionListAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><span class="doxyHighlight">      RemoteReductionListAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(ReduceListArg, ReduceListAddrCast);</span></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(LaneIDArg, LaneIdAddrCast);</span></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(RemoteLaneOffsetArg, RemoteLaneOffsetAddrCast);</span></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(AlgoVerArg, AlgoVerAddrCast);</span></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceList = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(ReduceListArgType, ReduceListAddrCast);</span></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LaneId = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(LaneIDArgType, LaneIdAddrCast);</span></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RemoteLaneOffset =</span></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(LaneIDArgType, RemoteLaneOffsetAddrCast);</span></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;AlgoVer = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(LaneIDArgType, AlgoVerAddrCast);</span></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AllocaIP = <a href="#ab5fa59567e3acc860411770354a1603a">getInsertPointAfterInstr</a>(RemoteReductionListAlloca);</span></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This loop iterates through the list of reduce elements and copies,</span></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// element by element, from a remote lane in the warp to RemoteReduceList,</span></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// hosted on the thread&#39;s stack.</span></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><span class="doxyHighlight">  emitReductionListCopy(</span></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><span class="doxyHighlight">      AllocaIP, CopyAction::RemoteLaneToThread, RedListArrayTy, ReductionInfos,</span></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><span class="doxyHighlight">      ReduceList, RemoteListAddrCast, &#123;RemoteLaneOffset, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">&#125;);</span></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The actions to be performed on the Remote Reduce list is dependent</span></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// on the algorithm version.</span></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  if (AlgoVer==0) || (AlgoVer==1 &amp;&amp; (LaneId &lt; Offset)) || (AlgoVer==2 &amp;&amp;</span></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  LaneId % 2 == 0 &amp;&amp; Offset &gt; 0):</span></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    do the reduction value aggregation</span></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  The thread local variable Reduce list is mutated in place to host the</span></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  reduced data, which is the aggregated value produced from local and</span></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  remote lanes.</span></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  Note that AlgoVer is expected to be a constant integer known at compile</span></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  time.</span></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  When AlgoVer==0, the first conjunction evaluates to true, making</span></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    the entire predicate true during compile time.</span></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  When AlgoVer==1, the second conjunction has only the second part to be</span></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    evaluated during runtime.  Other conjunctions evaluates to false</span></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    during compile time.</span></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  When AlgoVer==2, the third conjunction has only the second part to be</span></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    evaluated during runtime.  Other conjunctions evaluates to false</span></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    during compile time.</span></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CondAlgo0 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac9843b4f9f9cb144c608c48785a394a8">CreateIsNull</a>(AlgoVer);</span></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Algo1 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(AlgoVer, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac33b7f085ea15691aa45a61ef207d603">getInt16</a>(1));</span></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LaneComp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a09b4daefdf5b73efba51ce7ae6cd45c5">CreateICmpULT</a>(LaneId, RemoteLaneOffset);</span></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CondAlgo1 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(Algo1, LaneComp);</span></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Algo2 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(AlgoVer, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac33b7f085ea15691aa45a61ef207d603">getInt16</a>(2));</span></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LaneIdAnd1 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(LaneId, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac33b7f085ea15691aa45a61ef207d603">getInt16</a>(1));</span></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LaneIdComp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac9843b4f9f9cb144c608c48785a394a8">CreateIsNull</a>(LaneIdAnd1);</span></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Algo2AndLaneIdComp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(Algo2, LaneIdComp);</span></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RemoteOffsetComp =</span></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3280551f1232a760cb7b21e85fdd5eca">CreateICmpSGT</a>(RemoteLaneOffset, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac33b7f085ea15691aa45a61ef207d603">getInt16</a>(0));</span></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CondAlgo2 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(Algo2AndLaneIdComp, RemoteOffsetComp);</span></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CA0OrCA1 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab61be8e3cf17e9848aeeeabacfa1b09a">CreateOr</a>(CondAlgo0, CondAlgo1);</span></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CondReduce = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab61be8e3cf17e9848aeeeabacfa1b09a">CreateOr</a>(CA0OrCA1, CondAlgo2);</span></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ThenBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;then&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ElseBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;else&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;MergeBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;ifcont&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(CondReduce, ThenBB, ElseBB);</span></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><span class="doxyHighlight">  emitBlock(ThenBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LocalReduceListPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><span class="doxyHighlight">      ReduceList, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RemoteReduceListPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><span class="doxyHighlight">      RemoteListAddrCast, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(ReduceFn, &#123;LocalReduceListPtr, RemoteReduceListPtr&#125;)</span></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><span class="doxyHighlight">      -&gt;addFnAttr(Attribute::NoUnwind);</span></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(MergeBB);</span></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><span class="doxyHighlight">  emitBlock(ElseBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(MergeBB);</span></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><span class="doxyHighlight">  emitBlock(MergeBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if (AlgoVer==1 &amp;&amp; (LaneId &gt;= Offset)) copy Remote Reduce list to local</span></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reduce list.</span></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><span class="doxyHighlight">  Algo1 = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(AlgoVer, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac33b7f085ea15691aa45a61ef207d603">getInt16</a>(1));</span></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LaneIdGtOffset = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac613fa8e66fca464885c3f274fbeb834">CreateICmpUGE</a>(LaneId, RemoteLaneOffset);</span></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CondCopy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(Algo1, LaneIdGtOffset);</span></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CpyThenBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;then&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CpyElseBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;else&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CpyMergeBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;ifcont&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(CondCopy, CpyThenBB, CpyElseBB);</span></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><span class="doxyHighlight">  emitBlock(CpyThenBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><span class="doxyHighlight">  emitReductionListCopy(AllocaIP, CopyAction::ThreadCopy, RedListArrayTy,</span></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><span class="doxyHighlight">                        ReductionInfos, RemoteListAddrCast, ReduceList);</span></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(CpyMergeBB);</span></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><span class="doxyHighlight">  emitBlock(CpyElseBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(CpyMergeBB);</span></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><span class="doxyHighlight">  emitBlock(CpyMergeBB, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SarFunc;</span></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/function">Function</a> &#42;OpenMPIRBuilder::emitListToGlobalCopyFunction(</span></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ReductionInfo&gt;</a> ReductionInfos, <a href="/docs/api/classes/llvm/type">Type</a> &#42;ReductionsBufferTy,</span></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><span class="doxyHighlight">    AttributeList FuncAttrs) &#123;</span></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> OldIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><span class="doxyHighlight">  LLVMContext &amp;Ctx = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext();</span></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><span class="doxyHighlight">  FunctionType &#42;FuncTy = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(</span></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad0243f1634f75e231041023ffaa8501a">getVoidTy</a>(),</span></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><span class="doxyHighlight">      &#123;Builder.getPtrTy(), Builder.getInt32Ty(), Builder.getPtrTy()&#125;,</span></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; IsVarArg &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;LtGCFunc =</span></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(FuncTy, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</span></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;&#95;omp&#95;reduction&#95;list&#95;to&#95;global&#95;copy&#95;func&quot;</span><span class="doxyHighlight">, &amp;M);</span></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><span class="doxyHighlight">  LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9e4c6c67f4b2528b5648299db4a86926">setAttributes</a>(FuncAttrs);</span></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><span class="doxyHighlight">  LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(0, Attribute::NoUndef);</span></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><span class="doxyHighlight">  LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(1, Attribute::NoUndef);</span></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><span class="doxyHighlight">  LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(2, Attribute::NoUndef);</span></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EntryBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;entry&quot;</span><span class="doxyHighlight">, LtGCFunc);</span></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EntryBlock);</span></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Buffer: global reduction buffer.</span></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;BufferArg = LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(0);</span></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Idx: index of the buffer.</span></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;IdxArg = LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(1);</span></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ReduceList: thread local Reduce list.</span></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;ReduceListArg = LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(2);</span></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferArgAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><span class="doxyHighlight">                                                BufferArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IdxArgAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><span class="doxyHighlight">                                             IdxArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceListArgAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ReduceListArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferArgAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056"><span class="doxyHighlight">      BufferArgAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057"><span class="doxyHighlight">      BufferArgAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IdxArgAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059"><span class="doxyHighlight">      IdxArgAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), IdxArgAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceListArgAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"><span class="doxyHighlight">      ReduceListArgAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062"><span class="doxyHighlight">      ReduceListArgAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063"></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(BufferArg, BufferArgAddrCast);</span></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(IdxArg, IdxArgAddrCast);</span></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(ReduceListArg, ReduceListArgAddrCast);</span></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067"></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LocalReduceList =</span></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ReduceListArgAddrCast);</span></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferArgVal =</span></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), BufferArgAddrCast);</span></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Idxs&#91;&#93; = &#123;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), IdxArgAddrCast)&#125;;</span></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IndexTy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a50cf39b25a9fc8862b6361e22168dce7">getIndexTy</a>(</span></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout(), <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getDefaultGlobalsAddressSpace());</span></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI = En.value();</span></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RedListArrayTy =</span></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ReductionInfos.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</span></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reduce element = LocalReduceList&#91;i&#93;</span></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ElemPtrPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><span class="doxyHighlight">        RedListArrayTy, LocalReduceList,</span></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><span class="doxyHighlight">        &#123;ConstantInt::get(IndexTy, 0), ConstantInt::get(IndexTy, En.index())&#125;);</span></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// elemptr = ((CopyType&#42;)(elemptrptr)) + I</span></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ElemPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ElemPtrPtr);</span></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085"></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Global = Buffer.VD&#91;Idx&#93;;</span></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferVD =</span></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(ReductionsBufferTy, BufferArgVal, Idxs);</span></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;GlobVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><span class="doxyHighlight">        ReductionsBufferTy, BufferVD, 0, En.index());</span></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (RI.EvaluationKind) &#123;</span></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> EvalKind::Scalar: &#123;</span></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TargetElement = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(RI.ElementType, ElemPtr);</span></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(TargetElement, GlobVal);</span></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> EvalKind::Complex: &#123;</span></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcRealPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"><span class="doxyHighlight">          RI.ElementType, ElemPtr, 0, 0, </span><span class="doxyHighlightStringLiteral">&quot;.realp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcReal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(</span></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"><span class="doxyHighlight">          RI.ElementType-&gt;getStructElementType(0), SrcRealPtr, </span><span class="doxyHighlightStringLiteral">&quot;.real&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcImgPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104"><span class="doxyHighlight">          RI.ElementType, ElemPtr, 0, 1, </span><span class="doxyHighlightStringLiteral">&quot;.imagp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcImg = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(</span></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><span class="doxyHighlight">          RI.ElementType-&gt;getStructElementType(1), SrcImgPtr, </span><span class="doxyHighlightStringLiteral">&quot;.imag&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DestRealPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"><span class="doxyHighlight">          RI.ElementType, GlobVal, 0, 0, </span><span class="doxyHighlightStringLiteral">&quot;.realp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DestImgPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"><span class="doxyHighlight">          RI.ElementType, GlobVal, 0, 1, </span><span class="doxyHighlightStringLiteral">&quot;.imagp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(SrcReal, DestRealPtr);</span></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(SrcImg, DestImgPtr);</span></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> EvalKind::Aggregate: &#123;</span></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SizeVal =</span></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(RI.ElementType));</span></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae9f2730f66215fdb82f4e41e45124811">CreateMemCpy</a>(</span></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><span class="doxyHighlight">          GlobVal, <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(RI.ElementType), ElemPtr,</span></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(RI.ElementType), SizeVal, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(OldIP);</span></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LtGCFunc;</span></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/function">Function</a> &#42;OpenMPIRBuilder::emitListToGlobalReduceFunction(</span></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ReductionInfo&gt;</a> ReductionInfos, <a href="/docs/api/classes/llvm/function">Function</a> &#42;ReduceFn,</span></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ReductionsBufferTy, AttributeList FuncAttrs) &#123;</span></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> OldIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><span class="doxyHighlight">  LLVMContext &amp;Ctx = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext();</span></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><span class="doxyHighlight">  FunctionType &#42;FuncTy = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(</span></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad0243f1634f75e231041023ffaa8501a">getVoidTy</a>(),</span></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><span class="doxyHighlight">      &#123;Builder.getPtrTy(), Builder.getInt32Ty(), Builder.getPtrTy()&#125;,</span></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; IsVarArg &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;LtGRFunc =</span></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(FuncTy, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</span></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;&#95;omp&#95;reduction&#95;list&#95;to&#95;global&#95;reduce&#95;func&quot;</span><span class="doxyHighlight">, &amp;M);</span></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><span class="doxyHighlight">  LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9e4c6c67f4b2528b5648299db4a86926">setAttributes</a>(FuncAttrs);</span></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><span class="doxyHighlight">  LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(0, Attribute::NoUndef);</span></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"><span class="doxyHighlight">  LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(1, Attribute::NoUndef);</span></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147"><span class="doxyHighlight">  LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(2, Attribute::NoUndef);</span></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EntryBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;entry&quot;</span><span class="doxyHighlight">, LtGRFunc);</span></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EntryBlock);</span></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Buffer: global reduction buffer.</span></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;BufferArg = LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(0);</span></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Idx: index of the buffer.</span></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;IdxArg = LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(1);</span></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ReduceList: thread local Reduce list.</span></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;ReduceListArg = LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(2);</span></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferArgAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"><span class="doxyHighlight">                                                BufferArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IdxArgAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"><span class="doxyHighlight">                                             IdxArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceListArgAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ReduceListArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RedListArrayTy =</span></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ReductionInfos.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</span></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 Build a list of reduction variables.</span></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// void &#42;RedList&#91;&lt;n&gt;&#93; = &#123;&lt;ReductionVars&gt;&#91;0&#93;, ..., &lt;ReductionVars&gt;&#91;&lt;n&gt;-1&#93;&#125;;</span></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LocalReduceList =</span></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(RedListArrayTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.omp.reduction.red&#95;list&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferArgAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174"><span class="doxyHighlight">      BufferArgAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175"><span class="doxyHighlight">      BufferArgAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IdxArgAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><span class="doxyHighlight">      IdxArgAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), IdxArgAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceListArgAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><span class="doxyHighlight">      ReduceListArgAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><span class="doxyHighlight">      ReduceListArgAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LocalReduceListAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"><span class="doxyHighlight">      LocalReduceList, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><span class="doxyHighlight">      LocalReduceList-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(BufferArg, BufferArgAddrCast);</span></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(IdxArg, IdxArgAddrCast);</span></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(ReduceListArg, ReduceListArgAddrCast);</span></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188"></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), BufferArgAddrCast);</span></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Idxs&#91;&#93; = &#123;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), IdxArgAddrCast)&#125;;</span></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IndexTy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a50cf39b25a9fc8862b6361e22168dce7">getIndexTy</a>(</span></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout(), <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getDefaultGlobalsAddressSpace());</span></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TargetElementPtrPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><span class="doxyHighlight">        RedListArrayTy, LocalReduceListAddrCast,</span></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><span class="doxyHighlight">        &#123;ConstantInt::get(IndexTy, 0), ConstantInt::get(IndexTy, En.index())&#125;);</span></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferVD =</span></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(ReductionsBufferTy, BufferVal, Idxs);</span></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Global = Buffer.VD&#91;Idx&#93;;</span></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;GlobValPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"><span class="doxyHighlight">        ReductionsBufferTy, BufferVD, 0, En.index());</span></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(GlobValPtr, TargetElementPtrPtr);</span></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Call reduce&#95;function(GlobalReduceList, ReduceList)</span></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceList =</span></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ReduceListArgAddrCast);</span></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(ReduceFn, &#123;LocalReduceListAddrCast, ReduceList&#125;)</span></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"><span class="doxyHighlight">      -&gt;addFnAttr(Attribute::NoUnwind);</span></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l03211" /><CodeLine lineNumber="3211"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(OldIP);</span></CodeLine>
<Link id="l03212" /><CodeLine lineNumber="3212"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LtGRFunc;</span></CodeLine>
<Link id="l03213" /><CodeLine lineNumber="3213"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03214" /><CodeLine lineNumber="3214"></CodeLine>
<Link id="l03215" /><CodeLine lineNumber="3215"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/function">Function</a> &#42;OpenMPIRBuilder::emitGlobalToListCopyFunction(</span></CodeLine>
<Link id="l03216" /><CodeLine lineNumber="3216"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ReductionInfo&gt;</a> ReductionInfos, <a href="/docs/api/classes/llvm/type">Type</a> &#42;ReductionsBufferTy,</span></CodeLine>
<Link id="l03217" /><CodeLine lineNumber="3217"><span class="doxyHighlight">    AttributeList FuncAttrs) &#123;</span></CodeLine>
<Link id="l03218" /><CodeLine lineNumber="3218"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> OldIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l03219" /><CodeLine lineNumber="3219"><span class="doxyHighlight">  LLVMContext &amp;Ctx = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext();</span></CodeLine>
<Link id="l03220" /><CodeLine lineNumber="3220"><span class="doxyHighlight">  FunctionType &#42;FuncTy = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(</span></CodeLine>
<Link id="l03221" /><CodeLine lineNumber="3221"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad0243f1634f75e231041023ffaa8501a">getVoidTy</a>(),</span></CodeLine>
<Link id="l03222" /><CodeLine lineNumber="3222"><span class="doxyHighlight">      &#123;Builder.getPtrTy(), Builder.getInt32Ty(), Builder.getPtrTy()&#125;,</span></CodeLine>
<Link id="l03223" /><CodeLine lineNumber="3223"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; IsVarArg &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03224" /><CodeLine lineNumber="3224"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;LtGCFunc =</span></CodeLine>
<Link id="l03225" /><CodeLine lineNumber="3225"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(FuncTy, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</span></CodeLine>
<Link id="l03226" /><CodeLine lineNumber="3226"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;&#95;omp&#95;reduction&#95;global&#95;to&#95;list&#95;copy&#95;func&quot;</span><span class="doxyHighlight">, &amp;M);</span></CodeLine>
<Link id="l03227" /><CodeLine lineNumber="3227"><span class="doxyHighlight">  LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9e4c6c67f4b2528b5648299db4a86926">setAttributes</a>(FuncAttrs);</span></CodeLine>
<Link id="l03228" /><CodeLine lineNumber="3228"><span class="doxyHighlight">  LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(0, Attribute::NoUndef);</span></CodeLine>
<Link id="l03229" /><CodeLine lineNumber="3229"><span class="doxyHighlight">  LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(1, Attribute::NoUndef);</span></CodeLine>
<Link id="l03230" /><CodeLine lineNumber="3230"><span class="doxyHighlight">  LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(2, Attribute::NoUndef);</span></CodeLine>
<Link id="l03231" /><CodeLine lineNumber="3231"></CodeLine>
<Link id="l03232" /><CodeLine lineNumber="3232"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EntryBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;entry&quot;</span><span class="doxyHighlight">, LtGCFunc);</span></CodeLine>
<Link id="l03233" /><CodeLine lineNumber="3233"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EntryBlock);</span></CodeLine>
<Link id="l03234" /><CodeLine lineNumber="3234"></CodeLine>
<Link id="l03235" /><CodeLine lineNumber="3235"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Buffer: global reduction buffer.</span></CodeLine>
<Link id="l03236" /><CodeLine lineNumber="3236"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;BufferArg = LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(0);</span></CodeLine>
<Link id="l03237" /><CodeLine lineNumber="3237"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Idx: index of the buffer.</span></CodeLine>
<Link id="l03238" /><CodeLine lineNumber="3238"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;IdxArg = LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(1);</span></CodeLine>
<Link id="l03239" /><CodeLine lineNumber="3239"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ReduceList: thread local Reduce list.</span></CodeLine>
<Link id="l03240" /><CodeLine lineNumber="3240"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;ReduceListArg = LtGCFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(2);</span></CodeLine>
<Link id="l03241" /><CodeLine lineNumber="3241"></CodeLine>
<Link id="l03242" /><CodeLine lineNumber="3242"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferArgAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03243" /><CodeLine lineNumber="3243"><span class="doxyHighlight">                                                BufferArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03244" /><CodeLine lineNumber="3244"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IdxArgAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03245" /><CodeLine lineNumber="3245"><span class="doxyHighlight">                                             IdxArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03246" /><CodeLine lineNumber="3246"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceListArgAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l03247" /><CodeLine lineNumber="3247"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ReduceListArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03248" /><CodeLine lineNumber="3248"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferArgAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03249" /><CodeLine lineNumber="3249"><span class="doxyHighlight">      BufferArgAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l03250" /><CodeLine lineNumber="3250"><span class="doxyHighlight">      BufferArgAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03251" /><CodeLine lineNumber="3251"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IdxArgAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03252" /><CodeLine lineNumber="3252"><span class="doxyHighlight">      IdxArgAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), IdxArgAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03253" /><CodeLine lineNumber="3253"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceListArgAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03254" /><CodeLine lineNumber="3254"><span class="doxyHighlight">      ReduceListArgAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l03255" /><CodeLine lineNumber="3255"><span class="doxyHighlight">      ReduceListArgAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03256" /><CodeLine lineNumber="3256"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(BufferArg, BufferArgAddrCast);</span></CodeLine>
<Link id="l03257" /><CodeLine lineNumber="3257"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(IdxArg, IdxArgAddrCast);</span></CodeLine>
<Link id="l03258" /><CodeLine lineNumber="3258"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(ReduceListArg, ReduceListArgAddrCast);</span></CodeLine>
<Link id="l03259" /><CodeLine lineNumber="3259"></CodeLine>
<Link id="l03260" /><CodeLine lineNumber="3260"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LocalReduceList =</span></CodeLine>
<Link id="l03261" /><CodeLine lineNumber="3261"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ReduceListArgAddrCast);</span></CodeLine>
<Link id="l03262" /><CodeLine lineNumber="3262"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), BufferArgAddrCast);</span></CodeLine>
<Link id="l03263" /><CodeLine lineNumber="3263"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Idxs&#91;&#93; = &#123;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), IdxArgAddrCast)&#125;;</span></CodeLine>
<Link id="l03264" /><CodeLine lineNumber="3264"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IndexTy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a50cf39b25a9fc8862b6361e22168dce7">getIndexTy</a>(</span></CodeLine>
<Link id="l03265" /><CodeLine lineNumber="3265"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout(), <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getDefaultGlobalsAddressSpace());</span></CodeLine>
<Link id="l03266" /><CodeLine lineNumber="3266"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l03267" /><CodeLine lineNumber="3267"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> OpenMPIRBuilder::ReductionInfo &amp;RI = En.value();</span></CodeLine>
<Link id="l03268" /><CodeLine lineNumber="3268"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RedListArrayTy =</span></CodeLine>
<Link id="l03269" /><CodeLine lineNumber="3269"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ReductionInfos.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</span></CodeLine>
<Link id="l03270" /><CodeLine lineNumber="3270"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reduce element = LocalReduceList&#91;i&#93;</span></CodeLine>
<Link id="l03271" /><CodeLine lineNumber="3271"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ElemPtrPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l03272" /><CodeLine lineNumber="3272"><span class="doxyHighlight">        RedListArrayTy, LocalReduceList,</span></CodeLine>
<Link id="l03273" /><CodeLine lineNumber="3273"><span class="doxyHighlight">        &#123;ConstantInt::get(IndexTy, 0), ConstantInt::get(IndexTy, En.index())&#125;);</span></CodeLine>
<Link id="l03274" /><CodeLine lineNumber="3274"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// elemptr = ((CopyType&#42;)(elemptrptr)) + I</span></CodeLine>
<Link id="l03275" /><CodeLine lineNumber="3275"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ElemPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ElemPtrPtr);</span></CodeLine>
<Link id="l03276" /><CodeLine lineNumber="3276"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Global = Buffer.VD&#91;Idx&#93;;</span></CodeLine>
<Link id="l03277" /><CodeLine lineNumber="3277"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferVD =</span></CodeLine>
<Link id="l03278" /><CodeLine lineNumber="3278"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(ReductionsBufferTy, BufferVal, Idxs);</span></CodeLine>
<Link id="l03279" /><CodeLine lineNumber="3279"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;GlobValPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l03280" /><CodeLine lineNumber="3280"><span class="doxyHighlight">        ReductionsBufferTy, BufferVD, 0, En.index());</span></CodeLine>
<Link id="l03281" /><CodeLine lineNumber="3281"></CodeLine>
<Link id="l03282" /><CodeLine lineNumber="3282"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (RI.EvaluationKind) &#123;</span></CodeLine>
<Link id="l03283" /><CodeLine lineNumber="3283"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> EvalKind::Scalar: &#123;</span></CodeLine>
<Link id="l03284" /><CodeLine lineNumber="3284"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TargetElement = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(RI.ElementType, GlobValPtr);</span></CodeLine>
<Link id="l03285" /><CodeLine lineNumber="3285"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(TargetElement, ElemPtr);</span></CodeLine>
<Link id="l03286" /><CodeLine lineNumber="3286"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03287" /><CodeLine lineNumber="3287"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03288" /><CodeLine lineNumber="3288"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> EvalKind::Complex: &#123;</span></CodeLine>
<Link id="l03289" /><CodeLine lineNumber="3289"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcRealPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l03290" /><CodeLine lineNumber="3290"><span class="doxyHighlight">          RI.ElementType, GlobValPtr, 0, 0, </span><span class="doxyHighlightStringLiteral">&quot;.realp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03291" /><CodeLine lineNumber="3291"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcReal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(</span></CodeLine>
<Link id="l03292" /><CodeLine lineNumber="3292"><span class="doxyHighlight">          RI.ElementType-&gt;getStructElementType(0), SrcRealPtr, </span><span class="doxyHighlightStringLiteral">&quot;.real&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03293" /><CodeLine lineNumber="3293"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcImgPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l03294" /><CodeLine lineNumber="3294"><span class="doxyHighlight">          RI.ElementType, GlobValPtr, 0, 1, </span><span class="doxyHighlightStringLiteral">&quot;.imagp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03295" /><CodeLine lineNumber="3295"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcImg = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(</span></CodeLine>
<Link id="l03296" /><CodeLine lineNumber="3296"><span class="doxyHighlight">          RI.ElementType-&gt;getStructElementType(1), SrcImgPtr, </span><span class="doxyHighlightStringLiteral">&quot;.imag&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03297" /><CodeLine lineNumber="3297"></CodeLine>
<Link id="l03298" /><CodeLine lineNumber="3298"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DestRealPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l03299" /><CodeLine lineNumber="3299"><span class="doxyHighlight">          RI.ElementType, ElemPtr, 0, 0, </span><span class="doxyHighlightStringLiteral">&quot;.realp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03300" /><CodeLine lineNumber="3300"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DestImgPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l03301" /><CodeLine lineNumber="3301"><span class="doxyHighlight">          RI.ElementType, ElemPtr, 0, 1, </span><span class="doxyHighlightStringLiteral">&quot;.imagp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03302" /><CodeLine lineNumber="3302"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(SrcReal, DestRealPtr);</span></CodeLine>
<Link id="l03303" /><CodeLine lineNumber="3303"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(SrcImg, DestImgPtr);</span></CodeLine>
<Link id="l03304" /><CodeLine lineNumber="3304"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03305" /><CodeLine lineNumber="3305"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03306" /><CodeLine lineNumber="3306"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> EvalKind::Aggregate: &#123;</span></CodeLine>
<Link id="l03307" /><CodeLine lineNumber="3307"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SizeVal =</span></CodeLine>
<Link id="l03308" /><CodeLine lineNumber="3308"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(RI.ElementType));</span></CodeLine>
<Link id="l03309" /><CodeLine lineNumber="3309"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae9f2730f66215fdb82f4e41e45124811">CreateMemCpy</a>(</span></CodeLine>
<Link id="l03310" /><CodeLine lineNumber="3310"><span class="doxyHighlight">          ElemPtr, <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(RI.ElementType),</span></CodeLine>
<Link id="l03311" /><CodeLine lineNumber="3311"><span class="doxyHighlight">          GlobValPtr, <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(RI.ElementType),</span></CodeLine>
<Link id="l03312" /><CodeLine lineNumber="3312"><span class="doxyHighlight">          SizeVal, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03313" /><CodeLine lineNumber="3313"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03314" /><CodeLine lineNumber="3314"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03315" /><CodeLine lineNumber="3315"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03316" /><CodeLine lineNumber="3316"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03317" /><CodeLine lineNumber="3317"></CodeLine>
<Link id="l03318" /><CodeLine lineNumber="3318"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l03319" /><CodeLine lineNumber="3319"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(OldIP);</span></CodeLine>
<Link id="l03320" /><CodeLine lineNumber="3320"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LtGCFunc;</span></CodeLine>
<Link id="l03321" /><CodeLine lineNumber="3321"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03322" /><CodeLine lineNumber="3322"></CodeLine>
<Link id="l03323" /><CodeLine lineNumber="3323"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/function">Function</a> &#42;OpenMPIRBuilder::emitGlobalToListReduceFunction(</span></CodeLine>
<Link id="l03324" /><CodeLine lineNumber="3324"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ReductionInfo&gt;</a> ReductionInfos, <a href="/docs/api/classes/llvm/function">Function</a> &#42;ReduceFn,</span></CodeLine>
<Link id="l03325" /><CodeLine lineNumber="3325"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ReductionsBufferTy, AttributeList FuncAttrs) &#123;</span></CodeLine>
<Link id="l03326" /><CodeLine lineNumber="3326"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> OldIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l03327" /><CodeLine lineNumber="3327"><span class="doxyHighlight">  LLVMContext &amp;Ctx = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext();</span></CodeLine>
<Link id="l03328" /><CodeLine lineNumber="3328"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FuncTy = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(</span></CodeLine>
<Link id="l03329" /><CodeLine lineNumber="3329"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad0243f1634f75e231041023ffaa8501a">getVoidTy</a>(),</span></CodeLine>
<Link id="l03330" /><CodeLine lineNumber="3330"><span class="doxyHighlight">      &#123;Builder.getPtrTy(), Builder.getInt32Ty(), Builder.getPtrTy()&#125;,</span></CodeLine>
<Link id="l03331" /><CodeLine lineNumber="3331"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42; IsVarArg &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03332" /><CodeLine lineNumber="3332"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;LtGRFunc =</span></CodeLine>
<Link id="l03333" /><CodeLine lineNumber="3333"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(FuncTy, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</span></CodeLine>
<Link id="l03334" /><CodeLine lineNumber="3334"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;&#95;omp&#95;reduction&#95;global&#95;to&#95;list&#95;reduce&#95;func&quot;</span><span class="doxyHighlight">, &amp;M);</span></CodeLine>
<Link id="l03335" /><CodeLine lineNumber="3335"><span class="doxyHighlight">  LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9e4c6c67f4b2528b5648299db4a86926">setAttributes</a>(FuncAttrs);</span></CodeLine>
<Link id="l03336" /><CodeLine lineNumber="3336"><span class="doxyHighlight">  LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(0, Attribute::NoUndef);</span></CodeLine>
<Link id="l03337" /><CodeLine lineNumber="3337"><span class="doxyHighlight">  LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(1, Attribute::NoUndef);</span></CodeLine>
<Link id="l03338" /><CodeLine lineNumber="3338"><span class="doxyHighlight">  LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(2, Attribute::NoUndef);</span></CodeLine>
<Link id="l03339" /><CodeLine lineNumber="3339"></CodeLine>
<Link id="l03340" /><CodeLine lineNumber="3340"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EntryBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;entry&quot;</span><span class="doxyHighlight">, LtGRFunc);</span></CodeLine>
<Link id="l03341" /><CodeLine lineNumber="3341"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EntryBlock);</span></CodeLine>
<Link id="l03342" /><CodeLine lineNumber="3342"></CodeLine>
<Link id="l03343" /><CodeLine lineNumber="3343"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Buffer: global reduction buffer.</span></CodeLine>
<Link id="l03344" /><CodeLine lineNumber="3344"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;BufferArg = LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(0);</span></CodeLine>
<Link id="l03345" /><CodeLine lineNumber="3345"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Idx: index of the buffer.</span></CodeLine>
<Link id="l03346" /><CodeLine lineNumber="3346"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;IdxArg = LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(1);</span></CodeLine>
<Link id="l03347" /><CodeLine lineNumber="3347"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ReduceList: thread local Reduce list.</span></CodeLine>
<Link id="l03348" /><CodeLine lineNumber="3348"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;ReduceListArg = LtGRFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(2);</span></CodeLine>
<Link id="l03349" /><CodeLine lineNumber="3349"></CodeLine>
<Link id="l03350" /><CodeLine lineNumber="3350"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferArgAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03351" /><CodeLine lineNumber="3351"><span class="doxyHighlight">                                                BufferArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03352" /><CodeLine lineNumber="3352"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IdxArgAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03353" /><CodeLine lineNumber="3353"><span class="doxyHighlight">                                             IdxArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03354" /><CodeLine lineNumber="3354"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceListArgAlloca = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l03355" /><CodeLine lineNumber="3355"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ReduceListArg-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03356" /><CodeLine lineNumber="3356"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bacb17ff5177bb277ed8dd79480aad9c27">ArrayType</a> &#42;RedListArrayTy =</span></CodeLine>
<Link id="l03357" /><CodeLine lineNumber="3357"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ReductionInfos.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</span></CodeLine>
<Link id="l03358" /><CodeLine lineNumber="3358"></CodeLine>
<Link id="l03359" /><CodeLine lineNumber="3359"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 Build a list of reduction variables.</span></CodeLine>
<Link id="l03360" /><CodeLine lineNumber="3360"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// void &#42;RedList&#91;&lt;n&gt;&#93; = &#123;&lt;ReductionVars&gt;&#91;0&#93;, ..., &lt;ReductionVars&gt;&#91;&lt;n&gt;-1&#93;&#125;;</span></CodeLine>
<Link id="l03361" /><CodeLine lineNumber="3361"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LocalReduceList =</span></CodeLine>
<Link id="l03362" /><CodeLine lineNumber="3362"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(RedListArrayTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.omp.reduction.red&#95;list&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03363" /><CodeLine lineNumber="3363"></CodeLine>
<Link id="l03364" /><CodeLine lineNumber="3364"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferArgAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03365" /><CodeLine lineNumber="3365"><span class="doxyHighlight">      BufferArgAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l03366" /><CodeLine lineNumber="3366"><span class="doxyHighlight">      BufferArgAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03367" /><CodeLine lineNumber="3367"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IdxArgAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03368" /><CodeLine lineNumber="3368"><span class="doxyHighlight">      IdxArgAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), IdxArgAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03369" /><CodeLine lineNumber="3369"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceListArgAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03370" /><CodeLine lineNumber="3370"><span class="doxyHighlight">      ReduceListArgAlloca, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l03371" /><CodeLine lineNumber="3371"><span class="doxyHighlight">      ReduceListArgAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03372" /><CodeLine lineNumber="3372"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReductionList = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03373" /><CodeLine lineNumber="3373"><span class="doxyHighlight">      LocalReduceList, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(),</span></CodeLine>
<Link id="l03374" /><CodeLine lineNumber="3374"><span class="doxyHighlight">      LocalReduceList-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03375" /><CodeLine lineNumber="3375"></CodeLine>
<Link id="l03376" /><CodeLine lineNumber="3376"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(BufferArg, BufferArgAddrCast);</span></CodeLine>
<Link id="l03377" /><CodeLine lineNumber="3377"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(IdxArg, IdxArgAddrCast);</span></CodeLine>
<Link id="l03378" /><CodeLine lineNumber="3378"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(ReduceListArg, ReduceListArgAddrCast);</span></CodeLine>
<Link id="l03379" /><CodeLine lineNumber="3379"></CodeLine>
<Link id="l03380" /><CodeLine lineNumber="3380"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), BufferArgAddrCast);</span></CodeLine>
<Link id="l03381" /><CodeLine lineNumber="3381"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Idxs&#91;&#93; = &#123;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), IdxArgAddrCast)&#125;;</span></CodeLine>
<Link id="l03382" /><CodeLine lineNumber="3382"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IndexTy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a50cf39b25a9fc8862b6361e22168dce7">getIndexTy</a>(</span></CodeLine>
<Link id="l03383" /><CodeLine lineNumber="3383"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout(), <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getDefaultGlobalsAddressSpace());</span></CodeLine>
<Link id="l03384" /><CodeLine lineNumber="3384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l03385" /><CodeLine lineNumber="3385"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TargetElementPtrPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l03386" /><CodeLine lineNumber="3386"><span class="doxyHighlight">        RedListArrayTy, ReductionList,</span></CodeLine>
<Link id="l03387" /><CodeLine lineNumber="3387"><span class="doxyHighlight">        &#123;ConstantInt::get(IndexTy, 0), ConstantInt::get(IndexTy, En.index())&#125;);</span></CodeLine>
<Link id="l03388" /><CodeLine lineNumber="3388"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Global = Buffer.VD&#91;Idx&#93;;</span></CodeLine>
<Link id="l03389" /><CodeLine lineNumber="3389"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BufferVD =</span></CodeLine>
<Link id="l03390" /><CodeLine lineNumber="3390"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(ReductionsBufferTy, BufferVal, Idxs);</span></CodeLine>
<Link id="l03391" /><CodeLine lineNumber="3391"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;GlobValPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l03392" /><CodeLine lineNumber="3392"><span class="doxyHighlight">        ReductionsBufferTy, BufferVD, 0, En.index());</span></CodeLine>
<Link id="l03393" /><CodeLine lineNumber="3393"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(GlobValPtr, TargetElementPtrPtr);</span></CodeLine>
<Link id="l03394" /><CodeLine lineNumber="3394"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03395" /><CodeLine lineNumber="3395"></CodeLine>
<Link id="l03396" /><CodeLine lineNumber="3396"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Call reduce&#95;function(ReduceList, GlobalReduceList)</span></CodeLine>
<Link id="l03397" /><CodeLine lineNumber="3397"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReduceList =</span></CodeLine>
<Link id="l03398" /><CodeLine lineNumber="3398"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ReduceListArgAddrCast);</span></CodeLine>
<Link id="l03399" /><CodeLine lineNumber="3399"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(ReduceFn, &#123;ReduceList, ReductionList&#125;)</span></CodeLine>
<Link id="l03400" /><CodeLine lineNumber="3400"><span class="doxyHighlight">      -&gt;addFnAttr(Attribute::NoUnwind);</span></CodeLine>
<Link id="l03401" /><CodeLine lineNumber="3401"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l03402" /><CodeLine lineNumber="3402"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(OldIP);</span></CodeLine>
<Link id="l03403" /><CodeLine lineNumber="3403"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LtGRFunc;</span></CodeLine>
<Link id="l03404" /><CodeLine lineNumber="3404"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03405" /><CodeLine lineNumber="3405"></CodeLine>
<Link id="l03406" /><CodeLine lineNumber="3406"><span class="doxyHighlight">std::string OpenMPIRBuilder::getReductionFuncName(<a href="/docs/api/classes/llvm/stringref">StringRef</a> Name)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03407" /><CodeLine lineNumber="3407"><span class="doxyHighlight">  std::string Suffix =</span></CodeLine>
<Link id="l03408" /><CodeLine lineNumber="3408"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#a488c861f8a68e5f78ceca8b57acd8be5">createPlatformSpecificName</a>(&#123;</span><span class="doxyHighlightStringLiteral">&quot;omp&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;reduction&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;reduction&#95;func&quot;</span><span class="doxyHighlight">&#125;);</span></CodeLine>
<Link id="l03409" /><CodeLine lineNumber="3409"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (Name + Suffix).str();</span></CodeLine>
<Link id="l03410" /><CodeLine lineNumber="3410"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03411" /><CodeLine lineNumber="3411"></CodeLine>
<Link id="l03412" /><CodeLine lineNumber="3412"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/expected">Expected&lt;Function &#42;&gt;</a> OpenMPIRBuilder::createReductionFunction(</span></CodeLine>
<Link id="l03413" /><CodeLine lineNumber="3413"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/stringref">StringRef</a> ReducerName, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ReductionInfo&gt;</a> ReductionInfos,</span></CodeLine>
<Link id="l03414" /><CodeLine lineNumber="3414"><span class="doxyHighlight">    ReductionGenCBKind ReductionGenCBKind, AttributeList FuncAttrs) &#123;</span></CodeLine>
<Link id="l03415" /><CodeLine lineNumber="3415"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FuncTy = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad0243f1634f75e231041023ffaa8501a">getVoidTy</a>(),</span></CodeLine>
<Link id="l03416" /><CodeLine lineNumber="3416"><span class="doxyHighlight">                                   &#123;Builder.getPtrTy(), Builder.getPtrTy()&#125;,</span></CodeLine>
<Link id="l03417" /><CodeLine lineNumber="3417"><span class="doxyHighlight">                                   </span><span class="doxyHighlightComment">/&#42; IsVarArg &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03418" /><CodeLine lineNumber="3418"><span class="doxyHighlight">  std::string <a href="/docs/api/namespaces/llvm/graphprogram/#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a> = getReductionFuncName(ReducerName);</span></CodeLine>
<Link id="l03419" /><CodeLine lineNumber="3419"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;ReductionFunc =</span></CodeLine>
<Link id="l03420" /><CodeLine lineNumber="3420"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(FuncTy, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>, Name, &amp;M);</span></CodeLine>
<Link id="l03421" /><CodeLine lineNumber="3421"><span class="doxyHighlight">  ReductionFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9e4c6c67f4b2528b5648299db4a86926">setAttributes</a>(FuncAttrs);</span></CodeLine>
<Link id="l03422" /><CodeLine lineNumber="3422"><span class="doxyHighlight">  ReductionFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(0, Attribute::NoUndef);</span></CodeLine>
<Link id="l03423" /><CodeLine lineNumber="3423"><span class="doxyHighlight">  ReductionFunc-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(1, Attribute::NoUndef);</span></CodeLine>
<Link id="l03424" /><CodeLine lineNumber="3424"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EntryBB =</span></CodeLine>
<Link id="l03425" /><CodeLine lineNumber="3425"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;entry&quot;</span><span class="doxyHighlight">, ReductionFunc);</span></CodeLine>
<Link id="l03426" /><CodeLine lineNumber="3426"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EntryBB);</span></CodeLine>
<Link id="l03427" /><CodeLine lineNumber="3427"></CodeLine>
<Link id="l03428" /><CodeLine lineNumber="3428"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Need to alloca memory here and deal with the pointers before getting</span></CodeLine>
<Link id="l03429" /><CodeLine lineNumber="3429"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LHS/RHS pointers out</span></CodeLine>
<Link id="l03430" /><CodeLine lineNumber="3430"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LHSArrayPtr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03431" /><CodeLine lineNumber="3431"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RHSArrayPtr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03432" /><CodeLine lineNumber="3432"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;Arg0 = ReductionFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(0);</span></CodeLine>
<Link id="l03433" /><CodeLine lineNumber="3433"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;Arg1 = ReductionFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(1);</span></CodeLine>
<Link id="l03434" /><CodeLine lineNumber="3434"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Arg0Type = Arg0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l03435" /><CodeLine lineNumber="3435"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Arg1Type = Arg1-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l03436" /><CodeLine lineNumber="3436"></CodeLine>
<Link id="l03437" /><CodeLine lineNumber="3437"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LHSAlloca =</span></CodeLine>
<Link id="l03438" /><CodeLine lineNumber="3438"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Arg0Type, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, Arg0-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03439" /><CodeLine lineNumber="3439"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RHSAlloca =</span></CodeLine>
<Link id="l03440" /><CodeLine lineNumber="3440"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Arg1Type, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, Arg1-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.addr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03441" /><CodeLine lineNumber="3441"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LHSAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03442" /><CodeLine lineNumber="3442"><span class="doxyHighlight">      LHSAlloca, Arg0Type, LHSAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03443" /><CodeLine lineNumber="3443"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RHSAddrCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03444" /><CodeLine lineNumber="3444"><span class="doxyHighlight">      RHSAlloca, Arg1Type, RHSAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03445" /><CodeLine lineNumber="3445"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Arg0, LHSAddrCast);</span></CodeLine>
<Link id="l03446" /><CodeLine lineNumber="3446"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Arg1, RHSAddrCast);</span></CodeLine>
<Link id="l03447" /><CodeLine lineNumber="3447"><span class="doxyHighlight">  LHSArrayPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Arg0Type, LHSAddrCast);</span></CodeLine>
<Link id="l03448" /><CodeLine lineNumber="3448"><span class="doxyHighlight">  RHSArrayPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Arg1Type, RHSAddrCast);</span></CodeLine>
<Link id="l03449" /><CodeLine lineNumber="3449"></CodeLine>
<Link id="l03450" /><CodeLine lineNumber="3450"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;RedArrayTy = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), ReductionInfos.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</span></CodeLine>
<Link id="l03451" /><CodeLine lineNumber="3451"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IndexTy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a50cf39b25a9fc8862b6361e22168dce7">getIndexTy</a>(</span></CodeLine>
<Link id="l03452" /><CodeLine lineNumber="3452"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout(), <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getDefaultGlobalsAddressSpace());</span></CodeLine>
<Link id="l03453" /><CodeLine lineNumber="3453"><span class="doxyHighlight">  SmallVector&lt;Value &#42;&gt; LHSPtrs, RHSPtrs;</span></CodeLine>
<Link id="l03454" /><CodeLine lineNumber="3454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l03455" /><CodeLine lineNumber="3455"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI = En.value();</span></CodeLine>
<Link id="l03456" /><CodeLine lineNumber="3456"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RHSI8PtrPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l03457" /><CodeLine lineNumber="3457"><span class="doxyHighlight">        RedArrayTy, RHSArrayPtr,</span></CodeLine>
<Link id="l03458" /><CodeLine lineNumber="3458"><span class="doxyHighlight">        &#123;ConstantInt::get(IndexTy, 0), ConstantInt::get(IndexTy, En.index())&#125;);</span></CodeLine>
<Link id="l03459" /><CodeLine lineNumber="3459"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RHSI8Ptr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), RHSI8PtrPtr);</span></CodeLine>
<Link id="l03460" /><CodeLine lineNumber="3460"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RHSPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03461" /><CodeLine lineNumber="3461"><span class="doxyHighlight">        RHSI8Ptr, RI.PrivateVariable-&gt;getType(),</span></CodeLine>
<Link id="l03462" /><CodeLine lineNumber="3462"><span class="doxyHighlight">        RHSI8Ptr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03463" /><CodeLine lineNumber="3463"></CodeLine>
<Link id="l03464" /><CodeLine lineNumber="3464"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LHSI8PtrPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l03465" /><CodeLine lineNumber="3465"><span class="doxyHighlight">        RedArrayTy, LHSArrayPtr,</span></CodeLine>
<Link id="l03466" /><CodeLine lineNumber="3466"><span class="doxyHighlight">        &#123;ConstantInt::get(IndexTy, 0), ConstantInt::get(IndexTy, En.index())&#125;);</span></CodeLine>
<Link id="l03467" /><CodeLine lineNumber="3467"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LHSI8Ptr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), LHSI8PtrPtr);</span></CodeLine>
<Link id="l03468" /><CodeLine lineNumber="3468"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LHSPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03469" /><CodeLine lineNumber="3469"><span class="doxyHighlight">        LHSI8Ptr, RI.Variable-&gt;getType(), LHSI8Ptr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03470" /><CodeLine lineNumber="3470"></CodeLine>
<Link id="l03471" /><CodeLine lineNumber="3471"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReductionGenCBKind == ReductionGenCBKind::Clang) &#123;</span></CodeLine>
<Link id="l03472" /><CodeLine lineNumber="3472"><span class="doxyHighlight">      LHSPtrs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(LHSPtr);</span></CodeLine>
<Link id="l03473" /><CodeLine lineNumber="3473"><span class="doxyHighlight">      RHSPtrs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(RHSPtr);</span></CodeLine>
<Link id="l03474" /><CodeLine lineNumber="3474"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03475" /><CodeLine lineNumber="3475"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(RI.ElementType, LHSPtr);</span></CodeLine>
<Link id="l03476" /><CodeLine lineNumber="3476"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(RI.ElementType, RHSPtr);</span></CodeLine>
<Link id="l03477" /><CodeLine lineNumber="3477"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Reduced;</span></CodeLine>
<Link id="l03478" /><CodeLine lineNumber="3478"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l03479" /><CodeLine lineNumber="3479"><span class="doxyHighlight">          RI.ReductionGen(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Reduced);</span></CodeLine>
<Link id="l03480" /><CodeLine lineNumber="3480"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l03481" /><CodeLine lineNumber="3481"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l03482" /><CodeLine lineNumber="3482"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>())</span></CodeLine>
<Link id="l03483" /><CodeLine lineNumber="3483"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ReductionFunc;</span></CodeLine>
<Link id="l03484" /><CodeLine lineNumber="3484"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Reduced, LHSPtr);</span></CodeLine>
<Link id="l03485" /><CodeLine lineNumber="3485"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03486" /><CodeLine lineNumber="3486"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03487" /><CodeLine lineNumber="3487"></CodeLine>
<Link id="l03488" /><CodeLine lineNumber="3488"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReductionGenCBKind == ReductionGenCBKind::Clang)</span></CodeLine>
<Link id="l03489" /><CodeLine lineNumber="3489"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l03490" /><CodeLine lineNumber="3490"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/dwarf/#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = En.index();</span></CodeLine>
<Link id="l03491" /><CodeLine lineNumber="3491"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI = En.value();</span></CodeLine>
<Link id="l03492" /><CodeLine lineNumber="3492"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LHSFixupPtr, &#42;RHSFixupPtr;</span></CodeLine>
<Link id="l03493" /><CodeLine lineNumber="3493"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(RI.ReductionGenClang(</span></CodeLine>
<Link id="l03494" /><CodeLine lineNumber="3494"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), Index, &amp;LHSFixupPtr, &amp;RHSFixupPtr, ReductionFunc));</span></CodeLine>
<Link id="l03495" /><CodeLine lineNumber="3495"></CodeLine>
<Link id="l03496" /><CodeLine lineNumber="3496"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Fix the CallBack code genereated to use the correct Values for the LHS</span></CodeLine>
<Link id="l03497" /><CodeLine lineNumber="3497"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// and RHS</span></CodeLine>
<Link id="l03498" /><CodeLine lineNumber="3498"><span class="doxyHighlight">      LHSFixupPtr-&gt;<a href="/docs/api/classes/llvm/value/#a7e8dad1701aa6445be4a29f654b0473c">replaceUsesWithIf</a>(</span></CodeLine>
<Link id="l03499" /><CodeLine lineNumber="3499"><span class="doxyHighlight">          LHSPtrs&#91;Index&#93;, &#91;ReductionFunc&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Use &amp;U) &#123;</span></CodeLine>
<Link id="l03500" /><CodeLine lineNumber="3500"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser())-&gt;getParent()-&gt;getParent() ==</span></CodeLine>
<Link id="l03501" /><CodeLine lineNumber="3501"><span class="doxyHighlight">                   ReductionFunc;</span></CodeLine>
<Link id="l03502" /><CodeLine lineNumber="3502"><span class="doxyHighlight">          &#125;);</span></CodeLine>
<Link id="l03503" /><CodeLine lineNumber="3503"><span class="doxyHighlight">      RHSFixupPtr-&gt;<a href="/docs/api/classes/llvm/value/#a7e8dad1701aa6445be4a29f654b0473c">replaceUsesWithIf</a>(</span></CodeLine>
<Link id="l03504" /><CodeLine lineNumber="3504"><span class="doxyHighlight">          RHSPtrs&#91;Index&#93;, &#91;ReductionFunc&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Use &amp;U) &#123;</span></CodeLine>
<Link id="l03505" /><CodeLine lineNumber="3505"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser())-&gt;getParent()-&gt;getParent() ==</span></CodeLine>
<Link id="l03506" /><CodeLine lineNumber="3506"><span class="doxyHighlight">                   ReductionFunc;</span></CodeLine>
<Link id="l03507" /><CodeLine lineNumber="3507"><span class="doxyHighlight">          &#125;);</span></CodeLine>
<Link id="l03508" /><CodeLine lineNumber="3508"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03509" /><CodeLine lineNumber="3509"></CodeLine>
<Link id="l03510" /><CodeLine lineNumber="3510"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l03511" /><CodeLine lineNumber="3511"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ReductionFunc;</span></CodeLine>
<Link id="l03512" /><CodeLine lineNumber="3512"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03513" /><CodeLine lineNumber="3513"></CodeLine>
<Link id="l03514" /><CodeLine lineNumber="3514"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l03515" /><CodeLine lineNumber="3515" lineLink="#a75e12544ba3cf3438ac62e2065e4941d"><span class="doxyHighlight"><a href="#a75e12544ba3cf3438ac62e2065e4941d">checkReductionInfos</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;OpenMPIRBuilder::ReductionInfo&gt;</a> ReductionInfos,</span></CodeLine>
<Link id="l03516" /><CodeLine lineNumber="3516"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsGPU) &#123;</span></CodeLine>
<Link id="l03517" /><CodeLine lineNumber="3517"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> OpenMPIRBuilder::ReductionInfo &amp;RI : ReductionInfos) &#123;</span></CodeLine>
<Link id="l03518" /><CodeLine lineNumber="3518"><span class="doxyHighlight">    (void)RI;</span></CodeLine>
<Link id="l03519" /><CodeLine lineNumber="3519"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RI.Variable &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;expected non-null variable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03520" /><CodeLine lineNumber="3520"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RI.PrivateVariable &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;expected non-null private variable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03521" /><CodeLine lineNumber="3521"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((RI.ReductionGen || RI.ReductionGenClang) &amp;&amp;</span></CodeLine>
<Link id="l03522" /><CodeLine lineNumber="3522"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;expected non-null reduction generator callback&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03523" /><CodeLine lineNumber="3523"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsGPU) &#123;</span></CodeLine>
<Link id="l03524" /><CodeLine lineNumber="3524"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l03525" /><CodeLine lineNumber="3525"><span class="doxyHighlight">          RI.Variable-&gt;getType() == RI.PrivateVariable-&gt;getType() &amp;&amp;</span></CodeLine>
<Link id="l03526" /><CodeLine lineNumber="3526"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;expected variables and their private equivalents to have the same &quot;</span></CodeLine>
<Link id="l03527" /><CodeLine lineNumber="3527"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03528" /><CodeLine lineNumber="3528"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03529" /><CodeLine lineNumber="3529"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RI.Variable-&gt;getType()-&gt;isPointerTy() &amp;&amp;</span></CodeLine>
<Link id="l03530" /><CodeLine lineNumber="3530"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;expected variables to be pointers&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03531" /><CodeLine lineNumber="3531"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03532" /><CodeLine lineNumber="3532"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03533" /><CodeLine lineNumber="3533"></CodeLine>
<Link id="l03534" /><CodeLine lineNumber="3534"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> OpenMPIRBuilder::createReductionsGPU(</span></CodeLine>
<Link id="l03535" /><CodeLine lineNumber="3535"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l03536" /><CodeLine lineNumber="3536"><span class="doxyHighlight">    InsertPointTy CodeGenIP, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ReductionInfo&gt;</a> ReductionInfos,</span></CodeLine>
<Link id="l03537" /><CodeLine lineNumber="3537"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNoWait, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsTeamsReduction, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasDistribute,</span></CodeLine>
<Link id="l03538" /><CodeLine lineNumber="3538"><span class="doxyHighlight">    ReductionGenCBKind ReductionGenCBKind, std::optional&lt;omp::GV&gt; GridValue,</span></CodeLine>
<Link id="l03539" /><CodeLine lineNumber="3539"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ReductionBufNum, <a href="/docs/api/classes/llvm/value">Value</a> &#42;SrcLocInfo) &#123;</span></CodeLine>
<Link id="l03540" /><CodeLine lineNumber="3540"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l03541" /><CodeLine lineNumber="3541"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>();</span></CodeLine>
<Link id="l03542" /><CodeLine lineNumber="3542"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l03543" /><CodeLine lineNumber="3543"><span class="doxyHighlight">  <a href="#a75e12544ba3cf3438ac62e2065e4941d">checkReductionInfos</a>(ReductionInfos, </span><span class="doxyHighlightComment">/&#42;IsGPU&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03544" /><CodeLine lineNumber="3544"><span class="doxyHighlight">  LLVMContext &amp;Ctx = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext();</span></CodeLine>
<Link id="l03545" /><CodeLine lineNumber="3545"></CodeLine>
<Link id="l03546" /><CodeLine lineNumber="3546"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Source location for the ident struct</span></CodeLine>
<Link id="l03547" /><CodeLine lineNumber="3547"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SrcLocInfo) &#123;</span></CodeLine>
<Link id="l03548" /><CodeLine lineNumber="3548"><span class="doxyHighlight">    uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l03549" /><CodeLine lineNumber="3549"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l03550" /><CodeLine lineNumber="3550"><span class="doxyHighlight">    SrcLocInfo = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l03551" /><CodeLine lineNumber="3551"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03552" /><CodeLine lineNumber="3552"></CodeLine>
<Link id="l03553" /><CodeLine lineNumber="3553"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReductionInfos.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == 0)</span></CodeLine>
<Link id="l03554" /><CodeLine lineNumber="3554"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l03555" /><CodeLine lineNumber="3555"></CodeLine>
<Link id="l03556" /><CodeLine lineNumber="3556"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;CurFunc = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l03557" /><CodeLine lineNumber="3557"><span class="doxyHighlight">  AttributeList FuncAttrs;</span></CodeLine>
<Link id="l03558" /><CodeLine lineNumber="3558"><span class="doxyHighlight">  AttrBuilder AttrBldr(Ctx);</span></CodeLine>
<Link id="l03559" /><CodeLine lineNumber="3559"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Attr : CurFunc-&gt;<a href="/docs/api/classes/llvm/function/#a7477aafbbe989ad35b96fac186d8e9fd">getAttributes</a>().getFnAttrs())</span></CodeLine>
<Link id="l03560" /><CodeLine lineNumber="3560"><span class="doxyHighlight">    AttrBldr.addAttribute(Attr);</span></CodeLine>
<Link id="l03561" /><CodeLine lineNumber="3561"><span class="doxyHighlight">  AttrBldr.removeAttribute(Attribute::OptimizeNone);</span></CodeLine>
<Link id="l03562" /><CodeLine lineNumber="3562"><span class="doxyHighlight">  FuncAttrs = FuncAttrs.addFnAttributes(Ctx, AttrBldr);</span></CodeLine>
<Link id="l03563" /><CodeLine lineNumber="3563"></CodeLine>
<Link id="l03564" /><CodeLine lineNumber="3564"><span class="doxyHighlight">  CodeGenIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l03565" /><CodeLine lineNumber="3565"><span class="doxyHighlight">  Expected&lt;Function &#42;&gt; ReductionResult =</span></CodeLine>
<Link id="l03566" /><CodeLine lineNumber="3566"><span class="doxyHighlight">      createReductionFunction(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>(),</span></CodeLine>
<Link id="l03567" /><CodeLine lineNumber="3567"><span class="doxyHighlight">                              ReductionInfos, ReductionGenCBKind, FuncAttrs);</span></CodeLine>
<Link id="l03568" /><CodeLine lineNumber="3568"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ReductionResult)</span></CodeLine>
<Link id="l03569" /><CodeLine lineNumber="3569"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ReductionResult.<a href="/docs/api/classes/llvm/expected/#a94789df4ebd03dc008e8adebaa66ac1f">takeError</a>();</span></CodeLine>
<Link id="l03570" /><CodeLine lineNumber="3570"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;ReductionFunc = &#42;ReductionResult;</span></CodeLine>
<Link id="l03571" /><CodeLine lineNumber="3571"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l03572" /><CodeLine lineNumber="3572"></CodeLine>
<Link id="l03573" /><CodeLine lineNumber="3573"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set the grid value in the config needed for lowering later on</span></CodeLine>
<Link id="l03574" /><CodeLine lineNumber="3574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GridValue.has&#95;value())</span></CodeLine>
<Link id="l03575" /><CodeLine lineNumber="3575"><span class="doxyHighlight">    Config.setGridValue(GridValue.value());</span></CodeLine>
<Link id="l03576" /><CodeLine lineNumber="3576"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03577" /><CodeLine lineNumber="3577"><span class="doxyHighlight">    Config.setGridValue(<a href="#ad52342fdd467389643191fdac7abcd40">getGridValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, ReductionFunc));</span></CodeLine>
<Link id="l03578" /><CodeLine lineNumber="3578"></CodeLine>
<Link id="l03579" /><CodeLine lineNumber="3579"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build res = &#95;&#95;kmpc&#95;reduce&#123;&#95;nowait&#125;(&lt;gtid&gt;, &lt;n&gt;, sizeof(RedList),</span></CodeLine>
<Link id="l03580" /><CodeLine lineNumber="3580"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// RedList, shuffle&#95;reduce&#95;func, interwarp&#95;copy&#95;func);</span></CodeLine>
<Link id="l03581" /><CodeLine lineNumber="3581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or</span></CodeLine>
<Link id="l03582" /><CodeLine lineNumber="3582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build res = &#95;&#95;kmpc&#95;reduce&#95;teams&#95;nowait&#95;simple(&lt;loc&gt;, &lt;gtid&gt;, &lt;lck&gt;);</span></CodeLine>
<Link id="l03583" /><CodeLine lineNumber="3583"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Res;</span></CodeLine>
<Link id="l03584" /><CodeLine lineNumber="3584"></CodeLine>
<Link id="l03585" /><CodeLine lineNumber="3585"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 Build a list of reduction variables.</span></CodeLine>
<Link id="l03586" /><CodeLine lineNumber="3586"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// void &#42;RedList&#91;&lt;n&gt;&#93; = &#123;&lt;ReductionVars&gt;&#91;0&#93;, ..., &lt;ReductionVars&gt;&#91;&lt;n&gt;-1&#93;&#125;;</span></CodeLine>
<Link id="l03587" /><CodeLine lineNumber="3587"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = ReductionInfos.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>();</span></CodeLine>
<Link id="l03588" /><CodeLine lineNumber="3588"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PtrTy = <a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(Ctx);</span></CodeLine>
<Link id="l03589" /><CodeLine lineNumber="3589"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;RedArrayTy = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(PtrTy, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>);</span></CodeLine>
<Link id="l03590" /><CodeLine lineNumber="3590"><span class="doxyHighlight">  CodeGenIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l03591" /><CodeLine lineNumber="3591"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l03592" /><CodeLine lineNumber="3592"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReductionListAlloca =</span></CodeLine>
<Link id="l03593" /><CodeLine lineNumber="3593"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(RedArrayTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.omp.reduction.red&#95;list&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03594" /><CodeLine lineNumber="3594"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReductionList = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l03595" /><CodeLine lineNumber="3595"><span class="doxyHighlight">      ReductionListAlloca, PtrTy, ReductionListAlloca-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ascast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03596" /><CodeLine lineNumber="3596"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l03597" /><CodeLine lineNumber="3597"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IndexTy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a50cf39b25a9fc8862b6361e22168dce7">getIndexTy</a>(</span></CodeLine>
<Link id="l03598" /><CodeLine lineNumber="3598"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout(), <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getDefaultGlobalsAddressSpace());</span></CodeLine>
<Link id="l03599" /><CodeLine lineNumber="3599"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l03600" /><CodeLine lineNumber="3600"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI = En.value();</span></CodeLine>
<Link id="l03601" /><CodeLine lineNumber="3601"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ElemPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l03602" /><CodeLine lineNumber="3602"><span class="doxyHighlight">        RedArrayTy, ReductionList,</span></CodeLine>
<Link id="l03603" /><CodeLine lineNumber="3603"><span class="doxyHighlight">        &#123;ConstantInt::get(IndexTy, 0), ConstantInt::get(IndexTy, En.index())&#125;);</span></CodeLine>
<Link id="l03604" /><CodeLine lineNumber="3604"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CastElem =</span></CodeLine>
<Link id="l03605" /><CodeLine lineNumber="3605"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(RI.PrivateVariable, PtrTy);</span></CodeLine>
<Link id="l03606" /><CodeLine lineNumber="3606"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(CastElem, ElemPtr);</span></CodeLine>
<Link id="l03607" /><CodeLine lineNumber="3607"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03608" /><CodeLine lineNumber="3608"><span class="doxyHighlight">  CodeGenIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l03609" /><CodeLine lineNumber="3609"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;SarFunc =</span></CodeLine>
<Link id="l03610" /><CodeLine lineNumber="3610"><span class="doxyHighlight">      emitShuffleAndReduceFunction(ReductionInfos, ReductionFunc, FuncAttrs);</span></CodeLine>
<Link id="l03611" /><CodeLine lineNumber="3611"><span class="doxyHighlight">  Expected&lt;Function &#42;&gt; CopyResult =</span></CodeLine>
<Link id="l03612" /><CodeLine lineNumber="3612"><span class="doxyHighlight">      emitInterWarpCopyFunction(Loc, ReductionInfos, FuncAttrs);</span></CodeLine>
<Link id="l03613" /><CodeLine lineNumber="3613"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CopyResult)</span></CodeLine>
<Link id="l03614" /><CodeLine lineNumber="3614"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CopyResult.<a href="/docs/api/classes/llvm/expected/#a94789df4ebd03dc008e8adebaa66ac1f">takeError</a>();</span></CodeLine>
<Link id="l03615" /><CodeLine lineNumber="3615"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;WcFunc = &#42;CopyResult;</span></CodeLine>
<Link id="l03616" /><CodeLine lineNumber="3616"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l03617" /><CodeLine lineNumber="3617"></CodeLine>
<Link id="l03618" /><CodeLine lineNumber="3618"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RL = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(ReductionList, PtrTy);</span></CodeLine>
<Link id="l03619" /><CodeLine lineNumber="3619"></CodeLine>
<Link id="l03620" /><CodeLine lineNumber="3620"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxDataSize = 0;</span></CodeLine>
<Link id="l03621" /><CodeLine lineNumber="3621"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Type &#42;&gt;</a> ReductionTypeArgs;</span></CodeLine>
<Link id="l03622" /><CodeLine lineNumber="3622"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l03623" /><CodeLine lineNumber="3623"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(En.value().ElementType);</span></CodeLine>
<Link id="l03624" /><CodeLine lineNumber="3624"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &gt; MaxDataSize)</span></CodeLine>
<Link id="l03625" /><CodeLine lineNumber="3625"><span class="doxyHighlight">      MaxDataSize = <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l03626" /><CodeLine lineNumber="3626"><span class="doxyHighlight">    ReductionTypeArgs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(En.value().ElementType);</span></CodeLine>
<Link id="l03627" /><CodeLine lineNumber="3627"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03628" /><CodeLine lineNumber="3628"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ReductionDataSize =</span></CodeLine>
<Link id="l03629" /><CodeLine lineNumber="3629"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(MaxDataSize &#42; ReductionInfos.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</span></CodeLine>
<Link id="l03630" /><CodeLine lineNumber="3630"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsTeamsReduction) &#123;</span></CodeLine>
<Link id="l03631" /><CodeLine lineNumber="3631"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SarFuncCast =</span></CodeLine>
<Link id="l03632" /><CodeLine lineNumber="3632"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(SarFunc, PtrTy);</span></CodeLine>
<Link id="l03633" /><CodeLine lineNumber="3633"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;WcFuncCast =</span></CodeLine>
<Link id="l03634" /><CodeLine lineNumber="3634"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(WcFunc, PtrTy);</span></CodeLine>
<Link id="l03635" /><CodeLine lineNumber="3635"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;SrcLocInfo, ReductionDataSize, RL, SarFuncCast,</span></CodeLine>
<Link id="l03636" /><CodeLine lineNumber="3636"><span class="doxyHighlight">                     WcFuncCast&#125;;</span></CodeLine>
<Link id="l03637" /><CodeLine lineNumber="3637"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;Pv2Ptr = getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l03638" /><CodeLine lineNumber="3638"><span class="doxyHighlight">        RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;nvptx&#95;parallel&#95;reduce&#95;nowait&#95;v2);</span></CodeLine>
<Link id="l03639" /><CodeLine lineNumber="3639"><span class="doxyHighlight">    Res = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(Pv2Ptr, Args);</span></CodeLine>
<Link id="l03640" /><CodeLine lineNumber="3640"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03641" /><CodeLine lineNumber="3641"><span class="doxyHighlight">    CodeGenIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l03642" /><CodeLine lineNumber="3642"><span class="doxyHighlight">    StructType &#42;ReductionsBufferTy = <a href="/docs/api/classes/llvm/structtype/#a82648246c07eb8a33f628eea28cb988c">StructType::create</a>(</span></CodeLine>
<Link id="l03643" /><CodeLine lineNumber="3643"><span class="doxyHighlight">        Ctx, ReductionTypeArgs, </span><span class="doxyHighlightStringLiteral">&quot;struct.&#95;globalized&#95;locals&#95;ty&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03644" /><CodeLine lineNumber="3644"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;RedFixedBuferFn = getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l03645" /><CodeLine lineNumber="3645"><span class="doxyHighlight">        RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;reduction&#95;get&#95;fixed&#95;buffer);</span></CodeLine>
<Link id="l03646" /><CodeLine lineNumber="3646"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;LtGCFunc = emitListToGlobalCopyFunction(</span></CodeLine>
<Link id="l03647" /><CodeLine lineNumber="3647"><span class="doxyHighlight">        ReductionInfos, ReductionsBufferTy, FuncAttrs);</span></CodeLine>
<Link id="l03648" /><CodeLine lineNumber="3648"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;LtGRFunc = emitListToGlobalReduceFunction(</span></CodeLine>
<Link id="l03649" /><CodeLine lineNumber="3649"><span class="doxyHighlight">        ReductionInfos, ReductionFunc, ReductionsBufferTy, FuncAttrs);</span></CodeLine>
<Link id="l03650" /><CodeLine lineNumber="3650"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;GtLCFunc = emitGlobalToListCopyFunction(</span></CodeLine>
<Link id="l03651" /><CodeLine lineNumber="3651"><span class="doxyHighlight">        ReductionInfos, ReductionsBufferTy, FuncAttrs);</span></CodeLine>
<Link id="l03652" /><CodeLine lineNumber="3652"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;GtLRFunc = emitGlobalToListReduceFunction(</span></CodeLine>
<Link id="l03653" /><CodeLine lineNumber="3653"><span class="doxyHighlight">        ReductionInfos, ReductionFunc, ReductionsBufferTy, FuncAttrs);</span></CodeLine>
<Link id="l03654" /><CodeLine lineNumber="3654"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l03655" /><CodeLine lineNumber="3655"></CodeLine>
<Link id="l03656" /><CodeLine lineNumber="3656"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;KernelTeamsReductionPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l03657" /><CodeLine lineNumber="3657"><span class="doxyHighlight">        RedFixedBuferFn, &#123;&#125;, </span><span class="doxyHighlightStringLiteral">&quot;&#95;openmp&#95;teams&#95;reductions&#95;buffer&#95;$&#95;$ptr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03658" /><CodeLine lineNumber="3658"></CodeLine>
<Link id="l03659" /><CodeLine lineNumber="3659"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Args3&#91;&#93; = &#123;SrcLocInfo,</span></CodeLine>
<Link id="l03660" /><CodeLine lineNumber="3660"><span class="doxyHighlight">                      KernelTeamsReductionPtr,</span></CodeLine>
<Link id="l03661" /><CodeLine lineNumber="3661"><span class="doxyHighlight">                      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(ReductionBufNum),</span></CodeLine>
<Link id="l03662" /><CodeLine lineNumber="3662"><span class="doxyHighlight">                      ReductionDataSize,</span></CodeLine>
<Link id="l03663" /><CodeLine lineNumber="3663"><span class="doxyHighlight">                      RL,</span></CodeLine>
<Link id="l03664" /><CodeLine lineNumber="3664"><span class="doxyHighlight">                      SarFunc,</span></CodeLine>
<Link id="l03665" /><CodeLine lineNumber="3665"><span class="doxyHighlight">                      WcFunc,</span></CodeLine>
<Link id="l03666" /><CodeLine lineNumber="3666"><span class="doxyHighlight">                      LtGCFunc,</span></CodeLine>
<Link id="l03667" /><CodeLine lineNumber="3667"><span class="doxyHighlight">                      LtGRFunc,</span></CodeLine>
<Link id="l03668" /><CodeLine lineNumber="3668"><span class="doxyHighlight">                      GtLCFunc,</span></CodeLine>
<Link id="l03669" /><CodeLine lineNumber="3669"><span class="doxyHighlight">                      GtLRFunc&#125;;</span></CodeLine>
<Link id="l03670" /><CodeLine lineNumber="3670"></CodeLine>
<Link id="l03671" /><CodeLine lineNumber="3671"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TeamsReduceFn = getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l03672" /><CodeLine lineNumber="3672"><span class="doxyHighlight">        RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;nvptx&#95;teams&#95;reduce&#95;nowait&#95;v2);</span></CodeLine>
<Link id="l03673" /><CodeLine lineNumber="3673"><span class="doxyHighlight">    Res = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(TeamsReduceFn, Args3);</span></CodeLine>
<Link id="l03674" /><CodeLine lineNumber="3674"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03675" /><CodeLine lineNumber="3675"></CodeLine>
<Link id="l03676" /><CodeLine lineNumber="3676"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 5 Build if (res == 1)</span></CodeLine>
<Link id="l03677" /><CodeLine lineNumber="3677"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ExitBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;.omp.reduction.done&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03678" /><CodeLine lineNumber="3678"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ThenBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;.omp.reduction.then&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03679" /><CodeLine lineNumber="3679"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(Res, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(1));</span></CodeLine>
<Link id="l03680" /><CodeLine lineNumber="3680"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, ThenBB, ExitBB);</span></CodeLine>
<Link id="l03681" /><CodeLine lineNumber="3681"></CodeLine>
<Link id="l03682" /><CodeLine lineNumber="3682"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 6 Build then branch: where we have reduced values in the master</span></CodeLine>
<Link id="l03683" /><CodeLine lineNumber="3683"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    thread in each team.</span></CodeLine>
<Link id="l03684" /><CodeLine lineNumber="3684"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    &#95;&#95;kmpc&#95;end&#95;reduce&#123;&#95;nowait&#125;(&lt;gtid&gt;);</span></CodeLine>
<Link id="l03685" /><CodeLine lineNumber="3685"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    break;</span></CodeLine>
<Link id="l03686" /><CodeLine lineNumber="3686"><span class="doxyHighlight">  emitBlock(ThenBB, CurFunc);</span></CodeLine>
<Link id="l03687" /><CodeLine lineNumber="3687"></CodeLine>
<Link id="l03688" /><CodeLine lineNumber="3688"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add emission of &#95;&#95;kmpc&#95;end&#95;reduce&#123;&#95;nowait&#125;(&lt;gtid&gt;);</span></CodeLine>
<Link id="l03689" /><CodeLine lineNumber="3689"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l03690" /><CodeLine lineNumber="3690"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI = En.value();</span></CodeLine>
<Link id="l03691" /><CodeLine lineNumber="3691"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = RI.Variable;</span></CodeLine>
<Link id="l03692" /><CodeLine lineNumber="3692"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> =</span></CodeLine>
<Link id="l03693" /><CodeLine lineNumber="3693"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(RI.PrivateVariable, PtrTy);</span></CodeLine>
<Link id="l03694" /><CodeLine lineNumber="3694"></CodeLine>
<Link id="l03695" /><CodeLine lineNumber="3695"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReductionGenCBKind == ReductionGenCBKind::Clang) &#123;</span></CodeLine>
<Link id="l03696" /><CodeLine lineNumber="3696"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LHSPtr, &#42;RHSPtr;</span></CodeLine>
<Link id="l03697" /><CodeLine lineNumber="3697"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(RI.ReductionGenClang(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), En.index(),</span></CodeLine>
<Link id="l03698" /><CodeLine lineNumber="3698"><span class="doxyHighlight">                                             &amp;LHSPtr, &amp;RHSPtr, CurFunc));</span></CodeLine>
<Link id="l03699" /><CodeLine lineNumber="3699"></CodeLine>
<Link id="l03700" /><CodeLine lineNumber="3700"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Fix the CallBack code genereated to use the correct Values for the LHS</span></CodeLine>
<Link id="l03701" /><CodeLine lineNumber="3701"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// and RHS</span></CodeLine>
<Link id="l03702" /><CodeLine lineNumber="3702"><span class="doxyHighlight">      LHSPtr-&gt;<a href="/docs/api/classes/llvm/value/#a7e8dad1701aa6445be4a29f654b0473c">replaceUsesWithIf</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, &#91;ReductionFunc&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Use &amp;U) &#123;</span></CodeLine>
<Link id="l03703" /><CodeLine lineNumber="3703"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser())-&gt;getParent()-&gt;getParent() ==</span></CodeLine>
<Link id="l03704" /><CodeLine lineNumber="3704"><span class="doxyHighlight">               ReductionFunc;</span></CodeLine>
<Link id="l03705" /><CodeLine lineNumber="3705"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l03706" /><CodeLine lineNumber="3706"><span class="doxyHighlight">      RHSPtr-&gt;<a href="/docs/api/classes/llvm/value/#a7e8dad1701aa6445be4a29f654b0473c">replaceUsesWithIf</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, &#91;ReductionFunc&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Use &amp;U) &#123;</span></CodeLine>
<Link id="l03707" /><CodeLine lineNumber="3707"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser())-&gt;getParent()-&gt;getParent() ==</span></CodeLine>
<Link id="l03708" /><CodeLine lineNumber="3708"><span class="doxyHighlight">               ReductionFunc;</span></CodeLine>
<Link id="l03709" /><CodeLine lineNumber="3709"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l03710" /><CodeLine lineNumber="3710"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03711" /><CodeLine lineNumber="3711"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight"> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unhandled ReductionGenCBKind&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03712" /><CodeLine lineNumber="3712"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03713" /><CodeLine lineNumber="3713"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03714" /><CodeLine lineNumber="3714"><span class="doxyHighlight">  emitBlock(ExitBB, CurFunc);</span></CodeLine>
<Link id="l03715" /><CodeLine lineNumber="3715"></CodeLine>
<Link id="l03716" /><CodeLine lineNumber="3716"><span class="doxyHighlight">  Config.setEmitLLVMUsed();</span></CodeLine>
<Link id="l03717" /><CodeLine lineNumber="3717"></CodeLine>
<Link id="l03718" /><CodeLine lineNumber="3718"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l03719" /><CodeLine lineNumber="3719"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03720" /><CodeLine lineNumber="3720"></CodeLine>
<Link id="l03721" /><CodeLine lineNumber="3721" lineLink="#a669fae0a15d7219ef3ca3f3b16e3f5a0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="#a669fae0a15d7219ef3ca3f3b16e3f5a0">getFreshReductionFunc</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</span></CodeLine>
<Link id="l03722" /><CodeLine lineNumber="3722"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;VoidTy = <a href="/docs/api/classes/llvm/type/#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(M.getContext());</span></CodeLine>
<Link id="l03723" /><CodeLine lineNumber="3723"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Int8PtrTy = <a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(M.getContext());</span></CodeLine>
<Link id="l03724" /><CodeLine lineNumber="3724"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FuncTy =</span></CodeLine>
<Link id="l03725" /><CodeLine lineNumber="3725"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(VoidTy, &#123;Int8PtrTy, Int8PtrTy&#125;, </span><span class="doxyHighlightComment">/&#42; IsVarArg &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03726" /><CodeLine lineNumber="3726"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(FuncTy, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalVariable::InternalLinkage</a>,</span></CodeLine>
<Link id="l03727" /><CodeLine lineNumber="3727"><span class="doxyHighlight">                          </span><span class="doxyHighlightStringLiteral">&quot;.omp.reduction.func&quot;</span><span class="doxyHighlight">, &amp;M);</span></CodeLine>
<Link id="l03728" /><CodeLine lineNumber="3728"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03729" /><CodeLine lineNumber="3729"></CodeLine>
<Link id="l03730" /><CodeLine lineNumber="3730"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a></span></CodeLine>
<Link id="l03731" /><CodeLine lineNumber="3731"><span class="doxyHighlight">OpenMPIRBuilder::createReductions(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l03732" /><CodeLine lineNumber="3732"><span class="doxyHighlight">                                  InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l03733" /><CodeLine lineNumber="3733"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ReductionInfo&gt;</a> ReductionInfos,</span></CodeLine>
<Link id="l03734" /><CodeLine lineNumber="3734"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;bool&gt;</a> IsByRef, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNoWait) &#123;</span></CodeLine>
<Link id="l03735" /><CodeLine lineNumber="3735"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ReductionInfos.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == IsByRef.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</span></CodeLine>
<Link id="l03736" /><CodeLine lineNumber="3736"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI : ReductionInfos) &#123;</span></CodeLine>
<Link id="l03737" /><CodeLine lineNumber="3737"><span class="doxyHighlight">    (void)RI;</span></CodeLine>
<Link id="l03738" /><CodeLine lineNumber="3738"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RI.Variable &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;expected non-null variable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03739" /><CodeLine lineNumber="3739"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RI.PrivateVariable &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;expected non-null private variable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03740" /><CodeLine lineNumber="3740"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RI.ReductionGen &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;expected non-null reduction generator callback&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03741" /><CodeLine lineNumber="3741"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RI.Variable-&gt;getType() == RI.PrivateVariable-&gt;getType() &amp;&amp;</span></CodeLine>
<Link id="l03742" /><CodeLine lineNumber="3742"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;expected variables and their private equivalents to have the same &quot;</span></CodeLine>
<Link id="l03743" /><CodeLine lineNumber="3743"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03744" /><CodeLine lineNumber="3744"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RI.Variable-&gt;getType()-&gt;isPointerTy() &amp;&amp;</span></CodeLine>
<Link id="l03745" /><CodeLine lineNumber="3745"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;expected variables to be pointers&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03746" /><CodeLine lineNumber="3746"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03747" /><CodeLine lineNumber="3747"></CodeLine>
<Link id="l03748" /><CodeLine lineNumber="3748"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l03749" /><CodeLine lineNumber="3749"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>();</span></CodeLine>
<Link id="l03750" /><CodeLine lineNumber="3750"></CodeLine>
<Link id="l03751" /><CodeLine lineNumber="3751"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;InsertBlock = Loc.IP.getBlock();</span></CodeLine>
<Link id="l03752" /><CodeLine lineNumber="3752"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ContinuationBlock =</span></CodeLine>
<Link id="l03753" /><CodeLine lineNumber="3753"><span class="doxyHighlight">      InsertBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(Loc.IP.getPoint(), </span><span class="doxyHighlightStringLiteral">&quot;reduce.finalize&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03754" /><CodeLine lineNumber="3754"><span class="doxyHighlight">  InsertBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l03755" /><CodeLine lineNumber="3755"></CodeLine>
<Link id="l03756" /><CodeLine lineNumber="3756"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create and populate array of type-erased pointers to private reduction</span></CodeLine>
<Link id="l03757" /><CodeLine lineNumber="3757"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// values.</span></CodeLine>
<Link id="l03758" /><CodeLine lineNumber="3758"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumReductions = ReductionInfos.size();</span></CodeLine>
<Link id="l03759" /><CodeLine lineNumber="3759"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;RedArrayTy = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), NumReductions);</span></CodeLine>
<Link id="l03760" /><CodeLine lineNumber="3760"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(AllocaIP.getBlock()-&gt;getTerminator());</span></CodeLine>
<Link id="l03761" /><CodeLine lineNumber="3761"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RedArray = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(RedArrayTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;red.array&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03762" /><CodeLine lineNumber="3762"></CodeLine>
<Link id="l03763" /><CodeLine lineNumber="3763"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(InsertBlock, InsertBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l03764" /><CodeLine lineNumber="3764"></CodeLine>
<Link id="l03765" /><CodeLine lineNumber="3765"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l03766" /><CodeLine lineNumber="3766"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/dwarf/#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = En.index();</span></CodeLine>
<Link id="l03767" /><CodeLine lineNumber="3767"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI = En.value();</span></CodeLine>
<Link id="l03768" /><CodeLine lineNumber="3768"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RedArrayElemPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa8ee5dc4e4a1b26c4bdf1a574eefe2fc">CreateConstInBoundsGEP2&#95;64</a>(</span></CodeLine>
<Link id="l03769" /><CodeLine lineNumber="3769"><span class="doxyHighlight">        RedArrayTy, RedArray, 0, Index, </span><span class="doxyHighlightStringLiteral">&quot;red.array.elem.&quot;</span><span class="doxyHighlight"> + Twine(Index));</span></CodeLine>
<Link id="l03770" /><CodeLine lineNumber="3770"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(RI.PrivateVariable, RedArrayElemPtr);</span></CodeLine>
<Link id="l03771" /><CodeLine lineNumber="3771"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03772" /><CodeLine lineNumber="3772"></CodeLine>
<Link id="l03773" /><CodeLine lineNumber="3773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit a call to the runtime function that orchestrates the reduction.</span></CodeLine>
<Link id="l03774" /><CodeLine lineNumber="3774"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Declare the reduction function in the process.</span></CodeLine>
<Link id="l03775" /><CodeLine lineNumber="3775"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;<a href="/docs/api/namespaces/llvm/rdf/#ad43aeb5ac76bcef25986fbb0918d1165">Func</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l03776" /><CodeLine lineNumber="3776"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/machinecheckdebugify-cpp/#a85892acfa8970627e9bd9c9815f15c25">Module</a> &#42;<a href="/docs/api/files/lib/lib/codegen/machinecheckdebugify-cpp/#a85892acfa8970627e9bd9c9815f15c25">Module</a> = <a href="/docs/api/namespaces/llvm/rdf/#ad43aeb5ac76bcef25986fbb0918d1165">Func</a>-&gt;getParent();</span></CodeLine>
<Link id="l03777" /><CodeLine lineNumber="3777"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l03778" /><CodeLine lineNumber="3778"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l03779" /><CodeLine lineNumber="3779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CanGenerateAtomic = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(ReductionInfos, &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI) &#123;</span></CodeLine>
<Link id="l03780" /><CodeLine lineNumber="3780"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RI.AtomicReductionGen;</span></CodeLine>
<Link id="l03781" /><CodeLine lineNumber="3781"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l03782" /><CodeLine lineNumber="3782"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize,</span></CodeLine>
<Link id="l03783" /><CodeLine lineNumber="3783"><span class="doxyHighlight">                                  CanGenerateAtomic</span></CodeLine>
<Link id="l03784" /><CodeLine lineNumber="3784"><span class="doxyHighlight">                                      ? IdentFlag::OMP&#95;IDENT&#95;FLAG&#95;ATOMIC&#95;REDUCE</span></CodeLine>
<Link id="l03785" /><CodeLine lineNumber="3785"><span class="doxyHighlight">                                      : <a href="/docs/api/namespaces/llvm/omp/#a0e821d8251c97d66ca185efe2f8ffde2">IdentFlag</a>(0));</span></CodeLine>
<Link id="l03786" /><CodeLine lineNumber="3786"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l03787" /><CodeLine lineNumber="3787"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;NumVariables = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(NumReductions);</span></CodeLine>
<Link id="l03788" /><CodeLine lineNumber="3788"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/codegen/machinecheckdebugify-cpp/#a85892acfa8970627e9bd9c9815f15c25">Module</a>-&gt;getDataLayout();</span></CodeLine>
<Link id="l03789" /><CodeLine lineNumber="3789"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> RedArrayByteSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(RedArrayTy);</span></CodeLine>
<Link id="l03790" /><CodeLine lineNumber="3790"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;RedArraySize = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(RedArrayByteSize);</span></CodeLine>
<Link id="l03791" /><CodeLine lineNumber="3791"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;ReductionFunc = <a href="#a669fae0a15d7219ef3ca3f3b16e3f5a0">getFreshReductionFunc</a>(&#42;<a href="/docs/api/files/lib/lib/codegen/machinecheckdebugify-cpp/#a85892acfa8970627e9bd9c9815f15c25">Module</a>);</span></CodeLine>
<Link id="l03792" /><CodeLine lineNumber="3792"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Lock = getOMPCriticalRegionLock(</span><span class="doxyHighlightStringLiteral">&quot;.reduction&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03793" /><CodeLine lineNumber="3793"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;ReduceFunc = getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l03794" /><CodeLine lineNumber="3794"><span class="doxyHighlight">      IsNoWait ? RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;reduce&#95;nowait</span></CodeLine>
<Link id="l03795" /><CodeLine lineNumber="3795"><span class="doxyHighlight">               : RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;reduce);</span></CodeLine>
<Link id="l03796" /><CodeLine lineNumber="3796"><span class="doxyHighlight">  CallInst &#42;ReduceCall =</span></CodeLine>
<Link id="l03797" /><CodeLine lineNumber="3797"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(ReduceFunc,</span></CodeLine>
<Link id="l03798" /><CodeLine lineNumber="3798"><span class="doxyHighlight">                         &#123;Ident, ThreadId, NumVariables, RedArraySize, RedArray,</span></CodeLine>
<Link id="l03799" /><CodeLine lineNumber="3799"><span class="doxyHighlight">                          ReductionFunc, Lock&#125;,</span></CodeLine>
<Link id="l03800" /><CodeLine lineNumber="3800"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;reduce&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03801" /><CodeLine lineNumber="3801"></CodeLine>
<Link id="l03802" /><CodeLine lineNumber="3802"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create final reduction entry blocks for the atomic and non-atomic case.</span></CodeLine>
<Link id="l03803" /><CodeLine lineNumber="3803"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit IR that dispatches control flow to one of the blocks based on the</span></CodeLine>
<Link id="l03804" /><CodeLine lineNumber="3804"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reduction supporting the atomic mode.</span></CodeLine>
<Link id="l03805" /><CodeLine lineNumber="3805"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;NonAtomicRedBlock =</span></CodeLine>
<Link id="l03806" /><CodeLine lineNumber="3806"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/files/lib/lib/codegen/machinecheckdebugify-cpp/#a85892acfa8970627e9bd9c9815f15c25">Module</a>-&gt;getContext(), </span><span class="doxyHighlightStringLiteral">&quot;reduce.switch.nonatomic&quot;</span><span class="doxyHighlight">, Func);</span></CodeLine>
<Link id="l03807" /><CodeLine lineNumber="3807"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;AtomicRedBlock =</span></CodeLine>
<Link id="l03808" /><CodeLine lineNumber="3808"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/files/lib/lib/codegen/machinecheckdebugify-cpp/#a85892acfa8970627e9bd9c9815f15c25">Module</a>-&gt;getContext(), </span><span class="doxyHighlightStringLiteral">&quot;reduce.switch.atomic&quot;</span><span class="doxyHighlight">, Func);</span></CodeLine>
<Link id="l03809" /><CodeLine lineNumber="3809"><span class="doxyHighlight">  SwitchInst &#42;<a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380abbc155fb2b111bf61c4f5ff892915e6b">Switch</a> =</span></CodeLine>
<Link id="l03810" /><CodeLine lineNumber="3810"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8b123015de85b2f41b0deda2aeaad9d3">CreateSwitch</a>(ReduceCall, ContinuationBlock, </span><span class="doxyHighlightComment">/&#42; NumCases &#42;/</span><span class="doxyHighlight"> 2);</span></CodeLine>
<Link id="l03811" /><CodeLine lineNumber="3811"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380abbc155fb2b111bf61c4f5ff892915e6b">Switch</a>-&gt;addCase(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(1), NonAtomicRedBlock);</span></CodeLine>
<Link id="l03812" /><CodeLine lineNumber="3812"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coro/#a36a5e731a6e92a83c26e5fee63d12380abbc155fb2b111bf61c4f5ff892915e6b">Switch</a>-&gt;addCase(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(2), AtomicRedBlock);</span></CodeLine>
<Link id="l03813" /><CodeLine lineNumber="3813"></CodeLine>
<Link id="l03814" /><CodeLine lineNumber="3814"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Populate the non-atomic reduction using the elementwise reduction function.</span></CodeLine>
<Link id="l03815" /><CodeLine lineNumber="3815"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This loads the elements from the global and private variables and reduces</span></CodeLine>
<Link id="l03816" /><CodeLine lineNumber="3816"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them before storing back the result to the global variable.</span></CodeLine>
<Link id="l03817" /><CodeLine lineNumber="3817"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(NonAtomicRedBlock);</span></CodeLine>
<Link id="l03818" /><CodeLine lineNumber="3818"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l03819" /><CodeLine lineNumber="3819"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI = En.value();</span></CodeLine>
<Link id="l03820" /><CodeLine lineNumber="3820"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;<a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a> = RI.ElementType;</span></CodeLine>
<Link id="l03821" /><CodeLine lineNumber="3821"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We have one less load for by-ref case because that load is now inside of</span></CodeLine>
<Link id="l03822" /><CodeLine lineNumber="3822"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the reduction region</span></CodeLine>
<Link id="l03823" /><CodeLine lineNumber="3823"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RedValue = RI.Variable;</span></CodeLine>
<Link id="l03824" /><CodeLine lineNumber="3824"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsByRef&#91;En.index()&#93;) &#123;</span></CodeLine>
<Link id="l03825" /><CodeLine lineNumber="3825"><span class="doxyHighlight">      RedValue = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(<a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>, RI.Variable,</span></CodeLine>
<Link id="l03826" /><CodeLine lineNumber="3826"><span class="doxyHighlight">                                    </span><span class="doxyHighlightStringLiteral">&quot;red.value.&quot;</span><span class="doxyHighlight"> + Twine(En.index()));</span></CodeLine>
<Link id="l03827" /><CodeLine lineNumber="3827"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03828" /><CodeLine lineNumber="3828"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PrivateRedValue =</span></CodeLine>
<Link id="l03829" /><CodeLine lineNumber="3829"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(<a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>, RI.PrivateVariable,</span></CodeLine>
<Link id="l03830" /><CodeLine lineNumber="3830"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;red.private.value.&quot;</span><span class="doxyHighlight"> + Twine(En.index()));</span></CodeLine>
<Link id="l03831" /><CodeLine lineNumber="3831"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Reduced;</span></CodeLine>
<Link id="l03832" /><CodeLine lineNumber="3832"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l03833" /><CodeLine lineNumber="3833"><span class="doxyHighlight">        RI.ReductionGen(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), RedValue, PrivateRedValue, Reduced);</span></CodeLine>
<Link id="l03834" /><CodeLine lineNumber="3834"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l03835" /><CodeLine lineNumber="3835"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l03836" /><CodeLine lineNumber="3836"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#42;AfterIP);</span></CodeLine>
<Link id="l03837" /><CodeLine lineNumber="3837"></CodeLine>
<Link id="l03838" /><CodeLine lineNumber="3838"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>())</span></CodeLine>
<Link id="l03839" /><CodeLine lineNumber="3839"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>();</span></CodeLine>
<Link id="l03840" /><CodeLine lineNumber="3840"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for by-ref case, the load is inside of the reduction region</span></CodeLine>
<Link id="l03841" /><CodeLine lineNumber="3841"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsByRef&#91;En.index()&#93;)</span></CodeLine>
<Link id="l03842" /><CodeLine lineNumber="3842"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Reduced, RI.Variable);</span></CodeLine>
<Link id="l03843" /><CodeLine lineNumber="3843"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03844" /><CodeLine lineNumber="3844"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;EndReduceFunc = getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l03845" /><CodeLine lineNumber="3845"><span class="doxyHighlight">      IsNoWait ? RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;end&#95;reduce&#95;nowait</span></CodeLine>
<Link id="l03846" /><CodeLine lineNumber="3846"><span class="doxyHighlight">               : RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;end&#95;reduce);</span></CodeLine>
<Link id="l03847" /><CodeLine lineNumber="3847"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(EndReduceFunc, &#123;Ident, ThreadId, Lock&#125;);</span></CodeLine>
<Link id="l03848" /><CodeLine lineNumber="3848"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(ContinuationBlock);</span></CodeLine>
<Link id="l03849" /><CodeLine lineNumber="3849"></CodeLine>
<Link id="l03850" /><CodeLine lineNumber="3850"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Populate the atomic reduction using the atomic elementwise reduction</span></CodeLine>
<Link id="l03851" /><CodeLine lineNumber="3851"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function. There are no loads/stores here because they will be happening</span></CodeLine>
<Link id="l03852" /><CodeLine lineNumber="3852"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// inside the atomic elementwise reduction.</span></CodeLine>
<Link id="l03853" /><CodeLine lineNumber="3853"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(AtomicRedBlock);</span></CodeLine>
<Link id="l03854" /><CodeLine lineNumber="3854"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CanGenerateAtomic &amp;&amp; <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">llvm::none&#95;of</a>(IsByRef, &#91;&#93;(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>; &#125;)) &#123;</span></CodeLine>
<Link id="l03855" /><CodeLine lineNumber="3855"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI : ReductionInfos) &#123;</span></CodeLine>
<Link id="l03856" /><CodeLine lineNumber="3856"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP = RI.AtomicReductionGen(</span></CodeLine>
<Link id="l03857" /><CodeLine lineNumber="3857"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), RI.ElementType, RI.Variable, RI.PrivateVariable);</span></CodeLine>
<Link id="l03858" /><CodeLine lineNumber="3858"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l03859" /><CodeLine lineNumber="3859"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l03860" /><CodeLine lineNumber="3860"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#42;AfterIP);</span></CodeLine>
<Link id="l03861" /><CodeLine lineNumber="3861"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>())</span></CodeLine>
<Link id="l03862" /><CodeLine lineNumber="3862"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>();</span></CodeLine>
<Link id="l03863" /><CodeLine lineNumber="3863"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03864" /><CodeLine lineNumber="3864"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(ContinuationBlock);</span></CodeLine>
<Link id="l03865" /><CodeLine lineNumber="3865"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03866" /><CodeLine lineNumber="3866"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a39acc29443d48968a798fb22a76fa4c0">CreateUnreachable</a>();</span></CodeLine>
<Link id="l03867" /><CodeLine lineNumber="3867"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03868" /><CodeLine lineNumber="3868"></CodeLine>
<Link id="l03869" /><CodeLine lineNumber="3869"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Populate the outlined reduction function using the elementwise reduction</span></CodeLine>
<Link id="l03870" /><CodeLine lineNumber="3870"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function. Partial values are extracted from the type-erased array of</span></CodeLine>
<Link id="l03871" /><CodeLine lineNumber="3871"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pointers to private variables.</span></CodeLine>
<Link id="l03872" /><CodeLine lineNumber="3872"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ReductionFuncBlock =</span></CodeLine>
<Link id="l03873" /><CodeLine lineNumber="3873"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/files/lib/lib/codegen/machinecheckdebugify-cpp/#a85892acfa8970627e9bd9c9815f15c25">Module</a>-&gt;getContext(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, ReductionFunc);</span></CodeLine>
<Link id="l03874" /><CodeLine lineNumber="3874"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ReductionFuncBlock);</span></CodeLine>
<Link id="l03875" /><CodeLine lineNumber="3875"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LHSArrayPtr = ReductionFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(0);</span></CodeLine>
<Link id="l03876" /><CodeLine lineNumber="3876"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RHSArrayPtr = ReductionFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(1);</span></CodeLine>
<Link id="l03877" /><CodeLine lineNumber="3877"></CodeLine>
<Link id="l03878" /><CodeLine lineNumber="3878"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> En : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ReductionInfos)) &#123;</span></CodeLine>
<Link id="l03879" /><CodeLine lineNumber="3879"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> ReductionInfo &amp;RI = En.value();</span></CodeLine>
<Link id="l03880" /><CodeLine lineNumber="3880"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LHSI8PtrPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa8ee5dc4e4a1b26c4bdf1a574eefe2fc">CreateConstInBoundsGEP2&#95;64</a>(</span></CodeLine>
<Link id="l03881" /><CodeLine lineNumber="3881"><span class="doxyHighlight">        RedArrayTy, LHSArrayPtr, 0, En.index());</span></CodeLine>
<Link id="l03882" /><CodeLine lineNumber="3882"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LHSI8Ptr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), LHSI8PtrPtr);</span></CodeLine>
<Link id="l03883" /><CodeLine lineNumber="3883"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LHSPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(LHSI8Ptr, RI.Variable-&gt;getType());</span></CodeLine>
<Link id="l03884" /><CodeLine lineNumber="3884"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(RI.ElementType, LHSPtr);</span></CodeLine>
<Link id="l03885" /><CodeLine lineNumber="3885"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RHSI8PtrPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa8ee5dc4e4a1b26c4bdf1a574eefe2fc">CreateConstInBoundsGEP2&#95;64</a>(</span></CodeLine>
<Link id="l03886" /><CodeLine lineNumber="3886"><span class="doxyHighlight">        RedArrayTy, RHSArrayPtr, 0, En.index());</span></CodeLine>
<Link id="l03887" /><CodeLine lineNumber="3887"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RHSI8Ptr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), RHSI8PtrPtr);</span></CodeLine>
<Link id="l03888" /><CodeLine lineNumber="3888"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RHSPtr =</span></CodeLine>
<Link id="l03889" /><CodeLine lineNumber="3889"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(RHSI8Ptr, RI.PrivateVariable-&gt;getType());</span></CodeLine>
<Link id="l03890" /><CodeLine lineNumber="3890"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(RI.ElementType, RHSPtr);</span></CodeLine>
<Link id="l03891" /><CodeLine lineNumber="3891"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Reduced;</span></CodeLine>
<Link id="l03892" /><CodeLine lineNumber="3892"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l03893" /><CodeLine lineNumber="3893"><span class="doxyHighlight">        RI.ReductionGen(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, Reduced);</span></CodeLine>
<Link id="l03894" /><CodeLine lineNumber="3894"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l03895" /><CodeLine lineNumber="3895"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l03896" /><CodeLine lineNumber="3896"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#42;AfterIP);</span></CodeLine>
<Link id="l03897" /><CodeLine lineNumber="3897"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>())</span></CodeLine>
<Link id="l03898" /><CodeLine lineNumber="3898"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>();</span></CodeLine>
<Link id="l03899" /><CodeLine lineNumber="3899"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// store is inside of the reduction region when using by-ref</span></CodeLine>
<Link id="l03900" /><CodeLine lineNumber="3900"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsByRef&#91;En.index()&#93;)</span></CodeLine>
<Link id="l03901" /><CodeLine lineNumber="3901"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Reduced, LHSPtr);</span></CodeLine>
<Link id="l03902" /><CodeLine lineNumber="3902"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03903" /><CodeLine lineNumber="3903"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l03904" /><CodeLine lineNumber="3904"></CodeLine>
<Link id="l03905" /><CodeLine lineNumber="3905"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ContinuationBlock);</span></CodeLine>
<Link id="l03906" /><CodeLine lineNumber="3906"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l03907" /><CodeLine lineNumber="3907"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03908" /><CodeLine lineNumber="3908"></CodeLine>
<Link id="l03909" /><CodeLine lineNumber="3909"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a></span></CodeLine>
<Link id="l03910" /><CodeLine lineNumber="3910"><span class="doxyHighlight">OpenMPIRBuilder::createMaster(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l03911" /><CodeLine lineNumber="3911"><span class="doxyHighlight">                              BodyGenCallbackTy BodyGenCB,</span></CodeLine>
<Link id="l03912" /><CodeLine lineNumber="3912"><span class="doxyHighlight">                              FinalizeCallbackTy FiniCB) &#123;</span></CodeLine>
<Link id="l03913" /><CodeLine lineNumber="3913"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l03914" /><CodeLine lineNumber="3914"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Loc.IP;</span></CodeLine>
<Link id="l03915" /><CodeLine lineNumber="3915"></CodeLine>
<Link id="l03916" /><CodeLine lineNumber="3916"><span class="doxyHighlight">  Directive OMPD = Directive::OMPD&#95;master;</span></CodeLine>
<Link id="l03917" /><CodeLine lineNumber="3917"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l03918" /><CodeLine lineNumber="3918"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l03919" /><CodeLine lineNumber="3919"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l03920" /><CodeLine lineNumber="3920"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l03921" /><CodeLine lineNumber="3921"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;Ident, ThreadId&#125;;</span></CodeLine>
<Link id="l03922" /><CodeLine lineNumber="3922"></CodeLine>
<Link id="l03923" /><CodeLine lineNumber="3923"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;EntryRTLFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;master);</span></CodeLine>
<Link id="l03924" /><CodeLine lineNumber="3924"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;EntryCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(EntryRTLFn, Args);</span></CodeLine>
<Link id="l03925" /><CodeLine lineNumber="3925"></CodeLine>
<Link id="l03926" /><CodeLine lineNumber="3926"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;ExitRTLFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;end&#95;master);</span></CodeLine>
<Link id="l03927" /><CodeLine lineNumber="3927"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExitCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(ExitRTLFn, Args);</span></CodeLine>
<Link id="l03928" /><CodeLine lineNumber="3928"></CodeLine>
<Link id="l03929" /><CodeLine lineNumber="3929"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EmitOMPInlinedRegion(OMPD, EntryCall, ExitCall, BodyGenCB, FiniCB,</span></CodeLine>
<Link id="l03930" /><CodeLine lineNumber="3930"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;Conditional&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;hasFinalize&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03931" /><CodeLine lineNumber="3931"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03932" /><CodeLine lineNumber="3932"></CodeLine>
<Link id="l03933" /><CodeLine lineNumber="3933"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a></span></CodeLine>
<Link id="l03934" /><CodeLine lineNumber="3934"><span class="doxyHighlight">OpenMPIRBuilder::createMasked(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l03935" /><CodeLine lineNumber="3935"><span class="doxyHighlight">                              BodyGenCallbackTy BodyGenCB,</span></CodeLine>
<Link id="l03936" /><CodeLine lineNumber="3936"><span class="doxyHighlight">                              FinalizeCallbackTy FiniCB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#aaee5189b9c4db9ad666a88abaf1ee0c4ad7778d0c64b6ba21494c97f77a66885a">Filter</a>) &#123;</span></CodeLine>
<Link id="l03937" /><CodeLine lineNumber="3937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l03938" /><CodeLine lineNumber="3938"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Loc.IP;</span></CodeLine>
<Link id="l03939" /><CodeLine lineNumber="3939"></CodeLine>
<Link id="l03940" /><CodeLine lineNumber="3940"><span class="doxyHighlight">  Directive OMPD = Directive::OMPD&#95;masked;</span></CodeLine>
<Link id="l03941" /><CodeLine lineNumber="3941"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l03942" /><CodeLine lineNumber="3942"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l03943" /><CodeLine lineNumber="3943"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l03944" /><CodeLine lineNumber="3944"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l03945" /><CodeLine lineNumber="3945"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;Ident, ThreadId, <a href="/docs/api/namespaces/llvm/#aaee5189b9c4db9ad666a88abaf1ee0c4ad7778d0c64b6ba21494c97f77a66885a">Filter</a>&#125;;</span></CodeLine>
<Link id="l03946" /><CodeLine lineNumber="3946"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ArgsEnd&#91;&#93; = &#123;Ident, ThreadId&#125;;</span></CodeLine>
<Link id="l03947" /><CodeLine lineNumber="3947"></CodeLine>
<Link id="l03948" /><CodeLine lineNumber="3948"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;EntryRTLFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;masked);</span></CodeLine>
<Link id="l03949" /><CodeLine lineNumber="3949"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;EntryCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(EntryRTLFn, Args);</span></CodeLine>
<Link id="l03950" /><CodeLine lineNumber="3950"></CodeLine>
<Link id="l03951" /><CodeLine lineNumber="3951"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;ExitRTLFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;end&#95;masked);</span></CodeLine>
<Link id="l03952" /><CodeLine lineNumber="3952"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExitCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(ExitRTLFn, ArgsEnd);</span></CodeLine>
<Link id="l03953" /><CodeLine lineNumber="3953"></CodeLine>
<Link id="l03954" /><CodeLine lineNumber="3954"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EmitOMPInlinedRegion(OMPD, EntryCall, ExitCall, BodyGenCB, FiniCB,</span></CodeLine>
<Link id="l03955" /><CodeLine lineNumber="3955"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;Conditional&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;hasFinalize&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03956" /><CodeLine lineNumber="3956"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03957" /><CodeLine lineNumber="3957"></CodeLine>
<Link id="l03958" /><CodeLine lineNumber="3958" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a445fa52d77040bccb16bfea111234a2e"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;<a href="/docs/api/classes/llvm/openmpirbuilder/#a445fa52d77040bccb16bfea111234a2e">OpenMPIRBuilder::createLoopSkeleton</a>(</span></CodeLine>
<Link id="l03959" /><CodeLine lineNumber="3959"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;TripCount, <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PreInsertBefore,</span></CodeLine>
<Link id="l03960" /><CodeLine lineNumber="3960"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PostInsertBefore, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name) &#123;</span></CodeLine>
<Link id="l03961" /><CodeLine lineNumber="3961"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/module">Module</a> &#42;M = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getParent();</span></CodeLine>
<Link id="l03962" /><CodeLine lineNumber="3962"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = M-&gt;getContext();</span></CodeLine>
<Link id="l03963" /><CodeLine lineNumber="3963"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;IndVarTy = TripCount-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l03964" /><CodeLine lineNumber="3964"></CodeLine>
<Link id="l03965" /><CodeLine lineNumber="3965"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the basic block structure.</span></CodeLine>
<Link id="l03966" /><CodeLine lineNumber="3966"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader =</span></CodeLine>
<Link id="l03967" /><CodeLine lineNumber="3967"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;&quot;</span><span class="doxyHighlight"> + Name + </span><span class="doxyHighlightStringLiteral">&quot;.preheader&quot;</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, PreInsertBefore);</span></CodeLine>
<Link id="l03968" /><CodeLine lineNumber="3968"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Header =</span></CodeLine>
<Link id="l03969" /><CodeLine lineNumber="3969"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;&quot;</span><span class="doxyHighlight"> + Name + </span><span class="doxyHighlightStringLiteral">&quot;.header&quot;</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, PreInsertBefore);</span></CodeLine>
<Link id="l03970" /><CodeLine lineNumber="3970"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> =</span></CodeLine>
<Link id="l03971" /><CodeLine lineNumber="3971"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;&quot;</span><span class="doxyHighlight"> + Name + </span><span class="doxyHighlightStringLiteral">&quot;.cond&quot;</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, PreInsertBefore);</span></CodeLine>
<Link id="l03972" /><CodeLine lineNumber="3972"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Body =</span></CodeLine>
<Link id="l03973" /><CodeLine lineNumber="3973"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;&quot;</span><span class="doxyHighlight"> + Name + </span><span class="doxyHighlightStringLiteral">&quot;.body&quot;</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, PreInsertBefore);</span></CodeLine>
<Link id="l03974" /><CodeLine lineNumber="3974"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Latch =</span></CodeLine>
<Link id="l03975" /><CodeLine lineNumber="3975"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;&quot;</span><span class="doxyHighlight"> + Name + </span><span class="doxyHighlightStringLiteral">&quot;.inc&quot;</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, PostInsertBefore);</span></CodeLine>
<Link id="l03976" /><CodeLine lineNumber="3976"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Exit =</span></CodeLine>
<Link id="l03977" /><CodeLine lineNumber="3977"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;&quot;</span><span class="doxyHighlight"> + Name + </span><span class="doxyHighlightStringLiteral">&quot;.exit&quot;</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, PostInsertBefore);</span></CodeLine>
<Link id="l03978" /><CodeLine lineNumber="3978"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa7bfcadb5535fe8aad5032762b7bfe159">After</a> =</span></CodeLine>
<Link id="l03979" /><CodeLine lineNumber="3979"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;&quot;</span><span class="doxyHighlight"> + Name + </span><span class="doxyHighlightStringLiteral">&quot;.after&quot;</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, PostInsertBefore);</span></CodeLine>
<Link id="l03980" /><CodeLine lineNumber="3980"></CodeLine>
<Link id="l03981" /><CodeLine lineNumber="3981"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use specified DebugLoc for new instructions.</span></CodeLine>
<Link id="l03982" /><CodeLine lineNumber="3982"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l03983" /><CodeLine lineNumber="3983"></CodeLine>
<Link id="l03984" /><CodeLine lineNumber="3984"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Preheader);</span></CodeLine>
<Link id="l03985" /><CodeLine lineNumber="3985"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(Header);</span></CodeLine>
<Link id="l03986" /><CodeLine lineNumber="3986"></CodeLine>
<Link id="l03987" /><CodeLine lineNumber="3987"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Header);</span></CodeLine>
<Link id="l03988" /><CodeLine lineNumber="3988"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;IndVarPHI = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(IndVarTy, 2, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;&quot;</span><span class="doxyHighlight"> + Name + </span><span class="doxyHighlightStringLiteral">&quot;.iv&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03989" /><CodeLine lineNumber="3989"><span class="doxyHighlight">  IndVarPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(ConstantInt::get(IndVarTy, 0), Preheader);</span></CodeLine>
<Link id="l03990" /><CodeLine lineNumber="3990"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l03991" /><CodeLine lineNumber="3991"></CodeLine>
<Link id="l03992" /><CodeLine lineNumber="3992"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l03993" /><CodeLine lineNumber="3993"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cmp =</span></CodeLine>
<Link id="l03994" /><CodeLine lineNumber="3994"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a09b4daefdf5b73efba51ce7ae6cd45c5">CreateICmpULT</a>(IndVarPHI, TripCount, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;&quot;</span><span class="doxyHighlight"> + Name + </span><span class="doxyHighlightStringLiteral">&quot;.cmp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03995" /><CodeLine lineNumber="3995"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(Cmp, Body, Exit);</span></CodeLine>
<Link id="l03996" /><CodeLine lineNumber="3996"></CodeLine>
<Link id="l03997" /><CodeLine lineNumber="3997"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Body);</span></CodeLine>
<Link id="l03998" /><CodeLine lineNumber="3998"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(Latch);</span></CodeLine>
<Link id="l03999" /><CodeLine lineNumber="3999"></CodeLine>
<Link id="l04000" /><CodeLine lineNumber="4000"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Latch);</span></CodeLine>
<Link id="l04001" /><CodeLine lineNumber="4001"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(IndVarPHI, ConstantInt::get(IndVarTy, 1),</span></CodeLine>
<Link id="l04002" /><CodeLine lineNumber="4002"><span class="doxyHighlight">                                  </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;&quot;</span><span class="doxyHighlight"> + Name + </span><span class="doxyHighlightStringLiteral">&quot;.next&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04003" /><CodeLine lineNumber="4003"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(Header);</span></CodeLine>
<Link id="l04004" /><CodeLine lineNumber="4004"><span class="doxyHighlight">  IndVarPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a>, Latch);</span></CodeLine>
<Link id="l04005" /><CodeLine lineNumber="4005"></CodeLine>
<Link id="l04006" /><CodeLine lineNumber="4006"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Exit);</span></CodeLine>
<Link id="l04007" /><CodeLine lineNumber="4007"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa7bfcadb5535fe8aad5032762b7bfe159">After</a>);</span></CodeLine>
<Link id="l04008" /><CodeLine lineNumber="4008"></CodeLine>
<Link id="l04009" /><CodeLine lineNumber="4009"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remember and return the canonical control flow.</span></CodeLine>
<Link id="l04010" /><CodeLine lineNumber="4010"><span class="doxyHighlight">  LoopInfos.emplace&#95;front();</span></CodeLine>
<Link id="l04011" /><CodeLine lineNumber="4011"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;CL = &amp;LoopInfos.front();</span></CodeLine>
<Link id="l04012" /><CodeLine lineNumber="4012"></CodeLine>
<Link id="l04013" /><CodeLine lineNumber="4013"><span class="doxyHighlight">  CL-&gt;Header = Header;</span></CodeLine>
<Link id="l04014" /><CodeLine lineNumber="4014"><span class="doxyHighlight">  CL-&gt;Cond = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>;</span></CodeLine>
<Link id="l04015" /><CodeLine lineNumber="4015"><span class="doxyHighlight">  CL-&gt;Latch = Latch;</span></CodeLine>
<Link id="l04016" /><CodeLine lineNumber="4016"><span class="doxyHighlight">  CL-&gt;Exit = Exit;</span></CodeLine>
<Link id="l04017" /><CodeLine lineNumber="4017"></CodeLine>
<Link id="l04018" /><CodeLine lineNumber="4018"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l04019" /><CodeLine lineNumber="4019"><span class="doxyHighlight">  CL-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a32ff799dcb39887a8d21322020f305ba">assertOK</a>();</span></CodeLine>
<Link id="l04020" /><CodeLine lineNumber="4020"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l04021" /><CodeLine lineNumber="4021"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CL;</span></CodeLine>
<Link id="l04022" /><CodeLine lineNumber="4022"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04023" /><CodeLine lineNumber="4023"></CodeLine>
<Link id="l04024" /><CodeLine lineNumber="4024"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/expected">Expected&lt;CanonicalLoopInfo &#42;&gt;</a></span></CodeLine>
<Link id="l04025" /><CodeLine lineNumber="4025" lineLink="/docs/api/classes/llvm/openmpirbuilder/#ae0287686a5ffe03bc264972c862726ea"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#ae0287686a5ffe03bc264972c862726ea">OpenMPIRBuilder::createCanonicalLoop</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l04026" /><CodeLine lineNumber="4026"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/openmpirbuilder/#a296d2e28bddf1051d614f48b61005899">LoopBodyGenCallbackTy</a> BodyGenCB,</span></CodeLine>
<Link id="l04027" /><CodeLine lineNumber="4027"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/value">Value</a> &#42;TripCount, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name) &#123;</span></CodeLine>
<Link id="l04028" /><CodeLine lineNumber="4028"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP.getBlock();</span></CodeLine>
<Link id="l04029" /><CodeLine lineNumber="4029"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NextBB = BB-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>();</span></CodeLine>
<Link id="l04030" /><CodeLine lineNumber="4030"></CodeLine>
<Link id="l04031" /><CodeLine lineNumber="4031"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;CL = <a href="/docs/api/classes/llvm/openmpirbuilder/#a445fa52d77040bccb16bfea111234a2e">createLoopSkeleton</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>.DL, TripCount, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(),</span></CodeLine>
<Link id="l04032" /><CodeLine lineNumber="4032"><span class="doxyHighlight">                                             NextBB, NextBB, Name);</span></CodeLine>
<Link id="l04033" /><CodeLine lineNumber="4033"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa7bfcadb5535fe8aad5032762b7bfe159">After</a> = CL-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a92d8bce979891dc43b6573e8cca2e58c">getAfter</a>();</span></CodeLine>
<Link id="l04034" /><CodeLine lineNumber="4034"></CodeLine>
<Link id="l04035" /><CodeLine lineNumber="4035"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If location is not set, don&#39;t connect the loop.</span></CodeLine>
<Link id="l04036" /><CodeLine lineNumber="4036"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>)) &#123;</span></CodeLine>
<Link id="l04037" /><CodeLine lineNumber="4037"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Split the loop at the insertion point: Branch to the preheader and move</span></CodeLine>
<Link id="l04038" /><CodeLine lineNumber="4038"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// every following instruction to after the loop (the After BB). Also, the</span></CodeLine>
<Link id="l04039" /><CodeLine lineNumber="4039"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// new successor is the loop&#39;s after block.</span></CodeLine>
<Link id="l04040" /><CodeLine lineNumber="4040"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a78e14f66d8a8405c6882b5ff6a3b7617">spliceBB</a>(Builder, <a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa7bfcadb5535fe8aad5032762b7bfe159">After</a>, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04041" /><CodeLine lineNumber="4041"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(CL-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>());</span></CodeLine>
<Link id="l04042" /><CodeLine lineNumber="4042"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04043" /><CodeLine lineNumber="4043"></CodeLine>
<Link id="l04044" /><CodeLine lineNumber="4044"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit the body content. We do it after connecting the loop to the CFG to</span></CodeLine>
<Link id="l04045" /><CodeLine lineNumber="4045"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// avoid that the callback encounters degenerate BBs.</span></CodeLine>
<Link id="l04046" /><CodeLine lineNumber="4046"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/error">Error</a> Err = BodyGenCB(CL-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a8031442528bff99473596a0de4aa0422">getBodyIP</a>(), CL-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#af4131f5f461f1138483addfd7cd7f579">getIndVar</a>()))</span></CodeLine>
<Link id="l04047" /><CodeLine lineNumber="4047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l04048" /><CodeLine lineNumber="4048"></CodeLine>
<Link id="l04049" /><CodeLine lineNumber="4049"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l04050" /><CodeLine lineNumber="4050"><span class="doxyHighlight">  CL-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a32ff799dcb39887a8d21322020f305ba">assertOK</a>();</span></CodeLine>
<Link id="l04051" /><CodeLine lineNumber="4051"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l04052" /><CodeLine lineNumber="4052"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CL;</span></CodeLine>
<Link id="l04053" /><CodeLine lineNumber="4053"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04054" /><CodeLine lineNumber="4054"></CodeLine>
<Link id="l04055" /><CodeLine lineNumber="4055" lineLink="/docs/api/classes/llvm/openmpirbuilder/#ac669acbd0f638c6ef32977575362052e"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/expected">Expected&lt;CanonicalLoopInfo &#42;&gt;</a> <a href="/docs/api/classes/llvm/openmpirbuilder/#ae0287686a5ffe03bc264972c862726ea">OpenMPIRBuilder::createCanonicalLoop</a>(</span></CodeLine>
<Link id="l04056" /><CodeLine lineNumber="4056"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/classes/llvm/openmpirbuilder/#a296d2e28bddf1051d614f48b61005899">LoopBodyGenCallbackTy</a> BodyGenCB,</span></CodeLine>
<Link id="l04057" /><CodeLine lineNumber="4057"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Start, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Stop, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Step, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSigned, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InclusiveStop,</span></CodeLine>
<Link id="l04058" /><CodeLine lineNumber="4058"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> ComputeIP, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name) &#123;</span></CodeLine>
<Link id="l04059" /><CodeLine lineNumber="4059"></CodeLine>
<Link id="l04060" /><CodeLine lineNumber="4060"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Consider the following difficulties (assuming 8-bit signed integers):</span></CodeLine>
<Link id="l04061" /><CodeLine lineNumber="4061"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  &#42; Adding \\p Step to the loop counter which passes \\p Stop may overflow:</span></CodeLine>
<Link id="l04062" /><CodeLine lineNumber="4062"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      DO I = 1, 100, 50</span></CodeLine>
<Link id="l04063" /><CodeLine lineNumber="4063"><span class="doxyHighlightComment">  ///  &#42; A \\p Step of INT&#95;MIN cannot not be normalized to a positive direction:</span></CodeLine>
<Link id="l04064" /><CodeLine lineNumber="4064"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      DO I = 100, 0, -128</span></CodeLine>
<Link id="l04065" /><CodeLine lineNumber="4065"></CodeLine>
<Link id="l04066" /><CodeLine lineNumber="4066"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Start, Stop and Step must be of the same integer type.</span></CodeLine>
<Link id="l04067" /><CodeLine lineNumber="4067"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IndVarTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(Start-&gt;getType());</span></CodeLine>
<Link id="l04068" /><CodeLine lineNumber="4068"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IndVarTy == Stop-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Stop type mismatch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04069" /><CodeLine lineNumber="4069"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IndVarTy == Step-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Step type mismatch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04070" /><CodeLine lineNumber="4070"></CodeLine>
<Link id="l04071" /><CodeLine lineNumber="4071"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> ComputeLoc =</span></CodeLine>
<Link id="l04072" /><CodeLine lineNumber="4072"><span class="doxyHighlight">      ComputeIP.<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint/#a85b9635b21610f18b51007437bcc26cf">isSet</a>() ? <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a>(ComputeIP, <a href="/docs/api/namespaces/llvm/loc">Loc</a>.DL) : <a href="/docs/api/namespaces/llvm/loc">Loc</a>;</span></CodeLine>
<Link id="l04073" /><CodeLine lineNumber="4073"><span class="doxyHighlight">  updateToLocation(ComputeLoc);</span></CodeLine>
<Link id="l04074" /><CodeLine lineNumber="4074"></CodeLine>
<Link id="l04075" /><CodeLine lineNumber="4075"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Zero = ConstantInt::get(IndVarTy, 0);</span></CodeLine>
<Link id="l04076" /><CodeLine lineNumber="4076"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;One = ConstantInt::get(IndVarTy, 1);</span></CodeLine>
<Link id="l04077" /><CodeLine lineNumber="4077"></CodeLine>
<Link id="l04078" /><CodeLine lineNumber="4078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Like Step, but always positive.</span></CodeLine>
<Link id="l04079" /><CodeLine lineNumber="4079"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Incr = Step;</span></CodeLine>
<Link id="l04080" /><CodeLine lineNumber="4080"></CodeLine>
<Link id="l04081" /><CodeLine lineNumber="4081"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Distance between Start and Stop; always positive.</span></CodeLine>
<Link id="l04082" /><CodeLine lineNumber="4082"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Span;</span></CodeLine>
<Link id="l04083" /><CodeLine lineNumber="4083"></CodeLine>
<Link id="l04084" /><CodeLine lineNumber="4084"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Condition whether there are no iterations are executed at all, e.g. because</span></CodeLine>
<Link id="l04085" /><CodeLine lineNumber="4085"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// UB &lt; LB.</span></CodeLine>
<Link id="l04086" /><CodeLine lineNumber="4086"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ZeroCmp;</span></CodeLine>
<Link id="l04087" /><CodeLine lineNumber="4087"></CodeLine>
<Link id="l04088" /><CodeLine lineNumber="4088"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSigned) &#123;</span></CodeLine>
<Link id="l04089" /><CodeLine lineNumber="4089"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ensure that increment is positive. If not, negate and invert LB and UB.</span></CodeLine>
<Link id="l04090" /><CodeLine lineNumber="4090"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;IsNeg = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac2bfef55549675e0ea117f29cd7309be">CreateICmpSLT</a>(Step, Zero);</span></CodeLine>
<Link id="l04091" /><CodeLine lineNumber="4091"><span class="doxyHighlight">    Incr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(IsNeg, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a7704bf68951054ffeb3efe605750e2d9">CreateNeg</a>(Step), Step);</span></CodeLine>
<Link id="l04092" /><CodeLine lineNumber="4092"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;LB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(IsNeg, Stop, Start);</span></CodeLine>
<Link id="l04093" /><CodeLine lineNumber="4093"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;UB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(IsNeg, Start, Stop);</span></CodeLine>
<Link id="l04094" /><CodeLine lineNumber="4094"><span class="doxyHighlight">    Span = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(UB, LB, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04095" /><CodeLine lineNumber="4095"><span class="doxyHighlight">    ZeroCmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae0bd6c2fab2d18443038a8f3a2b64856">CreateICmp</a>(</span></CodeLine>
<Link id="l04096" /><CodeLine lineNumber="4096"><span class="doxyHighlight">        InclusiveStop ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">CmpInst::ICMP&#95;SLT</a> : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba2751d6136a2819749dcef65dc19a4246">CmpInst::ICMP&#95;SLE</a>, UB, LB);</span></CodeLine>
<Link id="l04097" /><CodeLine lineNumber="4097"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04098" /><CodeLine lineNumber="4098"><span class="doxyHighlight">    Span = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(Stop, Start, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04099" /><CodeLine lineNumber="4099"><span class="doxyHighlight">    ZeroCmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae0bd6c2fab2d18443038a8f3a2b64856">CreateICmp</a>(</span></CodeLine>
<Link id="l04100" /><CodeLine lineNumber="4100"><span class="doxyHighlight">        InclusiveStop ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">CmpInst::ICMP&#95;ULT</a> : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">CmpInst::ICMP&#95;ULE</a>, Stop, Start);</span></CodeLine>
<Link id="l04101" /><CodeLine lineNumber="4101"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04102" /><CodeLine lineNumber="4102"></CodeLine>
<Link id="l04103" /><CodeLine lineNumber="4103"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CountIfLooping;</span></CodeLine>
<Link id="l04104" /><CodeLine lineNumber="4104"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InclusiveStop) &#123;</span></CodeLine>
<Link id="l04105" /><CodeLine lineNumber="4105"><span class="doxyHighlight">    CountIfLooping = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a6b68047eda0d6d6eec5dd564ed1a22b8">CreateUDiv</a>(Span, Incr), One);</span></CodeLine>
<Link id="l04106" /><CodeLine lineNumber="4106"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04107" /><CodeLine lineNumber="4107"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Avoid incrementing past stop since it could overflow.</span></CodeLine>
<Link id="l04108" /><CodeLine lineNumber="4108"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CountIfTwo = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(</span></CodeLine>
<Link id="l04109" /><CodeLine lineNumber="4109"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a6b68047eda0d6d6eec5dd564ed1a22b8">CreateUDiv</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(Span, One), Incr), One);</span></CodeLine>
<Link id="l04110" /><CodeLine lineNumber="4110"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;OneCmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae0bd6c2fab2d18443038a8f3a2b64856">CreateICmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">CmpInst::ICMP&#95;ULE</a>, Span, Incr);</span></CodeLine>
<Link id="l04111" /><CodeLine lineNumber="4111"><span class="doxyHighlight">    CountIfLooping = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(OneCmp, One, CountIfTwo);</span></CodeLine>
<Link id="l04112" /><CodeLine lineNumber="4112"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04113" /><CodeLine lineNumber="4113"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;TripCount = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(ZeroCmp, Zero, CountIfLooping,</span></CodeLine>
<Link id="l04114" /><CodeLine lineNumber="4114"><span class="doxyHighlight">                                          </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;&quot;</span><span class="doxyHighlight"> + Name + </span><span class="doxyHighlightStringLiteral">&quot;.tripcount&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04115" /><CodeLine lineNumber="4115"></CodeLine>
<Link id="l04116" /><CodeLine lineNumber="4116"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BodyGen = &#91;=&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> CodeGenIP, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>) &#123;</span></CodeLine>
<Link id="l04117" /><CodeLine lineNumber="4117"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l04118" /><CodeLine lineNumber="4118"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Span = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aecd40f9a16dc0ef1e0bc416599f89277">CreateMul</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, Step);</span></CodeLine>
<Link id="l04119" /><CodeLine lineNumber="4119"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;IndVar = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(Span, Start);</span></CodeLine>
<Link id="l04120" /><CodeLine lineNumber="4120"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BodyGenCB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), IndVar);</span></CodeLine>
<Link id="l04121" /><CodeLine lineNumber="4121"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l04122" /><CodeLine lineNumber="4122"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> LoopLoc = ComputeIP.<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint/#a85b9635b21610f18b51007437bcc26cf">isSet</a>() ? <a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP : Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l04123" /><CodeLine lineNumber="4123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#ae0287686a5ffe03bc264972c862726ea">createCanonicalLoop</a>(LoopLoc, BodyGen, TripCount, Name);</span></CodeLine>
<Link id="l04124" /><CodeLine lineNumber="4124"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04125" /><CodeLine lineNumber="4125"></CodeLine>
<Link id="l04126" /><CodeLine lineNumber="4126"><span class="doxyHighlightComment">// Returns an LLVM function to call for initializing loop bounds using OpenMP</span></CodeLine>
<Link id="l04127" /><CodeLine lineNumber="4127"><span class="doxyHighlightComment">// static scheduling depending on &#96;type&#96;. Only i32 and i64 are supported by the</span></CodeLine>
<Link id="l04128" /><CodeLine lineNumber="4128"><span class="doxyHighlightComment">// runtime. Always interpret integers as unsigned similarly to</span></CodeLine>
<Link id="l04129" /><CodeLine lineNumber="4129"><span class="doxyHighlightComment">// CanonicalLoopInfo.</span></CodeLine>
<Link id="l04130" /><CodeLine lineNumber="4130" lineLink="#ac04904b32ea7f45e108b8752b1a940e7"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a> <a href="#ac04904b32ea7f45e108b8752b1a940e7">getKmpcForStaticInitForType</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/classes/llvm/module">Module</a> &amp;M,</span></CodeLine>
<Link id="l04131" /><CodeLine lineNumber="4131"><span class="doxyHighlight">                                                  <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp;OMPBuilder) &#123;</span></CodeLine>
<Link id="l04132" /><CodeLine lineNumber="4132"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Bitwidth = Ty-&gt;getIntegerBitWidth();</span></CodeLine>
<Link id="l04133" /><CodeLine lineNumber="4133"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 32)</span></CodeLine>
<Link id="l04134" /><CodeLine lineNumber="4134"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04135" /><CodeLine lineNumber="4135"><span class="doxyHighlight">        M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;for&#95;static&#95;init&#95;4u);</span></CodeLine>
<Link id="l04136" /><CodeLine lineNumber="4136"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 64)</span></CodeLine>
<Link id="l04137" /><CodeLine lineNumber="4137"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04138" /><CodeLine lineNumber="4138"><span class="doxyHighlight">        M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;for&#95;static&#95;init&#95;8u);</span></CodeLine>
<Link id="l04139" /><CodeLine lineNumber="4139"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;unknown OpenMP loop iterator bitwidth&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04140" /><CodeLine lineNumber="4140"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04141" /><CodeLine lineNumber="4141"></CodeLine>
<Link id="l04142" /><CodeLine lineNumber="4142"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a></span></CodeLine>
<Link id="l04143" /><CodeLine lineNumber="4143"><span class="doxyHighlight">OpenMPIRBuilder::applyStaticWorkshareLoop(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;CLI,</span></CodeLine>
<Link id="l04144" /><CodeLine lineNumber="4144"><span class="doxyHighlight">                                          InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l04145" /><CodeLine lineNumber="4145"><span class="doxyHighlight">                                          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsBarrier) &#123;</span></CodeLine>
<Link id="l04146" /><CodeLine lineNumber="4146"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a4b2b7074e300c251f7cb8913620b1d80">isValid</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Requires a valid canonical loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04147" /><CodeLine lineNumber="4147"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="#a756b28f370cd5a39bc0ee3e5333b9c9b">isConflictIP</a>(AllocaIP, CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac72ebc430ef7dcf1791c66080ddedd9d">getPreheaderIP</a>()) &amp;&amp;</span></CodeLine>
<Link id="l04148" /><CodeLine lineNumber="4148"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Require dedicated allocate IP&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04149" /><CodeLine lineNumber="4149"></CodeLine>
<Link id="l04150" /><CodeLine lineNumber="4150"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set up the source location value for OpenMP runtime.</span></CodeLine>
<Link id="l04151" /><CodeLine lineNumber="4151"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac72ebc430ef7dcf1791c66080ddedd9d">getPreheaderIP</a>());</span></CodeLine>
<Link id="l04152" /><CodeLine lineNumber="4152"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04153" /><CodeLine lineNumber="4153"></CodeLine>
<Link id="l04154" /><CodeLine lineNumber="4154"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l04155" /><CodeLine lineNumber="4155"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SrcLocStrSize);</span></CodeLine>
<Link id="l04156" /><CodeLine lineNumber="4156"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcLoc = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l04157" /><CodeLine lineNumber="4157"></CodeLine>
<Link id="l04158" /><CodeLine lineNumber="4158"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Declare useful OpenMP runtime functions.</span></CodeLine>
<Link id="l04159" /><CodeLine lineNumber="4159"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#af4131f5f461f1138483addfd7cd7f579">getIndVar</a>();</span></CodeLine>
<Link id="l04160" /><CodeLine lineNumber="4160"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IVTy = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getType();</span></CodeLine>
<Link id="l04161" /><CodeLine lineNumber="4161"><span class="doxyHighlight">  FunctionCallee StaticInit = <a href="#ac04904b32ea7f45e108b8752b1a940e7">getKmpcForStaticInitForType</a>(IVTy, M, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04162" /><CodeLine lineNumber="4162"><span class="doxyHighlight">  FunctionCallee StaticFini =</span></CodeLine>
<Link id="l04163" /><CodeLine lineNumber="4163"><span class="doxyHighlight">      getOrCreateRuntimeFunction(M, omp::OMPRTL&#95;&#95;&#95;kmpc&#95;for&#95;static&#95;fini);</span></CodeLine>
<Link id="l04164" /><CodeLine lineNumber="4164"></CodeLine>
<Link id="l04165" /><CodeLine lineNumber="4165"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Allocate space for computed loop bounds as expected by the &quot;init&quot; function.</span></CodeLine>
<Link id="l04166" /><CodeLine lineNumber="4166"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(AllocaIP.getBlock()-&gt;getFirstNonPHIOrDbgOrAlloca());</span></CodeLine>
<Link id="l04167" /><CodeLine lineNumber="4167"></CodeLine>
<Link id="l04168" /><CodeLine lineNumber="4168"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;I32Type = <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext());</span></CodeLine>
<Link id="l04169" /><CodeLine lineNumber="4169"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PLastIter = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(I32Type, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;p.lastiter&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04170" /><CodeLine lineNumber="4170"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PLowerBound = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(IVTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;p.lowerbound&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04171" /><CodeLine lineNumber="4171"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PUpperBound = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(IVTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;p.upperbound&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04172" /><CodeLine lineNumber="4172"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PStride = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(IVTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;p.stride&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04173" /><CodeLine lineNumber="4173"></CodeLine>
<Link id="l04174" /><CodeLine lineNumber="4174"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At the end of the preheader, prepare for calling the &quot;init&quot; function by</span></CodeLine>
<Link id="l04175" /><CodeLine lineNumber="4175"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// storing the current loop bounds into the allocated space. A canonical loop</span></CodeLine>
<Link id="l04176" /><CodeLine lineNumber="4176"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// always iterates from 0 to trip-count with step 1 Note that &quot;init&quot; expects</span></CodeLine>
<Link id="l04177" /><CodeLine lineNumber="4177"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and produces an inclusive upper bound.</span></CodeLine>
<Link id="l04178" /><CodeLine lineNumber="4178"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l04179" /><CodeLine lineNumber="4179"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefad7ed4ee1df437474d005188535f74875">Zero</a> = ConstantInt::get(IVTy, 0);</span></CodeLine>
<Link id="l04180" /><CodeLine lineNumber="4180"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;One = ConstantInt::get(IVTy, 1);</span></CodeLine>
<Link id="l04181" /><CodeLine lineNumber="4181"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Zero, PLowerBound);</span></CodeLine>
<Link id="l04182" /><CodeLine lineNumber="4182"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;UpperBound = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a01560f4a4ff7bfc8a96bd406b6f17ea2">getTripCount</a>(), One);</span></CodeLine>
<Link id="l04183" /><CodeLine lineNumber="4183"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(UpperBound, PUpperBound);</span></CodeLine>
<Link id="l04184" /><CodeLine lineNumber="4184"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(One, PStride);</span></CodeLine>
<Link id="l04185" /><CodeLine lineNumber="4185"></CodeLine>
<Link id="l04186" /><CodeLine lineNumber="4186"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadNum = getOrCreateThreadID(SrcLoc);</span></CodeLine>
<Link id="l04187" /><CodeLine lineNumber="4187"></CodeLine>
<Link id="l04188" /><CodeLine lineNumber="4188"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SchedulingType = ConstantInt::get(</span></CodeLine>
<Link id="l04189" /><CodeLine lineNumber="4189"><span class="doxyHighlight">      I32Type, </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(OMPScheduleType::UnorderedStatic));</span></CodeLine>
<Link id="l04190" /><CodeLine lineNumber="4190"></CodeLine>
<Link id="l04191" /><CodeLine lineNumber="4191"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Call the &quot;init&quot; function and update the trip count of the loop with the</span></CodeLine>
<Link id="l04192" /><CodeLine lineNumber="4192"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// value it produced.</span></CodeLine>
<Link id="l04193" /><CodeLine lineNumber="4193"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(StaticInit,</span></CodeLine>
<Link id="l04194" /><CodeLine lineNumber="4194"><span class="doxyHighlight">                     &#123;SrcLoc, ThreadNum, SchedulingType, PLastIter, PLowerBound,</span></CodeLine>
<Link id="l04195" /><CodeLine lineNumber="4195"><span class="doxyHighlight">                      PUpperBound, PStride, One, <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefad7ed4ee1df437474d005188535f74875">Zero</a>&#125;);</span></CodeLine>
<Link id="l04196" /><CodeLine lineNumber="4196"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LowerBound = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(IVTy, PLowerBound);</span></CodeLine>
<Link id="l04197" /><CodeLine lineNumber="4197"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;InclusiveUpperBound = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(IVTy, PUpperBound);</span></CodeLine>
<Link id="l04198" /><CodeLine lineNumber="4198"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TripCountMinusOne = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(InclusiveUpperBound, LowerBound);</span></CodeLine>
<Link id="l04199" /><CodeLine lineNumber="4199"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TripCount = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(TripCountMinusOne, One);</span></CodeLine>
<Link id="l04200" /><CodeLine lineNumber="4200"><span class="doxyHighlight">  CLI-&gt;setTripCount(TripCount);</span></CodeLine>
<Link id="l04201" /><CodeLine lineNumber="4201"></CodeLine>
<Link id="l04202" /><CodeLine lineNumber="4202"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update all uses of the induction variable except the one in the condition</span></CodeLine>
<Link id="l04203" /><CodeLine lineNumber="4203"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block that compares it with the actual upper bound, and the increment in</span></CodeLine>
<Link id="l04204" /><CodeLine lineNumber="4204"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the latch block.</span></CodeLine>
<Link id="l04205" /><CodeLine lineNumber="4205"></CodeLine>
<Link id="l04206" /><CodeLine lineNumber="4206"><span class="doxyHighlight">  CLI-&gt;mapIndVar(&#91;&amp;&#93;(Instruction &#42;OldIV) -&gt; <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42; &#123;</span></CodeLine>
<Link id="l04207" /><CodeLine lineNumber="4207"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>(),</span></CodeLine>
<Link id="l04208" /><CodeLine lineNumber="4208"><span class="doxyHighlight">                           CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l04209" /><CodeLine lineNumber="4209"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04210" /><CodeLine lineNumber="4210"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(OldIV, LowerBound);</span></CodeLine>
<Link id="l04211" /><CodeLine lineNumber="4211"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l04212" /><CodeLine lineNumber="4212"></CodeLine>
<Link id="l04213" /><CodeLine lineNumber="4213"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In the &quot;exit&quot; block, call the &quot;fini&quot; function.</span></CodeLine>
<Link id="l04214" /><CodeLine lineNumber="4214"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad3bf46daef8ce8176a68bcec0320dfd3">getExit</a>(),</span></CodeLine>
<Link id="l04215" /><CodeLine lineNumber="4215"><span class="doxyHighlight">                         CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad3bf46daef8ce8176a68bcec0320dfd3">getExit</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l04216" /><CodeLine lineNumber="4216"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(StaticFini, &#123;SrcLoc, ThreadNum&#125;);</span></CodeLine>
<Link id="l04217" /><CodeLine lineNumber="4217"></CodeLine>
<Link id="l04218" /><CodeLine lineNumber="4218"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add the barrier if requested.</span></CodeLine>
<Link id="l04219" /><CodeLine lineNumber="4219"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsBarrier) &#123;</span></CodeLine>
<Link id="l04220" /><CodeLine lineNumber="4220"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> BarrierIP =</span></CodeLine>
<Link id="l04221" /><CodeLine lineNumber="4221"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/openmpirbuilder/#abca6530c9099bd1b1c3e0a5c32381f07">createBarrier</a>(<a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>),</span></CodeLine>
<Link id="l04222" /><CodeLine lineNumber="4222"><span class="doxyHighlight">                      omp::Directive::OMPD&#95;for, </span><span class="doxyHighlightComment">/&#42; ForceSimpleCall &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04223" /><CodeLine lineNumber="4223"><span class="doxyHighlight">                      </span><span class="doxyHighlightComment">/&#42; CheckCancelFlag &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04224" /><CodeLine lineNumber="4224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BarrierIP)</span></CodeLine>
<Link id="l04225" /><CodeLine lineNumber="4225"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BarrierIP.takeError();</span></CodeLine>
<Link id="l04226" /><CodeLine lineNumber="4226"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04227" /><CodeLine lineNumber="4227"></CodeLine>
<Link id="l04228" /><CodeLine lineNumber="4228"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AfterIP = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a578dd7d619d0ccfc6ace07aa380022cc">getAfterIP</a>();</span></CodeLine>
<Link id="l04229" /><CodeLine lineNumber="4229"><span class="doxyHighlight">  CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a9ce55b05f8ad85126fc92eeeb35457c7">invalidate</a>();</span></CodeLine>
<Link id="l04230" /><CodeLine lineNumber="4230"></CodeLine>
<Link id="l04231" /><CodeLine lineNumber="4231"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP;</span></CodeLine>
<Link id="l04232" /><CodeLine lineNumber="4232"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04233" /><CodeLine lineNumber="4233"></CodeLine>
<Link id="l04234" /><CodeLine lineNumber="4234"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a></span></CodeLine>
<Link id="l04235" /><CodeLine lineNumber="4235"><span class="doxyHighlight">OpenMPIRBuilder::applyStaticChunkedWorkshareLoop(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l04236" /><CodeLine lineNumber="4236"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;CLI,</span></CodeLine>
<Link id="l04237" /><CodeLine lineNumber="4237"><span class="doxyHighlight">                                                 InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l04238" /><CodeLine lineNumber="4238"><span class="doxyHighlight">                                                 </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsBarrier,</span></CodeLine>
<Link id="l04239" /><CodeLine lineNumber="4239"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/value">Value</a> &#42;ChunkSize) &#123;</span></CodeLine>
<Link id="l04240" /><CodeLine lineNumber="4240"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a4b2b7074e300c251f7cb8913620b1d80">isValid</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Requires a valid canonical loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04241" /><CodeLine lineNumber="4241"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ChunkSize &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Chunk size is required&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04242" /><CodeLine lineNumber="4242"></CodeLine>
<Link id="l04243" /><CodeLine lineNumber="4243"><span class="doxyHighlight">  LLVMContext &amp;Ctx = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a9592feb460b27d417f42a41aabfe253a">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>();</span></CodeLine>
<Link id="l04244" /><CodeLine lineNumber="4244"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#af4131f5f461f1138483addfd7cd7f579">getIndVar</a>();</span></CodeLine>
<Link id="l04245" /><CodeLine lineNumber="4245"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OrigTripCount = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a01560f4a4ff7bfc8a96bd406b6f17ea2">getTripCount</a>();</span></CodeLine>
<Link id="l04246" /><CodeLine lineNumber="4246"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IVTy = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getType();</span></CodeLine>
<Link id="l04247" /><CodeLine lineNumber="4247"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IVTy-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &lt;= 64 &amp;&amp;</span></CodeLine>
<Link id="l04248" /><CodeLine lineNumber="4248"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Max supported tripcount bitwidth is 64 bits&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04249" /><CodeLine lineNumber="4249"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;InternalIVTy = IVTy-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &lt;= 32 ? <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx)</span></CodeLine>
<Link id="l04250" /><CodeLine lineNumber="4250"><span class="doxyHighlight">                                                        : <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a>::getInt64Ty(Ctx);</span></CodeLine>
<Link id="l04251" /><CodeLine lineNumber="4251"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;I32Type = <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext());</span></CodeLine>
<Link id="l04252" /><CodeLine lineNumber="4252"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefad7ed4ee1df437474d005188535f74875">Zero</a> = ConstantInt::get(InternalIVTy, 0);</span></CodeLine>
<Link id="l04253" /><CodeLine lineNumber="4253"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;One = ConstantInt::get(InternalIVTy, 1);</span></CodeLine>
<Link id="l04254" /><CodeLine lineNumber="4254"></CodeLine>
<Link id="l04255" /><CodeLine lineNumber="4255"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Declare useful OpenMP runtime functions.</span></CodeLine>
<Link id="l04256" /><CodeLine lineNumber="4256"><span class="doxyHighlight">  FunctionCallee StaticInit =</span></CodeLine>
<Link id="l04257" /><CodeLine lineNumber="4257"><span class="doxyHighlight">      <a href="#ac04904b32ea7f45e108b8752b1a940e7">getKmpcForStaticInitForType</a>(InternalIVTy, M, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04258" /><CodeLine lineNumber="4258"><span class="doxyHighlight">  FunctionCallee StaticFini =</span></CodeLine>
<Link id="l04259" /><CodeLine lineNumber="4259"><span class="doxyHighlight">      getOrCreateRuntimeFunction(M, omp::OMPRTL&#95;&#95;&#95;kmpc&#95;for&#95;static&#95;fini);</span></CodeLine>
<Link id="l04260" /><CodeLine lineNumber="4260"></CodeLine>
<Link id="l04261" /><CodeLine lineNumber="4261"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Allocate space for computed loop bounds as expected by the &quot;init&quot; function.</span></CodeLine>
<Link id="l04262" /><CodeLine lineNumber="4262"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l04263" /><CodeLine lineNumber="4263"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04264" /><CodeLine lineNumber="4264"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PLastIter = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(I32Type, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;p.lastiter&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04265" /><CodeLine lineNumber="4265"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PLowerBound =</span></CodeLine>
<Link id="l04266" /><CodeLine lineNumber="4266"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(InternalIVTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;p.lowerbound&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04267" /><CodeLine lineNumber="4267"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PUpperBound =</span></CodeLine>
<Link id="l04268" /><CodeLine lineNumber="4268"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(InternalIVTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;p.upperbound&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04269" /><CodeLine lineNumber="4269"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PStride = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(InternalIVTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;p.stride&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04270" /><CodeLine lineNumber="4270"></CodeLine>
<Link id="l04271" /><CodeLine lineNumber="4271"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set up the source location value for the OpenMP runtime.</span></CodeLine>
<Link id="l04272" /><CodeLine lineNumber="4272"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac72ebc430ef7dcf1791c66080ddedd9d">getPreheaderIP</a>());</span></CodeLine>
<Link id="l04273" /><CodeLine lineNumber="4273"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04274" /><CodeLine lineNumber="4274"></CodeLine>
<Link id="l04275" /><CodeLine lineNumber="4275"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Detect overflow in ubsan or max-out with current tripcount.</span></CodeLine>
<Link id="l04276" /><CodeLine lineNumber="4276"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CastedChunkSize =</span></CodeLine>
<Link id="l04277" /><CodeLine lineNumber="4277"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a36742c35a8fff5f74bb3d76c9c19dd47">CreateZExtOrTrunc</a>(ChunkSize, InternalIVTy, </span><span class="doxyHighlightStringLiteral">&quot;chunksize&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04278" /><CodeLine lineNumber="4278"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CastedTripCount =</span></CodeLine>
<Link id="l04279" /><CodeLine lineNumber="4279"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9e6950f7f17700d5c0d61ad0b846ec5c">CreateZExt</a>(OrigTripCount, InternalIVTy, </span><span class="doxyHighlightStringLiteral">&quot;tripcount&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04280" /><CodeLine lineNumber="4280"></CodeLine>
<Link id="l04281" /><CodeLine lineNumber="4281"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SchedulingType = ConstantInt::get(</span></CodeLine>
<Link id="l04282" /><CodeLine lineNumber="4282"><span class="doxyHighlight">      I32Type, </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(OMPScheduleType::UnorderedStaticChunked));</span></CodeLine>
<Link id="l04283" /><CodeLine lineNumber="4283"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Zero, PLowerBound);</span></CodeLine>
<Link id="l04284" /><CodeLine lineNumber="4284"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OrigUpperBound = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(CastedTripCount, One);</span></CodeLine>
<Link id="l04285" /><CodeLine lineNumber="4285"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(OrigUpperBound, PUpperBound);</span></CodeLine>
<Link id="l04286" /><CodeLine lineNumber="4286"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(One, PStride);</span></CodeLine>
<Link id="l04287" /><CodeLine lineNumber="4287"></CodeLine>
<Link id="l04288" /><CodeLine lineNumber="4288"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Call the &quot;init&quot; function and update the trip count of the loop with the</span></CodeLine>
<Link id="l04289" /><CodeLine lineNumber="4289"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// value it produced.</span></CodeLine>
<Link id="l04290" /><CodeLine lineNumber="4290"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l04291" /><CodeLine lineNumber="4291"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SrcLocStrSize);</span></CodeLine>
<Link id="l04292" /><CodeLine lineNumber="4292"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcLoc = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l04293" /><CodeLine lineNumber="4293"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadNum = getOrCreateThreadID(SrcLoc);</span></CodeLine>
<Link id="l04294" /><CodeLine lineNumber="4294"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(StaticInit,</span></CodeLine>
<Link id="l04295" /><CodeLine lineNumber="4295"><span class="doxyHighlight">                     &#123;</span><span class="doxyHighlightComment">/&#42;loc=&#42;/</span><span class="doxyHighlight">SrcLoc, </span><span class="doxyHighlightComment">/&#42;global&#95;tid=&#42;/</span><span class="doxyHighlight">ThreadNum,</span></CodeLine>
<Link id="l04296" /><CodeLine lineNumber="4296"><span class="doxyHighlight">                      </span><span class="doxyHighlightComment">/&#42;schedtype=&#42;/</span><span class="doxyHighlight">SchedulingType, </span><span class="doxyHighlightComment">/&#42;plastiter=&#42;/</span><span class="doxyHighlight">PLastIter,</span></CodeLine>
<Link id="l04297" /><CodeLine lineNumber="4297"><span class="doxyHighlight">                      </span><span class="doxyHighlightComment">/&#42;plower=&#42;/</span><span class="doxyHighlight">PLowerBound, </span><span class="doxyHighlightComment">/&#42;pupper=&#42;/</span><span class="doxyHighlight">PUpperBound,</span></CodeLine>
<Link id="l04298" /><CodeLine lineNumber="4298"><span class="doxyHighlight">                      </span><span class="doxyHighlightComment">/&#42;pstride=&#42;/</span><span class="doxyHighlight">PStride, </span><span class="doxyHighlightComment">/&#42;incr=&#42;/</span><span class="doxyHighlight">One,</span></CodeLine>
<Link id="l04299" /><CodeLine lineNumber="4299"><span class="doxyHighlight">                      </span><span class="doxyHighlightComment">/&#42;chunk=&#42;/</span><span class="doxyHighlight">CastedChunkSize&#125;);</span></CodeLine>
<Link id="l04300" /><CodeLine lineNumber="4300"></CodeLine>
<Link id="l04301" /><CodeLine lineNumber="4301"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Load values written by the &quot;init&quot; function.</span></CodeLine>
<Link id="l04302" /><CodeLine lineNumber="4302"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;FirstChunkStart =</span></CodeLine>
<Link id="l04303" /><CodeLine lineNumber="4303"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(InternalIVTy, PLowerBound, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;firstchunk.lb&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04304" /><CodeLine lineNumber="4304"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;FirstChunkStop =</span></CodeLine>
<Link id="l04305" /><CodeLine lineNumber="4305"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(InternalIVTy, PUpperBound, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;firstchunk.ub&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04306" /><CodeLine lineNumber="4306"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;FirstChunkEnd = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(FirstChunkStop, One);</span></CodeLine>
<Link id="l04307" /><CodeLine lineNumber="4307"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ChunkRange =</span></CodeLine>
<Link id="l04308" /><CodeLine lineNumber="4308"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(FirstChunkEnd, FirstChunkStart, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;chunk.range&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04309" /><CodeLine lineNumber="4309"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NextChunkStride =</span></CodeLine>
<Link id="l04310" /><CodeLine lineNumber="4310"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(InternalIVTy, PStride, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;dispatch.stride&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04311" /><CodeLine lineNumber="4311"></CodeLine>
<Link id="l04312" /><CodeLine lineNumber="4312"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create outer &quot;dispatch&quot; loop for enumerating the chunks.</span></CodeLine>
<Link id="l04313" /><CodeLine lineNumber="4313"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;DispatchEnter = <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04314" /><CodeLine lineNumber="4314"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DispatchCounter;</span></CodeLine>
<Link id="l04315" /><CodeLine lineNumber="4315"></CodeLine>
<Link id="l04316" /><CodeLine lineNumber="4316"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is safe to assume this didn&#39;t return an error because the callback</span></CodeLine>
<Link id="l04317" /><CodeLine lineNumber="4317"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// passed into createCanonicalLoop is the only possible error source, and it</span></CodeLine>
<Link id="l04318" /><CodeLine lineNumber="4318"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// always returns success.</span></CodeLine>
<Link id="l04319" /><CodeLine lineNumber="4319"><span class="doxyHighlight">  CanonicalLoopInfo &#42;DispatchCLI = <a href="/docs/api/namespaces/llvm/#aa1e1474f15df639f0d874b21f15666f7">cantFail</a>(<a href="/docs/api/classes/llvm/openmpirbuilder/#ae0287686a5ffe03bc264972c862726ea">createCanonicalLoop</a>(</span></CodeLine>
<Link id="l04320" /><CodeLine lineNumber="4320"><span class="doxyHighlight">      &#123;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>&#125;,</span></CodeLine>
<Link id="l04321" /><CodeLine lineNumber="4321"><span class="doxyHighlight">      &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> BodyIP, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Counter) &#123;</span></CodeLine>
<Link id="l04322" /><CodeLine lineNumber="4322"><span class="doxyHighlight">        DispatchCounter = Counter;</span></CodeLine>
<Link id="l04323" /><CodeLine lineNumber="4323"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l04324" /><CodeLine lineNumber="4324"><span class="doxyHighlight">      &#125;,</span></CodeLine>
<Link id="l04325" /><CodeLine lineNumber="4325"><span class="doxyHighlight">      FirstChunkStart, CastedTripCount, NextChunkStride,</span></CodeLine>
<Link id="l04326" /><CodeLine lineNumber="4326"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;IsSigned=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;InclusiveStop=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;ComputeIP=&#42;/</span><span class="doxyHighlight">&#123;&#125;,</span></CodeLine>
<Link id="l04327" /><CodeLine lineNumber="4327"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;dispatch&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l04328" /><CodeLine lineNumber="4328"></CodeLine>
<Link id="l04329" /><CodeLine lineNumber="4329"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remember the BasicBlocks of the dispatch loop we need, then invalidate to</span></CodeLine>
<Link id="l04330" /><CodeLine lineNumber="4330"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// not have to preserve the canonical invariant.</span></CodeLine>
<Link id="l04331" /><CodeLine lineNumber="4331"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;DispatchBody = DispatchCLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>();</span></CodeLine>
<Link id="l04332" /><CodeLine lineNumber="4332"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;DispatchLatch = DispatchCLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac37a6cf77f6f82b6bb28af4d9c8626d0">getLatch</a>();</span></CodeLine>
<Link id="l04333" /><CodeLine lineNumber="4333"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;DispatchExit = DispatchCLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad3bf46daef8ce8176a68bcec0320dfd3">getExit</a>();</span></CodeLine>
<Link id="l04334" /><CodeLine lineNumber="4334"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;DispatchAfter = DispatchCLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a92d8bce979891dc43b6573e8cca2e58c">getAfter</a>();</span></CodeLine>
<Link id="l04335" /><CodeLine lineNumber="4335"><span class="doxyHighlight">  DispatchCLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a9ce55b05f8ad85126fc92eeeb35457c7">invalidate</a>();</span></CodeLine>
<Link id="l04336" /><CodeLine lineNumber="4336"></CodeLine>
<Link id="l04337" /><CodeLine lineNumber="4337"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Rewire the original loop to become the chunk loop inside the dispatch loop.</span></CodeLine>
<Link id="l04338" /><CodeLine lineNumber="4338"><span class="doxyHighlight">  <a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a>(DispatchAfter, CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a92d8bce979891dc43b6573e8cca2e58c">getAfter</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04339" /><CodeLine lineNumber="4339"><span class="doxyHighlight">  <a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad3bf46daef8ce8176a68bcec0320dfd3">getExit</a>(), DispatchLatch, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04340" /><CodeLine lineNumber="4340"><span class="doxyHighlight">  <a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a>(DispatchBody, DispatchEnter, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04341" /><CodeLine lineNumber="4341"></CodeLine>
<Link id="l04342" /><CodeLine lineNumber="4342"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Prepare the prolog of the chunk loop.</span></CodeLine>
<Link id="l04343" /><CodeLine lineNumber="4343"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac72ebc430ef7dcf1791c66080ddedd9d">getPreheaderIP</a>());</span></CodeLine>
<Link id="l04344" /><CodeLine lineNumber="4344"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04345" /><CodeLine lineNumber="4345"></CodeLine>
<Link id="l04346" /><CodeLine lineNumber="4346"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute the number of iterations of the chunk loop.</span></CodeLine>
<Link id="l04347" /><CodeLine lineNumber="4347"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l04348" /><CodeLine lineNumber="4348"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ChunkEnd = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(DispatchCounter, ChunkRange);</span></CodeLine>
<Link id="l04349" /><CodeLine lineNumber="4349"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IsLastChunk =</span></CodeLine>
<Link id="l04350" /><CodeLine lineNumber="4350"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac613fa8e66fca464885c3f274fbeb834">CreateICmpUGE</a>(ChunkEnd, CastedTripCount, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;chunk.is&#95;last&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04351" /><CodeLine lineNumber="4351"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CountUntilOrigTripCount =</span></CodeLine>
<Link id="l04352" /><CodeLine lineNumber="4352"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(CastedTripCount, DispatchCounter);</span></CodeLine>
<Link id="l04353" /><CodeLine lineNumber="4353"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ChunkTripCount = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(</span></CodeLine>
<Link id="l04354" /><CodeLine lineNumber="4354"><span class="doxyHighlight">      IsLastChunk, CountUntilOrigTripCount, ChunkRange, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;chunk.tripcount&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04355" /><CodeLine lineNumber="4355"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BackcastedChunkTC =</span></CodeLine>
<Link id="l04356" /><CodeLine lineNumber="4356"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(ChunkTripCount, IVTy, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;chunk.tripcount.trunc&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04357" /><CodeLine lineNumber="4357"><span class="doxyHighlight">  CLI-&gt;setTripCount(BackcastedChunkTC);</span></CodeLine>
<Link id="l04358" /><CodeLine lineNumber="4358"></CodeLine>
<Link id="l04359" /><CodeLine lineNumber="4359"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update all uses of the induction variable except the one in the condition</span></CodeLine>
<Link id="l04360" /><CodeLine lineNumber="4360"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block that compares it with the actual upper bound, and the increment in</span></CodeLine>
<Link id="l04361" /><CodeLine lineNumber="4361"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the latch block.</span></CodeLine>
<Link id="l04362" /><CodeLine lineNumber="4362"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BackcastedDispatchCounter =</span></CodeLine>
<Link id="l04363" /><CodeLine lineNumber="4363"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(DispatchCounter, IVTy, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;dispatch.iv.trunc&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04364" /><CodeLine lineNumber="4364"><span class="doxyHighlight">  CLI-&gt;mapIndVar(&#91;&amp;&#93;(Instruction &#42;) -&gt; <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42; &#123;</span></CodeLine>
<Link id="l04365" /><CodeLine lineNumber="4365"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a8031442528bff99473596a0de4aa0422">getBodyIP</a>());</span></CodeLine>
<Link id="l04366" /><CodeLine lineNumber="4366"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, BackcastedDispatchCounter);</span></CodeLine>
<Link id="l04367" /><CodeLine lineNumber="4367"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l04368" /><CodeLine lineNumber="4368"></CodeLine>
<Link id="l04369" /><CodeLine lineNumber="4369"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In the &quot;exit&quot; block, call the &quot;fini&quot; function.</span></CodeLine>
<Link id="l04370" /><CodeLine lineNumber="4370"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(DispatchExit, DispatchExit-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l04371" /><CodeLine lineNumber="4371"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(StaticFini, &#123;SrcLoc, ThreadNum&#125;);</span></CodeLine>
<Link id="l04372" /><CodeLine lineNumber="4372"></CodeLine>
<Link id="l04373" /><CodeLine lineNumber="4373"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add the barrier if requested.</span></CodeLine>
<Link id="l04374" /><CodeLine lineNumber="4374"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsBarrier) &#123;</span></CodeLine>
<Link id="l04375" /><CodeLine lineNumber="4375"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l04376" /><CodeLine lineNumber="4376"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/openmpirbuilder/#abca6530c9099bd1b1c3e0a5c32381f07">createBarrier</a>(<a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>), OMPD&#95;for,</span></CodeLine>
<Link id="l04377" /><CodeLine lineNumber="4377"><span class="doxyHighlight">                      </span><span class="doxyHighlightComment">/&#42;ForceSimpleCall=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;CheckCancelFlag=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04378" /><CodeLine lineNumber="4378"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l04379" /><CodeLine lineNumber="4379"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l04380" /><CodeLine lineNumber="4380"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04381" /><CodeLine lineNumber="4381"></CodeLine>
<Link id="l04382" /><CodeLine lineNumber="4382"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l04383" /><CodeLine lineNumber="4383"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Even though we currently do not support applying additional methods to it,</span></CodeLine>
<Link id="l04384" /><CodeLine lineNumber="4384"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the chunk loop should remain a canonical loop.</span></CodeLine>
<Link id="l04385" /><CodeLine lineNumber="4385"><span class="doxyHighlight">  CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a32ff799dcb39887a8d21322020f305ba">assertOK</a>();</span></CodeLine>
<Link id="l04386" /><CodeLine lineNumber="4386"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l04387" /><CodeLine lineNumber="4387"></CodeLine>
<Link id="l04388" /><CodeLine lineNumber="4388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>(DispatchAfter, DispatchAfter-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l04389" /><CodeLine lineNumber="4389"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04390" /><CodeLine lineNumber="4390"></CodeLine>
<Link id="l04391" /><CodeLine lineNumber="4391"><span class="doxyHighlightComment">// Returns an LLVM function to call for executing an OpenMP static worksharing</span></CodeLine>
<Link id="l04392" /><CodeLine lineNumber="4392"><span class="doxyHighlightComment">// for loop depending on &#96;type&#96;. Only i32 and i64 are supported by the runtime.</span></CodeLine>
<Link id="l04393" /><CodeLine lineNumber="4393"><span class="doxyHighlightComment">// Always interpret integers as unsigned similarly to CanonicalLoopInfo.</span></CodeLine>
<Link id="l04394" /><CodeLine lineNumber="4394"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a></span></CodeLine>
<Link id="l04395" /><CodeLine lineNumber="4395" lineLink="#aca27639a720491c7c7ea13c2bbe8c162"><span class="doxyHighlight"><a href="#aca27639a720491c7c7ea13c2bbe8c162">getKmpcForStaticLoopForType</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &#42;OMPBuilder,</span></CodeLine>
<Link id="l04396" /><CodeLine lineNumber="4396"><span class="doxyHighlight">                            <a href="/docs/api/namespaces/llvm/omp/#ab6fb146c332fd3f3d677ee65081fe669">WorksharingLoopType</a> LoopType) &#123;</span></CodeLine>
<Link id="l04397" /><CodeLine lineNumber="4397"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Bitwidth = Ty-&gt;getIntegerBitWidth();</span></CodeLine>
<Link id="l04398" /><CodeLine lineNumber="4398"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/module">Module</a> &amp;M = OMPBuilder-&gt;M;</span></CodeLine>
<Link id="l04399" /><CodeLine lineNumber="4399"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (LoopType) &#123;</span></CodeLine>
<Link id="l04400" /><CodeLine lineNumber="4400"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> WorksharingLoopType::ForStaticLoop:</span></CodeLine>
<Link id="l04401" /><CodeLine lineNumber="4401"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 32)</span></CodeLine>
<Link id="l04402" /><CodeLine lineNumber="4402"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder-&gt;getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04403" /><CodeLine lineNumber="4403"><span class="doxyHighlight">          M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;for&#95;static&#95;loop&#95;4u);</span></CodeLine>
<Link id="l04404" /><CodeLine lineNumber="4404"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 64)</span></CodeLine>
<Link id="l04405" /><CodeLine lineNumber="4405"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder-&gt;getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04406" /><CodeLine lineNumber="4406"><span class="doxyHighlight">          M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;for&#95;static&#95;loop&#95;8u);</span></CodeLine>
<Link id="l04407" /><CodeLine lineNumber="4407"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04408" /><CodeLine lineNumber="4408"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> WorksharingLoopType::DistributeStaticLoop:</span></CodeLine>
<Link id="l04409" /><CodeLine lineNumber="4409"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 32)</span></CodeLine>
<Link id="l04410" /><CodeLine lineNumber="4410"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder-&gt;getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04411" /><CodeLine lineNumber="4411"><span class="doxyHighlight">          M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;distribute&#95;static&#95;loop&#95;4u);</span></CodeLine>
<Link id="l04412" /><CodeLine lineNumber="4412"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 64)</span></CodeLine>
<Link id="l04413" /><CodeLine lineNumber="4413"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder-&gt;getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04414" /><CodeLine lineNumber="4414"><span class="doxyHighlight">          M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;distribute&#95;static&#95;loop&#95;8u);</span></CodeLine>
<Link id="l04415" /><CodeLine lineNumber="4415"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04416" /><CodeLine lineNumber="4416"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> WorksharingLoopType::DistributeForStaticLoop:</span></CodeLine>
<Link id="l04417" /><CodeLine lineNumber="4417"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 32)</span></CodeLine>
<Link id="l04418" /><CodeLine lineNumber="4418"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder-&gt;getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04419" /><CodeLine lineNumber="4419"><span class="doxyHighlight">          M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;distribute&#95;for&#95;static&#95;loop&#95;4u);</span></CodeLine>
<Link id="l04420" /><CodeLine lineNumber="4420"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 64)</span></CodeLine>
<Link id="l04421" /><CodeLine lineNumber="4421"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder-&gt;getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04422" /><CodeLine lineNumber="4422"><span class="doxyHighlight">          M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;distribute&#95;for&#95;static&#95;loop&#95;8u);</span></CodeLine>
<Link id="l04423" /><CodeLine lineNumber="4423"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04424" /><CodeLine lineNumber="4424"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04425" /><CodeLine lineNumber="4425"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth != 32 &amp;&amp; Bitwidth != 64) &#123;</span></CodeLine>
<Link id="l04426" /><CodeLine lineNumber="4426"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unknown OpenMP loop iterator bitwidth&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04427" /><CodeLine lineNumber="4427"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04428" /><CodeLine lineNumber="4428"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unknown type of OpenMP worksharing loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04429" /><CodeLine lineNumber="4429"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04430" /><CodeLine lineNumber="4430"></CodeLine>
<Link id="l04431" /><CodeLine lineNumber="4431"><span class="doxyHighlightComment">// Inserts a call to proper OpenMP Device RTL function which handles</span></CodeLine>
<Link id="l04432" /><CodeLine lineNumber="4432"><span class="doxyHighlightComment">// loop worksharing.</span></CodeLine>
<Link id="l04433" /><CodeLine lineNumber="4433" lineLink="#acae95016bcdeb105bcbcaaa872893f5f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#acae95016bcdeb105bcbcaaa872893f5f">createTargetLoopWorkshareCall</a>(</span></CodeLine>
<Link id="l04434" /><CodeLine lineNumber="4434"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &#42;OMPBuilder, <a href="/docs/api/namespaces/llvm/omp/#ab6fb146c332fd3f3d677ee65081fe669">WorksharingLoopType</a> LoopType,</span></CodeLine>
<Link id="l04435" /><CodeLine lineNumber="4435"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InsertBlock, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident, <a href="/docs/api/classes/llvm/value">Value</a> &#42;LoopBodyArg,</span></CodeLine>
<Link id="l04436" /><CodeLine lineNumber="4436"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ParallelTaskPtr, <a href="/docs/api/classes/llvm/value">Value</a> &#42;TripCount, <a href="/docs/api/classes/llvm/function">Function</a> &amp;LoopBodyFn) &#123;</span></CodeLine>
<Link id="l04437" /><CodeLine lineNumber="4437"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;TripCountTy = TripCount-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l04438" /><CodeLine lineNumber="4438"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/module">Module</a> &amp;M = OMPBuilder-&gt;M;</span></CodeLine>
<Link id="l04439" /><CodeLine lineNumber="4439"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder = OMPBuilder-&gt;Builder;</span></CodeLine>
<Link id="l04440" /><CodeLine lineNumber="4440"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a> RTLFn =</span></CodeLine>
<Link id="l04441" /><CodeLine lineNumber="4441"><span class="doxyHighlight">      <a href="#aca27639a720491c7c7ea13c2bbe8c162">getKmpcForStaticLoopForType</a>(TripCountTy, OMPBuilder, LoopType);</span></CodeLine>
<Link id="l04442" /><CodeLine lineNumber="4442"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 8&gt;</a> RealArgs;</span></CodeLine>
<Link id="l04443" /><CodeLine lineNumber="4443"><span class="doxyHighlight">  RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Ident);</span></CodeLine>
<Link id="l04444" /><CodeLine lineNumber="4444"><span class="doxyHighlight">  RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(&amp;LoopBodyFn, ParallelTaskPtr));</span></CodeLine>
<Link id="l04445" /><CodeLine lineNumber="4445"><span class="doxyHighlight">  RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(LoopBodyArg);</span></CodeLine>
<Link id="l04446" /><CodeLine lineNumber="4446"><span class="doxyHighlight">  RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(TripCount);</span></CodeLine>
<Link id="l04447" /><CodeLine lineNumber="4447"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopType == WorksharingLoopType::DistributeStaticLoop) &#123;</span></CodeLine>
<Link id="l04448" /><CodeLine lineNumber="4448"><span class="doxyHighlight">    RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ConstantInt::get(TripCountTy, 0));</span></CodeLine>
<Link id="l04449" /><CodeLine lineNumber="4449"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(RTLFn, RealArgs);</span></CodeLine>
<Link id="l04450" /><CodeLine lineNumber="4450"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04451" /><CodeLine lineNumber="4451"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04452" /><CodeLine lineNumber="4452"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a> RTLNumThreads = OMPBuilder-&gt;getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04453" /><CodeLine lineNumber="4453"><span class="doxyHighlight">      M, omp::RuntimeFunction::OMPRTL&#95;omp&#95;get&#95;num&#95;threads);</span></CodeLine>
<Link id="l04454" /><CodeLine lineNumber="4454"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#123;InsertBlock, std::prev(InsertBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>())&#125;);</span></CodeLine>
<Link id="l04455" /><CodeLine lineNumber="4455"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumThreads = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(RTLNumThreads, &#123;&#125;);</span></CodeLine>
<Link id="l04456" /><CodeLine lineNumber="4456"></CodeLine>
<Link id="l04457" /><CodeLine lineNumber="4457"><span class="doxyHighlight">  RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l04458" /><CodeLine lineNumber="4458"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a36742c35a8fff5f74bb3d76c9c19dd47">CreateZExtOrTrunc</a>(NumThreads, TripCountTy, </span><span class="doxyHighlightStringLiteral">&quot;num.threads.cast&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l04459" /><CodeLine lineNumber="4459"><span class="doxyHighlight">  RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ConstantInt::get(TripCountTy, 0));</span></CodeLine>
<Link id="l04460" /><CodeLine lineNumber="4460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopType == WorksharingLoopType::DistributeForStaticLoop) &#123;</span></CodeLine>
<Link id="l04461" /><CodeLine lineNumber="4461"><span class="doxyHighlight">    RealArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ConstantInt::get(TripCountTy, 0));</span></CodeLine>
<Link id="l04462" /><CodeLine lineNumber="4462"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04463" /><CodeLine lineNumber="4463"></CodeLine>
<Link id="l04464" /><CodeLine lineNumber="4464"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(RTLFn, RealArgs);</span></CodeLine>
<Link id="l04465" /><CodeLine lineNumber="4465"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04466" /><CodeLine lineNumber="4466"></CodeLine>
<Link id="l04467" /><CodeLine lineNumber="4467"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l04468" /><CodeLine lineNumber="4468" lineLink="#aa2a5199bf39360e25f40b93cd5f9468a"><span class="doxyHighlight"><a href="#aa2a5199bf39360e25f40b93cd5f9468a">workshareLoopTargetCallback</a>(<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &#42;OMPIRBuilder,</span></CodeLine>
<Link id="l04469" /><CodeLine lineNumber="4469"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;CLI, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident,</span></CodeLine>
<Link id="l04470" /><CodeLine lineNumber="4470"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/function">Function</a> &amp;OutlinedFn, <a href="/docs/api/classes/llvm/type">Type</a> &#42;ParallelTaskPtr,</span></CodeLine>
<Link id="l04471" /><CodeLine lineNumber="4471"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> &amp;ToBeDeleted,</span></CodeLine>
<Link id="l04472" /><CodeLine lineNumber="4472"><span class="doxyHighlight">                            <a href="/docs/api/namespaces/llvm/omp/#ab6fb146c332fd3f3d677ee65081fe669">WorksharingLoopType</a> LoopType) &#123;</span></CodeLine>
<Link id="l04473" /><CodeLine lineNumber="4473"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;Builder = OMPIRBuilder-&gt;Builder;</span></CodeLine>
<Link id="l04474" /><CodeLine lineNumber="4474"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>();</span></CodeLine>
<Link id="l04475" /><CodeLine lineNumber="4475"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;TripCount = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a01560f4a4ff7bfc8a96bd406b6f17ea2">getTripCount</a>();</span></CodeLine>
<Link id="l04476" /><CodeLine lineNumber="4476"></CodeLine>
<Link id="l04477" /><CodeLine lineNumber="4477"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// After loop body outling, the loop body contains only set up</span></CodeLine>
<Link id="l04478" /><CodeLine lineNumber="4478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of loop body argument structure and the call to the outlined</span></CodeLine>
<Link id="l04479" /><CodeLine lineNumber="4479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop body function. Firstly, we need to move setup of loop body args</span></CodeLine>
<Link id="l04480" /><CodeLine lineNumber="4480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into loop preheader.</span></CodeLine>
<Link id="l04481" /><CodeLine lineNumber="4481"><span class="doxyHighlight">  Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#af29f89e91dfd0ae90950f0b1bf49798d">splice</a>(std::prev(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()), CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>(),</span></CodeLine>
<Link id="l04482" /><CodeLine lineNumber="4482"><span class="doxyHighlight">                    CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), std::prev(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()));</span></CodeLine>
<Link id="l04483" /><CodeLine lineNumber="4483"></CodeLine>
<Link id="l04484" /><CodeLine lineNumber="4484"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The next step is to remove the whole loop. We do not it need anymore.</span></CodeLine>
<Link id="l04485" /><CodeLine lineNumber="4485"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// That&#39;s why make an unconditional branch from loop preheader to loop</span></CodeLine>
<Link id="l04486" /><CodeLine lineNumber="4486"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// exit block</span></CodeLine>
<Link id="l04487" /><CodeLine lineNumber="4487"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#123;Preheader, Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()&#125;);</span></CodeLine>
<Link id="l04488" /><CodeLine lineNumber="4488"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l04489" /><CodeLine lineNumber="4489"><span class="doxyHighlight">  Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l04490" /><CodeLine lineNumber="4490"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad3bf46daef8ce8176a68bcec0320dfd3">getExit</a>());</span></CodeLine>
<Link id="l04491" /><CodeLine lineNumber="4491"></CodeLine>
<Link id="l04492" /><CodeLine lineNumber="4492"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Delete dead loop blocks</span></CodeLine>
<Link id="l04493" /><CodeLine lineNumber="4493"><span class="doxyHighlight">  OpenMPIRBuilder::OutlineInfo CleanUpInfo;</span></CodeLine>
<Link id="l04494" /><CodeLine lineNumber="4494"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 32&gt;</a> RegionBlockSet;</span></CodeLine>
<Link id="l04495" /><CodeLine lineNumber="4495"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 32&gt;</a> BlocksToBeRemoved;</span></CodeLine>
<Link id="l04496" /><CodeLine lineNumber="4496"><span class="doxyHighlight">  CleanUpInfo.EntryBB = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a01c4471afa921c4962d7138cfcef4942">getHeader</a>();</span></CodeLine>
<Link id="l04497" /><CodeLine lineNumber="4497"><span class="doxyHighlight">  CleanUpInfo.ExitBB = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad3bf46daef8ce8176a68bcec0320dfd3">getExit</a>();</span></CodeLine>
<Link id="l04498" /><CodeLine lineNumber="4498"><span class="doxyHighlight">  CleanUpInfo.collectBlocks(RegionBlockSet, BlocksToBeRemoved);</span></CodeLine>
<Link id="l04499" /><CodeLine lineNumber="4499"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#addf42fea14164ec994d4d517eaa56688">DeleteDeadBlocks</a>(BlocksToBeRemoved);</span></CodeLine>
<Link id="l04500" /><CodeLine lineNumber="4500"></CodeLine>
<Link id="l04501" /><CodeLine lineNumber="4501"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find the instruction which corresponds to loop body argument structure</span></CodeLine>
<Link id="l04502" /><CodeLine lineNumber="4502"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and remove the call to loop body function instruction.</span></CodeLine>
<Link id="l04503" /><CodeLine lineNumber="4503"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LoopBodyArg;</span></CodeLine>
<Link id="l04504" /><CodeLine lineNumber="4504"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/user">User</a> &#42;OutlinedFnUser = OutlinedFn.<a href="/docs/api/classes/llvm/value/#a93270009c3358fba0a61654a9376ab4c">getUniqueUndroppableUser</a>();</span></CodeLine>
<Link id="l04505" /><CodeLine lineNumber="4505"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFnUser &amp;&amp;</span></CodeLine>
<Link id="l04506" /><CodeLine lineNumber="4506"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected unique undroppable user of outlined function&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04507" /><CodeLine lineNumber="4507"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;OutlinedFnCallInstruction = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(OutlinedFnUser);</span></CodeLine>
<Link id="l04508" /><CodeLine lineNumber="4508"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFnCallInstruction &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected outlined function call&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04509" /><CodeLine lineNumber="4509"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((OutlinedFnCallInstruction-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == Preheader) &amp;&amp;</span></CodeLine>
<Link id="l04510" /><CodeLine lineNumber="4510"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected outlined function call to be located in loop preheader&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04511" /><CodeLine lineNumber="4511"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check in case no argument structure has been passed.</span></CodeLine>
<Link id="l04512" /><CodeLine lineNumber="4512"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OutlinedFnCallInstruction-&gt;<a href="/docs/api/classes/llvm/callbase/#adde2ea00dd2613ee41bfe91908e4e68e">arg&#95;size</a>() &gt; 1)</span></CodeLine>
<Link id="l04513" /><CodeLine lineNumber="4513"><span class="doxyHighlight">    LoopBodyArg = OutlinedFnCallInstruction-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(1);</span></CodeLine>
<Link id="l04514" /><CodeLine lineNumber="4514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04515" /><CodeLine lineNumber="4515"><span class="doxyHighlight">    LoopBodyArg = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l04516" /><CodeLine lineNumber="4516"><span class="doxyHighlight">  OutlinedFnCallInstruction-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l04517" /><CodeLine lineNumber="4517"></CodeLine>
<Link id="l04518" /><CodeLine lineNumber="4518"><span class="doxyHighlight">  <a href="#acae95016bcdeb105bcbcaaa872893f5f">createTargetLoopWorkshareCall</a>(OMPIRBuilder, LoopType, Preheader, Ident,</span></CodeLine>
<Link id="l04519" /><CodeLine lineNumber="4519"><span class="doxyHighlight">                                LoopBodyArg, ParallelTaskPtr, TripCount,</span></CodeLine>
<Link id="l04520" /><CodeLine lineNumber="4520"><span class="doxyHighlight">                                OutlinedFn);</span></CodeLine>
<Link id="l04521" /><CodeLine lineNumber="4521"></CodeLine>
<Link id="l04522" /><CodeLine lineNumber="4522"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;ToBeDeletedItem : ToBeDeleted)</span></CodeLine>
<Link id="l04523" /><CodeLine lineNumber="4523"><span class="doxyHighlight">    ToBeDeletedItem-&gt;eraseFromParent();</span></CodeLine>
<Link id="l04524" /><CodeLine lineNumber="4524"><span class="doxyHighlight">  CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a9ce55b05f8ad85126fc92eeeb35457c7">invalidate</a>();</span></CodeLine>
<Link id="l04525" /><CodeLine lineNumber="4525"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04526" /><CodeLine lineNumber="4526"></CodeLine>
<Link id="l04527" /><CodeLine lineNumber="4527"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a></span></CodeLine>
<Link id="l04528" /><CodeLine lineNumber="4528"><span class="doxyHighlight">OpenMPIRBuilder::applyWorkshareLoopTarget(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;CLI,</span></CodeLine>
<Link id="l04529" /><CodeLine lineNumber="4529"><span class="doxyHighlight">                                          InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l04530" /><CodeLine lineNumber="4530"><span class="doxyHighlight">                                          <a href="/docs/api/namespaces/llvm/omp/#ab6fb146c332fd3f3d677ee65081fe669">WorksharingLoopType</a> LoopType) &#123;</span></CodeLine>
<Link id="l04531" /><CodeLine lineNumber="4531"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l04532" /><CodeLine lineNumber="4532"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SrcLocStrSize);</span></CodeLine>
<Link id="l04533" /><CodeLine lineNumber="4533"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l04534" /><CodeLine lineNumber="4534"></CodeLine>
<Link id="l04535" /><CodeLine lineNumber="4535"><span class="doxyHighlight">  OutlineInfo OI;</span></CodeLine>
<Link id="l04536" /><CodeLine lineNumber="4536"><span class="doxyHighlight">  OI.OuterAllocaBB = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>();</span></CodeLine>
<Link id="l04537" /><CodeLine lineNumber="4537"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;OuterFn = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l04538" /><CodeLine lineNumber="4538"></CodeLine>
<Link id="l04539" /><CodeLine lineNumber="4539"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Instructions which need to be deleted at the end of code generation</span></CodeLine>
<Link id="l04540" /><CodeLine lineNumber="4540"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;, 4&gt; ToBeDeleted;</span></CodeLine>
<Link id="l04541" /><CodeLine lineNumber="4541"></CodeLine>
<Link id="l04542" /><CodeLine lineNumber="4542"><span class="doxyHighlight">  OI.OuterAllocaBB = AllocaIP.getBlock();</span></CodeLine>
<Link id="l04543" /><CodeLine lineNumber="4543"></CodeLine>
<Link id="l04544" /><CodeLine lineNumber="4544"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Mark the body loop as region which needs to be extracted</span></CodeLine>
<Link id="l04545" /><CodeLine lineNumber="4545"><span class="doxyHighlight">  OI.EntryBB = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>();</span></CodeLine>
<Link id="l04546" /><CodeLine lineNumber="4546"><span class="doxyHighlight">  OI.ExitBB = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac37a6cf77f6f82b6bb28af4d9c8626d0">getLatch</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac37a6cf77f6f82b6bb28af4d9c8626d0">getLatch</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(),</span></CodeLine>
<Link id="l04547" /><CodeLine lineNumber="4547"><span class="doxyHighlight">                                               </span><span class="doxyHighlightStringLiteral">&quot;omp.prelatch&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04548" /><CodeLine lineNumber="4548"></CodeLine>
<Link id="l04549" /><CodeLine lineNumber="4549"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Prepare loop body for extraction</span></CodeLine>
<Link id="l04550" /><CodeLine lineNumber="4550"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#123;CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>(), CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()&#125;);</span></CodeLine>
<Link id="l04551" /><CodeLine lineNumber="4551"></CodeLine>
<Link id="l04552" /><CodeLine lineNumber="4552"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert new loop counter variable which will be used only in loop</span></CodeLine>
<Link id="l04553" /><CodeLine lineNumber="4553"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// body.</span></CodeLine>
<Link id="l04554" /><CodeLine lineNumber="4554"><span class="doxyHighlight">  AllocaInst &#42;NewLoopCnt = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a46b5cd2a0881c8be5183d70a32eef90d">getIndVarType</a>(), 0, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04555" /><CodeLine lineNumber="4555"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;NewLoopCntLoad =</span></CodeLine>
<Link id="l04556" /><CodeLine lineNumber="4556"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a46b5cd2a0881c8be5183d70a32eef90d">getIndVarType</a>(), NewLoopCnt);</span></CodeLine>
<Link id="l04557" /><CodeLine lineNumber="4557"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// New loop counter instructions are redundant in the loop preheader when</span></CodeLine>
<Link id="l04558" /><CodeLine lineNumber="4558"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// code generation for workshare loop is finshed. That&#39;s why mark them as</span></CodeLine>
<Link id="l04559" /><CodeLine lineNumber="4559"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ready for deletion.</span></CodeLine>
<Link id="l04560" /><CodeLine lineNumber="4560"><span class="doxyHighlight">  ToBeDeleted.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(NewLoopCntLoad);</span></CodeLine>
<Link id="l04561" /><CodeLine lineNumber="4561"><span class="doxyHighlight">  ToBeDeleted.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(NewLoopCnt);</span></CodeLine>
<Link id="l04562" /><CodeLine lineNumber="4562"></CodeLine>
<Link id="l04563" /><CodeLine lineNumber="4563"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Analyse loop body region. Find all input variables which are used inside</span></CodeLine>
<Link id="l04564" /><CodeLine lineNumber="4564"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop body region.</span></CodeLine>
<Link id="l04565" /><CodeLine lineNumber="4565"><span class="doxyHighlight">  SmallPtrSet&lt;BasicBlock &#42;, 32&gt; ParallelRegionBlockSet;</span></CodeLine>
<Link id="l04566" /><CodeLine lineNumber="4566"><span class="doxyHighlight">  SmallVector&lt;BasicBlock &#42;, 32&gt; Blocks;</span></CodeLine>
<Link id="l04567" /><CodeLine lineNumber="4567"><span class="doxyHighlight">  OI.collectBlocks(ParallelRegionBlockSet, Blocks);</span></CodeLine>
<Link id="l04568" /><CodeLine lineNumber="4568"><span class="doxyHighlight">  SmallVector&lt;BasicBlock &#42;, 32&gt; BlocksT(ParallelRegionBlockSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#abf73a826b5d6f739eb4af48ddf14c5b4">begin</a>(),</span></CodeLine>
<Link id="l04569" /><CodeLine lineNumber="4569"><span class="doxyHighlight">                                        ParallelRegionBlockSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a7004354fbee1c8cd74ed9001915e1db5">end</a>());</span></CodeLine>
<Link id="l04570" /><CodeLine lineNumber="4570"></CodeLine>
<Link id="l04571" /><CodeLine lineNumber="4571"><span class="doxyHighlight">  CodeExtractorAnalysisCache CEAC(&#42;OuterFn);</span></CodeLine>
<Link id="l04572" /><CodeLine lineNumber="4572"><span class="doxyHighlight">  CodeExtractor Extractor(Blocks,</span></CodeLine>
<Link id="l04573" /><CodeLine lineNumber="4573"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; DominatorTree &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04574" /><CodeLine lineNumber="4574"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; AggregateArgs &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04575" /><CodeLine lineNumber="4575"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; BlockFrequencyInfo &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04576" /><CodeLine lineNumber="4576"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; BranchProbabilityInfo &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04577" /><CodeLine lineNumber="4577"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; AssumptionCache &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04578" /><CodeLine lineNumber="4578"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; AllowVarArgs &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04579" /><CodeLine lineNumber="4579"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; AllowAlloca &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04580" /><CodeLine lineNumber="4580"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; AllocationBlock &#42;/</span><span class="doxyHighlight"> CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>(),</span></CodeLine>
<Link id="l04581" /><CodeLine lineNumber="4581"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; Suffix &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;.omp&#95;wsloop&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04582" /><CodeLine lineNumber="4582"><span class="doxyHighlight">                          </span><span class="doxyHighlightComment">/&#42; AggrArgsIn0AddrSpace &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04583" /><CodeLine lineNumber="4583"></CodeLine>
<Link id="l04584" /><CodeLine lineNumber="4584"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CommonExit = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04585" /><CodeLine lineNumber="4585"><span class="doxyHighlight">  SetVector&lt;Value &#42;&gt; Inputs, Outputs, SinkingCands, HoistingCands;</span></CodeLine>
<Link id="l04586" /><CodeLine lineNumber="4586"></CodeLine>
<Link id="l04587" /><CodeLine lineNumber="4587"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find allocas outside the loop body region which are used inside loop</span></CodeLine>
<Link id="l04588" /><CodeLine lineNumber="4588"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// body</span></CodeLine>
<Link id="l04589" /><CodeLine lineNumber="4589"><span class="doxyHighlight">  Extractor.findAllocas(CEAC, SinkingCands, HoistingCands, CommonExit);</span></CodeLine>
<Link id="l04590" /><CodeLine lineNumber="4590"></CodeLine>
<Link id="l04591" /><CodeLine lineNumber="4591"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to model loop body region as the function f(cnt, loop&#95;arg).</span></CodeLine>
<Link id="l04592" /><CodeLine lineNumber="4592"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// That&#39;s why we replace loop induction variable by the new counter</span></CodeLine>
<Link id="l04593" /><CodeLine lineNumber="4593"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which will be one of loop body function argument</span></CodeLine>
<Link id="l04594" /><CodeLine lineNumber="4594"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;User &#42;&gt;</a> <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#af4131f5f461f1138483addfd7cd7f579">getIndVar</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>(),</span></CodeLine>
<Link id="l04595" /><CodeLine lineNumber="4595"><span class="doxyHighlight">                            CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#af4131f5f461f1138483addfd7cd7f579">getIndVar</a>()-&gt;<a href="/docs/api/classes/llvm/value/#aa22118b2b3f206bfda2ffab4cda94d64">user&#95;end</a>());</span></CodeLine>
<Link id="l04596" /><CodeLine lineNumber="4596"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Use : <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>) &#123;</span></CodeLine>
<Link id="l04597" /><CodeLine lineNumber="4597"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Instruction &#42;Inst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Use)) &#123;</span></CodeLine>
<Link id="l04598" /><CodeLine lineNumber="4598"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ParallelRegionBlockSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(Inst-&gt;getParent())) &#123;</span></CodeLine>
<Link id="l04599" /><CodeLine lineNumber="4599"><span class="doxyHighlight">        Inst-&gt;replaceUsesOfWith(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#af4131f5f461f1138483addfd7cd7f579">getIndVar</a>(), NewLoopCntLoad);</span></CodeLine>
<Link id="l04600" /><CodeLine lineNumber="4600"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04601" /><CodeLine lineNumber="4601"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04602" /><CodeLine lineNumber="4602"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04603" /><CodeLine lineNumber="4603"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure that loop counter variable is not merged into loop body</span></CodeLine>
<Link id="l04604" /><CodeLine lineNumber="4604"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function argument structure and it is passed as separate variable</span></CodeLine>
<Link id="l04605" /><CodeLine lineNumber="4605"><span class="doxyHighlight">  OI.ExcludeArgsFromAggregate.push&#95;back(NewLoopCntLoad);</span></CodeLine>
<Link id="l04606" /><CodeLine lineNumber="4606"></CodeLine>
<Link id="l04607" /><CodeLine lineNumber="4607"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PostOutline CB is invoked when loop body function is outlined and</span></CodeLine>
<Link id="l04608" /><CodeLine lineNumber="4608"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop body is replaced by call to outlined function. We need to add</span></CodeLine>
<Link id="l04609" /><CodeLine lineNumber="4609"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call to OpenMP device rtl inside loop preheader. OpenMP device rtl</span></CodeLine>
<Link id="l04610" /><CodeLine lineNumber="4610"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function will handle loop control logic.</span></CodeLine>
<Link id="l04611" /><CodeLine lineNumber="4611"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l04612" /><CodeLine lineNumber="4612"><span class="doxyHighlight">  OI.PostOutlineCB = &#91;=, ToBeDeletedVec =</span></CodeLine>
<Link id="l04613" /><CodeLine lineNumber="4613"><span class="doxyHighlight">                             std::move(ToBeDeleted)&#93;(<a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &amp;OutlinedFn) &#123;</span></CodeLine>
<Link id="l04614" /><CodeLine lineNumber="4614"><span class="doxyHighlight">    <a href="#aa2a5199bf39360e25f40b93cd5f9468a">workshareLoopTargetCallback</a>(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, CLI, Ident, OutlinedFn, ParallelTaskPtr,</span></CodeLine>
<Link id="l04615" /><CodeLine lineNumber="4615"><span class="doxyHighlight">                                ToBeDeletedVec, LoopType);</span></CodeLine>
<Link id="l04616" /><CodeLine lineNumber="4616"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l04617" /><CodeLine lineNumber="4617"><span class="doxyHighlight">  addOutlineInfo(std::move(OI));</span></CodeLine>
<Link id="l04618" /><CodeLine lineNumber="4618"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a578dd7d619d0ccfc6ace07aa380022cc">getAfterIP</a>();</span></CodeLine>
<Link id="l04619" /><CodeLine lineNumber="4619"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04620" /><CodeLine lineNumber="4620"></CodeLine>
<Link id="l04621" /><CodeLine lineNumber="4621" lineLink="/docs/api/classes/llvm/openmpirbuilder/#adaa14806d128ad33bdc48d2bfc46870c"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> <a href="/docs/api/classes/llvm/openmpirbuilder/#adaa14806d128ad33bdc48d2bfc46870c">OpenMPIRBuilder::applyWorkshareLoop</a>(</span></CodeLine>
<Link id="l04622" /><CodeLine lineNumber="4622"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;CLI, <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AllocaIP,</span></CodeLine>
<Link id="l04623" /><CodeLine lineNumber="4623"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsBarrier, omp::ScheduleKind SchedKind, <a href="/docs/api/classes/llvm/value">Value</a> &#42;ChunkSize,</span></CodeLine>
<Link id="l04624" /><CodeLine lineNumber="4624"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasSimdModifier, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasMonotonicModifier,</span></CodeLine>
<Link id="l04625" /><CodeLine lineNumber="4625"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasNonmonotonicModifier, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasOrderedClause,</span></CodeLine>
<Link id="l04626" /><CodeLine lineNumber="4626"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#ab6fb146c332fd3f3d677ee65081fe669">WorksharingLoopType</a> LoopType) &#123;</span></CodeLine>
<Link id="l04627" /><CodeLine lineNumber="4627"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Config.isTargetDevice())</span></CodeLine>
<Link id="l04628" /><CodeLine lineNumber="4628"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> applyWorkshareLoopTarget(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CLI, AllocaIP, LoopType);</span></CodeLine>
<Link id="l04629" /><CodeLine lineNumber="4629"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> EffectiveScheduleType = <a href="#a554000c782275642b783964853720bee">computeOpenMPScheduleType</a>(</span></CodeLine>
<Link id="l04630" /><CodeLine lineNumber="4630"><span class="doxyHighlight">      SchedKind, ChunkSize, HasSimdModifier, HasMonotonicModifier,</span></CodeLine>
<Link id="l04631" /><CodeLine lineNumber="4631"><span class="doxyHighlight">      HasNonmonotonicModifier, HasOrderedClause);</span></CodeLine>
<Link id="l04632" /><CodeLine lineNumber="4632"></CodeLine>
<Link id="l04633" /><CodeLine lineNumber="4633"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsOrdered = (EffectiveScheduleType &amp; OMPScheduleType::ModifierOrdered) ==</span></CodeLine>
<Link id="l04634" /><CodeLine lineNumber="4634"><span class="doxyHighlight">                   OMPScheduleType::ModifierOrdered;</span></CodeLine>
<Link id="l04635" /><CodeLine lineNumber="4635"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (EffectiveScheduleType &amp; ~OMPScheduleType::ModifierMask) &#123;</span></CodeLine>
<Link id="l04636" /><CodeLine lineNumber="4636"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseStatic:</span></CodeLine>
<Link id="l04637" /><CodeLine lineNumber="4637"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!ChunkSize &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No chunk size with static-chunked schedule&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04638" /><CodeLine lineNumber="4638"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsOrdered)</span></CodeLine>
<Link id="l04639" /><CodeLine lineNumber="4639"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> applyDynamicWorkshareLoop(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CLI, AllocaIP, EffectiveScheduleType,</span></CodeLine>
<Link id="l04640" /><CodeLine lineNumber="4640"><span class="doxyHighlight">                                       NeedsBarrier, ChunkSize);</span></CodeLine>
<Link id="l04641" /><CodeLine lineNumber="4641"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Monotonicity ignored?</span></CodeLine>
<Link id="l04642" /><CodeLine lineNumber="4642"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> applyStaticWorkshareLoop(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CLI, AllocaIP, NeedsBarrier);</span></CodeLine>
<Link id="l04643" /><CodeLine lineNumber="4643"></CodeLine>
<Link id="l04644" /><CodeLine lineNumber="4644"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseStaticChunked:</span></CodeLine>
<Link id="l04645" /><CodeLine lineNumber="4645"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsOrdered)</span></CodeLine>
<Link id="l04646" /><CodeLine lineNumber="4646"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> applyDynamicWorkshareLoop(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CLI, AllocaIP, EffectiveScheduleType,</span></CodeLine>
<Link id="l04647" /><CodeLine lineNumber="4647"><span class="doxyHighlight">                                       NeedsBarrier, ChunkSize);</span></CodeLine>
<Link id="l04648" /><CodeLine lineNumber="4648"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Monotonicity ignored?</span></CodeLine>
<Link id="l04649" /><CodeLine lineNumber="4649"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> applyStaticChunkedWorkshareLoop(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CLI, AllocaIP, NeedsBarrier,</span></CodeLine>
<Link id="l04650" /><CodeLine lineNumber="4650"><span class="doxyHighlight">                                           ChunkSize);</span></CodeLine>
<Link id="l04651" /><CodeLine lineNumber="4651"></CodeLine>
<Link id="l04652" /><CodeLine lineNumber="4652"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseRuntime:</span></CodeLine>
<Link id="l04653" /><CodeLine lineNumber="4653"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseAuto:</span></CodeLine>
<Link id="l04654" /><CodeLine lineNumber="4654"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseGreedy:</span></CodeLine>
<Link id="l04655" /><CodeLine lineNumber="4655"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseBalanced:</span></CodeLine>
<Link id="l04656" /><CodeLine lineNumber="4656"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseSteal:</span></CodeLine>
<Link id="l04657" /><CodeLine lineNumber="4657"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseGuidedSimd:</span></CodeLine>
<Link id="l04658" /><CodeLine lineNumber="4658"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseRuntimeSimd:</span></CodeLine>
<Link id="l04659" /><CodeLine lineNumber="4659"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!ChunkSize &amp;&amp;</span></CodeLine>
<Link id="l04660" /><CodeLine lineNumber="4660"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;schedule type does not support user-defined chunk sizes&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04661" /><CodeLine lineNumber="4661"><span class="doxyHighlight">    &#91;&#91;fallthrough&#93;&#93;;</span></CodeLine>
<Link id="l04662" /><CodeLine lineNumber="4662"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseDynamicChunked:</span></CodeLine>
<Link id="l04663" /><CodeLine lineNumber="4663"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseGuidedChunked:</span></CodeLine>
<Link id="l04664" /><CodeLine lineNumber="4664"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseGuidedIterativeChunked:</span></CodeLine>
<Link id="l04665" /><CodeLine lineNumber="4665"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseGuidedAnalyticalChunked:</span></CodeLine>
<Link id="l04666" /><CodeLine lineNumber="4666"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OMPScheduleType::BaseStaticBalancedChunked:</span></CodeLine>
<Link id="l04667" /><CodeLine lineNumber="4667"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> applyDynamicWorkshareLoop(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CLI, AllocaIP, EffectiveScheduleType,</span></CodeLine>
<Link id="l04668" /><CodeLine lineNumber="4668"><span class="doxyHighlight">                                     NeedsBarrier, ChunkSize);</span></CodeLine>
<Link id="l04669" /><CodeLine lineNumber="4669"></CodeLine>
<Link id="l04670" /><CodeLine lineNumber="4670"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l04671" /><CodeLine lineNumber="4671"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unknown/unimplemented schedule kind&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04672" /><CodeLine lineNumber="4672"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04673" /><CodeLine lineNumber="4673"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04674" /><CodeLine lineNumber="4674"></CodeLine>
<Link id="l04675" /><CodeLine lineNumber="4675"><span class="doxyHighlightComment">/// Returns an LLVM function to call for initializing loop bounds using OpenMP</span></CodeLine>
<Link id="l04676" /><CodeLine lineNumber="4676"><span class="doxyHighlightComment">/// dynamic scheduling depending on &#96;type&#96;. Only i32 and i64 are supported by</span></CodeLine>
<Link id="l04677" /><CodeLine lineNumber="4677"><span class="doxyHighlightComment">/// the runtime. Always interpret integers as unsigned similarly to</span></CodeLine>
<Link id="l04678" /><CodeLine lineNumber="4678"><span class="doxyHighlightComment">/// CanonicalLoopInfo.</span></CodeLine>
<Link id="l04679" /><CodeLine lineNumber="4679"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a></span></CodeLine>
<Link id="l04680" /><CodeLine lineNumber="4680" lineLink="#a7a68322ba864bccb8736e42fbc915a8a"><span class="doxyHighlight"><a href="#a7a68322ba864bccb8736e42fbc915a8a">getKmpcForDynamicInitForType</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp;OMPBuilder) &#123;</span></CodeLine>
<Link id="l04681" /><CodeLine lineNumber="4681"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Bitwidth = Ty-&gt;getIntegerBitWidth();</span></CodeLine>
<Link id="l04682" /><CodeLine lineNumber="4682"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 32)</span></CodeLine>
<Link id="l04683" /><CodeLine lineNumber="4683"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04684" /><CodeLine lineNumber="4684"><span class="doxyHighlight">        M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;init&#95;4u);</span></CodeLine>
<Link id="l04685" /><CodeLine lineNumber="4685"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 64)</span></CodeLine>
<Link id="l04686" /><CodeLine lineNumber="4686"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04687" /><CodeLine lineNumber="4687"><span class="doxyHighlight">        M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;init&#95;8u);</span></CodeLine>
<Link id="l04688" /><CodeLine lineNumber="4688"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;unknown OpenMP loop iterator bitwidth&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04689" /><CodeLine lineNumber="4689"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04690" /><CodeLine lineNumber="4690"></CodeLine>
<Link id="l04691" /><CodeLine lineNumber="4691"><span class="doxyHighlightComment">/// Returns an LLVM function to call for updating the next loop using OpenMP</span></CodeLine>
<Link id="l04692" /><CodeLine lineNumber="4692"><span class="doxyHighlightComment">/// dynamic scheduling depending on &#96;type&#96;. Only i32 and i64 are supported by</span></CodeLine>
<Link id="l04693" /><CodeLine lineNumber="4693"><span class="doxyHighlightComment">/// the runtime. Always interpret integers as unsigned similarly to</span></CodeLine>
<Link id="l04694" /><CodeLine lineNumber="4694"><span class="doxyHighlightComment">/// CanonicalLoopInfo.</span></CodeLine>
<Link id="l04695" /><CodeLine lineNumber="4695"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a></span></CodeLine>
<Link id="l04696" /><CodeLine lineNumber="4696" lineLink="#a74bf2240e1da04168d57a7534c9613f7"><span class="doxyHighlight"><a href="#a74bf2240e1da04168d57a7534c9613f7">getKmpcForDynamicNextForType</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp;OMPBuilder) &#123;</span></CodeLine>
<Link id="l04697" /><CodeLine lineNumber="4697"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Bitwidth = Ty-&gt;getIntegerBitWidth();</span></CodeLine>
<Link id="l04698" /><CodeLine lineNumber="4698"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 32)</span></CodeLine>
<Link id="l04699" /><CodeLine lineNumber="4699"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04700" /><CodeLine lineNumber="4700"><span class="doxyHighlight">        M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;next&#95;4u);</span></CodeLine>
<Link id="l04701" /><CodeLine lineNumber="4701"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 64)</span></CodeLine>
<Link id="l04702" /><CodeLine lineNumber="4702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04703" /><CodeLine lineNumber="4703"><span class="doxyHighlight">        M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;next&#95;8u);</span></CodeLine>
<Link id="l04704" /><CodeLine lineNumber="4704"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;unknown OpenMP loop iterator bitwidth&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04705" /><CodeLine lineNumber="4705"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04706" /><CodeLine lineNumber="4706"></CodeLine>
<Link id="l04707" /><CodeLine lineNumber="4707"><span class="doxyHighlightComment">/// Returns an LLVM function to call for finalizing the dynamic loop using</span></CodeLine>
<Link id="l04708" /><CodeLine lineNumber="4708"><span class="doxyHighlightComment">/// depending on &#96;type&#96;. Only i32 and i64 are supported by the runtime. Always</span></CodeLine>
<Link id="l04709" /><CodeLine lineNumber="4709"><span class="doxyHighlightComment">/// interpret integers as unsigned similarly to CanonicalLoopInfo.</span></CodeLine>
<Link id="l04710" /><CodeLine lineNumber="4710"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a></span></CodeLine>
<Link id="l04711" /><CodeLine lineNumber="4711" lineLink="#a3d17252beff7921e40622170990c89ab"><span class="doxyHighlight"><a href="#a3d17252beff7921e40622170990c89ab">getKmpcForDynamicFiniForType</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp;OMPBuilder) &#123;</span></CodeLine>
<Link id="l04712" /><CodeLine lineNumber="4712"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Bitwidth = Ty-&gt;getIntegerBitWidth();</span></CodeLine>
<Link id="l04713" /><CodeLine lineNumber="4713"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 32)</span></CodeLine>
<Link id="l04714" /><CodeLine lineNumber="4714"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04715" /><CodeLine lineNumber="4715"><span class="doxyHighlight">        M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;fini&#95;4u);</span></CodeLine>
<Link id="l04716" /><CodeLine lineNumber="4716"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Bitwidth == 64)</span></CodeLine>
<Link id="l04717" /><CodeLine lineNumber="4717"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.getOrCreateRuntimeFunction(</span></CodeLine>
<Link id="l04718" /><CodeLine lineNumber="4718"><span class="doxyHighlight">        M, omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;fini&#95;8u);</span></CodeLine>
<Link id="l04719" /><CodeLine lineNumber="4719"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;unknown OpenMP loop iterator bitwidth&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04720" /><CodeLine lineNumber="4720"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04721" /><CodeLine lineNumber="4721"></CodeLine>
<Link id="l04722" /><CodeLine lineNumber="4722"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a></span></CodeLine>
<Link id="l04723" /><CodeLine lineNumber="4723"><span class="doxyHighlight">OpenMPIRBuilder::applyDynamicWorkshareLoop(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;CLI,</span></CodeLine>
<Link id="l04724" /><CodeLine lineNumber="4724"><span class="doxyHighlight">                                           InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l04725" /><CodeLine lineNumber="4725"><span class="doxyHighlight">                                           <a href="/docs/api/namespaces/llvm/omp/#a231ea6a9a0009e38969a20d4293119c7">OMPScheduleType</a> SchedType,</span></CodeLine>
<Link id="l04726" /><CodeLine lineNumber="4726"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsBarrier, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Chunk) &#123;</span></CodeLine>
<Link id="l04727" /><CodeLine lineNumber="4727"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a4b2b7074e300c251f7cb8913620b1d80">isValid</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Requires a valid canonical loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04728" /><CodeLine lineNumber="4728"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="#a756b28f370cd5a39bc0ee3e5333b9c9b">isConflictIP</a>(AllocaIP, CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac72ebc430ef7dcf1791c66080ddedd9d">getPreheaderIP</a>()) &amp;&amp;</span></CodeLine>
<Link id="l04729" /><CodeLine lineNumber="4729"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Require dedicated allocate IP&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04730" /><CodeLine lineNumber="4730"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#a596dcc3bb2ae8b7561e94095584e0f1e">isValidWorkshareLoopScheduleType</a>(SchedType) &amp;&amp;</span></CodeLine>
<Link id="l04731" /><CodeLine lineNumber="4731"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Require valid schedule type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04732" /><CodeLine lineNumber="4732"></CodeLine>
<Link id="l04733" /><CodeLine lineNumber="4733"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Ordered = (SchedType &amp; OMPScheduleType::ModifierOrdered) ==</span></CodeLine>
<Link id="l04734" /><CodeLine lineNumber="4734"><span class="doxyHighlight">                 OMPScheduleType::ModifierOrdered;</span></CodeLine>
<Link id="l04735" /><CodeLine lineNumber="4735"></CodeLine>
<Link id="l04736" /><CodeLine lineNumber="4736"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set up the source location value for OpenMP runtime.</span></CodeLine>
<Link id="l04737" /><CodeLine lineNumber="4737"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04738" /><CodeLine lineNumber="4738"></CodeLine>
<Link id="l04739" /><CodeLine lineNumber="4739"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l04740" /><CodeLine lineNumber="4740"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SrcLocStrSize);</span></CodeLine>
<Link id="l04741" /><CodeLine lineNumber="4741"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SrcLoc = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l04742" /><CodeLine lineNumber="4742"></CodeLine>
<Link id="l04743" /><CodeLine lineNumber="4743"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Declare useful OpenMP runtime functions.</span></CodeLine>
<Link id="l04744" /><CodeLine lineNumber="4744"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#af4131f5f461f1138483addfd7cd7f579">getIndVar</a>();</span></CodeLine>
<Link id="l04745" /><CodeLine lineNumber="4745"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;IVTy = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getType();</span></CodeLine>
<Link id="l04746" /><CodeLine lineNumber="4746"><span class="doxyHighlight">  FunctionCallee DynamicInit = <a href="#a7a68322ba864bccb8736e42fbc915a8a">getKmpcForDynamicInitForType</a>(IVTy, M, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04747" /><CodeLine lineNumber="4747"><span class="doxyHighlight">  FunctionCallee DynamicNext = <a href="#a74bf2240e1da04168d57a7534c9613f7">getKmpcForDynamicNextForType</a>(IVTy, M, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04748" /><CodeLine lineNumber="4748"></CodeLine>
<Link id="l04749" /><CodeLine lineNumber="4749"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Allocate space for computed loop bounds as expected by the &quot;init&quot; function.</span></CodeLine>
<Link id="l04750" /><CodeLine lineNumber="4750"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(AllocaIP.getBlock()-&gt;getFirstNonPHIOrDbgOrAlloca());</span></CodeLine>
<Link id="l04751" /><CodeLine lineNumber="4751"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;I32Type = <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext());</span></CodeLine>
<Link id="l04752" /><CodeLine lineNumber="4752"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PLastIter = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(I32Type, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;p.lastiter&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04753" /><CodeLine lineNumber="4753"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PLowerBound = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(IVTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;p.lowerbound&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04754" /><CodeLine lineNumber="4754"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PUpperBound = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(IVTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;p.upperbound&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04755" /><CodeLine lineNumber="4755"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PStride = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(IVTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;p.stride&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04756" /><CodeLine lineNumber="4756"></CodeLine>
<Link id="l04757" /><CodeLine lineNumber="4757"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// At the end of the preheader, prepare for calling the &quot;init&quot; function by</span></CodeLine>
<Link id="l04758" /><CodeLine lineNumber="4758"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// storing the current loop bounds into the allocated space. A canonical loop</span></CodeLine>
<Link id="l04759" /><CodeLine lineNumber="4759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// always iterates from 0 to trip-count with step 1 Note that &quot;init&quot; expects</span></CodeLine>
<Link id="l04760" /><CodeLine lineNumber="4760"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and produces an inclusive upper bound.</span></CodeLine>
<Link id="l04761" /><CodeLine lineNumber="4761"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;PreHeader = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>();</span></CodeLine>
<Link id="l04762" /><CodeLine lineNumber="4762"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(PreHeader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l04763" /><CodeLine lineNumber="4763"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;One = ConstantInt::get(IVTy, 1);</span></CodeLine>
<Link id="l04764" /><CodeLine lineNumber="4764"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(One, PLowerBound);</span></CodeLine>
<Link id="l04765" /><CodeLine lineNumber="4765"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;UpperBound = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a01560f4a4ff7bfc8a96bd406b6f17ea2">getTripCount</a>();</span></CodeLine>
<Link id="l04766" /><CodeLine lineNumber="4766"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(UpperBound, PUpperBound);</span></CodeLine>
<Link id="l04767" /><CodeLine lineNumber="4767"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(One, PStride);</span></CodeLine>
<Link id="l04768" /><CodeLine lineNumber="4768"></CodeLine>
<Link id="l04769" /><CodeLine lineNumber="4769"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;<a href="/docs/api/namespaces/anonymous-lvcompare-cpp-/#a1ad6686ca7dcf67bc791fff07fdf7818abf50d5e661106d0abe925af3c2e6f7e7">Header</a> = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a01c4471afa921c4962d7138cfcef4942">getHeader</a>();</span></CodeLine>
<Link id="l04770" /><CodeLine lineNumber="4770"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39cacd4cef2a5a26efd5d75ecca95bc6ff24">Exit</a> = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad3bf46daef8ce8176a68bcec0320dfd3">getExit</a>();</span></CodeLine>
<Link id="l04771" /><CodeLine lineNumber="4771"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#acb5b5b136597312e0d5df6b746a7e6db">getCond</a>();</span></CodeLine>
<Link id="l04772" /><CodeLine lineNumber="4772"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;Latch = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac37a6cf77f6f82b6bb28af4d9c8626d0">getLatch</a>();</span></CodeLine>
<Link id="l04773" /><CodeLine lineNumber="4773"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AfterIP = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a578dd7d619d0ccfc6ace07aa380022cc">getAfterIP</a>();</span></CodeLine>
<Link id="l04774" /><CodeLine lineNumber="4774"></CodeLine>
<Link id="l04775" /><CodeLine lineNumber="4775"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The CLI will be &quot;broken&quot; in the code below, as the loop is no longer</span></CodeLine>
<Link id="l04776" /><CodeLine lineNumber="4776"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a valid canonical loop.</span></CodeLine>
<Link id="l04777" /><CodeLine lineNumber="4777"></CodeLine>
<Link id="l04778" /><CodeLine lineNumber="4778"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Chunk)</span></CodeLine>
<Link id="l04779" /><CodeLine lineNumber="4779"><span class="doxyHighlight">    Chunk = One;</span></CodeLine>
<Link id="l04780" /><CodeLine lineNumber="4780"></CodeLine>
<Link id="l04781" /><CodeLine lineNumber="4781"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadNum = getOrCreateThreadID(SrcLoc);</span></CodeLine>
<Link id="l04782" /><CodeLine lineNumber="4782"></CodeLine>
<Link id="l04783" /><CodeLine lineNumber="4783"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SchedulingType =</span></CodeLine>
<Link id="l04784" /><CodeLine lineNumber="4784"><span class="doxyHighlight">      ConstantInt::get(I32Type, </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(SchedType));</span></CodeLine>
<Link id="l04785" /><CodeLine lineNumber="4785"></CodeLine>
<Link id="l04786" /><CodeLine lineNumber="4786"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Call the &quot;init&quot; function.</span></CodeLine>
<Link id="l04787" /><CodeLine lineNumber="4787"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(DynamicInit,</span></CodeLine>
<Link id="l04788" /><CodeLine lineNumber="4788"><span class="doxyHighlight">                     &#123;SrcLoc, ThreadNum, SchedulingType, </span><span class="doxyHighlightComment">/&#42; LowerBound &#42;/</span><span class="doxyHighlight"> One,</span></CodeLine>
<Link id="l04789" /><CodeLine lineNumber="4789"><span class="doxyHighlight">                      UpperBound, </span><span class="doxyHighlightComment">/&#42; step &#42;/</span><span class="doxyHighlight"> One, Chunk&#125;);</span></CodeLine>
<Link id="l04790" /><CodeLine lineNumber="4790"></CodeLine>
<Link id="l04791" /><CodeLine lineNumber="4791"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// An outer loop around the existing one.</span></CodeLine>
<Link id="l04792" /><CodeLine lineNumber="4792"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;OuterCond = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l04793" /><CodeLine lineNumber="4793"><span class="doxyHighlight">      PreHeader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), Twine(PreHeader-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()) + </span><span class="doxyHighlightStringLiteral">&quot;.outer.cond&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04794" /><CodeLine lineNumber="4794"><span class="doxyHighlight">      PreHeader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l04795" /><CodeLine lineNumber="4795"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This needs to be 32-bit always, so can&#39;t use the IVTy Zero above.</span></CodeLine>
<Link id="l04796" /><CodeLine lineNumber="4796"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(OuterCond, OuterCond-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l04797" /><CodeLine lineNumber="4797"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Res =</span></CodeLine>
<Link id="l04798" /><CodeLine lineNumber="4798"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(DynamicNext, &#123;SrcLoc, ThreadNum, PLastIter,</span></CodeLine>
<Link id="l04799" /><CodeLine lineNumber="4799"><span class="doxyHighlight">                                       PLowerBound, PUpperBound, PStride&#125;);</span></CodeLine>
<Link id="l04800" /><CodeLine lineNumber="4800"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;Zero32 = ConstantInt::get(I32Type, 0);</span></CodeLine>
<Link id="l04801" /><CodeLine lineNumber="4801"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;MoreWork = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a843d43d070f0b1c6a133403edce488ef">CreateCmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">CmpInst::ICMP&#95;NE</a>, Res, Zero32);</span></CodeLine>
<Link id="l04802" /><CodeLine lineNumber="4802"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LowerBound =</span></CodeLine>
<Link id="l04803" /><CodeLine lineNumber="4803"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(IVTy, PLowerBound), One, </span><span class="doxyHighlightStringLiteral">&quot;lb&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04804" /><CodeLine lineNumber="4804"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(MoreWork, Header, Exit);</span></CodeLine>
<Link id="l04805" /><CodeLine lineNumber="4805"></CodeLine>
<Link id="l04806" /><CodeLine lineNumber="4806"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Change PHI-node in loop header to use outer cond rather than preheader,</span></CodeLine>
<Link id="l04807" /><CodeLine lineNumber="4807"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and set IV to the LowerBound.</span></CodeLine>
<Link id="l04808" /><CodeLine lineNumber="4808"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a> = &amp;<a href="/docs/api/namespaces/anonymous-lvcompare-cpp-/#a1ad6686ca7dcf67bc791fff07fdf7818abf50d5e661106d0abe925af3c2e6f7e7">Header</a>-&gt;front();</span></CodeLine>
<Link id="l04809" /><CodeLine lineNumber="4809"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(Phi);</span></CodeLine>
<Link id="l04810" /><CodeLine lineNumber="4810"><span class="doxyHighlight">  PI-&gt;setIncomingBlock(0, OuterCond);</span></CodeLine>
<Link id="l04811" /><CodeLine lineNumber="4811"><span class="doxyHighlight">  PI-&gt;setIncomingValue(0, LowerBound);</span></CodeLine>
<Link id="l04812" /><CodeLine lineNumber="4812"></CodeLine>
<Link id="l04813" /><CodeLine lineNumber="4813"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Then set the pre-header to jump to the OuterCond</span></CodeLine>
<Link id="l04814" /><CodeLine lineNumber="4814"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a> = PreHeader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l04815" /><CodeLine lineNumber="4815"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Br = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Term);</span></CodeLine>
<Link id="l04816" /><CodeLine lineNumber="4816"><span class="doxyHighlight">  Br-&gt;setSuccessor(0, OuterCond);</span></CodeLine>
<Link id="l04817" /><CodeLine lineNumber="4817"></CodeLine>
<Link id="l04818" /><CodeLine lineNumber="4818"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Modify the inner condition:</span></CodeLine>
<Link id="l04819" /><CodeLine lineNumber="4819"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#42; Use the UpperBound returned from the DynamicNext call.</span></CodeLine>
<Link id="l04820" /><CodeLine lineNumber="4820"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#42; jump to the loop outer loop when done with one of the inner loops.</span></CodeLine>
<Link id="l04821" /><CodeLine lineNumber="4821"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l04822" /><CodeLine lineNumber="4822"><span class="doxyHighlight">  UpperBound = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(IVTy, PUpperBound, </span><span class="doxyHighlightStringLiteral">&quot;ub&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04823" /><CodeLine lineNumber="4823"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;Comp = &amp;&#42;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e5c1b91bf5e2860398e3fa35c96b5af">GetInsertPoint</a>();</span></CodeLine>
<Link id="l04824" /><CodeLine lineNumber="4824"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CmpInst&gt;</a>(Comp);</span></CodeLine>
<Link id="l04825" /><CodeLine lineNumber="4825"><span class="doxyHighlight">  CI-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, UpperBound);</span></CodeLine>
<Link id="l04826" /><CodeLine lineNumber="4826"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Redirect the inner exit to branch to outer condition.</span></CodeLine>
<Link id="l04827" /><CodeLine lineNumber="4827"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a359237c780f7c8e40645575826da8a3c">Branch</a> = &amp;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>();</span></CodeLine>
<Link id="l04828" /><CodeLine lineNumber="4828"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Branch);</span></CodeLine>
<Link id="l04829" /><CodeLine lineNumber="4829"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI-&gt;getSuccessor(1) == Exit);</span></CodeLine>
<Link id="l04830" /><CodeLine lineNumber="4830"><span class="doxyHighlight">  BI-&gt;setSuccessor(1, OuterCond);</span></CodeLine>
<Link id="l04831" /><CodeLine lineNumber="4831"></CodeLine>
<Link id="l04832" /><CodeLine lineNumber="4832"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Call the &quot;fini&quot; function if &quot;ordered&quot; is present in wsloop directive.</span></CodeLine>
<Link id="l04833" /><CodeLine lineNumber="4833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ordered) &#123;</span></CodeLine>
<Link id="l04834" /><CodeLine lineNumber="4834"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(&amp;Latch-&gt;<a href="/docs/api/classes/llvm/basicblock/#a2d071e661a02790177ba05f62c7c27d1">back</a>());</span></CodeLine>
<Link id="l04835" /><CodeLine lineNumber="4835"><span class="doxyHighlight">    FunctionCallee DynamicFini = <a href="#a3d17252beff7921e40622170990c89ab">getKmpcForDynamicFiniForType</a>(IVTy, M, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04836" /><CodeLine lineNumber="4836"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(DynamicFini, &#123;SrcLoc, ThreadNum&#125;);</span></CodeLine>
<Link id="l04837" /><CodeLine lineNumber="4837"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04838" /><CodeLine lineNumber="4838"></CodeLine>
<Link id="l04839" /><CodeLine lineNumber="4839"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add the barrier if requested.</span></CodeLine>
<Link id="l04840" /><CodeLine lineNumber="4840"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsBarrier) &#123;</span></CodeLine>
<Link id="l04841" /><CodeLine lineNumber="4841"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(&amp;<a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39cacd4cef2a5a26efd5d75ecca95bc6ff24">Exit</a>-&gt;back());</span></CodeLine>
<Link id="l04842" /><CodeLine lineNumber="4842"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> BarrierIP =</span></CodeLine>
<Link id="l04843" /><CodeLine lineNumber="4843"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/openmpirbuilder/#abca6530c9099bd1b1c3e0a5c32381f07">createBarrier</a>(<a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>),</span></CodeLine>
<Link id="l04844" /><CodeLine lineNumber="4844"><span class="doxyHighlight">                      omp::Directive::OMPD&#95;for, </span><span class="doxyHighlightComment">/&#42; ForceSimpleCall &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04845" /><CodeLine lineNumber="4845"><span class="doxyHighlight">                      </span><span class="doxyHighlightComment">/&#42; CheckCancelFlag &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04846" /><CodeLine lineNumber="4846"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BarrierIP)</span></CodeLine>
<Link id="l04847" /><CodeLine lineNumber="4847"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BarrierIP.takeError();</span></CodeLine>
<Link id="l04848" /><CodeLine lineNumber="4848"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04849" /><CodeLine lineNumber="4849"></CodeLine>
<Link id="l04850" /><CodeLine lineNumber="4850"><span class="doxyHighlight">  CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a9ce55b05f8ad85126fc92eeeb35457c7">invalidate</a>();</span></CodeLine>
<Link id="l04851" /><CodeLine lineNumber="4851"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP;</span></CodeLine>
<Link id="l04852" /><CodeLine lineNumber="4852"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04853" /><CodeLine lineNumber="4853"></CodeLine>
<Link id="l04854" /><CodeLine lineNumber="4854"><span class="doxyHighlightComment">/// Redirect all edges that branch to \\p OldTarget to \\p NewTarget. That is,</span></CodeLine>
<Link id="l04855" /><CodeLine lineNumber="4855"><span class="doxyHighlightComment">/// after this \\p OldTarget will be orphaned.</span></CodeLine>
<Link id="l04856" /><CodeLine lineNumber="4856" lineLink="#abdcdbfc178873f5055fbcf98bad92f53"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#abdcdbfc178873f5055fbcf98bad92f53">redirectAllPredecessorsTo</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OldTarget,</span></CodeLine>
<Link id="l04857" /><CodeLine lineNumber="4857"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewTarget, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l04858" /><CodeLine lineNumber="4858"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(OldTarget)))</span></CodeLine>
<Link id="l04859" /><CodeLine lineNumber="4859"><span class="doxyHighlight">    <a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a>(Pred, NewTarget, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04860" /><CodeLine lineNumber="4860"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04861" /><CodeLine lineNumber="4861"></CodeLine>
<Link id="l04862" /><CodeLine lineNumber="4862"><span class="doxyHighlightComment">/// Determine which blocks in \\p BBs are reachable from outside and remove the</span></CodeLine>
<Link id="l04863" /><CodeLine lineNumber="4863"><span class="doxyHighlightComment">/// ones that are not reachable from the function.</span></CodeLine>
<Link id="l04864" /><CodeLine lineNumber="4864" lineLink="#af0ce60c4a958016f62ce78f1eda423af"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#af0ce60c4a958016f62ce78f1eda423af">removeUnusedBlocksFromParent</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;BasicBlock &#42;&gt;</a> BBs) &#123;</span></CodeLine>
<Link id="l04865" /><CodeLine lineNumber="4865"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 6&gt;</a> BBsToErase&#123;BBs.<a href="/docs/api/classes/llvm/arrayref/#aab36927882fbfdcbb860d87fd9c30da8">begin</a>(), BBs.<a href="/docs/api/classes/llvm/arrayref/#a7ca5197533a9c1fb8a2bd30587fcec6b">end</a>()&#125;;</span></CodeLine>
<Link id="l04866" /><CodeLine lineNumber="4866"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> HasRemainingUses = &#91;&amp;BBsToErase&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l04867" /><CodeLine lineNumber="4867"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : BB-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</span></CodeLine>
<Link id="l04868" /><CodeLine lineNumber="4868"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UseInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l04869" /><CodeLine lineNumber="4869"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UseInst)</span></CodeLine>
<Link id="l04870" /><CodeLine lineNumber="4870"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04871" /><CodeLine lineNumber="4871"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBsToErase.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(UseInst-&gt;getParent()))</span></CodeLine>
<Link id="l04872" /><CodeLine lineNumber="4872"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04873" /><CodeLine lineNumber="4873"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04874" /><CodeLine lineNumber="4874"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04875" /><CodeLine lineNumber="4875"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04876" /><CodeLine lineNumber="4876"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l04877" /><CodeLine lineNumber="4877"></CodeLine>
<Link id="l04878" /><CodeLine lineNumber="4878"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (BBsToErase.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a4323c151516742793df95050739d72ab">remove&#95;if</a>(HasRemainingUses)) &#123;</span></CodeLine>
<Link id="l04879" /><CodeLine lineNumber="4879"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Try again if anything was removed.</span></CodeLine>
<Link id="l04880" /><CodeLine lineNumber="4880"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04881" /><CodeLine lineNumber="4881"></CodeLine>
<Link id="l04882" /><CodeLine lineNumber="4882"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 7&gt;</a> BBVec(BBsToErase.<a href="/docs/api/classes/llvm/smallptrsetimpl/#abf73a826b5d6f739eb4af48ddf14c5b4">begin</a>(), BBsToErase.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a7004354fbee1c8cd74ed9001915e1db5">end</a>());</span></CodeLine>
<Link id="l04883" /><CodeLine lineNumber="4883"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#addf42fea14164ec994d4d517eaa56688">DeleteDeadBlocks</a>(BBVec);</span></CodeLine>
<Link id="l04884" /><CodeLine lineNumber="4884"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04885" /><CodeLine lineNumber="4885"></CodeLine>
<Link id="l04886" /><CodeLine lineNumber="4886"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;</span></CodeLine>
<Link id="l04887" /><CodeLine lineNumber="4887" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a08610118e213de1b759470f0eafb9b18"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#a08610118e213de1b759470f0eafb9b18">OpenMPIRBuilder::collapseLoops</a>(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;CanonicalLoopInfo &#42;&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>,</span></CodeLine>
<Link id="l04888" /><CodeLine lineNumber="4888"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> ComputeIP) &#123;</span></CodeLine>
<Link id="l04889" /><CodeLine lineNumber="4889"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>.size() &gt;= 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;At least one loop required&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04890" /><CodeLine lineNumber="4890"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> NumLoops = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>.size();</span></CodeLine>
<Link id="l04891" /><CodeLine lineNumber="4891"></CodeLine>
<Link id="l04892" /><CodeLine lineNumber="4892"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Nothing to do if there is already just one loop.</span></CodeLine>
<Link id="l04893" /><CodeLine lineNumber="4893"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumLoops == 1)</span></CodeLine>
<Link id="l04894" /><CodeLine lineNumber="4894"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>.front();</span></CodeLine>
<Link id="l04895" /><CodeLine lineNumber="4895"></CodeLine>
<Link id="l04896" /><CodeLine lineNumber="4896"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;Outermost = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>.front();</span></CodeLine>
<Link id="l04897" /><CodeLine lineNumber="4897"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;Innermost = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>.back();</span></CodeLine>
<Link id="l04898" /><CodeLine lineNumber="4898"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OrigPreheader = Outermost-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>();</span></CodeLine>
<Link id="l04899" /><CodeLine lineNumber="4899"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OrigAfter = Outermost-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a92d8bce979891dc43b6573e8cca2e58c">getAfter</a>();</span></CodeLine>
<Link id="l04900" /><CodeLine lineNumber="4900"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = OrigPreheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l04901" /><CodeLine lineNumber="4901"></CodeLine>
<Link id="l04902" /><CodeLine lineNumber="4902"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loop control blocks that may become orphaned later.</span></CodeLine>
<Link id="l04903" /><CodeLine lineNumber="4903"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 12&gt;</a> OldControlBBs;</span></CodeLine>
<Link id="l04904" /><CodeLine lineNumber="4904"><span class="doxyHighlight">  OldControlBBs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(6 &#42; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>.size());</span></CodeLine>
<Link id="l04905" /><CodeLine lineNumber="4905"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;<a href="/docs/api/classes/llvm/loop">Loop</a> : <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>)</span></CodeLine>
<Link id="l04906" /><CodeLine lineNumber="4906"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loop">Loop</a>-&gt;collectControlBlocks(OldControlBBs);</span></CodeLine>
<Link id="l04907" /><CodeLine lineNumber="4907"></CodeLine>
<Link id="l04908" /><CodeLine lineNumber="4908"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Setup the IRBuilder for inserting the trip count computation.</span></CodeLine>
<Link id="l04909" /><CodeLine lineNumber="4909"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04910" /><CodeLine lineNumber="4910"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ComputeIP.<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint/#a85b9635b21610f18b51007437bcc26cf">isSet</a>())</span></CodeLine>
<Link id="l04911" /><CodeLine lineNumber="4911"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(ComputeIP);</span></CodeLine>
<Link id="l04912" /><CodeLine lineNumber="4912"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04913" /><CodeLine lineNumber="4913"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(Outermost-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac72ebc430ef7dcf1791c66080ddedd9d">getPreheaderIP</a>());</span></CodeLine>
<Link id="l04914" /><CodeLine lineNumber="4914"></CodeLine>
<Link id="l04915" /><CodeLine lineNumber="4915"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Derive the collapsed&#39; loop trip count.</span></CodeLine>
<Link id="l04916" /><CodeLine lineNumber="4916"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Find common/largest indvar type.</span></CodeLine>
<Link id="l04917" /><CodeLine lineNumber="4917"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CollapsedTripCount = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04918" /><CodeLine lineNumber="4918"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;L : <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>) &#123;</span></CodeLine>
<Link id="l04919" /><CodeLine lineNumber="4919"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L-&gt;isValid() &amp;&amp;</span></CodeLine>
<Link id="l04920" /><CodeLine lineNumber="4920"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;All loops to collapse must be valid canonical loops&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04921" /><CodeLine lineNumber="4921"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;OrigTripCount = L-&gt;getTripCount();</span></CodeLine>
<Link id="l04922" /><CodeLine lineNumber="4922"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CollapsedTripCount) &#123;</span></CodeLine>
<Link id="l04923" /><CodeLine lineNumber="4923"><span class="doxyHighlight">      CollapsedTripCount = OrigTripCount;</span></CodeLine>
<Link id="l04924" /><CodeLine lineNumber="4924"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04925" /><CodeLine lineNumber="4925"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04926" /><CodeLine lineNumber="4926"></CodeLine>
<Link id="l04927" /><CodeLine lineNumber="4927"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Enable UndefinedSanitizer to diagnose an overflow here.</span></CodeLine>
<Link id="l04928" /><CodeLine lineNumber="4928"><span class="doxyHighlight">    CollapsedTripCount = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aecd40f9a16dc0ef1e0bc416599f89277">CreateMul</a>(CollapsedTripCount, OrigTripCount,</span></CodeLine>
<Link id="l04929" /><CodeLine lineNumber="4929"><span class="doxyHighlight">                                           &#123;&#125;, </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04930" /><CodeLine lineNumber="4930"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04931" /><CodeLine lineNumber="4931"></CodeLine>
<Link id="l04932" /><CodeLine lineNumber="4932"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the collapsed loop control flow.</span></CodeLine>
<Link id="l04933" /><CodeLine lineNumber="4933"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;Result =</span></CodeLine>
<Link id="l04934" /><CodeLine lineNumber="4934"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#a445fa52d77040bccb16bfea111234a2e">createLoopSkeleton</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CollapsedTripCount, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l04935" /><CodeLine lineNumber="4935"><span class="doxyHighlight">                         OrigPreheader-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>(), OrigAfter, </span><span class="doxyHighlightStringLiteral">&quot;collapsed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04936" /><CodeLine lineNumber="4936"></CodeLine>
<Link id="l04937" /><CodeLine lineNumber="4937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build the collapsed loop body code.</span></CodeLine>
<Link id="l04938" /><CodeLine lineNumber="4938"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Start with deriving the input loop induction variables from the collapsed</span></CodeLine>
<Link id="l04939" /><CodeLine lineNumber="4939"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// one, using a divmod scheme. To preserve the original loops&#39; order, the</span></CodeLine>
<Link id="l04940" /><CodeLine lineNumber="4940"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// innermost loop use the least significant bits.</span></CodeLine>
<Link id="l04941" /><CodeLine lineNumber="4941"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(Result-&gt;getBodyIP());</span></CodeLine>
<Link id="l04942" /><CodeLine lineNumber="4942"></CodeLine>
<Link id="l04943" /><CodeLine lineNumber="4943"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Leftover = Result-&gt;getIndVar();</span></CodeLine>
<Link id="l04944" /><CodeLine lineNumber="4944"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> NewIndVars;</span></CodeLine>
<Link id="l04945" /><CodeLine lineNumber="4945"><span class="doxyHighlight">  NewIndVars.<a href="/docs/api/classes/llvm/smallvectorimpl/#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(NumLoops);</span></CodeLine>
<Link id="l04946" /><CodeLine lineNumber="4946"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = NumLoops - 1; i &gt;= 1; --i) &#123;</span></CodeLine>
<Link id="l04947" /><CodeLine lineNumber="4947"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;OrigTripCount = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>&#91;i&#93;-&gt;getTripCount();</span></CodeLine>
<Link id="l04948" /><CodeLine lineNumber="4948"></CodeLine>
<Link id="l04949" /><CodeLine lineNumber="4949"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewIndVar = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae884a856c5f31ab8fcf64f81db130dcd">CreateURem</a>(Leftover, OrigTripCount);</span></CodeLine>
<Link id="l04950" /><CodeLine lineNumber="4950"><span class="doxyHighlight">    NewIndVars&#91;i&#93; = NewIndVar;</span></CodeLine>
<Link id="l04951" /><CodeLine lineNumber="4951"></CodeLine>
<Link id="l04952" /><CodeLine lineNumber="4952"><span class="doxyHighlight">    Leftover = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a6b68047eda0d6d6eec5dd564ed1a22b8">CreateUDiv</a>(Leftover, OrigTripCount);</span></CodeLine>
<Link id="l04953" /><CodeLine lineNumber="4953"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04954" /><CodeLine lineNumber="4954"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Outermost loop gets all the remaining bits.</span></CodeLine>
<Link id="l04955" /><CodeLine lineNumber="4955"><span class="doxyHighlight">  NewIndVars&#91;0&#93; = Leftover;</span></CodeLine>
<Link id="l04956" /><CodeLine lineNumber="4956"></CodeLine>
<Link id="l04957" /><CodeLine lineNumber="4957"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Construct the loop body control flow.</span></CodeLine>
<Link id="l04958" /><CodeLine lineNumber="4958"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We progressively construct the branch structure following in direction of</span></CodeLine>
<Link id="l04959" /><CodeLine lineNumber="4959"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the control flow, from the leading in-between code, the loop nest body, the</span></CodeLine>
<Link id="l04960" /><CodeLine lineNumber="4960"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// trailing in-between code, and rejoining the collapsed loop&#39;s latch.</span></CodeLine>
<Link id="l04961" /><CodeLine lineNumber="4961"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ContinueBlock and ContinuePred keep track of the source(s) of next edge. If</span></CodeLine>
<Link id="l04962" /><CodeLine lineNumber="4962"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the ContinueBlock is set, continue with that block. If ContinuePred, use</span></CodeLine>
<Link id="l04963" /><CodeLine lineNumber="4963"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// its predecessors as sources.</span></CodeLine>
<Link id="l04964" /><CodeLine lineNumber="4964"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ContinueBlock = Result-&gt;getBody();</span></CodeLine>
<Link id="l04965" /><CodeLine lineNumber="4965"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ContinuePred = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04966" /><CodeLine lineNumber="4966"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ContinueWith = &#91;&amp;ContinueBlock, &amp;ContinuePred, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dest,</span></CodeLine>
<Link id="l04967" /><CodeLine lineNumber="4967"><span class="doxyHighlight">                                                          <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NextSrc) &#123;</span></CodeLine>
<Link id="l04968" /><CodeLine lineNumber="4968"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ContinueBlock)</span></CodeLine>
<Link id="l04969" /><CodeLine lineNumber="4969"><span class="doxyHighlight">      <a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a>(ContinueBlock, Dest, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04970" /><CodeLine lineNumber="4970"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04971" /><CodeLine lineNumber="4971"><span class="doxyHighlight">      <a href="#abdcdbfc178873f5055fbcf98bad92f53">redirectAllPredecessorsTo</a>(ContinuePred, Dest, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04972" /><CodeLine lineNumber="4972"></CodeLine>
<Link id="l04973" /><CodeLine lineNumber="4973"><span class="doxyHighlight">    ContinueBlock = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04974" /><CodeLine lineNumber="4974"><span class="doxyHighlight">    ContinuePred = NextSrc;</span></CodeLine>
<Link id="l04975" /><CodeLine lineNumber="4975"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l04976" /><CodeLine lineNumber="4976"></CodeLine>
<Link id="l04977" /><CodeLine lineNumber="4977"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The code before the nested loop of each level.</span></CodeLine>
<Link id="l04978" /><CodeLine lineNumber="4978"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Because we are sinking it into the nest, it will be executed more often</span></CodeLine>
<Link id="l04979" /><CodeLine lineNumber="4979"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that the original loop. More sophisticated schemes could keep track of what</span></CodeLine>
<Link id="l04980" /><CodeLine lineNumber="4980"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the in-between code is and instantiate it only once per thread.</span></CodeLine>
<Link id="l04981" /><CodeLine lineNumber="4981"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> i = 0; i &lt; NumLoops - 1; ++i)</span></CodeLine>
<Link id="l04982" /><CodeLine lineNumber="4982"><span class="doxyHighlight">    ContinueWith(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>&#91;i&#93;-&gt;getBody(), <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>&#91;i + 1&#93;-&gt;getHeader());</span></CodeLine>
<Link id="l04983" /><CodeLine lineNumber="4983"></CodeLine>
<Link id="l04984" /><CodeLine lineNumber="4984"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Connect the loop nest body.</span></CodeLine>
<Link id="l04985" /><CodeLine lineNumber="4985"><span class="doxyHighlight">  ContinueWith(Innermost-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>(), Innermost-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac37a6cf77f6f82b6bb28af4d9c8626d0">getLatch</a>());</span></CodeLine>
<Link id="l04986" /><CodeLine lineNumber="4986"></CodeLine>
<Link id="l04987" /><CodeLine lineNumber="4987"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The code after the nested loop at each level.</span></CodeLine>
<Link id="l04988" /><CodeLine lineNumber="4988"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> i = NumLoops - 1; i &gt; 0; --i)</span></CodeLine>
<Link id="l04989" /><CodeLine lineNumber="4989"><span class="doxyHighlight">    ContinueWith(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>&#91;i&#93;-&gt;getAfter(), <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>&#91;i - 1&#93;-&gt;getLatch());</span></CodeLine>
<Link id="l04990" /><CodeLine lineNumber="4990"></CodeLine>
<Link id="l04991" /><CodeLine lineNumber="4991"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Connect the finished loop to the collapsed loop latch.</span></CodeLine>
<Link id="l04992" /><CodeLine lineNumber="4992"><span class="doxyHighlight">  ContinueWith(Result-&gt;getLatch(), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04993" /><CodeLine lineNumber="4993"></CodeLine>
<Link id="l04994" /><CodeLine lineNumber="4994"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace the input loops with the new collapsed loop.</span></CodeLine>
<Link id="l04995" /><CodeLine lineNumber="4995"><span class="doxyHighlight">  <a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a>(Outermost-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>(), Result-&gt;getPreheader(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04996" /><CodeLine lineNumber="4996"><span class="doxyHighlight">  <a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a>(Result-&gt;getAfter(), Outermost-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a92d8bce979891dc43b6573e8cca2e58c">getAfter</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l04997" /><CodeLine lineNumber="4997"></CodeLine>
<Link id="l04998" /><CodeLine lineNumber="4998"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace the input loop indvars with the derived ones.</span></CodeLine>
<Link id="l04999" /><CodeLine lineNumber="4999"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> i = 0; i &lt; NumLoops; ++i)</span></CodeLine>
<Link id="l05000" /><CodeLine lineNumber="5000"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>&#91;i&#93;-&gt;getIndVar()-&gt;replaceAllUsesWith(NewIndVars&#91;i&#93;);</span></CodeLine>
<Link id="l05001" /><CodeLine lineNumber="5001"></CodeLine>
<Link id="l05002" /><CodeLine lineNumber="5002"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove unused parts of the input loops.</span></CodeLine>
<Link id="l05003" /><CodeLine lineNumber="5003"><span class="doxyHighlight">  <a href="#af0ce60c4a958016f62ce78f1eda423af">removeUnusedBlocksFromParent</a>(OldControlBBs);</span></CodeLine>
<Link id="l05004" /><CodeLine lineNumber="5004"></CodeLine>
<Link id="l05005" /><CodeLine lineNumber="5005"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;L : <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>)</span></CodeLine>
<Link id="l05006" /><CodeLine lineNumber="5006"><span class="doxyHighlight">    L-&gt;invalidate();</span></CodeLine>
<Link id="l05007" /><CodeLine lineNumber="5007"></CodeLine>
<Link id="l05008" /><CodeLine lineNumber="5008"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l05009" /><CodeLine lineNumber="5009"><span class="doxyHighlight">  Result-&gt;assertOK();</span></CodeLine>
<Link id="l05010" /><CodeLine lineNumber="5010"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l05011" /><CodeLine lineNumber="5011"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l05012" /><CodeLine lineNumber="5012"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05013" /><CodeLine lineNumber="5013"></CodeLine>
<Link id="l05014" /><CodeLine lineNumber="5014"><span class="doxyHighlight">std::vector&lt;CanonicalLoopInfo &#42;&gt;</span></CodeLine>
<Link id="l05015" /><CodeLine lineNumber="5015" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a76e12ec076e7af4be7b8b77a5d53d3fc"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#a76e12ec076e7af4be7b8b77a5d53d3fc">OpenMPIRBuilder::tileLoops</a>(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;CanonicalLoopInfo &#42;&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>,</span></CodeLine>
<Link id="l05016" /><CodeLine lineNumber="5016"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value &#42;&gt;</a> TileSizes) &#123;</span></CodeLine>
<Link id="l05017" /><CodeLine lineNumber="5017"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TileSizes.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>() == <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>.size() &amp;&amp;</span></CodeLine>
<Link id="l05018" /><CodeLine lineNumber="5018"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Must pass as many tile sizes as there are loops&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05019" /><CodeLine lineNumber="5019"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> NumLoops = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>.size();</span></CodeLine>
<Link id="l05020" /><CodeLine lineNumber="5020"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumLoops &gt;= 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;At least one loop to tile required&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05021" /><CodeLine lineNumber="5021"></CodeLine>
<Link id="l05022" /><CodeLine lineNumber="5022"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;OutermostLoop = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>.front();</span></CodeLine>
<Link id="l05023" /><CodeLine lineNumber="5023"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;InnermostLoop = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>.back();</span></CodeLine>
<Link id="l05024" /><CodeLine lineNumber="5024"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = OutermostLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l05025" /><CodeLine lineNumber="5025"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InnerEnter = InnermostLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>();</span></CodeLine>
<Link id="l05026" /><CodeLine lineNumber="5026"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InnerLatch = InnermostLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac37a6cf77f6f82b6bb28af4d9c8626d0">getLatch</a>();</span></CodeLine>
<Link id="l05027" /><CodeLine lineNumber="5027"></CodeLine>
<Link id="l05028" /><CodeLine lineNumber="5028"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loop control blocks that may become orphaned later.</span></CodeLine>
<Link id="l05029" /><CodeLine lineNumber="5029"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 12&gt;</a> OldControlBBs;</span></CodeLine>
<Link id="l05030" /><CodeLine lineNumber="5030"><span class="doxyHighlight">  OldControlBBs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(6 &#42; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>.size());</span></CodeLine>
<Link id="l05031" /><CodeLine lineNumber="5031"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;<a href="/docs/api/classes/llvm/loop">Loop</a> : <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>)</span></CodeLine>
<Link id="l05032" /><CodeLine lineNumber="5032"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loop">Loop</a>-&gt;collectControlBlocks(OldControlBBs);</span></CodeLine>
<Link id="l05033" /><CodeLine lineNumber="5033"></CodeLine>
<Link id="l05034" /><CodeLine lineNumber="5034"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect original trip counts and induction variable to be accessible by</span></CodeLine>
<Link id="l05035" /><CodeLine lineNumber="5035"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// index. Also, the structure of the original loops is not preserved during</span></CodeLine>
<Link id="l05036" /><CodeLine lineNumber="5036"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the construction of the tiled loops, so do it before we scavenge the BBs of</span></CodeLine>
<Link id="l05037" /><CodeLine lineNumber="5037"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// any original CanonicalLoopInfo.</span></CodeLine>
<Link id="l05038" /><CodeLine lineNumber="5038"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> OrigTripCounts, OrigIndVars;</span></CodeLine>
<Link id="l05039" /><CodeLine lineNumber="5039"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;L : <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>) &#123;</span></CodeLine>
<Link id="l05040" /><CodeLine lineNumber="5040"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L-&gt;isValid() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;All input loops must be valid canonical loops&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05041" /><CodeLine lineNumber="5041"><span class="doxyHighlight">    OrigTripCounts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(L-&gt;getTripCount());</span></CodeLine>
<Link id="l05042" /><CodeLine lineNumber="5042"><span class="doxyHighlight">    OrigIndVars.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(L-&gt;getIndVar());</span></CodeLine>
<Link id="l05043" /><CodeLine lineNumber="5043"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05044" /><CodeLine lineNumber="5044"></CodeLine>
<Link id="l05045" /><CodeLine lineNumber="5045"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect the code between loop headers. These may contain SSA definitions</span></CodeLine>
<Link id="l05046" /><CodeLine lineNumber="5046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that are used in the loop nest body. To be usable with in the innermost</span></CodeLine>
<Link id="l05047" /><CodeLine lineNumber="5047"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// body, these BasicBlocks will be sunk into the loop nest body. That is,</span></CodeLine>
<Link id="l05048" /><CodeLine lineNumber="5048"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// these instructions may be executed more often than before the tiling.</span></CodeLine>
<Link id="l05049" /><CodeLine lineNumber="5049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: It would be sufficient to only sink them into body of the</span></CodeLine>
<Link id="l05050" /><CodeLine lineNumber="5050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// corresponding tile loop.</span></CodeLine>
<Link id="l05051" /><CodeLine lineNumber="5051"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;BasicBlock &#42;, BasicBlock &#42;&gt;</a>, 4&gt; InbetweenCode;</span></CodeLine>
<Link id="l05052" /><CodeLine lineNumber="5052"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = 0; i &lt; NumLoops - 1; ++i) &#123;</span></CodeLine>
<Link id="l05053" /><CodeLine lineNumber="5053"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;Surrounding = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>&#91;i&#93;;</span></CodeLine>
<Link id="l05054" /><CodeLine lineNumber="5054"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;Nested = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>&#91;i + 1&#93;;</span></CodeLine>
<Link id="l05055" /><CodeLine lineNumber="5055"></CodeLine>
<Link id="l05056" /><CodeLine lineNumber="5056"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EnterBB = Surrounding-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>();</span></CodeLine>
<Link id="l05057" /><CodeLine lineNumber="5057"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBB = Nested-&gt;getHeader();</span></CodeLine>
<Link id="l05058" /><CodeLine lineNumber="5058"><span class="doxyHighlight">    InbetweenCode.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(EnterBB, ExitBB);</span></CodeLine>
<Link id="l05059" /><CodeLine lineNumber="5059"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05060" /><CodeLine lineNumber="5060"></CodeLine>
<Link id="l05061" /><CodeLine lineNumber="5061"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute the trip counts of the floor loops.</span></CodeLine>
<Link id="l05062" /><CodeLine lineNumber="5062"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l05063" /><CodeLine lineNumber="5063"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(OutermostLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac72ebc430ef7dcf1791c66080ddedd9d">getPreheaderIP</a>());</span></CodeLine>
<Link id="l05064" /><CodeLine lineNumber="5064"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> FloorCount, FloorRems;</span></CodeLine>
<Link id="l05065" /><CodeLine lineNumber="5065"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = 0; i &lt; NumLoops; ++i) &#123;</span></CodeLine>
<Link id="l05066" /><CodeLine lineNumber="5066"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/lowermatrixintrinsics-cpp/#af1138294df67ee063ee3b7632a2f843f">TileSize</a> = TileSizes&#91;i&#93;;</span></CodeLine>
<Link id="l05067" /><CodeLine lineNumber="5067"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;OrigTripCount = OrigTripCounts&#91;i&#93;;</span></CodeLine>
<Link id="l05068" /><CodeLine lineNumber="5068"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;IVType = OrigTripCount-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l05069" /><CodeLine lineNumber="5069"></CodeLine>
<Link id="l05070" /><CodeLine lineNumber="5070"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;FloorTripCount = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a6b68047eda0d6d6eec5dd564ed1a22b8">CreateUDiv</a>(OrigTripCount, <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/lowermatrixintrinsics-cpp/#af1138294df67ee063ee3b7632a2f843f">TileSize</a>);</span></CodeLine>
<Link id="l05071" /><CodeLine lineNumber="5071"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;FloorTripRem = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae884a856c5f31ab8fcf64f81db130dcd">CreateURem</a>(OrigTripCount, <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/lowermatrixintrinsics-cpp/#af1138294df67ee063ee3b7632a2f843f">TileSize</a>);</span></CodeLine>
<Link id="l05072" /><CodeLine lineNumber="5072"></CodeLine>
<Link id="l05073" /><CodeLine lineNumber="5073"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// 0 if tripcount divides the tilesize, 1 otherwise.</span></CodeLine>
<Link id="l05074" /><CodeLine lineNumber="5074"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// 1 means we need an additional iteration for a partial tile.</span></CodeLine>
<Link id="l05075" /><CodeLine lineNumber="5075"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l05076" /><CodeLine lineNumber="5076"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Unfortunately we cannot just use the roundup-formula</span></CodeLine>
<Link id="l05077" /><CodeLine lineNumber="5077"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   (tripcount + tilesize - 1)/tilesize</span></CodeLine>
<Link id="l05078" /><CodeLine lineNumber="5078"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// because the summation might overflow. We do not want introduce undefined</span></CodeLine>
<Link id="l05079" /><CodeLine lineNumber="5079"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// behavior when the untiled loop nest did not.</span></CodeLine>
<Link id="l05080" /><CodeLine lineNumber="5080"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;FloorTripOverflow =</span></CodeLine>
<Link id="l05081" /><CodeLine lineNumber="5081"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a6ef1729b04a4fbd6c6f27787cdd0e813">CreateICmpNE</a>(FloorTripRem, ConstantInt::get(IVType, 0));</span></CodeLine>
<Link id="l05082" /><CodeLine lineNumber="5082"></CodeLine>
<Link id="l05083" /><CodeLine lineNumber="5083"><span class="doxyHighlight">    FloorTripOverflow = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9e6950f7f17700d5c0d61ad0b846ec5c">CreateZExt</a>(FloorTripOverflow, IVType);</span></CodeLine>
<Link id="l05084" /><CodeLine lineNumber="5084"><span class="doxyHighlight">    FloorTripCount =</span></CodeLine>
<Link id="l05085" /><CodeLine lineNumber="5085"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(FloorTripCount, FloorTripOverflow,</span></CodeLine>
<Link id="l05086" /><CodeLine lineNumber="5086"><span class="doxyHighlight">                          </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;floor&quot;</span><span class="doxyHighlight"> + <a href="/docs/api/classes/llvm/twine">Twine</a>(i) + </span><span class="doxyHighlightStringLiteral">&quot;.tripcount&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05087" /><CodeLine lineNumber="5087"></CodeLine>
<Link id="l05088" /><CodeLine lineNumber="5088"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remember some values for later use.</span></CodeLine>
<Link id="l05089" /><CodeLine lineNumber="5089"><span class="doxyHighlight">    FloorCount.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FloorTripCount);</span></CodeLine>
<Link id="l05090" /><CodeLine lineNumber="5090"><span class="doxyHighlight">    FloorRems.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FloorTripRem);</span></CodeLine>
<Link id="l05091" /><CodeLine lineNumber="5091"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05092" /><CodeLine lineNumber="5092"></CodeLine>
<Link id="l05093" /><CodeLine lineNumber="5093"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate the new loop nest, from the outermost to the innermost.</span></CodeLine>
<Link id="l05094" /><CodeLine lineNumber="5094"><span class="doxyHighlight">  std::vector&lt;CanonicalLoopInfo &#42;&gt; Result;</span></CodeLine>
<Link id="l05095" /><CodeLine lineNumber="5095"><span class="doxyHighlight">  Result.reserve(NumLoops &#42; 2);</span></CodeLine>
<Link id="l05096" /><CodeLine lineNumber="5096"></CodeLine>
<Link id="l05097" /><CodeLine lineNumber="5097"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The basic block of the surrounding loop that enters the nest generated</span></CodeLine>
<Link id="l05098" /><CodeLine lineNumber="5098"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop.</span></CodeLine>
<Link id="l05099" /><CodeLine lineNumber="5099"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Enter = OutermostLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>();</span></CodeLine>
<Link id="l05100" /><CodeLine lineNumber="5100"></CodeLine>
<Link id="l05101" /><CodeLine lineNumber="5101"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The basic block of the surrounding loop where the inner code should</span></CodeLine>
<Link id="l05102" /><CodeLine lineNumber="5102"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// continue.</span></CodeLine>
<Link id="l05103" /><CodeLine lineNumber="5103"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#ada72881d16e555ca8525a916364048f9a69820949e2fb6d1d719487d27f0df883">Continue</a> = OutermostLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a92d8bce979891dc43b6573e8cca2e58c">getAfter</a>();</span></CodeLine>
<Link id="l05104" /><CodeLine lineNumber="5104"></CodeLine>
<Link id="l05105" /><CodeLine lineNumber="5105"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Where the next loop basic block should be inserted.</span></CodeLine>
<Link id="l05106" /><CodeLine lineNumber="5106"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OutroInsertBefore = InnermostLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad3bf46daef8ce8176a68bcec0320dfd3">getExit</a>();</span></CodeLine>
<Link id="l05107" /><CodeLine lineNumber="5107"></CodeLine>
<Link id="l05108" /><CodeLine lineNumber="5108"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EmbeddNewLoop =</span></CodeLine>
<Link id="l05109" /><CodeLine lineNumber="5109"><span class="doxyHighlight">      &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, InnerEnter, &amp;Enter, &amp;<a href="/docs/api/namespaces/llvm/#ada72881d16e555ca8525a916364048f9a69820949e2fb6d1d719487d27f0df883">Continue</a>, &amp;OutroInsertBefore&#93;(</span></CodeLine>
<Link id="l05110" /><CodeLine lineNumber="5110"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;TripCount, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name) -&gt; <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42; &#123;</span></CodeLine>
<Link id="l05111" /><CodeLine lineNumber="5111"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;EmbeddedLoop = <a href="/docs/api/classes/llvm/openmpirbuilder/#a445fa52d77040bccb16bfea111234a2e">createLoopSkeleton</a>(</span></CodeLine>
<Link id="l05112" /><CodeLine lineNumber="5112"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TripCount, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, InnerEnter, OutroInsertBefore, Name);</span></CodeLine>
<Link id="l05113" /><CodeLine lineNumber="5113"><span class="doxyHighlight">    <a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a>(Enter, EmbeddedLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l05114" /><CodeLine lineNumber="5114"><span class="doxyHighlight">    <a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a>(EmbeddedLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a92d8bce979891dc43b6573e8cca2e58c">getAfter</a>(), <a href="/docs/api/namespaces/llvm/#ada72881d16e555ca8525a916364048f9a69820949e2fb6d1d719487d27f0df883">Continue</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l05115" /><CodeLine lineNumber="5115"></CodeLine>
<Link id="l05116" /><CodeLine lineNumber="5116"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Setup the position where the next embedded loop connects to this loop.</span></CodeLine>
<Link id="l05117" /><CodeLine lineNumber="5117"><span class="doxyHighlight">    Enter = EmbeddedLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>();</span></CodeLine>
<Link id="l05118" /><CodeLine lineNumber="5118"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ada72881d16e555ca8525a916364048f9a69820949e2fb6d1d719487d27f0df883">Continue</a> = EmbeddedLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac37a6cf77f6f82b6bb28af4d9c8626d0">getLatch</a>();</span></CodeLine>
<Link id="l05119" /><CodeLine lineNumber="5119"><span class="doxyHighlight">    OutroInsertBefore = EmbeddedLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac37a6cf77f6f82b6bb28af4d9c8626d0">getLatch</a>();</span></CodeLine>
<Link id="l05120" /><CodeLine lineNumber="5120"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EmbeddedLoop;</span></CodeLine>
<Link id="l05121" /><CodeLine lineNumber="5121"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l05122" /><CodeLine lineNumber="5122"></CodeLine>
<Link id="l05123" /><CodeLine lineNumber="5123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EmbeddNewLoops = &#91;&amp;Result, &amp;EmbeddNewLoop&#93;(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value &#42;&gt;</a> TripCounts,</span></CodeLine>
<Link id="l05124" /><CodeLine lineNumber="5124"><span class="doxyHighlight">                                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;NameBase) &#123;</span></CodeLine>
<Link id="l05125" /><CodeLine lineNumber="5125"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(TripCounts)) &#123;</span></CodeLine>
<Link id="l05126" /><CodeLine lineNumber="5126"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;EmbeddedLoop =</span></CodeLine>
<Link id="l05127" /><CodeLine lineNumber="5127"><span class="doxyHighlight">          EmbeddNewLoop(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.value(), NameBase + <a href="/docs/api/classes/llvm/twine">Twine</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.index()));</span></CodeLine>
<Link id="l05128" /><CodeLine lineNumber="5128"><span class="doxyHighlight">      Result.push&#95;back(EmbeddedLoop);</span></CodeLine>
<Link id="l05129" /><CodeLine lineNumber="5129"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05130" /><CodeLine lineNumber="5130"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l05131" /><CodeLine lineNumber="5131"></CodeLine>
<Link id="l05132" /><CodeLine lineNumber="5132"><span class="doxyHighlight">  EmbeddNewLoops(FloorCount, </span><span class="doxyHighlightStringLiteral">&quot;floor&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05133" /><CodeLine lineNumber="5133"></CodeLine>
<Link id="l05134" /><CodeLine lineNumber="5134"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Within the innermost floor loop, emit the code that computes the tile</span></CodeLine>
<Link id="l05135" /><CodeLine lineNumber="5135"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sizes.</span></CodeLine>
<Link id="l05136" /><CodeLine lineNumber="5136"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Enter-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l05137" /><CodeLine lineNumber="5137"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> TileCounts;</span></CodeLine>
<Link id="l05138" /><CodeLine lineNumber="5138"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = 0; i &lt; NumLoops; ++i) &#123;</span></CodeLine>
<Link id="l05139" /><CodeLine lineNumber="5139"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;FloorLoop = Result&#91;i&#93;;</span></CodeLine>
<Link id="l05140" /><CodeLine lineNumber="5140"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/lowermatrixintrinsics-cpp/#af1138294df67ee063ee3b7632a2f843f">TileSize</a> = TileSizes&#91;i&#93;;</span></CodeLine>
<Link id="l05141" /><CodeLine lineNumber="5141"></CodeLine>
<Link id="l05142" /><CodeLine lineNumber="5142"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;FloorIsEpilogue =</span></CodeLine>
<Link id="l05143" /><CodeLine lineNumber="5143"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(FloorLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#af4131f5f461f1138483addfd7cd7f579">getIndVar</a>(), FloorCount&#91;i&#93;);</span></CodeLine>
<Link id="l05144" /><CodeLine lineNumber="5144"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;TileTripCount =</span></CodeLine>
<Link id="l05145" /><CodeLine lineNumber="5145"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(FloorIsEpilogue, FloorRems&#91;i&#93;, <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/lowermatrixintrinsics-cpp/#af1138294df67ee063ee3b7632a2f843f">TileSize</a>);</span></CodeLine>
<Link id="l05146" /><CodeLine lineNumber="5146"></CodeLine>
<Link id="l05147" /><CodeLine lineNumber="5147"><span class="doxyHighlight">    TileCounts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(TileTripCount);</span></CodeLine>
<Link id="l05148" /><CodeLine lineNumber="5148"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05149" /><CodeLine lineNumber="5149"></CodeLine>
<Link id="l05150" /><CodeLine lineNumber="5150"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the tile loops.</span></CodeLine>
<Link id="l05151" /><CodeLine lineNumber="5151"><span class="doxyHighlight">  EmbeddNewLoops(TileCounts, </span><span class="doxyHighlightStringLiteral">&quot;tile&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05152" /><CodeLine lineNumber="5152"></CodeLine>
<Link id="l05153" /><CodeLine lineNumber="5153"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert the inbetween code into the body.</span></CodeLine>
<Link id="l05154" /><CodeLine lineNumber="5154"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BodyEnter = Enter;</span></CodeLine>
<Link id="l05155" /><CodeLine lineNumber="5155"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BodyEntered = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05156" /><CodeLine lineNumber="5156"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (std::pair&lt;BasicBlock &#42;, BasicBlock &#42;&gt; <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : InbetweenCode) &#123;</span></CodeLine>
<Link id="l05157" /><CodeLine lineNumber="5157"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EnterBB = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.first;</span></CodeLine>
<Link id="l05158" /><CodeLine lineNumber="5158"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBB = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.second;</span></CodeLine>
<Link id="l05159" /><CodeLine lineNumber="5159"></CodeLine>
<Link id="l05160" /><CodeLine lineNumber="5160"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BodyEnter)</span></CodeLine>
<Link id="l05161" /><CodeLine lineNumber="5161"><span class="doxyHighlight">      <a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a>(BodyEnter, EnterBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l05162" /><CodeLine lineNumber="5162"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05163" /><CodeLine lineNumber="5163"><span class="doxyHighlight">      <a href="#abdcdbfc178873f5055fbcf98bad92f53">redirectAllPredecessorsTo</a>(BodyEntered, EnterBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l05164" /><CodeLine lineNumber="5164"></CodeLine>
<Link id="l05165" /><CodeLine lineNumber="5165"><span class="doxyHighlight">    BodyEnter = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05166" /><CodeLine lineNumber="5166"><span class="doxyHighlight">    BodyEntered = ExitBB;</span></CodeLine>
<Link id="l05167" /><CodeLine lineNumber="5167"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05168" /><CodeLine lineNumber="5168"></CodeLine>
<Link id="l05169" /><CodeLine lineNumber="5169"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Append the original loop nest body into the generated loop nest body.</span></CodeLine>
<Link id="l05170" /><CodeLine lineNumber="5170"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BodyEnter)</span></CodeLine>
<Link id="l05171" /><CodeLine lineNumber="5171"><span class="doxyHighlight">    <a href="#a3057c2b7e1e25de160497b1ef3985c2a">redirectTo</a>(BodyEnter, InnerEnter, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l05172" /><CodeLine lineNumber="5172"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05173" /><CodeLine lineNumber="5173"><span class="doxyHighlight">    <a href="#abdcdbfc178873f5055fbcf98bad92f53">redirectAllPredecessorsTo</a>(BodyEntered, InnerEnter, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l05174" /><CodeLine lineNumber="5174"><span class="doxyHighlight">  <a href="#abdcdbfc178873f5055fbcf98bad92f53">redirectAllPredecessorsTo</a>(InnerLatch, <a href="/docs/api/namespaces/llvm/#ada72881d16e555ca8525a916364048f9a69820949e2fb6d1d719487d27f0df883">Continue</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l05175" /><CodeLine lineNumber="5175"></CodeLine>
<Link id="l05176" /><CodeLine lineNumber="5176"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace the original induction variable with an induction variable computed</span></CodeLine>
<Link id="l05177" /><CodeLine lineNumber="5177"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from the tile and floor induction variables.</span></CodeLine>
<Link id="l05178" /><CodeLine lineNumber="5178"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(Result.back()-&gt;getBodyIP());</span></CodeLine>
<Link id="l05179" /><CodeLine lineNumber="5179"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = 0; i &lt; NumLoops; ++i) &#123;</span></CodeLine>
<Link id="l05180" /><CodeLine lineNumber="5180"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;FloorLoop = Result&#91;i&#93;;</span></CodeLine>
<Link id="l05181" /><CodeLine lineNumber="5181"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;TileLoop = Result&#91;NumLoops + i&#93;;</span></CodeLine>
<Link id="l05182" /><CodeLine lineNumber="5182"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;OrigIndVar = OrigIndVars&#91;i&#93;;</span></CodeLine>
<Link id="l05183" /><CodeLine lineNumber="5183"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = TileSizes&#91;i&#93;;</span></CodeLine>
<Link id="l05184" /><CodeLine lineNumber="5184"></CodeLine>
<Link id="l05185" /><CodeLine lineNumber="5185"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Scale =</span></CodeLine>
<Link id="l05186" /><CodeLine lineNumber="5186"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aecd40f9a16dc0ef1e0bc416599f89277">CreateMul</a>(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, FloorLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#af4131f5f461f1138483addfd7cd7f579">getIndVar</a>(), &#123;&#125;, </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05187" /><CodeLine lineNumber="5187"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Shift =</span></CodeLine>
<Link id="l05188" /><CodeLine lineNumber="5188"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(Scale, TileLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#af4131f5f461f1138483addfd7cd7f579">getIndVar</a>(), &#123;&#125;, </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05189" /><CodeLine lineNumber="5189"><span class="doxyHighlight">    OrigIndVar-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Shift);</span></CodeLine>
<Link id="l05190" /><CodeLine lineNumber="5190"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05191" /><CodeLine lineNumber="5191"></CodeLine>
<Link id="l05192" /><CodeLine lineNumber="5192"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove unused parts of the original loops.</span></CodeLine>
<Link id="l05193" /><CodeLine lineNumber="5193"><span class="doxyHighlight">  <a href="#af0ce60c4a958016f62ce78f1eda423af">removeUnusedBlocksFromParent</a>(OldControlBBs);</span></CodeLine>
<Link id="l05194" /><CodeLine lineNumber="5194"></CodeLine>
<Link id="l05195" /><CodeLine lineNumber="5195"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;L : <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>)</span></CodeLine>
<Link id="l05196" /><CodeLine lineNumber="5196"><span class="doxyHighlight">    L-&gt;invalidate();</span></CodeLine>
<Link id="l05197" /><CodeLine lineNumber="5197"></CodeLine>
<Link id="l05198" /><CodeLine lineNumber="5198"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l05199" /><CodeLine lineNumber="5199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;GenL : Result)</span></CodeLine>
<Link id="l05200" /><CodeLine lineNumber="5200"><span class="doxyHighlight">    GenL-&gt;assertOK();</span></CodeLine>
<Link id="l05201" /><CodeLine lineNumber="5201"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l05202" /><CodeLine lineNumber="5202"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l05203" /><CodeLine lineNumber="5203"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05204" /><CodeLine lineNumber="5204"></CodeLine>
<Link id="l05205" /><CodeLine lineNumber="5205"><span class="doxyHighlightComment">/// Attach metadata \\p Properties to the basic block described by \\p BB. If the</span></CodeLine>
<Link id="l05206" /><CodeLine lineNumber="5206"><span class="doxyHighlightComment">/// basic block already has metadata, the basic block properties are appended.</span></CodeLine>
<Link id="l05207" /><CodeLine lineNumber="5207" lineLink="#ac36177cea684b1e36fdbc92d692f69d0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ac36177cea684b1e36fdbc92d692f69d0">addBasicBlockMetadata</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l05208" /><CodeLine lineNumber="5208"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Metadata &#42;&gt;</a> Properties) &#123;</span></CodeLine>
<Link id="l05209" /><CodeLine lineNumber="5209"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Nothing to do if no property to attach.</span></CodeLine>
<Link id="l05210" /><CodeLine lineNumber="5210"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Properties.<a href="/docs/api/classes/llvm/arrayref/#ac835b8735b1b2faec0efdca236e37d94">empty</a>())</span></CodeLine>
<Link id="l05211" /><CodeLine lineNumber="5211"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05212" /><CodeLine lineNumber="5212"></CodeLine>
<Link id="l05213" /><CodeLine lineNumber="5213"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>();</span></CodeLine>
<Link id="l05214" /><CodeLine lineNumber="5214"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;&gt;</a> NewProperties;</span></CodeLine>
<Link id="l05215" /><CodeLine lineNumber="5215"><span class="doxyHighlight">  NewProperties.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05216" /><CodeLine lineNumber="5216"></CodeLine>
<Link id="l05217" /><CodeLine lineNumber="5217"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the basic block already has metadata, prepend it to the new metadata.</span></CodeLine>
<Link id="l05218" /><CodeLine lineNumber="5218"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;Existing = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a6c09737e146b2d816c911a047ac67ba4">getMetadata</a>(LLVMContext::MD&#95;loop);</span></CodeLine>
<Link id="l05219" /><CodeLine lineNumber="5219"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Existing)</span></CodeLine>
<Link id="l05220" /><CodeLine lineNumber="5220"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(NewProperties, <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">drop&#95;begin</a>(Existing-&gt;<a href="/docs/api/classes/llvm/mdnode/#a571612461ea4af620bc4c441d61579a3">operands</a>(), 1));</span></CodeLine>
<Link id="l05221" /><CodeLine lineNumber="5221"></CodeLine>
<Link id="l05222" /><CodeLine lineNumber="5222"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(NewProperties, Properties);</span></CodeLine>
<Link id="l05223" /><CodeLine lineNumber="5223"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;BasicBlockID = <a href="/docs/api/classes/llvm/mdnode/#a21a975fd58c287a6ca3f1c89c048e7d3">MDNode::getDistinct</a>(Ctx, NewProperties);</span></CodeLine>
<Link id="l05224" /><CodeLine lineNumber="5224"><span class="doxyHighlight">  BasicBlockID-&gt;<a href="/docs/api/classes/llvm/mdnode/#a160e9e1a4fd597f83034c8b2ba316984">replaceOperandWith</a>(0, BasicBlockID);</span></CodeLine>
<Link id="l05225" /><CodeLine lineNumber="5225"></CodeLine>
<Link id="l05226" /><CodeLine lineNumber="5226"><span class="doxyHighlight">  BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;loop, BasicBlockID);</span></CodeLine>
<Link id="l05227" /><CodeLine lineNumber="5227"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05228" /><CodeLine lineNumber="5228"></CodeLine>
<Link id="l05229" /><CodeLine lineNumber="5229"><span class="doxyHighlightComment">/// Attach loop metadata \\p Properties to the loop described by \\p Loop. If the</span></CodeLine>
<Link id="l05230" /><CodeLine lineNumber="5230"><span class="doxyHighlightComment">/// loop already has metadata, the loop properties are appended.</span></CodeLine>
<Link id="l05231" /><CodeLine lineNumber="5231" lineLink="#adf813540e363817b85e9eecef51269b5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#adf813540e363817b85e9eecef51269b5">addLoopMetadata</a>(<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;<a href="/docs/api/classes/llvm/loop">Loop</a>,</span></CodeLine>
<Link id="l05232" /><CodeLine lineNumber="5232"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Metadata &#42;&gt;</a> Properties) &#123;</span></CodeLine>
<Link id="l05233" /><CodeLine lineNumber="5233"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/loop">Loop</a>-&gt;isValid() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expecting a valid CanonicalLoopInfo&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05234" /><CodeLine lineNumber="5234"></CodeLine>
<Link id="l05235" /><CodeLine lineNumber="5235"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Attach metadata to the loop&#39;s latch</span></CodeLine>
<Link id="l05236" /><CodeLine lineNumber="5236"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Latch = <a href="/docs/api/classes/llvm/loop">Loop</a>-&gt;getLatch();</span></CodeLine>
<Link id="l05237" /><CodeLine lineNumber="5237"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Latch &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;A valid CanonicalLoopInfo must have a unique latch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05238" /><CodeLine lineNumber="5238"><span class="doxyHighlight">  <a href="#ac36177cea684b1e36fdbc92d692f69d0">addBasicBlockMetadata</a>(Latch, Properties);</span></CodeLine>
<Link id="l05239" /><CodeLine lineNumber="5239"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05240" /><CodeLine lineNumber="5240"></CodeLine>
<Link id="l05241" /><CodeLine lineNumber="5241"><span class="doxyHighlightComment">/// Attach llvm.access.group metadata to the memref instructions of \\p Block</span></CodeLine>
<Link id="l05242" /><CodeLine lineNumber="5242" lineLink="#a545cc7eb4f94d0957ba9960a69b10a90"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a545cc7eb4f94d0957ba9960a69b10a90">addSimdMetadata</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>, <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;AccessGroup,</span></CodeLine>
<Link id="l05243" /><CodeLine lineNumber="5243"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;LI) &#123;</span></CodeLine>
<Link id="l05244" /><CodeLine lineNumber="5244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>) &#123;</span></CodeLine>
<Link id="l05245" /><CodeLine lineNumber="5245"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayReadOrWriteMemory()) &#123;</span></CodeLine>
<Link id="l05246" /><CodeLine lineNumber="5246"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: This instruction may already have access group from</span></CodeLine>
<Link id="l05247" /><CodeLine lineNumber="5247"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// other pragmas e.g. #pragma clang loop vectorize.  Append</span></CodeLine>
<Link id="l05248" /><CodeLine lineNumber="5248"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// so that the existing metadata is not overwritten.</span></CodeLine>
<Link id="l05249" /><CodeLine lineNumber="5249"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setMetadata(LLVMContext::MD&#95;access&#95;group, AccessGroup);</span></CodeLine>
<Link id="l05250" /><CodeLine lineNumber="5250"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05251" /><CodeLine lineNumber="5251"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05252" /><CodeLine lineNumber="5252"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05253" /><CodeLine lineNumber="5253"></CodeLine>
<Link id="l05254" /><CodeLine lineNumber="5254" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a28a2a9806d828609fe107f766d2dd569"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#a28a2a9806d828609fe107f766d2dd569">OpenMPIRBuilder::unrollLoopFull</a>(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a>, <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;<a href="/docs/api/classes/llvm/loop">Loop</a>) &#123;</span></CodeLine>
<Link id="l05255" /><CodeLine lineNumber="5255"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>();</span></CodeLine>
<Link id="l05256" /><CodeLine lineNumber="5256"><span class="doxyHighlight">  <a href="#adf813540e363817b85e9eecef51269b5">addLoopMetadata</a>(</span></CodeLine>
<Link id="l05257" /><CodeLine lineNumber="5257"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loop">Loop</a>, &#123;<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.unroll.enable&quot;</span><span class="doxyHighlight">)),</span></CodeLine>
<Link id="l05258" /><CodeLine lineNumber="5258"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.unroll.full&quot;</span><span class="doxyHighlight">))&#125;);</span></CodeLine>
<Link id="l05259" /><CodeLine lineNumber="5259"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05260" /><CodeLine lineNumber="5260"></CodeLine>
<Link id="l05261" /><CodeLine lineNumber="5261" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a4ca0068cb6a50615c74ecdb8f23839e0"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#a4ca0068cb6a50615c74ecdb8f23839e0">OpenMPIRBuilder::unrollLoopHeuristic</a>(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a>, <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;<a href="/docs/api/classes/llvm/loop">Loop</a>) &#123;</span></CodeLine>
<Link id="l05262" /><CodeLine lineNumber="5262"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>();</span></CodeLine>
<Link id="l05263" /><CodeLine lineNumber="5263"><span class="doxyHighlight">  <a href="#adf813540e363817b85e9eecef51269b5">addLoopMetadata</a>(</span></CodeLine>
<Link id="l05264" /><CodeLine lineNumber="5264"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loop">Loop</a>, &#123;</span></CodeLine>
<Link id="l05265" /><CodeLine lineNumber="5265"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.unroll.enable&quot;</span><span class="doxyHighlight">)),</span></CodeLine>
<Link id="l05266" /><CodeLine lineNumber="5266"><span class="doxyHighlight">            &#125;);</span></CodeLine>
<Link id="l05267" /><CodeLine lineNumber="5267"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05268" /><CodeLine lineNumber="5268"></CodeLine>
<Link id="l05269" /><CodeLine lineNumber="5269"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::createIfVersion(<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;CanonicalLoop,</span></CodeLine>
<Link id="l05270" /><CodeLine lineNumber="5270"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/value">Value</a> &#42;IfCond, <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> &amp;VMap,</span></CodeLine>
<Link id="l05271" /><CodeLine lineNumber="5271"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;NamePrefix) &#123;</span></CodeLine>
<Link id="l05272" /><CodeLine lineNumber="5272"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CanonicalLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a9592feb460b27d417f42a41aabfe253a">getFunction</a>();</span></CodeLine>
<Link id="l05273" /><CodeLine lineNumber="5273"></CodeLine>
<Link id="l05274" /><CodeLine lineNumber="5274"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Define where if branch should be inserted</span></CodeLine>
<Link id="l05275" /><CodeLine lineNumber="5275"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;SplitBefore = CanonicalLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l05276" /><CodeLine lineNumber="5276"></CodeLine>
<Link id="l05277" /><CodeLine lineNumber="5277"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We should not rely on pass manager. Currently we use pass manager</span></CodeLine>
<Link id="l05278" /><CodeLine lineNumber="5278"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// only for getting llvm::Loop which corresponds to given CanonicalLoopInfo</span></CodeLine>
<Link id="l05279" /><CodeLine lineNumber="5279"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// object. We should have a method  which returns all blocks between</span></CodeLine>
<Link id="l05280" /><CodeLine lineNumber="5280"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// CanonicalLoopInfo::getHeader() and CanonicalLoopInfo::getAfter()</span></CodeLine>
<Link id="l05281" /><CodeLine lineNumber="5281"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>;</span></CodeLine>
<Link id="l05282" /><CodeLine lineNumber="5282"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.registerPass(&#91;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>(); &#125;);</span></CodeLine>
<Link id="l05283" /><CodeLine lineNumber="5283"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.registerPass(&#91;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>(); &#125;);</span></CodeLine>
<Link id="l05284" /><CodeLine lineNumber="5284"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.<a href="/docs/api/classes/llvm/analysismanager/#a91ff894f756175a693c85bf73f79de9e">registerPass</a>(&#91;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PassInstrumentationAnalysis(); &#125;);</span></CodeLine>
<Link id="l05285" /><CodeLine lineNumber="5285"></CodeLine>
<Link id="l05286" /><CodeLine lineNumber="5286"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the loop which needs to be cloned</span></CodeLine>
<Link id="l05287" /><CodeLine lineNumber="5287"><span class="doxyHighlight">  LoopAnalysis LIA;</span></CodeLine>
<Link id="l05288" /><CodeLine lineNumber="5288"><span class="doxyHighlight">  LoopInfo &amp;&amp;LI = LIA.<a href="/docs/api/classes/llvm/loopanalysis/#aea38b668f2d98b7e9f64b8b3c2e524dc">run</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>);</span></CodeLine>
<Link id="l05289" /><CodeLine lineNumber="5289"><span class="doxyHighlight">  Loop &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a> = LI.<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(CanonicalLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a01c4471afa921c4962d7138cfcef4942">getHeader</a>());</span></CodeLine>
<Link id="l05290" /><CodeLine lineNumber="5290"></CodeLine>
<Link id="l05291" /><CodeLine lineNumber="5291"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create additional blocks for the if statement</span></CodeLine>
<Link id="l05292" /><CodeLine lineNumber="5292"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;Head = SplitBefore-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l05293" /><CodeLine lineNumber="5293"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;HeadOldTerm = Head-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l05294" /><CodeLine lineNumber="5294"><span class="doxyHighlight">  llvm::LLVMContext &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = Head-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>();</span></CodeLine>
<Link id="l05295" /><CodeLine lineNumber="5295"><span class="doxyHighlight">  llvm::BasicBlock &#42;ThenBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">llvm::BasicBlock::Create</a>(</span></CodeLine>
<Link id="l05296" /><CodeLine lineNumber="5296"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, NamePrefix + </span><span class="doxyHighlightStringLiteral">&quot;.if.then&quot;</span><span class="doxyHighlight">, Head-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), Head-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>());</span></CodeLine>
<Link id="l05297" /><CodeLine lineNumber="5297"><span class="doxyHighlight">  llvm::BasicBlock &#42;ElseBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">llvm::BasicBlock::Create</a>(</span></CodeLine>
<Link id="l05298" /><CodeLine lineNumber="5298"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, NamePrefix + </span><span class="doxyHighlightStringLiteral">&quot;.if.else&quot;</span><span class="doxyHighlight">, Head-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>(), CanonicalLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad3bf46daef8ce8176a68bcec0320dfd3">getExit</a>());</span></CodeLine>
<Link id="l05299" /><CodeLine lineNumber="5299"></CodeLine>
<Link id="l05300" /><CodeLine lineNumber="5300"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create if condition branch.</span></CodeLine>
<Link id="l05301" /><CodeLine lineNumber="5301"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(HeadOldTerm);</span></CodeLine>
<Link id="l05302" /><CodeLine lineNumber="5302"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;BrInstr =</span></CodeLine>
<Link id="l05303" /><CodeLine lineNumber="5303"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(IfCond, ThenBlock, </span><span class="doxyHighlightComment">/&#42;ifFalse&#42;/</span><span class="doxyHighlight"> ElseBlock);</span></CodeLine>
<Link id="l05304" /><CodeLine lineNumber="5304"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> IP&#123;BrInstr-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), ++BrInstr-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>()&#125;;</span></CodeLine>
<Link id="l05305" /><CodeLine lineNumber="5305"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Then block contains branch to omp loop which needs to be vectorized</span></CodeLine>
<Link id="l05306" /><CodeLine lineNumber="5306"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a78e14f66d8a8405c6882b5ff6a3b7617">spliceBB</a>(IP, ThenBlock, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05307" /><CodeLine lineNumber="5307"><span class="doxyHighlight">  ThenBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a089e003bb688e55b9a91ed4e7fed3678">replaceSuccessorsPhiUsesWith</a>(Head, ThenBlock);</span></CodeLine>
<Link id="l05308" /><CodeLine lineNumber="5308"></CodeLine>
<Link id="l05309" /><CodeLine lineNumber="5309"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ElseBlock);</span></CodeLine>
<Link id="l05310" /><CodeLine lineNumber="5310"></CodeLine>
<Link id="l05311" /><CodeLine lineNumber="5311"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clone loop for the else branch</span></CodeLine>
<Link id="l05312" /><CodeLine lineNumber="5312"><span class="doxyHighlight">  SmallVector&lt;BasicBlock &#42;, 8&gt; NewBlocks;</span></CodeLine>
<Link id="l05313" /><CodeLine lineNumber="5313"></CodeLine>
<Link id="l05314" /><CodeLine lineNumber="5314"><span class="doxyHighlight">  VMap&#91;CanonicalLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>()&#93; = ElseBlock;</span></CodeLine>
<Link id="l05315" /><CodeLine lineNumber="5315"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (BasicBlock &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getBlocks()) &#123;</span></CodeLine>
<Link id="l05316" /><CodeLine lineNumber="5316"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;NewBB = <a href="/docs/api/namespaces/llvm/#aa1c8d384f90fc9d69d7fcdf920138cf2">CloneBasicBlock</a>(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>, VMap, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l05317" /><CodeLine lineNumber="5317"><span class="doxyHighlight">    NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ac1fd6437bbfce263b87f01767d950ce5">moveBefore</a>(CanonicalLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad3bf46daef8ce8176a68bcec0320dfd3">getExit</a>());</span></CodeLine>
<Link id="l05318" /><CodeLine lineNumber="5318"><span class="doxyHighlight">    VMap&#91;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>&#93; = NewBB;</span></CodeLine>
<Link id="l05319" /><CodeLine lineNumber="5319"><span class="doxyHighlight">    NewBlocks.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(NewBB);</span></CodeLine>
<Link id="l05320" /><CodeLine lineNumber="5320"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05321" /><CodeLine lineNumber="5321"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab8ec5c940fbc440c992716fbe4a48636">remapInstructionsInBlocks</a>(NewBlocks, VMap);</span></CodeLine>
<Link id="l05322" /><CodeLine lineNumber="5322"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(NewBlocks.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a58dc840fc84420b7f0b773794b8101c1">front</a>());</span></CodeLine>
<Link id="l05323" /><CodeLine lineNumber="5323"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05324" /><CodeLine lineNumber="5324"></CodeLine>
<Link id="l05325" /><CodeLine lineNumber="5325"><span class="doxyHighlightKeywordType">unsigned</span></CodeLine>
<Link id="l05326" /><CodeLine lineNumber="5326" lineLink="/docs/api/classes/llvm/openmpirbuilder/#ac5b407054e7727d04053af9c3f1a5568"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#ac5b407054e7727d04053af9c3f1a5568">OpenMPIRBuilder::getOpenMPDefaultSimdAlign</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/triple">Triple</a> &amp;TargetTriple,</span></CodeLine>
<Link id="l05327" /><CodeLine lineNumber="5327"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringmap">StringMap&lt;bool&gt;</a> &amp;Features) &#123;</span></CodeLine>
<Link id="l05328" /><CodeLine lineNumber="5328"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TargetTriple.<a href="/docs/api/classes/llvm/triple/#a31d94b95418472bb1179f7c130ad3667">isX86</a>()) &#123;</span></CodeLine>
<Link id="l05329" /><CodeLine lineNumber="5329"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Features.<a href="/docs/api/classes/llvm/stringmap/#aa6528965c64b379c2cb311599babdd66">lookup</a>(</span><span class="doxyHighlightStringLiteral">&quot;avx512f&quot;</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l05330" /><CodeLine lineNumber="5330"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 512;</span></CodeLine>
<Link id="l05331" /><CodeLine lineNumber="5331"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Features.<a href="/docs/api/classes/llvm/stringmap/#aa6528965c64b379c2cb311599babdd66">lookup</a>(</span><span class="doxyHighlightStringLiteral">&quot;avx&quot;</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l05332" /><CodeLine lineNumber="5332"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 256;</span></CodeLine>
<Link id="l05333" /><CodeLine lineNumber="5333"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 128;</span></CodeLine>
<Link id="l05334" /><CodeLine lineNumber="5334"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05335" /><CodeLine lineNumber="5335"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TargetTriple.<a href="/docs/api/classes/llvm/triple/#a0338eabc8ab4dff6368bdfae6ec94cbc">isPPC</a>())</span></CodeLine>
<Link id="l05336" /><CodeLine lineNumber="5336"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 128;</span></CodeLine>
<Link id="l05337" /><CodeLine lineNumber="5337"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TargetTriple.<a href="/docs/api/classes/llvm/triple/#acf7f07dbe7dd1f7edd291b75005280bb">isWasm</a>())</span></CodeLine>
<Link id="l05338" /><CodeLine lineNumber="5338"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 128;</span></CodeLine>
<Link id="l05339" /><CodeLine lineNumber="5339"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l05340" /><CodeLine lineNumber="5340"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05341" /><CodeLine lineNumber="5341"></CodeLine>
<Link id="l05342" /><CodeLine lineNumber="5342" lineLink="/docs/api/classes/llvm/openmpirbuilder/#acd1fbb2df257f945afda92919be322f3"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#acd1fbb2df257f945afda92919be322f3">OpenMPIRBuilder::applySimd</a>(<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;CanonicalLoop,</span></CodeLine>
<Link id="l05343" /><CodeLine lineNumber="5343"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;Value &#42;, Value &#42;&gt;</a> AlignedVars,</span></CodeLine>
<Link id="l05344" /><CodeLine lineNumber="5344"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/value">Value</a> &#42;IfCond, OrderKind Order,</span></CodeLine>
<Link id="l05345" /><CodeLine lineNumber="5345"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Simdlen, <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Safelen) &#123;</span></CodeLine>
<Link id="l05346" /><CodeLine lineNumber="5346"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>();</span></CodeLine>
<Link id="l05347" /><CodeLine lineNumber="5347"></CodeLine>
<Link id="l05348" /><CodeLine lineNumber="5348"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CanonicalLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a9592feb460b27d417f42a41aabfe253a">getFunction</a>();</span></CodeLine>
<Link id="l05349" /><CodeLine lineNumber="5349"></CodeLine>
<Link id="l05350" /><CodeLine lineNumber="5350"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We should not rely on pass manager. Currently we use pass manager</span></CodeLine>
<Link id="l05351" /><CodeLine lineNumber="5351"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// only for getting llvm::Loop which corresponds to given CanonicalLoopInfo</span></CodeLine>
<Link id="l05352" /><CodeLine lineNumber="5352"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// object. We should have a method  which returns all blocks between</span></CodeLine>
<Link id="l05353" /><CodeLine lineNumber="5353"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// CanonicalLoopInfo::getHeader() and CanonicalLoopInfo::getAfter()</span></CodeLine>
<Link id="l05354" /><CodeLine lineNumber="5354"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>;</span></CodeLine>
<Link id="l05355" /><CodeLine lineNumber="5355"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.registerPass(&#91;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>(); &#125;);</span></CodeLine>
<Link id="l05356" /><CodeLine lineNumber="5356"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.registerPass(&#91;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>(); &#125;);</span></CodeLine>
<Link id="l05357" /><CodeLine lineNumber="5357"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.registerPass(&#91;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/passinstrumentationanalysis">PassInstrumentationAnalysis</a>(); &#125;);</span></CodeLine>
<Link id="l05358" /><CodeLine lineNumber="5358"></CodeLine>
<Link id="l05359" /><CodeLine lineNumber="5359"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a> LIA;</span></CodeLine>
<Link id="l05360" /><CodeLine lineNumber="5360"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;&amp;LI = LIA.<a href="/docs/api/classes/llvm/loopanalysis/#aea38b668f2d98b7e9f64b8b3c2e524dc">run</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>);</span></CodeLine>
<Link id="l05361" /><CodeLine lineNumber="5361"></CodeLine>
<Link id="l05362" /><CodeLine lineNumber="5362"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI.<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(CanonicalLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a01c4471afa921c4962d7138cfcef4942">getHeader</a>());</span></CodeLine>
<Link id="l05363" /><CodeLine lineNumber="5363"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AlignedVars.<a href="/docs/api/classes/llvm/mapvector/#acf4c09e1f30cdd4e0b5b1b8a236ead34">size</a>()) &#123;</span></CodeLine>
<Link id="l05364" /><CodeLine lineNumber="5364"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> IP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l05365" /><CodeLine lineNumber="5365"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;AlignedItem : AlignedVars) &#123;</span></CodeLine>
<Link id="l05366" /><CodeLine lineNumber="5366"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;AlignedPtr = AlignedItem.first;</span></CodeLine>
<Link id="l05367" /><CodeLine lineNumber="5367"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Alignment = AlignedItem.second;</span></CodeLine>
<Link id="l05368" /><CodeLine lineNumber="5368"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;loadInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(AlignedPtr);</span></CodeLine>
<Link id="l05369" /><CodeLine lineNumber="5369"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(loadInst-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>());</span></CodeLine>
<Link id="l05370" /><CodeLine lineNumber="5370"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a480959ce9fb41e0ac0ce2cd7907d7ace">CreateAlignmentAssumption</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getDataLayout(), AlignedPtr,</span></CodeLine>
<Link id="l05371" /><CodeLine lineNumber="5371"><span class="doxyHighlight">                                        Alignment);</span></CodeLine>
<Link id="l05372" /><CodeLine lineNumber="5372"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05373" /><CodeLine lineNumber="5373"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(IP);</span></CodeLine>
<Link id="l05374" /><CodeLine lineNumber="5374"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05375" /><CodeLine lineNumber="5375"></CodeLine>
<Link id="l05376" /><CodeLine lineNumber="5376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfCond) &#123;</span></CodeLine>
<Link id="l05377" /><CodeLine lineNumber="5377"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#abf0f52ae29f87b5e0f2b95ff961cdae1">ValueToValueMapTy</a> VMap;</span></CodeLine>
<Link id="l05378" /><CodeLine lineNumber="5378"><span class="doxyHighlight">    createIfVersion(CanonicalLoop, IfCond, VMap, </span><span class="doxyHighlightStringLiteral">&quot;simd&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05379" /><CodeLine lineNumber="5379"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add metadata to the cloned loop which disables vectorization</span></CodeLine>
<Link id="l05380" /><CodeLine lineNumber="5380"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;MappedLatch = VMap.<a href="/docs/api/classes/llvm/valuemap/#a15f92579a5fc316dab8cd1fad51015ef">lookup</a>(CanonicalLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ac37a6cf77f6f82b6bb28af4d9c8626d0">getLatch</a>());</span></CodeLine>
<Link id="l05381" /><CodeLine lineNumber="5381"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MappedLatch &amp;&amp;</span></CodeLine>
<Link id="l05382" /><CodeLine lineNumber="5382"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Cannot find value which corresponds to original loop latch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05383" /><CodeLine lineNumber="5383"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BasicBlock&gt;</a>(MappedLatch) &amp;&amp;</span></CodeLine>
<Link id="l05384" /><CodeLine lineNumber="5384"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Cannot cast mapped latch block value to BasicBlock&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05385" /><CodeLine lineNumber="5385"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewLatchBlock = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BasicBlock&gt;</a>(MappedLatch);</span></CodeLine>
<Link id="l05386" /><CodeLine lineNumber="5386"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantasmetadata">ConstantAsMetadata</a> &#42;BoolConst =</span></CodeLine>
<Link id="l05387" /><CodeLine lineNumber="5387"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constantasmetadata/#a4c720c398a263087e00d7358b05636d5">ConstantAsMetadata::get</a>(<a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(Ctx)));</span></CodeLine>
<Link id="l05388" /><CodeLine lineNumber="5388"><span class="doxyHighlight">    <a href="#ac36177cea684b1e36fdbc92d692f69d0">addBasicBlockMetadata</a>(</span></CodeLine>
<Link id="l05389" /><CodeLine lineNumber="5389"><span class="doxyHighlight">        NewLatchBlock,</span></CodeLine>
<Link id="l05390" /><CodeLine lineNumber="5390"><span class="doxyHighlight">        &#123;<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, &#123;<a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.vectorize.enable&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l05391" /><CodeLine lineNumber="5391"><span class="doxyHighlight">                           BoolConst&#125;)&#125;);</span></CodeLine>
<Link id="l05392" /><CodeLine lineNumber="5392"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05393" /><CodeLine lineNumber="5393"></CodeLine>
<Link id="l05394" /><CodeLine lineNumber="5394"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;BasicBlock &#42;, 8&gt;</a> Reachable;</span></CodeLine>
<Link id="l05395" /><CodeLine lineNumber="5395"></CodeLine>
<Link id="l05396" /><CodeLine lineNumber="5396"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the basic blocks from the loop in which memref instructions</span></CodeLine>
<Link id="l05397" /><CodeLine lineNumber="5397"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can be found.</span></CodeLine>
<Link id="l05398" /><CodeLine lineNumber="5398"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Generalize getting all blocks inside a CanonicalizeLoopInfo,</span></CodeLine>
<Link id="l05399" /><CodeLine lineNumber="5399"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// preferably without running any passes.</span></CodeLine>
<Link id="l05400" /><CodeLine lineNumber="5400"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : L-&gt;getBlocks()) &#123;</span></CodeLine>
<Link id="l05401" /><CodeLine lineNumber="5401"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> == CanonicalLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#acb5b5b136597312e0d5df6b746a7e6db">getCond</a>() ||</span></CodeLine>
<Link id="l05402" /><CodeLine lineNumber="5402"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> == CanonicalLoop-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a01c4471afa921c4962d7138cfcef4942">getHeader</a>())</span></CodeLine>
<Link id="l05403" /><CodeLine lineNumber="5403"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05404" /><CodeLine lineNumber="5404"><span class="doxyHighlight">    Reachable.insert(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>);</span></CodeLine>
<Link id="l05405" /><CodeLine lineNumber="5405"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05406" /><CodeLine lineNumber="5406"></CodeLine>
<Link id="l05407" /><CodeLine lineNumber="5407"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;&gt;</a> LoopMDList;</span></CodeLine>
<Link id="l05408" /><CodeLine lineNumber="5408"></CodeLine>
<Link id="l05409" /><CodeLine lineNumber="5409"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In presence of finite &#39;safelen&#39;, it may be unsafe to mark all</span></CodeLine>
<Link id="l05410" /><CodeLine lineNumber="5410"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the memory instructions parallel, because loop-carried</span></CodeLine>
<Link id="l05411" /><CodeLine lineNumber="5411"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dependences of &#39;safelen&#39; iterations are possible.</span></CodeLine>
<Link id="l05412" /><CodeLine lineNumber="5412"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If clause order(concurrent) is specified then the memory instructions</span></CodeLine>
<Link id="l05413" /><CodeLine lineNumber="5413"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are marked parallel even if &#39;safelen&#39; is finite.</span></CodeLine>
<Link id="l05414" /><CodeLine lineNumber="5414"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Safelen == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) || (Order == OrderKind::OMP&#95;ORDER&#95;concurrent)) &#123;</span></CodeLine>
<Link id="l05415" /><CodeLine lineNumber="5415"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add access group metadata to memory-access instructions.</span></CodeLine>
<Link id="l05416" /><CodeLine lineNumber="5416"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;AccessGroup = <a href="/docs/api/classes/llvm/mdnode/#a21a975fd58c287a6ca3f1c89c048e7d3">MDNode::getDistinct</a>(Ctx, &#123;&#125;);</span></CodeLine>
<Link id="l05417" /><CodeLine lineNumber="5417"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : Reachable)</span></CodeLine>
<Link id="l05418" /><CodeLine lineNumber="5418"><span class="doxyHighlight">      <a href="#a545cc7eb4f94d0957ba9960a69b10a90">addSimdMetadata</a>(BB, AccessGroup, LI);</span></CodeLine>
<Link id="l05419" /><CodeLine lineNumber="5419"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO:  If the loop has existing parallel access metadata, have</span></CodeLine>
<Link id="l05420" /><CodeLine lineNumber="5420"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to combine two lists.</span></CodeLine>
<Link id="l05421" /><CodeLine lineNumber="5421"><span class="doxyHighlight">    LoopMDList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(</span></CodeLine>
<Link id="l05422" /><CodeLine lineNumber="5422"><span class="doxyHighlight">        Ctx, &#123;<a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.parallel&#95;accesses&quot;</span><span class="doxyHighlight">), AccessGroup&#125;));</span></CodeLine>
<Link id="l05423" /><CodeLine lineNumber="5423"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05424" /><CodeLine lineNumber="5424"></CodeLine>
<Link id="l05425" /><CodeLine lineNumber="5425"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use the above access group metadata to create loop level</span></CodeLine>
<Link id="l05426" /><CodeLine lineNumber="5426"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// metadata, which should be distinct for each loop.</span></CodeLine>
<Link id="l05427" /><CodeLine lineNumber="5427"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantasmetadata">ConstantAsMetadata</a> &#42;BoolConst =</span></CodeLine>
<Link id="l05428" /><CodeLine lineNumber="5428"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantasmetadata/#a4c720c398a263087e00d7358b05636d5">ConstantAsMetadata::get</a>(<a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(Ctx)));</span></CodeLine>
<Link id="l05429" /><CodeLine lineNumber="5429"><span class="doxyHighlight">  LoopMDList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(</span></CodeLine>
<Link id="l05430" /><CodeLine lineNumber="5430"><span class="doxyHighlight">      Ctx, &#123;<a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.vectorize.enable&quot;</span><span class="doxyHighlight">), BoolConst&#125;));</span></CodeLine>
<Link id="l05431" /><CodeLine lineNumber="5431"></CodeLine>
<Link id="l05432" /><CodeLine lineNumber="5432"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Simdlen || Safelen) &#123;</span></CodeLine>
<Link id="l05433" /><CodeLine lineNumber="5433"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If both simdlen and safelen clauses are specified, the value of the</span></CodeLine>
<Link id="l05434" /><CodeLine lineNumber="5434"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// simdlen parameter must be less than or equal to the value of the safelen</span></CodeLine>
<Link id="l05435" /><CodeLine lineNumber="5435"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// parameter. Therefore, use safelen only in the absence of simdlen.</span></CodeLine>
<Link id="l05436" /><CodeLine lineNumber="5436"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;VectorizeWidth = Simdlen == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> ? Safelen : Simdlen;</span></CodeLine>
<Link id="l05437" /><CodeLine lineNumber="5437"><span class="doxyHighlight">    LoopMDList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l05438" /><CodeLine lineNumber="5438"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, &#123;<a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.vectorize.width&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l05439" /><CodeLine lineNumber="5439"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/constantasmetadata/#a4c720c398a263087e00d7358b05636d5">ConstantAsMetadata::get</a>(VectorizeWidth)&#125;));</span></CodeLine>
<Link id="l05440" /><CodeLine lineNumber="5440"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05441" /><CodeLine lineNumber="5441"></CodeLine>
<Link id="l05442" /><CodeLine lineNumber="5442"><span class="doxyHighlight">  <a href="#adf813540e363817b85e9eecef51269b5">addLoopMetadata</a>(CanonicalLoop, LoopMDList);</span></CodeLine>
<Link id="l05443" /><CodeLine lineNumber="5443"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05444" /><CodeLine lineNumber="5444"></CodeLine>
<Link id="l05445" /><CodeLine lineNumber="5445"><span class="doxyHighlightComment">/// Create the TargetMachine object to query the backend for optimization</span></CodeLine>
<Link id="l05446" /><CodeLine lineNumber="5446"><span class="doxyHighlightComment">/// preferences.</span></CodeLine>
<Link id="l05447" /><CodeLine lineNumber="5447"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05448" /><CodeLine lineNumber="5448"><span class="doxyHighlightComment">/// Ideally, this would be passed from the front-end to the OpenMPBuilder, but</span></CodeLine>
<Link id="l05449" /><CodeLine lineNumber="5449"><span class="doxyHighlightComment">/// e.g. Clang does not pass it to its CodeGen layer and creates it only when</span></CodeLine>
<Link id="l05450" /><CodeLine lineNumber="5450"><span class="doxyHighlightComment">/// needed for the LLVM pass pipline. We use some default options to avoid</span></CodeLine>
<Link id="l05451" /><CodeLine lineNumber="5451"><span class="doxyHighlightComment">/// having to pass too many settings from the frontend that probably do not</span></CodeLine>
<Link id="l05452" /><CodeLine lineNumber="5452"><span class="doxyHighlightComment">/// matter.</span></CodeLine>
<Link id="l05453" /><CodeLine lineNumber="5453"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05454" /><CodeLine lineNumber="5454"><span class="doxyHighlightComment">/// Currently, TargetMachine is only used sometimes by the unrollLoopPartial</span></CodeLine>
<Link id="l05455" /><CodeLine lineNumber="5455"><span class="doxyHighlightComment">/// method. If we are going to use TargetMachine for more purposes, especially</span></CodeLine>
<Link id="l05456" /><CodeLine lineNumber="5456"><span class="doxyHighlightComment">/// those that are sensitive to TargetOptions, RelocModel and CodeModel, it</span></CodeLine>
<Link id="l05457" /><CodeLine lineNumber="5457"><span class="doxyHighlightComment">/// might become be worth requiring front-ends to pass on their TargetMachine,</span></CodeLine>
<Link id="l05458" /><CodeLine lineNumber="5458"><span class="doxyHighlightComment">/// or at least cache it between methods. Note that while fontends such as Clang</span></CodeLine>
<Link id="l05459" /><CodeLine lineNumber="5459"><span class="doxyHighlightComment">/// have just a single main TargetMachine per translation unit, &quot;target-cpu&quot; and</span></CodeLine>
<Link id="l05460" /><CodeLine lineNumber="5460"><span class="doxyHighlightComment">/// &quot;target-features&quot; that determine the TargetMachine are per-function and can</span></CodeLine>
<Link id="l05461" /><CodeLine lineNumber="5461"><span class="doxyHighlightComment">/// be overrided using &#95;&#95;attribute&#95;&#95;((target(&quot;OPTIONS&quot;))).</span></CodeLine>
<Link id="l05462" /><CodeLine lineNumber="5462"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::unique&#95;ptr&lt;TargetMachine&gt;</span></CodeLine>
<Link id="l05463" /><CodeLine lineNumber="5463" lineLink="#abfc7ebfffc7baaf23279854fec1412ac"><span class="doxyHighlight"><a href="#abfc7ebfffc7baaf23279854fec1412ac">createTargetMachine</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/namespaces/llvm/#a8ec1bf8d7b792ca9fac56f8514db18d2">CodeGenOptLevel</a> OptLevel) &#123;</span></CodeLine>
<Link id="l05464" /><CodeLine lineNumber="5464"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/module">Module</a> &#42;M = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getParent();</span></CodeLine>
<Link id="l05465" /><CodeLine lineNumber="5465"></CodeLine>
<Link id="l05466" /><CodeLine lineNumber="5466"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> CPU = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFnAttribute(</span><span class="doxyHighlightStringLiteral">&quot;target-cpu&quot;</span><span class="doxyHighlight">).getValueAsString();</span></CodeLine>
<Link id="l05467" /><CodeLine lineNumber="5467"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> Features = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFnAttribute(</span><span class="doxyHighlightStringLiteral">&quot;target-features&quot;</span><span class="doxyHighlight">).getValueAsString();</span></CodeLine>
<Link id="l05468" /><CodeLine lineNumber="5468"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::string &amp;<a href="/docs/api/classes/llvm/triple">Triple</a> = M-&gt;getTargetTriple();</span></CodeLine>
<Link id="l05469" /><CodeLine lineNumber="5469"></CodeLine>
<Link id="l05470" /><CodeLine lineNumber="5470"><span class="doxyHighlight">  std::string <a href="/docs/api/classes/llvm/error">Error</a>;</span></CodeLine>
<Link id="l05471" /><CodeLine lineNumber="5471"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/target">llvm::Target</a> &#42;TheTarget = <a href="/docs/api/structs/llvm/targetregistry/#a85a69009ec328d5835241f56fb62cc6d">TargetRegistry::lookupTarget</a>(<a href="/docs/api/classes/llvm/triple">Triple</a>, <a href="/docs/api/classes/llvm/error">Error</a>);</span></CodeLine>
<Link id="l05472" /><CodeLine lineNumber="5472"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TheTarget)</span></CodeLine>
<Link id="l05473" /><CodeLine lineNumber="5473"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;&#125;;</span></CodeLine>
<Link id="l05474" /><CodeLine lineNumber="5474"></CodeLine>
<Link id="l05475" /><CodeLine lineNumber="5475"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetoptions">llvm::TargetOptions</a> <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>;</span></CodeLine>
<Link id="l05476" /><CodeLine lineNumber="5476"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::unique&#95;ptr&lt;TargetMachine&gt;(TheTarget-&gt;<a href="/docs/api/classes/llvm/target/#a97b31e68ba164458a37e49e7d1053fc1">createTargetMachine</a>(</span></CodeLine>
<Link id="l05477" /><CodeLine lineNumber="5477"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/triple">Triple</a>, CPU, Features, <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/logicalview/lib/debuginfo/logicalview/core/lvoptions-cpp/#ab4088b7a11f3cbc38ac16a6e9c72494e">Options</a>, </span><span class="doxyHighlightComment">/&#42;RelocModel=&#42;/</span><span class="doxyHighlight">std::nullopt,</span></CodeLine>
<Link id="l05478" /><CodeLine lineNumber="5478"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;CodeModel=&#42;/</span><span class="doxyHighlight">std::nullopt, OptLevel));</span></CodeLine>
<Link id="l05479" /><CodeLine lineNumber="5479"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05480" /><CodeLine lineNumber="5480"></CodeLine>
<Link id="l05481" /><CodeLine lineNumber="5481"><span class="doxyHighlightComment">/// Heuristically determine the best-performant unroll factor for \\p CLI. This</span></CodeLine>
<Link id="l05482" /><CodeLine lineNumber="5482"><span class="doxyHighlightComment">/// depends on the target processor. We are re-using the same heuristics as the</span></CodeLine>
<Link id="l05483" /><CodeLine lineNumber="5483"><span class="doxyHighlightComment">/// LoopUnrollPass.</span></CodeLine>
<Link id="l05484" /><CodeLine lineNumber="5484" lineLink="#a946282957319b8c23ab9f169abb504c4"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> int32&#95;t <a href="#a946282957319b8c23ab9f169abb504c4">computeHeuristicUnrollFactor</a>(<a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;CLI) &#123;</span></CodeLine>
<Link id="l05485" /><CodeLine lineNumber="5485"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a9592feb460b27d417f42a41aabfe253a">getFunction</a>();</span></CodeLine>
<Link id="l05486" /><CodeLine lineNumber="5486"></CodeLine>
<Link id="l05487" /><CodeLine lineNumber="5487"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Assume the user requests the most aggressive unrolling, even if the rest of</span></CodeLine>
<Link id="l05488" /><CodeLine lineNumber="5488"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the code is optimized using a lower setting.</span></CodeLine>
<Link id="l05489" /><CodeLine lineNumber="5489"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8ec1bf8d7b792ca9fac56f8514db18d2">CodeGenOptLevel</a> OptLevel = <a href="/docs/api/namespaces/llvm/#a8ec1bf8d7b792ca9fac56f8514db18d2a389a96d0d9b3feb46b8c9d941566a4ae">CodeGenOptLevel::Aggressive</a>;</span></CodeLine>
<Link id="l05490" /><CodeLine lineNumber="5490"><span class="doxyHighlight">  std::unique&#95;ptr&lt;TargetMachine&gt; TM = <a href="#abfc7ebfffc7baaf23279854fec1412ac">createTargetMachine</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, OptLevel);</span></CodeLine>
<Link id="l05491" /><CodeLine lineNumber="5491"></CodeLine>
<Link id="l05492" /><CodeLine lineNumber="5492"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>;</span></CodeLine>
<Link id="l05493" /><CodeLine lineNumber="5493"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.registerPass(&#91;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryanalysis">TargetLibraryAnalysis</a>(); &#125;);</span></CodeLine>
<Link id="l05494" /><CodeLine lineNumber="5494"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.registerPass(&#91;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/assumptionanalysis">AssumptionAnalysis</a>(); &#125;);</span></CodeLine>
<Link id="l05495" /><CodeLine lineNumber="5495"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.registerPass(&#91;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>(); &#125;);</span></CodeLine>
<Link id="l05496" /><CodeLine lineNumber="5496"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.registerPass(&#91;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>(); &#125;);</span></CodeLine>
<Link id="l05497" /><CodeLine lineNumber="5497"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.registerPass(&#91;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scalarevolutionanalysis">ScalarEvolutionAnalysis</a>(); &#125;);</span></CodeLine>
<Link id="l05498" /><CodeLine lineNumber="5498"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.registerPass(&#91;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/passinstrumentationanalysis">PassInstrumentationAnalysis</a>(); &#125;);</span></CodeLine>
<Link id="l05499" /><CodeLine lineNumber="5499"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a> TIRA;</span></CodeLine>
<Link id="l05500" /><CodeLine lineNumber="5500"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TM)</span></CodeLine>
<Link id="l05501" /><CodeLine lineNumber="5501"><span class="doxyHighlight">    TIRA = <a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>(</span></CodeLine>
<Link id="l05502" /><CodeLine lineNumber="5502"><span class="doxyHighlight">        &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> TM-&gt;getTargetTransformInfo(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>); &#125;);</span></CodeLine>
<Link id="l05503" /><CodeLine lineNumber="5503"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.registerPass(&#91;&amp;&#93;() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> TIRA; &#125;);</span></CodeLine>
<Link id="l05504" /><CodeLine lineNumber="5504"></CodeLine>
<Link id="l05505" /><CodeLine lineNumber="5505"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetiranalysis/#a86179e1ebe9886a51ca1212368ee1e24">TargetIRAnalysis::Result</a> &amp;&amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> = TIRA.<a href="/docs/api/classes/llvm/targetiranalysis/#a4c1acdb96111dcff6f3eb282adecf86b">run</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>);</span></CodeLine>
<Link id="l05506" /><CodeLine lineNumber="5506"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scalarevolutionanalysis">ScalarEvolutionAnalysis</a> SEA;</span></CodeLine>
<Link id="l05507" /><CodeLine lineNumber="5507"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;&amp;SE = SEA.<a href="/docs/api/classes/llvm/scalarevolutionanalysis/#acbc87d909d53e5f43fde82950e15b59d">run</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>);</span></CodeLine>
<Link id="l05508" /><CodeLine lineNumber="5508"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a> DTA;</span></CodeLine>
<Link id="l05509" /><CodeLine lineNumber="5509"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;&amp;DT = DTA.<a href="/docs/api/classes/llvm/dominatortreeanalysis/#a4aa821b3dea8d981f76a77e5c099e3b5">run</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>);</span></CodeLine>
<Link id="l05510" /><CodeLine lineNumber="5510"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a> LIA;</span></CodeLine>
<Link id="l05511" /><CodeLine lineNumber="5511"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &amp;&amp;LI = LIA.<a href="/docs/api/classes/llvm/loopanalysis/#aea38b668f2d98b7e9f64b8b3c2e524dc">run</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>);</span></CodeLine>
<Link id="l05512" /><CodeLine lineNumber="5512"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/assumptionanalysis">AssumptionAnalysis</a> ACT;</span></CodeLine>
<Link id="l05513" /><CodeLine lineNumber="5513"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &amp;&amp;AC = ACT.<a href="/docs/api/classes/llvm/assumptionanalysis/#aeb8f2cc893c02d3d5a926b69bab89185">run</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>);</span></CodeLine>
<Link id="l05514" /><CodeLine lineNumber="5514"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> ORE&#123;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>&#125;;</span></CodeLine>
<Link id="l05515" /><CodeLine lineNumber="5515"></CodeLine>
<Link id="l05516" /><CodeLine lineNumber="5516"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI.<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(CLI-&gt;<a href="/docs/api/classes/llvm/canonicalloopinfo/#a01c4471afa921c4962d7138cfcef4942">getHeader</a>());</span></CodeLine>
<Link id="l05517" /><CodeLine lineNumber="5517"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expecting CanonicalLoopInfo to be recognized as a loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05518" /><CodeLine lineNumber="5518"></CodeLine>
<Link id="l05519" /><CodeLine lineNumber="5519"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences">TargetTransformInfo::UnrollingPreferences</a> UP = <a href="/docs/api/namespaces/llvm/#abd642fa74effc122158e6fb11da78600">gatherUnrollingPreferences</a>(</span></CodeLine>
<Link id="l05520" /><CodeLine lineNumber="5520"><span class="doxyHighlight">      L, SE, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l05521" /><CodeLine lineNumber="5521"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;BlockFrequencyInfo=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05522" /><CodeLine lineNumber="5522"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;ProfileSummaryInfo=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ORE, </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(OptLevel),</span></CodeLine>
<Link id="l05523" /><CodeLine lineNumber="5523"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;UserThreshold=&#42;/</span><span class="doxyHighlight">std::nullopt,</span></CodeLine>
<Link id="l05524" /><CodeLine lineNumber="5524"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;UserCount=&#42;/</span><span class="doxyHighlight">std::nullopt,</span></CodeLine>
<Link id="l05525" /><CodeLine lineNumber="5525"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;UserAllowPartial=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05526" /><CodeLine lineNumber="5526"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;UserAllowRuntime=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05527" /><CodeLine lineNumber="5527"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;UserUpperBound=&#42;/</span><span class="doxyHighlight">std::nullopt,</span></CodeLine>
<Link id="l05528" /><CodeLine lineNumber="5528"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;UserFullUnrollMaxCount=&#42;/</span><span class="doxyHighlight">std::nullopt);</span></CodeLine>
<Link id="l05529" /><CodeLine lineNumber="5529"></CodeLine>
<Link id="l05530" /><CodeLine lineNumber="5530"><span class="doxyHighlight">  UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#a4217ba2e3d1295f8e9e6b49cef2a8b76">Force</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05531" /><CodeLine lineNumber="5531"></CodeLine>
<Link id="l05532" /><CodeLine lineNumber="5532"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Account for additional optimizations taking place before the LoopUnrollPass</span></CodeLine>
<Link id="l05533" /><CodeLine lineNumber="5533"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// would unroll the loop.</span></CodeLine>
<Link id="l05534" /><CodeLine lineNumber="5534"><span class="doxyHighlight">  UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#a21e7febf468c370793f606da5cd0e6fe">Threshold</a> &#42;= <a href="#a87dfce8f7ae9d7942d55ac782438dbf8">UnrollThresholdFactor</a>;</span></CodeLine>
<Link id="l05535" /><CodeLine lineNumber="5535"><span class="doxyHighlight">  UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#ae28e05c1aac288aa7e4a49d858b35c46">PartialThreshold</a> &#42;= <a href="#a87dfce8f7ae9d7942d55ac782438dbf8">UnrollThresholdFactor</a>;</span></CodeLine>
<Link id="l05536" /><CodeLine lineNumber="5536"></CodeLine>
<Link id="l05537" /><CodeLine lineNumber="5537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use normal unroll factors even if the rest of the code is optimized for</span></CodeLine>
<Link id="l05538" /><CodeLine lineNumber="5538"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// size.</span></CodeLine>
<Link id="l05539" /><CodeLine lineNumber="5539"><span class="doxyHighlight">  UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#af9a7105299bd43b8b61c803f26e4a31b">OptSizeThreshold</a> = UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#a21e7febf468c370793f606da5cd0e6fe">Threshold</a>;</span></CodeLine>
<Link id="l05540" /><CodeLine lineNumber="5540"><span class="doxyHighlight">  UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#a54b17420c467d2bb9edd2f79e54d2b6f">PartialOptSizeThreshold</a> = UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#ae28e05c1aac288aa7e4a49d858b35c46">PartialThreshold</a>;</span></CodeLine>
<Link id="l05541" /><CodeLine lineNumber="5541"></CodeLine>
<Link id="l05542" /><CodeLine lineNumber="5542"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Unroll heuristic thresholds:\\n&quot;</span></CodeLine>
<Link id="l05543" /><CodeLine lineNumber="5543"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Threshold=&quot;</span><span class="doxyHighlight"> &lt;&lt; UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#a21e7febf468c370793f606da5cd0e6fe">Threshold</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l05544" /><CodeLine lineNumber="5544"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  PartialThreshold=&quot;</span><span class="doxyHighlight"> &lt;&lt; UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#ae28e05c1aac288aa7e4a49d858b35c46">PartialThreshold</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l05545" /><CodeLine lineNumber="5545"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  OptSizeThreshold=&quot;</span><span class="doxyHighlight"> &lt;&lt; UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#af9a7105299bd43b8b61c803f26e4a31b">OptSizeThreshold</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l05546" /><CodeLine lineNumber="5546"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  PartialOptSizeThreshold=&quot;</span></CodeLine>
<Link id="l05547" /><CodeLine lineNumber="5547"><span class="doxyHighlight">                    &lt;&lt; UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#a54b17420c467d2bb9edd2f79e54d2b6f">PartialOptSizeThreshold</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05548" /><CodeLine lineNumber="5548"></CodeLine>
<Link id="l05549" /><CodeLine lineNumber="5549"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Disable peeling.</span></CodeLine>
<Link id="l05550" /><CodeLine lineNumber="5550"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/targettransforminfo/peelingpreferences">TargetTransformInfo::PeelingPreferences</a> PP =</span></CodeLine>
<Link id="l05551" /><CodeLine lineNumber="5551"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a6e86d0ac2e968adc60290ca52da02e42">gatherPeelingPreferences</a>(L, SE, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l05552" /><CodeLine lineNumber="5552"><span class="doxyHighlight">                               </span><span class="doxyHighlightComment">/&#42;UserAllowPeeling=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05553" /><CodeLine lineNumber="5553"><span class="doxyHighlight">                               </span><span class="doxyHighlightComment">/&#42;UserAllowProfileBasedPeeling=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05554" /><CodeLine lineNumber="5554"><span class="doxyHighlight">                               </span><span class="doxyHighlightComment">/&#42;UnrollingSpecficValues=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05555" /><CodeLine lineNumber="5555"></CodeLine>
<Link id="l05556" /><CodeLine lineNumber="5556"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 32&gt;</a> EphValues;</span></CodeLine>
<Link id="l05557" /><CodeLine lineNumber="5557"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/codemetrics/#a7e174506b52ad46ea1f746a7f727d999">CodeMetrics::collectEphemeralValues</a>(L, &amp;AC, EphValues);</span></CodeLine>
<Link id="l05558" /><CodeLine lineNumber="5558"></CodeLine>
<Link id="l05559" /><CodeLine lineNumber="5559"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Assume that reads and writes to stack variables can be eliminated by</span></CodeLine>
<Link id="l05560" /><CodeLine lineNumber="5560"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Mem2Reg, SROA or LICM. That is, don&#39;t count them towards the loop body&#39;s</span></CodeLine>
<Link id="l05561" /><CodeLine lineNumber="5561"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// size.</span></CodeLine>
<Link id="l05562" /><CodeLine lineNumber="5562"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : L-&gt;blocks()) &#123;</span></CodeLine>
<Link id="l05563" /><CodeLine lineNumber="5563"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l05564" /><CodeLine lineNumber="5564"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>;</span></CodeLine>
<Link id="l05565" /><CodeLine lineNumber="5565"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Load = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l05566" /><CodeLine lineNumber="5566"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = Load-&gt;getPointerOperand();</span></CodeLine>
<Link id="l05567" /><CodeLine lineNumber="5567"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Store = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l05568" /><CodeLine lineNumber="5568"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = Store-&gt;getPointerOperand();</span></CodeLine>
<Link id="l05569" /><CodeLine lineNumber="5569"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05570" /><CodeLine lineNumber="5570"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05571" /><CodeLine lineNumber="5571"></CodeLine>
<Link id="l05572" /><CodeLine lineNumber="5572"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;stripPointerCasts();</span></CodeLine>
<Link id="l05573" /><CodeLine lineNumber="5573"></CodeLine>
<Link id="l05574" /><CodeLine lineNumber="5574"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Alloca = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)) &#123;</span></CodeLine>
<Link id="l05575" /><CodeLine lineNumber="5575"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Alloca-&gt;getParent() == &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getEntryBlock())</span></CodeLine>
<Link id="l05576" /><CodeLine lineNumber="5576"><span class="doxyHighlight">          EphValues.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05577" /><CodeLine lineNumber="5577"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05578" /><CodeLine lineNumber="5578"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05579" /><CodeLine lineNumber="5579"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05580" /><CodeLine lineNumber="5580"></CodeLine>
<Link id="l05581" /><CodeLine lineNumber="5581"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/unrollcostestimator">UnrollCostEstimator</a> UCE(L, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, EphValues, UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#acc2a7ecc1c0355035c91448ed850390f">BEInsns</a>);</span></CodeLine>
<Link id="l05582" /><CodeLine lineNumber="5582"></CodeLine>
<Link id="l05583" /><CodeLine lineNumber="5583"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loop is not unrollable if the loop contains certain instructions.</span></CodeLine>
<Link id="l05584" /><CodeLine lineNumber="5584"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UCE.<a href="/docs/api/classes/llvm/unrollcostestimator/#a8170d7668dde15a0223b899ffc3380e5">canUnroll</a>()) &#123;</span></CodeLine>
<Link id="l05585" /><CodeLine lineNumber="5585"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Loop not considered unrollable\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05586" /><CodeLine lineNumber="5586"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 1;</span></CodeLine>
<Link id="l05587" /><CodeLine lineNumber="5587"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05588" /><CodeLine lineNumber="5588"></CodeLine>
<Link id="l05589" /><CodeLine lineNumber="5589"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Estimated loop size is &quot;</span><span class="doxyHighlight"> &lt;&lt; UCE.<a href="/docs/api/classes/llvm/unrollcostestimator/#afcdc5884d4a759a519a679fc4293c0e0">getRolledLoopSize</a>()</span></CodeLine>
<Link id="l05590" /><CodeLine lineNumber="5590"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05591" /><CodeLine lineNumber="5591"></CodeLine>
<Link id="l05592" /><CodeLine lineNumber="5592"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Determine trip count of \\p CLI if constant, computeUnrollCount might</span></CodeLine>
<Link id="l05593" /><CodeLine lineNumber="5593"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be able to use it.</span></CodeLine>
<Link id="l05594" /><CodeLine lineNumber="5594"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> TripCount = 0;</span></CodeLine>
<Link id="l05595" /><CodeLine lineNumber="5595"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> MaxTripCount = 0;</span></CodeLine>
<Link id="l05596" /><CodeLine lineNumber="5596"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MaxOrZero = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05597" /><CodeLine lineNumber="5597"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TripMultiple = 0;</span></CodeLine>
<Link id="l05598" /><CodeLine lineNumber="5598"></CodeLine>
<Link id="l05599" /><CodeLine lineNumber="5599"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseUpperBound = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05600" /><CodeLine lineNumber="5600"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a921421142b15c9fb9196fc4b0d7b77cb">computeUnrollCount</a>(L, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, DT, &amp;LI, &amp;AC, SE, EphValues, &amp;ORE, TripCount,</span></CodeLine>
<Link id="l05601" /><CodeLine lineNumber="5601"><span class="doxyHighlight">                     MaxTripCount, MaxOrZero, TripMultiple, UCE, UP, PP,</span></CodeLine>
<Link id="l05602" /><CodeLine lineNumber="5602"><span class="doxyHighlight">                     UseUpperBound);</span></CodeLine>
<Link id="l05603" /><CodeLine lineNumber="5603"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Factor = UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#a19cc5df79c699ab1e137118b8c472a9e">Count</a>;</span></CodeLine>
<Link id="l05604" /><CodeLine lineNumber="5604"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Suggesting unroll factor of &quot;</span><span class="doxyHighlight"> &lt;&lt; Factor &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05605" /><CodeLine lineNumber="5605"></CodeLine>
<Link id="l05606" /><CodeLine lineNumber="5606"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This function returns 1 to signal to not unroll a loop.</span></CodeLine>
<Link id="l05607" /><CodeLine lineNumber="5607"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Factor == 0)</span></CodeLine>
<Link id="l05608" /><CodeLine lineNumber="5608"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 1;</span></CodeLine>
<Link id="l05609" /><CodeLine lineNumber="5609"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Factor;</span></CodeLine>
<Link id="l05610" /><CodeLine lineNumber="5610"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05611" /><CodeLine lineNumber="5611"></CodeLine>
<Link id="l05612" /><CodeLine lineNumber="5612" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a5e2b7ac5f48193117a340aa15b085719"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#a5e2b7ac5f48193117a340aa15b085719">OpenMPIRBuilder::unrollLoopPartial</a>(<a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;<a href="/docs/api/classes/llvm/loop">Loop</a>,</span></CodeLine>
<Link id="l05613" /><CodeLine lineNumber="5613"><span class="doxyHighlight">                                        int32&#95;t Factor,</span></CodeLine>
<Link id="l05614" /><CodeLine lineNumber="5614"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;&#42;UnrolledCLI) &#123;</span></CodeLine>
<Link id="l05615" /><CodeLine lineNumber="5615"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Factor &gt;= 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unroll factor must not be negative&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05616" /><CodeLine lineNumber="5616"></CodeLine>
<Link id="l05617" /><CodeLine lineNumber="5617"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/classes/llvm/loop">Loop</a>-&gt;getFunction();</span></CodeLine>
<Link id="l05618" /><CodeLine lineNumber="5618"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getContext();</span></CodeLine>
<Link id="l05619" /><CodeLine lineNumber="5619"></CodeLine>
<Link id="l05620" /><CodeLine lineNumber="5620"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the unrolled loop is not used for another loop-associated directive, it</span></CodeLine>
<Link id="l05621" /><CodeLine lineNumber="5621"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is sufficient to add metadata for the LoopUnrollPass.</span></CodeLine>
<Link id="l05622" /><CodeLine lineNumber="5622"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UnrolledCLI) &#123;</span></CodeLine>
<Link id="l05623" /><CodeLine lineNumber="5623"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;, 2&gt;</a> LoopMetadata;</span></CodeLine>
<Link id="l05624" /><CodeLine lineNumber="5624"><span class="doxyHighlight">    LoopMetadata.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l05625" /><CodeLine lineNumber="5625"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.unroll.enable&quot;</span><span class="doxyHighlight">)));</span></CodeLine>
<Link id="l05626" /><CodeLine lineNumber="5626"></CodeLine>
<Link id="l05627" /><CodeLine lineNumber="5627"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Factor &gt;= 1) &#123;</span></CodeLine>
<Link id="l05628" /><CodeLine lineNumber="5628"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantasmetadata">ConstantAsMetadata</a> &#42;FactorConst = <a href="/docs/api/classes/llvm/constantasmetadata/#a4c720c398a263087e00d7358b05636d5">ConstantAsMetadata::get</a>(</span></CodeLine>
<Link id="l05629" /><CodeLine lineNumber="5629"><span class="doxyHighlight">          ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx), <a href="/docs/api/classes/llvm/apint">APInt</a>(32, Factor)));</span></CodeLine>
<Link id="l05630" /><CodeLine lineNumber="5630"><span class="doxyHighlight">      LoopMetadata.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(</span></CodeLine>
<Link id="l05631" /><CodeLine lineNumber="5631"><span class="doxyHighlight">          Ctx, &#123;<a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.unroll.count&quot;</span><span class="doxyHighlight">), FactorConst&#125;));</span></CodeLine>
<Link id="l05632" /><CodeLine lineNumber="5632"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05633" /><CodeLine lineNumber="5633"></CodeLine>
<Link id="l05634" /><CodeLine lineNumber="5634"><span class="doxyHighlight">    <a href="#adf813540e363817b85e9eecef51269b5">addLoopMetadata</a>(<a href="/docs/api/classes/llvm/loop">Loop</a>, LoopMetadata);</span></CodeLine>
<Link id="l05635" /><CodeLine lineNumber="5635"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05636" /><CodeLine lineNumber="5636"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05637" /><CodeLine lineNumber="5637"></CodeLine>
<Link id="l05638" /><CodeLine lineNumber="5638"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Heuristically determine the unroll factor.</span></CodeLine>
<Link id="l05639" /><CodeLine lineNumber="5639"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Factor == 0)</span></CodeLine>
<Link id="l05640" /><CodeLine lineNumber="5640"><span class="doxyHighlight">    Factor = <a href="#a946282957319b8c23ab9f169abb504c4">computeHeuristicUnrollFactor</a>(<a href="/docs/api/classes/llvm/loop">Loop</a>);</span></CodeLine>
<Link id="l05641" /><CodeLine lineNumber="5641"></CodeLine>
<Link id="l05642" /><CodeLine lineNumber="5642"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// No change required with unroll factor 1</span></CodeLine>
<Link id="l05643" /><CodeLine lineNumber="5643"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Factor == 1) &#123;</span></CodeLine>
<Link id="l05644" /><CodeLine lineNumber="5644"><span class="doxyHighlight">    &#42;UnrolledCLI = <a href="/docs/api/classes/llvm/loop">Loop</a>;</span></CodeLine>
<Link id="l05645" /><CodeLine lineNumber="5645"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05646" /><CodeLine lineNumber="5646"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05647" /><CodeLine lineNumber="5647"></CodeLine>
<Link id="l05648" /><CodeLine lineNumber="5648"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Factor &gt;= 2 &amp;&amp;</span></CodeLine>
<Link id="l05649" /><CodeLine lineNumber="5649"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;unrolling only makes sense with a factor of 2 or larger&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05650" /><CodeLine lineNumber="5650"></CodeLine>
<Link id="l05651" /><CodeLine lineNumber="5651"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;IndVarTy = <a href="/docs/api/classes/llvm/loop">Loop</a>-&gt;getIndVarType();</span></CodeLine>
<Link id="l05652" /><CodeLine lineNumber="5652"></CodeLine>
<Link id="l05653" /><CodeLine lineNumber="5653"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Apply partial unrolling by tiling the loop by the unroll-factor, then fully</span></CodeLine>
<Link id="l05654" /><CodeLine lineNumber="5654"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unroll the inner loop.</span></CodeLine>
<Link id="l05655" /><CodeLine lineNumber="5655"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;FactorVal =</span></CodeLine>
<Link id="l05656" /><CodeLine lineNumber="5656"><span class="doxyHighlight">      ConstantInt::get(IndVarTy, <a href="/docs/api/classes/llvm/apint">APInt</a>(IndVarTy-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>(), Factor,</span></CodeLine>
<Link id="l05657" /><CodeLine lineNumber="5657"><span class="doxyHighlight">                                       </span><span class="doxyHighlightComment">/&#42;isSigned=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l05658" /><CodeLine lineNumber="5658"><span class="doxyHighlight">  std::vector&lt;CanonicalLoopInfo &#42;&gt; <a href="/docs/api/classes/llvm/loopnest">LoopNest</a> =</span></CodeLine>
<Link id="l05659" /><CodeLine lineNumber="5659"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#a76e12ec076e7af4be7b8b77a5d53d3fc">tileLoops</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, &#123;<a href="/docs/api/classes/llvm/loop">Loop</a>&#125;, &#123;FactorVal&#125;);</span></CodeLine>
<Link id="l05660" /><CodeLine lineNumber="5660"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/loopnest">LoopNest</a>.size() == 2 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expect 2 loops after tiling&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05661" /><CodeLine lineNumber="5661"><span class="doxyHighlight">  &#42;UnrolledCLI = <a href="/docs/api/classes/llvm/loopnest">LoopNest</a>&#91;0&#93;;</span></CodeLine>
<Link id="l05662" /><CodeLine lineNumber="5662"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/canonicalloopinfo">CanonicalLoopInfo</a> &#42;InnerLoop = <a href="/docs/api/classes/llvm/loopnest">LoopNest</a>&#91;1&#93;;</span></CodeLine>
<Link id="l05663" /><CodeLine lineNumber="5663"></CodeLine>
<Link id="l05664" /><CodeLine lineNumber="5664"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LoopUnrollPass can only fully unroll loops with constant trip count.</span></CodeLine>
<Link id="l05665" /><CodeLine lineNumber="5665"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Unroll by the unroll factor with a fallback epilog for the remainder</span></CodeLine>
<Link id="l05666" /><CodeLine lineNumber="5666"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iterations if necessary.</span></CodeLine>
<Link id="l05667" /><CodeLine lineNumber="5667"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantasmetadata">ConstantAsMetadata</a> &#42;FactorConst = <a href="/docs/api/classes/llvm/constantasmetadata/#a4c720c398a263087e00d7358b05636d5">ConstantAsMetadata::get</a>(</span></CodeLine>
<Link id="l05668" /><CodeLine lineNumber="5668"><span class="doxyHighlight">      ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx), <a href="/docs/api/classes/llvm/apint">APInt</a>(32, Factor)));</span></CodeLine>
<Link id="l05669" /><CodeLine lineNumber="5669"><span class="doxyHighlight">  <a href="#adf813540e363817b85e9eecef51269b5">addLoopMetadata</a>(</span></CodeLine>
<Link id="l05670" /><CodeLine lineNumber="5670"><span class="doxyHighlight">      InnerLoop,</span></CodeLine>
<Link id="l05671" /><CodeLine lineNumber="5671"><span class="doxyHighlight">      &#123;<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.unroll.enable&quot;</span><span class="doxyHighlight">)),</span></CodeLine>
<Link id="l05672" /><CodeLine lineNumber="5672"><span class="doxyHighlight">       <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(</span></CodeLine>
<Link id="l05673" /><CodeLine lineNumber="5673"><span class="doxyHighlight">           Ctx, &#123;<a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ctx, </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.unroll.count&quot;</span><span class="doxyHighlight">), FactorConst&#125;)&#125;);</span></CodeLine>
<Link id="l05674" /><CodeLine lineNumber="5674"></CodeLine>
<Link id="l05675" /><CodeLine lineNumber="5675"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l05676" /><CodeLine lineNumber="5676"><span class="doxyHighlight">  (&#42;UnrolledCLI)-&gt;assertOK();</span></CodeLine>
<Link id="l05677" /><CodeLine lineNumber="5677"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l05678" /><CodeLine lineNumber="5678"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05679" /><CodeLine lineNumber="5679"></CodeLine>
<Link id="l05680" /><CodeLine lineNumber="5680"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a></span></CodeLine>
<Link id="l05681" /><CodeLine lineNumber="5681"><span class="doxyHighlight">OpenMPIRBuilder::createCopyPrivate(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l05682" /><CodeLine lineNumber="5682"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;BufSize, <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;CpyBuf,</span></CodeLine>
<Link id="l05683" /><CodeLine lineNumber="5683"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;CpyFn, <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;DidIt) &#123;</span></CodeLine>
<Link id="l05684" /><CodeLine lineNumber="5684"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l05685" /><CodeLine lineNumber="5685"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP;</span></CodeLine>
<Link id="l05686" /><CodeLine lineNumber="5686"></CodeLine>
<Link id="l05687" /><CodeLine lineNumber="5687"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l05688" /><CodeLine lineNumber="5688"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, SrcLocStrSize);</span></CodeLine>
<Link id="l05689" /><CodeLine lineNumber="5689"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l05690" /><CodeLine lineNumber="5690"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l05691" /><CodeLine lineNumber="5691"></CodeLine>
<Link id="l05692" /><CodeLine lineNumber="5692"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;DidItLD = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), DidIt);</span></CodeLine>
<Link id="l05693" /><CodeLine lineNumber="5693"></CodeLine>
<Link id="l05694" /><CodeLine lineNumber="5694"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Args&#91;&#93; = &#123;Ident, ThreadId, BufSize, CpyBuf, CpyFn, DidItLD&#125;;</span></CodeLine>
<Link id="l05695" /><CodeLine lineNumber="5695"></CodeLine>
<Link id="l05696" /><CodeLine lineNumber="5696"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Fn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;copyprivate);</span></CodeLine>
<Link id="l05697" /><CodeLine lineNumber="5697"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(Fn, Args);</span></CodeLine>
<Link id="l05698" /><CodeLine lineNumber="5698"></CodeLine>
<Link id="l05699" /><CodeLine lineNumber="5699"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l05700" /><CodeLine lineNumber="5700"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05701" /><CodeLine lineNumber="5701"></CodeLine>
<Link id="l05702" /><CodeLine lineNumber="5702"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> OpenMPIRBuilder::createSingle(</span></CodeLine>
<Link id="l05703" /><CodeLine lineNumber="5703"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, BodyGenCallbackTy BodyGenCB,</span></CodeLine>
<Link id="l05704" /><CodeLine lineNumber="5704"><span class="doxyHighlight">    FinalizeCallbackTy FiniCB, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNowait, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;llvm::Value &#42;&gt;</a> CPVars,</span></CodeLine>
<Link id="l05705" /><CodeLine lineNumber="5705"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;llvm::Function &#42;&gt;</a> CPFuncs) &#123;</span></CodeLine>
<Link id="l05706" /><CodeLine lineNumber="5706"></CodeLine>
<Link id="l05707" /><CodeLine lineNumber="5707"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l05708" /><CodeLine lineNumber="5708"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Loc.IP;</span></CodeLine>
<Link id="l05709" /><CodeLine lineNumber="5709"></CodeLine>
<Link id="l05710" /><CodeLine lineNumber="5710"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If needed allocate and initialize &#96;DidIt&#96; with 0</span></CodeLine>
<Link id="l05711" /><CodeLine lineNumber="5711"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DidIt: flag variable: 1=single thread; 0=not single thread.</span></CodeLine>
<Link id="l05712" /><CodeLine lineNumber="5712"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">llvm::Value</a> &#42;DidIt = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05713" /><CodeLine lineNumber="5713"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CPVars.<a href="/docs/api/classes/llvm/arrayref/#ac835b8735b1b2faec0efdca236e37d94">empty</a>()) &#123;</span></CodeLine>
<Link id="l05714" /><CodeLine lineNumber="5714"><span class="doxyHighlight">    DidIt = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">llvm::Type::getInt32Ty</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>()));</span></CodeLine>
<Link id="l05715" /><CodeLine lineNumber="5715"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(0), DidIt);</span></CodeLine>
<Link id="l05716" /><CodeLine lineNumber="5716"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05717" /><CodeLine lineNumber="5717"></CodeLine>
<Link id="l05718" /><CodeLine lineNumber="5718"><span class="doxyHighlight">  Directive OMPD = Directive::OMPD&#95;single;</span></CodeLine>
<Link id="l05719" /><CodeLine lineNumber="5719"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l05720" /><CodeLine lineNumber="5720"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l05721" /><CodeLine lineNumber="5721"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l05722" /><CodeLine lineNumber="5722"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l05723" /><CodeLine lineNumber="5723"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;Ident, ThreadId&#125;;</span></CodeLine>
<Link id="l05724" /><CodeLine lineNumber="5724"></CodeLine>
<Link id="l05725" /><CodeLine lineNumber="5725"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;EntryRTLFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;single);</span></CodeLine>
<Link id="l05726" /><CodeLine lineNumber="5726"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;EntryCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(EntryRTLFn, Args);</span></CodeLine>
<Link id="l05727" /><CodeLine lineNumber="5727"></CodeLine>
<Link id="l05728" /><CodeLine lineNumber="5728"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;ExitRTLFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;end&#95;single);</span></CodeLine>
<Link id="l05729" /><CodeLine lineNumber="5729"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExitCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(ExitRTLFn, Args);</span></CodeLine>
<Link id="l05730" /><CodeLine lineNumber="5730"></CodeLine>
<Link id="l05731" /><CodeLine lineNumber="5731"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FiniCBWrapper = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> IP) -&gt; <a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> &#123;</span></CodeLine>
<Link id="l05732" /><CodeLine lineNumber="5732"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = FiniCB(IP))</span></CodeLine>
<Link id="l05733" /><CodeLine lineNumber="5733"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l05734" /><CodeLine lineNumber="5734"></CodeLine>
<Link id="l05735" /><CodeLine lineNumber="5735"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The thread that executes the single region must set &#96;DidIt&#96; to 1</span></CodeLine>
<Link id="l05736" /><CodeLine lineNumber="5736"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This is used by &#95;&#95;kmpc&#95;copyprivate, to know if the caller is the</span></CodeLine>
<Link id="l05737" /><CodeLine lineNumber="5737"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// single thread or not.</span></CodeLine>
<Link id="l05738" /><CodeLine lineNumber="5738"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DidIt)</span></CodeLine>
<Link id="l05739" /><CodeLine lineNumber="5739"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(1), DidIt);</span></CodeLine>
<Link id="l05740" /><CodeLine lineNumber="5740"></CodeLine>
<Link id="l05741" /><CodeLine lineNumber="5741"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l05742" /><CodeLine lineNumber="5742"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l05743" /><CodeLine lineNumber="5743"></CodeLine>
<Link id="l05744" /><CodeLine lineNumber="5744"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// generates the following:</span></CodeLine>
<Link id="l05745" /><CodeLine lineNumber="5745"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if (&#95;&#95;kmpc&#95;single()) &#123;</span></CodeLine>
<Link id="l05746" /><CodeLine lineNumber="5746"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    .... single region ...</span></CodeLine>
<Link id="l05747" /><CodeLine lineNumber="5747"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    &#95;&#95;kmpc&#95;end&#95;single</span></CodeLine>
<Link id="l05748" /><CodeLine lineNumber="5748"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#125;</span></CodeLine>
<Link id="l05749" /><CodeLine lineNumber="5749"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#95;&#95;kmpc&#95;copyprivate</span></CodeLine>
<Link id="l05750" /><CodeLine lineNumber="5750"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#95;&#95;kmpc&#95;barrier</span></CodeLine>
<Link id="l05751" /><CodeLine lineNumber="5751"></CodeLine>
<Link id="l05752" /><CodeLine lineNumber="5752"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l05753" /><CodeLine lineNumber="5753"><span class="doxyHighlight">      EmitOMPInlinedRegion(OMPD, EntryCall, ExitCall, BodyGenCB, FiniCBWrapper,</span></CodeLine>
<Link id="l05754" /><CodeLine lineNumber="5754"><span class="doxyHighlight">                           </span><span class="doxyHighlightComment">/&#42;Conditional&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05755" /><CodeLine lineNumber="5755"><span class="doxyHighlight">                           </span><span class="doxyHighlightComment">/&#42;hasFinalize&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05756" /><CodeLine lineNumber="5756"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l05757" /><CodeLine lineNumber="5757"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l05758" /><CodeLine lineNumber="5758"></CodeLine>
<Link id="l05759" /><CodeLine lineNumber="5759"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DidIt) &#123;</span></CodeLine>
<Link id="l05760" /><CodeLine lineNumber="5760"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = CPVars.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l05761" /><CodeLine lineNumber="5761"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// NOTE BufSize is currently unused, so just pass 0</span></CodeLine>
<Link id="l05762" /><CodeLine lineNumber="5762"><span class="doxyHighlight">      createCopyPrivate(<a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), Loc.DL),</span></CodeLine>
<Link id="l05763" /><CodeLine lineNumber="5763"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42;BufSize=&#42;/</span><span class="doxyHighlight">ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872ada475947399b8ab4d13d40fea50f950c">Int64</a>, 0), CPVars&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;,</span></CodeLine>
<Link id="l05764" /><CodeLine lineNumber="5764"><span class="doxyHighlight">                        CPFuncs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;, DidIt);</span></CodeLine>
<Link id="l05765" /><CodeLine lineNumber="5765"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// NOTE &#95;&#95;kmpc&#95;copyprivate already inserts a barrier</span></CodeLine>
<Link id="l05766" /><CodeLine lineNumber="5766"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsNowait) &#123;</span></CodeLine>
<Link id="l05767" /><CodeLine lineNumber="5767"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l05768" /><CodeLine lineNumber="5768"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/openmpirbuilder/#abca6530c9099bd1b1c3e0a5c32381f07">createBarrier</a>(<a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), Loc.DL),</span></CodeLine>
<Link id="l05769" /><CodeLine lineNumber="5769"><span class="doxyHighlight">                      omp::Directive::OMPD&#95;unknown, </span><span class="doxyHighlightComment">/&#42; ForceSimpleCall &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05770" /><CodeLine lineNumber="5770"><span class="doxyHighlight">                      </span><span class="doxyHighlightComment">/&#42; CheckCancelFlag &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05771" /><CodeLine lineNumber="5771"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l05772" /><CodeLine lineNumber="5772"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l05773" /><CodeLine lineNumber="5773"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05774" /><CodeLine lineNumber="5774"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l05775" /><CodeLine lineNumber="5775"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05776" /><CodeLine lineNumber="5776"></CodeLine>
<Link id="l05777" /><CodeLine lineNumber="5777"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> OpenMPIRBuilder::createCritical(</span></CodeLine>
<Link id="l05778" /><CodeLine lineNumber="5778"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, BodyGenCallbackTy BodyGenCB,</span></CodeLine>
<Link id="l05779" /><CodeLine lineNumber="5779"><span class="doxyHighlight">    FinalizeCallbackTy FiniCB, <a href="/docs/api/classes/llvm/stringref">StringRef</a> CriticalName, <a href="/docs/api/classes/llvm/value">Value</a> &#42;HintInst) &#123;</span></CodeLine>
<Link id="l05780" /><CodeLine lineNumber="5780"></CodeLine>
<Link id="l05781" /><CodeLine lineNumber="5781"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l05782" /><CodeLine lineNumber="5782"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Loc.IP;</span></CodeLine>
<Link id="l05783" /><CodeLine lineNumber="5783"></CodeLine>
<Link id="l05784" /><CodeLine lineNumber="5784"><span class="doxyHighlight">  Directive OMPD = Directive::OMPD&#95;critical;</span></CodeLine>
<Link id="l05785" /><CodeLine lineNumber="5785"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l05786" /><CodeLine lineNumber="5786"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l05787" /><CodeLine lineNumber="5787"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l05788" /><CodeLine lineNumber="5788"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l05789" /><CodeLine lineNumber="5789"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LockVar = getOMPCriticalRegionLock(CriticalName);</span></CodeLine>
<Link id="l05790" /><CodeLine lineNumber="5790"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;Ident, ThreadId, LockVar&#125;;</span></CodeLine>
<Link id="l05791" /><CodeLine lineNumber="5791"></CodeLine>
<Link id="l05792" /><CodeLine lineNumber="5792"><span class="doxyHighlight">  SmallVector&lt;llvm::Value &#42;, 4&gt; EnterArgs(std::begin(Args), std::end(Args));</span></CodeLine>
<Link id="l05793" /><CodeLine lineNumber="5793"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;RTFn = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05794" /><CodeLine lineNumber="5794"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HintInst) &#123;</span></CodeLine>
<Link id="l05795" /><CodeLine lineNumber="5795"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add Hint to entry Args and create call</span></CodeLine>
<Link id="l05796" /><CodeLine lineNumber="5796"><span class="doxyHighlight">    EnterArgs.push&#95;back(HintInst);</span></CodeLine>
<Link id="l05797" /><CodeLine lineNumber="5797"><span class="doxyHighlight">    RTFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;critical&#95;with&#95;hint);</span></CodeLine>
<Link id="l05798" /><CodeLine lineNumber="5798"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05799" /><CodeLine lineNumber="5799"><span class="doxyHighlight">    RTFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;critical);</span></CodeLine>
<Link id="l05800" /><CodeLine lineNumber="5800"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05801" /><CodeLine lineNumber="5801"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;EntryCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(RTFn, EnterArgs);</span></CodeLine>
<Link id="l05802" /><CodeLine lineNumber="5802"></CodeLine>
<Link id="l05803" /><CodeLine lineNumber="5803"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;ExitRTLFn =</span></CodeLine>
<Link id="l05804" /><CodeLine lineNumber="5804"><span class="doxyHighlight">      getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;end&#95;critical);</span></CodeLine>
<Link id="l05805" /><CodeLine lineNumber="5805"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExitCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(ExitRTLFn, Args);</span></CodeLine>
<Link id="l05806" /><CodeLine lineNumber="5806"></CodeLine>
<Link id="l05807" /><CodeLine lineNumber="5807"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EmitOMPInlinedRegion(OMPD, EntryCall, ExitCall, BodyGenCB, FiniCB,</span></CodeLine>
<Link id="l05808" /><CodeLine lineNumber="5808"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;Conditional&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;hasFinalize&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05809" /><CodeLine lineNumber="5809"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05810" /><CodeLine lineNumber="5810"></CodeLine>
<Link id="l05811" /><CodeLine lineNumber="5811"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a></span></CodeLine>
<Link id="l05812" /><CodeLine lineNumber="5812"><span class="doxyHighlight">OpenMPIRBuilder::createOrderedDepend(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l05813" /><CodeLine lineNumber="5813"><span class="doxyHighlight">                                     InsertPointTy AllocaIP, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumLoops,</span></CodeLine>
<Link id="l05814" /><CodeLine lineNumber="5814"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;llvm::Value &#42;&gt;</a> StoreValues,</span></CodeLine>
<Link id="l05815" /><CodeLine lineNumber="5815"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsDependSource) &#123;</span></CodeLine>
<Link id="l05816" /><CodeLine lineNumber="5816"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l05817" /><CodeLine lineNumber="5817"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(StoreValues,</span></CodeLine>
<Link id="l05818" /><CodeLine lineNumber="5818"><span class="doxyHighlight">                   &#91;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SV) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>(64); &#125;) &amp;&amp;</span></CodeLine>
<Link id="l05819" /><CodeLine lineNumber="5819"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;OpenMP runtime requires depend vec with i64 type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05820" /><CodeLine lineNumber="5820"></CodeLine>
<Link id="l05821" /><CodeLine lineNumber="5821"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l05822" /><CodeLine lineNumber="5822"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Loc.IP;</span></CodeLine>
<Link id="l05823" /><CodeLine lineNumber="5823"></CodeLine>
<Link id="l05824" /><CodeLine lineNumber="5824"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Allocate space for vector and generate alloc instruction.</span></CodeLine>
<Link id="l05825" /><CodeLine lineNumber="5825"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ArrI64Ty = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872ada475947399b8ab4d13d40fea50f950c">Int64</a>, NumLoops);</span></CodeLine>
<Link id="l05826" /><CodeLine lineNumber="5826"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l05827" /><CodeLine lineNumber="5827"><span class="doxyHighlight">  AllocaInst &#42;ArgsBase = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(ArrI64Ty, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, Name);</span></CodeLine>
<Link id="l05828" /><CodeLine lineNumber="5828"><span class="doxyHighlight">  ArgsBase-&gt;<a href="/docs/api/classes/llvm/allocainst/#af3bb24b322533dbe8a63c84b18568fe1">setAlignment</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a>(8));</span></CodeLine>
<Link id="l05829" /><CodeLine lineNumber="5829"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(Loc.IP);</span></CodeLine>
<Link id="l05830" /><CodeLine lineNumber="5830"></CodeLine>
<Link id="l05831" /><CodeLine lineNumber="5831"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Store the index value with offset in depend vector.</span></CodeLine>
<Link id="l05832" /><CodeLine lineNumber="5832"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumLoops; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l05833" /><CodeLine lineNumber="5833"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DependAddrGEPIter = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l05834" /><CodeLine lineNumber="5834"><span class="doxyHighlight">        ArrI64Ty, ArgsBase, &#123;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(0), Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)&#125;);</span></CodeLine>
<Link id="l05835" /><CodeLine lineNumber="5835"><span class="doxyHighlight">    StoreInst &#42;STInst = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(StoreValues&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;, DependAddrGEPIter);</span></CodeLine>
<Link id="l05836" /><CodeLine lineNumber="5836"><span class="doxyHighlight">    STInst-&gt;<a href="/docs/api/classes/llvm/storeinst/#a55195fa18cf783fe74de0cced1ca6eb3">setAlignment</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a>(8));</span></CodeLine>
<Link id="l05837" /><CodeLine lineNumber="5837"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05838" /><CodeLine lineNumber="5838"></CodeLine>
<Link id="l05839" /><CodeLine lineNumber="5839"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DependBaseAddrGEP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l05840" /><CodeLine lineNumber="5840"><span class="doxyHighlight">      ArrI64Ty, ArgsBase, &#123;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(0), Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(0)&#125;);</span></CodeLine>
<Link id="l05841" /><CodeLine lineNumber="5841"></CodeLine>
<Link id="l05842" /><CodeLine lineNumber="5842"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l05843" /><CodeLine lineNumber="5843"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l05844" /><CodeLine lineNumber="5844"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l05845" /><CodeLine lineNumber="5845"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l05846" /><CodeLine lineNumber="5846"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;Ident, ThreadId, DependBaseAddrGEP&#125;;</span></CodeLine>
<Link id="l05847" /><CodeLine lineNumber="5847"></CodeLine>
<Link id="l05848" /><CodeLine lineNumber="5848"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;RTLFn = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05849" /><CodeLine lineNumber="5849"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsDependSource)</span></CodeLine>
<Link id="l05850" /><CodeLine lineNumber="5850"><span class="doxyHighlight">    RTLFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;doacross&#95;post);</span></CodeLine>
<Link id="l05851" /><CodeLine lineNumber="5851"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05852" /><CodeLine lineNumber="5852"><span class="doxyHighlight">    RTLFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;doacross&#95;wait);</span></CodeLine>
<Link id="l05853" /><CodeLine lineNumber="5853"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(RTLFn, Args);</span></CodeLine>
<Link id="l05854" /><CodeLine lineNumber="5854"></CodeLine>
<Link id="l05855" /><CodeLine lineNumber="5855"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l05856" /><CodeLine lineNumber="5856"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05857" /><CodeLine lineNumber="5857"></CodeLine>
<Link id="l05858" /><CodeLine lineNumber="5858"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> OpenMPIRBuilder::createOrderedThreadsSimd(</span></CodeLine>
<Link id="l05859" /><CodeLine lineNumber="5859"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, BodyGenCallbackTy BodyGenCB,</span></CodeLine>
<Link id="l05860" /><CodeLine lineNumber="5860"><span class="doxyHighlight">    FinalizeCallbackTy FiniCB, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsThreads) &#123;</span></CodeLine>
<Link id="l05861" /><CodeLine lineNumber="5861"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l05862" /><CodeLine lineNumber="5862"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Loc.IP;</span></CodeLine>
<Link id="l05863" /><CodeLine lineNumber="5863"></CodeLine>
<Link id="l05864" /><CodeLine lineNumber="5864"><span class="doxyHighlight">  Directive OMPD = Directive::OMPD&#95;ordered;</span></CodeLine>
<Link id="l05865" /><CodeLine lineNumber="5865"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;EntryCall = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05866" /><CodeLine lineNumber="5866"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExitCall = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05867" /><CodeLine lineNumber="5867"></CodeLine>
<Link id="l05868" /><CodeLine lineNumber="5868"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsThreads) &#123;</span></CodeLine>
<Link id="l05869" /><CodeLine lineNumber="5869"><span class="doxyHighlight">    uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l05870" /><CodeLine lineNumber="5870"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l05871" /><CodeLine lineNumber="5871"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l05872" /><CodeLine lineNumber="5872"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l05873" /><CodeLine lineNumber="5873"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;Ident, ThreadId&#125;;</span></CodeLine>
<Link id="l05874" /><CodeLine lineNumber="5874"></CodeLine>
<Link id="l05875" /><CodeLine lineNumber="5875"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;EntryRTLFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;ordered);</span></CodeLine>
<Link id="l05876" /><CodeLine lineNumber="5876"><span class="doxyHighlight">    EntryCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(EntryRTLFn, Args);</span></CodeLine>
<Link id="l05877" /><CodeLine lineNumber="5877"></CodeLine>
<Link id="l05878" /><CodeLine lineNumber="5878"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;ExitRTLFn =</span></CodeLine>
<Link id="l05879" /><CodeLine lineNumber="5879"><span class="doxyHighlight">        getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;end&#95;ordered);</span></CodeLine>
<Link id="l05880" /><CodeLine lineNumber="5880"><span class="doxyHighlight">    ExitCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(ExitRTLFn, Args);</span></CodeLine>
<Link id="l05881" /><CodeLine lineNumber="5881"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05882" /><CodeLine lineNumber="5882"></CodeLine>
<Link id="l05883" /><CodeLine lineNumber="5883"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EmitOMPInlinedRegion(OMPD, EntryCall, ExitCall, BodyGenCB, FiniCB,</span></CodeLine>
<Link id="l05884" /><CodeLine lineNumber="5884"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;Conditional&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;hasFinalize&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05885" /><CodeLine lineNumber="5885"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05886" /><CodeLine lineNumber="5886"></CodeLine>
<Link id="l05887" /><CodeLine lineNumber="5887"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> OpenMPIRBuilder::EmitOMPInlinedRegion(</span></CodeLine>
<Link id="l05888" /><CodeLine lineNumber="5888"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/directive">Directive</a> OMPD, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;EntryCall, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ExitCall,</span></CodeLine>
<Link id="l05889" /><CodeLine lineNumber="5889"><span class="doxyHighlight">    BodyGenCallbackTy BodyGenCB, FinalizeCallbackTy FiniCB, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Conditional,</span></CodeLine>
<Link id="l05890" /><CodeLine lineNumber="5890"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasFinalize, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsCancellable) &#123;</span></CodeLine>
<Link id="l05891" /><CodeLine lineNumber="5891"></CodeLine>
<Link id="l05892" /><CodeLine lineNumber="5892"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasFinalize)</span></CodeLine>
<Link id="l05893" /><CodeLine lineNumber="5893"><span class="doxyHighlight">    FinalizationStack.push&#95;back(&#123;FiniCB, OMPD, IsCancellable&#125;);</span></CodeLine>
<Link id="l05894" /><CodeLine lineNumber="5894"></CodeLine>
<Link id="l05895" /><CodeLine lineNumber="5895"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create inlined region&#39;s entry and body blocks, in preparation</span></CodeLine>
<Link id="l05896" /><CodeLine lineNumber="5896"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for conditional creation</span></CodeLine>
<Link id="l05897" /><CodeLine lineNumber="5897"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EntryBB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l05898" /><CodeLine lineNumber="5898"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;SplitPos = EntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l05899" /><CodeLine lineNumber="5899"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a4956305191cdba7f9995569d011a5ab7">isa&#95;and&#95;nonnull&lt;BranchInst&gt;</a>(SplitPos))</span></CodeLine>
<Link id="l05900" /><CodeLine lineNumber="5900"><span class="doxyHighlight">    SplitPos = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> UnreachableInst(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>(), EntryBB);</span></CodeLine>
<Link id="l05901" /><CodeLine lineNumber="5901"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ExitBB = EntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(SplitPos, </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;region.end&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05902" /><CodeLine lineNumber="5902"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FiniBB =</span></CodeLine>
<Link id="l05903" /><CodeLine lineNumber="5903"><span class="doxyHighlight">      EntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(EntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;region.finalize&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05904" /><CodeLine lineNumber="5904"></CodeLine>
<Link id="l05905" /><CodeLine lineNumber="5905"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l05906" /><CodeLine lineNumber="5906"><span class="doxyHighlight">  emitCommonDirectiveEntry(OMPD, EntryCall, ExitBB, Conditional);</span></CodeLine>
<Link id="l05907" /><CodeLine lineNumber="5907"></CodeLine>
<Link id="l05908" /><CodeLine lineNumber="5908"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// generate body</span></CodeLine>
<Link id="l05909" /><CodeLine lineNumber="5909"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = BodyGenCB(</span><span class="doxyHighlightComment">/&#42; AllocaIP &#42;/</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>(),</span></CodeLine>
<Link id="l05910" /><CodeLine lineNumber="5910"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">/&#42; CodeGenIP &#42;/</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>()))</span></CodeLine>
<Link id="l05911" /><CodeLine lineNumber="5911"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l05912" /><CodeLine lineNumber="5912"></CodeLine>
<Link id="l05913" /><CodeLine lineNumber="5913"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// emit exit call and do any needed finalization.</span></CodeLine>
<Link id="l05914" /><CodeLine lineNumber="5914"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FinIP = <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>(FiniBB, FiniBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l05915" /><CodeLine lineNumber="5915"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FiniBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>() == 1 &amp;&amp;</span></CodeLine>
<Link id="l05916" /><CodeLine lineNumber="5916"><span class="doxyHighlight">         FiniBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(0) == ExitBB &amp;&amp;</span></CodeLine>
<Link id="l05917" /><CodeLine lineNumber="5917"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected control flow graph state!!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05918" /><CodeLine lineNumber="5918"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l05919" /><CodeLine lineNumber="5919"><span class="doxyHighlight">      emitCommonDirectiveExit(OMPD, FinIP, ExitCall, HasFinalize);</span></CodeLine>
<Link id="l05920" /><CodeLine lineNumber="5920"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l05921" /><CodeLine lineNumber="5921"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l05922" /><CodeLine lineNumber="5922"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FiniBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a74aa9daea070e2ad3394a3ec58b7316a">getUniquePredecessor</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a57f1945911ca1e95d0f51d7c3516b529">getUniqueSuccessor</a>() == FiniBB &amp;&amp;</span></CodeLine>
<Link id="l05923" /><CodeLine lineNumber="5923"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected Control Flow State!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05924" /><CodeLine lineNumber="5924"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(FiniBB);</span></CodeLine>
<Link id="l05925" /><CodeLine lineNumber="5925"></CodeLine>
<Link id="l05926" /><CodeLine lineNumber="5926"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are skipping the region of a non conditional, remove the exit</span></CodeLine>
<Link id="l05927" /><CodeLine lineNumber="5927"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block, and clear the builder&#39;s insertion point.</span></CodeLine>
<Link id="l05928" /><CodeLine lineNumber="5928"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SplitPos-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == ExitBB &amp;&amp;</span></CodeLine>
<Link id="l05929" /><CodeLine lineNumber="5929"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected Insertion point location!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05930" /><CodeLine lineNumber="5930"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> merged = <a href="/docs/api/namespaces/llvm/#aa76a2cf19b821f320ab439d5659ef4b9">MergeBlockIntoPredecessor</a>(ExitBB);</span></CodeLine>
<Link id="l05931" /><CodeLine lineNumber="5931"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ExitPredBB = SplitPos-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l05932" /><CodeLine lineNumber="5932"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InsertBB = merged ? ExitPredBB : ExitBB;</span></CodeLine>
<Link id="l05933" /><CodeLine lineNumber="5933"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a4956305191cdba7f9995569d011a5ab7">isa&#95;and&#95;nonnull&lt;BranchInst&gt;</a>(SplitPos))</span></CodeLine>
<Link id="l05934" /><CodeLine lineNumber="5934"><span class="doxyHighlight">    SplitPos-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l05935" /><CodeLine lineNumber="5935"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(InsertBB);</span></CodeLine>
<Link id="l05936" /><CodeLine lineNumber="5936"></CodeLine>
<Link id="l05937" /><CodeLine lineNumber="5937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l05938" /><CodeLine lineNumber="5938"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05939" /><CodeLine lineNumber="5939"></CodeLine>
<Link id="l05940" /><CodeLine lineNumber="5940"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> OpenMPIRBuilder::emitCommonDirectiveEntry(</span></CodeLine>
<Link id="l05941" /><CodeLine lineNumber="5941"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/directive">Directive</a> OMPD, <a href="/docs/api/classes/llvm/value">Value</a> &#42;EntryCall, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBB, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Conditional) &#123;</span></CodeLine>
<Link id="l05942" /><CodeLine lineNumber="5942"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if nothing to do, Return current insertion point.</span></CodeLine>
<Link id="l05943" /><CodeLine lineNumber="5943"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Conditional || !EntryCall)</span></CodeLine>
<Link id="l05944" /><CodeLine lineNumber="5944"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l05945" /><CodeLine lineNumber="5945"></CodeLine>
<Link id="l05946" /><CodeLine lineNumber="5946"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EntryBB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l05947" /><CodeLine lineNumber="5947"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CallBool = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aafd864f39fd28e235eea03ae424ab8e0">CreateIsNotNull</a>(EntryCall);</span></CodeLine>
<Link id="l05948" /><CodeLine lineNumber="5948"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ThenBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;region.body&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05949" /><CodeLine lineNumber="5949"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> UnreachableInst(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>(), ThenBB);</span></CodeLine>
<Link id="l05950" /><CodeLine lineNumber="5950"></CodeLine>
<Link id="l05951" /><CodeLine lineNumber="5951"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit thenBB and set the Builder&#39;s insertion point there for</span></CodeLine>
<Link id="l05952" /><CodeLine lineNumber="5952"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// body generation next. Place the block after the current block.</span></CodeLine>
<Link id="l05953" /><CodeLine lineNumber="5953"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;CurFn = EntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l05954" /><CodeLine lineNumber="5954"><span class="doxyHighlight">  CurFn-&gt;<a href="/docs/api/classes/llvm/function/#aaab8110aafc070c83bc701b13d2260df">insert</a>(std::next(EntryBB-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>()), ThenBB);</span></CodeLine>
<Link id="l05955" /><CodeLine lineNumber="5955"></CodeLine>
<Link id="l05956" /><CodeLine lineNumber="5956"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Move Entry branch to end of ThenBB, and replace with conditional</span></CodeLine>
<Link id="l05957" /><CodeLine lineNumber="5957"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branch (If-stmt)</span></CodeLine>
<Link id="l05958" /><CodeLine lineNumber="5958"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;EntryBBTI = EntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l05959" /><CodeLine lineNumber="5959"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(CallBool, ThenBB, ExitBB);</span></CodeLine>
<Link id="l05960" /><CodeLine lineNumber="5960"><span class="doxyHighlight">  EntryBBTI-&gt;<a href="/docs/api/classes/llvm/instruction/#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</span></CodeLine>
<Link id="l05961" /><CodeLine lineNumber="5961"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(UI);</span></CodeLine>
<Link id="l05962" /><CodeLine lineNumber="5962"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8ef25defccf4817608a13e7a9db4000d">Insert</a>(EntryBBTI);</span></CodeLine>
<Link id="l05963" /><CodeLine lineNumber="5963"><span class="doxyHighlight">  UI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l05964" /><CodeLine lineNumber="5964"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ThenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l05965" /><CodeLine lineNumber="5965"></CodeLine>
<Link id="l05966" /><CodeLine lineNumber="5966"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// return an insertion point to ExitBB.</span></CodeLine>
<Link id="l05967" /><CodeLine lineNumber="5967"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IRBuilder&lt;&gt;::InsertPoint(ExitBB, ExitBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l05968" /><CodeLine lineNumber="5968"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05969" /><CodeLine lineNumber="5969"></CodeLine>
<Link id="l05970" /><CodeLine lineNumber="5970"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> OpenMPIRBuilder::emitCommonDirectiveExit(</span></CodeLine>
<Link id="l05971" /><CodeLine lineNumber="5971"><span class="doxyHighlight">    omp::Directive OMPD, InsertPointTy FinIP, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ExitCall,</span></CodeLine>
<Link id="l05972" /><CodeLine lineNumber="5972"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasFinalize) &#123;</span></CodeLine>
<Link id="l05973" /><CodeLine lineNumber="5973"></CodeLine>
<Link id="l05974" /><CodeLine lineNumber="5974"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(FinIP);</span></CodeLine>
<Link id="l05975" /><CodeLine lineNumber="5975"></CodeLine>
<Link id="l05976" /><CodeLine lineNumber="5976"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is finalization to do, emit it before the exit call</span></CodeLine>
<Link id="l05977" /><CodeLine lineNumber="5977"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasFinalize) &#123;</span></CodeLine>
<Link id="l05978" /><CodeLine lineNumber="5978"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!FinalizationStack.empty() &amp;&amp;</span></CodeLine>
<Link id="l05979" /><CodeLine lineNumber="5979"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Unexpected finalization stack state!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05980" /><CodeLine lineNumber="5980"></CodeLine>
<Link id="l05981" /><CodeLine lineNumber="5981"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/openmpirbuilder/finalizationinfo">FinalizationInfo</a> Fi = FinalizationStack.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l05982" /><CodeLine lineNumber="5982"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Fi.DK == OMPD &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected Directive for Finalization call!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05983" /><CodeLine lineNumber="5983"></CodeLine>
<Link id="l05984" /><CodeLine lineNumber="5984"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = Fi.FiniCB(FinIP))</span></CodeLine>
<Link id="l05985" /><CodeLine lineNumber="5985"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l05986" /><CodeLine lineNumber="5986"></CodeLine>
<Link id="l05987" /><CodeLine lineNumber="5987"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FiniBB = FinIP.getBlock();</span></CodeLine>
<Link id="l05988" /><CodeLine lineNumber="5988"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;FiniBBTI = FiniBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l05989" /><CodeLine lineNumber="5989"></CodeLine>
<Link id="l05990" /><CodeLine lineNumber="5990"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// set Builder IP for call creation</span></CodeLine>
<Link id="l05991" /><CodeLine lineNumber="5991"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(FiniBBTI);</span></CodeLine>
<Link id="l05992" /><CodeLine lineNumber="5992"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05993" /><CodeLine lineNumber="5993"></CodeLine>
<Link id="l05994" /><CodeLine lineNumber="5994"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExitCall)</span></CodeLine>
<Link id="l05995" /><CodeLine lineNumber="5995"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l05996" /><CodeLine lineNumber="5996"></CodeLine>
<Link id="l05997" /><CodeLine lineNumber="5997"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// place the Exitcall as last instruction before Finalization block terminator</span></CodeLine>
<Link id="l05998" /><CodeLine lineNumber="5998"><span class="doxyHighlight">  ExitCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a0fd53f63d349dc8a7c5fc0cdd7a94c8d">removeFromParent</a>();</span></CodeLine>
<Link id="l05999" /><CodeLine lineNumber="5999"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8ef25defccf4817608a13e7a9db4000d">Insert</a>(ExitCall);</span></CodeLine>
<Link id="l06000" /><CodeLine lineNumber="6000"></CodeLine>
<Link id="l06001" /><CodeLine lineNumber="6001"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IRBuilder&lt;&gt;::InsertPoint(ExitCall-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(),</span></CodeLine>
<Link id="l06002" /><CodeLine lineNumber="6002"><span class="doxyHighlight">                                  ExitCall-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l06003" /><CodeLine lineNumber="6003"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06004" /><CodeLine lineNumber="6004"></CodeLine>
<Link id="l06005" /><CodeLine lineNumber="6005"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> OpenMPIRBuilder::createCopyinClauseBlocks(</span></CodeLine>
<Link id="l06006" /><CodeLine lineNumber="6006"><span class="doxyHighlight">    InsertPointTy IP, <a href="/docs/api/classes/llvm/value">Value</a> &#42;MasterAddr, <a href="/docs/api/classes/llvm/value">Value</a> &#42;PrivateAddr,</span></CodeLine>
<Link id="l06007" /><CodeLine lineNumber="6007"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/integertype">llvm::IntegerType</a> &#42;IntPtrTy, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BranchtoEnd) &#123;</span></CodeLine>
<Link id="l06008" /><CodeLine lineNumber="6008"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IP.isSet())</span></CodeLine>
<Link id="l06009" /><CodeLine lineNumber="6009"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IP;</span></CodeLine>
<Link id="l06010" /><CodeLine lineNumber="6010"></CodeLine>
<Link id="l06011" /><CodeLine lineNumber="6011"><span class="doxyHighlight">  IRBuilder&lt;&gt;::InsertPointGuard IPG(Builder);</span></CodeLine>
<Link id="l06012" /><CodeLine lineNumber="6012"></CodeLine>
<Link id="l06013" /><CodeLine lineNumber="6013"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// creates the following CFG structure</span></CodeLine>
<Link id="l06014" /><CodeLine lineNumber="6014"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     OMP&#95;Entry : (MasterAddr != PrivateAddr)?</span></CodeLine>
<Link id="l06015" /><CodeLine lineNumber="6015"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       F     T</span></CodeLine>
<Link id="l06016" /><CodeLine lineNumber="6016"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       |      \\</span></CodeLine>
<Link id="l06017" /><CodeLine lineNumber="6017"><span class="doxyHighlightComment">  //       |     copin.not.master</span></CodeLine>
<Link id="l06018" /><CodeLine lineNumber="6018"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       |      /</span></CodeLine>
<Link id="l06019" /><CodeLine lineNumber="6019"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       v     /</span></CodeLine>
<Link id="l06020" /><CodeLine lineNumber="6020"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   copyin.not.master.end</span></CodeLine>
<Link id="l06021" /><CodeLine lineNumber="6021"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//         |</span></CodeLine>
<Link id="l06022" /><CodeLine lineNumber="6022"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//         v</span></CodeLine>
<Link id="l06023" /><CodeLine lineNumber="6023"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   OMP.Entry.Next</span></CodeLine>
<Link id="l06024" /><CodeLine lineNumber="6024"></CodeLine>
<Link id="l06025" /><CodeLine lineNumber="6025"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;OMP&#95;Entry = IP.getBlock();</span></CodeLine>
<Link id="l06026" /><CodeLine lineNumber="6026"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;CurFn = OMP&#95;Entry-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l06027" /><CodeLine lineNumber="6027"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CopyBegin =</span></CodeLine>
<Link id="l06028" /><CodeLine lineNumber="6028"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;copyin.not.master&quot;</span><span class="doxyHighlight">, CurFn);</span></CodeLine>
<Link id="l06029" /><CodeLine lineNumber="6029"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CopyEnd = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06030" /><CodeLine lineNumber="6030"></CodeLine>
<Link id="l06031" /><CodeLine lineNumber="6031"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If entry block is terminated, split to preserve the branch to following</span></CodeLine>
<Link id="l06032" /><CodeLine lineNumber="6032"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// basic block (i.e. OMP.Entry.Next), otherwise, leave everything as is.</span></CodeLine>
<Link id="l06033" /><CodeLine lineNumber="6033"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a4956305191cdba7f9995569d011a5ab7">isa&#95;and&#95;nonnull&lt;BranchInst&gt;</a>(OMP&#95;Entry-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())) &#123;</span></CodeLine>
<Link id="l06034" /><CodeLine lineNumber="6034"><span class="doxyHighlight">    CopyEnd = OMP&#95;Entry-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(OMP&#95;Entry-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(),</span></CodeLine>
<Link id="l06035" /><CodeLine lineNumber="6035"><span class="doxyHighlight">                                         </span><span class="doxyHighlightStringLiteral">&quot;copyin.not.master.end&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06036" /><CodeLine lineNumber="6036"><span class="doxyHighlight">    OMP&#95;Entry-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l06037" /><CodeLine lineNumber="6037"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06038" /><CodeLine lineNumber="6038"><span class="doxyHighlight">    CopyEnd =</span></CodeLine>
<Link id="l06039" /><CodeLine lineNumber="6039"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;copyin.not.master.end&quot;</span><span class="doxyHighlight">, CurFn);</span></CodeLine>
<Link id="l06040" /><CodeLine lineNumber="6040"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06041" /><CodeLine lineNumber="6041"></CodeLine>
<Link id="l06042" /><CodeLine lineNumber="6042"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(OMP&#95;Entry);</span></CodeLine>
<Link id="l06043" /><CodeLine lineNumber="6043"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;MasterPtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aae2c1bf70058f3665edaec525457030c">CreatePtrToInt</a>(MasterAddr, IntPtrTy);</span></CodeLine>
<Link id="l06044" /><CodeLine lineNumber="6044"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PrivatePtr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aae2c1bf70058f3665edaec525457030c">CreatePtrToInt</a>(PrivateAddr, IntPtrTy);</span></CodeLine>
<Link id="l06045" /><CodeLine lineNumber="6045"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;cmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a6ef1729b04a4fbd6c6f27787cdd0e813">CreateICmpNE</a>(MasterPtr, PrivatePtr);</span></CodeLine>
<Link id="l06046" /><CodeLine lineNumber="6046"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(cmp, CopyBegin, CopyEnd);</span></CodeLine>
<Link id="l06047" /><CodeLine lineNumber="6047"></CodeLine>
<Link id="l06048" /><CodeLine lineNumber="6048"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(CopyBegin);</span></CodeLine>
<Link id="l06049" /><CodeLine lineNumber="6049"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BranchtoEnd)</span></CodeLine>
<Link id="l06050" /><CodeLine lineNumber="6050"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(CopyEnd));</span></CodeLine>
<Link id="l06051" /><CodeLine lineNumber="6051"></CodeLine>
<Link id="l06052" /><CodeLine lineNumber="6052"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l06053" /><CodeLine lineNumber="6053"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06054" /><CodeLine lineNumber="6054"></CodeLine>
<Link id="l06055" /><CodeLine lineNumber="6055"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;OpenMPIRBuilder::createOMPAlloc(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l06056" /><CodeLine lineNumber="6056"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/codegen/regallocbasic-cpp/#ad5d00e1d77644d95847b9bf8da12b759">Allocator</a>,</span></CodeLine>
<Link id="l06057" /><CodeLine lineNumber="6057"><span class="doxyHighlight">                                          std::string Name) &#123;</span></CodeLine>
<Link id="l06058" /><CodeLine lineNumber="6058"><span class="doxyHighlight">  IRBuilder&lt;&gt;::InsertPointGuard IPG(Builder);</span></CodeLine>
<Link id="l06059" /><CodeLine lineNumber="6059"><span class="doxyHighlight">  updateToLocation(Loc);</span></CodeLine>
<Link id="l06060" /><CodeLine lineNumber="6060"></CodeLine>
<Link id="l06061" /><CodeLine lineNumber="6061"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l06062" /><CodeLine lineNumber="6062"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l06063" /><CodeLine lineNumber="6063"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l06064" /><CodeLine lineNumber="6064"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l06065" /><CodeLine lineNumber="6065"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;ThreadId, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, <a href="/docs/api/files/lib/lib/codegen/regallocbasic-cpp/#ad5d00e1d77644d95847b9bf8da12b759">Allocator</a>&#125;;</span></CodeLine>
<Link id="l06066" /><CodeLine lineNumber="6066"></CodeLine>
<Link id="l06067" /><CodeLine lineNumber="6067"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;Fn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;alloc);</span></CodeLine>
<Link id="l06068" /><CodeLine lineNumber="6068"></CodeLine>
<Link id="l06069" /><CodeLine lineNumber="6069"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(Fn, Args, Name);</span></CodeLine>
<Link id="l06070" /><CodeLine lineNumber="6070"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06071" /><CodeLine lineNumber="6071"></CodeLine>
<Link id="l06072" /><CodeLine lineNumber="6072"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;OpenMPIRBuilder::createOMPFree(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l06073" /><CodeLine lineNumber="6073"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/value">Value</a> &#42;Addr, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/codegen/regallocbasic-cpp/#ad5d00e1d77644d95847b9bf8da12b759">Allocator</a>,</span></CodeLine>
<Link id="l06074" /><CodeLine lineNumber="6074"><span class="doxyHighlight">                                         std::string Name) &#123;</span></CodeLine>
<Link id="l06075" /><CodeLine lineNumber="6075"><span class="doxyHighlight">  IRBuilder&lt;&gt;::InsertPointGuard IPG(Builder);</span></CodeLine>
<Link id="l06076" /><CodeLine lineNumber="6076"><span class="doxyHighlight">  updateToLocation(Loc);</span></CodeLine>
<Link id="l06077" /><CodeLine lineNumber="6077"></CodeLine>
<Link id="l06078" /><CodeLine lineNumber="6078"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l06079" /><CodeLine lineNumber="6079"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l06080" /><CodeLine lineNumber="6080"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l06081" /><CodeLine lineNumber="6081"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l06082" /><CodeLine lineNumber="6082"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;ThreadId, Addr, <a href="/docs/api/files/lib/lib/codegen/regallocbasic-cpp/#ad5d00e1d77644d95847b9bf8da12b759">Allocator</a>&#125;;</span></CodeLine>
<Link id="l06083" /><CodeLine lineNumber="6083"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;Fn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;free);</span></CodeLine>
<Link id="l06084" /><CodeLine lineNumber="6084"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(Fn, Args, Name);</span></CodeLine>
<Link id="l06085" /><CodeLine lineNumber="6085"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06086" /><CodeLine lineNumber="6086"></CodeLine>
<Link id="l06087" /><CodeLine lineNumber="6087"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;OpenMPIRBuilder::createOMPInteropInit(</span></CodeLine>
<Link id="l06088" /><CodeLine lineNumber="6088"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;InteropVar,</span></CodeLine>
<Link id="l06089" /><CodeLine lineNumber="6089"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#afeaad9a7fc12d9246c2e42578fddc718">omp::OMPInteropType</a> InteropType, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Device, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumDependences,</span></CodeLine>
<Link id="l06090" /><CodeLine lineNumber="6090"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;DependenceAddress, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveNowaitClause) &#123;</span></CodeLine>
<Link id="l06091" /><CodeLine lineNumber="6091"><span class="doxyHighlight">  IRBuilder&lt;&gt;::InsertPointGuard IPG(Builder);</span></CodeLine>
<Link id="l06092" /><CodeLine lineNumber="6092"><span class="doxyHighlight">  updateToLocation(Loc);</span></CodeLine>
<Link id="l06093" /><CodeLine lineNumber="6093"></CodeLine>
<Link id="l06094" /><CodeLine lineNumber="6094"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l06095" /><CodeLine lineNumber="6095"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l06096" /><CodeLine lineNumber="6096"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l06097" /><CodeLine lineNumber="6097"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l06098" /><CodeLine lineNumber="6098"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Device == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l06099" /><CodeLine lineNumber="6099"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/nvptx/#abd325b49b8e2f00c0370b1c68cf51557a67abb9e8dc09f85f29d80f83816cc1fc">Device</a> = <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>);</span></CodeLine>
<Link id="l06100" /><CodeLine lineNumber="6100"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;InteropTypeVal = ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">)InteropType);</span></CodeLine>
<Link id="l06101" /><CodeLine lineNumber="6101"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumDependences == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l06102" /><CodeLine lineNumber="6102"><span class="doxyHighlight">    NumDependences = ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, 0);</span></CodeLine>
<Link id="l06103" /><CodeLine lineNumber="6103"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bae385c38bb67ea909198e13ee23c21028">PointerType</a> &#42;PointerTypeVar = <a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext());</span></CodeLine>
<Link id="l06104" /><CodeLine lineNumber="6104"><span class="doxyHighlight">    DependenceAddress = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(PointerTypeVar);</span></CodeLine>
<Link id="l06105" /><CodeLine lineNumber="6105"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06106" /><CodeLine lineNumber="6106"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;HaveNowaitClauseVal = ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, HaveNowaitClause);</span></CodeLine>
<Link id="l06107" /><CodeLine lineNumber="6107"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;</span></CodeLine>
<Link id="l06108" /><CodeLine lineNumber="6108"><span class="doxyHighlight">      Ident,  ThreadId,       InteropVar,        InteropTypeVal,</span></CodeLine>
<Link id="l06109" /><CodeLine lineNumber="6109"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/nvptx/#abd325b49b8e2f00c0370b1c68cf51557a67abb9e8dc09f85f29d80f83816cc1fc">Device</a>, NumDependences, DependenceAddress, HaveNowaitClauseVal&#125;;</span></CodeLine>
<Link id="l06110" /><CodeLine lineNumber="6110"></CodeLine>
<Link id="l06111" /><CodeLine lineNumber="6111"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;Fn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;tgt&#95;interop&#95;init);</span></CodeLine>
<Link id="l06112" /><CodeLine lineNumber="6112"></CodeLine>
<Link id="l06113" /><CodeLine lineNumber="6113"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(Fn, Args);</span></CodeLine>
<Link id="l06114" /><CodeLine lineNumber="6114"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06115" /><CodeLine lineNumber="6115"></CodeLine>
<Link id="l06116" /><CodeLine lineNumber="6116"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;OpenMPIRBuilder::createOMPInteropDestroy(</span></CodeLine>
<Link id="l06117" /><CodeLine lineNumber="6117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;InteropVar, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Device,</span></CodeLine>
<Link id="l06118" /><CodeLine lineNumber="6118"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumDependences, <a href="/docs/api/classes/llvm/value">Value</a> &#42;DependenceAddress, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveNowaitClause) &#123;</span></CodeLine>
<Link id="l06119" /><CodeLine lineNumber="6119"><span class="doxyHighlight">  IRBuilder&lt;&gt;::InsertPointGuard IPG(Builder);</span></CodeLine>
<Link id="l06120" /><CodeLine lineNumber="6120"><span class="doxyHighlight">  updateToLocation(Loc);</span></CodeLine>
<Link id="l06121" /><CodeLine lineNumber="6121"></CodeLine>
<Link id="l06122" /><CodeLine lineNumber="6122"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l06123" /><CodeLine lineNumber="6123"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l06124" /><CodeLine lineNumber="6124"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l06125" /><CodeLine lineNumber="6125"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l06126" /><CodeLine lineNumber="6126"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Device == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l06127" /><CodeLine lineNumber="6127"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/nvptx/#abd325b49b8e2f00c0370b1c68cf51557a67abb9e8dc09f85f29d80f83816cc1fc">Device</a> = <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>);</span></CodeLine>
<Link id="l06128" /><CodeLine lineNumber="6128"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumDependences == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l06129" /><CodeLine lineNumber="6129"><span class="doxyHighlight">    NumDependences = ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, 0);</span></CodeLine>
<Link id="l06130" /><CodeLine lineNumber="6130"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bae385c38bb67ea909198e13ee23c21028">PointerType</a> &#42;PointerTypeVar = <a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext());</span></CodeLine>
<Link id="l06131" /><CodeLine lineNumber="6131"><span class="doxyHighlight">    DependenceAddress = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(PointerTypeVar);</span></CodeLine>
<Link id="l06132" /><CodeLine lineNumber="6132"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06133" /><CodeLine lineNumber="6133"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;HaveNowaitClauseVal = ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, HaveNowaitClause);</span></CodeLine>
<Link id="l06134" /><CodeLine lineNumber="6134"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;</span></CodeLine>
<Link id="l06135" /><CodeLine lineNumber="6135"><span class="doxyHighlight">      Ident,          ThreadId,          InteropVar,         <a href="/docs/api/namespaces/llvm/nvptx/#abd325b49b8e2f00c0370b1c68cf51557a67abb9e8dc09f85f29d80f83816cc1fc">Device</a>,</span></CodeLine>
<Link id="l06136" /><CodeLine lineNumber="6136"><span class="doxyHighlight">      NumDependences, DependenceAddress, HaveNowaitClauseVal&#125;;</span></CodeLine>
<Link id="l06137" /><CodeLine lineNumber="6137"></CodeLine>
<Link id="l06138" /><CodeLine lineNumber="6138"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;Fn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;tgt&#95;interop&#95;destroy);</span></CodeLine>
<Link id="l06139" /><CodeLine lineNumber="6139"></CodeLine>
<Link id="l06140" /><CodeLine lineNumber="6140"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(Fn, Args);</span></CodeLine>
<Link id="l06141" /><CodeLine lineNumber="6141"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06142" /><CodeLine lineNumber="6142"></CodeLine>
<Link id="l06143" /><CodeLine lineNumber="6143"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;OpenMPIRBuilder::createOMPInteropUse(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l06144" /><CodeLine lineNumber="6144"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/value">Value</a> &#42;InteropVar, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Device,</span></CodeLine>
<Link id="l06145" /><CodeLine lineNumber="6145"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumDependences,</span></CodeLine>
<Link id="l06146" /><CodeLine lineNumber="6146"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/value">Value</a> &#42;DependenceAddress,</span></CodeLine>
<Link id="l06147" /><CodeLine lineNumber="6147"><span class="doxyHighlight">                                               </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HaveNowaitClause) &#123;</span></CodeLine>
<Link id="l06148" /><CodeLine lineNumber="6148"><span class="doxyHighlight">  IRBuilder&lt;&gt;::InsertPointGuard IPG(Builder);</span></CodeLine>
<Link id="l06149" /><CodeLine lineNumber="6149"><span class="doxyHighlight">  updateToLocation(Loc);</span></CodeLine>
<Link id="l06150" /><CodeLine lineNumber="6150"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l06151" /><CodeLine lineNumber="6151"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l06152" /><CodeLine lineNumber="6152"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l06153" /><CodeLine lineNumber="6153"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l06154" /><CodeLine lineNumber="6154"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Device == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l06155" /><CodeLine lineNumber="6155"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/nvptx/#abd325b49b8e2f00c0370b1c68cf51557a67abb9e8dc09f85f29d80f83816cc1fc">Device</a> = <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>);</span></CodeLine>
<Link id="l06156" /><CodeLine lineNumber="6156"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumDependences == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l06157" /><CodeLine lineNumber="6157"><span class="doxyHighlight">    NumDependences = ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, 0);</span></CodeLine>
<Link id="l06158" /><CodeLine lineNumber="6158"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bae385c38bb67ea909198e13ee23c21028">PointerType</a> &#42;PointerTypeVar = <a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext());</span></CodeLine>
<Link id="l06159" /><CodeLine lineNumber="6159"><span class="doxyHighlight">    DependenceAddress = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(PointerTypeVar);</span></CodeLine>
<Link id="l06160" /><CodeLine lineNumber="6160"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06161" /><CodeLine lineNumber="6161"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;HaveNowaitClauseVal = ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, HaveNowaitClause);</span></CodeLine>
<Link id="l06162" /><CodeLine lineNumber="6162"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;</span></CodeLine>
<Link id="l06163" /><CodeLine lineNumber="6163"><span class="doxyHighlight">      Ident,          ThreadId,          InteropVar,         <a href="/docs/api/namespaces/llvm/nvptx/#abd325b49b8e2f00c0370b1c68cf51557a67abb9e8dc09f85f29d80f83816cc1fc">Device</a>,</span></CodeLine>
<Link id="l06164" /><CodeLine lineNumber="6164"><span class="doxyHighlight">      NumDependences, DependenceAddress, HaveNowaitClauseVal&#125;;</span></CodeLine>
<Link id="l06165" /><CodeLine lineNumber="6165"></CodeLine>
<Link id="l06166" /><CodeLine lineNumber="6166"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;Fn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;tgt&#95;interop&#95;use);</span></CodeLine>
<Link id="l06167" /><CodeLine lineNumber="6167"></CodeLine>
<Link id="l06168" /><CodeLine lineNumber="6168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(Fn, Args);</span></CodeLine>
<Link id="l06169" /><CodeLine lineNumber="6169"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06170" /><CodeLine lineNumber="6170"></CodeLine>
<Link id="l06171" /><CodeLine lineNumber="6171"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;OpenMPIRBuilder::createCachedThreadPrivate(</span></CodeLine>
<Link id="l06172" /><CodeLine lineNumber="6172"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;Pointer,</span></CodeLine>
<Link id="l06173" /><CodeLine lineNumber="6173"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">llvm::ConstantInt</a> &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/twine">llvm::Twine</a> &amp;Name) &#123;</span></CodeLine>
<Link id="l06174" /><CodeLine lineNumber="6174"><span class="doxyHighlight">  IRBuilder&lt;&gt;::InsertPointGuard IPG(Builder);</span></CodeLine>
<Link id="l06175" /><CodeLine lineNumber="6175"><span class="doxyHighlight">  updateToLocation(Loc);</span></CodeLine>
<Link id="l06176" /><CodeLine lineNumber="6176"></CodeLine>
<Link id="l06177" /><CodeLine lineNumber="6177"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l06178" /><CodeLine lineNumber="6178"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l06179" /><CodeLine lineNumber="6179"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l06180" /><CodeLine lineNumber="6180"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadId = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l06181" /><CodeLine lineNumber="6181"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;ThreadPrivateCache =</span></CodeLine>
<Link id="l06182" /><CodeLine lineNumber="6182"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#aa5ef00e5a7487cc6c5bfed0f301fa1cc">getOrCreateInternalVariable</a>(Int8PtrPtr, <a href="/docs/api/namespaces/llvm/graphprogram/#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a>.str());</span></CodeLine>
<Link id="l06183" /><CodeLine lineNumber="6183"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">llvm::Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;Ident, ThreadId, <a href="/docs/api/namespaces/llvm/codeview/#a0bfa8e65ecd85f3151f84bb53ad4bcbca61cf8510205077b6f5491d38cd44c0f7">Pointer</a>, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, ThreadPrivateCache&#125;;</span></CodeLine>
<Link id="l06184" /><CodeLine lineNumber="6184"></CodeLine>
<Link id="l06185" /><CodeLine lineNumber="6185"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;Fn =</span></CodeLine>
<Link id="l06186" /><CodeLine lineNumber="6186"><span class="doxyHighlight">      getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;threadprivate&#95;cached);</span></CodeLine>
<Link id="l06187" /><CodeLine lineNumber="6187"></CodeLine>
<Link id="l06188" /><CodeLine lineNumber="6188"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(Fn, Args);</span></CodeLine>
<Link id="l06189" /><CodeLine lineNumber="6189"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06190" /><CodeLine lineNumber="6190"></CodeLine>
<Link id="l06191" /><CodeLine lineNumber="6191"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> OpenMPIRBuilder::createTargetInit(</span></CodeLine>
<Link id="l06192" /><CodeLine lineNumber="6192"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l06193" /><CodeLine lineNumber="6193"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> llvm::OpenMPIRBuilder::TargetKernelDefaultAttrs &amp;Attrs) &#123;</span></CodeLine>
<Link id="l06194" /><CodeLine lineNumber="6194"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.MaxThreads.empty() &amp;&amp; !<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.MaxTeams.empty() &amp;&amp;</span></CodeLine>
<Link id="l06195" /><CodeLine lineNumber="6195"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;expected num&#95;threads and num&#95;teams to be specified&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06196" /><CodeLine lineNumber="6196"></CodeLine>
<Link id="l06197" /><CodeLine lineNumber="6197"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l06198" /><CodeLine lineNumber="6198"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Loc.IP;</span></CodeLine>
<Link id="l06199" /><CodeLine lineNumber="6199"></CodeLine>
<Link id="l06200" /><CodeLine lineNumber="6200"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l06201" /><CodeLine lineNumber="6201"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l06202" /><CodeLine lineNumber="6202"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l06203" /><CodeLine lineNumber="6203"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;IsSPMDVal = <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(Int8, <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.ExecFlags);</span></CodeLine>
<Link id="l06204" /><CodeLine lineNumber="6204"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;UseGenericStateMachineVal = <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(</span></CodeLine>
<Link id="l06205" /><CodeLine lineNumber="6205"><span class="doxyHighlight">      Int8, <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.ExecFlags != <a href="/docs/api/namespaces/llvm/omp/#aa0c0d79dafb0d22308ce48808689f430a338c51f37ed4e4b2c9973a383c566c19">omp::OMP&#95;TGT&#95;EXEC&#95;MODE&#95;SPMD</a>);</span></CodeLine>
<Link id="l06206" /><CodeLine lineNumber="6206"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;MayUseNestedParallelismVal = <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(Int8, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06207" /><CodeLine lineNumber="6207"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;DebugIndentionLevelVal = <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a150558aeaa819431aeb9729d26b2ac9f">Int16</a>, 0);</span></CodeLine>
<Link id="l06208" /><CodeLine lineNumber="6208"></CodeLine>
<Link id="l06209" /><CodeLine lineNumber="6209"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;DebugKernelWrapper = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l06210" /><CodeLine lineNumber="6210"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a> = DebugKernelWrapper;</span></CodeLine>
<Link id="l06211" /><CodeLine lineNumber="6211"></CodeLine>
<Link id="l06212" /><CodeLine lineNumber="6212"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to strip the debug prefix to get the correct kernel name.</span></CodeLine>
<Link id="l06213" /><CodeLine lineNumber="6213"><span class="doxyHighlight">  StringRef KernelName = <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>();</span></CodeLine>
<Link id="l06214" /><CodeLine lineNumber="6214"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::string DebugPrefix = </span><span class="doxyHighlightStringLiteral">&quot;&#95;debug&#95;&#95;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06215" /><CodeLine lineNumber="6215"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (KernelName.<a href="/docs/api/classes/llvm/stringref/#aca439bf65258d9d8d057812938b617c5">ends&#95;with</a>(DebugPrefix)) &#123;</span></CodeLine>
<Link id="l06216" /><CodeLine lineNumber="6216"><span class="doxyHighlight">    KernelName = KernelName.<a href="/docs/api/classes/llvm/stringref/#ae2705fd641fb3d1eefa2691b5117cf22">drop&#95;back</a>(DebugPrefix.length());</span></CodeLine>
<Link id="l06217" /><CodeLine lineNumber="6217"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a> = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getFunction(KernelName);</span></CodeLine>
<Link id="l06218" /><CodeLine lineNumber="6218"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected the real kernel to exist&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06219" /><CodeLine lineNumber="6219"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06220" /><CodeLine lineNumber="6220"></CodeLine>
<Link id="l06221" /><CodeLine lineNumber="6221"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Manifest the launch configuration in the metadata matching the kernel</span></CodeLine>
<Link id="l06222" /><CodeLine lineNumber="6222"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// environment.</span></CodeLine>
<Link id="l06223" /><CodeLine lineNumber="6223"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.MinTeams &gt; 1 || <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.MaxTeams.front() &gt; 0)</span></CodeLine>
<Link id="l06224" /><CodeLine lineNumber="6224"><span class="doxyHighlight">    writeTeamsForKernel(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, &#42;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>, <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.MinTeams, <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.MaxTeams.front());</span></CodeLine>
<Link id="l06225" /><CodeLine lineNumber="6225"></CodeLine>
<Link id="l06226" /><CodeLine lineNumber="6226"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If MaxThreads not set, select the maximum between the default workgroup</span></CodeLine>
<Link id="l06227" /><CodeLine lineNumber="6227"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// size and the MinThreads value.</span></CodeLine>
<Link id="l06228" /><CodeLine lineNumber="6228"><span class="doxyHighlight">  int32&#95;t MaxThreadsVal = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.MaxThreads.front();</span></CodeLine>
<Link id="l06229" /><CodeLine lineNumber="6229"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxThreadsVal &lt; 0)</span></CodeLine>
<Link id="l06230" /><CodeLine lineNumber="6230"><span class="doxyHighlight">    MaxThreadsVal = std::max(</span></CodeLine>
<Link id="l06231" /><CodeLine lineNumber="6231"><span class="doxyHighlight">        int32&#95;t(<a href="#ad52342fdd467389643191fdac7abcd40">getGridValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>).GV&#95;Default&#95;WG&#95;Size), <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.MinThreads);</span></CodeLine>
<Link id="l06232" /><CodeLine lineNumber="6232"></CodeLine>
<Link id="l06233" /><CodeLine lineNumber="6233"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxThreadsVal &gt; 0)</span></CodeLine>
<Link id="l06234" /><CodeLine lineNumber="6234"><span class="doxyHighlight">    writeThreadBoundsForKernel(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, &#42;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>, <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.MinThreads, MaxThreadsVal);</span></CodeLine>
<Link id="l06235" /><CodeLine lineNumber="6235"></CodeLine>
<Link id="l06236" /><CodeLine lineNumber="6236"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;MinThreads = <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.MinThreads);</span></CodeLine>
<Link id="l06237" /><CodeLine lineNumber="6237"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcorelowerthreadlocal-cpp/#aa5ae01d4881f7ebccb4f8738541721ca">MaxThreads</a> = <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, MaxThreadsVal);</span></CodeLine>
<Link id="l06238" /><CodeLine lineNumber="6238"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;MinTeams = <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.MinTeams);</span></CodeLine>
<Link id="l06239" /><CodeLine lineNumber="6239"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;MaxTeams = <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>.MaxTeams.front());</span></CodeLine>
<Link id="l06240" /><CodeLine lineNumber="6240"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;ReductionDataSize = <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, 0);</span></CodeLine>
<Link id="l06241" /><CodeLine lineNumber="6241"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;ReductionBufferLength = <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, 0);</span></CodeLine>
<Link id="l06242" /><CodeLine lineNumber="6242"></CodeLine>
<Link id="l06243" /><CodeLine lineNumber="6243"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;Fn = getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l06244" /><CodeLine lineNumber="6244"><span class="doxyHighlight">      omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;target&#95;init);</span></CodeLine>
<Link id="l06245" /><CodeLine lineNumber="6245"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = Fn-&gt;<a href="/docs/api/classes/llvm/function/#a3275c50993afaf4fdd723640c2c3ca0f">getDataLayout</a>();</span></CodeLine>
<Link id="l06246" /><CodeLine lineNumber="6246"></CodeLine>
<Link id="l06247" /><CodeLine lineNumber="6247"><span class="doxyHighlight">  Twine DynamicEnvironmentName = KernelName + </span><span class="doxyHighlightStringLiteral">&quot;&#95;dynamic&#95;environment&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06248" /><CodeLine lineNumber="6248"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;DynamicEnvironmentInitializer =</span></CodeLine>
<Link id="l06249" /><CodeLine lineNumber="6249"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantstruct/#a54fcfa620deb80373f489ba2fdad7643">ConstantStruct::get</a>(DynamicEnvironment, &#123;DebugIndentionLevelVal&#125;);</span></CodeLine>
<Link id="l06250" /><CodeLine lineNumber="6250"><span class="doxyHighlight">  GlobalVariable &#42;DynamicEnvironmentGV = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> GlobalVariable(</span></CodeLine>
<Link id="l06251" /><CodeLine lineNumber="6251"><span class="doxyHighlight">      M, DynamicEnvironment, </span><span class="doxyHighlightComment">/&#42;IsConstant=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca696bb1c9b0b0e76bb70c61f68866452a">GlobalValue::WeakODRLinkage</a>,</span></CodeLine>
<Link id="l06252" /><CodeLine lineNumber="6252"><span class="doxyHighlight">      DynamicEnvironmentInitializer, DynamicEnvironmentName,</span></CodeLine>
<Link id="l06253" /><CodeLine lineNumber="6253"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;InsertBefore=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0">GlobalValue::NotThreadLocal</a>,</span></CodeLine>
<Link id="l06254" /><CodeLine lineNumber="6254"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getDefaultGlobalsAddressSpace());</span></CodeLine>
<Link id="l06255" /><CodeLine lineNumber="6255"><span class="doxyHighlight">  DynamicEnvironmentGV-&gt;setVisibility(<a href="/docs/api/classes/llvm/globalvalue/#a9141f967188383108a69cc1b8ed3c195ae1cc9a390520055573d459de25747caa">GlobalValue::ProtectedVisibility</a>);</span></CodeLine>
<Link id="l06256" /><CodeLine lineNumber="6256"></CodeLine>
<Link id="l06257" /><CodeLine lineNumber="6257"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;DynamicEnvironment =</span></CodeLine>
<Link id="l06258" /><CodeLine lineNumber="6258"><span class="doxyHighlight">      DynamicEnvironmentGV-&gt;getType() == DynamicEnvironmentPtr</span></CodeLine>
<Link id="l06259" /><CodeLine lineNumber="6259"><span class="doxyHighlight">          ? DynamicEnvironmentGV</span></CodeLine>
<Link id="l06260" /><CodeLine lineNumber="6260"><span class="doxyHighlight">          : <a href="/docs/api/classes/llvm/constantexpr/#acac8bfd6018661b40690c621bece1540">ConstantExpr::getAddrSpaceCast</a>(DynamicEnvironmentGV,</span></CodeLine>
<Link id="l06261" /><CodeLine lineNumber="6261"><span class="doxyHighlight">                                           DynamicEnvironmentPtr);</span></CodeLine>
<Link id="l06262" /><CodeLine lineNumber="6262"></CodeLine>
<Link id="l06263" /><CodeLine lineNumber="6263"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;ConfigurationEnvironmentInitializer = <a href="/docs/api/classes/llvm/constantstruct/#a54fcfa620deb80373f489ba2fdad7643">ConstantStruct::get</a>(</span></CodeLine>
<Link id="l06264" /><CodeLine lineNumber="6264"><span class="doxyHighlight">      ConfigurationEnvironment, &#123;</span></CodeLine>
<Link id="l06265" /><CodeLine lineNumber="6265"><span class="doxyHighlight">                                    UseGenericStateMachineVal,</span></CodeLine>
<Link id="l06266" /><CodeLine lineNumber="6266"><span class="doxyHighlight">                                    MayUseNestedParallelismVal,</span></CodeLine>
<Link id="l06267" /><CodeLine lineNumber="6267"><span class="doxyHighlight">                                    IsSPMDVal,</span></CodeLine>
<Link id="l06268" /><CodeLine lineNumber="6268"><span class="doxyHighlight">                                    MinThreads,</span></CodeLine>
<Link id="l06269" /><CodeLine lineNumber="6269"><span class="doxyHighlight">                                    <a href="/docs/api/files/lib/lib/target/lib/target/xcore/xcorelowerthreadlocal-cpp/#aa5ae01d4881f7ebccb4f8738541721ca">MaxThreads</a>,</span></CodeLine>
<Link id="l06270" /><CodeLine lineNumber="6270"><span class="doxyHighlight">                                    MinTeams,</span></CodeLine>
<Link id="l06271" /><CodeLine lineNumber="6271"><span class="doxyHighlight">                                    MaxTeams,</span></CodeLine>
<Link id="l06272" /><CodeLine lineNumber="6272"><span class="doxyHighlight">                                    ReductionDataSize,</span></CodeLine>
<Link id="l06273" /><CodeLine lineNumber="6273"><span class="doxyHighlight">                                    ReductionBufferLength,</span></CodeLine>
<Link id="l06274" /><CodeLine lineNumber="6274"><span class="doxyHighlight">                                &#125;);</span></CodeLine>
<Link id="l06275" /><CodeLine lineNumber="6275"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;KernelEnvironmentInitializer = <a href="/docs/api/classes/llvm/constantstruct/#a54fcfa620deb80373f489ba2fdad7643">ConstantStruct::get</a>(</span></CodeLine>
<Link id="l06276" /><CodeLine lineNumber="6276"><span class="doxyHighlight">      KernelEnvironment, &#123;</span></CodeLine>
<Link id="l06277" /><CodeLine lineNumber="6277"><span class="doxyHighlight">                             ConfigurationEnvironmentInitializer,</span></CodeLine>
<Link id="l06278" /><CodeLine lineNumber="6278"><span class="doxyHighlight">                             Ident,</span></CodeLine>
<Link id="l06279" /><CodeLine lineNumber="6279"><span class="doxyHighlight">                             DynamicEnvironment,</span></CodeLine>
<Link id="l06280" /><CodeLine lineNumber="6280"><span class="doxyHighlight">                         &#125;);</span></CodeLine>
<Link id="l06281" /><CodeLine lineNumber="6281"><span class="doxyHighlight">  std::string KernelEnvironmentName =</span></CodeLine>
<Link id="l06282" /><CodeLine lineNumber="6282"><span class="doxyHighlight">      (KernelName + </span><span class="doxyHighlightStringLiteral">&quot;&#95;kernel&#95;environment&quot;</span><span class="doxyHighlight">).str();</span></CodeLine>
<Link id="l06283" /><CodeLine lineNumber="6283"><span class="doxyHighlight">  GlobalVariable &#42;KernelEnvironmentGV = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> GlobalVariable(</span></CodeLine>
<Link id="l06284" /><CodeLine lineNumber="6284"><span class="doxyHighlight">      M, KernelEnvironment, </span><span class="doxyHighlightComment">/&#42;IsConstant=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca696bb1c9b0b0e76bb70c61f68866452a">GlobalValue::WeakODRLinkage</a>,</span></CodeLine>
<Link id="l06285" /><CodeLine lineNumber="6285"><span class="doxyHighlight">      KernelEnvironmentInitializer, KernelEnvironmentName,</span></CodeLine>
<Link id="l06286" /><CodeLine lineNumber="6286"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;InsertBefore=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0">GlobalValue::NotThreadLocal</a>,</span></CodeLine>
<Link id="l06287" /><CodeLine lineNumber="6287"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getDefaultGlobalsAddressSpace());</span></CodeLine>
<Link id="l06288" /><CodeLine lineNumber="6288"><span class="doxyHighlight">  KernelEnvironmentGV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#aa242d8ab89216c14beab812e07009b2a">setVisibility</a>(<a href="/docs/api/classes/llvm/globalvalue/#a9141f967188383108a69cc1b8ed3c195ae1cc9a390520055573d459de25747caa">GlobalValue::ProtectedVisibility</a>);</span></CodeLine>
<Link id="l06289" /><CodeLine lineNumber="6289"></CodeLine>
<Link id="l06290" /><CodeLine lineNumber="6290"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;KernelEnvironment =</span></CodeLine>
<Link id="l06291" /><CodeLine lineNumber="6291"><span class="doxyHighlight">      KernelEnvironmentGV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a913a5d4b2cddde762446bd494e81a3f2">getType</a>() == KernelEnvironmentPtr</span></CodeLine>
<Link id="l06292" /><CodeLine lineNumber="6292"><span class="doxyHighlight">          ? KernelEnvironmentGV</span></CodeLine>
<Link id="l06293" /><CodeLine lineNumber="6293"><span class="doxyHighlight">          : <a href="/docs/api/classes/llvm/constantexpr/#acac8bfd6018661b40690c621bece1540">ConstantExpr::getAddrSpaceCast</a>(KernelEnvironmentGV,</span></CodeLine>
<Link id="l06294" /><CodeLine lineNumber="6294"><span class="doxyHighlight">                                           KernelEnvironmentPtr);</span></CodeLine>
<Link id="l06295" /><CodeLine lineNumber="6295"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;KernelLaunchEnvironment = DebugKernelWrapper-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(0);</span></CodeLine>
<Link id="l06296" /><CodeLine lineNumber="6296"><span class="doxyHighlight">  CallInst &#42;ThreadKind =</span></CodeLine>
<Link id="l06297" /><CodeLine lineNumber="6297"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(Fn, &#123;KernelEnvironment, KernelLaunchEnvironment&#125;);</span></CodeLine>
<Link id="l06298" /><CodeLine lineNumber="6298"></CodeLine>
<Link id="l06299" /><CodeLine lineNumber="6299"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ExecUserCode = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(</span></CodeLine>
<Link id="l06300" /><CodeLine lineNumber="6300"><span class="doxyHighlight">      ThreadKind, <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(ThreadKind-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()),</span></CodeLine>
<Link id="l06301" /><CodeLine lineNumber="6301"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;exec&#95;user&#95;code&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06302" /><CodeLine lineNumber="6302"></CodeLine>
<Link id="l06303" /><CodeLine lineNumber="6303"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ThreadKind = &#95;&#95;kmpc&#95;target&#95;init(...)</span></CodeLine>
<Link id="l06304" /><CodeLine lineNumber="6304"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if (ThreadKind == -1)</span></CodeLine>
<Link id="l06305" /><CodeLine lineNumber="6305"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   user&#95;code</span></CodeLine>
<Link id="l06306" /><CodeLine lineNumber="6306"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// else</span></CodeLine>
<Link id="l06307" /><CodeLine lineNumber="6307"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   return;</span></CodeLine>
<Link id="l06308" /><CodeLine lineNumber="6308"></CodeLine>
<Link id="l06309" /><CodeLine lineNumber="6309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a39acc29443d48968a798fb22a76fa4c0">CreateUnreachable</a>();</span></CodeLine>
<Link id="l06310" /><CodeLine lineNumber="6310"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CheckBB = UI-&gt;getParent();</span></CodeLine>
<Link id="l06311" /><CodeLine lineNumber="6311"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;UserCodeEntryBB = CheckBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(UI, </span><span class="doxyHighlightStringLiteral">&quot;user&#95;code.entry&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06312" /><CodeLine lineNumber="6312"></CodeLine>
<Link id="l06313" /><CodeLine lineNumber="6313"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;WorkerExitBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l06314" /><CodeLine lineNumber="6314"><span class="doxyHighlight">      CheckBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;worker.exit&quot;</span><span class="doxyHighlight">, CheckBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l06315" /><CodeLine lineNumber="6315"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(WorkerExitBB);</span></CodeLine>
<Link id="l06316" /><CodeLine lineNumber="6316"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l06317" /><CodeLine lineNumber="6317"></CodeLine>
<Link id="l06318" /><CodeLine lineNumber="6318"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CheckBBTI = CheckBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l06319" /><CodeLine lineNumber="6319"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(CheckBBTI);</span></CodeLine>
<Link id="l06320" /><CodeLine lineNumber="6320"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(ExecUserCode, UI-&gt;getParent(), WorkerExitBB);</span></CodeLine>
<Link id="l06321" /><CodeLine lineNumber="6321"></CodeLine>
<Link id="l06322" /><CodeLine lineNumber="6322"><span class="doxyHighlight">  CheckBBTI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l06323" /><CodeLine lineNumber="6323"><span class="doxyHighlight">  UI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l06324" /><CodeLine lineNumber="6324"></CodeLine>
<Link id="l06325" /><CodeLine lineNumber="6325"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Continue in the &quot;user&#95;code&quot; block, see diagram above and in</span></CodeLine>
<Link id="l06326" /><CodeLine lineNumber="6326"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// openmp/libomptarget/deviceRTLs/common/include/target.h .</span></CodeLine>
<Link id="l06327" /><CodeLine lineNumber="6327"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>(UserCodeEntryBB, UserCodeEntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l06328" /><CodeLine lineNumber="6328"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06329" /><CodeLine lineNumber="6329"></CodeLine>
<Link id="l06330" /><CodeLine lineNumber="6330"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::createTargetDeinit(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l06331" /><CodeLine lineNumber="6331"><span class="doxyHighlight">                                         int32&#95;t TeamsReductionDataSize,</span></CodeLine>
<Link id="l06332" /><CodeLine lineNumber="6332"><span class="doxyHighlight">                                         int32&#95;t TeamsReductionBufferLength) &#123;</span></CodeLine>
<Link id="l06333" /><CodeLine lineNumber="6333"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l06334" /><CodeLine lineNumber="6334"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06335" /><CodeLine lineNumber="6335"></CodeLine>
<Link id="l06336" /><CodeLine lineNumber="6336"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;Fn = getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l06337" /><CodeLine lineNumber="6337"><span class="doxyHighlight">      omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;target&#95;deinit);</span></CodeLine>
<Link id="l06338" /><CodeLine lineNumber="6338"></CodeLine>
<Link id="l06339" /><CodeLine lineNumber="6339"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(Fn, &#123;&#125;);</span></CodeLine>
<Link id="l06340" /><CodeLine lineNumber="6340"></CodeLine>
<Link id="l06341" /><CodeLine lineNumber="6341"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TeamsReductionBufferLength || !TeamsReductionDataSize)</span></CodeLine>
<Link id="l06342" /><CodeLine lineNumber="6342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06343" /><CodeLine lineNumber="6343"></CodeLine>
<Link id="l06344" /><CodeLine lineNumber="6344"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l06345" /><CodeLine lineNumber="6345"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to strip the debug prefix to get the correct kernel name.</span></CodeLine>
<Link id="l06346" /><CodeLine lineNumber="6346"><span class="doxyHighlight">  StringRef KernelName = <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>();</span></CodeLine>
<Link id="l06347" /><CodeLine lineNumber="6347"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::string DebugPrefix = </span><span class="doxyHighlightStringLiteral">&quot;&#95;debug&#95;&#95;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06348" /><CodeLine lineNumber="6348"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (KernelName.<a href="/docs/api/classes/llvm/stringref/#aca439bf65258d9d8d057812938b617c5">ends&#95;with</a>(DebugPrefix))</span></CodeLine>
<Link id="l06349" /><CodeLine lineNumber="6349"><span class="doxyHighlight">    KernelName = KernelName.<a href="/docs/api/classes/llvm/stringref/#ae2705fd641fb3d1eefa2691b5117cf22">drop&#95;back</a>(DebugPrefix.length());</span></CodeLine>
<Link id="l06350" /><CodeLine lineNumber="6350"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;KernelEnvironmentGV =</span></CodeLine>
<Link id="l06351" /><CodeLine lineNumber="6351"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getNamedGlobal((KernelName + </span><span class="doxyHighlightStringLiteral">&quot;&#95;kernel&#95;environment&quot;</span><span class="doxyHighlight">).str());</span></CodeLine>
<Link id="l06352" /><CodeLine lineNumber="6352"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(KernelEnvironmentGV &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected kernel environment global\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06353" /><CodeLine lineNumber="6353"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;KernelEnvironmentInitializer = KernelEnvironmentGV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a0698d5bcabbfbca4f56a9d7a81cecb25">getInitializer</a>();</span></CodeLine>
<Link id="l06354" /><CodeLine lineNumber="6354"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewInitializer = <a href="/docs/api/namespaces/llvm/#ad7fa9b738742521d0a684cec016ef47e">ConstantFoldInsertValueInstruction</a>(</span></CodeLine>
<Link id="l06355" /><CodeLine lineNumber="6355"><span class="doxyHighlight">      KernelEnvironmentInitializer,</span></CodeLine>
<Link id="l06356" /><CodeLine lineNumber="6356"><span class="doxyHighlight">      ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, TeamsReductionDataSize), &#123;0, 7&#125;);</span></CodeLine>
<Link id="l06357" /><CodeLine lineNumber="6357"><span class="doxyHighlight">  NewInitializer = <a href="/docs/api/namespaces/llvm/#ad7fa9b738742521d0a684cec016ef47e">ConstantFoldInsertValueInstruction</a>(</span></CodeLine>
<Link id="l06358" /><CodeLine lineNumber="6358"><span class="doxyHighlight">      NewInitializer, ConstantInt::get(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>, TeamsReductionBufferLength),</span></CodeLine>
<Link id="l06359" /><CodeLine lineNumber="6359"><span class="doxyHighlight">      &#123;0, 8&#125;);</span></CodeLine>
<Link id="l06360" /><CodeLine lineNumber="6360"><span class="doxyHighlight">  KernelEnvironmentGV-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a095f8f031d99ce3c0b25478713293dea">setInitializer</a>(NewInitializer);</span></CodeLine>
<Link id="l06361" /><CodeLine lineNumber="6361"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06362" /><CodeLine lineNumber="6362"></CodeLine>
<Link id="l06363" /><CodeLine lineNumber="6363" lineLink="#a749d7f5580e6a5b6214d911bad2a0b36"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;<a href="#a749d7f5580e6a5b6214d911bad2a0b36">getNVPTXMDNode</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>, <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name) &#123;</span></CodeLine>
<Link id="l06364" /><CodeLine lineNumber="6364"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/module">Module</a> &amp;M = &#42;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>.getParent();</span></CodeLine>
<Link id="l06365" /><CodeLine lineNumber="6365"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/namedmdnode">NamedMDNode</a> &#42;MD = M.getOrInsertNamedMetadata(</span><span class="doxyHighlightStringLiteral">&quot;nvvm.annotations&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06366" /><CodeLine lineNumber="6366"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : MD-&gt;<a href="/docs/api/classes/llvm/namedmdnode/#adc55e223d70c06a924fd5cb248052d9d">operands</a>()) &#123;</span></CodeLine>
<Link id="l06367" /><CodeLine lineNumber="6367"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getNumOperands() != 3)</span></CodeLine>
<Link id="l06368" /><CodeLine lineNumber="6368"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06369" /><CodeLine lineNumber="6369"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;KernelOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantAsMetadata&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l06370" /><CodeLine lineNumber="6370"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!KernelOp || KernelOp-&gt;getValue() != &amp;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>)</span></CodeLine>
<Link id="l06371" /><CodeLine lineNumber="6371"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06372" /><CodeLine lineNumber="6372"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Prop = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDString&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l06373" /><CodeLine lineNumber="6373"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Prop || Prop-&gt;getString() != Name)</span></CodeLine>
<Link id="l06374" /><CodeLine lineNumber="6374"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06375" /><CodeLine lineNumber="6375"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>;</span></CodeLine>
<Link id="l06376" /><CodeLine lineNumber="6376"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06377" /><CodeLine lineNumber="6377"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06378" /><CodeLine lineNumber="6378"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06379" /><CodeLine lineNumber="6379"></CodeLine>
<Link id="l06380" /><CodeLine lineNumber="6380" lineLink="#a457f42a32df73079ac4526c572a2d7fd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a457f42a32df73079ac4526c572a2d7fd">updateNVPTXMetadata</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>, <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name, int32&#95;t <a href="/docs/api/classes/llvm/value">Value</a>,</span></CodeLine>
<Link id="l06381" /><CodeLine lineNumber="6381"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Min) &#123;</span></CodeLine>
<Link id="l06382" /><CodeLine lineNumber="6382"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the &quot;maxntidx&quot; metadata for NVIDIA, or add it.</span></CodeLine>
<Link id="l06383" /><CodeLine lineNumber="6383"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;ExistingOp = <a href="#a749d7f5580e6a5b6214d911bad2a0b36">getNVPTXMDNode</a>(<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>, Name);</span></CodeLine>
<Link id="l06384" /><CodeLine lineNumber="6384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExistingOp) &#123;</span></CodeLine>
<Link id="l06385" /><CodeLine lineNumber="6385"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldVal = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantAsMetadata&gt;</a>(ExistingOp-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(2));</span></CodeLine>
<Link id="l06386" /><CodeLine lineNumber="6386"><span class="doxyHighlight">    int32&#95;t OldLimit = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(OldVal-&gt;getValue())-&gt;getZExtValue();</span></CodeLine>
<Link id="l06387" /><CodeLine lineNumber="6387"><span class="doxyHighlight">    ExistingOp-&gt;<a href="/docs/api/classes/llvm/mdnode/#a160e9e1a4fd597f83034c8b2ba316984">replaceOperandWith</a>(</span></CodeLine>
<Link id="l06388" /><CodeLine lineNumber="6388"><span class="doxyHighlight">        2, <a href="/docs/api/classes/llvm/constantasmetadata/#a4c720c398a263087e00d7358b05636d5">ConstantAsMetadata::get</a>(ConstantInt::get(</span></CodeLine>
<Link id="l06389" /><CodeLine lineNumber="6389"><span class="doxyHighlight">               OldVal-&gt;getValue()-&gt;getType(),</span></CodeLine>
<Link id="l06390" /><CodeLine lineNumber="6390"><span class="doxyHighlight">               Min ? std::min(OldLimit, <a href="/docs/api/classes/llvm/value">Value</a>) : std::max(OldLimit, <a href="/docs/api/classes/llvm/value">Value</a>))));</span></CodeLine>
<Link id="l06391" /><CodeLine lineNumber="6391"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06392" /><CodeLine lineNumber="6392"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>.getContext();</span></CodeLine>
<Link id="l06393" /><CodeLine lineNumber="6393"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;MDVals&#91;&#93; = &#123;<a href="/docs/api/classes/llvm/constantasmetadata/#a4c720c398a263087e00d7358b05636d5">ConstantAsMetadata::get</a>(&amp;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>),</span></CodeLine>
<Link id="l06394" /><CodeLine lineNumber="6394"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Ctx, Name),</span></CodeLine>
<Link id="l06395" /><CodeLine lineNumber="6395"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/constantasmetadata/#a4c720c398a263087e00d7358b05636d5">ConstantAsMetadata::get</a>(</span></CodeLine>
<Link id="l06396" /><CodeLine lineNumber="6396"><span class="doxyHighlight">                              ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx), <a href="/docs/api/classes/llvm/value">Value</a>))&#125;;</span></CodeLine>
<Link id="l06397" /><CodeLine lineNumber="6397"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Append metadata to nvvm.annotations</span></CodeLine>
<Link id="l06398" /><CodeLine lineNumber="6398"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/module">Module</a> &amp;M = &#42;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>.getParent();</span></CodeLine>
<Link id="l06399" /><CodeLine lineNumber="6399"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/namedmdnode">NamedMDNode</a> &#42;MD = M.getOrInsertNamedMetadata(</span><span class="doxyHighlightStringLiteral">&quot;nvvm.annotations&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06400" /><CodeLine lineNumber="6400"><span class="doxyHighlight">    MD-&gt;<a href="/docs/api/classes/llvm/namedmdnode/#ae917c72e5b8e15491cd0dbdd44d818f2">addOperand</a>(<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Ctx, MDVals));</span></CodeLine>
<Link id="l06401" /><CodeLine lineNumber="6401"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06402" /><CodeLine lineNumber="6402"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06403" /><CodeLine lineNumber="6403"></CodeLine>
<Link id="l06404" /><CodeLine lineNumber="6404"><span class="doxyHighlight">std::pair&lt;int32&#95;t, int32&#95;t&gt;</span></CodeLine>
<Link id="l06405" /><CodeLine lineNumber="6405"><span class="doxyHighlight">OpenMPIRBuilder::readThreadBoundsForKernel(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/triple">Triple</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>) &#123;</span></CodeLine>
<Link id="l06406" /><CodeLine lineNumber="6406"><span class="doxyHighlight">  int32&#95;t ThreadLimit =</span></CodeLine>
<Link id="l06407" /><CodeLine lineNumber="6407"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>.<a href="/docs/api/classes/llvm/function/#a4c866d3504a1e0717c8152a590bd6203">getFnAttributeAsParsedInteger</a>(</span><span class="doxyHighlightStringLiteral">&quot;omp&#95;target&#95;thread&#95;limit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06408" /><CodeLine lineNumber="6408"></CodeLine>
<Link id="l06409" /><CodeLine lineNumber="6409"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>.isAMDGPU()) &#123;</span></CodeLine>
<Link id="l06410" /><CodeLine lineNumber="6410"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Attr = <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>.<a href="/docs/api/classes/llvm/function/#a4c319db4fe05c27cfe55bd133a87414d">getFnAttribute</a>(</span><span class="doxyHighlightStringLiteral">&quot;amdgpu-flat-work-group-size&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06411" /><CodeLine lineNumber="6411"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Attr.isValid() || !Attr.isStringAttribute())</span></CodeLine>
<Link id="l06412" /><CodeLine lineNumber="6412"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;0, ThreadLimit&#125;;</span></CodeLine>
<Link id="l06413" /><CodeLine lineNumber="6413"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;LBStr, UBStr&#93; = Attr.<a href="/docs/api/classes/llvm/attribute/#a968930aea9d9efa8d46dd890fce75643">getValueAsString</a>().<a href="/docs/api/classes/llvm/stringref/#a0320b2a5a6d440bf4479a02e78cf5ca7">split</a>(</span><span class="doxyHighlightCharLiteral">&#39;,&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06414" /><CodeLine lineNumber="6414"><span class="doxyHighlight">    int32&#95;t LB, UB;</span></CodeLine>
<Link id="l06415" /><CodeLine lineNumber="6415"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ae03f2b6a02fc9092755ba3a6cf6d2446">llvm::to&#95;integer</a>(UBStr, UB, 10))</span></CodeLine>
<Link id="l06416" /><CodeLine lineNumber="6416"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;0, ThreadLimit&#125;;</span></CodeLine>
<Link id="l06417" /><CodeLine lineNumber="6417"><span class="doxyHighlight">    UB = ThreadLimit ? std::min(ThreadLimit, UB) : UB;</span></CodeLine>
<Link id="l06418" /><CodeLine lineNumber="6418"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ae03f2b6a02fc9092755ba3a6cf6d2446">llvm::to&#95;integer</a>(LBStr, LB, 10))</span></CodeLine>
<Link id="l06419" /><CodeLine lineNumber="6419"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;0, UB&#125;;</span></CodeLine>
<Link id="l06420" /><CodeLine lineNumber="6420"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;LB, UB&#125;;</span></CodeLine>
<Link id="l06421" /><CodeLine lineNumber="6421"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06422" /><CodeLine lineNumber="6422"></CodeLine>
<Link id="l06423" /><CodeLine lineNumber="6423"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MDNode &#42;ExistingOp = <a href="#a749d7f5580e6a5b6214d911bad2a0b36">getNVPTXMDNode</a>(<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>, </span><span class="doxyHighlightStringLiteral">&quot;maxntidx&quot;</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l06424" /><CodeLine lineNumber="6424"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OldVal = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantAsMetadata&gt;</a>(ExistingOp-&gt;getOperand(2));</span></CodeLine>
<Link id="l06425" /><CodeLine lineNumber="6425"><span class="doxyHighlight">    int32&#95;t UB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(OldVal-&gt;getValue())-&gt;getZExtValue();</span></CodeLine>
<Link id="l06426" /><CodeLine lineNumber="6426"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;0, ThreadLimit ? std::min(ThreadLimit, UB) : UB&#125;;</span></CodeLine>
<Link id="l06427" /><CodeLine lineNumber="6427"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06428" /><CodeLine lineNumber="6428"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;0, ThreadLimit&#125;;</span></CodeLine>
<Link id="l06429" /><CodeLine lineNumber="6429"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06430" /><CodeLine lineNumber="6430"></CodeLine>
<Link id="l06431" /><CodeLine lineNumber="6431"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::writeThreadBoundsForKernel(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Triple &amp;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>,</span></CodeLine>
<Link id="l06432" /><CodeLine lineNumber="6432"><span class="doxyHighlight">                                                 Function &amp;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>, int32&#95;t LB,</span></CodeLine>
<Link id="l06433" /><CodeLine lineNumber="6433"><span class="doxyHighlight">                                                 int32&#95;t UB) &#123;</span></CodeLine>
<Link id="l06434" /><CodeLine lineNumber="6434"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>.<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(</span><span class="doxyHighlightStringLiteral">&quot;omp&#95;target&#95;thread&#95;limit&quot;</span><span class="doxyHighlight">, std::to&#95;string(UB));</span></CodeLine>
<Link id="l06435" /><CodeLine lineNumber="6435"></CodeLine>
<Link id="l06436" /><CodeLine lineNumber="6436"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>.isAMDGPU()) &#123;</span></CodeLine>
<Link id="l06437" /><CodeLine lineNumber="6437"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>.<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(</span><span class="doxyHighlightStringLiteral">&quot;amdgpu-flat-work-group-size&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06438" /><CodeLine lineNumber="6438"><span class="doxyHighlight">                     <a href="/docs/api/namespaces/llvm/#a41972fe6f3fab862543b7b835a714f9b">llvm::utostr</a>(LB) + </span><span class="doxyHighlightStringLiteral">&quot;,&quot;</span><span class="doxyHighlight"> + <a href="/docs/api/namespaces/llvm/#a41972fe6f3fab862543b7b835a714f9b">llvm::utostr</a>(UB));</span></CodeLine>
<Link id="l06439" /><CodeLine lineNumber="6439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06440" /><CodeLine lineNumber="6440"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06441" /><CodeLine lineNumber="6441"></CodeLine>
<Link id="l06442" /><CodeLine lineNumber="6442"><span class="doxyHighlight">  <a href="#a457f42a32df73079ac4526c572a2d7fd">updateNVPTXMetadata</a>(<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>, </span><span class="doxyHighlightStringLiteral">&quot;maxntidx&quot;</span><span class="doxyHighlight">, UB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06443" /><CodeLine lineNumber="6443"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06444" /><CodeLine lineNumber="6444"></CodeLine>
<Link id="l06445" /><CodeLine lineNumber="6445"><span class="doxyHighlight">std::pair&lt;int32&#95;t, int32&#95;t&gt;</span></CodeLine>
<Link id="l06446" /><CodeLine lineNumber="6446"><span class="doxyHighlight">OpenMPIRBuilder::readTeamBoundsForKernel(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Triple &amp;, Function &amp;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>) &#123;</span></CodeLine>
<Link id="l06447" /><CodeLine lineNumber="6447"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Read from backend annotations if available.</span></CodeLine>
<Link id="l06448" /><CodeLine lineNumber="6448"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;0, <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>.<a href="/docs/api/classes/llvm/function/#a4c866d3504a1e0717c8152a590bd6203">getFnAttributeAsParsedInteger</a>(</span><span class="doxyHighlightStringLiteral">&quot;omp&#95;target&#95;num&#95;teams&quot;</span><span class="doxyHighlight">)&#125;;</span></CodeLine>
<Link id="l06449" /><CodeLine lineNumber="6449"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06450" /><CodeLine lineNumber="6450"></CodeLine>
<Link id="l06451" /><CodeLine lineNumber="6451"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::writeTeamsForKernel(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Triple &amp;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, Function &amp;<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>,</span></CodeLine>
<Link id="l06452" /><CodeLine lineNumber="6452"><span class="doxyHighlight">                                          int32&#95;t LB, int32&#95;t UB) &#123;</span></CodeLine>
<Link id="l06453" /><CodeLine lineNumber="6453"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>.isNVPTX())</span></CodeLine>
<Link id="l06454" /><CodeLine lineNumber="6454"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UB &gt; 0)</span></CodeLine>
<Link id="l06455" /><CodeLine lineNumber="6455"><span class="doxyHighlight">      <a href="#a457f42a32df73079ac4526c572a2d7fd">updateNVPTXMetadata</a>(<a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>, </span><span class="doxyHighlightStringLiteral">&quot;maxclusterrank&quot;</span><span class="doxyHighlight">, UB, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06456" /><CodeLine lineNumber="6456"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>.isAMDGPU())</span></CodeLine>
<Link id="l06457" /><CodeLine lineNumber="6457"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>.<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(</span><span class="doxyHighlightStringLiteral">&quot;amdgpu-max-num-workgroups&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/#a41972fe6f3fab862543b7b835a714f9b">llvm::utostr</a>(LB) + </span><span class="doxyHighlightStringLiteral">&quot;,1,1&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06458" /><CodeLine lineNumber="6458"></CodeLine>
<Link id="l06459" /><CodeLine lineNumber="6459"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#ab07e7d76494438d05bf51cd36ba5a795">Kernel</a>.<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(</span><span class="doxyHighlightStringLiteral">&quot;omp&#95;target&#95;num&#95;teams&quot;</span><span class="doxyHighlight">, std::to&#95;string(LB));</span></CodeLine>
<Link id="l06460" /><CodeLine lineNumber="6460"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06461" /><CodeLine lineNumber="6461"></CodeLine>
<Link id="l06462" /><CodeLine lineNumber="6462"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::setOutlinedTargetRegionFunctionAttributes(</span></CodeLine>
<Link id="l06463" /><CodeLine lineNumber="6463"><span class="doxyHighlight">    Function &#42;OutlinedFn) &#123;</span></CodeLine>
<Link id="l06464" /><CodeLine lineNumber="6464"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Config.isTargetDevice()) &#123;</span></CodeLine>
<Link id="l06465" /><CodeLine lineNumber="6465"><span class="doxyHighlight">    OutlinedFn-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a687973de03d041e04b50a76d19d4fd36">setLinkage</a>(<a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca696bb1c9b0b0e76bb70c61f68866452a">GlobalValue::WeakODRLinkage</a>);</span></CodeLine>
<Link id="l06466" /><CodeLine lineNumber="6466"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Determine if DSO local can be set to true.</span></CodeLine>
<Link id="l06467" /><CodeLine lineNumber="6467"><span class="doxyHighlight">    OutlinedFn-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a78c4d0538c7dbffa955486abae2b61bb">setDSOLocal</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06468" /><CodeLine lineNumber="6468"><span class="doxyHighlight">    OutlinedFn-&gt;<a href="/docs/api/classes/llvm/globalvalue/#aa242d8ab89216c14beab812e07009b2a">setVisibility</a>(<a href="/docs/api/classes/llvm/globalvalue/#a9141f967188383108a69cc1b8ed3c195ae1cc9a390520055573d459de25747caa">GlobalValue::ProtectedVisibility</a>);</span></CodeLine>
<Link id="l06469" /><CodeLine lineNumber="6469"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>.isAMDGCN())</span></CodeLine>
<Link id="l06470" /><CodeLine lineNumber="6470"><span class="doxyHighlight">      OutlinedFn-&gt;<a href="/docs/api/classes/llvm/function/#ae6db8746934e6feae3649a8709fce3cc">setCallingConv</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca27a385675142c462571165c839e41aa0">CallingConv::AMDGPU&#95;KERNEL</a>);</span></CodeLine>
<Link id="l06471" /><CodeLine lineNumber="6471"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>.isNVPTX())</span></CodeLine>
<Link id="l06472" /><CodeLine lineNumber="6472"><span class="doxyHighlight">      OutlinedFn-&gt;<a href="/docs/api/classes/llvm/function/#ae6db8746934e6feae3649a8709fce3cc">setCallingConv</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cae60325da71f0576e18cc0e5dd7e8afb6">CallingConv::PTX&#95;Kernel</a>);</span></CodeLine>
<Link id="l06473" /><CodeLine lineNumber="6473"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06474" /><CodeLine lineNumber="6474"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06475" /><CodeLine lineNumber="6475"></CodeLine>
<Link id="l06476" /><CodeLine lineNumber="6476"><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;OpenMPIRBuilder::createOutlinedFunctionID(Function &#42;OutlinedFn,</span></CodeLine>
<Link id="l06477" /><CodeLine lineNumber="6477"><span class="doxyHighlight">                                                    StringRef EntryFnIDName) &#123;</span></CodeLine>
<Link id="l06478" /><CodeLine lineNumber="6478"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Config.isTargetDevice()) &#123;</span></CodeLine>
<Link id="l06479" /><CodeLine lineNumber="6479"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFn &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;The outlined function must exist if embedded&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06480" /><CodeLine lineNumber="6480"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OutlinedFn;</span></CodeLine>
<Link id="l06481" /><CodeLine lineNumber="6481"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06482" /><CodeLine lineNumber="6482"></CodeLine>
<Link id="l06483" /><CodeLine lineNumber="6483"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> GlobalVariable(</span></CodeLine>
<Link id="l06484" /><CodeLine lineNumber="6484"><span class="doxyHighlight">      M, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7be2e1490f01c049d748436f03760c5">getInt8Ty</a>(), </span><span class="doxyHighlightComment">/&#42;isConstant=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca8d13a9bcecfac72febceb1103afa048f">GlobalValue::WeakAnyLinkage</a>,</span></CodeLine>
<Link id="l06485" /><CodeLine lineNumber="6485"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7be2e1490f01c049d748436f03760c5">getInt8Ty</a>()), EntryFnIDName);</span></CodeLine>
<Link id="l06486" /><CodeLine lineNumber="6486"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06487" /><CodeLine lineNumber="6487"></CodeLine>
<Link id="l06488" /><CodeLine lineNumber="6488"><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;OpenMPIRBuilder::createTargetRegionEntryAddr(Function &#42;OutlinedFn,</span></CodeLine>
<Link id="l06489" /><CodeLine lineNumber="6489"><span class="doxyHighlight">                                                       StringRef EntryFnName) &#123;</span></CodeLine>
<Link id="l06490" /><CodeLine lineNumber="6490"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OutlinedFn)</span></CodeLine>
<Link id="l06491" /><CodeLine lineNumber="6491"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OutlinedFn;</span></CodeLine>
<Link id="l06492" /><CodeLine lineNumber="6492"></CodeLine>
<Link id="l06493" /><CodeLine lineNumber="6493"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getGlobalVariable(EntryFnName, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &amp;&amp;</span></CodeLine>
<Link id="l06494" /><CodeLine lineNumber="6494"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Named kernel already exists?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06495" /><CodeLine lineNumber="6495"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> GlobalVariable(</span></CodeLine>
<Link id="l06496" /><CodeLine lineNumber="6496"><span class="doxyHighlight">      M, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7be2e1490f01c049d748436f03760c5">getInt8Ty</a>(), </span><span class="doxyHighlightComment">/&#42;isConstant=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>,</span></CodeLine>
<Link id="l06497" /><CodeLine lineNumber="6497"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae7be2e1490f01c049d748436f03760c5">getInt8Ty</a>()), EntryFnName);</span></CodeLine>
<Link id="l06498" /><CodeLine lineNumber="6498"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06499" /><CodeLine lineNumber="6499"></CodeLine>
<Link id="l06500" /><CodeLine lineNumber="6500"><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> OpenMPIRBuilder::emitTargetRegionFunction(</span></CodeLine>
<Link id="l06501" /><CodeLine lineNumber="6501"><span class="doxyHighlight">    TargetRegionEntryInfo &amp;EntryInfo,</span></CodeLine>
<Link id="l06502" /><CodeLine lineNumber="6502"><span class="doxyHighlight">    FunctionGenCallback &amp;GenerateFunctionCallback, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsOffloadEntry,</span></CodeLine>
<Link id="l06503" /><CodeLine lineNumber="6503"><span class="doxyHighlight">    Function &#42;&amp;OutlinedFn, <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;&amp;OutlinedFnID) &#123;</span></CodeLine>
<Link id="l06504" /><CodeLine lineNumber="6504"></CodeLine>
<Link id="l06505" /><CodeLine lineNumber="6505"><span class="doxyHighlight">  SmallString&lt;64&gt; EntryFnName;</span></CodeLine>
<Link id="l06506" /><CodeLine lineNumber="6506"><span class="doxyHighlight">  OffloadInfoManager.getTargetRegionEntryFnName(EntryFnName, EntryInfo);</span></CodeLine>
<Link id="l06507" /><CodeLine lineNumber="6507"></CodeLine>
<Link id="l06508" /><CodeLine lineNumber="6508"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Config.isTargetDevice() || !Config.openMPOffloadMandatory()) &#123;</span></CodeLine>
<Link id="l06509" /><CodeLine lineNumber="6509"><span class="doxyHighlight">    Expected&lt;Function &#42;&gt; CBResult = GenerateFunctionCallback(EntryFnName);</span></CodeLine>
<Link id="l06510" /><CodeLine lineNumber="6510"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CBResult)</span></CodeLine>
<Link id="l06511" /><CodeLine lineNumber="6511"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CBResult.<a href="/docs/api/classes/llvm/expected/#a94789df4ebd03dc008e8adebaa66ac1f">takeError</a>();</span></CodeLine>
<Link id="l06512" /><CodeLine lineNumber="6512"><span class="doxyHighlight">    OutlinedFn = &#42;CBResult;</span></CodeLine>
<Link id="l06513" /><CodeLine lineNumber="6513"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06514" /><CodeLine lineNumber="6514"><span class="doxyHighlight">    OutlinedFn = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06515" /><CodeLine lineNumber="6515"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06516" /><CodeLine lineNumber="6516"></CodeLine>
<Link id="l06517" /><CodeLine lineNumber="6517"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this target outline function is not an offload entry, we don&#39;t need to</span></CodeLine>
<Link id="l06518" /><CodeLine lineNumber="6518"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// register it. This may be in the case of a false if clause, or if there are</span></CodeLine>
<Link id="l06519" /><CodeLine lineNumber="6519"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// no OpenMP targets.</span></CodeLine>
<Link id="l06520" /><CodeLine lineNumber="6520"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsOffloadEntry)</span></CodeLine>
<Link id="l06521" /><CodeLine lineNumber="6521"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l06522" /><CodeLine lineNumber="6522"></CodeLine>
<Link id="l06523" /><CodeLine lineNumber="6523"><span class="doxyHighlight">  std::string EntryFnIDName =</span></CodeLine>
<Link id="l06524" /><CodeLine lineNumber="6524"><span class="doxyHighlight">      Config.isTargetDevice()</span></CodeLine>
<Link id="l06525" /><CodeLine lineNumber="6525"><span class="doxyHighlight">          ? std::string(EntryFnName)</span></CodeLine>
<Link id="l06526" /><CodeLine lineNumber="6526"><span class="doxyHighlight">          : <a href="/docs/api/classes/llvm/openmpirbuilder/#a488c861f8a68e5f78ceca8b57acd8be5">createPlatformSpecificName</a>(&#123;EntryFnName, </span><span class="doxyHighlightStringLiteral">&quot;region&#95;id&quot;</span><span class="doxyHighlight">&#125;);</span></CodeLine>
<Link id="l06527" /><CodeLine lineNumber="6527"></CodeLine>
<Link id="l06528" /><CodeLine lineNumber="6528"><span class="doxyHighlight">  OutlinedFnID = registerTargetRegionFunction(EntryInfo, OutlinedFn,</span></CodeLine>
<Link id="l06529" /><CodeLine lineNumber="6529"><span class="doxyHighlight">                                              EntryFnName, EntryFnIDName);</span></CodeLine>
<Link id="l06530" /><CodeLine lineNumber="6530"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l06531" /><CodeLine lineNumber="6531"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06532" /><CodeLine lineNumber="6532"></CodeLine>
<Link id="l06533" /><CodeLine lineNumber="6533"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;OpenMPIRBuilder::registerTargetRegionFunction(</span></CodeLine>
<Link id="l06534" /><CodeLine lineNumber="6534"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> &amp;EntryInfo, <a href="/docs/api/classes/llvm/function">Function</a> &#42;OutlinedFn,</span></CodeLine>
<Link id="l06535" /><CodeLine lineNumber="6535"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/stringref">StringRef</a> EntryFnName, <a href="/docs/api/classes/llvm/stringref">StringRef</a> EntryFnIDName) &#123;</span></CodeLine>
<Link id="l06536" /><CodeLine lineNumber="6536"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OutlinedFn)</span></CodeLine>
<Link id="l06537" /><CodeLine lineNumber="6537"><span class="doxyHighlight">    setOutlinedTargetRegionFunctionAttributes(OutlinedFn);</span></CodeLine>
<Link id="l06538" /><CodeLine lineNumber="6538"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> OutlinedFnID = createOutlinedFunctionID(OutlinedFn, EntryFnIDName);</span></CodeLine>
<Link id="l06539" /><CodeLine lineNumber="6539"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EntryAddr = createTargetRegionEntryAddr(OutlinedFn, EntryFnName);</span></CodeLine>
<Link id="l06540" /><CodeLine lineNumber="6540"><span class="doxyHighlight">  OffloadInfoManager.registerTargetRegionEntryInfo(</span></CodeLine>
<Link id="l06541" /><CodeLine lineNumber="6541"><span class="doxyHighlight">      EntryInfo, EntryAddr, OutlinedFnID,</span></CodeLine>
<Link id="l06542" /><CodeLine lineNumber="6542"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a4e85049eada7d6cc3bedde1433ce4a7ba1e2537a111117d2cebad779b6de1856b">OffloadEntriesInfoManager::OMPTargetRegionEntryTargetRegion</a>);</span></CodeLine>
<Link id="l06543" /><CodeLine lineNumber="6543"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OutlinedFnID;</span></CodeLine>
<Link id="l06544" /><CodeLine lineNumber="6544"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06545" /><CodeLine lineNumber="6545"></CodeLine>
<Link id="l06546" /><CodeLine lineNumber="6546"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> OpenMPIRBuilder::createTargetData(</span></CodeLine>
<Link id="l06547" /><CodeLine lineNumber="6547"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l06548" /><CodeLine lineNumber="6548"><span class="doxyHighlight">    InsertPointTy CodeGenIP, <a href="/docs/api/classes/llvm/value">Value</a> &#42;DeviceID, <a href="/docs/api/classes/llvm/value">Value</a> &#42;IfCond,</span></CodeLine>
<Link id="l06549" /><CodeLine lineNumber="6549"><span class="doxyHighlight">    TargetDataInfo &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>, GenMapInfoCallbackTy GenMapInfoCB,</span></CodeLine>
<Link id="l06550" /><CodeLine lineNumber="6550"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#a4c503140c7f851151906d85b515330e9">omp::RuntimeFunction</a> &#42;MapperFunc,</span></CodeLine>
<Link id="l06551" /><CodeLine lineNumber="6551"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;InsertPointOrErrorTy(InsertPointTy CodeGenIP,</span></CodeLine>
<Link id="l06552" /><CodeLine lineNumber="6552"><span class="doxyHighlight">                                      BodyGenTy BodyGenType)&gt;</span></CodeLine>
<Link id="l06553" /><CodeLine lineNumber="6553"><span class="doxyHighlight">        BodyGenCB,</span></CodeLine>
<Link id="l06554" /><CodeLine lineNumber="6554"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/value">Value</a> &#42;)&gt; DeviceAddrCB,</span></CodeLine>
<Link id="l06555" /><CodeLine lineNumber="6555"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/value">Value</a> &#42;(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">)&gt; CustomMapperCB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;SrcLocInfo) &#123;</span></CodeLine>
<Link id="l06556" /><CodeLine lineNumber="6556"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l06557" /><CodeLine lineNumber="6557"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>();</span></CodeLine>
<Link id="l06558" /><CodeLine lineNumber="6558"></CodeLine>
<Link id="l06559" /><CodeLine lineNumber="6559"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l06560" /><CodeLine lineNumber="6560"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Disable TargetData CodeGen on Device pass.</span></CodeLine>
<Link id="l06561" /><CodeLine lineNumber="6561"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Config.IsTargetDevice.value&#95;or(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l06562" /><CodeLine lineNumber="6562"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BodyGenCB) &#123;</span></CodeLine>
<Link id="l06563" /><CodeLine lineNumber="6563"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l06564" /><CodeLine lineNumber="6564"><span class="doxyHighlight">          BodyGenCB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), BodyGenTy::NoPriv);</span></CodeLine>
<Link id="l06565" /><CodeLine lineNumber="6565"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l06566" /><CodeLine lineNumber="6566"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l06567" /><CodeLine lineNumber="6567"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#42;AfterIP);</span></CodeLine>
<Link id="l06568" /><CodeLine lineNumber="6568"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06569" /><CodeLine lineNumber="6569"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l06570" /><CodeLine lineNumber="6570"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06571" /><CodeLine lineNumber="6571"></CodeLine>
<Link id="l06572" /><CodeLine lineNumber="6572"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsStandAlone = !BodyGenCB;</span></CodeLine>
<Link id="l06573" /><CodeLine lineNumber="6573"><span class="doxyHighlight">  MapInfosTy &#42;MapInfo;</span></CodeLine>
<Link id="l06574" /><CodeLine lineNumber="6574"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate the code for the opening of the data environment. Capture all the</span></CodeLine>
<Link id="l06575" /><CodeLine lineNumber="6575"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// arguments of the runtime call by reference because they are used in the</span></CodeLine>
<Link id="l06576" /><CodeLine lineNumber="6576"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// closing of the region.</span></CodeLine>
<Link id="l06577" /><CodeLine lineNumber="6577"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BeginThenGen = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AllocaIP,</span></CodeLine>
<Link id="l06578" /><CodeLine lineNumber="6578"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> CodeGenIP) -&gt; <a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> &#123;</span></CodeLine>
<Link id="l06579" /><CodeLine lineNumber="6579"><span class="doxyHighlight">    MapInfo = &amp;GenMapInfoCB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>());</span></CodeLine>
<Link id="l06580" /><CodeLine lineNumber="6580"><span class="doxyHighlight">    emitOffloadingArrays(AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), &#42;MapInfo, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>,</span></CodeLine>
<Link id="l06581" /><CodeLine lineNumber="6581"><span class="doxyHighlight">                         </span><span class="doxyHighlightComment">/&#42;IsNonContiguous=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, DeviceAddrCB,</span></CodeLine>
<Link id="l06582" /><CodeLine lineNumber="6582"><span class="doxyHighlight">                         CustomMapperCB);</span></CodeLine>
<Link id="l06583" /><CodeLine lineNumber="6583"></CodeLine>
<Link id="l06584" /><CodeLine lineNumber="6584"><span class="doxyHighlight">    TargetDataRTArgs RTArgs;</span></CodeLine>
<Link id="l06585" /><CodeLine lineNumber="6585"><span class="doxyHighlight">    emitOffloadingArraysArgument(Builder, RTArgs, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>);</span></CodeLine>
<Link id="l06586" /><CodeLine lineNumber="6586"></CodeLine>
<Link id="l06587" /><CodeLine lineNumber="6587"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Emit the number of elements in the offloading arrays.</span></CodeLine>
<Link id="l06588" /><CodeLine lineNumber="6588"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PointerNum = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs);</span></CodeLine>
<Link id="l06589" /><CodeLine lineNumber="6589"></CodeLine>
<Link id="l06590" /><CodeLine lineNumber="6590"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Source location for the ident struct</span></CodeLine>
<Link id="l06591" /><CodeLine lineNumber="6591"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SrcLocInfo) &#123;</span></CodeLine>
<Link id="l06592" /><CodeLine lineNumber="6592"><span class="doxyHighlight">      uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l06593" /><CodeLine lineNumber="6593"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l06594" /><CodeLine lineNumber="6594"><span class="doxyHighlight">      SrcLocInfo = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l06595" /><CodeLine lineNumber="6595"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06596" /><CodeLine lineNumber="6596"></CodeLine>
<Link id="l06597" /><CodeLine lineNumber="6597"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;llvm::Value &#42;, 13&gt;</a> OffloadingArgs = &#123;</span></CodeLine>
<Link id="l06598" /><CodeLine lineNumber="6598"><span class="doxyHighlight">        SrcLocInfo,           DeviceID,</span></CodeLine>
<Link id="l06599" /><CodeLine lineNumber="6599"><span class="doxyHighlight">        PointerNum,           RTArgs.BasePointersArray,</span></CodeLine>
<Link id="l06600" /><CodeLine lineNumber="6600"><span class="doxyHighlight">        RTArgs.PointersArray, RTArgs.SizesArray,</span></CodeLine>
<Link id="l06601" /><CodeLine lineNumber="6601"><span class="doxyHighlight">        RTArgs.MapTypesArray, RTArgs.MapNamesArray,</span></CodeLine>
<Link id="l06602" /><CodeLine lineNumber="6602"><span class="doxyHighlight">        RTArgs.MappersArray&#125;;</span></CodeLine>
<Link id="l06603" /><CodeLine lineNumber="6603"></CodeLine>
<Link id="l06604" /><CodeLine lineNumber="6604"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsStandAlone) &#123;</span></CodeLine>
<Link id="l06605" /><CodeLine lineNumber="6605"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MapperFunc &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;MapperFunc missing for standalone target data&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06606" /><CodeLine lineNumber="6606"></CodeLine>
<Link id="l06607" /><CodeLine lineNumber="6607"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TaskBodyCB = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;,</span></CodeLine>
<Link id="l06608" /><CodeLine lineNumber="6608"><span class="doxyHighlight">                            IRBuilderBase::InsertPoint) -&gt; <a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> &#123;</span></CodeLine>
<Link id="l06609" /><CodeLine lineNumber="6609"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.HasNoWait) &#123;</span></CodeLine>
<Link id="l06610" /><CodeLine lineNumber="6610"><span class="doxyHighlight">          OffloadingArgs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(&#123;<a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">llvm::Constant::getNullValue</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>),</span></CodeLine>
<Link id="l06611" /><CodeLine lineNumber="6611"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">llvm::Constant::getNullValue</a>(VoidPtr),</span></CodeLine>
<Link id="l06612" /><CodeLine lineNumber="6612"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">llvm::Constant::getNullValue</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a788a72ddbf1bd572b3fcd7a5e7ec8cff">Int32</a>),</span></CodeLine>
<Link id="l06613" /><CodeLine lineNumber="6613"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">llvm::Constant::getNullValue</a>(VoidPtr)&#125;);</span></CodeLine>
<Link id="l06614" /><CodeLine lineNumber="6614"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l06615" /><CodeLine lineNumber="6615"></CodeLine>
<Link id="l06616" /><CodeLine lineNumber="6616"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(getOrCreateRuntimeFunctionPtr(&#42;MapperFunc),</span></CodeLine>
<Link id="l06617" /><CodeLine lineNumber="6617"><span class="doxyHighlight">                           OffloadingArgs);</span></CodeLine>
<Link id="l06618" /><CodeLine lineNumber="6618"></CodeLine>
<Link id="l06619" /><CodeLine lineNumber="6619"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.HasNoWait) &#123;</span></CodeLine>
<Link id="l06620" /><CodeLine lineNumber="6620"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;OffloadContBlock =</span></CodeLine>
<Link id="l06621" /><CodeLine lineNumber="6621"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;offload.cont&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06622" /><CodeLine lineNumber="6622"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;CurFn = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l06623" /><CodeLine lineNumber="6623"><span class="doxyHighlight">          emitBlock(OffloadContBlock, CurFn, </span><span class="doxyHighlightComment">/&#42;IsFinished=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06624" /><CodeLine lineNumber="6624"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>());</span></CodeLine>
<Link id="l06625" /><CodeLine lineNumber="6625"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l06626" /><CodeLine lineNumber="6626"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l06627" /><CodeLine lineNumber="6627"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l06628" /><CodeLine lineNumber="6628"></CodeLine>
<Link id="l06629" /><CodeLine lineNumber="6629"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RequiresOuterTargetTask = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.HasNoWait;</span></CodeLine>
<Link id="l06630" /><CodeLine lineNumber="6630"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RequiresOuterTargetTask)</span></CodeLine>
<Link id="l06631" /><CodeLine lineNumber="6631"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#aa1e1474f15df639f0d874b21f15666f7">cantFail</a>(TaskBodyCB(</span><span class="doxyHighlightComment">/&#42;DeviceID=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;RTLoc=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06632" /><CodeLine lineNumber="6632"><span class="doxyHighlight">                            </span><span class="doxyHighlightComment">/&#42;TargetTaskAllocaIP=&#42;/</span><span class="doxyHighlight">&#123;&#125;));</span></CodeLine>
<Link id="l06633" /><CodeLine lineNumber="6633"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06634" /><CodeLine lineNumber="6634"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#aa1e1474f15df639f0d874b21f15666f7">cantFail</a>(emitTargetTask(TaskBodyCB, DeviceID, SrcLocInfo, AllocaIP,</span></CodeLine>
<Link id="l06635" /><CodeLine lineNumber="6635"><span class="doxyHighlight">                                </span><span class="doxyHighlightComment">/&#42;Dependencies=&#42;/</span><span class="doxyHighlight">&#123;&#125;, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.HasNoWait));</span></CodeLine>
<Link id="l06636" /><CodeLine lineNumber="6636"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06637" /><CodeLine lineNumber="6637"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;BeginMapperFunc = getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l06638" /><CodeLine lineNumber="6638"><span class="doxyHighlight">          omp::OMPRTL&#95;&#95;&#95;tgt&#95;target&#95;data&#95;begin&#95;mapper);</span></CodeLine>
<Link id="l06639" /><CodeLine lineNumber="6639"></CodeLine>
<Link id="l06640" /><CodeLine lineNumber="6640"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(BeginMapperFunc, OffloadingArgs);</span></CodeLine>
<Link id="l06641" /><CodeLine lineNumber="6641"></CodeLine>
<Link id="l06642" /><CodeLine lineNumber="6642"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DeviceMap : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.DevicePtrInfoMap) &#123;</span></CodeLine>
<Link id="l06643" /><CodeLine lineNumber="6643"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(DeviceMap.second.second)) &#123;</span></CodeLine>
<Link id="l06644" /><CodeLine lineNumber="6644"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LI =</span></CodeLine>
<Link id="l06645" /><CodeLine lineNumber="6645"><span class="doxyHighlight">              Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), DeviceMap.second.first);</span></CodeLine>
<Link id="l06646" /><CodeLine lineNumber="6646"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(LI, DeviceMap.second.second);</span></CodeLine>
<Link id="l06647" /><CodeLine lineNumber="6647"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l06648" /><CodeLine lineNumber="6648"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06649" /><CodeLine lineNumber="6649"></CodeLine>
<Link id="l06650" /><CodeLine lineNumber="6650"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If device pointer privatization is required, emit the body of the</span></CodeLine>
<Link id="l06651" /><CodeLine lineNumber="6651"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// region here. It will have to be duplicated: with and without</span></CodeLine>
<Link id="l06652" /><CodeLine lineNumber="6652"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// privatization.</span></CodeLine>
<Link id="l06653" /><CodeLine lineNumber="6653"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l06654" /><CodeLine lineNumber="6654"><span class="doxyHighlight">          BodyGenCB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), BodyGenTy::Priv);</span></CodeLine>
<Link id="l06655" /><CodeLine lineNumber="6655"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l06656" /><CodeLine lineNumber="6656"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l06657" /><CodeLine lineNumber="6657"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#42;AfterIP);</span></CodeLine>
<Link id="l06658" /><CodeLine lineNumber="6658"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06659" /><CodeLine lineNumber="6659"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l06660" /><CodeLine lineNumber="6660"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l06661" /><CodeLine lineNumber="6661"></CodeLine>
<Link id="l06662" /><CodeLine lineNumber="6662"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we need device pointer privatization, we need to emit the body of the</span></CodeLine>
<Link id="l06663" /><CodeLine lineNumber="6663"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// region with no privatization in the &#39;else&#39; branch of the conditional.</span></CodeLine>
<Link id="l06664" /><CodeLine lineNumber="6664"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, we don&#39;t have to do anything.</span></CodeLine>
<Link id="l06665" /><CodeLine lineNumber="6665"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BeginElseGen = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AllocaIP,</span></CodeLine>
<Link id="l06666" /><CodeLine lineNumber="6666"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> CodeGenIP) -&gt; <a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> &#123;</span></CodeLine>
<Link id="l06667" /><CodeLine lineNumber="6667"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l06668" /><CodeLine lineNumber="6668"><span class="doxyHighlight">        BodyGenCB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), BodyGenTy::DupNoPriv);</span></CodeLine>
<Link id="l06669" /><CodeLine lineNumber="6669"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l06670" /><CodeLine lineNumber="6670"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l06671" /><CodeLine lineNumber="6671"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#42;AfterIP);</span></CodeLine>
<Link id="l06672" /><CodeLine lineNumber="6672"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l06673" /><CodeLine lineNumber="6673"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l06674" /><CodeLine lineNumber="6674"></CodeLine>
<Link id="l06675" /><CodeLine lineNumber="6675"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate code for the closing of the data region.</span></CodeLine>
<Link id="l06676" /><CodeLine lineNumber="6676"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EndThenGen = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AllocaIP, <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> CodeGenIP) &#123;</span></CodeLine>
<Link id="l06677" /><CodeLine lineNumber="6677"><span class="doxyHighlight">    TargetDataRTArgs RTArgs;</span></CodeLine>
<Link id="l06678" /><CodeLine lineNumber="6678"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.EmitDebug = !MapInfo-&gt;Names.empty();</span></CodeLine>
<Link id="l06679" /><CodeLine lineNumber="6679"><span class="doxyHighlight">    emitOffloadingArraysArgument(Builder, RTArgs, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>, </span><span class="doxyHighlightComment">/&#42;ForEndCall=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06680" /><CodeLine lineNumber="6680"></CodeLine>
<Link id="l06681" /><CodeLine lineNumber="6681"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Emit the number of elements in the offloading arrays.</span></CodeLine>
<Link id="l06682" /><CodeLine lineNumber="6682"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PointerNum = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs);</span></CodeLine>
<Link id="l06683" /><CodeLine lineNumber="6683"></CodeLine>
<Link id="l06684" /><CodeLine lineNumber="6684"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Source location for the ident struct</span></CodeLine>
<Link id="l06685" /><CodeLine lineNumber="6685"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SrcLocInfo) &#123;</span></CodeLine>
<Link id="l06686" /><CodeLine lineNumber="6686"><span class="doxyHighlight">      uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l06687" /><CodeLine lineNumber="6687"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(Loc, SrcLocStrSize);</span></CodeLine>
<Link id="l06688" /><CodeLine lineNumber="6688"><span class="doxyHighlight">      SrcLocInfo = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l06689" /><CodeLine lineNumber="6689"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06690" /><CodeLine lineNumber="6690"></CodeLine>
<Link id="l06691" /><CodeLine lineNumber="6691"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OffloadingArgs&#91;&#93; = &#123;SrcLocInfo,           DeviceID,</span></CodeLine>
<Link id="l06692" /><CodeLine lineNumber="6692"><span class="doxyHighlight">                               PointerNum,           RTArgs.BasePointersArray,</span></CodeLine>
<Link id="l06693" /><CodeLine lineNumber="6693"><span class="doxyHighlight">                               RTArgs.PointersArray, RTArgs.SizesArray,</span></CodeLine>
<Link id="l06694" /><CodeLine lineNumber="6694"><span class="doxyHighlight">                               RTArgs.MapTypesArray, RTArgs.MapNamesArray,</span></CodeLine>
<Link id="l06695" /><CodeLine lineNumber="6695"><span class="doxyHighlight">                               RTArgs.MappersArray&#125;;</span></CodeLine>
<Link id="l06696" /><CodeLine lineNumber="6696"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;EndMapperFunc =</span></CodeLine>
<Link id="l06697" /><CodeLine lineNumber="6697"><span class="doxyHighlight">        getOrCreateRuntimeFunctionPtr(omp::OMPRTL&#95;&#95;&#95;tgt&#95;target&#95;data&#95;end&#95;mapper);</span></CodeLine>
<Link id="l06698" /><CodeLine lineNumber="6698"></CodeLine>
<Link id="l06699" /><CodeLine lineNumber="6699"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(EndMapperFunc, OffloadingArgs);</span></CodeLine>
<Link id="l06700" /><CodeLine lineNumber="6700"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l06701" /><CodeLine lineNumber="6701"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l06702" /><CodeLine lineNumber="6702"></CodeLine>
<Link id="l06703" /><CodeLine lineNumber="6703"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We don&#39;t have to do anything to close the region if the if clause evaluates</span></CodeLine>
<Link id="l06704" /><CodeLine lineNumber="6704"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to false.</span></CodeLine>
<Link id="l06705" /><CodeLine lineNumber="6705"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EndElseGen = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AllocaIP, <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> CodeGenIP) &#123;</span></CodeLine>
<Link id="l06706" /><CodeLine lineNumber="6706"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l06707" /><CodeLine lineNumber="6707"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l06708" /><CodeLine lineNumber="6708"></CodeLine>
<Link id="l06709" /><CodeLine lineNumber="6709"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = &#91;&amp;&#93;() -&gt; <a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> &#123;</span></CodeLine>
<Link id="l06710" /><CodeLine lineNumber="6710"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BodyGenCB) &#123;</span></CodeLine>
<Link id="l06711" /><CodeLine lineNumber="6711"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l06712" /><CodeLine lineNumber="6712"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfCond)</span></CodeLine>
<Link id="l06713" /><CodeLine lineNumber="6713"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> emitIfClause(IfCond, BeginThenGen, BeginElseGen, AllocaIP);</span></CodeLine>
<Link id="l06714" /><CodeLine lineNumber="6714"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BeginThenGen(AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>());</span></CodeLine>
<Link id="l06715" /><CodeLine lineNumber="6715"><span class="doxyHighlight">      &#125;();</span></CodeLine>
<Link id="l06716" /><CodeLine lineNumber="6716"></CodeLine>
<Link id="l06717" /><CodeLine lineNumber="6717"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Err)</span></CodeLine>
<Link id="l06718" /><CodeLine lineNumber="6718"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l06719" /><CodeLine lineNumber="6719"></CodeLine>
<Link id="l06720" /><CodeLine lineNumber="6720"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we don&#39;t require privatization of device pointers, we emit the body</span></CodeLine>
<Link id="l06721" /><CodeLine lineNumber="6721"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// in between the runtime calls. This avoids duplicating the body code.</span></CodeLine>
<Link id="l06722" /><CodeLine lineNumber="6722"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l06723" /><CodeLine lineNumber="6723"><span class="doxyHighlight">          BodyGenCB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), BodyGenTy::NoPriv);</span></CodeLine>
<Link id="l06724" /><CodeLine lineNumber="6724"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l06725" /><CodeLine lineNumber="6725"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.takeError();</span></CodeLine>
<Link id="l06726" /><CodeLine lineNumber="6726"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#42;AfterIP);</span></CodeLine>
<Link id="l06727" /><CodeLine lineNumber="6727"></CodeLine>
<Link id="l06728" /><CodeLine lineNumber="6728"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfCond)</span></CodeLine>
<Link id="l06729" /><CodeLine lineNumber="6729"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> emitIfClause(IfCond, EndThenGen, EndElseGen, AllocaIP);</span></CodeLine>
<Link id="l06730" /><CodeLine lineNumber="6730"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EndThenGen(AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>());</span></CodeLine>
<Link id="l06731" /><CodeLine lineNumber="6731"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06732" /><CodeLine lineNumber="6732"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfCond)</span></CodeLine>
<Link id="l06733" /><CodeLine lineNumber="6733"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> emitIfClause(IfCond, BeginThenGen, EndElseGen, AllocaIP);</span></CodeLine>
<Link id="l06734" /><CodeLine lineNumber="6734"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BeginThenGen(AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>());</span></CodeLine>
<Link id="l06735" /><CodeLine lineNumber="6735"><span class="doxyHighlight">  &#125;();</span></CodeLine>
<Link id="l06736" /><CodeLine lineNumber="6736"></CodeLine>
<Link id="l06737" /><CodeLine lineNumber="6737"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Err)</span></CodeLine>
<Link id="l06738" /><CodeLine lineNumber="6738"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l06739" /><CodeLine lineNumber="6739"></CodeLine>
<Link id="l06740" /><CodeLine lineNumber="6740"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l06741" /><CodeLine lineNumber="6741"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06742" /><CodeLine lineNumber="6742"></CodeLine>
<Link id="l06743" /><CodeLine lineNumber="6743"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a></span></CodeLine>
<Link id="l06744" /><CodeLine lineNumber="6744"><span class="doxyHighlight">OpenMPIRBuilder::createForStaticInitFunction(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IVSize, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IVSigned,</span></CodeLine>
<Link id="l06745" /><CodeLine lineNumber="6745"><span class="doxyHighlight">                                             </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsGPUDistribute) &#123;</span></CodeLine>
<Link id="l06746" /><CodeLine lineNumber="6746"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((IVSize == 32 || IVSize == 64) &amp;&amp;</span></CodeLine>
<Link id="l06747" /><CodeLine lineNumber="6747"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;IV size is not compatible with the omp runtime&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06748" /><CodeLine lineNumber="6748"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a4c503140c7f851151906d85b515330e9">RuntimeFunction</a> <a href="/docs/api/namespaces/llvm/graphprogram/#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a>;</span></CodeLine>
<Link id="l06749" /><CodeLine lineNumber="6749"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsGPUDistribute)</span></CodeLine>
<Link id="l06750" /><CodeLine lineNumber="6750"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/graphprogram/#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a> = IVSize == 32</span></CodeLine>
<Link id="l06751" /><CodeLine lineNumber="6751"><span class="doxyHighlight">               ? (IVSigned ? omp::OMPRTL&#95;&#95;&#95;kmpc&#95;distribute&#95;static&#95;init&#95;4</span></CodeLine>
<Link id="l06752" /><CodeLine lineNumber="6752"><span class="doxyHighlight">                           : omp::OMPRTL&#95;&#95;&#95;kmpc&#95;distribute&#95;static&#95;init&#95;4u)</span></CodeLine>
<Link id="l06753" /><CodeLine lineNumber="6753"><span class="doxyHighlight">               : (IVSigned ? omp::OMPRTL&#95;&#95;&#95;kmpc&#95;distribute&#95;static&#95;init&#95;8</span></CodeLine>
<Link id="l06754" /><CodeLine lineNumber="6754"><span class="doxyHighlight">                           : omp::OMPRTL&#95;&#95;&#95;kmpc&#95;distribute&#95;static&#95;init&#95;8u);</span></CodeLine>
<Link id="l06755" /><CodeLine lineNumber="6755"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06756" /><CodeLine lineNumber="6756"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/graphprogram/#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a> = IVSize == 32 ? (IVSigned ? omp::OMPRTL&#95;&#95;&#95;kmpc&#95;for&#95;static&#95;init&#95;4</span></CodeLine>
<Link id="l06757" /><CodeLine lineNumber="6757"><span class="doxyHighlight">                                    : omp::OMPRTL&#95;&#95;&#95;kmpc&#95;for&#95;static&#95;init&#95;4u)</span></CodeLine>
<Link id="l06758" /><CodeLine lineNumber="6758"><span class="doxyHighlight">                        : (IVSigned ? omp::OMPRTL&#95;&#95;&#95;kmpc&#95;for&#95;static&#95;init&#95;8</span></CodeLine>
<Link id="l06759" /><CodeLine lineNumber="6759"><span class="doxyHighlight">                                    : omp::OMPRTL&#95;&#95;&#95;kmpc&#95;for&#95;static&#95;init&#95;8u);</span></CodeLine>
<Link id="l06760" /><CodeLine lineNumber="6760"></CodeLine>
<Link id="l06761" /><CodeLine lineNumber="6761"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> getOrCreateRuntimeFunction(M, Name);</span></CodeLine>
<Link id="l06762" /><CodeLine lineNumber="6762"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06763" /><CodeLine lineNumber="6763"></CodeLine>
<Link id="l06764" /><CodeLine lineNumber="6764"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a> OpenMPIRBuilder::createDispatchInitFunction(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IVSize,</span></CodeLine>
<Link id="l06765" /><CodeLine lineNumber="6765"><span class="doxyHighlight">                                                           </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IVSigned) &#123;</span></CodeLine>
<Link id="l06766" /><CodeLine lineNumber="6766"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((IVSize == 32 || IVSize == 64) &amp;&amp;</span></CodeLine>
<Link id="l06767" /><CodeLine lineNumber="6767"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;IV size is not compatible with the omp runtime&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06768" /><CodeLine lineNumber="6768"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a4c503140c7f851151906d85b515330e9">RuntimeFunction</a> <a href="/docs/api/namespaces/llvm/graphprogram/#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a> = IVSize == 32</span></CodeLine>
<Link id="l06769" /><CodeLine lineNumber="6769"><span class="doxyHighlight">                             ? (IVSigned ? omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;init&#95;4</span></CodeLine>
<Link id="l06770" /><CodeLine lineNumber="6770"><span class="doxyHighlight">                                         : omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;init&#95;4u)</span></CodeLine>
<Link id="l06771" /><CodeLine lineNumber="6771"><span class="doxyHighlight">                             : (IVSigned ? omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;init&#95;8</span></CodeLine>
<Link id="l06772" /><CodeLine lineNumber="6772"><span class="doxyHighlight">                                         : omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;init&#95;8u);</span></CodeLine>
<Link id="l06773" /><CodeLine lineNumber="6773"></CodeLine>
<Link id="l06774" /><CodeLine lineNumber="6774"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> getOrCreateRuntimeFunction(M, Name);</span></CodeLine>
<Link id="l06775" /><CodeLine lineNumber="6775"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06776" /><CodeLine lineNumber="6776"></CodeLine>
<Link id="l06777" /><CodeLine lineNumber="6777"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a> OpenMPIRBuilder::createDispatchNextFunction(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IVSize,</span></CodeLine>
<Link id="l06778" /><CodeLine lineNumber="6778"><span class="doxyHighlight">                                                           </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IVSigned) &#123;</span></CodeLine>
<Link id="l06779" /><CodeLine lineNumber="6779"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((IVSize == 32 || IVSize == 64) &amp;&amp;</span></CodeLine>
<Link id="l06780" /><CodeLine lineNumber="6780"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;IV size is not compatible with the omp runtime&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06781" /><CodeLine lineNumber="6781"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a4c503140c7f851151906d85b515330e9">RuntimeFunction</a> <a href="/docs/api/namespaces/llvm/graphprogram/#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a> = IVSize == 32</span></CodeLine>
<Link id="l06782" /><CodeLine lineNumber="6782"><span class="doxyHighlight">                             ? (IVSigned ? omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;next&#95;4</span></CodeLine>
<Link id="l06783" /><CodeLine lineNumber="6783"><span class="doxyHighlight">                                         : omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;next&#95;4u)</span></CodeLine>
<Link id="l06784" /><CodeLine lineNumber="6784"><span class="doxyHighlight">                             : (IVSigned ? omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;next&#95;8</span></CodeLine>
<Link id="l06785" /><CodeLine lineNumber="6785"><span class="doxyHighlight">                                         : omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;next&#95;8u);</span></CodeLine>
<Link id="l06786" /><CodeLine lineNumber="6786"></CodeLine>
<Link id="l06787" /><CodeLine lineNumber="6787"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> getOrCreateRuntimeFunction(M, Name);</span></CodeLine>
<Link id="l06788" /><CodeLine lineNumber="6788"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06789" /><CodeLine lineNumber="6789"></CodeLine>
<Link id="l06790" /><CodeLine lineNumber="6790"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a> OpenMPIRBuilder::createDispatchFiniFunction(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IVSize,</span></CodeLine>
<Link id="l06791" /><CodeLine lineNumber="6791"><span class="doxyHighlight">                                                           </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IVSigned) &#123;</span></CodeLine>
<Link id="l06792" /><CodeLine lineNumber="6792"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((IVSize == 32 || IVSize == 64) &amp;&amp;</span></CodeLine>
<Link id="l06793" /><CodeLine lineNumber="6793"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;IV size is not compatible with the omp runtime&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06794" /><CodeLine lineNumber="6794"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a4c503140c7f851151906d85b515330e9">RuntimeFunction</a> <a href="/docs/api/namespaces/llvm/graphprogram/#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a> = IVSize == 32</span></CodeLine>
<Link id="l06795" /><CodeLine lineNumber="6795"><span class="doxyHighlight">                             ? (IVSigned ? omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;fini&#95;4</span></CodeLine>
<Link id="l06796" /><CodeLine lineNumber="6796"><span class="doxyHighlight">                                         : omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;fini&#95;4u)</span></CodeLine>
<Link id="l06797" /><CodeLine lineNumber="6797"><span class="doxyHighlight">                             : (IVSigned ? omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;fini&#95;8</span></CodeLine>
<Link id="l06798" /><CodeLine lineNumber="6798"><span class="doxyHighlight">                                         : omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;fini&#95;8u);</span></CodeLine>
<Link id="l06799" /><CodeLine lineNumber="6799"></CodeLine>
<Link id="l06800" /><CodeLine lineNumber="6800"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> getOrCreateRuntimeFunction(M, Name);</span></CodeLine>
<Link id="l06801" /><CodeLine lineNumber="6801"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06802" /><CodeLine lineNumber="6802"></CodeLine>
<Link id="l06803" /><CodeLine lineNumber="6803"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a> OpenMPIRBuilder::createDispatchDeinitFunction() &#123;</span></CodeLine>
<Link id="l06804" /><CodeLine lineNumber="6804"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> getOrCreateRuntimeFunction(M, omp::OMPRTL&#95;&#95;&#95;kmpc&#95;dispatch&#95;deinit);</span></CodeLine>
<Link id="l06805" /><CodeLine lineNumber="6805"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06806" /><CodeLine lineNumber="6806"></CodeLine>
<Link id="l06807" /><CodeLine lineNumber="6807" lineLink="#a3ea33750ee7de55492a5083c347e2ddb"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/expected">Expected&lt;Function &#42;&gt;</a> <a href="#a3ea33750ee7de55492a5083c347e2ddb">createOutlinedFunction</a>(</span></CodeLine>
<Link id="l06808" /><CodeLine lineNumber="6808"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp;OMPBuilder, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder,</span></CodeLine>
<Link id="l06809" /><CodeLine lineNumber="6809"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> OpenMPIRBuilder::TargetKernelDefaultAttrs &amp;DefaultAttrs,</span></CodeLine>
<Link id="l06810" /><CodeLine lineNumber="6810"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/stringref">StringRef</a> FuncName, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Value &#42;&gt;</a> &amp;Inputs,</span></CodeLine>
<Link id="l06811" /><CodeLine lineNumber="6811"><span class="doxyHighlight">    OpenMPIRBuilder::TargetBodyGenCallbackTy &amp;CBFunc,</span></CodeLine>
<Link id="l06812" /><CodeLine lineNumber="6812"><span class="doxyHighlight">    OpenMPIRBuilder::TargetGenArgAccessorsCallbackTy &amp;ArgAccessorFuncCB) &#123;</span></CodeLine>
<Link id="l06813" /><CodeLine lineNumber="6813"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Type &#42;&gt;</a> ParameterTypes;</span></CodeLine>
<Link id="l06814" /><CodeLine lineNumber="6814"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OMPBuilder.Config.isTargetDevice()) &#123;</span></CodeLine>
<Link id="l06815" /><CodeLine lineNumber="6815"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add the &quot;implicit&quot; runtime argument we use to provide launch specific</span></CodeLine>
<Link id="l06816" /><CodeLine lineNumber="6816"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// information for target devices.</span></CodeLine>
<Link id="l06817" /><CodeLine lineNumber="6817"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Int8PtrTy = <a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>());</span></CodeLine>
<Link id="l06818" /><CodeLine lineNumber="6818"><span class="doxyHighlight">    ParameterTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Int8PtrTy);</span></CodeLine>
<Link id="l06819" /><CodeLine lineNumber="6819"></CodeLine>
<Link id="l06820" /><CodeLine lineNumber="6820"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// All parameters to target devices are passed as pointers</span></CodeLine>
<Link id="l06821" /><CodeLine lineNumber="6821"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// or i64. This assumes 64-bit address spaces/pointers.</span></CodeLine>
<Link id="l06822" /><CodeLine lineNumber="6822"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Arg : Inputs)</span></CodeLine>
<Link id="l06823" /><CodeLine lineNumber="6823"><span class="doxyHighlight">      ParameterTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Arg-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()</span></CodeLine>
<Link id="l06824" /><CodeLine lineNumber="6824"><span class="doxyHighlight">                                   ? Arg-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()</span></CodeLine>
<Link id="l06825" /><CodeLine lineNumber="6825"><span class="doxyHighlight">                                   : <a href="/docs/api/classes/llvm/type/#a05186fa23e4d11b9855a9599ba87a4b7">Type::getInt64Ty</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>()));</span></CodeLine>
<Link id="l06826" /><CodeLine lineNumber="6826"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06827" /><CodeLine lineNumber="6827"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Arg : Inputs)</span></CodeLine>
<Link id="l06828" /><CodeLine lineNumber="6828"><span class="doxyHighlight">      ParameterTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Arg-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l06829" /><CodeLine lineNumber="6829"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06830" /><CodeLine lineNumber="6830"></CodeLine>
<Link id="l06831" /><CodeLine lineNumber="6831"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l06832" /><CodeLine lineNumber="6832"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> M = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#afc70e919c88c86159cc94cea29b6c210">getModule</a>();</span></CodeLine>
<Link id="l06833" /><CodeLine lineNumber="6833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FuncType = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad0243f1634f75e231041023ffaa8501a">getVoidTy</a>(), ParameterTypes,</span></CodeLine>
<Link id="l06834" /><CodeLine lineNumber="6834"><span class="doxyHighlight">                                    </span><span class="doxyHighlightComment">/&#42;isVarArg&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06835" /><CodeLine lineNumber="6835"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Func =</span></CodeLine>
<Link id="l06836" /><CodeLine lineNumber="6836"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(FuncType, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>, FuncName, M);</span></CodeLine>
<Link id="l06837" /><CodeLine lineNumber="6837"></CodeLine>
<Link id="l06838" /><CodeLine lineNumber="6838"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Forward target-cpu and target-features function attributes from the</span></CodeLine>
<Link id="l06839" /><CodeLine lineNumber="6839"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// original function to the new outlined function.</span></CodeLine>
<Link id="l06840" /><CodeLine lineNumber="6840"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;ParentFn = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l06841" /><CodeLine lineNumber="6841"></CodeLine>
<Link id="l06842" /><CodeLine lineNumber="6842"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TargetCpuAttr = ParentFn-&gt;<a href="/docs/api/classes/llvm/function/#a4c319db4fe05c27cfe55bd133a87414d">getFnAttribute</a>(</span><span class="doxyHighlightStringLiteral">&quot;target-cpu&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06843" /><CodeLine lineNumber="6843"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TargetCpuAttr.isStringAttribute())</span></CodeLine>
<Link id="l06844" /><CodeLine lineNumber="6844"><span class="doxyHighlight">    Func-&gt;addFnAttr(TargetCpuAttr);</span></CodeLine>
<Link id="l06845" /><CodeLine lineNumber="6845"></CodeLine>
<Link id="l06846" /><CodeLine lineNumber="6846"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TargetFeaturesAttr = ParentFn-&gt;<a href="/docs/api/classes/llvm/function/#a4c319db4fe05c27cfe55bd133a87414d">getFnAttribute</a>(</span><span class="doxyHighlightStringLiteral">&quot;target-features&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06847" /><CodeLine lineNumber="6847"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TargetFeaturesAttr.isStringAttribute())</span></CodeLine>
<Link id="l06848" /><CodeLine lineNumber="6848"><span class="doxyHighlight">    Func-&gt;addFnAttr(TargetFeaturesAttr);</span></CodeLine>
<Link id="l06849" /><CodeLine lineNumber="6849"></CodeLine>
<Link id="l06850" /><CodeLine lineNumber="6850"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OMPBuilder.Config.isTargetDevice()) &#123;</span></CodeLine>
<Link id="l06851" /><CodeLine lineNumber="6851"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExecMode =</span></CodeLine>
<Link id="l06852" /><CodeLine lineNumber="6852"><span class="doxyHighlight">        OMPBuilder.emitKernelExecutionMode(FuncName, DefaultAttrs.ExecFlags);</span></CodeLine>
<Link id="l06853" /><CodeLine lineNumber="6853"><span class="doxyHighlight">    OMPBuilder.emitUsed(</span><span class="doxyHighlightStringLiteral">&quot;llvm.compiler.used&quot;</span><span class="doxyHighlight">, &#123;ExecMode&#125;);</span></CodeLine>
<Link id="l06854" /><CodeLine lineNumber="6854"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06855" /><CodeLine lineNumber="6855"></CodeLine>
<Link id="l06856" /><CodeLine lineNumber="6856"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Save insert point.</span></CodeLine>
<Link id="l06857" /><CodeLine lineNumber="6857"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;::InsertPointGuard</a> IPG(Builder);</span></CodeLine>
<Link id="l06858" /><CodeLine lineNumber="6858"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there&#39;s a DISubprogram associated with current function, then</span></CodeLine>
<Link id="l06859" /><CodeLine lineNumber="6859"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// generate one for the outlined function.</span></CodeLine>
<Link id="l06860" /><CodeLine lineNumber="6860"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;ParentFunc = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()) &#123;</span></CodeLine>
<Link id="l06861" /><CodeLine lineNumber="6861"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;SP = ParentFunc-&gt;<a href="/docs/api/classes/llvm/dilocalscope/#a0e0b4a5906e0bc2a7fa033548c59a220">getSubprogram</a>()) &#123;</span></CodeLine>
<Link id="l06862" /><CodeLine lineNumber="6862"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/dicompileunit">DICompileUnit</a> &#42;<a href="/docs/api/namespaces/cu">CU</a> = SP-&gt;getUnit();</span></CodeLine>
<Link id="l06863" /><CodeLine lineNumber="6863"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> DB(&#42;M, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/cu">CU</a>);</span></CodeLine>
<Link id="l06864" /><CodeLine lineNumber="6864"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a90a3242eeb2a7d1afbb5ab5bc5bfb20d">getCurrentDebugLocation</a>();</span></CodeLine>
<Link id="l06865" /><CodeLine lineNumber="6865"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l06866" /><CodeLine lineNumber="6866"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// TODO: We are using nullopt for arguments at the moment. This will</span></CodeLine>
<Link id="l06867" /><CodeLine lineNumber="6867"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// need to be updated when debug data is being generated for variables.</span></CodeLine>
<Link id="l06868" /><CodeLine lineNumber="6868"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/disubroutinetype">DISubroutineType</a> &#42;Ty =</span></CodeLine>
<Link id="l06869" /><CodeLine lineNumber="6869"><span class="doxyHighlight">            DB.createSubroutineType(DB.getOrCreateTypeArray(&#123;&#125;));</span></CodeLine>
<Link id="l06870" /><CodeLine lineNumber="6870"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/disubprogram/#aee46b4d49ad15932fe2706f1d308d4e9">DISubprogram::DISPFlags</a> SPFlags = DISubprogram::SPFlagDefinition |</span></CodeLine>
<Link id="l06871" /><CodeLine lineNumber="6871"><span class="doxyHighlight">                                          DISubprogram::SPFlagOptimized |</span></CodeLine>
<Link id="l06872" /><CodeLine lineNumber="6872"><span class="doxyHighlight">                                          DISubprogram::SPFlagLocalToUnit;</span></CodeLine>
<Link id="l06873" /><CodeLine lineNumber="6873"></CodeLine>
<Link id="l06874" /><CodeLine lineNumber="6874"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;OutlinedSP = DB.createFunction(</span></CodeLine>
<Link id="l06875" /><CodeLine lineNumber="6875"><span class="doxyHighlight">            <a href="/docs/api/namespaces/cu">CU</a>, FuncName, FuncName, SP-&gt;getFile(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getLine(), Ty,</span></CodeLine>
<Link id="l06876" /><CodeLine lineNumber="6876"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getLine(), DINode::DIFlags::FlagArtificial, SPFlags);</span></CodeLine>
<Link id="l06877" /><CodeLine lineNumber="6877"></CodeLine>
<Link id="l06878" /><CodeLine lineNumber="6878"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Attach subprogram to the function.</span></CodeLine>
<Link id="l06879" /><CodeLine lineNumber="6879"><span class="doxyHighlight">        Func-&gt;setSubprogram(OutlinedSP);</span></CodeLine>
<Link id="l06880" /><CodeLine lineNumber="6880"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Update the CurrentDebugLocation in the builder so that right scope</span></CodeLine>
<Link id="l06881" /><CodeLine lineNumber="6881"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// is used for things inside outlined function.</span></CodeLine>
<Link id="l06882" /><CodeLine lineNumber="6882"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(</span></CodeLine>
<Link id="l06883" /><CodeLine lineNumber="6883"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DILocation::get</a>(Func-&gt;getContext(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getLine(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getCol(),</span></CodeLine>
<Link id="l06884" /><CodeLine lineNumber="6884"><span class="doxyHighlight">                            OutlinedSP, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getInlinedAt()));</span></CodeLine>
<Link id="l06885" /><CodeLine lineNumber="6885"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06886" /><CodeLine lineNumber="6886"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06887" /><CodeLine lineNumber="6887"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06888" /><CodeLine lineNumber="6888"></CodeLine>
<Link id="l06889" /><CodeLine lineNumber="6889"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate the region into the function.</span></CodeLine>
<Link id="l06890" /><CodeLine lineNumber="6890"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EntryBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;entry&quot;</span><span class="doxyHighlight">, Func);</span></CodeLine>
<Link id="l06891" /><CodeLine lineNumber="6891"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EntryBB);</span></CodeLine>
<Link id="l06892" /><CodeLine lineNumber="6892"></CodeLine>
<Link id="l06893" /><CodeLine lineNumber="6893"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert target init call in the device compilation pass.</span></CodeLine>
<Link id="l06894" /><CodeLine lineNumber="6894"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OMPBuilder.Config.isTargetDevice())</span></CodeLine>
<Link id="l06895" /><CodeLine lineNumber="6895"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(OMPBuilder.createTargetInit(Builder, DefaultAttrs));</span></CodeLine>
<Link id="l06896" /><CodeLine lineNumber="6896"></CodeLine>
<Link id="l06897" /><CodeLine lineNumber="6897"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UserCodeEntryBB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l06898" /><CodeLine lineNumber="6898"></CodeLine>
<Link id="l06899" /><CodeLine lineNumber="6899"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// As we embed the user code in the middle of our target region after we</span></CodeLine>
<Link id="l06900" /><CodeLine lineNumber="6900"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// generate entry code, we must move what allocas we can into the entry</span></CodeLine>
<Link id="l06901" /><CodeLine lineNumber="6901"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block to avoid possible breaking optimisations for device</span></CodeLine>
<Link id="l06902" /><CodeLine lineNumber="6902"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OMPBuilder.Config.isTargetDevice())</span></CodeLine>
<Link id="l06903" /><CodeLine lineNumber="6903"><span class="doxyHighlight">    OMPBuilder.ConstantAllocaRaiseCandidates.emplace&#95;back(Func);</span></CodeLine>
<Link id="l06904" /><CodeLine lineNumber="6904"></CodeLine>
<Link id="l06905" /><CodeLine lineNumber="6905"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert target deinit call in the device compilation pass.</span></CodeLine>
<Link id="l06906" /><CodeLine lineNumber="6906"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OutlinedBodyBB =</span></CodeLine>
<Link id="l06907" /><CodeLine lineNumber="6907"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;outlined.body&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06908" /><CodeLine lineNumber="6908"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">llvm::OpenMPIRBuilder::InsertPointOrErrorTy</a> AfterIP = CBFunc(</span></CodeLine>
<Link id="l06909" /><CodeLine lineNumber="6909"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(),</span></CodeLine>
<Link id="l06910" /><CodeLine lineNumber="6910"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a>(OutlinedBodyBB, OutlinedBodyBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>()));</span></CodeLine>
<Link id="l06911" /><CodeLine lineNumber="6911"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l06912" /><CodeLine lineNumber="6912"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.<a href="/docs/api/classes/llvm/expected/#a94789df4ebd03dc008e8adebaa66ac1f">takeError</a>();</span></CodeLine>
<Link id="l06913" /><CodeLine lineNumber="6913"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#42;AfterIP);</span></CodeLine>
<Link id="l06914" /><CodeLine lineNumber="6914"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OMPBuilder.Config.isTargetDevice())</span></CodeLine>
<Link id="l06915" /><CodeLine lineNumber="6915"><span class="doxyHighlight">    OMPBuilder.createTargetDeinit(Builder);</span></CodeLine>
<Link id="l06916" /><CodeLine lineNumber="6916"></CodeLine>
<Link id="l06917" /><CodeLine lineNumber="6917"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert return instruction.</span></CodeLine>
<Link id="l06918" /><CodeLine lineNumber="6918"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l06919" /><CodeLine lineNumber="6919"></CodeLine>
<Link id="l06920" /><CodeLine lineNumber="6920"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// New Alloca IP at entry point of created device function.</span></CodeLine>
<Link id="l06921" /><CodeLine lineNumber="6921"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>());</span></CodeLine>
<Link id="l06922" /><CodeLine lineNumber="6922"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AllocaIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l06923" /><CodeLine lineNumber="6923"></CodeLine>
<Link id="l06924" /><CodeLine lineNumber="6924"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(UserCodeEntryBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a50909227135ef69932bff39b8ea3f572">getFirstNonPHIOrDbg</a>());</span></CodeLine>
<Link id="l06925" /><CodeLine lineNumber="6925"></CodeLine>
<Link id="l06926" /><CodeLine lineNumber="6926"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Skip the artificial dyn&#95;ptr on the device.</span></CodeLine>
<Link id="l06927" /><CodeLine lineNumber="6927"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;ArgRange =</span></CodeLine>
<Link id="l06928" /><CodeLine lineNumber="6928"><span class="doxyHighlight">      OMPBuilder.Config.isTargetDevice()</span></CodeLine>
<Link id="l06929" /><CodeLine lineNumber="6929"><span class="doxyHighlight">          ? <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(Func-&gt;arg&#95;begin() + 1, Func-&gt;arg&#95;end())</span></CodeLine>
<Link id="l06930" /><CodeLine lineNumber="6930"><span class="doxyHighlight">          : Func-&gt;args();</span></CodeLine>
<Link id="l06931" /><CodeLine lineNumber="6931"></CodeLine>
<Link id="l06932" /><CodeLine lineNumber="6932"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ReplaceValue = &#91;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/input">Input</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;InputCopy, <a href="/docs/api/classes/llvm/function">Function</a> &#42;Func) &#123;</span></CodeLine>
<Link id="l06933" /><CodeLine lineNumber="6933"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Things like GEP&#39;s can come in the form of Constants. Constants and</span></CodeLine>
<Link id="l06934" /><CodeLine lineNumber="6934"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ConstantExpr&#39;s do not have access to the knowledge of what they&#39;re</span></CodeLine>
<Link id="l06935" /><CodeLine lineNumber="6935"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// contained in, so we must dig a little to find an instruction so we</span></CodeLine>
<Link id="l06936" /><CodeLine lineNumber="6936"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// can tell if they&#39;re used inside of the function we&#39;re outlining. We</span></CodeLine>
<Link id="l06937" /><CodeLine lineNumber="6937"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// also replace the original constant expression with a new instruction</span></CodeLine>
<Link id="l06938" /><CodeLine lineNumber="6938"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// equivalent; an instruction as it allows easy modification in the</span></CodeLine>
<Link id="l06939" /><CodeLine lineNumber="6939"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// following loop, as we can now know the constant (instruction) is</span></CodeLine>
<Link id="l06940" /><CodeLine lineNumber="6940"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// owned by our target function and replaceUsesOfWith can now be invoked</span></CodeLine>
<Link id="l06941" /><CodeLine lineNumber="6941"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// on it (cannot do this with constants it seems). A brand new one also</span></CodeLine>
<Link id="l06942" /><CodeLine lineNumber="6942"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// allows us to be cautious as it is perhaps possible the old expression</span></CodeLine>
<Link id="l06943" /><CodeLine lineNumber="6943"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// was used inside of the function but exists and is used externally</span></CodeLine>
<Link id="l06944" /><CodeLine lineNumber="6944"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (unlikely by the nature of a Constant, but still).</span></CodeLine>
<Link id="l06945" /><CodeLine lineNumber="6945"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// NOTE: We cannot remove dead constants that have been rewritten to</span></CodeLine>
<Link id="l06946" /><CodeLine lineNumber="6946"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions at this stage, we run the risk of breaking later lowering</span></CodeLine>
<Link id="l06947" /><CodeLine lineNumber="6947"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// by doing so as we could still be in the process of lowering the module</span></CodeLine>
<Link id="l06948" /><CodeLine lineNumber="6948"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// from MLIR to LLVM-IR and the MLIR lowering may still require the original</span></CodeLine>
<Link id="l06949" /><CodeLine lineNumber="6949"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// constants we have created rewritten versions of.</span></CodeLine>
<Link id="l06950" /><CodeLine lineNumber="6950"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Const = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(<a href="/docs/api/classes/input">Input</a>))</span></CodeLine>
<Link id="l06951" /><CodeLine lineNumber="6951"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a60cf4cd57355563164d053dd470ac00f">convertUsersOfConstantsToInstructions</a>(Const, Func, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06952" /><CodeLine lineNumber="6952"></CodeLine>
<Link id="l06953" /><CodeLine lineNumber="6953"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Collect all the instructions</span></CodeLine>
<Link id="l06954" /><CodeLine lineNumber="6954"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/classes/input">Input</a>-&gt;users()))</span></CodeLine>
<Link id="l06955" /><CodeLine lineNumber="6955"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Instr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>))</span></CodeLine>
<Link id="l06956" /><CodeLine lineNumber="6956"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Instr-&gt;getFunction() == Func)</span></CodeLine>
<Link id="l06957" /><CodeLine lineNumber="6957"><span class="doxyHighlight">          Instr-&gt;replaceUsesOfWith(<a href="/docs/api/classes/input">Input</a>, InputCopy);</span></CodeLine>
<Link id="l06958" /><CodeLine lineNumber="6958"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l06959" /><CodeLine lineNumber="6959"></CodeLine>
<Link id="l06960" /><CodeLine lineNumber="6960"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;Value &#42;, Value &#42;&gt;</a>&gt; DeferredReplacement;</span></CodeLine>
<Link id="l06961" /><CodeLine lineNumber="6961"></CodeLine>
<Link id="l06962" /><CodeLine lineNumber="6962"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Rewrite uses of input valus to parameters.</span></CodeLine>
<Link id="l06963" /><CodeLine lineNumber="6963"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InArg : <a href="/docs/api/namespaces/llvm/#a06041e3bf4b0a9e8984809413ddd9506">zip</a>(Inputs, ArgRange)) &#123;</span></CodeLine>
<Link id="l06964" /><CodeLine lineNumber="6964"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/input">Input</a> = std::get&lt;0&gt;(InArg);</span></CodeLine>
<Link id="l06965" /><CodeLine lineNumber="6965"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/argument">Argument</a> &amp;Arg = std::get&lt;1&gt;(InArg);</span></CodeLine>
<Link id="l06966" /><CodeLine lineNumber="6966"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;InputCopy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06967" /><CodeLine lineNumber="6967"></CodeLine>
<Link id="l06968" /><CodeLine lineNumber="6968"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">llvm::OpenMPIRBuilder::InsertPointOrErrorTy</a> AfterIP =</span></CodeLine>
<Link id="l06969" /><CodeLine lineNumber="6969"><span class="doxyHighlight">        ArgAccessorFuncCB(Arg, <a href="/docs/api/classes/input">Input</a>, InputCopy, AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>());</span></CodeLine>
<Link id="l06970" /><CodeLine lineNumber="6970"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterIP)</span></CodeLine>
<Link id="l06971" /><CodeLine lineNumber="6971"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AfterIP.<a href="/docs/api/classes/llvm/expected/#a94789df4ebd03dc008e8adebaa66ac1f">takeError</a>();</span></CodeLine>
<Link id="l06972" /><CodeLine lineNumber="6972"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(&#42;AfterIP);</span></CodeLine>
<Link id="l06973" /><CodeLine lineNumber="6973"></CodeLine>
<Link id="l06974" /><CodeLine lineNumber="6974"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In certain cases a Global may be set up for replacement, however, this</span></CodeLine>
<Link id="l06975" /><CodeLine lineNumber="6975"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Global may be used in multiple arguments to the kernel, just segmented</span></CodeLine>
<Link id="l06976" /><CodeLine lineNumber="6976"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// apart, for example, if we have a global array, that is sectioned into</span></CodeLine>
<Link id="l06977" /><CodeLine lineNumber="6977"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// multiple mappings (technically not legal in OpenMP, but there is a case</span></CodeLine>
<Link id="l06978" /><CodeLine lineNumber="6978"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in Fortran for Common Blocks where this is neccesary), we will end up</span></CodeLine>
<Link id="l06979" /><CodeLine lineNumber="6979"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// with GEP&#39;s into this array inside the kernel, that refer to the Global</span></CodeLine>
<Link id="l06980" /><CodeLine lineNumber="6980"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// but are technically seperate arguments to the kernel for all intents and</span></CodeLine>
<Link id="l06981" /><CodeLine lineNumber="6981"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// purposes. If we have mapped a segment that requires a GEP into the 0-th</span></CodeLine>
<Link id="l06982" /><CodeLine lineNumber="6982"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// index, it will fold into an referal to the Global, if we then encounter</span></CodeLine>
<Link id="l06983" /><CodeLine lineNumber="6983"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this folded GEP during replacement all of the references to the</span></CodeLine>
<Link id="l06984" /><CodeLine lineNumber="6984"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Global in the kernel will be replaced with the argument we have generated</span></CodeLine>
<Link id="l06985" /><CodeLine lineNumber="6985"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that corresponds to it, including any other GEP&#39;s that refer to the</span></CodeLine>
<Link id="l06986" /><CodeLine lineNumber="6986"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Global that may be other arguments. This will invalidate all of the other</span></CodeLine>
<Link id="l06987" /><CodeLine lineNumber="6987"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// preceding mapped arguments that refer to the same global that may be</span></CodeLine>
<Link id="l06988" /><CodeLine lineNumber="6988"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// seperate segments. To prevent this, we defer global processing until all</span></CodeLine>
<Link id="l06989" /><CodeLine lineNumber="6989"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// other processing has been performed.</span></CodeLine>
<Link id="l06990" /><CodeLine lineNumber="6990"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">llvm::isa&lt;llvm::GlobalValue&gt;</a>(std::get&lt;0&gt;(InArg)) ||</span></CodeLine>
<Link id="l06991" /><CodeLine lineNumber="6991"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">llvm::isa&lt;llvm::GlobalObject&gt;</a>(std::get&lt;0&gt;(InArg)) ||</span></CodeLine>
<Link id="l06992" /><CodeLine lineNumber="6992"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">llvm::isa&lt;llvm::GlobalVariable&gt;</a>(std::get&lt;0&gt;(InArg))) &#123;</span></CodeLine>
<Link id="l06993" /><CodeLine lineNumber="6993"><span class="doxyHighlight">      DeferredReplacement.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(std::make&#95;pair(<a href="/docs/api/classes/input">Input</a>, InputCopy));</span></CodeLine>
<Link id="l06994" /><CodeLine lineNumber="6994"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06995" /><CodeLine lineNumber="6995"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06996" /><CodeLine lineNumber="6996"></CodeLine>
<Link id="l06997" /><CodeLine lineNumber="6997"><span class="doxyHighlight">    ReplaceValue(<a href="/docs/api/classes/input">Input</a>, InputCopy, Func);</span></CodeLine>
<Link id="l06998" /><CodeLine lineNumber="6998"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06999" /><CodeLine lineNumber="6999"></CodeLine>
<Link id="l07000" /><CodeLine lineNumber="7000"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace all of our deferred Input values, currently just Globals.</span></CodeLine>
<Link id="l07001" /><CodeLine lineNumber="7001"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Deferred : DeferredReplacement)</span></CodeLine>
<Link id="l07002" /><CodeLine lineNumber="7002"><span class="doxyHighlight">    ReplaceValue(std::get&lt;0&gt;(Deferred), std::get&lt;1&gt;(Deferred), Func);</span></CodeLine>
<Link id="l07003" /><CodeLine lineNumber="7003"></CodeLine>
<Link id="l07004" /><CodeLine lineNumber="7004"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Func;</span></CodeLine>
<Link id="l07005" /><CodeLine lineNumber="7005"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07006" /><CodeLine lineNumber="7006"></CodeLine>
<Link id="l07007" /><CodeLine lineNumber="7007"><span class="doxyHighlightComment">/// Create an entry point for a target task with the following.</span></CodeLine>
<Link id="l07008" /><CodeLine lineNumber="7008"><span class="doxyHighlightComment">/// It&#39;ll have the following signature</span></CodeLine>
<Link id="l07009" /><CodeLine lineNumber="7009"><span class="doxyHighlightComment">/// void @.omp&#95;target&#95;task&#95;proxy&#95;func(i32 %thread.id, ptr %task)</span></CodeLine>
<Link id="l07010" /><CodeLine lineNumber="7010"><span class="doxyHighlightComment">/// This function is called from emitTargetTask once the</span></CodeLine>
<Link id="l07011" /><CodeLine lineNumber="7011"><span class="doxyHighlightComment">/// code to launch the target kernel has been outlined already.</span></CodeLine>
<Link id="l07012" /><CodeLine lineNumber="7012" lineLink="#a3fb4884285f5bcb9a37d9378d1e33cd5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="#a3fb4884285f5bcb9a37d9378d1e33cd5">emitTargetTaskProxyFunction</a>(<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp;OMPBuilder,</span></CodeLine>
<Link id="l07013" /><CodeLine lineNumber="7013"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder,</span></CodeLine>
<Link id="l07014" /><CodeLine lineNumber="7014"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;StaleCI) &#123;</span></CodeLine>
<Link id="l07015" /><CodeLine lineNumber="7015"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/module">Module</a> &amp;M = OMPBuilder.M;</span></CodeLine>
<Link id="l07016" /><CodeLine lineNumber="7016"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// KernelLaunchFunction is the target launch function, i.e.</span></CodeLine>
<Link id="l07017" /><CodeLine lineNumber="7017"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the function that sets up kernel arguments and calls</span></CodeLine>
<Link id="l07018" /><CodeLine lineNumber="7018"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#95;&#95;tgt&#95;target&#95;kernel to launch the kernel on the device.</span></CodeLine>
<Link id="l07019" /><CodeLine lineNumber="7019"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07020" /><CodeLine lineNumber="7020"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;KernelLaunchFunction = StaleCI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</span></CodeLine>
<Link id="l07021" /><CodeLine lineNumber="7021"></CodeLine>
<Link id="l07022" /><CodeLine lineNumber="7022"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// StaleCI is the CallInst which is the call to the outlined</span></CodeLine>
<Link id="l07023" /><CodeLine lineNumber="7023"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// target kernel launch function. If there are values that the</span></CodeLine>
<Link id="l07024" /><CodeLine lineNumber="7024"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// outlined function uses then these are aggregated into a structure</span></CodeLine>
<Link id="l07025" /><CodeLine lineNumber="7025"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which is passed as the second argument. If not, then there&#39;s</span></CodeLine>
<Link id="l07026" /><CodeLine lineNumber="7026"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// only one argument, the threadID. So, StaleCI can be</span></CodeLine>
<Link id="l07027" /><CodeLine lineNumber="7027"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07028" /><CodeLine lineNumber="7028"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %structArg = alloca &#123; ptr, ptr &#125;, align 8</span></CodeLine>
<Link id="l07029" /><CodeLine lineNumber="7029"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %gep&#95; = getelementptr &#123; ptr, ptr &#125;, ptr %structArg, i32 0, i32 0</span></CodeLine>
<Link id="l07030" /><CodeLine lineNumber="7030"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// store ptr %20, ptr %gep&#95;, align 8</span></CodeLine>
<Link id="l07031" /><CodeLine lineNumber="7031"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %gep&#95;8 = getelementptr &#123; ptr, ptr &#125;, ptr %structArg, i32 0, i32 1</span></CodeLine>
<Link id="l07032" /><CodeLine lineNumber="7032"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// store ptr %21, ptr %gep&#95;8, align 8</span></CodeLine>
<Link id="l07033" /><CodeLine lineNumber="7033"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call void @&#95;QQmain..omp&#95;par.1(i32 %global.tid.val6, ptr %structArg)</span></CodeLine>
<Link id="l07034" /><CodeLine lineNumber="7034"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07035" /><CodeLine lineNumber="7035"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OR</span></CodeLine>
<Link id="l07036" /><CodeLine lineNumber="7036"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07037" /><CodeLine lineNumber="7037"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call void @&#95;QQmain..omp&#95;par.1(i32 %global.tid.val6)</span></CodeLine>
<Link id="l07038" /><CodeLine lineNumber="7038"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> IP(StaleCI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(),</span></CodeLine>
<Link id="l07039" /><CodeLine lineNumber="7039"><span class="doxyHighlight">                                    StaleCI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l07040" /><CodeLine lineNumber="7040"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = StaleCI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getContext();</span></CodeLine>
<Link id="l07041" /><CodeLine lineNumber="7041"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ThreadIDTy = <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Ctx);</span></CodeLine>
<Link id="l07042" /><CodeLine lineNumber="7042"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;TaskPtrTy = OMPBuilder.TaskPtr;</span></CodeLine>
<Link id="l07043" /><CodeLine lineNumber="7043"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;TaskTy = OMPBuilder.Task;</span></CodeLine>
<Link id="l07044" /><CodeLine lineNumber="7044"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ProxyFnTy =</span></CodeLine>
<Link id="l07045" /><CodeLine lineNumber="7045"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad0243f1634f75e231041023ffaa8501a">getVoidTy</a>(), &#123;ThreadIDTy, TaskPtrTy&#125;,</span></CodeLine>
<Link id="l07046" /><CodeLine lineNumber="7046"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42; isVarArg &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07047" /><CodeLine lineNumber="7047"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ProxyFn = <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(ProxyFnTy, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>,</span></CodeLine>
<Link id="l07048" /><CodeLine lineNumber="7048"><span class="doxyHighlight">                                  </span><span class="doxyHighlightStringLiteral">&quot;.omp&#95;target&#95;task&#95;proxy&#95;func&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07049" /><CodeLine lineNumber="7049"><span class="doxyHighlight">                                  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#afc70e919c88c86159cc94cea29b6c210">getModule</a>());</span></CodeLine>
<Link id="l07050" /><CodeLine lineNumber="7050"><span class="doxyHighlight">  ProxyFn-&gt;getArg(0)-&gt;setName(</span><span class="doxyHighlightStringLiteral">&quot;thread.id&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07051" /><CodeLine lineNumber="7051"><span class="doxyHighlight">  ProxyFn-&gt;getArg(1)-&gt;setName(</span><span class="doxyHighlightStringLiteral">&quot;task&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07052" /><CodeLine lineNumber="7052"></CodeLine>
<Link id="l07053" /><CodeLine lineNumber="7053"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EntryBB =</span></CodeLine>
<Link id="l07054" /><CodeLine lineNumber="7054"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;entry&quot;</span><span class="doxyHighlight">, ProxyFn);</span></CodeLine>
<Link id="l07055" /><CodeLine lineNumber="7055"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EntryBB);</span></CodeLine>
<Link id="l07056" /><CodeLine lineNumber="7056"></CodeLine>
<Link id="l07057" /><CodeLine lineNumber="7057"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasShareds = StaleCI-&gt;<a href="/docs/api/classes/llvm/callbase/#adde2ea00dd2613ee41bfe91908e4e68e">arg&#95;size</a>() &gt; 1;</span></CodeLine>
<Link id="l07058" /><CodeLine lineNumber="7058"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: This is a temporary assert to prove to ourselves that</span></CodeLine>
<Link id="l07059" /><CodeLine lineNumber="7059"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the outlined target launch function is always going to have</span></CodeLine>
<Link id="l07060" /><CodeLine lineNumber="7060"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// atmost two arguments if there is any data shared between</span></CodeLine>
<Link id="l07061" /><CodeLine lineNumber="7061"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// host and device.</span></CodeLine>
<Link id="l07062" /><CodeLine lineNumber="7062"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!HasShareds || (StaleCI-&gt;<a href="/docs/api/classes/llvm/callbase/#adde2ea00dd2613ee41bfe91908e4e68e">arg&#95;size</a>() == 2)) &amp;&amp;</span></CodeLine>
<Link id="l07063" /><CodeLine lineNumber="7063"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;StaleCI with shareds should have exactly two arguments.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07064" /><CodeLine lineNumber="7064"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasShareds) &#123;</span></CodeLine>
<Link id="l07065" /><CodeLine lineNumber="7065"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ArgStructAlloca = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(StaleCI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(1));</span></CodeLine>
<Link id="l07066" /><CodeLine lineNumber="7066"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ArgStructAlloca &amp;&amp;</span></CodeLine>
<Link id="l07067" /><CodeLine lineNumber="7067"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Unable to find the alloca instruction corresponding to arguments &quot;</span></CodeLine>
<Link id="l07068" /><CodeLine lineNumber="7068"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;for extracted function&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07069" /><CodeLine lineNumber="7069"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ArgStructType = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StructType&gt;</a>(ArgStructAlloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>());</span></CodeLine>
<Link id="l07070" /><CodeLine lineNumber="7070"></CodeLine>
<Link id="l07071" /><CodeLine lineNumber="7071"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;NewArgStructAlloca =</span></CodeLine>
<Link id="l07072" /><CodeLine lineNumber="7072"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(ArgStructType, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;structArg&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07073" /><CodeLine lineNumber="7073"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;TaskT = ProxyFn-&gt;getArg(1);</span></CodeLine>
<Link id="l07074" /><CodeLine lineNumber="7074"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ThreadId = ProxyFn-&gt;getArg(0);</span></CodeLine>
<Link id="l07075" /><CodeLine lineNumber="7075"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;SharedsSize =</span></CodeLine>
<Link id="l07076" /><CodeLine lineNumber="7076"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(M.getDataLayout().getTypeStoreSize(ArgStructType));</span></CodeLine>
<Link id="l07077" /><CodeLine lineNumber="7077"></CodeLine>
<Link id="l07078" /><CodeLine lineNumber="7078"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Shareds = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e95ff363c20e1f51b673230538e10fd">CreateStructGEP</a>(TaskTy, TaskT, 0);</span></CodeLine>
<Link id="l07079" /><CodeLine lineNumber="7079"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LoadShared =</span></CodeLine>
<Link id="l07080" /><CodeLine lineNumber="7080"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(Ctx), Shareds);</span></CodeLine>
<Link id="l07081" /><CodeLine lineNumber="7081"></CodeLine>
<Link id="l07082" /><CodeLine lineNumber="7082"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae9f2730f66215fdb82f4e41e45124811">CreateMemCpy</a>(</span></CodeLine>
<Link id="l07083" /><CodeLine lineNumber="7083"><span class="doxyHighlight">        NewArgStructAlloca, NewArgStructAlloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#a42438d0a43720a6571c9138224481754">getAlign</a>(), LoadShared,</span></CodeLine>
<Link id="l07084" /><CodeLine lineNumber="7084"><span class="doxyHighlight">        LoadShared-&gt;<a href="/docs/api/classes/llvm/value/#a47f5c74e1b14ba4a61db057400644acc">getPointerAlignment</a>(M.getDataLayout()), SharedsSize);</span></CodeLine>
<Link id="l07085" /><CodeLine lineNumber="7085"></CodeLine>
<Link id="l07086" /><CodeLine lineNumber="7086"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(KernelLaunchFunction, &#123;ThreadId, NewArgStructAlloca&#125;);</span></CodeLine>
<Link id="l07087" /><CodeLine lineNumber="7087"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07088" /><CodeLine lineNumber="7088"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l07089" /><CodeLine lineNumber="7089"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ProxyFn;</span></CodeLine>
<Link id="l07090" /><CodeLine lineNumber="7090"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07091" /><CodeLine lineNumber="7091"></CodeLine>
<Link id="l07092" /><CodeLine lineNumber="7092" lineLink="#aa33db5ef74d376fb331f9549fb3cd9b3"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error">Error</a> <a href="#aa33db5ef74d376fb331f9549fb3cd9b3">emitTargetOutlinedFunction</a>(</span></CodeLine>
<Link id="l07093" /><CodeLine lineNumber="7093"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp;OMPBuilder, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsOffloadEntry,</span></CodeLine>
<Link id="l07094" /><CodeLine lineNumber="7094"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> &amp;EntryInfo,</span></CodeLine>
<Link id="l07095" /><CodeLine lineNumber="7095"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> OpenMPIRBuilder::TargetKernelDefaultAttrs &amp;DefaultAttrs,</span></CodeLine>
<Link id="l07096" /><CodeLine lineNumber="7096"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;&amp;OutlinedFn, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;&amp;OutlinedFnID,</span></CodeLine>
<Link id="l07097" /><CodeLine lineNumber="7097"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Value &#42;&gt;</a> &amp;Inputs,</span></CodeLine>
<Link id="l07098" /><CodeLine lineNumber="7098"><span class="doxyHighlight">    OpenMPIRBuilder::TargetBodyGenCallbackTy &amp;CBFunc,</span></CodeLine>
<Link id="l07099" /><CodeLine lineNumber="7099"><span class="doxyHighlight">    OpenMPIRBuilder::TargetGenArgAccessorsCallbackTy &amp;ArgAccessorFuncCB) &#123;</span></CodeLine>
<Link id="l07100" /><CodeLine lineNumber="7100"></CodeLine>
<Link id="l07101" /><CodeLine lineNumber="7101"><span class="doxyHighlight">  OpenMPIRBuilder::FunctionGenCallback &amp;&amp;GenerateOutlinedFunction =</span></CodeLine>
<Link id="l07102" /><CodeLine lineNumber="7102"><span class="doxyHighlight">      &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/stringref">StringRef</a> EntryFnName) &#123;</span></CodeLine>
<Link id="l07103" /><CodeLine lineNumber="7103"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a3ea33750ee7de55492a5083c347e2ddb">createOutlinedFunction</a>(OMPBuilder, Builder, DefaultAttrs,</span></CodeLine>
<Link id="l07104" /><CodeLine lineNumber="7104"><span class="doxyHighlight">                                      EntryFnName, Inputs, CBFunc,</span></CodeLine>
<Link id="l07105" /><CodeLine lineNumber="7105"><span class="doxyHighlight">                                      ArgAccessorFuncCB);</span></CodeLine>
<Link id="l07106" /><CodeLine lineNumber="7106"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l07107" /><CodeLine lineNumber="7107"></CodeLine>
<Link id="l07108" /><CodeLine lineNumber="7108"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.emitTargetRegionFunction(</span></CodeLine>
<Link id="l07109" /><CodeLine lineNumber="7109"><span class="doxyHighlight">      EntryInfo, GenerateOutlinedFunction, IsOffloadEntry, OutlinedFn,</span></CodeLine>
<Link id="l07110" /><CodeLine lineNumber="7110"><span class="doxyHighlight">      OutlinedFnID);</span></CodeLine>
<Link id="l07111" /><CodeLine lineNumber="7111"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07112" /><CodeLine lineNumber="7112"></CodeLine>
<Link id="l07113" /><CodeLine lineNumber="7113"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> OpenMPIRBuilder::emitTargetTask(</span></CodeLine>
<Link id="l07114" /><CodeLine lineNumber="7114"><span class="doxyHighlight">    TargetTaskBodyCallbackTy TaskBodyCB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;DeviceID, <a href="/docs/api/classes/llvm/value">Value</a> &#42;RTLoc,</span></CodeLine>
<Link id="l07115" /><CodeLine lineNumber="7115"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> AllocaIP,</span></CodeLine>
<Link id="l07116" /><CodeLine lineNumber="7116"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;llvm::OpenMPIRBuilder::DependData&gt;</a> &amp;Dependencies,</span></CodeLine>
<Link id="l07117" /><CodeLine lineNumber="7117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasNoWait) &#123;</span></CodeLine>
<Link id="l07118" /><CodeLine lineNumber="7118"></CodeLine>
<Link id="l07119" /><CodeLine lineNumber="7119"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The following explains the code-gen scenario for the &#96;target&#96; directive. A</span></CodeLine>
<Link id="l07120" /><CodeLine lineNumber="7120"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// similar scneario is followed for other device-related directives (e.g.</span></CodeLine>
<Link id="l07121" /><CodeLine lineNumber="7121"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#96;target enter data&#96;) but in similar fashion since we only need to emit task</span></CodeLine>
<Link id="l07122" /><CodeLine lineNumber="7122"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that encapsulates the proper runtime call.</span></CodeLine>
<Link id="l07123" /><CodeLine lineNumber="7123"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07124" /><CodeLine lineNumber="7124"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When we arrive at this function, the target region itself has been</span></CodeLine>
<Link id="l07125" /><CodeLine lineNumber="7125"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// outlined into the function OutlinedFn.</span></CodeLine>
<Link id="l07126" /><CodeLine lineNumber="7126"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// So at ths point, for</span></CodeLine>
<Link id="l07127" /><CodeLine lineNumber="7127"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// --------------------------------------------------</span></CodeLine>
<Link id="l07128" /><CodeLine lineNumber="7128"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   void user&#95;code&#95;that&#95;offloads(...) &#123;</span></CodeLine>
<Link id="l07129" /><CodeLine lineNumber="7129"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     omp target depend(..) map(from:a) map(to:b, c)</span></CodeLine>
<Link id="l07130" /><CodeLine lineNumber="7130"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//        a = b + c</span></CodeLine>
<Link id="l07131" /><CodeLine lineNumber="7131"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#125;</span></CodeLine>
<Link id="l07132" /><CodeLine lineNumber="7132"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07133" /><CodeLine lineNumber="7133"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// --------------------------------------------------</span></CodeLine>
<Link id="l07134" /><CodeLine lineNumber="7134"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07135" /><CodeLine lineNumber="7135"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we have</span></CodeLine>
<Link id="l07136" /><CodeLine lineNumber="7136"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07137" /><CodeLine lineNumber="7137"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// --------------------------------------------------</span></CodeLine>
<Link id="l07138" /><CodeLine lineNumber="7138"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07139" /><CodeLine lineNumber="7139"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   void user&#95;code&#95;that&#95;offloads(...) &#123;</span></CodeLine>
<Link id="l07140" /><CodeLine lineNumber="7140"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %.offload&#95;baseptrs = alloca &#91;3 x ptr&#93;, align 8</span></CodeLine>
<Link id="l07141" /><CodeLine lineNumber="7141"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %.offload&#95;ptrs = alloca &#91;3 x ptr&#93;, align 8</span></CodeLine>
<Link id="l07142" /><CodeLine lineNumber="7142"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %.offload&#95;mappers = alloca &#91;3 x ptr&#93;, align 8</span></CodeLine>
<Link id="l07143" /><CodeLine lineNumber="7143"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     ;; target region has been outlined and now we need to</span></CodeLine>
<Link id="l07144" /><CodeLine lineNumber="7144"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     ;; offload to it via a target task.</span></CodeLine>
<Link id="l07145" /><CodeLine lineNumber="7145"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#125;</span></CodeLine>
<Link id="l07146" /><CodeLine lineNumber="7146"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   void outlined&#95;device&#95;function(ptr a, ptr b, ptr c) &#123;</span></CodeLine>
<Link id="l07147" /><CodeLine lineNumber="7147"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     &#42;a = &#42;b + &#42;c</span></CodeLine>
<Link id="l07148" /><CodeLine lineNumber="7148"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#125;</span></CodeLine>
<Link id="l07149" /><CodeLine lineNumber="7149"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07150" /><CodeLine lineNumber="7150"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We have to now do the following</span></CodeLine>
<Link id="l07151" /><CodeLine lineNumber="7151"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (i)   Make an offloading call to outlined&#95;device&#95;function using the OpenMP</span></CodeLine>
<Link id="l07152" /><CodeLine lineNumber="7152"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       RTL. See &#39;kernel&#95;launch&#95;function&#39; in the pseudo code below. This is</span></CodeLine>
<Link id="l07153" /><CodeLine lineNumber="7153"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       emitted by emitKernelLaunch</span></CodeLine>
<Link id="l07154" /><CodeLine lineNumber="7154"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (ii)  Create a task entry point function that calls kernel&#95;launch&#95;function</span></CodeLine>
<Link id="l07155" /><CodeLine lineNumber="7155"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       and is the entry point for the target task. See</span></CodeLine>
<Link id="l07156" /><CodeLine lineNumber="7156"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       &#39;@.omp&#95;target&#95;task&#95;proxy&#95;func in the pseudocode below.</span></CodeLine>
<Link id="l07157" /><CodeLine lineNumber="7157"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (iii) Create a task with the task entry point created in (ii)</span></CodeLine>
<Link id="l07158" /><CodeLine lineNumber="7158"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07159" /><CodeLine lineNumber="7159"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// That is we create the following</span></CodeLine>
<Link id="l07160" /><CodeLine lineNumber="7160"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07161" /><CodeLine lineNumber="7161"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   void user&#95;code&#95;that&#95;offloads(...) &#123;</span></CodeLine>
<Link id="l07162" /><CodeLine lineNumber="7162"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %.offload&#95;baseptrs = alloca &#91;3 x ptr&#93;, align 8</span></CodeLine>
<Link id="l07163" /><CodeLine lineNumber="7163"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %.offload&#95;ptrs = alloca &#91;3 x ptr&#93;, align 8</span></CodeLine>
<Link id="l07164" /><CodeLine lineNumber="7164"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %.offload&#95;mappers = alloca &#91;3 x ptr&#93;, align 8</span></CodeLine>
<Link id="l07165" /><CodeLine lineNumber="7165"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07166" /><CodeLine lineNumber="7166"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %structArg = alloca &#123; ptr, ptr, ptr &#125;, align 8</span></CodeLine>
<Link id="l07167" /><CodeLine lineNumber="7167"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %strucArg&#91;0&#93; = %.offload&#95;baseptrs</span></CodeLine>
<Link id="l07168" /><CodeLine lineNumber="7168"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %strucArg&#91;1&#93; = %.offload&#95;ptrs</span></CodeLine>
<Link id="l07169" /><CodeLine lineNumber="7169"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %strucArg&#91;2&#93; = %.offload&#95;mappers</span></CodeLine>
<Link id="l07170" /><CodeLine lineNumber="7170"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     proxy&#95;target&#95;task = @&#95;&#95;kmpc&#95;omp&#95;task&#95;alloc(...,</span></CodeLine>
<Link id="l07171" /><CodeLine lineNumber="7171"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                                               @.omp&#95;target&#95;task&#95;proxy&#95;func)</span></CodeLine>
<Link id="l07172" /><CodeLine lineNumber="7172"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     memcpy(proxy&#95;target&#95;task-&gt;shareds, %structArg, sizeof(structArg))</span></CodeLine>
<Link id="l07173" /><CodeLine lineNumber="7173"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     dependencies&#95;array = ...</span></CodeLine>
<Link id="l07174" /><CodeLine lineNumber="7174"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     ;; if nowait not present</span></CodeLine>
<Link id="l07175" /><CodeLine lineNumber="7175"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     call @&#95;&#95;kmpc&#95;omp&#95;wait&#95;deps(..., dependencies&#95;array)</span></CodeLine>
<Link id="l07176" /><CodeLine lineNumber="7176"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     call @&#95;&#95;kmpc&#95;omp&#95;task&#95;begin&#95;if0(...)</span></CodeLine>
<Link id="l07177" /><CodeLine lineNumber="7177"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     call @ @.omp&#95;target&#95;task&#95;proxy&#95;func(i32 thread&#95;id, ptr</span></CodeLine>
<Link id="l07178" /><CodeLine lineNumber="7178"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %proxy&#95;target&#95;task) call @&#95;&#95;kmpc&#95;omp&#95;task&#95;complete&#95;if0(...)</span></CodeLine>
<Link id="l07179" /><CodeLine lineNumber="7179"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#125;</span></CodeLine>
<Link id="l07180" /><CodeLine lineNumber="7180"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07181" /><CodeLine lineNumber="7181"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   define internal void @.omp&#95;target&#95;task&#95;proxy&#95;func(i32 %thread.id,</span></CodeLine>
<Link id="l07182" /><CodeLine lineNumber="7182"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                                                     ptr %task) &#123;</span></CodeLine>
<Link id="l07183" /><CodeLine lineNumber="7183"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       %structArg = alloca &#123;ptr, ptr, ptr&#125;</span></CodeLine>
<Link id="l07184" /><CodeLine lineNumber="7184"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       %shared&#95;data = load (getelementptr %task, 0, 0)</span></CodeLine>
<Link id="l07185" /><CodeLine lineNumber="7185"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       mempcy(%structArg, %shared&#95;data, sizeof(structArg))</span></CodeLine>
<Link id="l07186" /><CodeLine lineNumber="7186"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       kernel&#95;launch&#95;function(%thread.id, %structArg)</span></CodeLine>
<Link id="l07187" /><CodeLine lineNumber="7187"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#125;</span></CodeLine>
<Link id="l07188" /><CodeLine lineNumber="7188"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07189" /><CodeLine lineNumber="7189"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   We need the proxy function because the signature of the task entry point</span></CodeLine>
<Link id="l07190" /><CodeLine lineNumber="7190"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   expected by kmpc&#95;omp&#95;task is always the same and will be different from</span></CodeLine>
<Link id="l07191" /><CodeLine lineNumber="7191"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   that of the kernel&#95;launch function.</span></CodeLine>
<Link id="l07192" /><CodeLine lineNumber="7192"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07193" /><CodeLine lineNumber="7193"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   kernel&#95;launch&#95;function is generated by emitKernelLaunch and has the</span></CodeLine>
<Link id="l07194" /><CodeLine lineNumber="7194"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   always&#95;inline attribute.</span></CodeLine>
<Link id="l07195" /><CodeLine lineNumber="7195"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   void kernel&#95;launch&#95;function(thread&#95;id,</span></CodeLine>
<Link id="l07196" /><CodeLine lineNumber="7196"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                               structArg) alwaysinline &#123;</span></CodeLine>
<Link id="l07197" /><CodeLine lineNumber="7197"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       %kernel&#95;args = alloca %struct.&#95;&#95;tgt&#95;kernel&#95;arguments, align 8</span></CodeLine>
<Link id="l07198" /><CodeLine lineNumber="7198"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       offload&#95;baseptrs = load(getelementptr structArg, 0, 0)</span></CodeLine>
<Link id="l07199" /><CodeLine lineNumber="7199"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       offload&#95;ptrs = load(getelementptr structArg, 0, 1)</span></CodeLine>
<Link id="l07200" /><CodeLine lineNumber="7200"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       offload&#95;mappers = load(getelementptr structArg, 0, 2)</span></CodeLine>
<Link id="l07201" /><CodeLine lineNumber="7201"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       ; setup kernel&#95;args using offload&#95;baseptrs, offload&#95;ptrs and</span></CodeLine>
<Link id="l07202" /><CodeLine lineNumber="7202"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       ; offload&#95;mappers</span></CodeLine>
<Link id="l07203" /><CodeLine lineNumber="7203"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       call i32 @&#95;&#95;tgt&#95;target&#95;kernel(...,</span></CodeLine>
<Link id="l07204" /><CodeLine lineNumber="7204"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                                     outlined&#95;device&#95;function,</span></CodeLine>
<Link id="l07205" /><CodeLine lineNumber="7205"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                                     ptr %kernel&#95;args)</span></CodeLine>
<Link id="l07206" /><CodeLine lineNumber="7206"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#125;</span></CodeLine>
<Link id="l07207" /><CodeLine lineNumber="7207"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   void outlined&#95;device&#95;function(ptr a, ptr b, ptr c) &#123;</span></CodeLine>
<Link id="l07208" /><CodeLine lineNumber="7208"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      &#42;a = &#42;b + &#42;c</span></CodeLine>
<Link id="l07209" /><CodeLine lineNumber="7209"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#125;</span></CodeLine>
<Link id="l07210" /><CodeLine lineNumber="7210"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07211" /><CodeLine lineNumber="7211"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;TargetTaskBodyBB =</span></CodeLine>
<Link id="l07212" /><CodeLine lineNumber="7212"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;target.task.body&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07213" /><CodeLine lineNumber="7213"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;TargetTaskAllocaBB =</span></CodeLine>
<Link id="l07214" /><CodeLine lineNumber="7214"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;target.task.alloca&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07215" /><CodeLine lineNumber="7215"></CodeLine>
<Link id="l07216" /><CodeLine lineNumber="7216"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> TargetTaskAllocaIP(TargetTaskAllocaBB,</span></CodeLine>
<Link id="l07217" /><CodeLine lineNumber="7217"><span class="doxyHighlight">                                   TargetTaskAllocaBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l07218" /><CodeLine lineNumber="7218"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> TargetTaskBodyIP(TargetTaskBodyBB, TargetTaskBodyBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l07219" /><CodeLine lineNumber="7219"></CodeLine>
<Link id="l07220" /><CodeLine lineNumber="7220"><span class="doxyHighlight">  OutlineInfo OI;</span></CodeLine>
<Link id="l07221" /><CodeLine lineNumber="7221"><span class="doxyHighlight">  OI.EntryBB = TargetTaskAllocaBB;</span></CodeLine>
<Link id="l07222" /><CodeLine lineNumber="7222"><span class="doxyHighlight">  OI.OuterAllocaBB = AllocaIP.<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint/#a3d072f8ac5e1b0724c4bb5a77adae9da">getBlock</a>();</span></CodeLine>
<Link id="l07223" /><CodeLine lineNumber="7223"></CodeLine>
<Link id="l07224" /><CodeLine lineNumber="7224"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add the thread ID argument.</span></CodeLine>
<Link id="l07225" /><CodeLine lineNumber="7225"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;, 4&gt; ToBeDeleted;</span></CodeLine>
<Link id="l07226" /><CodeLine lineNumber="7226"><span class="doxyHighlight">  OI.ExcludeArgsFromAggregate.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="#a35409dbaffc2cf38fefec12e3cf9094d">createFakeIntVal</a>(</span></CodeLine>
<Link id="l07227" /><CodeLine lineNumber="7227"><span class="doxyHighlight">      Builder, AllocaIP, ToBeDeleted, TargetTaskAllocaIP, </span><span class="doxyHighlightStringLiteral">&quot;global.tid&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l07228" /><CodeLine lineNumber="7228"></CodeLine>
<Link id="l07229" /><CodeLine lineNumber="7229"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(TargetTaskBodyIP);</span></CodeLine>
<Link id="l07230" /><CodeLine lineNumber="7230"></CodeLine>
<Link id="l07231" /><CodeLine lineNumber="7231"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = TaskBodyCB(DeviceID, RTLoc, TargetTaskAllocaIP))</span></CodeLine>
<Link id="l07232" /><CodeLine lineNumber="7232"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l07233" /><CodeLine lineNumber="7233"></CodeLine>
<Link id="l07234" /><CodeLine lineNumber="7234"><span class="doxyHighlight">  OI.ExitBB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>().<a href="/docs/api/classes/llvm/irbuilderbase/insertpoint/#a3d072f8ac5e1b0724c4bb5a77adae9da">getBlock</a>();</span></CodeLine>
<Link id="l07235" /><CodeLine lineNumber="7235"><span class="doxyHighlight">  OI.PostOutlineCB = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, ToBeDeleted, Dependencies, HasNoWait,</span></CodeLine>
<Link id="l07236" /><CodeLine lineNumber="7236"><span class="doxyHighlight">                      DeviceID&#93;(<a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &amp;OutlinedFn) </span><span class="doxyHighlightKeyword">mutable</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07237" /><CodeLine lineNumber="7237"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFn.<a href="/docs/api/classes/llvm/value/#aba0055050d741f60b6e0523507a2c79f">getNumUses</a>() == 1 &amp;&amp;</span></CodeLine>
<Link id="l07238" /><CodeLine lineNumber="7238"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;there must be a single user for the outlined function&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07239" /><CodeLine lineNumber="7239"></CodeLine>
<Link id="l07240" /><CodeLine lineNumber="7240"><span class="doxyHighlight">    CallInst &#42;StaleCI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(OutlinedFn.<a href="/docs/api/classes/llvm/value/#a46db903db2484e1ef5062d094d6b0854">user&#95;back</a>());</span></CodeLine>
<Link id="l07241" /><CodeLine lineNumber="7241"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasShareds = StaleCI-&gt;<a href="/docs/api/classes/llvm/callbase/#adde2ea00dd2613ee41bfe91908e4e68e">arg&#95;size</a>() &gt; 1;</span></CodeLine>
<Link id="l07242" /><CodeLine lineNumber="7242"></CodeLine>
<Link id="l07243" /><CodeLine lineNumber="7243"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;ProxyFn = <a href="#a3fb4884285f5bcb9a37d9378d1e33cd5">emitTargetTaskProxyFunction</a>(&#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, Builder, StaleCI);</span></CodeLine>
<Link id="l07244" /><CodeLine lineNumber="7244"></CodeLine>
<Link id="l07245" /><CodeLine lineNumber="7245"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Proxy task entry function created: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;ProxyFn</span></CodeLine>
<Link id="l07246" /><CodeLine lineNumber="7246"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07247" /><CodeLine lineNumber="7247"></CodeLine>
<Link id="l07248" /><CodeLine lineNumber="7248"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(StaleCI);</span></CodeLine>
<Link id="l07249" /><CodeLine lineNumber="7249"></CodeLine>
<Link id="l07250" /><CodeLine lineNumber="7250"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Gather the arguments for emitting the runtime call.</span></CodeLine>
<Link id="l07251" /><CodeLine lineNumber="7251"><span class="doxyHighlight">    uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l07252" /><CodeLine lineNumber="7252"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;SrcLocStr =</span></CodeLine>
<Link id="l07253" /><CodeLine lineNumber="7253"><span class="doxyHighlight">        getOrCreateSrcLocStr(<a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a>(Builder), SrcLocStrSize);</span></CodeLine>
<Link id="l07254" /><CodeLine lineNumber="7254"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l07255" /><CodeLine lineNumber="7255"></CodeLine>
<Link id="l07256" /><CodeLine lineNumber="7256"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// @&#95;&#95;kmpc&#95;omp&#95;task&#95;alloc or @&#95;&#95;kmpc&#95;omp&#95;target&#95;task&#95;alloc</span></CodeLine>
<Link id="l07257" /><CodeLine lineNumber="7257"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07258" /><CodeLine lineNumber="7258"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If &#96;HasNoWait == true&#96;, we call  @&#95;&#95;kmpc&#95;omp&#95;target&#95;task&#95;alloc to provide</span></CodeLine>
<Link id="l07259" /><CodeLine lineNumber="7259"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the DeviceID to the deferred task and also since</span></CodeLine>
<Link id="l07260" /><CodeLine lineNumber="7260"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// @&#95;&#95;kmpc&#95;omp&#95;target&#95;task&#95;alloc creates an untied/async task.</span></CodeLine>
<Link id="l07261" /><CodeLine lineNumber="7261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsTargetTask = HasNoWait &amp;&amp; DeviceID;</span></CodeLine>
<Link id="l07262" /><CodeLine lineNumber="7262"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskAllocFn =</span></CodeLine>
<Link id="l07263" /><CodeLine lineNumber="7263"><span class="doxyHighlight">        !NeedsTargetTask</span></CodeLine>
<Link id="l07264" /><CodeLine lineNumber="7264"><span class="doxyHighlight">            ? getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;task&#95;alloc)</span></CodeLine>
<Link id="l07265" /><CodeLine lineNumber="7265"><span class="doxyHighlight">            : getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l07266" /><CodeLine lineNumber="7266"><span class="doxyHighlight">                  OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;target&#95;task&#95;alloc);</span></CodeLine>
<Link id="l07267" /><CodeLine lineNumber="7267"></CodeLine>
<Link id="l07268" /><CodeLine lineNumber="7268"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Arguments - &#96;loc&#95;ref&#96; (Ident) and &#96;gtid&#96; (ThreadID)</span></CodeLine>
<Link id="l07269" /><CodeLine lineNumber="7269"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// call.</span></CodeLine>
<Link id="l07270" /><CodeLine lineNumber="7270"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadID = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l07271" /><CodeLine lineNumber="7271"></CodeLine>
<Link id="l07272" /><CodeLine lineNumber="7272"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Argument - &#96;sizeof&#95;kmp&#95;task&#95;t&#96; (TaskSize)</span></CodeLine>
<Link id="l07273" /><CodeLine lineNumber="7273"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Tasksize refers to the size in bytes of kmp&#95;task&#95;t data structure</span></CodeLine>
<Link id="l07274" /><CodeLine lineNumber="7274"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// including private vars accessed in task.</span></CodeLine>
<Link id="l07275" /><CodeLine lineNumber="7275"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: add kmp&#95;task&#95;t&#95;with&#95;privates (privates)</span></CodeLine>
<Link id="l07276" /><CodeLine lineNumber="7276"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TaskSize =</span></CodeLine>
<Link id="l07277" /><CodeLine lineNumber="7277"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(Task));</span></CodeLine>
<Link id="l07278" /><CodeLine lineNumber="7278"></CodeLine>
<Link id="l07279" /><CodeLine lineNumber="7279"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Argument - &#96;sizeof&#95;shareds&#96; (SharedsSize)</span></CodeLine>
<Link id="l07280" /><CodeLine lineNumber="7280"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SharedsSize refers to the shareds array size in the kmp&#95;task&#95;t data</span></CodeLine>
<Link id="l07281" /><CodeLine lineNumber="7281"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// structure.</span></CodeLine>
<Link id="l07282" /><CodeLine lineNumber="7282"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SharedsSize = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(0);</span></CodeLine>
<Link id="l07283" /><CodeLine lineNumber="7283"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasShareds) &#123;</span></CodeLine>
<Link id="l07284" /><CodeLine lineNumber="7284"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ArgStructAlloca = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(StaleCI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(1));</span></CodeLine>
<Link id="l07285" /><CodeLine lineNumber="7285"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ArgStructAlloca &amp;&amp;</span></CodeLine>
<Link id="l07286" /><CodeLine lineNumber="7286"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Unable to find the alloca instruction corresponding to arguments &quot;</span></CodeLine>
<Link id="l07287" /><CodeLine lineNumber="7287"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;for extracted function&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07288" /><CodeLine lineNumber="7288"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ArgStructType =</span></CodeLine>
<Link id="l07289" /><CodeLine lineNumber="7289"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StructType&gt;</a>(ArgStructAlloca-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>());</span></CodeLine>
<Link id="l07290" /><CodeLine lineNumber="7290"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ArgStructType &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unable to find struct type corresponding to &quot;</span></CodeLine>
<Link id="l07291" /><CodeLine lineNumber="7291"><span class="doxyHighlight">                              </span><span class="doxyHighlightStringLiteral">&quot;arguments for extracted function&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07292" /><CodeLine lineNumber="7292"><span class="doxyHighlight">      SharedsSize =</span></CodeLine>
<Link id="l07293" /><CodeLine lineNumber="7293"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(ArgStructType));</span></CodeLine>
<Link id="l07294" /><CodeLine lineNumber="7294"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07295" /><CodeLine lineNumber="7295"></CodeLine>
<Link id="l07296" /><CodeLine lineNumber="7296"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Argument - &#96;flags&#96;</span></CodeLine>
<Link id="l07297" /><CodeLine lineNumber="7297"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Task is tied iff (Flags &amp; 1) == 1</span></CodeLine>
<Link id="l07298" /><CodeLine lineNumber="7298"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Task is untied iff (Flags &amp; 1) == 0</span></CodeLine>
<Link id="l07299" /><CodeLine lineNumber="7299"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Task is final iff (Flags &amp; 2) == 2</span></CodeLine>
<Link id="l07300" /><CodeLine lineNumber="7300"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Task is not final iff (Flags &amp; 2) == 0</span></CodeLine>
<Link id="l07301" /><CodeLine lineNumber="7301"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A target task is not final and is untied.</span></CodeLine>
<Link id="l07302" /><CodeLine lineNumber="7302"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(0);</span></CodeLine>
<Link id="l07303" /><CodeLine lineNumber="7303"></CodeLine>
<Link id="l07304" /><CodeLine lineNumber="7304"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Emit the @&#95;&#95;kmpc&#95;omp&#95;task&#95;alloc runtime call</span></CodeLine>
<Link id="l07305" /><CodeLine lineNumber="7305"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The runtime call returns a pointer to an area where the task captured</span></CodeLine>
<Link id="l07306" /><CodeLine lineNumber="7306"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// variables must be copied before the task is run (TaskData)</span></CodeLine>
<Link id="l07307" /><CodeLine lineNumber="7307"><span class="doxyHighlight">    CallInst &#42;TaskData = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07308" /><CodeLine lineNumber="7308"></CodeLine>
<Link id="l07309" /><CodeLine lineNumber="7309"><span class="doxyHighlight">    SmallVector&lt;llvm::Value &#42;&gt; TaskAllocArgs = &#123;</span></CodeLine>
<Link id="l07310" /><CodeLine lineNumber="7310"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;loc&#95;ref=&#42;/</span><span class="doxyHighlight">Ident,        </span><span class="doxyHighlightComment">/&#42;gtid=&#42;/</span><span class="doxyHighlight">ThreadID,</span></CodeLine>
<Link id="l07311" /><CodeLine lineNumber="7311"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;flags=&#42;/</span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a>,</span></CodeLine>
<Link id="l07312" /><CodeLine lineNumber="7312"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;sizeof&#95;task=&#42;/</span><span class="doxyHighlight">TaskSize, </span><span class="doxyHighlightComment">/&#42;sizeof&#95;shared=&#42;/</span><span class="doxyHighlight">SharedsSize,</span></CodeLine>
<Link id="l07313" /><CodeLine lineNumber="7313"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;task&#95;func=&#42;/</span><span class="doxyHighlight">ProxyFn&#125;;</span></CodeLine>
<Link id="l07314" /><CodeLine lineNumber="7314"></CodeLine>
<Link id="l07315" /><CodeLine lineNumber="7315"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsTargetTask) &#123;</span></CodeLine>
<Link id="l07316" /><CodeLine lineNumber="7316"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DeviceID &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected non-empty device ID.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07317" /><CodeLine lineNumber="7317"><span class="doxyHighlight">      TaskAllocArgs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(DeviceID);</span></CodeLine>
<Link id="l07318" /><CodeLine lineNumber="7318"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07319" /><CodeLine lineNumber="7319"></CodeLine>
<Link id="l07320" /><CodeLine lineNumber="7320"><span class="doxyHighlight">    TaskData = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(TaskAllocFn, TaskAllocArgs);</span></CodeLine>
<Link id="l07321" /><CodeLine lineNumber="7321"></CodeLine>
<Link id="l07322" /><CodeLine lineNumber="7322"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasShareds) &#123;</span></CodeLine>
<Link id="l07323" /><CodeLine lineNumber="7323"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Shareds = StaleCI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(1);</span></CodeLine>
<Link id="l07324" /><CodeLine lineNumber="7324"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> Alignment = TaskData-&gt;<a href="/docs/api/classes/llvm/value/#a47f5c74e1b14ba4a61db057400644acc">getPointerAlignment</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout());</span></CodeLine>
<Link id="l07325" /><CodeLine lineNumber="7325"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;TaskShareds = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(VoidPtr, TaskData);</span></CodeLine>
<Link id="l07326" /><CodeLine lineNumber="7326"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae9f2730f66215fdb82f4e41e45124811">CreateMemCpy</a>(TaskShareds, Alignment, Shareds, Alignment,</span></CodeLine>
<Link id="l07327" /><CodeLine lineNumber="7327"><span class="doxyHighlight">                           SharedsSize);</span></CodeLine>
<Link id="l07328" /><CodeLine lineNumber="7328"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07329" /><CodeLine lineNumber="7329"></CodeLine>
<Link id="l07330" /><CodeLine lineNumber="7330"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DepArray = <a href="#a9702d30c99a5459e9565631adf1fdf1b">emitTaskDependencies</a>(&#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, Dependencies);</span></CodeLine>
<Link id="l07331" /><CodeLine lineNumber="7331"></CodeLine>
<Link id="l07332" /><CodeLine lineNumber="7332"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ---------------------------------------------------------------</span></CodeLine>
<Link id="l07333" /><CodeLine lineNumber="7333"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// V5.2 13.8 target construct</span></CodeLine>
<Link id="l07334" /><CodeLine lineNumber="7334"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the nowait clause is present, execution of the target task</span></CodeLine>
<Link id="l07335" /><CodeLine lineNumber="7335"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// may be deferred. If the nowait clause is not present, the target task is</span></CodeLine>
<Link id="l07336" /><CodeLine lineNumber="7336"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// an included task.</span></CodeLine>
<Link id="l07337" /><CodeLine lineNumber="7337"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ---------------------------------------------------------------</span></CodeLine>
<Link id="l07338" /><CodeLine lineNumber="7338"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The above means that the lack of a nowait on the target construct</span></CodeLine>
<Link id="l07339" /><CodeLine lineNumber="7339"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// translates to &#39;#pragma omp task if(0)&#39;</span></CodeLine>
<Link id="l07340" /><CodeLine lineNumber="7340"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NeedsTargetTask) &#123;</span></CodeLine>
<Link id="l07341" /><CodeLine lineNumber="7341"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DepArray) &#123;</span></CodeLine>
<Link id="l07342" /><CodeLine lineNumber="7342"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskWaitFn =</span></CodeLine>
<Link id="l07343" /><CodeLine lineNumber="7343"><span class="doxyHighlight">            getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;wait&#95;deps);</span></CodeLine>
<Link id="l07344" /><CodeLine lineNumber="7344"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l07345" /><CodeLine lineNumber="7345"><span class="doxyHighlight">            TaskWaitFn,</span></CodeLine>
<Link id="l07346" /><CodeLine lineNumber="7346"><span class="doxyHighlight">            &#123;</span><span class="doxyHighlightComment">/&#42;loc&#95;ref=&#42;/</span><span class="doxyHighlight">Ident, </span><span class="doxyHighlightComment">/&#42;gtid=&#42;/</span><span class="doxyHighlight">ThreadID,</span></CodeLine>
<Link id="l07347" /><CodeLine lineNumber="7347"><span class="doxyHighlight">             </span><span class="doxyHighlightComment">/&#42;ndeps=&#42;/</span><span class="doxyHighlight">Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(Dependencies.size()),</span></CodeLine>
<Link id="l07348" /><CodeLine lineNumber="7348"><span class="doxyHighlight">             </span><span class="doxyHighlightComment">/&#42;dep&#95;list=&#42;/</span><span class="doxyHighlight">DepArray,</span></CodeLine>
<Link id="l07349" /><CodeLine lineNumber="7349"><span class="doxyHighlight">             </span><span class="doxyHighlightComment">/&#42;ndeps&#95;noalias=&#42;/</span><span class="doxyHighlight">ConstantInt::get(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), 0),</span></CodeLine>
<Link id="l07350" /><CodeLine lineNumber="7350"><span class="doxyHighlight">             </span><span class="doxyHighlightComment">/&#42;noalias&#95;dep&#95;list=&#42;/</span></CodeLine>
<Link id="l07351" /><CodeLine lineNumber="7351"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext()))&#125;);</span></CodeLine>
<Link id="l07352" /><CodeLine lineNumber="7352"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07353" /><CodeLine lineNumber="7353"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Included task.</span></CodeLine>
<Link id="l07354" /><CodeLine lineNumber="7354"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskBeginFn =</span></CodeLine>
<Link id="l07355" /><CodeLine lineNumber="7355"><span class="doxyHighlight">          getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;task&#95;begin&#95;if0);</span></CodeLine>
<Link id="l07356" /><CodeLine lineNumber="7356"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskCompleteFn =</span></CodeLine>
<Link id="l07357" /><CodeLine lineNumber="7357"><span class="doxyHighlight">          getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;task&#95;complete&#95;if0);</span></CodeLine>
<Link id="l07358" /><CodeLine lineNumber="7358"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(TaskBeginFn, &#123;Ident, ThreadID, TaskData&#125;);</span></CodeLine>
<Link id="l07359" /><CodeLine lineNumber="7359"><span class="doxyHighlight">      CallInst &#42;CI = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(ProxyFn, &#123;ThreadID, TaskData&#125;);</span></CodeLine>
<Link id="l07360" /><CodeLine lineNumber="7360"><span class="doxyHighlight">      CI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(StaleCI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l07361" /><CodeLine lineNumber="7361"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(TaskCompleteFn, &#123;Ident, ThreadID, TaskData&#125;);</span></CodeLine>
<Link id="l07362" /><CodeLine lineNumber="7362"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DepArray) &#123;</span></CodeLine>
<Link id="l07363" /><CodeLine lineNumber="7363"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// HasNoWait - meaning the task may be deferred. Call</span></CodeLine>
<Link id="l07364" /><CodeLine lineNumber="7364"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// &#95;&#95;kmpc&#95;omp&#95;task&#95;with&#95;deps if there are dependencies,</span></CodeLine>
<Link id="l07365" /><CodeLine lineNumber="7365"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// else call &#95;&#95;kmpc&#95;omp&#95;task</span></CodeLine>
<Link id="l07366" /><CodeLine lineNumber="7366"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskFn =</span></CodeLine>
<Link id="l07367" /><CodeLine lineNumber="7367"><span class="doxyHighlight">          getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;task&#95;with&#95;deps);</span></CodeLine>
<Link id="l07368" /><CodeLine lineNumber="7368"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l07369" /><CodeLine lineNumber="7369"><span class="doxyHighlight">          TaskFn,</span></CodeLine>
<Link id="l07370" /><CodeLine lineNumber="7370"><span class="doxyHighlight">          &#123;Ident, ThreadID, TaskData, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(Dependencies.size()),</span></CodeLine>
<Link id="l07371" /><CodeLine lineNumber="7371"><span class="doxyHighlight">           DepArray, ConstantInt::get(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), 0),</span></CodeLine>
<Link id="l07372" /><CodeLine lineNumber="7372"><span class="doxyHighlight">           <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext()))&#125;);</span></CodeLine>
<Link id="l07373" /><CodeLine lineNumber="7373"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07374" /><CodeLine lineNumber="7374"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Emit the @&#95;&#95;kmpc&#95;omp&#95;task runtime call to spawn the task</span></CodeLine>
<Link id="l07375" /><CodeLine lineNumber="7375"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;TaskFn = getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;omp&#95;task);</span></CodeLine>
<Link id="l07376" /><CodeLine lineNumber="7376"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(TaskFn, &#123;Ident, ThreadID, TaskData&#125;);</span></CodeLine>
<Link id="l07377" /><CodeLine lineNumber="7377"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07378" /><CodeLine lineNumber="7378"></CodeLine>
<Link id="l07379" /><CodeLine lineNumber="7379"><span class="doxyHighlight">    StaleCI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l07380" /><CodeLine lineNumber="7380"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(ToBeDeleted))</span></CodeLine>
<Link id="l07381" /><CodeLine lineNumber="7381"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l07382" /><CodeLine lineNumber="7382"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l07383" /><CodeLine lineNumber="7383"><span class="doxyHighlight">  addOutlineInfo(std::move(OI));</span></CodeLine>
<Link id="l07384" /><CodeLine lineNumber="7384"></CodeLine>
<Link id="l07385" /><CodeLine lineNumber="7385"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Insert block after emitKernelLaunch = \\n&quot;</span></CodeLine>
<Link id="l07386" /><CodeLine lineNumber="7386"><span class="doxyHighlight">                    &lt;&lt; &#42;(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07387" /><CodeLine lineNumber="7387"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Module after emitKernelLaunch = \\n&quot;</span></CodeLine>
<Link id="l07388" /><CodeLine lineNumber="7388"><span class="doxyHighlight">                    &lt;&lt; &#42;(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>())</span></CodeLine>
<Link id="l07389" /><CodeLine lineNumber="7389"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07390" /><CodeLine lineNumber="7390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l07391" /><CodeLine lineNumber="7391"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07392" /><CodeLine lineNumber="7392"></CodeLine>
<Link id="l07393" /><CodeLine lineNumber="7393"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitOffloadingArraysAndArgs(</span></CodeLine>
<Link id="l07394" /><CodeLine lineNumber="7394"><span class="doxyHighlight">    InsertPointTy AllocaIP, InsertPointTy CodeGenIP, TargetDataInfo &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>,</span></CodeLine>
<Link id="l07395" /><CodeLine lineNumber="7395"><span class="doxyHighlight">    TargetDataRTArgs &amp;RTArgs, MapInfosTy &amp;CombinedInfo, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNonContiguous,</span></CodeLine>
<Link id="l07396" /><CodeLine lineNumber="7396"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ForEndCall, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/value">Value</a> &#42;)&gt; DeviceAddrCB,</span></CodeLine>
<Link id="l07397" /><CodeLine lineNumber="7397"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/value">Value</a> &#42;(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">)&gt; CustomMapperCB) &#123;</span></CodeLine>
<Link id="l07398" /><CodeLine lineNumber="7398"><span class="doxyHighlight">  emitOffloadingArrays(AllocaIP, CodeGenIP, CombinedInfo, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>, IsNonContiguous,</span></CodeLine>
<Link id="l07399" /><CodeLine lineNumber="7399"><span class="doxyHighlight">                       DeviceAddrCB, CustomMapperCB);</span></CodeLine>
<Link id="l07400" /><CodeLine lineNumber="7400"><span class="doxyHighlight">  emitOffloadingArraysArgument(Builder, RTArgs, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>, ForEndCall);</span></CodeLine>
<Link id="l07401" /><CodeLine lineNumber="7401"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07402" /><CodeLine lineNumber="7402"></CodeLine>
<Link id="l07403" /><CodeLine lineNumber="7403"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l07404" /><CodeLine lineNumber="7404" lineLink="#a9acb4faf91112542d5ecf41230e9b64a"><span class="doxyHighlight"><a href="#a9acb4faf91112542d5ecf41230e9b64a">emitTargetCall</a>(<a href="/docs/api/classes/llvm/openmpirbuilder">OpenMPIRBuilder</a> &amp;OMPBuilder, <a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder,</span></CodeLine>
<Link id="l07405" /><CodeLine lineNumber="7405"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> AllocaIP,</span></CodeLine>
<Link id="l07406" /><CodeLine lineNumber="7406"><span class="doxyHighlight">               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> OpenMPIRBuilder::TargetKernelDefaultAttrs &amp;DefaultAttrs,</span></CodeLine>
<Link id="l07407" /><CodeLine lineNumber="7407"><span class="doxyHighlight">               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> OpenMPIRBuilder::TargetKernelRuntimeAttrs &amp;RuntimeAttrs,</span></CodeLine>
<Link id="l07408" /><CodeLine lineNumber="7408"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/value">Value</a> &#42;IfCond, <a href="/docs/api/classes/llvm/function">Function</a> &#42;OutlinedFn, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;OutlinedFnID,</span></CodeLine>
<Link id="l07409" /><CodeLine lineNumber="7409"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Value &#42;&gt;</a> &amp;Args,</span></CodeLine>
<Link id="l07410" /><CodeLine lineNumber="7410"><span class="doxyHighlight">               OpenMPIRBuilder::GenMapInfoCallbackTy GenMapInfoCB,</span></CodeLine>
<Link id="l07411" /><CodeLine lineNumber="7411"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;llvm::OpenMPIRBuilder::DependData&gt;</a> Dependencies = &#123;&#125;,</span></CodeLine>
<Link id="l07412" /><CodeLine lineNumber="7412"><span class="doxyHighlight">               </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasNoWait = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l07413" /><CodeLine lineNumber="7413"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate a function call to the host fallback implementation of the target</span></CodeLine>
<Link id="l07414" /><CodeLine lineNumber="7414"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// region. This is called by the host when no offload entry was generated for</span></CodeLine>
<Link id="l07415" /><CodeLine lineNumber="7415"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the target region and when the offloading call fails at runtime.</span></CodeLine>
<Link id="l07416" /><CodeLine lineNumber="7416"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&amp;EmitTargetCallFallbackCB = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> IP)</span></CodeLine>
<Link id="l07417" /><CodeLine lineNumber="7417"><span class="doxyHighlight">      -&gt; <a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> &#123;</span></CodeLine>
<Link id="l07418" /><CodeLine lineNumber="7418"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(IP);</span></CodeLine>
<Link id="l07419" /><CodeLine lineNumber="7419"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(OutlinedFn, Args);</span></CodeLine>
<Link id="l07420" /><CodeLine lineNumber="7420"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l07421" /><CodeLine lineNumber="7421"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l07422" /><CodeLine lineNumber="7422"></CodeLine>
<Link id="l07423" /><CodeLine lineNumber="7423"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasDependencies = Dependencies.size() &gt; 0;</span></CodeLine>
<Link id="l07424" /><CodeLine lineNumber="7424"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RequiresOuterTargetTask = HasNoWait || HasDependencies;</span></CodeLine>
<Link id="l07425" /><CodeLine lineNumber="7425"></CodeLine>
<Link id="l07426" /><CodeLine lineNumber="7426"><span class="doxyHighlight">  OpenMPIRBuilder::TargetKernelArgs KArgs;</span></CodeLine>
<Link id="l07427" /><CodeLine lineNumber="7427"></CodeLine>
<Link id="l07428" /><CodeLine lineNumber="7428"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TaskBodyCB =</span></CodeLine>
<Link id="l07429" /><CodeLine lineNumber="7429"><span class="doxyHighlight">      &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;DeviceID, <a href="/docs/api/classes/llvm/value">Value</a> &#42;RTLoc,</span></CodeLine>
<Link id="l07430" /><CodeLine lineNumber="7430"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/irbuilderbase/insertpoint">IRBuilderBase::InsertPoint</a> TargetTaskAllocaIP) -&gt; <a href="/docs/api/classes/llvm/error">Error</a> &#123;</span></CodeLine>
<Link id="l07431" /><CodeLine lineNumber="7431"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Assume no error was returned because EmitTargetCallFallbackCB doesn&#39;t</span></CodeLine>
<Link id="l07432" /><CodeLine lineNumber="7432"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// produce any.</span></CodeLine>
<Link id="l07433" /><CodeLine lineNumber="7433"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">llvm::OpenMPIRBuilder::InsertPointTy</a> AfterIP = <a href="/docs/api/namespaces/llvm/#aa1e1474f15df639f0d874b21f15666f7">cantFail</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l07434" /><CodeLine lineNumber="7434"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// emitKernelLaunch makes the necessary runtime call to offload the</span></CodeLine>
<Link id="l07435" /><CodeLine lineNumber="7435"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// kernel. We then outline all that code into a separate function</span></CodeLine>
<Link id="l07436" /><CodeLine lineNumber="7436"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (&#39;kernel&#95;launch&#95;function&#39; in the pseudo code above). This function is</span></CodeLine>
<Link id="l07437" /><CodeLine lineNumber="7437"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// then called by the target task proxy function (see</span></CodeLine>
<Link id="l07438" /><CodeLine lineNumber="7438"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// &#39;@.omp&#95;target&#95;task&#95;proxy&#95;func&#39; in the pseudo code above)</span></CodeLine>
<Link id="l07439" /><CodeLine lineNumber="7439"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// &quot;@.omp&#95;target&#95;task&#95;proxy&#95;func&#39; is generated by</span></CodeLine>
<Link id="l07440" /><CodeLine lineNumber="7440"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// emitTargetTaskProxyFunction.</span></CodeLine>
<Link id="l07441" /><CodeLine lineNumber="7441"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OutlinedFnID)</span></CodeLine>
<Link id="l07442" /><CodeLine lineNumber="7442"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.emitKernelLaunch(Builder, OutlinedFnID,</span></CodeLine>
<Link id="l07443" /><CodeLine lineNumber="7443"><span class="doxyHighlight">                                           EmitTargetCallFallbackCB, KArgs,</span></CodeLine>
<Link id="l07444" /><CodeLine lineNumber="7444"><span class="doxyHighlight">                                           DeviceID, RTLoc, TargetTaskAllocaIP);</span></CodeLine>
<Link id="l07445" /><CodeLine lineNumber="7445"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// When OutlinedFnID is set to nullptr, then it&#39;s not an offloading call.</span></CodeLine>
<Link id="l07446" /><CodeLine lineNumber="7446"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// In this case, we execute the host implementation directly.</span></CodeLine>
<Link id="l07447" /><CodeLine lineNumber="7447"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EmitTargetCallFallbackCB(OMPBuilder.Builder.saveIP());</span></CodeLine>
<Link id="l07448" /><CodeLine lineNumber="7448"><span class="doxyHighlight">    &#125;());</span></CodeLine>
<Link id="l07449" /><CodeLine lineNumber="7449"></CodeLine>
<Link id="l07450" /><CodeLine lineNumber="7450"><span class="doxyHighlight">    OMPBuilder.Builder.restoreIP(AfterIP);</span></CodeLine>
<Link id="l07451" /><CodeLine lineNumber="7451"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l07452" /><CodeLine lineNumber="7452"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l07453" /><CodeLine lineNumber="7453"></CodeLine>
<Link id="l07454" /><CodeLine lineNumber="7454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&amp;EmitTargetCallElse =</span></CodeLine>
<Link id="l07455" /><CodeLine lineNumber="7455"><span class="doxyHighlight">      &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> AllocaIP,</span></CodeLine>
<Link id="l07456" /><CodeLine lineNumber="7456"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> CodeGenIP) -&gt; <a href="/docs/api/classes/llvm/error">Error</a> &#123;</span></CodeLine>
<Link id="l07457" /><CodeLine lineNumber="7457"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Assume no error was returned because EmitTargetCallFallbackCB doesn&#39;t</span></CodeLine>
<Link id="l07458" /><CodeLine lineNumber="7458"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// produce any.</span></CodeLine>
<Link id="l07459" /><CodeLine lineNumber="7459"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> AfterIP = <a href="/docs/api/namespaces/llvm/#aa1e1474f15df639f0d874b21f15666f7">cantFail</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l07460" /><CodeLine lineNumber="7460"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RequiresOuterTargetTask) &#123;</span></CodeLine>
<Link id="l07461" /><CodeLine lineNumber="7461"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Arguments that are intended to be directly forwarded to an</span></CodeLine>
<Link id="l07462" /><CodeLine lineNumber="7462"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// emitKernelLaunch call are pased as nullptr, since</span></CodeLine>
<Link id="l07463" /><CodeLine lineNumber="7463"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// OutlinedFnID=nullptr results in that call not being done.</span></CodeLine>
<Link id="l07464" /><CodeLine lineNumber="7464"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.emitTargetTask(TaskBodyCB, </span><span class="doxyHighlightComment">/&#42;DeviceID=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07465" /><CodeLine lineNumber="7465"><span class="doxyHighlight">                                         </span><span class="doxyHighlightComment">/&#42;RTLoc=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, AllocaIP,</span></CodeLine>
<Link id="l07466" /><CodeLine lineNumber="7466"><span class="doxyHighlight">                                         Dependencies, HasNoWait);</span></CodeLine>
<Link id="l07467" /><CodeLine lineNumber="7467"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07468" /><CodeLine lineNumber="7468"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EmitTargetCallFallbackCB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>());</span></CodeLine>
<Link id="l07469" /><CodeLine lineNumber="7469"><span class="doxyHighlight">    &#125;());</span></CodeLine>
<Link id="l07470" /><CodeLine lineNumber="7470"></CodeLine>
<Link id="l07471" /><CodeLine lineNumber="7471"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AfterIP);</span></CodeLine>
<Link id="l07472" /><CodeLine lineNumber="7472"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l07473" /><CodeLine lineNumber="7473"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l07474" /><CodeLine lineNumber="7474"></CodeLine>
<Link id="l07475" /><CodeLine lineNumber="7475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&amp;EmitTargetCallThen =</span></CodeLine>
<Link id="l07476" /><CodeLine lineNumber="7476"><span class="doxyHighlight">      &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> AllocaIP,</span></CodeLine>
<Link id="l07477" /><CodeLine lineNumber="7477"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> CodeGenIP) -&gt; <a href="/docs/api/classes/llvm/error">Error</a> &#123;</span></CodeLine>
<Link id="l07478" /><CodeLine lineNumber="7478"><span class="doxyHighlight">    OpenMPIRBuilder::TargetDataInfo <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>(</span></CodeLine>
<Link id="l07479" /><CodeLine lineNumber="7479"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;RequiresDevicePointerInfo=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07480" /><CodeLine lineNumber="7480"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;SeparateBeginEndCalls=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07481" /><CodeLine lineNumber="7481"></CodeLine>
<Link id="l07482" /><CodeLine lineNumber="7482"><span class="doxyHighlight">    OpenMPIRBuilder::MapInfosTy &amp;MapInfo = GenMapInfoCB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>());</span></CodeLine>
<Link id="l07483" /><CodeLine lineNumber="7483"><span class="doxyHighlight">    OpenMPIRBuilder::TargetDataRTArgs RTArgs;</span></CodeLine>
<Link id="l07484" /><CodeLine lineNumber="7484"><span class="doxyHighlight">    OMPBuilder.emitOffloadingArraysAndArgs(AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>,</span></CodeLine>
<Link id="l07485" /><CodeLine lineNumber="7485"><span class="doxyHighlight">                                           RTArgs, MapInfo,</span></CodeLine>
<Link id="l07486" /><CodeLine lineNumber="7486"><span class="doxyHighlight">                                           </span><span class="doxyHighlightComment">/&#42;IsNonContiguous=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07487" /><CodeLine lineNumber="7487"><span class="doxyHighlight">                                           </span><span class="doxyHighlightComment">/&#42;ForEndCall=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07488" /><CodeLine lineNumber="7488"></CodeLine>
<Link id="l07489" /><CodeLine lineNumber="7489"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 3&gt;</a> NumTeamsC;</span></CodeLine>
<Link id="l07490" /><CodeLine lineNumber="7490"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;<a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvmoduleanalysis-cpp/#a96647e6d55adc897b4c8e563f7b0168a">DefaultVal</a>, RuntimeVal&#93; :</span></CodeLine>
<Link id="l07491" /><CodeLine lineNumber="7491"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#a19010bf2388f505d1262e23f9f87a813">zip&#95;equal</a>(DefaultAttrs.MaxTeams, RuntimeAttrs.MaxTeams))</span></CodeLine>
<Link id="l07492" /><CodeLine lineNumber="7492"><span class="doxyHighlight">      NumTeamsC.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(RuntimeVal ? RuntimeVal</span></CodeLine>
<Link id="l07493" /><CodeLine lineNumber="7493"><span class="doxyHighlight">                                     : Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(<a href="/docs/api/files/lib/lib/target/lib/target/spirv/spirvmoduleanalysis-cpp/#a96647e6d55adc897b4c8e563f7b0168a">DefaultVal</a>));</span></CodeLine>
<Link id="l07494" /><CodeLine lineNumber="7494"></CodeLine>
<Link id="l07495" /><CodeLine lineNumber="7495"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Calculate number of threads: 0 if no clauses specified, otherwise it is</span></CodeLine>
<Link id="l07496" /><CodeLine lineNumber="7496"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the minimum between optional THREAD&#95;LIMIT and NUM&#95;THREADS clauses.</span></CodeLine>
<Link id="l07497" /><CodeLine lineNumber="7497"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InitMaxThreadsClause = &#91;&amp;Builder&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/clause">Clause</a>) &#123;</span></CodeLine>
<Link id="l07498" /><CodeLine lineNumber="7498"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/clause">Clause</a>)</span></CodeLine>
<Link id="l07499" /><CodeLine lineNumber="7499"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/clause">Clause</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac79ca3c2d2d74cf33684397a91846564">CreateIntCast</a>(<a href="/docs/api/classes/llvm/clause">Clause</a>, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(),</span></CodeLine>
<Link id="l07500" /><CodeLine lineNumber="7500"><span class="doxyHighlight">                                       </span><span class="doxyHighlightComment">/&#42;isSigned=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07501" /><CodeLine lineNumber="7501"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/clause">Clause</a>;</span></CodeLine>
<Link id="l07502" /><CodeLine lineNumber="7502"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l07503" /><CodeLine lineNumber="7503"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CombineMaxThreadsClauses = &#91;&amp;Builder&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/clause">Clause</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;<a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>) &#123;</span></CodeLine>
<Link id="l07504" /><CodeLine lineNumber="7504"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/clause">Clause</a>)</span></CodeLine>
<Link id="l07505" /><CodeLine lineNumber="7505"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> =</span></CodeLine>
<Link id="l07506" /><CodeLine lineNumber="7506"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> ? Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a09b4daefdf5b73efba51ce7ae6cd45c5">CreateICmpULT</a>(Result, <a href="/docs/api/classes/llvm/clause">Clause</a>),</span></CodeLine>
<Link id="l07507" /><CodeLine lineNumber="7507"><span class="doxyHighlight">                                          Result, <a href="/docs/api/classes/llvm/clause">Clause</a>)</span></CodeLine>
<Link id="l07508" /><CodeLine lineNumber="7508"><span class="doxyHighlight">                   : <a href="/docs/api/classes/llvm/clause">Clause</a>;</span></CodeLine>
<Link id="l07509" /><CodeLine lineNumber="7509"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l07510" /><CodeLine lineNumber="7510"></CodeLine>
<Link id="l07511" /><CodeLine lineNumber="7511"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If a multi-dimensional THREAD&#95;LIMIT is set, it is the OMPX&#95;BARE case, so</span></CodeLine>
<Link id="l07512" /><CodeLine lineNumber="7512"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the NUM&#95;THREADS clause is overriden by THREAD&#95;LIMIT.</span></CodeLine>
<Link id="l07513" /><CodeLine lineNumber="7513"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 3&gt;</a> NumThreadsC;</span></CodeLine>
<Link id="l07514" /><CodeLine lineNumber="7514"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;MaxThreadsClause =</span></CodeLine>
<Link id="l07515" /><CodeLine lineNumber="7515"><span class="doxyHighlight">        RuntimeAttrs.TeamsThreadLimit.size() == 1</span></CodeLine>
<Link id="l07516" /><CodeLine lineNumber="7516"><span class="doxyHighlight">            ? InitMaxThreadsClause(RuntimeAttrs.MaxThreads)</span></CodeLine>
<Link id="l07517" /><CodeLine lineNumber="7517"><span class="doxyHighlight">            : nullptr;</span></CodeLine>
<Link id="l07518" /><CodeLine lineNumber="7518"></CodeLine>
<Link id="l07519" /><CodeLine lineNumber="7519"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;TeamsVal, TargetVal&#93; : <a href="/docs/api/namespaces/llvm/#a19010bf2388f505d1262e23f9f87a813">zip&#95;equal</a>(</span></CodeLine>
<Link id="l07520" /><CodeLine lineNumber="7520"><span class="doxyHighlight">             RuntimeAttrs.TeamsThreadLimit, RuntimeAttrs.TargetThreadLimit)) &#123;</span></CodeLine>
<Link id="l07521" /><CodeLine lineNumber="7521"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;TeamsThreadLimitClause = InitMaxThreadsClause(TeamsVal);</span></CodeLine>
<Link id="l07522" /><CodeLine lineNumber="7522"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/anonymous-dxiltranslatemetadata-cpp-/#a727514c8260cb30e2d8c17e735a46580a97b726142463c564db260b0b7a67c584">NumThreads</a> = InitMaxThreadsClause(TargetVal);</span></CodeLine>
<Link id="l07523" /><CodeLine lineNumber="7523"></CodeLine>
<Link id="l07524" /><CodeLine lineNumber="7524"><span class="doxyHighlight">      CombineMaxThreadsClauses(TeamsThreadLimitClause, NumThreads);</span></CodeLine>
<Link id="l07525" /><CodeLine lineNumber="7525"><span class="doxyHighlight">      CombineMaxThreadsClauses(MaxThreadsClause, NumThreads);</span></CodeLine>
<Link id="l07526" /><CodeLine lineNumber="7526"></CodeLine>
<Link id="l07527" /><CodeLine lineNumber="7527"><span class="doxyHighlight">      NumThreadsC.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(NumThreads ? NumThreads : Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(0));</span></CodeLine>
<Link id="l07528" /><CodeLine lineNumber="7528"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07529" /><CodeLine lineNumber="7529"></CodeLine>
<Link id="l07530" /><CodeLine lineNumber="7530"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumTargetItems = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs;</span></CodeLine>
<Link id="l07531" /><CodeLine lineNumber="7531"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Use correct device ID</span></CodeLine>
<Link id="l07532" /><CodeLine lineNumber="7532"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;DeviceID = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(<a href="/docs/api/namespaces/llvm/omp/#a032f350e065d895f441c08affb57c2bea1e9b5a418e27440a8248a21894ff2932">OMP&#95;DEVICEID&#95;UNDEF</a>);</span></CodeLine>
<Link id="l07533" /><CodeLine lineNumber="7533"><span class="doxyHighlight">    uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l07534" /><CodeLine lineNumber="7534"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SrcLocStr = OMPBuilder.getOrCreateDefaultSrcLocStr(SrcLocStrSize);</span></CodeLine>
<Link id="l07535" /><CodeLine lineNumber="7535"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;RTLoc = OMPBuilder.getOrCreateIdent(SrcLocStr, SrcLocStrSize,</span></CodeLine>
<Link id="l07536" /><CodeLine lineNumber="7536"><span class="doxyHighlight">                                               <a href="/docs/api/namespaces/llvm/omp/#a0e821d8251c97d66ca185efe2f8ffde2">llvm::omp::IdentFlag</a>(0), 0);</span></CodeLine>
<Link id="l07537" /><CodeLine lineNumber="7537"></CodeLine>
<Link id="l07538" /><CodeLine lineNumber="7538"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;TripCount = RuntimeAttrs.LoopTripCount</span></CodeLine>
<Link id="l07539" /><CodeLine lineNumber="7539"><span class="doxyHighlight">                           ? Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac79ca3c2d2d74cf33684397a91846564">CreateIntCast</a>(RuntimeAttrs.LoopTripCount,</span></CodeLine>
<Link id="l07540" /><CodeLine lineNumber="7540"><span class="doxyHighlight">                                                   Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64748b5a9f8d8dd4499f84312e2c1336">getInt64Ty</a>(),</span></CodeLine>
<Link id="l07541" /><CodeLine lineNumber="7541"><span class="doxyHighlight">                                                   </span><span class="doxyHighlightComment">/&#42;isSigned=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l07542" /><CodeLine lineNumber="7542"><span class="doxyHighlight">                           : Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(0);</span></CodeLine>
<Link id="l07543" /><CodeLine lineNumber="7543"></CodeLine>
<Link id="l07544" /><CodeLine lineNumber="7544"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Use correct DynCGGroupMem</span></CodeLine>
<Link id="l07545" /><CodeLine lineNumber="7545"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;DynCGGroupMem = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(0);</span></CodeLine>
<Link id="l07546" /><CodeLine lineNumber="7546"></CodeLine>
<Link id="l07547" /><CodeLine lineNumber="7547"><span class="doxyHighlight">    KArgs = OpenMPIRBuilder::TargetKernelArgs(NumTargetItems, RTArgs, TripCount,</span></CodeLine>
<Link id="l07548" /><CodeLine lineNumber="7548"><span class="doxyHighlight">                                              NumTeamsC, NumThreadsC,</span></CodeLine>
<Link id="l07549" /><CodeLine lineNumber="7549"><span class="doxyHighlight">                                              DynCGGroupMem, HasNoWait);</span></CodeLine>
<Link id="l07550" /><CodeLine lineNumber="7550"></CodeLine>
<Link id="l07551" /><CodeLine lineNumber="7551"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Assume no error was returned because TaskBodyCB and</span></CodeLine>
<Link id="l07552" /><CodeLine lineNumber="7552"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// EmitTargetCallFallbackCB don&#39;t produce any.</span></CodeLine>
<Link id="l07553" /><CodeLine lineNumber="7553"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> AfterIP = <a href="/docs/api/namespaces/llvm/#aa1e1474f15df639f0d874b21f15666f7">cantFail</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l07554" /><CodeLine lineNumber="7554"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The presence of certain clauses on the target directive require the</span></CodeLine>
<Link id="l07555" /><CodeLine lineNumber="7555"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// explicit generation of the target task.</span></CodeLine>
<Link id="l07556" /><CodeLine lineNumber="7556"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RequiresOuterTargetTask)</span></CodeLine>
<Link id="l07557" /><CodeLine lineNumber="7557"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.emitTargetTask(TaskBodyCB, DeviceID, RTLoc, AllocaIP,</span></CodeLine>
<Link id="l07558" /><CodeLine lineNumber="7558"><span class="doxyHighlight">                                         Dependencies, HasNoWait);</span></CodeLine>
<Link id="l07559" /><CodeLine lineNumber="7559"></CodeLine>
<Link id="l07560" /><CodeLine lineNumber="7560"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OMPBuilder.emitKernelLaunch(Builder, OutlinedFnID,</span></CodeLine>
<Link id="l07561" /><CodeLine lineNumber="7561"><span class="doxyHighlight">                                         EmitTargetCallFallbackCB, KArgs,</span></CodeLine>
<Link id="l07562" /><CodeLine lineNumber="7562"><span class="doxyHighlight">                                         DeviceID, RTLoc, AllocaIP);</span></CodeLine>
<Link id="l07563" /><CodeLine lineNumber="7563"><span class="doxyHighlight">    &#125;());</span></CodeLine>
<Link id="l07564" /><CodeLine lineNumber="7564"></CodeLine>
<Link id="l07565" /><CodeLine lineNumber="7565"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AfterIP);</span></CodeLine>
<Link id="l07566" /><CodeLine lineNumber="7566"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l07567" /><CodeLine lineNumber="7567"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l07568" /><CodeLine lineNumber="7568"></CodeLine>
<Link id="l07569" /><CodeLine lineNumber="7569"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we don&#39;t have an ID for the target region, it means an offload entry</span></CodeLine>
<Link id="l07570" /><CodeLine lineNumber="7570"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// wasn&#39;t created. In this case we just run the host fallback directly and</span></CodeLine>
<Link id="l07571" /><CodeLine lineNumber="7571"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ignore any potential &#39;if&#39; clauses.</span></CodeLine>
<Link id="l07572" /><CodeLine lineNumber="7572"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OutlinedFnID) &#123;</span></CodeLine>
<Link id="l07573" /><CodeLine lineNumber="7573"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aa1e1474f15df639f0d874b21f15666f7">cantFail</a>(EmitTargetCallElse(AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>()));</span></CodeLine>
<Link id="l07574" /><CodeLine lineNumber="7574"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07575" /><CodeLine lineNumber="7575"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07576" /><CodeLine lineNumber="7576"></CodeLine>
<Link id="l07577" /><CodeLine lineNumber="7577"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there&#39;s no &#39;if&#39; clause, only generate the kernel launch code path.</span></CodeLine>
<Link id="l07578" /><CodeLine lineNumber="7578"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IfCond) &#123;</span></CodeLine>
<Link id="l07579" /><CodeLine lineNumber="7579"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aa1e1474f15df639f0d874b21f15666f7">cantFail</a>(EmitTargetCallThen(AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>()));</span></CodeLine>
<Link id="l07580" /><CodeLine lineNumber="7580"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07581" /><CodeLine lineNumber="7581"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07582" /><CodeLine lineNumber="7582"></CodeLine>
<Link id="l07583" /><CodeLine lineNumber="7583"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aa1e1474f15df639f0d874b21f15666f7">cantFail</a>(OMPBuilder.emitIfClause(IfCond, EmitTargetCallThen,</span></CodeLine>
<Link id="l07584" /><CodeLine lineNumber="7584"><span class="doxyHighlight">                                   EmitTargetCallElse, AllocaIP));</span></CodeLine>
<Link id="l07585" /><CodeLine lineNumber="7585"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07586" /><CodeLine lineNumber="7586"></CodeLine>
<Link id="l07587" /><CodeLine lineNumber="7587"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> OpenMPIRBuilder::createTarget(</span></CodeLine>
<Link id="l07588" /><CodeLine lineNumber="7588"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsOffloadEntry, InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l07589" /><CodeLine lineNumber="7589"><span class="doxyHighlight">    InsertPointTy CodeGenIP, <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> &amp;EntryInfo,</span></CodeLine>
<Link id="l07590" /><CodeLine lineNumber="7590"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> TargetKernelDefaultAttrs &amp;DefaultAttrs,</span></CodeLine>
<Link id="l07591" /><CodeLine lineNumber="7591"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> TargetKernelRuntimeAttrs &amp;RuntimeAttrs, <a href="/docs/api/classes/llvm/value">Value</a> &#42;IfCond,</span></CodeLine>
<Link id="l07592" /><CodeLine lineNumber="7592"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Value &#42;&gt;</a> &amp;Args, GenMapInfoCallbackTy GenMapInfoCB,</span></CodeLine>
<Link id="l07593" /><CodeLine lineNumber="7593"><span class="doxyHighlight">    OpenMPIRBuilder::TargetBodyGenCallbackTy CBFunc,</span></CodeLine>
<Link id="l07594" /><CodeLine lineNumber="7594"><span class="doxyHighlight">    OpenMPIRBuilder::TargetGenArgAccessorsCallbackTy ArgAccessorFuncCB,</span></CodeLine>
<Link id="l07595" /><CodeLine lineNumber="7595"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DependData&gt;</a> Dependencies, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasNowait) &#123;</span></CodeLine>
<Link id="l07596" /><CodeLine lineNumber="7596"></CodeLine>
<Link id="l07597" /><CodeLine lineNumber="7597"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l07598" /><CodeLine lineNumber="7598"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>();</span></CodeLine>
<Link id="l07599" /><CodeLine lineNumber="7599"></CodeLine>
<Link id="l07600" /><CodeLine lineNumber="7600"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l07601" /><CodeLine lineNumber="7601"></CodeLine>
<Link id="l07602" /><CodeLine lineNumber="7602"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;OutlinedFn;</span></CodeLine>
<Link id="l07603" /><CodeLine lineNumber="7603"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/omp/#a8c6f525466cc262e00c409c31f9a4272acb17869fe51048b5a5c4c6106551a255">Constant</a> &#42;OutlinedFnID = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07604" /><CodeLine lineNumber="7604"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The target region is outlined into its own function. The LLVM IR for</span></CodeLine>
<Link id="l07605" /><CodeLine lineNumber="7605"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the target region itself is generated using the callbacks CBFunc</span></CodeLine>
<Link id="l07606" /><CodeLine lineNumber="7606"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and ArgAccessorFuncCB</span></CodeLine>
<Link id="l07607" /><CodeLine lineNumber="7607"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = <a href="#aa33db5ef74d376fb331f9549fb3cd9b3">emitTargetOutlinedFunction</a>(</span></CodeLine>
<Link id="l07608" /><CodeLine lineNumber="7608"><span class="doxyHighlight">          &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, Builder, IsOffloadEntry, EntryInfo, DefaultAttrs, OutlinedFn,</span></CodeLine>
<Link id="l07609" /><CodeLine lineNumber="7609"><span class="doxyHighlight">          OutlinedFnID, Args, CBFunc, ArgAccessorFuncCB))</span></CodeLine>
<Link id="l07610" /><CodeLine lineNumber="7610"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l07611" /><CodeLine lineNumber="7611"></CodeLine>
<Link id="l07612" /><CodeLine lineNumber="7612"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are not on the target device, then we need to generate code</span></CodeLine>
<Link id="l07613" /><CodeLine lineNumber="7613"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to make a remote call (offload) to the previously outlined function</span></CodeLine>
<Link id="l07614" /><CodeLine lineNumber="7614"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that represents the target region. Do that now.</span></CodeLine>
<Link id="l07615" /><CodeLine lineNumber="7615"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Config.isTargetDevice())</span></CodeLine>
<Link id="l07616" /><CodeLine lineNumber="7616"><span class="doxyHighlight">    <a href="#a9acb4faf91112542d5ecf41230e9b64a">emitTargetCall</a>(&#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, Builder, AllocaIP, DefaultAttrs, RuntimeAttrs, IfCond,</span></CodeLine>
<Link id="l07617" /><CodeLine lineNumber="7617"><span class="doxyHighlight">                   OutlinedFn, OutlinedFnID, Args, GenMapInfoCB, Dependencies,</span></CodeLine>
<Link id="l07618" /><CodeLine lineNumber="7618"><span class="doxyHighlight">                   HasNowait);</span></CodeLine>
<Link id="l07619" /><CodeLine lineNumber="7619"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l07620" /><CodeLine lineNumber="7620"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07621" /><CodeLine lineNumber="7621"></CodeLine>
<Link id="l07622" /><CodeLine lineNumber="7622"><span class="doxyHighlight">std::string OpenMPIRBuilder::getNameWithSeparators(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;StringRef&gt;</a> Parts,</span></CodeLine>
<Link id="l07623" /><CodeLine lineNumber="7623"><span class="doxyHighlight">                                                   <a href="/docs/api/classes/llvm/stringref">StringRef</a> FirstSeparator,</span></CodeLine>
<Link id="l07624" /><CodeLine lineNumber="7624"><span class="doxyHighlight">                                                   <a href="/docs/api/classes/llvm/stringref">StringRef</a> Separator) &#123;</span></CodeLine>
<Link id="l07625" /><CodeLine lineNumber="7625"><span class="doxyHighlight">  SmallString&lt;128&gt; Buffer;</span></CodeLine>
<Link id="l07626" /><CodeLine lineNumber="7626"><span class="doxyHighlight">  llvm::raw&#95;svector&#95;ostream OS(Buffer);</span></CodeLine>
<Link id="l07627" /><CodeLine lineNumber="7627"><span class="doxyHighlight">  StringRef Sep = FirstSeparator;</span></CodeLine>
<Link id="l07628" /><CodeLine lineNumber="7628"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (StringRef Part : Parts) &#123;</span></CodeLine>
<Link id="l07629" /><CodeLine lineNumber="7629"><span class="doxyHighlight">    OS &lt;&lt; Sep &lt;&lt; Part;</span></CodeLine>
<Link id="l07630" /><CodeLine lineNumber="7630"><span class="doxyHighlight">    Sep = Separator;</span></CodeLine>
<Link id="l07631" /><CodeLine lineNumber="7631"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07632" /><CodeLine lineNumber="7632"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OS.<a href="/docs/api/classes/llvm/stringref/#a223dd14e7d12bc5cea01889b972a98b2">str</a>().str();</span></CodeLine>
<Link id="l07633" /><CodeLine lineNumber="7633"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07634" /><CodeLine lineNumber="7634"></CodeLine>
<Link id="l07635" /><CodeLine lineNumber="7635"><span class="doxyHighlight">std::string</span></CodeLine>
<Link id="l07636" /><CodeLine lineNumber="7636" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a488c861f8a68e5f78ceca8b57acd8be5"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#a488c861f8a68e5f78ceca8b57acd8be5">OpenMPIRBuilder::createPlatformSpecificName</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;StringRef&gt;</a> Parts)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l07637" /><CodeLine lineNumber="7637"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OpenMPIRBuilder::getNameWithSeparators(Parts, Config.firstSeparator(),</span></CodeLine>
<Link id="l07638" /><CodeLine lineNumber="7638"><span class="doxyHighlight">                                                Config.separator());</span></CodeLine>
<Link id="l07639" /><CodeLine lineNumber="7639"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07640" /><CodeLine lineNumber="7640"></CodeLine>
<Link id="l07641" /><CodeLine lineNumber="7641"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;</span></CodeLine>
<Link id="l07642" /><CodeLine lineNumber="7642" lineLink="/docs/api/classes/llvm/openmpirbuilder/#aa5ef00e5a7487cc6c5bfed0f301fa1cc"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#aa5ef00e5a7487cc6c5bfed0f301fa1cc">OpenMPIRBuilder::getOrCreateInternalVariable</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> &amp;Name,</span></CodeLine>
<Link id="l07643" /><CodeLine lineNumber="7643"><span class="doxyHighlight">                                             </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/nvptxas/#ad7d00b71af84502be65ae2de3f8d91dc">AddressSpace</a>) &#123;</span></CodeLine>
<Link id="l07644" /><CodeLine lineNumber="7644"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Elem = &#42;InternalVars.try&#95;emplace(Name, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">).first;</span></CodeLine>
<Link id="l07645" /><CodeLine lineNumber="7645"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Elem.second) &#123;</span></CodeLine>
<Link id="l07646" /><CodeLine lineNumber="7646"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Elem.second-&gt;getValueType() == Ty &amp;&amp;</span></CodeLine>
<Link id="l07647" /><CodeLine lineNumber="7647"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;OMP internal variable has different type than requested&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07648" /><CodeLine lineNumber="7648"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07649" /><CodeLine lineNumber="7649"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: investigate the appropriate linkage type used for the global</span></CodeLine>
<Link id="l07650" /><CodeLine lineNumber="7650"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// variable for possibly changing that to internal or private, or maybe</span></CodeLine>
<Link id="l07651" /><CodeLine lineNumber="7651"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// create different versions of the function for different OMP internal</span></CodeLine>
<Link id="l07652" /><CodeLine lineNumber="7652"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// variables.</span></CodeLine>
<Link id="l07653" /><CodeLine lineNumber="7653"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Linkage = this-&gt;M.<a href="/docs/api/classes/llvm/module/#a6b882824580b4666f692474ecbae56ad">getTargetTriple</a>().rfind(</span><span class="doxyHighlightStringLiteral">&quot;wasm32&quot;</span><span class="doxyHighlight">) == 0</span></CodeLine>
<Link id="l07654" /><CodeLine lineNumber="7654"><span class="doxyHighlight">                       ? <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a></span></CodeLine>
<Link id="l07655" /><CodeLine lineNumber="7655"><span class="doxyHighlight">                       : <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca08c6a63ca3d9cdb39fb584655bf5c501">GlobalValue::CommonLinkage</a>;</span></CodeLine>
<Link id="l07656" /><CodeLine lineNumber="7656"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/structs/llvm/omp/gv">GV</a> = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(M, Ty, </span><span class="doxyHighlightComment">/&#42;IsConstant=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, Linkage,</span></CodeLine>
<Link id="l07657" /><CodeLine lineNumber="7657"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Ty), Elem.first(),</span></CodeLine>
<Link id="l07658" /><CodeLine lineNumber="7658"><span class="doxyHighlight">                                  </span><span class="doxyHighlightComment">/&#42;InsertBefore=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07659" /><CodeLine lineNumber="7659"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/globalvalue/#a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0">GlobalValue::NotThreadLocal</a>, <a href="/docs/api/namespaces/llvm/nvptxas/#ad7d00b71af84502be65ae2de3f8d91dc">AddressSpace</a>);</span></CodeLine>
<Link id="l07660" /><CodeLine lineNumber="7660"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = M.getDataLayout();</span></CodeLine>
<Link id="l07661" /><CodeLine lineNumber="7661"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/align">llvm::Align</a> TypeAlign = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getABITypeAlign(Ty);</span></CodeLine>
<Link id="l07662" /><CodeLine lineNumber="7662"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/align">llvm::Align</a> PtrAlign = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getPointerABIAlignment(<a href="/docs/api/namespaces/llvm/nvptxas/#ad7d00b71af84502be65ae2de3f8d91dc">AddressSpace</a>);</span></CodeLine>
<Link id="l07663" /><CodeLine lineNumber="7663"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/omp/gv">GV</a>-&gt;setAlignment(std::max(TypeAlign, PtrAlign));</span></CodeLine>
<Link id="l07664" /><CodeLine lineNumber="7664"><span class="doxyHighlight">    Elem.second = <a href="/docs/api/structs/llvm/omp/gv">GV</a>;</span></CodeLine>
<Link id="l07665" /><CodeLine lineNumber="7665"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07666" /><CodeLine lineNumber="7666"></CodeLine>
<Link id="l07667" /><CodeLine lineNumber="7667"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Elem.second;</span></CodeLine>
<Link id="l07668" /><CodeLine lineNumber="7668"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07669" /><CodeLine lineNumber="7669"></CodeLine>
<Link id="l07670" /><CodeLine lineNumber="7670"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;OpenMPIRBuilder::getOMPCriticalRegionLock(<a href="/docs/api/classes/llvm/stringref">StringRef</a> CriticalName) &#123;</span></CodeLine>
<Link id="l07671" /><CodeLine lineNumber="7671"><span class="doxyHighlight">  std::string Prefix = <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;gomp&#95;critical&#95;user&#95;&quot;</span><span class="doxyHighlight">, CriticalName).<a href="/docs/api/classes/llvm/twine/#a4c1c1093a7749409c70838678514cc7c">str</a>();</span></CodeLine>
<Link id="l07672" /><CodeLine lineNumber="7672"><span class="doxyHighlight">  std::string Name = getNameWithSeparators(&#123;Prefix, </span><span class="doxyHighlightStringLiteral">&quot;var&quot;</span><span class="doxyHighlight">&#125;, </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07673" /><CodeLine lineNumber="7673"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aa5ef00e5a7487cc6c5bfed0f301fa1cc">getOrCreateInternalVariable</a>(KmpCriticalNameTy, Name);</span></CodeLine>
<Link id="l07674" /><CodeLine lineNumber="7674"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07675" /><CodeLine lineNumber="7675"></CodeLine>
<Link id="l07676" /><CodeLine lineNumber="7676"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;OpenMPIRBuilder::getSizeInBytes(<a href="/docs/api/classes/llvm/value">Value</a> &#42;BasePtr) &#123;</span></CodeLine>
<Link id="l07677" /><CodeLine lineNumber="7677"><span class="doxyHighlight">  LLVMContext &amp;Ctx = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>();</span></CodeLine>
<Link id="l07678" /><CodeLine lineNumber="7678"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a73b761f8d40500a5a28889569526b260abbb93ef26e3c101ff11cdd21cab08a94">Null</a> =</span></CodeLine>
<Link id="l07679" /><CodeLine lineNumber="7679"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(<a href="/docs/api/namespaces/llvm/codeview/#aa8c11d016a2dd473a4cf0ed1da777f5ea67f23a49a4828b272554feea07834f7d">BasePtr</a>-&gt;getContext()));</span></CodeLine>
<Link id="l07680" /><CodeLine lineNumber="7680"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SizeGep =</span></CodeLine>
<Link id="l07681" /><CodeLine lineNumber="7681"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(<a href="/docs/api/namespaces/llvm/codeview/#aa8c11d016a2dd473a4cf0ed1da777f5ea67f23a49a4828b272554feea07834f7d">BasePtr</a>-&gt;getType(), <a href="/docs/api/namespaces/llvm/#a73b761f8d40500a5a28889569526b260abbb93ef26e3c101ff11cdd21cab08a94">Null</a>, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(1));</span></CodeLine>
<Link id="l07682" /><CodeLine lineNumber="7682"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SizePtrToInt = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aae2c1bf70058f3665edaec525457030c">CreatePtrToInt</a>(SizeGep, <a href="/docs/api/classes/llvm/type/#a05186fa23e4d11b9855a9599ba87a4b7">Type::getInt64Ty</a>(Ctx));</span></CodeLine>
<Link id="l07683" /><CodeLine lineNumber="7683"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SizePtrToInt;</span></CodeLine>
<Link id="l07684" /><CodeLine lineNumber="7684"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07685" /><CodeLine lineNumber="7685"></CodeLine>
<Link id="l07686" /><CodeLine lineNumber="7686"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;</span></CodeLine>
<Link id="l07687" /><CodeLine lineNumber="7687"><span class="doxyHighlight">OpenMPIRBuilder::createOffloadMaptypes(<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;uint64&#95;t&gt;</a> &amp;Mappings,</span></CodeLine>
<Link id="l07688" /><CodeLine lineNumber="7688"><span class="doxyHighlight">                                       std::string VarName) &#123;</span></CodeLine>
<Link id="l07689" /><CodeLine lineNumber="7689"><span class="doxyHighlight">  llvm::Constant &#42;MaptypesArrayInit =</span></CodeLine>
<Link id="l07690" /><CodeLine lineNumber="7690"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantdataarray/#a4a1000e5803e731e9dcc572042a98a0b">llvm::ConstantDataArray::get</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), Mappings);</span></CodeLine>
<Link id="l07691" /><CodeLine lineNumber="7691"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MaptypesArrayGlobal = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> llvm::GlobalVariable(</span></CodeLine>
<Link id="l07692" /><CodeLine lineNumber="7692"><span class="doxyHighlight">      M, MaptypesArrayInit-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l07693" /><CodeLine lineNumber="7693"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;isConstant=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca04ed141708c0fd16723d212502b046ae">llvm::GlobalValue::PrivateLinkage</a>, MaptypesArrayInit,</span></CodeLine>
<Link id="l07694" /><CodeLine lineNumber="7694"><span class="doxyHighlight">      VarName);</span></CodeLine>
<Link id="l07695" /><CodeLine lineNumber="7695"><span class="doxyHighlight">  MaptypesArrayGlobal-&gt;setUnnamedAddr(<a href="/docs/api/classes/llvm/globalvalue/#ae8df4be75bfc50b1eadd74e85c25fa45a4cc6684df7b4a92b1dec6fce3264fac8">llvm::GlobalValue::UnnamedAddr::Global</a>);</span></CodeLine>
<Link id="l07696" /><CodeLine lineNumber="7696"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MaptypesArrayGlobal;</span></CodeLine>
<Link id="l07697" /><CodeLine lineNumber="7697"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07698" /><CodeLine lineNumber="7698"></CodeLine>
<Link id="l07699" /><CodeLine lineNumber="7699"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::createMapperAllocas(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l07700" /><CodeLine lineNumber="7700"><span class="doxyHighlight">                                          InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l07701" /><CodeLine lineNumber="7701"><span class="doxyHighlight">                                          </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumOperands,</span></CodeLine>
<Link id="l07702" /><CodeLine lineNumber="7702"><span class="doxyHighlight">                                          </span><span class="doxyHighlightKeyword">struct</span><span class="doxyHighlight"> MapperAllocas &amp;MapperAllocas) &#123;</span></CodeLine>
<Link id="l07703" /><CodeLine lineNumber="7703"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l07704" /><CodeLine lineNumber="7704"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07705" /><CodeLine lineNumber="7705"></CodeLine>
<Link id="l07706" /><CodeLine lineNumber="7706"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ArrI8PtrTy = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Int8Ptr, NumOperands);</span></CodeLine>
<Link id="l07707" /><CodeLine lineNumber="7707"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ArrI64Ty = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872ada475947399b8ab4d13d40fea50f950c">Int64</a>, NumOperands);</span></CodeLine>
<Link id="l07708" /><CodeLine lineNumber="7708"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l07709" /><CodeLine lineNumber="7709"><span class="doxyHighlight">  AllocaInst &#42;ArgsBase = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l07710" /><CodeLine lineNumber="7710"><span class="doxyHighlight">      ArrI8PtrTy, </span><span class="doxyHighlightComment">/&#42; ArraySize = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.offload&#95;baseptrs&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07711" /><CodeLine lineNumber="7711"><span class="doxyHighlight">  AllocaInst &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(ArrI8PtrTy, </span><span class="doxyHighlightComment">/&#42; ArraySize = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07712" /><CodeLine lineNumber="7712"><span class="doxyHighlight">                                          </span><span class="doxyHighlightStringLiteral">&quot;.offload&#95;ptrs&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07713" /><CodeLine lineNumber="7713"><span class="doxyHighlight">  AllocaInst &#42;ArgSizes = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l07714" /><CodeLine lineNumber="7714"><span class="doxyHighlight">      ArrI64Ty, </span><span class="doxyHighlightComment">/&#42; ArraySize = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.offload&#95;sizes&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07715" /><CodeLine lineNumber="7715"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(Loc.IP);</span></CodeLine>
<Link id="l07716" /><CodeLine lineNumber="7716"><span class="doxyHighlight">  MapperAllocas.ArgsBase = ArgsBase;</span></CodeLine>
<Link id="l07717" /><CodeLine lineNumber="7717"><span class="doxyHighlight">  MapperAllocas.Args = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>;</span></CodeLine>
<Link id="l07718" /><CodeLine lineNumber="7718"><span class="doxyHighlight">  MapperAllocas.ArgSizes = ArgSizes;</span></CodeLine>
<Link id="l07719" /><CodeLine lineNumber="7719"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07720" /><CodeLine lineNumber="7720"></CodeLine>
<Link id="l07721" /><CodeLine lineNumber="7721"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitMapperCall(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l07722" /><CodeLine lineNumber="7722"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/function">Function</a> &#42;MapperFunc, <a href="/docs/api/classes/llvm/value">Value</a> &#42;SrcLocInfo,</span></CodeLine>
<Link id="l07723" /><CodeLine lineNumber="7723"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/value">Value</a> &#42;MaptypesArg, <a href="/docs/api/classes/llvm/value">Value</a> &#42;MapnamesArg,</span></CodeLine>
<Link id="l07724" /><CodeLine lineNumber="7724"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeyword">struct</span><span class="doxyHighlight"> MapperAllocas &amp;MapperAllocas,</span></CodeLine>
<Link id="l07725" /><CodeLine lineNumber="7725"><span class="doxyHighlight">                                     int64&#95;t DeviceID, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumOperands) &#123;</span></CodeLine>
<Link id="l07726" /><CodeLine lineNumber="7726"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l07727" /><CodeLine lineNumber="7727"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07728" /><CodeLine lineNumber="7728"></CodeLine>
<Link id="l07729" /><CodeLine lineNumber="7729"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ArrI8PtrTy = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Int8Ptr, NumOperands);</span></CodeLine>
<Link id="l07730" /><CodeLine lineNumber="7730"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ArrI64Ty = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872ada475947399b8ab4d13d40fea50f950c">Int64</a>, NumOperands);</span></CodeLine>
<Link id="l07731" /><CodeLine lineNumber="7731"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ArgsBaseGEP =</span></CodeLine>
<Link id="l07732" /><CodeLine lineNumber="7732"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(ArrI8PtrTy, MapperAllocas.ArgsBase,</span></CodeLine>
<Link id="l07733" /><CodeLine lineNumber="7733"><span class="doxyHighlight">                                &#123;Builder.getInt32(0), Builder.getInt32(0)&#125;);</span></CodeLine>
<Link id="l07734" /><CodeLine lineNumber="7734"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ArgsGEP =</span></CodeLine>
<Link id="l07735" /><CodeLine lineNumber="7735"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(ArrI8PtrTy, MapperAllocas.Args,</span></CodeLine>
<Link id="l07736" /><CodeLine lineNumber="7736"><span class="doxyHighlight">                                &#123;Builder.getInt32(0), Builder.getInt32(0)&#125;);</span></CodeLine>
<Link id="l07737" /><CodeLine lineNumber="7737"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ArgSizesGEP =</span></CodeLine>
<Link id="l07738" /><CodeLine lineNumber="7738"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(ArrI64Ty, MapperAllocas.ArgSizes,</span></CodeLine>
<Link id="l07739" /><CodeLine lineNumber="7739"><span class="doxyHighlight">                                &#123;Builder.getInt32(0), Builder.getInt32(0)&#125;);</span></CodeLine>
<Link id="l07740" /><CodeLine lineNumber="7740"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NullPtr =</span></CodeLine>
<Link id="l07741" /><CodeLine lineNumber="7741"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(Int8Ptr-&gt;getContext()));</span></CodeLine>
<Link id="l07742" /><CodeLine lineNumber="7742"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(MapperFunc,</span></CodeLine>
<Link id="l07743" /><CodeLine lineNumber="7743"><span class="doxyHighlight">                     &#123;SrcLocInfo, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(DeviceID),</span></CodeLine>
<Link id="l07744" /><CodeLine lineNumber="7744"><span class="doxyHighlight">                      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(NumOperands), ArgsBaseGEP, ArgsGEP,</span></CodeLine>
<Link id="l07745" /><CodeLine lineNumber="7745"><span class="doxyHighlight">                      ArgSizesGEP, MaptypesArg, MapnamesArg, NullPtr&#125;);</span></CodeLine>
<Link id="l07746" /><CodeLine lineNumber="7746"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07747" /><CodeLine lineNumber="7747"></CodeLine>
<Link id="l07748" /><CodeLine lineNumber="7748"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitOffloadingArraysArgument(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;Builder,</span></CodeLine>
<Link id="l07749" /><CodeLine lineNumber="7749"><span class="doxyHighlight">                                                   TargetDataRTArgs &amp;RTArgs,</span></CodeLine>
<Link id="l07750" /><CodeLine lineNumber="7750"><span class="doxyHighlight">                                                   TargetDataInfo &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>,</span></CodeLine>
<Link id="l07751" /><CodeLine lineNumber="7751"><span class="doxyHighlight">                                                   </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ForEndCall) &#123;</span></CodeLine>
<Link id="l07752" /><CodeLine lineNumber="7752"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!ForEndCall || <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.separateBeginEndCalls()) &amp;&amp;</span></CodeLine>
<Link id="l07753" /><CodeLine lineNumber="7753"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;expected region end call to runtime only when end call is separate&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07754" /><CodeLine lineNumber="7754"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> UnqualPtrTy = <a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext());</span></CodeLine>
<Link id="l07755" /><CodeLine lineNumber="7755"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> VoidPtrTy = UnqualPtrTy;</span></CodeLine>
<Link id="l07756" /><CodeLine lineNumber="7756"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> VoidPtrPtrTy = UnqualPtrTy;</span></CodeLine>
<Link id="l07757" /><CodeLine lineNumber="7757"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Int64Ty = <a href="/docs/api/classes/llvm/type/#a05186fa23e4d11b9855a9599ba87a4b7">Type::getInt64Ty</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext());</span></CodeLine>
<Link id="l07758" /><CodeLine lineNumber="7758"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Int64PtrTy = UnqualPtrTy;</span></CodeLine>
<Link id="l07759" /><CodeLine lineNumber="7759"></CodeLine>
<Link id="l07760" /><CodeLine lineNumber="7760"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs) &#123;</span></CodeLine>
<Link id="l07761" /><CodeLine lineNumber="7761"><span class="doxyHighlight">    RTArgs.BasePointersArray = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(VoidPtrPtrTy);</span></CodeLine>
<Link id="l07762" /><CodeLine lineNumber="7762"><span class="doxyHighlight">    RTArgs.PointersArray = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(VoidPtrPtrTy);</span></CodeLine>
<Link id="l07763" /><CodeLine lineNumber="7763"><span class="doxyHighlight">    RTArgs.SizesArray = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(Int64PtrTy);</span></CodeLine>
<Link id="l07764" /><CodeLine lineNumber="7764"><span class="doxyHighlight">    RTArgs.MapTypesArray = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(Int64PtrTy);</span></CodeLine>
<Link id="l07765" /><CodeLine lineNumber="7765"><span class="doxyHighlight">    RTArgs.MapNamesArray = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(VoidPtrPtrTy);</span></CodeLine>
<Link id="l07766" /><CodeLine lineNumber="7766"><span class="doxyHighlight">    RTArgs.MappersArray = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(VoidPtrPtrTy);</span></CodeLine>
<Link id="l07767" /><CodeLine lineNumber="7767"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07768" /><CodeLine lineNumber="7768"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07769" /><CodeLine lineNumber="7769"></CodeLine>
<Link id="l07770" /><CodeLine lineNumber="7770"><span class="doxyHighlight">  RTArgs.BasePointersArray = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l07771" /><CodeLine lineNumber="7771"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(VoidPtrTy, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs),</span></CodeLine>
<Link id="l07772" /><CodeLine lineNumber="7772"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.BasePointersArray,</span></CodeLine>
<Link id="l07773" /><CodeLine lineNumber="7773"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;Idx0=&#42;/</span><span class="doxyHighlight">0, </span><span class="doxyHighlightComment">/&#42;Idx1=&#42;/</span><span class="doxyHighlight">0);</span></CodeLine>
<Link id="l07774" /><CodeLine lineNumber="7774"><span class="doxyHighlight">  RTArgs.PointersArray = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l07775" /><CodeLine lineNumber="7775"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(VoidPtrTy, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs), <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.PointersArray,</span></CodeLine>
<Link id="l07776" /><CodeLine lineNumber="7776"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;Idx0=&#42;/</span><span class="doxyHighlight">0,</span></CodeLine>
<Link id="l07777" /><CodeLine lineNumber="7777"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;Idx1=&#42;/</span><span class="doxyHighlight">0);</span></CodeLine>
<Link id="l07778" /><CodeLine lineNumber="7778"><span class="doxyHighlight">  RTArgs.SizesArray = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l07779" /><CodeLine lineNumber="7779"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Int64Ty, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs), <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.SizesArray,</span></CodeLine>
<Link id="l07780" /><CodeLine lineNumber="7780"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;Idx0=&#42;/</span><span class="doxyHighlight">0, </span><span class="doxyHighlightComment">/&#42;Idx1=&#42;/</span><span class="doxyHighlight">0);</span></CodeLine>
<Link id="l07781" /><CodeLine lineNumber="7781"><span class="doxyHighlight">  RTArgs.MapTypesArray = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l07782" /><CodeLine lineNumber="7782"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Int64Ty, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs),</span></CodeLine>
<Link id="l07783" /><CodeLine lineNumber="7783"><span class="doxyHighlight">      ForEndCall &amp;&amp; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.MapTypesArrayEnd ? <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.MapTypesArrayEnd</span></CodeLine>
<Link id="l07784" /><CodeLine lineNumber="7784"><span class="doxyHighlight">                                                 : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.MapTypesArray,</span></CodeLine>
<Link id="l07785" /><CodeLine lineNumber="7785"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;Idx0=&#42;/</span><span class="doxyHighlight">0,</span></CodeLine>
<Link id="l07786" /><CodeLine lineNumber="7786"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;Idx1=&#42;/</span><span class="doxyHighlight">0);</span></CodeLine>
<Link id="l07787" /><CodeLine lineNumber="7787"></CodeLine>
<Link id="l07788" /><CodeLine lineNumber="7788"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only emit the mapper information arrays if debug information is</span></CodeLine>
<Link id="l07789" /><CodeLine lineNumber="7789"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// requested.</span></CodeLine>
<Link id="l07790" /><CodeLine lineNumber="7790"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.EmitDebug)</span></CodeLine>
<Link id="l07791" /><CodeLine lineNumber="7791"><span class="doxyHighlight">    RTArgs.MapNamesArray = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(VoidPtrPtrTy);</span></CodeLine>
<Link id="l07792" /><CodeLine lineNumber="7792"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l07793" /><CodeLine lineNumber="7793"><span class="doxyHighlight">    RTArgs.MapNamesArray = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l07794" /><CodeLine lineNumber="7794"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(VoidPtrTy, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs), <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.MapNamesArray,</span></CodeLine>
<Link id="l07795" /><CodeLine lineNumber="7795"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;Idx0=&#42;/</span><span class="doxyHighlight">0,</span></CodeLine>
<Link id="l07796" /><CodeLine lineNumber="7796"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;Idx1=&#42;/</span><span class="doxyHighlight">0);</span></CodeLine>
<Link id="l07797" /><CodeLine lineNumber="7797"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is no user-defined mapper, set the mapper array to nullptr to</span></CodeLine>
<Link id="l07798" /><CodeLine lineNumber="7798"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// avoid an unnecessary data privatization</span></CodeLine>
<Link id="l07799" /><CodeLine lineNumber="7799"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.HasMapper)</span></CodeLine>
<Link id="l07800" /><CodeLine lineNumber="7800"><span class="doxyHighlight">    RTArgs.MappersArray = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(VoidPtrPtrTy);</span></CodeLine>
<Link id="l07801" /><CodeLine lineNumber="7801"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l07802" /><CodeLine lineNumber="7802"><span class="doxyHighlight">    RTArgs.MappersArray =</span></CodeLine>
<Link id="l07803" /><CodeLine lineNumber="7803"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3ef26a11123d639b64307cc3c1b869b9">CreatePointerCast</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.MappersArray, VoidPtrPtrTy);</span></CodeLine>
<Link id="l07804" /><CodeLine lineNumber="7804"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07805" /><CodeLine lineNumber="7805"></CodeLine>
<Link id="l07806" /><CodeLine lineNumber="7806"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitNonContiguousDescriptor(InsertPointTy AllocaIP,</span></CodeLine>
<Link id="l07807" /><CodeLine lineNumber="7807"><span class="doxyHighlight">                                                  InsertPointTy CodeGenIP,</span></CodeLine>
<Link id="l07808" /><CodeLine lineNumber="7808"><span class="doxyHighlight">                                                  MapInfosTy &amp;CombinedInfo,</span></CodeLine>
<Link id="l07809" /><CodeLine lineNumber="7809"><span class="doxyHighlight">                                                  TargetDataInfo &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>) &#123;</span></CodeLine>
<Link id="l07810" /><CodeLine lineNumber="7810"><span class="doxyHighlight">  MapInfosTy::StructNonContiguousInfo &amp;NonContigInfo =</span></CodeLine>
<Link id="l07811" /><CodeLine lineNumber="7811"><span class="doxyHighlight">      CombinedInfo.NonContigInfo;</span></CodeLine>
<Link id="l07812" /><CodeLine lineNumber="7812"></CodeLine>
<Link id="l07813" /><CodeLine lineNumber="7813"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build an array of struct descriptor&#95;dim and then assign it to</span></CodeLine>
<Link id="l07814" /><CodeLine lineNumber="7814"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// offload&#95;args.</span></CodeLine>
<Link id="l07815" /><CodeLine lineNumber="7815"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07816" /><CodeLine lineNumber="7816"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// struct descriptor&#95;dim &#123;</span></CodeLine>
<Link id="l07817" /><CodeLine lineNumber="7817"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  uint64&#95;t offset;</span></CodeLine>
<Link id="l07818" /><CodeLine lineNumber="7818"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  uint64&#95;t count;</span></CodeLine>
<Link id="l07819" /><CodeLine lineNumber="7819"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  uint64&#95;t stride</span></CodeLine>
<Link id="l07820" /><CodeLine lineNumber="7820"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#125;;</span></CodeLine>
<Link id="l07821" /><CodeLine lineNumber="7821"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Int64Ty = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64748b5a9f8d8dd4499f84312e2c1336">getInt64Ty</a>();</span></CodeLine>
<Link id="l07822" /><CodeLine lineNumber="7822"><span class="doxyHighlight">  StructType &#42;DimTy = <a href="/docs/api/classes/llvm/structtype/#a82648246c07eb8a33f628eea28cb988c">StructType::create</a>(</span></CodeLine>
<Link id="l07823" /><CodeLine lineNumber="7823"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;Type &#42;&gt;</a>(&#123;Int64Ty, Int64Ty, Int64Ty&#125;),</span></CodeLine>
<Link id="l07824" /><CodeLine lineNumber="7824"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;struct.descriptor&#95;dim&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07825" /><CodeLine lineNumber="7825"></CodeLine>
<Link id="l07826" /><CodeLine lineNumber="7826"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> &#123; OffsetFD = 0, CountFD, StrideFD &#125;;</span></CodeLine>
<Link id="l07827" /><CodeLine lineNumber="7827"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need two index variable here since the size of &quot;Dims&quot; is the same as</span></CodeLine>
<Link id="l07828" /><CodeLine lineNumber="7828"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the size of Components, however, the size of offset, count, and stride is</span></CodeLine>
<Link id="l07829" /><CodeLine lineNumber="7829"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// equal to the size of base declaration that is non-contiguous.</span></CodeLine>
<Link id="l07830" /><CodeLine lineNumber="7830"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, L = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = NonContigInfo.Dims.size(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l07831" /><CodeLine lineNumber="7831"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip emitting ir if dimension size is 1 since it cannot be</span></CodeLine>
<Link id="l07832" /><CodeLine lineNumber="7832"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// non-contiguous.</span></CodeLine>
<Link id="l07833" /><CodeLine lineNumber="7833"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NonContigInfo.Dims&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; == 1)</span></CodeLine>
<Link id="l07834" /><CodeLine lineNumber="7834"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07835" /><CodeLine lineNumber="7835"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l07836" /><CodeLine lineNumber="7836"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bacb17ff5177bb277ed8dd79480aad9c27">ArrayType</a> &#42;ArrayTy = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(DimTy, NonContigInfo.Dims&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</span></CodeLine>
<Link id="l07837" /><CodeLine lineNumber="7837"><span class="doxyHighlight">    AllocaInst &#42;DimsAddr =</span></CodeLine>
<Link id="l07838" /><CodeLine lineNumber="7838"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(ArrayTy, </span><span class="doxyHighlightComment">/&#42; ArraySize = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;dims&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07839" /><CodeLine lineNumber="7839"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l07840" /><CodeLine lineNumber="7840"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = 0, EE = NonContigInfo.Dims&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> &lt; EE; ++<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>) &#123;</span></CodeLine>
<Link id="l07841" /><CodeLine lineNumber="7841"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> RevIdx = EE - <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> - 1;</span></CodeLine>
<Link id="l07842" /><CodeLine lineNumber="7842"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DimsLVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l07843" /><CodeLine lineNumber="7843"><span class="doxyHighlight">          DimsAddr-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), DimsAddr,</span></CodeLine>
<Link id="l07844" /><CodeLine lineNumber="7844"><span class="doxyHighlight">          &#123;Builder.getInt64(0), Builder.getInt64(II)&#125;);</span></CodeLine>
<Link id="l07845" /><CodeLine lineNumber="7845"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Offset</span></CodeLine>
<Link id="l07846" /><CodeLine lineNumber="7846"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OffsetLVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e95ff363c20e1f51b673230538e10fd">CreateStructGEP</a>(DimTy, DimsLVal, OffsetFD);</span></CodeLine>
<Link id="l07847" /><CodeLine lineNumber="7847"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(</span></CodeLine>
<Link id="l07848" /><CodeLine lineNumber="7848"><span class="doxyHighlight">          NonContigInfo.Offsets&#91;L&#93;&#91;RevIdx&#93;, OffsetLVal,</span></CodeLine>
<Link id="l07849" /><CodeLine lineNumber="7849"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(OffsetLVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l07850" /><CodeLine lineNumber="7850"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Count</span></CodeLine>
<Link id="l07851" /><CodeLine lineNumber="7851"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CountLVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e95ff363c20e1f51b673230538e10fd">CreateStructGEP</a>(DimTy, DimsLVal, CountFD);</span></CodeLine>
<Link id="l07852" /><CodeLine lineNumber="7852"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(</span></CodeLine>
<Link id="l07853" /><CodeLine lineNumber="7853"><span class="doxyHighlight">          NonContigInfo.Counts&#91;L&#93;&#91;RevIdx&#93;, CountLVal,</span></CodeLine>
<Link id="l07854" /><CodeLine lineNumber="7854"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(CountLVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l07855" /><CodeLine lineNumber="7855"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Stride</span></CodeLine>
<Link id="l07856" /><CodeLine lineNumber="7856"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;StrideLVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e95ff363c20e1f51b673230538e10fd">CreateStructGEP</a>(DimTy, DimsLVal, StrideFD);</span></CodeLine>
<Link id="l07857" /><CodeLine lineNumber="7857"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(</span></CodeLine>
<Link id="l07858" /><CodeLine lineNumber="7858"><span class="doxyHighlight">          NonContigInfo.Strides&#91;L&#93;&#91;RevIdx&#93;, StrideLVal,</span></CodeLine>
<Link id="l07859" /><CodeLine lineNumber="7859"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(CountLVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l07860" /><CodeLine lineNumber="7860"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07861" /><CodeLine lineNumber="7861"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// args&#91;I&#93; = &amp;dims</span></CodeLine>
<Link id="l07862" /><CodeLine lineNumber="7862"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l07863" /><CodeLine lineNumber="7863"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DAddr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a68789c8159cee17d42d86c4b7fcce324">CreatePointerBitCastOrAddrSpaceCast</a>(</span></CodeLine>
<Link id="l07864" /><CodeLine lineNumber="7864"><span class="doxyHighlight">        DimsAddr, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l07865" /><CodeLine lineNumber="7865"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l07866" /><CodeLine lineNumber="7866"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs),</span></CodeLine>
<Link id="l07867" /><CodeLine lineNumber="7867"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.PointersArray, 0, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07868" /><CodeLine lineNumber="7868"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(</span></CodeLine>
<Link id="l07869" /><CodeLine lineNumber="7869"><span class="doxyHighlight">        DAddr, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>()));</span></CodeLine>
<Link id="l07870" /><CodeLine lineNumber="7870"><span class="doxyHighlight">    ++<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>;</span></CodeLine>
<Link id="l07871" /><CodeLine lineNumber="7871"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07872" /><CodeLine lineNumber="7872"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07873" /><CodeLine lineNumber="7873"></CodeLine>
<Link id="l07874" /><CodeLine lineNumber="7874"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitUDMapperArrayInitOrDel(</span></CodeLine>
<Link id="l07875" /><CodeLine lineNumber="7875"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;MapperFn, <a href="/docs/api/classes/llvm/value">Value</a> &#42;MapperHandle, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Begin,</span></CodeLine>
<Link id="l07876" /><CodeLine lineNumber="7876"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;MapType, <a href="/docs/api/classes/llvm/value">Value</a> &#42;MapName, <a href="/docs/api/classes/llvm/typesize">TypeSize</a> ElementSize,</span></CodeLine>
<Link id="l07877" /><CodeLine lineNumber="7877"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBB, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsInit) &#123;</span></CodeLine>
<Link id="l07878" /><CodeLine lineNumber="7878"><span class="doxyHighlight">  StringRef <a href="/docs/api/namespaces/llvm/cl/#afcbd4ecc474e2d218391d6d3027b086aa7861ef1db44eac8ea7a373cd7c53a7c5">Prefix</a> = IsInit ? </span><span class="doxyHighlightStringLiteral">&quot;.init&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;.del&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07879" /><CodeLine lineNumber="7879"></CodeLine>
<Link id="l07880" /><CodeLine lineNumber="7880"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Evaluate if this is an array section.</span></CodeLine>
<Link id="l07881" /><CodeLine lineNumber="7881"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;BodyBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l07882" /><CodeLine lineNumber="7882"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), <a href="/docs/api/classes/llvm/openmpirbuilder/#a488c861f8a68e5f78ceca8b57acd8be5">createPlatformSpecificName</a>(&#123;</span><span class="doxyHighlightStringLiteral">&quot;omp.array&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#afcbd4ecc474e2d218391d6d3027b086aa7861ef1db44eac8ea7a373cd7c53a7c5">Prefix</a>&#125;));</span></CodeLine>
<Link id="l07883" /><CodeLine lineNumber="7883"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/logicalview/#a738fb172d3b98e08a4325dc7ca5588b8a7515d3a3055b2139844aa9e06fce46cf">IsArray</a> =</span></CodeLine>
<Link id="l07884" /><CodeLine lineNumber="7884"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3280551f1232a760cb7b21e85fdd5eca">CreateICmpSGT</a>(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(1), </span><span class="doxyHighlightStringLiteral">&quot;omp.arrayinit.isarray&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07885" /><CodeLine lineNumber="7885"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DeleteBit = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(</span></CodeLine>
<Link id="l07886" /><CodeLine lineNumber="7886"><span class="doxyHighlight">      MapType,</span></CodeLine>
<Link id="l07887" /><CodeLine lineNumber="7887"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l07888" /><CodeLine lineNumber="7888"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l07889" /><CodeLine lineNumber="7889"><span class="doxyHighlight">              OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;DELETE)));</span></CodeLine>
<Link id="l07890" /><CodeLine lineNumber="7890"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DeleteCond;</span></CodeLine>
<Link id="l07891" /><CodeLine lineNumber="7891"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>;</span></CodeLine>
<Link id="l07892" /><CodeLine lineNumber="7892"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsInit) &#123;</span></CodeLine>
<Link id="l07893" /><CodeLine lineNumber="7893"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// base != begin?</span></CodeLine>
<Link id="l07894" /><CodeLine lineNumber="7894"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BaseIsBegin = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a6ef1729b04a4fbd6c6f27787cdd0e813">CreateICmpNE</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>, Begin);</span></CodeLine>
<Link id="l07895" /><CodeLine lineNumber="7895"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// IsPtrAndObj?</span></CodeLine>
<Link id="l07896" /><CodeLine lineNumber="7896"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PtrAndObjBit = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(</span></CodeLine>
<Link id="l07897" /><CodeLine lineNumber="7897"><span class="doxyHighlight">        MapType,</span></CodeLine>
<Link id="l07898" /><CodeLine lineNumber="7898"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l07899" /><CodeLine lineNumber="7899"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l07900" /><CodeLine lineNumber="7900"><span class="doxyHighlight">                OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;PTR&#95;AND&#95;OBJ)));</span></CodeLine>
<Link id="l07901" /><CodeLine lineNumber="7901"><span class="doxyHighlight">    PtrAndObjBit = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aafd864f39fd28e235eea03ae424ab8e0">CreateIsNotNull</a>(PtrAndObjBit);</span></CodeLine>
<Link id="l07902" /><CodeLine lineNumber="7902"><span class="doxyHighlight">    BaseIsBegin = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(BaseIsBegin, PtrAndObjBit);</span></CodeLine>
<Link id="l07903" /><CodeLine lineNumber="7903"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab61be8e3cf17e9848aeeeabacfa1b09a">CreateOr</a>(IsArray, BaseIsBegin);</span></CodeLine>
<Link id="l07904" /><CodeLine lineNumber="7904"><span class="doxyHighlight">    DeleteCond = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac9843b4f9f9cb144c608c48785a394a8">CreateIsNull</a>(</span></CodeLine>
<Link id="l07905" /><CodeLine lineNumber="7905"><span class="doxyHighlight">        DeleteBit,</span></CodeLine>
<Link id="l07906" /><CodeLine lineNumber="7906"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/openmpirbuilder/#a488c861f8a68e5f78ceca8b57acd8be5">createPlatformSpecificName</a>(&#123;</span><span class="doxyHighlightStringLiteral">&quot;omp.array&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#afcbd4ecc474e2d218391d6d3027b086aa7861ef1db44eac8ea7a373cd7c53a7c5">Prefix</a>, </span><span class="doxyHighlightStringLiteral">&quot;.delete&quot;</span><span class="doxyHighlight">&#125;));</span></CodeLine>
<Link id="l07907" /><CodeLine lineNumber="7907"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07908" /><CodeLine lineNumber="7908"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/logicalview/#a738fb172d3b98e08a4325dc7ca5588b8a7515d3a3055b2139844aa9e06fce46cf">IsArray</a>;</span></CodeLine>
<Link id="l07909" /><CodeLine lineNumber="7909"><span class="doxyHighlight">    DeleteCond = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aafd864f39fd28e235eea03ae424ab8e0">CreateIsNotNull</a>(</span></CodeLine>
<Link id="l07910" /><CodeLine lineNumber="7910"><span class="doxyHighlight">        DeleteBit,</span></CodeLine>
<Link id="l07911" /><CodeLine lineNumber="7911"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/openmpirbuilder/#a488c861f8a68e5f78ceca8b57acd8be5">createPlatformSpecificName</a>(&#123;</span><span class="doxyHighlightStringLiteral">&quot;omp.array&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#afcbd4ecc474e2d218391d6d3027b086aa7861ef1db44eac8ea7a373cd7c53a7c5">Prefix</a>, </span><span class="doxyHighlightStringLiteral">&quot;.delete&quot;</span><span class="doxyHighlight">&#125;));</span></CodeLine>
<Link id="l07912" /><CodeLine lineNumber="7912"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07913" /><CodeLine lineNumber="7913"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, DeleteCond);</span></CodeLine>
<Link id="l07914" /><CodeLine lineNumber="7914"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, BodyBB, ExitBB);</span></CodeLine>
<Link id="l07915" /><CodeLine lineNumber="7915"></CodeLine>
<Link id="l07916" /><CodeLine lineNumber="7916"><span class="doxyHighlight">  emitBlock(BodyBB, MapperFn);</span></CodeLine>
<Link id="l07917" /><CodeLine lineNumber="7917"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the array size by multiplying element size and element number (i.e., \\p</span></CodeLine>
<Link id="l07918" /><CodeLine lineNumber="7918"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Size).</span></CodeLine>
<Link id="l07919" /><CodeLine lineNumber="7919"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ArraySize = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a06efffc299a3f7efaec1892c9ac4a86f">CreateNUWMul</a>(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(ElementSize));</span></CodeLine>
<Link id="l07920" /><CodeLine lineNumber="7920"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove OMP&#95;MAP&#95;TO and OMP&#95;MAP&#95;FROM from the map type, so that it achieves</span></CodeLine>
<Link id="l07921" /><CodeLine lineNumber="7921"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// memory allocation/deletion purpose only.</span></CodeLine>
<Link id="l07922" /><CodeLine lineNumber="7922"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;MapTypeArg = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(</span></CodeLine>
<Link id="l07923" /><CodeLine lineNumber="7923"><span class="doxyHighlight">      MapType,</span></CodeLine>
<Link id="l07924" /><CodeLine lineNumber="7924"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l07925" /><CodeLine lineNumber="7925"><span class="doxyHighlight">          ~</span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l07926" /><CodeLine lineNumber="7926"><span class="doxyHighlight">              OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;TO |</span></CodeLine>
<Link id="l07927" /><CodeLine lineNumber="7927"><span class="doxyHighlight">              OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;FROM)));</span></CodeLine>
<Link id="l07928" /><CodeLine lineNumber="7928"><span class="doxyHighlight">  MapTypeArg = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab61be8e3cf17e9848aeeeabacfa1b09a">CreateOr</a>(</span></CodeLine>
<Link id="l07929" /><CodeLine lineNumber="7929"><span class="doxyHighlight">      MapTypeArg,</span></CodeLine>
<Link id="l07930" /><CodeLine lineNumber="7930"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l07931" /><CodeLine lineNumber="7931"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l07932" /><CodeLine lineNumber="7932"><span class="doxyHighlight">              OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;IMPLICIT)));</span></CodeLine>
<Link id="l07933" /><CodeLine lineNumber="7933"></CodeLine>
<Link id="l07934" /><CodeLine lineNumber="7934"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Call the runtime API &#95;&#95;tgt&#95;push&#95;mapper&#95;component to fill up the runtime</span></CodeLine>
<Link id="l07935" /><CodeLine lineNumber="7935"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// data structure.</span></CodeLine>
<Link id="l07936" /><CodeLine lineNumber="7936"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OffloadingArgs&#91;&#93; = &#123;MapperHandle, <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>,       Begin,</span></CodeLine>
<Link id="l07937" /><CodeLine lineNumber="7937"><span class="doxyHighlight">                             ArraySize,    MapTypeArg, MapName&#125;;</span></CodeLine>
<Link id="l07938" /><CodeLine lineNumber="7938"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l07939" /><CodeLine lineNumber="7939"><span class="doxyHighlight">      getOrCreateRuntimeFunction(M, OMPRTL&#95;&#95;&#95;tgt&#95;push&#95;mapper&#95;component),</span></CodeLine>
<Link id="l07940" /><CodeLine lineNumber="7940"><span class="doxyHighlight">      OffloadingArgs);</span></CodeLine>
<Link id="l07941" /><CodeLine lineNumber="7941"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07942" /><CodeLine lineNumber="7942"></CodeLine>
<Link id="l07943" /><CodeLine lineNumber="7943"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/function">Function</a> &#42;OpenMPIRBuilder::emitUserDefinedMapper(</span></CodeLine>
<Link id="l07944" /><CodeLine lineNumber="7944"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;MapInfosTy &amp;(InsertPointTy CodeGenIP, <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;PtrPHI,</span></CodeLine>
<Link id="l07945" /><CodeLine lineNumber="7945"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/value">llvm::Value</a> &#42;BeginArg)&gt;</span></CodeLine>
<Link id="l07946" /><CodeLine lineNumber="7946"><span class="doxyHighlight">        GenMapInfoCB,</span></CodeLine>
<Link id="l07947" /><CodeLine lineNumber="7947"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ElemTy, <a href="/docs/api/classes/llvm/stringref">StringRef</a> FuncName,</span></CodeLine>
<Link id="l07948" /><CodeLine lineNumber="7948"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/function">Function</a> &#42;&#42;)&gt; CustomMapperCB) &#123;</span></CodeLine>
<Link id="l07949" /><CodeLine lineNumber="7949"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Type &#42;&gt;</a> Params;</span></CodeLine>
<Link id="l07950" /><CodeLine lineNumber="7950"><span class="doxyHighlight">  Params.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l07951" /><CodeLine lineNumber="7951"><span class="doxyHighlight">  Params.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l07952" /><CodeLine lineNumber="7952"><span class="doxyHighlight">  Params.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l07953" /><CodeLine lineNumber="7953"><span class="doxyHighlight">  Params.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64748b5a9f8d8dd4499f84312e2c1336">getInt64Ty</a>());</span></CodeLine>
<Link id="l07954" /><CodeLine lineNumber="7954"><span class="doxyHighlight">  Params.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64748b5a9f8d8dd4499f84312e2c1336">getInt64Ty</a>());</span></CodeLine>
<Link id="l07955" /><CodeLine lineNumber="7955"><span class="doxyHighlight">  Params.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l07956" /><CodeLine lineNumber="7956"></CodeLine>
<Link id="l07957" /><CodeLine lineNumber="7957"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FnTy =</span></CodeLine>
<Link id="l07958" /><CodeLine lineNumber="7958"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad0243f1634f75e231041023ffaa8501a">getVoidTy</a>(), Params, </span><span class="doxyHighlightComment">/&#42; IsVarArg &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07959" /><CodeLine lineNumber="7959"></CodeLine>
<Link id="l07960" /><CodeLine lineNumber="7960"><span class="doxyHighlight">  SmallString&lt;64&gt; TyStr;</span></CodeLine>
<Link id="l07961" /><CodeLine lineNumber="7961"><span class="doxyHighlight">  raw&#95;svector&#95;ostream Out(TyStr);</span></CodeLine>
<Link id="l07962" /><CodeLine lineNumber="7962"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;MapperFn =</span></CodeLine>
<Link id="l07963" /><CodeLine lineNumber="7963"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(FnTy, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>, FuncName, M);</span></CodeLine>
<Link id="l07964" /><CodeLine lineNumber="7964"><span class="doxyHighlight">  MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(Attribute::NoInline);</span></CodeLine>
<Link id="l07965" /><CodeLine lineNumber="7965"><span class="doxyHighlight">  MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(Attribute::NoUnwind);</span></CodeLine>
<Link id="l07966" /><CodeLine lineNumber="7966"><span class="doxyHighlight">  MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(0, Attribute::NoUndef);</span></CodeLine>
<Link id="l07967" /><CodeLine lineNumber="7967"><span class="doxyHighlight">  MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(1, Attribute::NoUndef);</span></CodeLine>
<Link id="l07968" /><CodeLine lineNumber="7968"><span class="doxyHighlight">  MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(2, Attribute::NoUndef);</span></CodeLine>
<Link id="l07969" /><CodeLine lineNumber="7969"><span class="doxyHighlight">  MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(3, Attribute::NoUndef);</span></CodeLine>
<Link id="l07970" /><CodeLine lineNumber="7970"><span class="doxyHighlight">  MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(4, Attribute::NoUndef);</span></CodeLine>
<Link id="l07971" /><CodeLine lineNumber="7971"><span class="doxyHighlight">  MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(5, Attribute::NoUndef);</span></CodeLine>
<Link id="l07972" /><CodeLine lineNumber="7972"></CodeLine>
<Link id="l07973" /><CodeLine lineNumber="7973"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Start the mapper function code generation.</span></CodeLine>
<Link id="l07974" /><CodeLine lineNumber="7974"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EntryBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;entry&quot;</span><span class="doxyHighlight">, MapperFn);</span></CodeLine>
<Link id="l07975" /><CodeLine lineNumber="7975"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SavedIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l07976" /><CodeLine lineNumber="7976"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(EntryBB);</span></CodeLine>
<Link id="l07977" /><CodeLine lineNumber="7977"></CodeLine>
<Link id="l07978" /><CodeLine lineNumber="7978"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;MapperHandle = MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(0);</span></CodeLine>
<Link id="l07979" /><CodeLine lineNumber="7979"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BaseIn = MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(1);</span></CodeLine>
<Link id="l07980" /><CodeLine lineNumber="7980"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BeginIn = MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(2);</span></CodeLine>
<Link id="l07981" /><CodeLine lineNumber="7981"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(3);</span></CodeLine>
<Link id="l07982" /><CodeLine lineNumber="7982"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;MapType = MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(4);</span></CodeLine>
<Link id="l07983" /><CodeLine lineNumber="7983"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;MapName = MapperFn-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(5);</span></CodeLine>
<Link id="l07984" /><CodeLine lineNumber="7984"></CodeLine>
<Link id="l07985" /><CodeLine lineNumber="7985"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute the starting and end addresses of array elements.</span></CodeLine>
<Link id="l07986" /><CodeLine lineNumber="7986"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Prepare common arguments for array initiation and deletion.</span></CodeLine>
<Link id="l07987" /><CodeLine lineNumber="7987"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convert the size in bytes into the number of array elements.</span></CodeLine>
<Link id="l07988" /><CodeLine lineNumber="7988"><span class="doxyHighlight">  TypeSize ElementSize = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getTypeStoreSize(ElemTy);</span></CodeLine>
<Link id="l07989" /><CodeLine lineNumber="7989"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aaf8e54fa8e1a081048b4b86ae30ce0ea">CreateExactUDiv</a>(<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(ElementSize));</span></CodeLine>
<Link id="l07990" /><CodeLine lineNumber="7990"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PtrBegin = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(BeginIn, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l07991" /><CodeLine lineNumber="7991"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PtrEnd = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73e0482b96d9d0cdfcc90c0a34f5b0db">CreateGEP</a>(ElemTy, PtrBegin, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>);</span></CodeLine>
<Link id="l07992" /><CodeLine lineNumber="7992"></CodeLine>
<Link id="l07993" /><CodeLine lineNumber="7993"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit array initiation if this is an array section and \\p MapType indicates</span></CodeLine>
<Link id="l07994" /><CodeLine lineNumber="7994"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that memory allocation is required.</span></CodeLine>
<Link id="l07995" /><CodeLine lineNumber="7995"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;HeadBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp.arraymap.head&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07996" /><CodeLine lineNumber="7996"><span class="doxyHighlight">  emitUDMapperArrayInitOrDel(MapperFn, MapperHandle, BaseIn, BeginIn, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>,</span></CodeLine>
<Link id="l07997" /><CodeLine lineNumber="7997"><span class="doxyHighlight">                             MapType, MapName, ElementSize, HeadBB,</span></CodeLine>
<Link id="l07998" /><CodeLine lineNumber="7998"><span class="doxyHighlight">                             </span><span class="doxyHighlightComment">/&#42;IsInit=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07999" /><CodeLine lineNumber="7999"></CodeLine>
<Link id="l08000" /><CodeLine lineNumber="8000"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit a for loop to iterate through SizeArg of elements and map all of them.</span></CodeLine>
<Link id="l08001" /><CodeLine lineNumber="8001"></CodeLine>
<Link id="l08002" /><CodeLine lineNumber="8002"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit the loop header block.</span></CodeLine>
<Link id="l08003" /><CodeLine lineNumber="8003"><span class="doxyHighlight">  emitBlock(HeadBB, MapperFn);</span></CodeLine>
<Link id="l08004" /><CodeLine lineNumber="8004"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;BodyBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp.arraymap.body&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08005" /><CodeLine lineNumber="8005"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;DoneBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp.done&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08006" /><CodeLine lineNumber="8006"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Evaluate whether the initial condition is satisfied.</span></CodeLine>
<Link id="l08007" /><CodeLine lineNumber="8007"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IsEmpty =</span></CodeLine>
<Link id="l08008" /><CodeLine lineNumber="8008"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(PtrBegin, PtrEnd, </span><span class="doxyHighlightStringLiteral">&quot;omp.arraymap.isempty&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08009" /><CodeLine lineNumber="8009"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(IsEmpty, DoneBB, BodyBB);</span></CodeLine>
<Link id="l08010" /><CodeLine lineNumber="8010"></CodeLine>
<Link id="l08011" /><CodeLine lineNumber="8011"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit the loop body block.</span></CodeLine>
<Link id="l08012" /><CodeLine lineNumber="8012"><span class="doxyHighlight">  emitBlock(BodyBB, MapperFn);</span></CodeLine>
<Link id="l08013" /><CodeLine lineNumber="8013"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;LastBB = BodyBB;</span></CodeLine>
<Link id="l08014" /><CodeLine lineNumber="8014"><span class="doxyHighlight">  PHINode &#42;PtrPHI =</span></CodeLine>
<Link id="l08015" /><CodeLine lineNumber="8015"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(PtrBegin-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 2, </span><span class="doxyHighlightStringLiteral">&quot;omp.arraymap.ptrcurrent&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08016" /><CodeLine lineNumber="8016"><span class="doxyHighlight">  PtrPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(PtrBegin, HeadBB);</span></CodeLine>
<Link id="l08017" /><CodeLine lineNumber="8017"></CodeLine>
<Link id="l08018" /><CodeLine lineNumber="8018"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get map clause information. Fill up the arrays with all mapped variables.</span></CodeLine>
<Link id="l08019" /><CodeLine lineNumber="8019"><span class="doxyHighlight">  MapInfosTy &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a> = GenMapInfoCB(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>(), PtrPHI, BeginIn);</span></CodeLine>
<Link id="l08020" /><CodeLine lineNumber="8020"></CodeLine>
<Link id="l08021" /><CodeLine lineNumber="8021"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Call the runtime API &#95;&#95;tgt&#95;mapper&#95;num&#95;components to get the number of</span></CodeLine>
<Link id="l08022" /><CodeLine lineNumber="8022"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pre-existing components.</span></CodeLine>
<Link id="l08023" /><CodeLine lineNumber="8023"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OffloadingArgs&#91;&#93; = &#123;MapperHandle&#125;;</span></CodeLine>
<Link id="l08024" /><CodeLine lineNumber="8024"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PreviousSize = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l08025" /><CodeLine lineNumber="8025"><span class="doxyHighlight">      getOrCreateRuntimeFunction(M, OMPRTL&#95;&#95;&#95;tgt&#95;mapper&#95;num&#95;components),</span></CodeLine>
<Link id="l08026" /><CodeLine lineNumber="8026"><span class="doxyHighlight">      OffloadingArgs);</span></CodeLine>
<Link id="l08027" /><CodeLine lineNumber="8027"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ShiftedPreviousSize =</span></CodeLine>
<Link id="l08028" /><CodeLine lineNumber="8028"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b6a3be6451cf6a789d9305d90751c40">CreateShl</a>(PreviousSize, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(<a href="/docs/api/classes/llvm/openmpirbuilder/#ac86b562509588cbc00fbdc441c615bd3">getFlagMemberOffset</a>()));</span></CodeLine>
<Link id="l08029" /><CodeLine lineNumber="8029"></CodeLine>
<Link id="l08030" /><CodeLine lineNumber="8030"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Fill up the runtime mapper handle for all components.</span></CodeLine>
<Link id="l08031" /><CodeLine lineNumber="8031"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.BasePointers.size(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l08032" /><CodeLine lineNumber="8032"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CurBaseArg =</span></CodeLine>
<Link id="l08033" /><CodeLine lineNumber="8033"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.BasePointers&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l08034" /><CodeLine lineNumber="8034"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CurBeginArg =</span></CodeLine>
<Link id="l08035" /><CodeLine lineNumber="8035"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.Pointers&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l08036" /><CodeLine lineNumber="8036"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CurSizeArg = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.Sizes&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l08037" /><CodeLine lineNumber="8037"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CurNameArg = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.Names.size()</span></CodeLine>
<Link id="l08038" /><CodeLine lineNumber="8038"><span class="doxyHighlight">                            ? <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.Names&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;</span></CodeLine>
<Link id="l08039" /><CodeLine lineNumber="8039"><span class="doxyHighlight">                            : <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>());</span></CodeLine>
<Link id="l08040" /><CodeLine lineNumber="8040"></CodeLine>
<Link id="l08041" /><CodeLine lineNumber="8041"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Extract the MEMBER&#95;OF field from the map type.</span></CodeLine>
<Link id="l08042" /><CodeLine lineNumber="8042"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OriMapType = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l08043" /><CodeLine lineNumber="8043"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l08044" /><CodeLine lineNumber="8044"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.Types&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;));</span></CodeLine>
<Link id="l08045" /><CodeLine lineNumber="8045"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;MemberMapType =</span></CodeLine>
<Link id="l08046" /><CodeLine lineNumber="8046"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a706649daecd068a72d8e06df2fd83549">CreateNUWAdd</a>(OriMapType, ShiftedPreviousSize);</span></CodeLine>
<Link id="l08047" /><CodeLine lineNumber="8047"></CodeLine>
<Link id="l08048" /><CodeLine lineNumber="8048"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Combine the map type inherited from user-defined mapper with that</span></CodeLine>
<Link id="l08049" /><CodeLine lineNumber="8049"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// specified in the program. According to the OMP&#95;MAP&#95;TO and OMP&#95;MAP&#95;FROM</span></CodeLine>
<Link id="l08050" /><CodeLine lineNumber="8050"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bits of the \\a MapType, which is the input argument of the mapper</span></CodeLine>
<Link id="l08051" /><CodeLine lineNumber="8051"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// function, the following code will set the OMP&#95;MAP&#95;TO and OMP&#95;MAP&#95;FROM</span></CodeLine>
<Link id="l08052" /><CodeLine lineNumber="8052"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bits of MemberMapType.</span></CodeLine>
<Link id="l08053" /><CodeLine lineNumber="8053"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#91;OpenMP 5.0&#93;, 1.2.6. map-type decay.</span></CodeLine>
<Link id="l08054" /><CodeLine lineNumber="8054"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//        | alloc |  to   | from  | tofrom | release | delete</span></CodeLine>
<Link id="l08055" /><CodeLine lineNumber="8055"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ----------------------------------------------------------</span></CodeLine>
<Link id="l08056" /><CodeLine lineNumber="8056"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// alloc  | alloc | alloc | alloc | alloc  | release | delete</span></CodeLine>
<Link id="l08057" /><CodeLine lineNumber="8057"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to     | alloc |  to   | alloc |   to   | release | delete</span></CodeLine>
<Link id="l08058" /><CodeLine lineNumber="8058"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// from   | alloc | alloc | from  |  from  | release | delete</span></CodeLine>
<Link id="l08059" /><CodeLine lineNumber="8059"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// tofrom | alloc |  to   | from  | tofrom | release | delete</span></CodeLine>
<Link id="l08060" /><CodeLine lineNumber="8060"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;LeftToFrom = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(</span></CodeLine>
<Link id="l08061" /><CodeLine lineNumber="8061"><span class="doxyHighlight">        MapType,</span></CodeLine>
<Link id="l08062" /><CodeLine lineNumber="8062"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l08063" /><CodeLine lineNumber="8063"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l08064" /><CodeLine lineNumber="8064"><span class="doxyHighlight">                OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;TO |</span></CodeLine>
<Link id="l08065" /><CodeLine lineNumber="8065"><span class="doxyHighlight">                OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;FROM)));</span></CodeLine>
<Link id="l08066" /><CodeLine lineNumber="8066"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;AllocBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp.type.alloc&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08067" /><CodeLine lineNumber="8067"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;AllocElseBB =</span></CodeLine>
<Link id="l08068" /><CodeLine lineNumber="8068"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp.type.alloc.else&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08069" /><CodeLine lineNumber="8069"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ToBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp.type.to&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08070" /><CodeLine lineNumber="8070"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ToElseBB =</span></CodeLine>
<Link id="l08071" /><CodeLine lineNumber="8071"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp.type.to.else&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08072" /><CodeLine lineNumber="8072"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;FromBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp.type.from&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08073" /><CodeLine lineNumber="8073"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;EndBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp.type.end&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08074" /><CodeLine lineNumber="8074"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IsAlloc = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac9843b4f9f9cb144c608c48785a394a8">CreateIsNull</a>(LeftToFrom);</span></CodeLine>
<Link id="l08075" /><CodeLine lineNumber="8075"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(IsAlloc, AllocBB, AllocElseBB);</span></CodeLine>
<Link id="l08076" /><CodeLine lineNumber="8076"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In case of alloc, clear OMP&#95;MAP&#95;TO and OMP&#95;MAP&#95;FROM.</span></CodeLine>
<Link id="l08077" /><CodeLine lineNumber="8077"><span class="doxyHighlight">    emitBlock(AllocBB, MapperFn);</span></CodeLine>
<Link id="l08078" /><CodeLine lineNumber="8078"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;AllocMapType = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(</span></CodeLine>
<Link id="l08079" /><CodeLine lineNumber="8079"><span class="doxyHighlight">        MemberMapType,</span></CodeLine>
<Link id="l08080" /><CodeLine lineNumber="8080"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l08081" /><CodeLine lineNumber="8081"><span class="doxyHighlight">            ~</span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l08082" /><CodeLine lineNumber="8082"><span class="doxyHighlight">                OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;TO |</span></CodeLine>
<Link id="l08083" /><CodeLine lineNumber="8083"><span class="doxyHighlight">                OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;FROM)));</span></CodeLine>
<Link id="l08084" /><CodeLine lineNumber="8084"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(EndBB);</span></CodeLine>
<Link id="l08085" /><CodeLine lineNumber="8085"><span class="doxyHighlight">    emitBlock(AllocElseBB, MapperFn);</span></CodeLine>
<Link id="l08086" /><CodeLine lineNumber="8086"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IsTo = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(</span></CodeLine>
<Link id="l08087" /><CodeLine lineNumber="8087"><span class="doxyHighlight">        LeftToFrom,</span></CodeLine>
<Link id="l08088" /><CodeLine lineNumber="8088"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l08089" /><CodeLine lineNumber="8089"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l08090" /><CodeLine lineNumber="8090"><span class="doxyHighlight">                OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;TO)));</span></CodeLine>
<Link id="l08091" /><CodeLine lineNumber="8091"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(IsTo, ToBB, ToElseBB);</span></CodeLine>
<Link id="l08092" /><CodeLine lineNumber="8092"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In case of to, clear OMP&#95;MAP&#95;FROM.</span></CodeLine>
<Link id="l08093" /><CodeLine lineNumber="8093"><span class="doxyHighlight">    emitBlock(ToBB, MapperFn);</span></CodeLine>
<Link id="l08094" /><CodeLine lineNumber="8094"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ToMapType = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(</span></CodeLine>
<Link id="l08095" /><CodeLine lineNumber="8095"><span class="doxyHighlight">        MemberMapType,</span></CodeLine>
<Link id="l08096" /><CodeLine lineNumber="8096"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l08097" /><CodeLine lineNumber="8097"><span class="doxyHighlight">            ~</span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l08098" /><CodeLine lineNumber="8098"><span class="doxyHighlight">                OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;FROM)));</span></CodeLine>
<Link id="l08099" /><CodeLine lineNumber="8099"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(EndBB);</span></CodeLine>
<Link id="l08100" /><CodeLine lineNumber="8100"><span class="doxyHighlight">    emitBlock(ToElseBB, MapperFn);</span></CodeLine>
<Link id="l08101" /><CodeLine lineNumber="8101"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IsFrom = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(</span></CodeLine>
<Link id="l08102" /><CodeLine lineNumber="8102"><span class="doxyHighlight">        LeftToFrom,</span></CodeLine>
<Link id="l08103" /><CodeLine lineNumber="8103"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l08104" /><CodeLine lineNumber="8104"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l08105" /><CodeLine lineNumber="8105"><span class="doxyHighlight">                OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;FROM)));</span></CodeLine>
<Link id="l08106" /><CodeLine lineNumber="8106"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(IsFrom, FromBB, EndBB);</span></CodeLine>
<Link id="l08107" /><CodeLine lineNumber="8107"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In case of from, clear OMP&#95;MAP&#95;TO.</span></CodeLine>
<Link id="l08108" /><CodeLine lineNumber="8108"><span class="doxyHighlight">    emitBlock(FromBB, MapperFn);</span></CodeLine>
<Link id="l08109" /><CodeLine lineNumber="8109"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;FromMapType = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(</span></CodeLine>
<Link id="l08110" /><CodeLine lineNumber="8110"><span class="doxyHighlight">        MemberMapType,</span></CodeLine>
<Link id="l08111" /><CodeLine lineNumber="8111"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(</span></CodeLine>
<Link id="l08112" /><CodeLine lineNumber="8112"><span class="doxyHighlight">            ~</span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l08113" /><CodeLine lineNumber="8113"><span class="doxyHighlight">                OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;TO)));</span></CodeLine>
<Link id="l08114" /><CodeLine lineNumber="8114"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In case of tofrom, do nothing.</span></CodeLine>
<Link id="l08115" /><CodeLine lineNumber="8115"><span class="doxyHighlight">    emitBlock(EndBB, MapperFn);</span></CodeLine>
<Link id="l08116" /><CodeLine lineNumber="8116"><span class="doxyHighlight">    LastBB = EndBB;</span></CodeLine>
<Link id="l08117" /><CodeLine lineNumber="8117"><span class="doxyHighlight">    PHINode &#42;CurMapType =</span></CodeLine>
<Link id="l08118" /><CodeLine lineNumber="8118"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64748b5a9f8d8dd4499f84312e2c1336">getInt64Ty</a>(), 4, </span><span class="doxyHighlightStringLiteral">&quot;omp.maptype&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08119" /><CodeLine lineNumber="8119"><span class="doxyHighlight">    CurMapType-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(AllocMapType, AllocBB);</span></CodeLine>
<Link id="l08120" /><CodeLine lineNumber="8120"><span class="doxyHighlight">    CurMapType-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(ToMapType, ToBB);</span></CodeLine>
<Link id="l08121" /><CodeLine lineNumber="8121"><span class="doxyHighlight">    CurMapType-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(FromMapType, FromBB);</span></CodeLine>
<Link id="l08122" /><CodeLine lineNumber="8122"><span class="doxyHighlight">    CurMapType-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(MemberMapType, ToElseBB);</span></CodeLine>
<Link id="l08123" /><CodeLine lineNumber="8123"></CodeLine>
<Link id="l08124" /><CodeLine lineNumber="8124"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OffloadingArgs&#91;&#93; = &#123;MapperHandle, CurBaseArg, CurBeginArg,</span></CodeLine>
<Link id="l08125" /><CodeLine lineNumber="8125"><span class="doxyHighlight">                               CurSizeArg,   CurMapType, CurNameArg&#125;;</span></CodeLine>
<Link id="l08126" /><CodeLine lineNumber="8126"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;ChildMapperFn = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08127" /><CodeLine lineNumber="8127"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CustomMapperCB &amp;&amp; CustomMapperCB(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &amp;ChildMapperFn)) &#123;</span></CodeLine>
<Link id="l08128" /><CodeLine lineNumber="8128"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Call the corresponding mapper function.</span></CodeLine>
<Link id="l08129" /><CodeLine lineNumber="8129"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(ChildMapperFn, OffloadingArgs)-&gt;<a href="/docs/api/classes/llvm/callbase/#a0b6cef2a78857b0236b1c3a2a6eb857e">setDoesNotThrow</a>();</span></CodeLine>
<Link id="l08130" /><CodeLine lineNumber="8130"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08131" /><CodeLine lineNumber="8131"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Call the runtime API &#95;&#95;tgt&#95;push&#95;mapper&#95;component to fill up the runtime</span></CodeLine>
<Link id="l08132" /><CodeLine lineNumber="8132"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// data structure.</span></CodeLine>
<Link id="l08133" /><CodeLine lineNumber="8133"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l08134" /><CodeLine lineNumber="8134"><span class="doxyHighlight">          getOrCreateRuntimeFunction(M, OMPRTL&#95;&#95;&#95;tgt&#95;push&#95;mapper&#95;component),</span></CodeLine>
<Link id="l08135" /><CodeLine lineNumber="8135"><span class="doxyHighlight">          OffloadingArgs);</span></CodeLine>
<Link id="l08136" /><CodeLine lineNumber="8136"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08137" /><CodeLine lineNumber="8137"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08138" /><CodeLine lineNumber="8138"></CodeLine>
<Link id="l08139" /><CodeLine lineNumber="8139"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the pointer to point to the next element that needs to be mapped,</span></CodeLine>
<Link id="l08140" /><CodeLine lineNumber="8140"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and check whether we have mapped all elements.</span></CodeLine>
<Link id="l08141" /><CodeLine lineNumber="8141"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PtrNext = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1ac3f0b68c9c78c4f9e1eb09cd415db8">CreateConstGEP1&#95;32</a>(ElemTy, PtrPHI, </span><span class="doxyHighlightComment">/&#42;Idx0=&#42;/</span><span class="doxyHighlight">1,</span></CodeLine>
<Link id="l08142" /><CodeLine lineNumber="8142"><span class="doxyHighlight">                                              </span><span class="doxyHighlightStringLiteral">&quot;omp.arraymap.next&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08143" /><CodeLine lineNumber="8143"><span class="doxyHighlight">  PtrPHI-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(PtrNext, LastBB);</span></CodeLine>
<Link id="l08144" /><CodeLine lineNumber="8144"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IsDone = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(PtrNext, PtrEnd, </span><span class="doxyHighlightStringLiteral">&quot;omp.arraymap.isdone&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08145" /><CodeLine lineNumber="8145"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ExitBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp.arraymap.exit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08146" /><CodeLine lineNumber="8146"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(IsDone, ExitBB, BodyBB);</span></CodeLine>
<Link id="l08147" /><CodeLine lineNumber="8147"></CodeLine>
<Link id="l08148" /><CodeLine lineNumber="8148"><span class="doxyHighlight">  emitBlock(ExitBB, MapperFn);</span></CodeLine>
<Link id="l08149" /><CodeLine lineNumber="8149"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit array deletion if this is an array section and \\p MapType indicates</span></CodeLine>
<Link id="l08150" /><CodeLine lineNumber="8150"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that deletion is required.</span></CodeLine>
<Link id="l08151" /><CodeLine lineNumber="8151"><span class="doxyHighlight">  emitUDMapperArrayInitOrDel(MapperFn, MapperHandle, BaseIn, BeginIn, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>,</span></CodeLine>
<Link id="l08152" /><CodeLine lineNumber="8152"><span class="doxyHighlight">                             MapType, MapName, ElementSize, DoneBB,</span></CodeLine>
<Link id="l08153" /><CodeLine lineNumber="8153"><span class="doxyHighlight">                             </span><span class="doxyHighlightComment">/&#42;IsInit=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08154" /><CodeLine lineNumber="8154"></CodeLine>
<Link id="l08155" /><CodeLine lineNumber="8155"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit the function exit block.</span></CodeLine>
<Link id="l08156" /><CodeLine lineNumber="8156"><span class="doxyHighlight">  emitBlock(DoneBB, MapperFn, </span><span class="doxyHighlightComment">/&#42;IsFinished=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08157" /><CodeLine lineNumber="8157"></CodeLine>
<Link id="l08158" /><CodeLine lineNumber="8158"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l08159" /><CodeLine lineNumber="8159"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(SavedIP);</span></CodeLine>
<Link id="l08160" /><CodeLine lineNumber="8160"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MapperFn;</span></CodeLine>
<Link id="l08161" /><CodeLine lineNumber="8161"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08162" /><CodeLine lineNumber="8162"></CodeLine>
<Link id="l08163" /><CodeLine lineNumber="8163"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitOffloadingArrays(</span></CodeLine>
<Link id="l08164" /><CodeLine lineNumber="8164"><span class="doxyHighlight">    InsertPointTy AllocaIP, InsertPointTy CodeGenIP, MapInfosTy &amp;CombinedInfo,</span></CodeLine>
<Link id="l08165" /><CodeLine lineNumber="8165"><span class="doxyHighlight">    TargetDataInfo &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNonContiguous,</span></CodeLine>
<Link id="l08166" /><CodeLine lineNumber="8166"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/value">Value</a> &#42;)&gt; DeviceAddrCB,</span></CodeLine>
<Link id="l08167" /><CodeLine lineNumber="8167"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/value">Value</a> &#42;(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight">)&gt; CustomMapperCB) &#123;</span></CodeLine>
<Link id="l08168" /><CodeLine lineNumber="8168"></CodeLine>
<Link id="l08169" /><CodeLine lineNumber="8169"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reset the array information.</span></CodeLine>
<Link id="l08170" /><CodeLine lineNumber="8170"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.clearArrayInfo();</span></CodeLine>
<Link id="l08171" /><CodeLine lineNumber="8171"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs = CombinedInfo.BasePointers.<a href="/docs/api/classes/llvm/function/#a969eb757b1e43b455d4a8d0f603e695b">size</a>();</span></CodeLine>
<Link id="l08172" /><CodeLine lineNumber="8172"></CodeLine>
<Link id="l08173" /><CodeLine lineNumber="8173"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs == 0)</span></CodeLine>
<Link id="l08174" /><CodeLine lineNumber="8174"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08175" /><CodeLine lineNumber="8175"></CodeLine>
<Link id="l08176" /><CodeLine lineNumber="8176"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l08177" /><CodeLine lineNumber="8177"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Detect if we have any capture size requiring runtime evaluation of the</span></CodeLine>
<Link id="l08178" /><CodeLine lineNumber="8178"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// size so that a constant array could be eventually used.</span></CodeLine>
<Link id="l08179" /><CodeLine lineNumber="8179"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bacb17ff5177bb277ed8dd79480aad9c27">ArrayType</a> &#42;PointerArrayType =</span></CodeLine>
<Link id="l08180" /><CodeLine lineNumber="8180"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(), <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs);</span></CodeLine>
<Link id="l08181" /><CodeLine lineNumber="8181"></CodeLine>
<Link id="l08182" /><CodeLine lineNumber="8182"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.BasePointersArray = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l08183" /><CodeLine lineNumber="8183"><span class="doxyHighlight">      PointerArrayType, </span><span class="doxyHighlightComment">/&#42; ArraySize = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.offload&#95;baseptrs&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08184" /><CodeLine lineNumber="8184"></CodeLine>
<Link id="l08185" /><CodeLine lineNumber="8185"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.PointersArray = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l08186" /><CodeLine lineNumber="8186"><span class="doxyHighlight">      PointerArrayType, </span><span class="doxyHighlightComment">/&#42; ArraySize = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.offload&#95;ptrs&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08187" /><CodeLine lineNumber="8187"><span class="doxyHighlight">  AllocaInst &#42;MappersArray = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l08188" /><CodeLine lineNumber="8188"><span class="doxyHighlight">      PointerArrayType, </span><span class="doxyHighlightComment">/&#42; ArraySize = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.offload&#95;mappers&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08189" /><CodeLine lineNumber="8189"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.MappersArray = MappersArray;</span></CodeLine>
<Link id="l08190" /><CodeLine lineNumber="8190"></CodeLine>
<Link id="l08191" /><CodeLine lineNumber="8191"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we don&#39;t have any VLA types or other types that require runtime</span></CodeLine>
<Link id="l08192" /><CodeLine lineNumber="8192"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// evaluation, we can use a constant array for the map sizes, otherwise we</span></CodeLine>
<Link id="l08193" /><CodeLine lineNumber="8193"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// need to fill up the arrays as we do for the pointers.</span></CodeLine>
<Link id="l08194" /><CodeLine lineNumber="8194"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Int64Ty = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64748b5a9f8d8dd4499f84312e2c1336">getInt64Ty</a>();</span></CodeLine>
<Link id="l08195" /><CodeLine lineNumber="8195"><span class="doxyHighlight">  SmallVector&lt;Constant &#42;&gt; ConstSizes(CombinedInfo.Sizes.size(),</span></CodeLine>
<Link id="l08196" /><CodeLine lineNumber="8196"><span class="doxyHighlight">                                     ConstantInt::get(Int64Ty, 0));</span></CodeLine>
<Link id="l08197" /><CodeLine lineNumber="8197"><span class="doxyHighlight">  SmallBitVector RuntimeSizes(CombinedInfo.Sizes.size());</span></CodeLine>
<Link id="l08198" /><CodeLine lineNumber="8198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = CombinedInfo.Sizes.size(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l08199" /><CodeLine lineNumber="8199"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(CombinedInfo.Sizes&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;)) &#123;</span></CodeLine>
<Link id="l08200" /><CodeLine lineNumber="8200"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantExpr&gt;</a>(CI) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GlobalValue&gt;</a>(CI)) &#123;</span></CodeLine>
<Link id="l08201" /><CodeLine lineNumber="8201"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsNonContiguous &amp;&amp;</span></CodeLine>
<Link id="l08202" /><CodeLine lineNumber="8202"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l08203" /><CodeLine lineNumber="8203"><span class="doxyHighlight">                CombinedInfo.Types&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; &amp;</span></CodeLine>
<Link id="l08204" /><CodeLine lineNumber="8204"><span class="doxyHighlight">                OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;NON&#95;CONTIG))</span></CodeLine>
<Link id="l08205" /><CodeLine lineNumber="8205"><span class="doxyHighlight">          ConstSizes&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; =</span></CodeLine>
<Link id="l08206" /><CodeLine lineNumber="8206"><span class="doxyHighlight">              ConstantInt::get(Int64Ty, CombinedInfo.NonContigInfo.Dims&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</span></CodeLine>
<Link id="l08207" /><CodeLine lineNumber="8207"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08208" /><CodeLine lineNumber="8208"><span class="doxyHighlight">          ConstSizes&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = CI;</span></CodeLine>
<Link id="l08209" /><CodeLine lineNumber="8209"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08210" /><CodeLine lineNumber="8210"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08211" /><CodeLine lineNumber="8211"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08212" /><CodeLine lineNumber="8212"><span class="doxyHighlight">    RuntimeSizes.set(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08213" /><CodeLine lineNumber="8213"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08214" /><CodeLine lineNumber="8214"></CodeLine>
<Link id="l08215" /><CodeLine lineNumber="8215"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RuntimeSizes.all()) &#123;</span></CodeLine>
<Link id="l08216" /><CodeLine lineNumber="8216"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bacb17ff5177bb277ed8dd79480aad9c27">ArrayType</a> &#42;SizeArrayType = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Int64Ty, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs);</span></CodeLine>
<Link id="l08217" /><CodeLine lineNumber="8217"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.SizesArray = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l08218" /><CodeLine lineNumber="8218"><span class="doxyHighlight">        SizeArrayType, </span><span class="doxyHighlightComment">/&#42; ArraySize = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.offload&#95;sizes&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08219" /><CodeLine lineNumber="8219"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l08220" /><CodeLine lineNumber="8220"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08221" /><CodeLine lineNumber="8221"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SizesArrayInit = <a href="/docs/api/classes/llvm/constantarray/#a0900dacdc7ad8e3ea0cc92993c7fd422">ConstantArray::get</a>(</span></CodeLine>
<Link id="l08222" /><CodeLine lineNumber="8222"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Int64Ty, ConstSizes.size()), ConstSizes);</span></CodeLine>
<Link id="l08223" /><CodeLine lineNumber="8223"><span class="doxyHighlight">    std::string <a href="/docs/api/namespaces/llvm/graphprogram/#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a> = <a href="/docs/api/classes/llvm/openmpirbuilder/#a488c861f8a68e5f78ceca8b57acd8be5">createPlatformSpecificName</a>(&#123;</span><span class="doxyHighlightStringLiteral">&quot;offload&#95;sizes&quot;</span><span class="doxyHighlight">&#125;);</span></CodeLine>
<Link id="l08224" /><CodeLine lineNumber="8224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SizesArrayGbl =</span></CodeLine>
<Link id="l08225" /><CodeLine lineNumber="8225"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> GlobalVariable(M, SizesArrayInit-&gt;getType(), </span><span class="doxyHighlightComment">/&#42;isConstant=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l08226" /><CodeLine lineNumber="8226"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca04ed141708c0fd16723d212502b046ae">GlobalValue::PrivateLinkage</a>, SizesArrayInit, Name);</span></CodeLine>
<Link id="l08227" /><CodeLine lineNumber="8227"><span class="doxyHighlight">    SizesArrayGbl-&gt;setUnnamedAddr(<a href="/docs/api/classes/llvm/globalvalue/#ae8df4be75bfc50b1eadd74e85c25fa45a4cc6684df7b4a92b1dec6fce3264fac8">GlobalValue::UnnamedAddr::Global</a>);</span></CodeLine>
<Link id="l08228" /><CodeLine lineNumber="8228"></CodeLine>
<Link id="l08229" /><CodeLine lineNumber="8229"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RuntimeSizes.any()) &#123;</span></CodeLine>
<Link id="l08230" /><CodeLine lineNumber="8230"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.SizesArray = SizesArrayGbl;</span></CodeLine>
<Link id="l08231" /><CodeLine lineNumber="8231"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08232" /><CodeLine lineNumber="8232"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IndexSize = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getIndexSizeInBits(0);</span></CodeLine>
<Link id="l08233" /><CodeLine lineNumber="8233"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> OffloadSizeAlign = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getABIIntegerTypeAlignment(64);</span></CodeLine>
<Link id="l08234" /><CodeLine lineNumber="8234"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bacb17ff5177bb277ed8dd79480aad9c27">ArrayType</a> &#42;SizeArrayType = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Int64Ty, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs);</span></CodeLine>
<Link id="l08235" /><CodeLine lineNumber="8235"><span class="doxyHighlight">      AllocaInst &#42;Buffer = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(</span></CodeLine>
<Link id="l08236" /><CodeLine lineNumber="8236"><span class="doxyHighlight">          SizeArrayType, </span><span class="doxyHighlightComment">/&#42; ArraySize = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;.offload&#95;sizes&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08237" /><CodeLine lineNumber="8237"><span class="doxyHighlight">      Buffer-&gt;<a href="/docs/api/classes/llvm/allocainst/#af3bb24b322533dbe8a63c84b18568fe1">setAlignment</a>(OffloadSizeAlign);</span></CodeLine>
<Link id="l08238" /><CodeLine lineNumber="8238"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l08239" /><CodeLine lineNumber="8239"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae9f2730f66215fdb82f4e41e45124811">CreateMemCpy</a>(</span></CodeLine>
<Link id="l08240" /><CodeLine lineNumber="8240"><span class="doxyHighlight">          Buffer, <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(Buffer-&gt;<a href="/docs/api/classes/llvm/allocainst/#a5d19f3955a23e8eb2a974efcc8fb19da">getType</a>()),</span></CodeLine>
<Link id="l08241" /><CodeLine lineNumber="8241"><span class="doxyHighlight">          SizesArrayGbl, OffloadSizeAlign,</span></CodeLine>
<Link id="l08242" /><CodeLine lineNumber="8242"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a95df4f20c933779306b9a936b88b99a5">getIntN</a>(</span></CodeLine>
<Link id="l08243" /><CodeLine lineNumber="8243"><span class="doxyHighlight">              IndexSize,</span></CodeLine>
<Link id="l08244" /><CodeLine lineNumber="8244"><span class="doxyHighlight">              Buffer-&gt;<a href="/docs/api/classes/llvm/allocainst/#ad92f6c67d55ced3de1569ee791c38679">getAllocationSize</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout())-&gt;getFixedValue()));</span></CodeLine>
<Link id="l08245" /><CodeLine lineNumber="8245"></CodeLine>
<Link id="l08246" /><CodeLine lineNumber="8246"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.SizesArray = Buffer;</span></CodeLine>
<Link id="l08247" /><CodeLine lineNumber="8247"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08248" /><CodeLine lineNumber="8248"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l08249" /><CodeLine lineNumber="8249"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08250" /><CodeLine lineNumber="8250"></CodeLine>
<Link id="l08251" /><CodeLine lineNumber="8251"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The map types are always constant so we don&#39;t need to generate code to</span></CodeLine>
<Link id="l08252" /><CodeLine lineNumber="8252"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// fill arrays. Instead, we create an array constant.</span></CodeLine>
<Link id="l08253" /><CodeLine lineNumber="8253"><span class="doxyHighlight">  SmallVector&lt;uint64&#95;t, 4&gt; Mapping;</span></CodeLine>
<Link id="l08254" /><CodeLine lineNumber="8254"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> mapFlag : CombinedInfo.Types)</span></CodeLine>
<Link id="l08255" /><CodeLine lineNumber="8255"><span class="doxyHighlight">    Mapping.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l08256" /><CodeLine lineNumber="8256"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l08257" /><CodeLine lineNumber="8257"><span class="doxyHighlight">            mapFlag));</span></CodeLine>
<Link id="l08258" /><CodeLine lineNumber="8258"><span class="doxyHighlight">  std::string MaptypesName = <a href="/docs/api/classes/llvm/openmpirbuilder/#a488c861f8a68e5f78ceca8b57acd8be5">createPlatformSpecificName</a>(&#123;</span><span class="doxyHighlightStringLiteral">&quot;offload&#95;maptypes&quot;</span><span class="doxyHighlight">&#125;);</span></CodeLine>
<Link id="l08259" /><CodeLine lineNumber="8259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MapTypesArrayGbl = createOffloadMaptypes(Mapping, MaptypesName);</span></CodeLine>
<Link id="l08260" /><CodeLine lineNumber="8260"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.MapTypesArray = MapTypesArrayGbl;</span></CodeLine>
<Link id="l08261" /><CodeLine lineNumber="8261"></CodeLine>
<Link id="l08262" /><CodeLine lineNumber="8262"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The information types are only built if provided.</span></CodeLine>
<Link id="l08263" /><CodeLine lineNumber="8263"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CombinedInfo.Names.empty()) &#123;</span></CodeLine>
<Link id="l08264" /><CodeLine lineNumber="8264"><span class="doxyHighlight">    std::string MapnamesName = <a href="/docs/api/classes/llvm/openmpirbuilder/#a488c861f8a68e5f78ceca8b57acd8be5">createPlatformSpecificName</a>(&#123;</span><span class="doxyHighlightStringLiteral">&quot;offload&#95;mapnames&quot;</span><span class="doxyHighlight">&#125;);</span></CodeLine>
<Link id="l08265" /><CodeLine lineNumber="8265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MapNamesArrayGbl =</span></CodeLine>
<Link id="l08266" /><CodeLine lineNumber="8266"><span class="doxyHighlight">        createOffloadMapnames(CombinedInfo.Names, MapnamesName);</span></CodeLine>
<Link id="l08267" /><CodeLine lineNumber="8267"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.MapNamesArray = MapNamesArrayGbl;</span></CodeLine>
<Link id="l08268" /><CodeLine lineNumber="8268"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.EmitDebug = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08269" /><CodeLine lineNumber="8269"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08270" /><CodeLine lineNumber="8270"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.MapNamesArray =</span></CodeLine>
<Link id="l08271" /><CodeLine lineNumber="8271"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa2ed385be8984b4306762990278eb13d">getContext</a>()));</span></CodeLine>
<Link id="l08272" /><CodeLine lineNumber="8272"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.EmitDebug = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08273" /><CodeLine lineNumber="8273"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08274" /><CodeLine lineNumber="8274"></CodeLine>
<Link id="l08275" /><CodeLine lineNumber="8275"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there&#39;s a present map type modifier, it must not be applied to the end</span></CodeLine>
<Link id="l08276" /><CodeLine lineNumber="8276"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of a region, so generate a separate map type array in that case.</span></CodeLine>
<Link id="l08277" /><CodeLine lineNumber="8277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.separateBeginEndCalls()) &#123;</span></CodeLine>
<Link id="l08278" /><CodeLine lineNumber="8278"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EndMapTypesDiffer = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08279" /><CodeLine lineNumber="8279"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (uint64&#95;t &amp;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> : Mapping) &#123;</span></CodeLine>
<Link id="l08280" /><CodeLine lineNumber="8280"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &amp; </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l08281" /><CodeLine lineNumber="8281"><span class="doxyHighlight">                     OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;PRESENT)) &#123;</span></CodeLine>
<Link id="l08282" /><CodeLine lineNumber="8282"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &amp;= ~static&#95;cast&lt;std::underlying&#95;type&#95;t&lt;OpenMPOffloadMappingFlags&gt;&gt;(</span></CodeLine>
<Link id="l08283" /><CodeLine lineNumber="8283"><span class="doxyHighlight">            OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;PRESENT);</span></CodeLine>
<Link id="l08284" /><CodeLine lineNumber="8284"><span class="doxyHighlight">        EndMapTypesDiffer = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08285" /><CodeLine lineNumber="8285"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08286" /><CodeLine lineNumber="8286"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08287" /><CodeLine lineNumber="8287"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EndMapTypesDiffer) &#123;</span></CodeLine>
<Link id="l08288" /><CodeLine lineNumber="8288"><span class="doxyHighlight">      MapTypesArrayGbl = createOffloadMaptypes(Mapping, MaptypesName);</span></CodeLine>
<Link id="l08289" /><CodeLine lineNumber="8289"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.MapTypesArrayEnd = MapTypesArrayGbl;</span></CodeLine>
<Link id="l08290" /><CodeLine lineNumber="8290"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08291" /><CodeLine lineNumber="8291"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08292" /><CodeLine lineNumber="8292"></CodeLine>
<Link id="l08293" /><CodeLine lineNumber="8293"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/pdb/#a33e853ec74d48b1340d1d4bae772d30bae385c38bb67ea909198e13ee23c21028">PointerType</a> &#42;PtrTy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>();</span></CodeLine>
<Link id="l08294" /><CodeLine lineNumber="8294"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l08295" /><CodeLine lineNumber="8295"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BPVal = CombinedInfo.BasePointers&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l08296" /><CodeLine lineNumber="8296"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;BP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l08297" /><CodeLine lineNumber="8297"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(PtrTy, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs), <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.BasePointersArray,</span></CodeLine>
<Link id="l08298" /><CodeLine lineNumber="8298"><span class="doxyHighlight">        0, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08299" /><CodeLine lineNumber="8299"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(BPVal, BP,</span></CodeLine>
<Link id="l08300" /><CodeLine lineNumber="8300"><span class="doxyHighlight">                               <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(PtrTy));</span></CodeLine>
<Link id="l08301" /><CodeLine lineNumber="8301"></CodeLine>
<Link id="l08302" /><CodeLine lineNumber="8302"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.requiresDevicePointerInfo()) &#123;</span></CodeLine>
<Link id="l08303" /><CodeLine lineNumber="8303"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CombinedInfo.DevicePointers&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; == DeviceInfoTy::Pointer) &#123;</span></CodeLine>
<Link id="l08304" /><CodeLine lineNumber="8304"><span class="doxyHighlight">        CodeGenIP = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l08305" /><CodeLine lineNumber="8305"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l08306" /><CodeLine lineNumber="8306"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.DevicePtrInfoMap&#91;BPVal&#93; = &#123;BP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(PtrTy)&#125;;</span></CodeLine>
<Link id="l08307" /><CodeLine lineNumber="8307"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(CodeGenIP);</span></CodeLine>
<Link id="l08308" /><CodeLine lineNumber="8308"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DeviceAddrCB)</span></CodeLine>
<Link id="l08309" /><CodeLine lineNumber="8309"><span class="doxyHighlight">          DeviceAddrCB(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.DevicePtrInfoMap&#91;BPVal&#93;.second);</span></CodeLine>
<Link id="l08310" /><CodeLine lineNumber="8310"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CombinedInfo.DevicePointers&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; == DeviceInfoTy::Address) &#123;</span></CodeLine>
<Link id="l08311" /><CodeLine lineNumber="8311"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.DevicePtrInfoMap&#91;BPVal&#93; = &#123;BP, BP&#125;;</span></CodeLine>
<Link id="l08312" /><CodeLine lineNumber="8312"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DeviceAddrCB)</span></CodeLine>
<Link id="l08313" /><CodeLine lineNumber="8313"><span class="doxyHighlight">          DeviceAddrCB(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, BP);</span></CodeLine>
<Link id="l08314" /><CodeLine lineNumber="8314"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08315" /><CodeLine lineNumber="8315"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08316" /><CodeLine lineNumber="8316"></CodeLine>
<Link id="l08317" /><CodeLine lineNumber="8317"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PVal = CombinedInfo.Pointers&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l08318" /><CodeLine lineNumber="8318"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l08319" /><CodeLine lineNumber="8319"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(PtrTy, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs), <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.PointersArray, 0,</span></CodeLine>
<Link id="l08320" /><CodeLine lineNumber="8320"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08321" /><CodeLine lineNumber="8321"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Check alignment correct.</span></CodeLine>
<Link id="l08322" /><CodeLine lineNumber="8322"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(PVal, <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>,</span></CodeLine>
<Link id="l08323" /><CodeLine lineNumber="8323"><span class="doxyHighlight">                               <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(PtrTy));</span></CodeLine>
<Link id="l08324" /><CodeLine lineNumber="8324"></CodeLine>
<Link id="l08325" /><CodeLine lineNumber="8325"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RuntimeSizes.test(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08326" /><CodeLine lineNumber="8326"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;S = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa85037712ab4c5044582974769aa4b62">CreateConstInBoundsGEP2&#95;32</a>(</span></CodeLine>
<Link id="l08327" /><CodeLine lineNumber="8327"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(Int64Ty, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs), <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.RTArgs.SizesArray,</span></CodeLine>
<Link id="l08328" /><CodeLine lineNumber="8328"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">/&#42;Idx0=&#42;/</span><span class="doxyHighlight">0,</span></CodeLine>
<Link id="l08329" /><CodeLine lineNumber="8329"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">/&#42;Idx1=&#42;/</span><span class="doxyHighlight"><a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08330" /><CodeLine lineNumber="8330"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac79ca3c2d2d74cf33684397a91846564">CreateIntCast</a>(CombinedInfo.Sizes&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;,</span></CodeLine>
<Link id="l08331" /><CodeLine lineNumber="8331"><span class="doxyHighlight">                                                       Int64Ty,</span></CodeLine>
<Link id="l08332" /><CodeLine lineNumber="8332"><span class="doxyHighlight">                                                       </span><span class="doxyHighlightComment">/&#42;isSigned=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l08333" /><CodeLine lineNumber="8333"><span class="doxyHighlight">                                 S, <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(PtrTy));</span></CodeLine>
<Link id="l08334" /><CodeLine lineNumber="8334"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08335" /><CodeLine lineNumber="8335"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Fill up the mapper array.</span></CodeLine>
<Link id="l08336" /><CodeLine lineNumber="8336"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IndexSize = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getIndexSizeInBits(0);</span></CodeLine>
<Link id="l08337" /><CodeLine lineNumber="8337"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;MFunc = <a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(PtrTy);</span></CodeLine>
<Link id="l08338" /><CodeLine lineNumber="8338"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CustomMapperCB)</span></CodeLine>
<Link id="l08339" /><CodeLine lineNumber="8339"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;CustomMFunc = CustomMapperCB(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l08340" /><CodeLine lineNumber="8340"><span class="doxyHighlight">        MFunc = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a3ef26a11123d639b64307cc3c1b869b9">CreatePointerCast</a>(CustomMFunc, PtrTy);</span></CodeLine>
<Link id="l08341" /><CodeLine lineNumber="8341"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;MAddr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a64b6c97b8faad5ec83f37d906fca7bc4">CreateInBoundsGEP</a>(</span></CodeLine>
<Link id="l08342" /><CodeLine lineNumber="8342"><span class="doxyHighlight">        MappersArray-&gt;<a href="/docs/api/classes/llvm/allocainst/#a9b5ec84ea363eca9e35ddca20a5313af">getAllocatedType</a>(), MappersArray,</span></CodeLine>
<Link id="l08343" /><CodeLine lineNumber="8343"><span class="doxyHighlight">        &#123;Builder.getIntN(IndexSize, 0), Builder.getIntN(IndexSize, I)&#125;);</span></CodeLine>
<Link id="l08344" /><CodeLine lineNumber="8344"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ad4e4b11a1bf18be51b28b7fadfaa97d6">CreateAlignedStore</a>(</span></CodeLine>
<Link id="l08345" /><CodeLine lineNumber="8345"><span class="doxyHighlight">        MFunc, MAddr, <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getDataLayout().getPrefTypeAlign(MAddr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l08346" /><CodeLine lineNumber="8346"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08347" /><CodeLine lineNumber="8347"></CodeLine>
<Link id="l08348" /><CodeLine lineNumber="8348"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsNonContiguous || CombinedInfo.NonContigInfo.Offsets.empty() ||</span></CodeLine>
<Link id="l08349" /><CodeLine lineNumber="8349"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.NumberOfPtrs == 0)</span></CodeLine>
<Link id="l08350" /><CodeLine lineNumber="8350"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08351" /><CodeLine lineNumber="8351"><span class="doxyHighlight">  emitNonContiguousDescriptor(AllocaIP, CodeGenIP, CombinedInfo, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>);</span></CodeLine>
<Link id="l08352" /><CodeLine lineNumber="8352"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08353" /><CodeLine lineNumber="8353"></CodeLine>
<Link id="l08354" /><CodeLine lineNumber="8354"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitBranch(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/target">Target</a>) &#123;</span></CodeLine>
<Link id="l08355" /><CodeLine lineNumber="8355"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CurBB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l08356" /><CodeLine lineNumber="8356"></CodeLine>
<Link id="l08357" /><CodeLine lineNumber="8357"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurBB || CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()) &#123;</span></CodeLine>
<Link id="l08358" /><CodeLine lineNumber="8358"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there is no insert point or the previous block is already</span></CodeLine>
<Link id="l08359" /><CodeLine lineNumber="8359"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// terminated, don&#39;t touch it.</span></CodeLine>
<Link id="l08360" /><CodeLine lineNumber="8360"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08361" /><CodeLine lineNumber="8361"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, create a fall-through branch.</span></CodeLine>
<Link id="l08362" /><CodeLine lineNumber="8362"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(<a href="/docs/api/namespaces/llvm/omp/#afeaad9a7fc12d9246c2e42578fddc718ac41a31890959544c6523af684561abe5">Target</a>);</span></CodeLine>
<Link id="l08363" /><CodeLine lineNumber="8363"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08364" /><CodeLine lineNumber="8364"></CodeLine>
<Link id="l08365" /><CodeLine lineNumber="8365"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abfaa2c91fd145d6b7e623cabd26ec1de">ClearInsertionPoint</a>();</span></CodeLine>
<Link id="l08366" /><CodeLine lineNumber="8366"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08367" /><CodeLine lineNumber="8367"></CodeLine>
<Link id="l08368" /><CodeLine lineNumber="8368"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::emitBlock(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/function">Function</a> &#42;CurFn,</span></CodeLine>
<Link id="l08369" /><CodeLine lineNumber="8369"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsFinished) &#123;</span></CodeLine>
<Link id="l08370" /><CodeLine lineNumber="8370"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CurBB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l08371" /><CodeLine lineNumber="8371"></CodeLine>
<Link id="l08372" /><CodeLine lineNumber="8372"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Fall out of the current block (if necessary).</span></CodeLine>
<Link id="l08373" /><CodeLine lineNumber="8373"><span class="doxyHighlight">  emitBranch(BB);</span></CodeLine>
<Link id="l08374" /><CodeLine lineNumber="8374"></CodeLine>
<Link id="l08375" /><CodeLine lineNumber="8375"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsFinished &amp;&amp; BB-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>()) &#123;</span></CodeLine>
<Link id="l08376" /><CodeLine lineNumber="8376"><span class="doxyHighlight">    BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</span></CodeLine>
<Link id="l08377" /><CodeLine lineNumber="8377"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08378" /><CodeLine lineNumber="8378"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08379" /><CodeLine lineNumber="8379"></CodeLine>
<Link id="l08380" /><CodeLine lineNumber="8380"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Place the block after the current block, if possible, or else at</span></CodeLine>
<Link id="l08381" /><CodeLine lineNumber="8381"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the end of the function.</span></CodeLine>
<Link id="l08382" /><CodeLine lineNumber="8382"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurBB &amp;&amp; CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>())</span></CodeLine>
<Link id="l08383" /><CodeLine lineNumber="8383"><span class="doxyHighlight">    CurFn-&gt;<a href="/docs/api/classes/llvm/function/#aaab8110aafc070c83bc701b13d2260df">insert</a>(std::next(CurBB-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>()), BB);</span></CodeLine>
<Link id="l08384" /><CodeLine lineNumber="8384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08385" /><CodeLine lineNumber="8385"><span class="doxyHighlight">    CurFn-&gt;<a href="/docs/api/classes/llvm/function/#aaab8110aafc070c83bc701b13d2260df">insert</a>(CurFn-&gt;<a href="/docs/api/classes/llvm/function/#ae4ca2261b8b901e415fda7feac5051ea">end</a>(), BB);</span></CodeLine>
<Link id="l08386" /><CodeLine lineNumber="8386"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(BB);</span></CodeLine>
<Link id="l08387" /><CodeLine lineNumber="8387"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08388" /><CodeLine lineNumber="8388"></CodeLine>
<Link id="l08389" /><CodeLine lineNumber="8389"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/error">Error</a> OpenMPIRBuilder::emitIfClause(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, BodyGenCallbackTy ThenGen,</span></CodeLine>
<Link id="l08390" /><CodeLine lineNumber="8390"><span class="doxyHighlight">                                    BodyGenCallbackTy ElseGen,</span></CodeLine>
<Link id="l08391" /><CodeLine lineNumber="8391"><span class="doxyHighlight">                                    InsertPointTy AllocaIP) &#123;</span></CodeLine>
<Link id="l08392" /><CodeLine lineNumber="8392"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the condition constant folds and can be elided, try to avoid emitting</span></CodeLine>
<Link id="l08393" /><CodeLine lineNumber="8393"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the condition and the dead arm of the if/else.</span></CodeLine>
<Link id="l08394" /><CodeLine lineNumber="8394"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</span></CodeLine>
<Link id="l08395" /><CodeLine lineNumber="8395"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CondConstant = CI-&gt;getSExtValue();</span></CodeLine>
<Link id="l08396" /><CodeLine lineNumber="8396"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CondConstant)</span></CodeLine>
<Link id="l08397" /><CodeLine lineNumber="8397"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ThenGen(AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>());</span></CodeLine>
<Link id="l08398" /><CodeLine lineNumber="8398"></CodeLine>
<Link id="l08399" /><CodeLine lineNumber="8399"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ElseGen(AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>());</span></CodeLine>
<Link id="l08400" /><CodeLine lineNumber="8400"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08401" /><CodeLine lineNumber="8401"></CodeLine>
<Link id="l08402" /><CodeLine lineNumber="8402"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;CurFn = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l08403" /><CodeLine lineNumber="8403"></CodeLine>
<Link id="l08404" /><CodeLine lineNumber="8404"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, the condition did not fold, or we couldn&#39;t elide it.  Just</span></CodeLine>
<Link id="l08405" /><CodeLine lineNumber="8405"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// emit the conditional branch.</span></CodeLine>
<Link id="l08406" /><CodeLine lineNumber="8406"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ThenBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;if.then&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08407" /><CodeLine lineNumber="8407"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ElseBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;if.else&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08408" /><CodeLine lineNumber="8408"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ContBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;if.end&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08409" /><CodeLine lineNumber="8409"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, ThenBlock, ElseBlock);</span></CodeLine>
<Link id="l08410" /><CodeLine lineNumber="8410"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit the &#39;then&#39; code.</span></CodeLine>
<Link id="l08411" /><CodeLine lineNumber="8411"><span class="doxyHighlight">  emitBlock(ThenBlock, CurFn);</span></CodeLine>
<Link id="l08412" /><CodeLine lineNumber="8412"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = ThenGen(AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>()))</span></CodeLine>
<Link id="l08413" /><CodeLine lineNumber="8413"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l08414" /><CodeLine lineNumber="8414"><span class="doxyHighlight">  emitBranch(ContBlock);</span></CodeLine>
<Link id="l08415" /><CodeLine lineNumber="8415"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit the &#39;else&#39; code if present.</span></CodeLine>
<Link id="l08416" /><CodeLine lineNumber="8416"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// There is no need to emit line number for unconditional branch.</span></CodeLine>
<Link id="l08417" /><CodeLine lineNumber="8417"><span class="doxyHighlight">  emitBlock(ElseBlock, CurFn);</span></CodeLine>
<Link id="l08418" /><CodeLine lineNumber="8418"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = ElseGen(AllocaIP, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>()))</span></CodeLine>
<Link id="l08419" /><CodeLine lineNumber="8419"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l08420" /><CodeLine lineNumber="8420"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// There is no need to emit line number for unconditional branch.</span></CodeLine>
<Link id="l08421" /><CodeLine lineNumber="8421"><span class="doxyHighlight">  emitBranch(ContBlock);</span></CodeLine>
<Link id="l08422" /><CodeLine lineNumber="8422"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit the continuation block for code after the if.</span></CodeLine>
<Link id="l08423" /><CodeLine lineNumber="8423"><span class="doxyHighlight">  emitBlock(ContBlock, CurFn, </span><span class="doxyHighlightComment">/&#42;IsFinished=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08424" /><CodeLine lineNumber="8424"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/error/#a4dfd0813c3d0e0a30439b5a3e9196b59">Error::success</a>();</span></CodeLine>
<Link id="l08425" /><CodeLine lineNumber="8425"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08426" /><CodeLine lineNumber="8426"></CodeLine>
<Link id="l08427" /><CodeLine lineNumber="8427"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OpenMPIRBuilder::checkAndEmitFlushAfterAtomic(</span></CodeLine>
<Link id="l08428" /><CodeLine lineNumber="8428"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">llvm::AtomicOrdering</a> AO, AtomicKind AK) &#123;</span></CodeLine>
<Link id="l08429" /><CodeLine lineNumber="8429"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!(AO == <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a56a57d29a3f9dda8671b4d6490a94b08">AtomicOrdering::NotAtomic</a> ||</span></CodeLine>
<Link id="l08430" /><CodeLine lineNumber="8430"><span class="doxyHighlight">           AO == <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a288d468c5e0969f26a310773eda65603">llvm::AtomicOrdering::Unordered</a>) &amp;&amp;</span></CodeLine>
<Link id="l08431" /><CodeLine lineNumber="8431"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected Atomic Ordering.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08432" /><CodeLine lineNumber="8432"></CodeLine>
<Link id="l08433" /><CodeLine lineNumber="8433"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Flush = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08434" /><CodeLine lineNumber="8434"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">llvm::AtomicOrdering</a> FlushAO = <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a14194d0b2e6c6680067975517cd58eac">AtomicOrdering::Monotonic</a>;</span></CodeLine>
<Link id="l08435" /><CodeLine lineNumber="8435"></CodeLine>
<Link id="l08436" /><CodeLine lineNumber="8436"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (AK) &#123;</span></CodeLine>
<Link id="l08437" /><CodeLine lineNumber="8437"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a171c000a87a56f9b4c9b4e3f43c5facfa33af1aad55fa136e2ab54409f4b4891f">Read</a>:</span></CodeLine>
<Link id="l08438" /><CodeLine lineNumber="8438"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AO == <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a993ca650a85e8e69b8f7eaa4809c4862">AtomicOrdering::Acquire</a> || AO == <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a960fbd067612ca87e16d5dfdb12fe40a">AtomicOrdering::AcquireRelease</a> ||</span></CodeLine>
<Link id="l08439" /><CodeLine lineNumber="8439"><span class="doxyHighlight">        AO == <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7ae3b0fa849dbd758b450f98fcfde936a2">AtomicOrdering::SequentiallyConsistent</a>) &#123;</span></CodeLine>
<Link id="l08440" /><CodeLine lineNumber="8440"><span class="doxyHighlight">      FlushAO = <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a993ca650a85e8e69b8f7eaa4809c4862">AtomicOrdering::Acquire</a>;</span></CodeLine>
<Link id="l08441" /><CodeLine lineNumber="8441"><span class="doxyHighlight">      Flush = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08442" /><CodeLine lineNumber="8442"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08443" /><CodeLine lineNumber="8443"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08444" /><CodeLine lineNumber="8444"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a171c000a87a56f9b4c9b4e3f43c5facfa738b693496ce85aba70051f0aa8722bd">Write</a>:</span></CodeLine>
<Link id="l08445" /><CodeLine lineNumber="8445"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/mcid/#ab357441fcd1ea1f9b0d27c12700f6023a1328ed43be8173506f59f88c9bfd8b8c">Compare</a>:</span></CodeLine>
<Link id="l08446" /><CodeLine lineNumber="8446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Update:</span></CodeLine>
<Link id="l08447" /><CodeLine lineNumber="8447"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AO == <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7ab8e7b465df7c5979dc731d06e84ce2cf">AtomicOrdering::Release</a> || AO == <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a960fbd067612ca87e16d5dfdb12fe40a">AtomicOrdering::AcquireRelease</a> ||</span></CodeLine>
<Link id="l08448" /><CodeLine lineNumber="8448"><span class="doxyHighlight">        AO == <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7ae3b0fa849dbd758b450f98fcfde936a2">AtomicOrdering::SequentiallyConsistent</a>) &#123;</span></CodeLine>
<Link id="l08449" /><CodeLine lineNumber="8449"><span class="doxyHighlight">      FlushAO = <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7ab8e7b465df7c5979dc731d06e84ce2cf">AtomicOrdering::Release</a>;</span></CodeLine>
<Link id="l08450" /><CodeLine lineNumber="8450"><span class="doxyHighlight">      Flush = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08451" /><CodeLine lineNumber="8451"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08452" /><CodeLine lineNumber="8452"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08453" /><CodeLine lineNumber="8453"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Capture:</span></CodeLine>
<Link id="l08454" /><CodeLine lineNumber="8454"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (AO) &#123;</span></CodeLine>
<Link id="l08455" /><CodeLine lineNumber="8455"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a993ca650a85e8e69b8f7eaa4809c4862">AtomicOrdering::Acquire</a>:</span></CodeLine>
<Link id="l08456" /><CodeLine lineNumber="8456"><span class="doxyHighlight">      FlushAO = <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a993ca650a85e8e69b8f7eaa4809c4862">AtomicOrdering::Acquire</a>;</span></CodeLine>
<Link id="l08457" /><CodeLine lineNumber="8457"><span class="doxyHighlight">      Flush = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08458" /><CodeLine lineNumber="8458"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08459" /><CodeLine lineNumber="8459"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7ab8e7b465df7c5979dc731d06e84ce2cf">AtomicOrdering::Release</a>:</span></CodeLine>
<Link id="l08460" /><CodeLine lineNumber="8460"><span class="doxyHighlight">      FlushAO = <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7ab8e7b465df7c5979dc731d06e84ce2cf">AtomicOrdering::Release</a>;</span></CodeLine>
<Link id="l08461" /><CodeLine lineNumber="8461"><span class="doxyHighlight">      Flush = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08462" /><CodeLine lineNumber="8462"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08463" /><CodeLine lineNumber="8463"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a960fbd067612ca87e16d5dfdb12fe40a">AtomicOrdering::AcquireRelease</a>:</span></CodeLine>
<Link id="l08464" /><CodeLine lineNumber="8464"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7ae3b0fa849dbd758b450f98fcfde936a2">AtomicOrdering::SequentiallyConsistent</a>:</span></CodeLine>
<Link id="l08465" /><CodeLine lineNumber="8465"><span class="doxyHighlight">      FlushAO = <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7a960fbd067612ca87e16d5dfdb12fe40a">AtomicOrdering::AcquireRelease</a>;</span></CodeLine>
<Link id="l08466" /><CodeLine lineNumber="8466"><span class="doxyHighlight">      Flush = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08467" /><CodeLine lineNumber="8467"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08468" /><CodeLine lineNumber="8468"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l08469" /><CodeLine lineNumber="8469"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// do nothing - leave silently.</span></CodeLine>
<Link id="l08470" /><CodeLine lineNumber="8470"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08471" /><CodeLine lineNumber="8471"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08472" /><CodeLine lineNumber="8472"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08473" /><CodeLine lineNumber="8473"></CodeLine>
<Link id="l08474" /><CodeLine lineNumber="8474"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Flush) &#123;</span></CodeLine>
<Link id="l08475" /><CodeLine lineNumber="8475"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Currently Flush RT call still doesn&#39;t take memory&#95;ordering, so for when</span></CodeLine>
<Link id="l08476" /><CodeLine lineNumber="8476"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that happens, this tries to do the resolution of which atomic ordering</span></CodeLine>
<Link id="l08477" /><CodeLine lineNumber="8477"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to use with but issue the flush call</span></CodeLine>
<Link id="l08478" /><CodeLine lineNumber="8478"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: pass &#96;FlushAO&#96; after memory ordering support is added</span></CodeLine>
<Link id="l08479" /><CodeLine lineNumber="8479"><span class="doxyHighlight">    (void)FlushAO;</span></CodeLine>
<Link id="l08480" /><CodeLine lineNumber="8480"><span class="doxyHighlight">    emitFlush(Loc);</span></CodeLine>
<Link id="l08481" /><CodeLine lineNumber="8481"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08482" /><CodeLine lineNumber="8482"></CodeLine>
<Link id="l08483" /><CodeLine lineNumber="8483"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for AO == AtomicOrdering::Monotonic and  all other case combinations</span></CodeLine>
<Link id="l08484" /><CodeLine lineNumber="8484"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// do nothing</span></CodeLine>
<Link id="l08485" /><CodeLine lineNumber="8485"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Flush;</span></CodeLine>
<Link id="l08486" /><CodeLine lineNumber="8486"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08487" /><CodeLine lineNumber="8487"></CodeLine>
<Link id="l08488" /><CodeLine lineNumber="8488"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a></span></CodeLine>
<Link id="l08489" /><CodeLine lineNumber="8489"><span class="doxyHighlight">OpenMPIRBuilder::createAtomicRead(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l08490" /><CodeLine lineNumber="8490"><span class="doxyHighlight">                                  AtomicOpValue &amp;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, AtomicOpValue &amp;V,</span></CodeLine>
<Link id="l08491" /><CodeLine lineNumber="8491"><span class="doxyHighlight">                                  <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> AO) &#123;</span></CodeLine>
<Link id="l08492" /><CodeLine lineNumber="8492"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l08493" /><CodeLine lineNumber="8493"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Loc.IP;</span></CodeLine>
<Link id="l08494" /><CodeLine lineNumber="8494"></CodeLine>
<Link id="l08495" /><CodeLine lineNumber="8495"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var-&gt;getType()-&gt;isPointerTy() &amp;&amp;</span></CodeLine>
<Link id="l08496" /><CodeLine lineNumber="8496"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;OMP Atomic expects a pointer to target memory&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08497" /><CodeLine lineNumber="8497"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;XElemTy = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.ElemTy;</span></CodeLine>
<Link id="l08498" /><CodeLine lineNumber="8498"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>() || XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</span></CodeLine>
<Link id="l08499" /><CodeLine lineNumber="8499"><span class="doxyHighlight">          XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() || XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>()) &amp;&amp;</span></CodeLine>
<Link id="l08500" /><CodeLine lineNumber="8500"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;OMP atomic read expected a scalar type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08501" /><CodeLine lineNumber="8501"></CodeLine>
<Link id="l08502" /><CodeLine lineNumber="8502"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;XRead = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08503" /><CodeLine lineNumber="8503"></CodeLine>
<Link id="l08504" /><CodeLine lineNumber="8504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>()) &#123;</span></CodeLine>
<Link id="l08505" /><CodeLine lineNumber="8505"><span class="doxyHighlight">    LoadInst &#42;XLD =</span></CodeLine>
<Link id="l08506" /><CodeLine lineNumber="8506"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(XElemTy, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.IsVolatile, </span><span class="doxyHighlightStringLiteral">&quot;omp.atomic.read&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08507" /><CodeLine lineNumber="8507"><span class="doxyHighlight">    XLD-&gt;<a href="/docs/api/classes/llvm/loadinst/#a6ae88dc44b078c80ce3a25401fd4b05b">setAtomic</a>(AO);</span></CodeLine>
<Link id="l08508" /><CodeLine lineNumber="8508"><span class="doxyHighlight">    XRead = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Value&gt;</a>(XLD);</span></CodeLine>
<Link id="l08509" /><CodeLine lineNumber="8509"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>()) &#123;</span></CodeLine>
<Link id="l08510" /><CodeLine lineNumber="8510"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Add checks to ensure &#95;&#95;atomic&#95;load is emitted iff the</span></CodeLine>
<Link id="l08511" /><CodeLine lineNumber="8511"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// target does not support &#96;atomicrmw&#96; of the size of the struct</span></CodeLine>
<Link id="l08512" /><CodeLine lineNumber="8512"><span class="doxyHighlight">    LoadInst &#42;OldVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(XElemTy, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var, </span><span class="doxyHighlightStringLiteral">&quot;omp.atomic.read&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08513" /><CodeLine lineNumber="8513"><span class="doxyHighlight">    OldVal-&gt;<a href="/docs/api/classes/llvm/loadinst/#a6ae88dc44b078c80ce3a25401fd4b05b">setAtomic</a>(AO);</span></CodeLine>
<Link id="l08514" /><CodeLine lineNumber="8514"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;LoadDL = OldVal-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>()-&gt;<a href="/docs/api/classes/llvm/module/#abcbe492bce3ccc16e0bbb50292576c5c">getDataLayout</a>();</span></CodeLine>
<Link id="l08515" /><CodeLine lineNumber="8515"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LoadSize =</span></CodeLine>
<Link id="l08516" /><CodeLine lineNumber="8516"><span class="doxyHighlight">        LoadDL.<a href="/docs/api/classes/llvm/datalayout/#acfcd22eb38dbfe1acbf138754297437a">getTypeStoreSize</a>(OldVal-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l08517" /><CodeLine lineNumber="8517"><span class="doxyHighlight">    OpenMPIRBuilder::AtomicInfo atomicInfo(</span></CodeLine>
<Link id="l08518" /><CodeLine lineNumber="8518"><span class="doxyHighlight">        &amp;Builder, XElemTy, LoadSize &#42; 8, LoadSize &#42; 8, OldVal-&gt;<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(),</span></CodeLine>
<Link id="l08519" /><CodeLine lineNumber="8519"><span class="doxyHighlight">        OldVal-&gt;<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42; UseLibcall &#42;/</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var);</span></CodeLine>
<Link id="l08520" /><CodeLine lineNumber="8520"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AtomicLoadRes = atomicInfo.EmitAtomicLoadLibcall(AO);</span></CodeLine>
<Link id="l08521" /><CodeLine lineNumber="8521"><span class="doxyHighlight">    XRead = AtomicLoadRes.first;</span></CodeLine>
<Link id="l08522" /><CodeLine lineNumber="8522"><span class="doxyHighlight">    OldVal-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l08523" /><CodeLine lineNumber="8523"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08524" /><CodeLine lineNumber="8524"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We need to perform atomic op as integer</span></CodeLine>
<Link id="l08525" /><CodeLine lineNumber="8525"><span class="doxyHighlight">    IntegerType &#42;IntCastTy =</span></CodeLine>
<Link id="l08526" /><CodeLine lineNumber="8526"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>());</span></CodeLine>
<Link id="l08527" /><CodeLine lineNumber="8527"><span class="doxyHighlight">    LoadInst &#42;XLoad =</span></CodeLine>
<Link id="l08528" /><CodeLine lineNumber="8528"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(IntCastTy, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.IsVolatile, </span><span class="doxyHighlightStringLiteral">&quot;omp.atomic.load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08529" /><CodeLine lineNumber="8529"><span class="doxyHighlight">    XLoad-&gt;<a href="/docs/api/classes/llvm/loadinst/#a6ae88dc44b078c80ce3a25401fd4b05b">setAtomic</a>(AO);</span></CodeLine>
<Link id="l08530" /><CodeLine lineNumber="8530"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()) &#123;</span></CodeLine>
<Link id="l08531" /><CodeLine lineNumber="8531"><span class="doxyHighlight">      XRead = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(XLoad, XElemTy, </span><span class="doxyHighlightStringLiteral">&quot;atomic.flt.cast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08532" /><CodeLine lineNumber="8532"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08533" /><CodeLine lineNumber="8533"><span class="doxyHighlight">      XRead = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a53541ed6f92b18419f937f1f969aa0f6">CreateIntToPtr</a>(XLoad, XElemTy, </span><span class="doxyHighlightStringLiteral">&quot;atomic.ptr.cast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08534" /><CodeLine lineNumber="8534"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08535" /><CodeLine lineNumber="8535"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08536" /><CodeLine lineNumber="8536"><span class="doxyHighlight">  checkAndEmitFlushAfterAtomic(Loc, AO, AtomicKind::Read);</span></CodeLine>
<Link id="l08537" /><CodeLine lineNumber="8537"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XRead-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>.Var-&gt;getType())</span></CodeLine>
<Link id="l08538" /><CodeLine lineNumber="8538"><span class="doxyHighlight">    XRead = <a href="#a91b7eb2a05d10c788413bec7977f3474">emitImplicitCast</a>(Builder, XRead, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>.Var);</span></CodeLine>
<Link id="l08539" /><CodeLine lineNumber="8539"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(XRead, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>.Var, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>.IsVolatile);</span></CodeLine>
<Link id="l08540" /><CodeLine lineNumber="8540"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l08541" /><CodeLine lineNumber="8541"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08542" /><CodeLine lineNumber="8542"></CodeLine>
<Link id="l08543" /><CodeLine lineNumber="8543"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a></span></CodeLine>
<Link id="l08544" /><CodeLine lineNumber="8544"><span class="doxyHighlight">OpenMPIRBuilder::createAtomicWrite(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l08545" /><CodeLine lineNumber="8545"><span class="doxyHighlight">                                   AtomicOpValue &amp;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Expr,</span></CodeLine>
<Link id="l08546" /><CodeLine lineNumber="8546"><span class="doxyHighlight">                                   <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> AO) &#123;</span></CodeLine>
<Link id="l08547" /><CodeLine lineNumber="8547"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(Loc))</span></CodeLine>
<Link id="l08548" /><CodeLine lineNumber="8548"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Loc.IP;</span></CodeLine>
<Link id="l08549" /><CodeLine lineNumber="8549"></CodeLine>
<Link id="l08550" /><CodeLine lineNumber="8550"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var-&gt;getType()-&gt;isPointerTy() &amp;&amp;</span></CodeLine>
<Link id="l08551" /><CodeLine lineNumber="8551"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;OMP Atomic expects a pointer to target memory&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08552" /><CodeLine lineNumber="8552"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;XElemTy = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.ElemTy;</span></CodeLine>
<Link id="l08553" /><CodeLine lineNumber="8553"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>() || XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</span></CodeLine>
<Link id="l08554" /><CodeLine lineNumber="8554"><span class="doxyHighlight">          XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) &amp;&amp;</span></CodeLine>
<Link id="l08555" /><CodeLine lineNumber="8555"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;OMP atomic write expected a scalar type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08556" /><CodeLine lineNumber="8556"></CodeLine>
<Link id="l08557" /><CodeLine lineNumber="8557"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>()) &#123;</span></CodeLine>
<Link id="l08558" /><CodeLine lineNumber="8558"><span class="doxyHighlight">    StoreInst &#42;XSt = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Expr, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.IsVolatile);</span></CodeLine>
<Link id="l08559" /><CodeLine lineNumber="8559"><span class="doxyHighlight">    XSt-&gt;<a href="/docs/api/classes/llvm/storeinst/#aff28bd42ac76fc3e1c0e4db7f9e06f2d">setAtomic</a>(AO);</span></CodeLine>
<Link id="l08560" /><CodeLine lineNumber="8560"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08561" /><CodeLine lineNumber="8561"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We need to bitcast and perform atomic op as integers</span></CodeLine>
<Link id="l08562" /><CodeLine lineNumber="8562"><span class="doxyHighlight">    IntegerType &#42;IntCastTy =</span></CodeLine>
<Link id="l08563" /><CodeLine lineNumber="8563"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>());</span></CodeLine>
<Link id="l08564" /><CodeLine lineNumber="8564"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ExprCast =</span></CodeLine>
<Link id="l08565" /><CodeLine lineNumber="8565"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(Expr, IntCastTy, </span><span class="doxyHighlightStringLiteral">&quot;atomic.src.int.cast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08566" /><CodeLine lineNumber="8566"><span class="doxyHighlight">    StoreInst &#42;XSt = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(ExprCast, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.IsVolatile);</span></CodeLine>
<Link id="l08567" /><CodeLine lineNumber="8567"><span class="doxyHighlight">    XSt-&gt;<a href="/docs/api/classes/llvm/storeinst/#aff28bd42ac76fc3e1c0e4db7f9e06f2d">setAtomic</a>(AO);</span></CodeLine>
<Link id="l08568" /><CodeLine lineNumber="8568"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08569" /><CodeLine lineNumber="8569"></CodeLine>
<Link id="l08570" /><CodeLine lineNumber="8570"><span class="doxyHighlight">  checkAndEmitFlushAfterAtomic(Loc, AO, AtomicKind::Write);</span></CodeLine>
<Link id="l08571" /><CodeLine lineNumber="8571"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l08572" /><CodeLine lineNumber="8572"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08573" /><CodeLine lineNumber="8573"></CodeLine>
<Link id="l08574" /><CodeLine lineNumber="8574" lineLink="/docs/api/classes/llvm/openmpirbuilder/#ae75c4b44f208011259ee93497c2cb411"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> <a href="/docs/api/classes/llvm/openmpirbuilder/#ae75c4b44f208011259ee93497c2cb411">OpenMPIRBuilder::createAtomicUpdate</a>(</span></CodeLine>
<Link id="l08575" /><CodeLine lineNumber="8575"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AllocaIP, AtomicOpValue &amp;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>,</span></CodeLine>
<Link id="l08576" /><CodeLine lineNumber="8576"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Expr, <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> AO, <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615">AtomicRMWInst::BinOp</a> RMWOp,</span></CodeLine>
<Link id="l08577" /><CodeLine lineNumber="8577"><span class="doxyHighlight">    AtomicUpdateCallbackTy &amp;UpdateOp, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsXBinopExpr) &#123;</span></CodeLine>
<Link id="l08578" /><CodeLine lineNumber="8578"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="#a756b28f370cd5a39bc0ee3e5333b9c9b">isConflictIP</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP, AllocaIP) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;IPs must not be ambiguous&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08579" /><CodeLine lineNumber="8579"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l08580" /><CodeLine lineNumber="8580"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP;</span></CodeLine>
<Link id="l08581" /><CodeLine lineNumber="8581"></CodeLine>
<Link id="l08582" /><CodeLine lineNumber="8582"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l08583" /><CodeLine lineNumber="8583"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;XTy = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var-&gt;getType();</span></CodeLine>
<Link id="l08584" /><CodeLine lineNumber="8584"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(XTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l08585" /><CodeLine lineNumber="8585"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;OMP Atomic expects a pointer to target memory&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08586" /><CodeLine lineNumber="8586"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;XElemTy = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.ElemTy;</span></CodeLine>
<Link id="l08587" /><CodeLine lineNumber="8587"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>() || XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</span></CodeLine>
<Link id="l08588" /><CodeLine lineNumber="8588"><span class="doxyHighlight">            XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) &amp;&amp;</span></CodeLine>
<Link id="l08589" /><CodeLine lineNumber="8589"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;OMP atomic update expected a scalar type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08590" /><CodeLine lineNumber="8590"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((RMWOp != <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615aa1184a7e35e94d162a2d40f2b11beeb2">AtomicRMWInst::Max</a>) &amp;&amp; (RMWOp != <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a39edb6e51c1ad37244e8b32a2af4077d">AtomicRMWInst::Min</a>) &amp;&amp;</span></CodeLine>
<Link id="l08591" /><CodeLine lineNumber="8591"><span class="doxyHighlight">           (RMWOp != <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615abe171d96ba8de66fb30e08c00211591e">AtomicRMWInst::UMax</a>) &amp;&amp; (RMWOp != <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615aa53854e09143f57d2ff2ad6ac89dc55d">AtomicRMWInst::UMin</a>) &amp;&amp;</span></CodeLine>
<Link id="l08592" /><CodeLine lineNumber="8592"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;OpenMP atomic does not support LT or GT operations&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08593" /><CodeLine lineNumber="8593"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l08594" /><CodeLine lineNumber="8594"></CodeLine>
<Link id="l08595" /><CodeLine lineNumber="8595"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/expected">Expected&lt;std::pair&lt;Value &#42;, Value &#42;&gt;</a>&gt; AtomicResult =</span></CodeLine>
<Link id="l08596" /><CodeLine lineNumber="8596"><span class="doxyHighlight">      emitAtomicUpdate(AllocaIP, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.ElemTy, Expr, AO, RMWOp, UpdateOp,</span></CodeLine>
<Link id="l08597" /><CodeLine lineNumber="8597"><span class="doxyHighlight">                       <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.IsVolatile, IsXBinopExpr);</span></CodeLine>
<Link id="l08598" /><CodeLine lineNumber="8598"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AtomicResult)</span></CodeLine>
<Link id="l08599" /><CodeLine lineNumber="8599"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AtomicResult.takeError();</span></CodeLine>
<Link id="l08600" /><CodeLine lineNumber="8600"><span class="doxyHighlight">  checkAndEmitFlushAfterAtomic(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, AO, AtomicKind::Update);</span></CodeLine>
<Link id="l08601" /><CodeLine lineNumber="8601"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l08602" /><CodeLine lineNumber="8602"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08603" /><CodeLine lineNumber="8603"></CodeLine>
<Link id="l08604" /><CodeLine lineNumber="8604"><span class="doxyHighlightComment">// FIXME: Duplicating AtomicExpand</span></CodeLine>
<Link id="l08605" /><CodeLine lineNumber="8605"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;OpenMPIRBuilder::emitRMWOpAsInstruction(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Src1, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Src2,</span></CodeLine>
<Link id="l08606" /><CodeLine lineNumber="8606"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615">AtomicRMWInst::BinOp</a> RMWOp) &#123;</span></CodeLine>
<Link id="l08607" /><CodeLine lineNumber="8607"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (RMWOp) &#123;</span></CodeLine>
<Link id="l08608" /><CodeLine lineNumber="8608"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a0794c42b44989f9d9f1454d79ca0dd88">AtomicRMWInst::Add</a>:</span></CodeLine>
<Link id="l08609" /><CodeLine lineNumber="8609"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(Src1, Src2);</span></CodeLine>
<Link id="l08610" /><CodeLine lineNumber="8610"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a5db6ca0c3e18acd87290f22ccb2ce564">AtomicRMWInst::Sub</a>:</span></CodeLine>
<Link id="l08611" /><CodeLine lineNumber="8611"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(Src1, Src2);</span></CodeLine>
<Link id="l08612" /><CodeLine lineNumber="8612"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a660a31179bfecd737a256372e5fd6122">AtomicRMWInst::And</a>:</span></CodeLine>
<Link id="l08613" /><CodeLine lineNumber="8613"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(Src1, Src2);</span></CodeLine>
<Link id="l08614" /><CodeLine lineNumber="8614"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615afdcdc631cf4fa6829fd7499cd06a306b">AtomicRMWInst::Nand</a>:</span></CodeLine>
<Link id="l08615" /><CodeLine lineNumber="8615"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a7704bf68951054ffeb3efe605750e2d9">CreateNeg</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(Src1, Src2));</span></CodeLine>
<Link id="l08616" /><CodeLine lineNumber="8616"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a5954f59053121b87ebe0c5fe79942c6e">AtomicRMWInst::Or</a>:</span></CodeLine>
<Link id="l08617" /><CodeLine lineNumber="8617"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab61be8e3cf17e9848aeeeabacfa1b09a">CreateOr</a>(Src1, Src2);</span></CodeLine>
<Link id="l08618" /><CodeLine lineNumber="8618"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a71aab8ee954b6d71a4eed315e8f6556e">AtomicRMWInst::Xor</a>:</span></CodeLine>
<Link id="l08619" /><CodeLine lineNumber="8619"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#add2225af2af25968f26ed4cb0db94dbe">CreateXor</a>(Src1, Src2);</span></CodeLine>
<Link id="l08620" /><CodeLine lineNumber="8620"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615afc870a548088c5b7a93a34f648889d77">AtomicRMWInst::Xchg</a>:</span></CodeLine>
<Link id="l08621" /><CodeLine lineNumber="8621"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a08ef06068dcd583c2476568dda59b324">AtomicRMWInst::FAdd</a>:</span></CodeLine>
<Link id="l08622" /><CodeLine lineNumber="8622"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a92f66d4bc04fc8514bee80509f3e78d4">AtomicRMWInst::FSub</a>:</span></CodeLine>
<Link id="l08623" /><CodeLine lineNumber="8623"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a497e8f347648b1b2823ee0338c95f65f">AtomicRMWInst::BAD&#95;BINOP</a>:</span></CodeLine>
<Link id="l08624" /><CodeLine lineNumber="8624"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615aa1184a7e35e94d162a2d40f2b11beeb2">AtomicRMWInst::Max</a>:</span></CodeLine>
<Link id="l08625" /><CodeLine lineNumber="8625"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a39edb6e51c1ad37244e8b32a2af4077d">AtomicRMWInst::Min</a>:</span></CodeLine>
<Link id="l08626" /><CodeLine lineNumber="8626"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615abe171d96ba8de66fb30e08c00211591e">AtomicRMWInst::UMax</a>:</span></CodeLine>
<Link id="l08627" /><CodeLine lineNumber="8627"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615aa53854e09143f57d2ff2ad6ac89dc55d">AtomicRMWInst::UMin</a>:</span></CodeLine>
<Link id="l08628" /><CodeLine lineNumber="8628"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615acce124326ba87b0127b36c412bf555fd">AtomicRMWInst::FMax</a>:</span></CodeLine>
<Link id="l08629" /><CodeLine lineNumber="8629"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615abd5e733a10a36f3572105b1a67538e18">AtomicRMWInst::FMin</a>:</span></CodeLine>
<Link id="l08630" /><CodeLine lineNumber="8630"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a9334c9815ddc2b25804c6c03b68cc39b">AtomicRMWInst::UIncWrap</a>:</span></CodeLine>
<Link id="l08631" /><CodeLine lineNumber="8631"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615ad3ed1a8c334bc3a50d59aaa57ee9e9f3">AtomicRMWInst::UDecWrap</a>:</span></CodeLine>
<Link id="l08632" /><CodeLine lineNumber="8632"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a0f94e2ef083268e45d22a220f92567a4">AtomicRMWInst::USubCond</a>:</span></CodeLine>
<Link id="l08633" /><CodeLine lineNumber="8633"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a7bf1abb23eccced685c706917aff605c">AtomicRMWInst::USubSat</a>:</span></CodeLine>
<Link id="l08634" /><CodeLine lineNumber="8634"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unsupported atomic update operation&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08635" /><CodeLine lineNumber="8635"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08636" /><CodeLine lineNumber="8636"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unsupported atomic update operation&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08637" /><CodeLine lineNumber="8637"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08638" /><CodeLine lineNumber="8638"></CodeLine>
<Link id="l08639" /><CodeLine lineNumber="8639"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/expected">Expected&lt;std::pair&lt;Value &#42;, Value &#42;&gt;</a>&gt; OpenMPIRBuilder::emitAtomicUpdate(</span></CodeLine>
<Link id="l08640" /><CodeLine lineNumber="8640"><span class="doxyHighlight">    InsertPointTy AllocaIP, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;XElemTy, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Expr,</span></CodeLine>
<Link id="l08641" /><CodeLine lineNumber="8641"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> AO, <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615">AtomicRMWInst::BinOp</a> RMWOp,</span></CodeLine>
<Link id="l08642" /><CodeLine lineNumber="8642"><span class="doxyHighlight">    AtomicUpdateCallbackTy &amp;UpdateOp, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> VolatileX, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsXBinopExpr) &#123;</span></CodeLine>
<Link id="l08643" /><CodeLine lineNumber="8643"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: handle the case where XElemTy is not byte-sized or not a power of 2</span></CodeLine>
<Link id="l08644" /><CodeLine lineNumber="8644"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or a complex datatype.</span></CodeLine>
<Link id="l08645" /><CodeLine lineNumber="8645"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> emitRMWOp = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08646" /><CodeLine lineNumber="8646"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (RMWOp) &#123;</span></CodeLine>
<Link id="l08647" /><CodeLine lineNumber="8647"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a0794c42b44989f9d9f1454d79ca0dd88">AtomicRMWInst::Add</a>:</span></CodeLine>
<Link id="l08648" /><CodeLine lineNumber="8648"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a660a31179bfecd737a256372e5fd6122">AtomicRMWInst::And</a>:</span></CodeLine>
<Link id="l08649" /><CodeLine lineNumber="8649"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615afdcdc631cf4fa6829fd7499cd06a306b">AtomicRMWInst::Nand</a>:</span></CodeLine>
<Link id="l08650" /><CodeLine lineNumber="8650"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a5954f59053121b87ebe0c5fe79942c6e">AtomicRMWInst::Or</a>:</span></CodeLine>
<Link id="l08651" /><CodeLine lineNumber="8651"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a71aab8ee954b6d71a4eed315e8f6556e">AtomicRMWInst::Xor</a>:</span></CodeLine>
<Link id="l08652" /><CodeLine lineNumber="8652"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615afc870a548088c5b7a93a34f648889d77">AtomicRMWInst::Xchg</a>:</span></CodeLine>
<Link id="l08653" /><CodeLine lineNumber="8653"><span class="doxyHighlight">    emitRMWOp = XElemTy;</span></CodeLine>
<Link id="l08654" /><CodeLine lineNumber="8654"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08655" /><CodeLine lineNumber="8655"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a5db6ca0c3e18acd87290f22ccb2ce564">AtomicRMWInst::Sub</a>:</span></CodeLine>
<Link id="l08656" /><CodeLine lineNumber="8656"><span class="doxyHighlight">    emitRMWOp = (IsXBinopExpr &amp;&amp; XElemTy);</span></CodeLine>
<Link id="l08657" /><CodeLine lineNumber="8657"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08658" /><CodeLine lineNumber="8658"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l08659" /><CodeLine lineNumber="8659"><span class="doxyHighlight">    emitRMWOp = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08660" /><CodeLine lineNumber="8660"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08661" /><CodeLine lineNumber="8661"><span class="doxyHighlight">  emitRMWOp &amp;= XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>();</span></CodeLine>
<Link id="l08662" /><CodeLine lineNumber="8662"></CodeLine>
<Link id="l08663" /><CodeLine lineNumber="8663"><span class="doxyHighlight">  std::pair&lt;Value &#42;, Value &#42;&gt; Res;</span></CodeLine>
<Link id="l08664" /><CodeLine lineNumber="8664"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (emitRMWOp) &#123;</span></CodeLine>
<Link id="l08665" /><CodeLine lineNumber="8665"><span class="doxyHighlight">    Res.first = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab2a2c89b21cf14b2c729a898006cb438">CreateAtomicRMW</a>(RMWOp, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, Expr, llvm::MaybeAlign(), AO);</span></CodeLine>
<Link id="l08666" /><CodeLine lineNumber="8666"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// not needed except in case of postfix captures. Generate anyway for</span></CodeLine>
<Link id="l08667" /><CodeLine lineNumber="8667"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// consistency with the else part. Will be removed with any DCE pass.</span></CodeLine>
<Link id="l08668" /><CodeLine lineNumber="8668"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// AtomicRMWInst::Xchg does not have a coressponding instruction.</span></CodeLine>
<Link id="l08669" /><CodeLine lineNumber="8669"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RMWOp == <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615afc870a548088c5b7a93a34f648889d77">AtomicRMWInst::Xchg</a>)</span></CodeLine>
<Link id="l08670" /><CodeLine lineNumber="8670"><span class="doxyHighlight">      Res.second = Res.first;</span></CodeLine>
<Link id="l08671" /><CodeLine lineNumber="8671"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08672" /><CodeLine lineNumber="8672"><span class="doxyHighlight">      Res.second = emitRMWOpAsInstruction(Res.first, Expr, RMWOp);</span></CodeLine>
<Link id="l08673" /><CodeLine lineNumber="8673"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RMWOp == <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a497e8f347648b1b2823ee0338c95f65f">llvm::AtomicRMWInst::BinOp::BAD&#95;BINOP</a> &amp;&amp;</span></CodeLine>
<Link id="l08674" /><CodeLine lineNumber="8674"><span class="doxyHighlight">             XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>()) &#123;</span></CodeLine>
<Link id="l08675" /><CodeLine lineNumber="8675"><span class="doxyHighlight">    LoadInst &#42;OldVal =</span></CodeLine>
<Link id="l08676" /><CodeLine lineNumber="8676"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(XElemTy, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.atomic.load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08677" /><CodeLine lineNumber="8677"><span class="doxyHighlight">    OldVal-&gt;<a href="/docs/api/classes/llvm/loadinst/#a6ae88dc44b078c80ce3a25401fd4b05b">setAtomic</a>(AO);</span></CodeLine>
<Link id="l08678" /><CodeLine lineNumber="8678"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> DataLayout &amp;LoadDL = OldVal-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>()-&gt;<a href="/docs/api/classes/llvm/module/#abcbe492bce3ccc16e0bbb50292576c5c">getDataLayout</a>();</span></CodeLine>
<Link id="l08679" /><CodeLine lineNumber="8679"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LoadSize =</span></CodeLine>
<Link id="l08680" /><CodeLine lineNumber="8680"><span class="doxyHighlight">        LoadDL.<a href="/docs/api/classes/llvm/datalayout/#acfcd22eb38dbfe1acbf138754297437a">getTypeStoreSize</a>(OldVal-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l08681" /><CodeLine lineNumber="8681"></CodeLine>
<Link id="l08682" /><CodeLine lineNumber="8682"><span class="doxyHighlight">    OpenMPIRBuilder::AtomicInfo atomicInfo(</span></CodeLine>
<Link id="l08683" /><CodeLine lineNumber="8683"><span class="doxyHighlight">        &amp;Builder, XElemTy, LoadSize &#42; 8, LoadSize &#42; 8, OldVal-&gt;<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(),</span></CodeLine>
<Link id="l08684" /><CodeLine lineNumber="8684"><span class="doxyHighlight">        OldVal-&gt;<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42; UseLibcall &#42;/</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</span></CodeLine>
<Link id="l08685" /><CodeLine lineNumber="8685"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AtomicLoadRes = atomicInfo.EmitAtomicLoadLibcall(AO);</span></CodeLine>
<Link id="l08686" /><CodeLine lineNumber="8686"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CurBB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l08687" /><CodeLine lineNumber="8687"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;CurBBTI = CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l08688" /><CodeLine lineNumber="8688"><span class="doxyHighlight">    CurBBTI = CurBBTI ? CurBBTI : Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a39acc29443d48968a798fb22a76fa4c0">CreateUnreachable</a>();</span></CodeLine>
<Link id="l08689" /><CodeLine lineNumber="8689"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ExitBB =</span></CodeLine>
<Link id="l08690" /><CodeLine lineNumber="8690"><span class="doxyHighlight">        CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(CurBBTI, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.atomic.exit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08691" /><CodeLine lineNumber="8691"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ContBB = CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(),</span></CodeLine>
<Link id="l08692" /><CodeLine lineNumber="8692"><span class="doxyHighlight">                                                <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.atomic.cont&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08693" /><CodeLine lineNumber="8693"><span class="doxyHighlight">    ContBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l08694" /><CodeLine lineNumber="8694"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l08695" /><CodeLine lineNumber="8695"><span class="doxyHighlight">    AllocaInst &#42;NewAtomicAddr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(XElemTy);</span></CodeLine>
<Link id="l08696" /><CodeLine lineNumber="8696"><span class="doxyHighlight">    NewAtomicAddr-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;x.new.val&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08697" /><CodeLine lineNumber="8697"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ContBB);</span></CodeLine>
<Link id="l08698" /><CodeLine lineNumber="8698"><span class="doxyHighlight">    llvm::PHINode &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(OldVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 2);</span></CodeLine>
<Link id="l08699" /><CodeLine lineNumber="8699"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(AtomicLoadRes.first, CurBB);</span></CodeLine>
<Link id="l08700" /><CodeLine lineNumber="8700"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OldExprVal = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</span></CodeLine>
<Link id="l08701" /><CodeLine lineNumber="8701"><span class="doxyHighlight">    Expected&lt;Value &#42;&gt; CBResult = UpdateOp(OldExprVal, Builder);</span></CodeLine>
<Link id="l08702" /><CodeLine lineNumber="8702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CBResult)</span></CodeLine>
<Link id="l08703" /><CodeLine lineNumber="8703"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CBResult.<a href="/docs/api/classes/llvm/expected/#a94789df4ebd03dc008e8adebaa66ac1f">takeError</a>();</span></CodeLine>
<Link id="l08704" /><CodeLine lineNumber="8704"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Upd = &#42;CBResult;</span></CodeLine>
<Link id="l08705" /><CodeLine lineNumber="8705"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Upd, NewAtomicAddr);</span></CodeLine>
<Link id="l08706" /><CodeLine lineNumber="8706"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> <a href="/docs/api/namespaces/llvm/remarks/#aeb5853e98ae4d9ab7cb002879736527fae139a585510a502bbf1841cf589f5086">Failure</a> =</span></CodeLine>
<Link id="l08707" /><CodeLine lineNumber="8707"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/atomiccmpxchginst/#a7ce03ab5b2a6006ebcdfe804e4c8f1a1">llvm::AtomicCmpXchgInst::getStrongestFailureOrdering</a>(AO);</span></CodeLine>
<Link id="l08708" /><CodeLine lineNumber="8708"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = atomicInfo.EmitAtomicCompareExchangeLibcall(</span></CodeLine>
<Link id="l08709" /><CodeLine lineNumber="8709"><span class="doxyHighlight">        AtomicLoadRes.second, NewAtomicAddr, AO, Failure);</span></CodeLine>
<Link id="l08710" /><CodeLine lineNumber="8710"><span class="doxyHighlight">    LoadInst &#42;PHILoad = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(XElemTy, <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.first);</span></CodeLine>
<Link id="l08711" /><CodeLine lineNumber="8711"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(PHILoad, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>());</span></CodeLine>
<Link id="l08712" /><CodeLine lineNumber="8712"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(<a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.second, ExitBB, ContBB);</span></CodeLine>
<Link id="l08713" /><CodeLine lineNumber="8713"><span class="doxyHighlight">    OldVal-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l08714" /><CodeLine lineNumber="8714"><span class="doxyHighlight">    Res.first = OldExprVal;</span></CodeLine>
<Link id="l08715" /><CodeLine lineNumber="8715"><span class="doxyHighlight">    Res.second = Upd;</span></CodeLine>
<Link id="l08716" /><CodeLine lineNumber="8716"></CodeLine>
<Link id="l08717" /><CodeLine lineNumber="8717"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UnreachableInst &#42;ExitTI =</span></CodeLine>
<Link id="l08718" /><CodeLine lineNumber="8718"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;UnreachableInst&gt;</a>(ExitBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())) &#123;</span></CodeLine>
<Link id="l08719" /><CodeLine lineNumber="8719"><span class="doxyHighlight">      CurBBTI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l08720" /><CodeLine lineNumber="8720"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ExitBB);</span></CodeLine>
<Link id="l08721" /><CodeLine lineNumber="8721"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08722" /><CodeLine lineNumber="8722"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ExitTI);</span></CodeLine>
<Link id="l08723" /><CodeLine lineNumber="8723"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08724" /><CodeLine lineNumber="8724"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08725" /><CodeLine lineNumber="8725"><span class="doxyHighlight">    IntegerType &#42;IntCastTy =</span></CodeLine>
<Link id="l08726" /><CodeLine lineNumber="8726"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext(), XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>());</span></CodeLine>
<Link id="l08727" /><CodeLine lineNumber="8727"><span class="doxyHighlight">    LoadInst &#42;OldVal =</span></CodeLine>
<Link id="l08728" /><CodeLine lineNumber="8728"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(IntCastTy, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.atomic.load&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08729" /><CodeLine lineNumber="8729"><span class="doxyHighlight">    OldVal-&gt;<a href="/docs/api/classes/llvm/loadinst/#a6ae88dc44b078c80ce3a25401fd4b05b">setAtomic</a>(AO);</span></CodeLine>
<Link id="l08730" /><CodeLine lineNumber="8730"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// CurBB</span></CodeLine>
<Link id="l08731" /><CodeLine lineNumber="8731"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// |     /---\\</span></CodeLine>
<Link id="l08732" /><CodeLine lineNumber="8732"><span class="doxyHighlightComment">    // ContBB    |</span></CodeLine>
<Link id="l08733" /><CodeLine lineNumber="8733"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// |     \\---/</span></CodeLine>
<Link id="l08734" /><CodeLine lineNumber="8734"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ExitBB</span></CodeLine>
<Link id="l08735" /><CodeLine lineNumber="8735"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;CurBB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l08736" /><CodeLine lineNumber="8736"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;CurBBTI = CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l08737" /><CodeLine lineNumber="8737"><span class="doxyHighlight">    CurBBTI = CurBBTI ? CurBBTI : Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a39acc29443d48968a798fb22a76fa4c0">CreateUnreachable</a>();</span></CodeLine>
<Link id="l08738" /><CodeLine lineNumber="8738"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ExitBB =</span></CodeLine>
<Link id="l08739" /><CodeLine lineNumber="8739"><span class="doxyHighlight">        CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(CurBBTI, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.atomic.exit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08740" /><CodeLine lineNumber="8740"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;ContBB = CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(),</span></CodeLine>
<Link id="l08741" /><CodeLine lineNumber="8741"><span class="doxyHighlight">                                                <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.atomic.cont&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08742" /><CodeLine lineNumber="8742"><span class="doxyHighlight">    ContBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l08743" /><CodeLine lineNumber="8743"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ac8778dcbd35e8ae5902050117feb57a0">restoreIP</a>(AllocaIP);</span></CodeLine>
<Link id="l08744" /><CodeLine lineNumber="8744"><span class="doxyHighlight">    AllocaInst &#42;NewAtomicAddr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(XElemTy);</span></CodeLine>
<Link id="l08745" /><CodeLine lineNumber="8745"><span class="doxyHighlight">    NewAtomicAddr-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;x.new.val&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08746" /><CodeLine lineNumber="8746"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ContBB);</span></CodeLine>
<Link id="l08747" /><CodeLine lineNumber="8747"><span class="doxyHighlight">    llvm::PHINode &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(OldVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 2);</span></CodeLine>
<Link id="l08748" /><CodeLine lineNumber="8748"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(OldVal, CurBB);</span></CodeLine>
<Link id="l08749" /><CodeLine lineNumber="8749"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsIntTy = XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>();</span></CodeLine>
<Link id="l08750" /><CodeLine lineNumber="8750"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;OldExprVal = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>;</span></CodeLine>
<Link id="l08751" /><CodeLine lineNumber="8751"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsIntTy) &#123;</span></CodeLine>
<Link id="l08752" /><CodeLine lineNumber="8752"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()) &#123;</span></CodeLine>
<Link id="l08753" /><CodeLine lineNumber="8753"><span class="doxyHighlight">        OldExprVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, XElemTy,</span></CodeLine>
<Link id="l08754" /><CodeLine lineNumber="8754"><span class="doxyHighlight">                                           <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.atomic.fltCast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08755" /><CodeLine lineNumber="8755"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08756" /><CodeLine lineNumber="8756"><span class="doxyHighlight">        OldExprVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a53541ed6f92b18419f937f1f969aa0f6">CreateIntToPtr</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, XElemTy,</span></CodeLine>
<Link id="l08757" /><CodeLine lineNumber="8757"><span class="doxyHighlight">                                            <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.atomic.ptrCast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08758" /><CodeLine lineNumber="8758"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08759" /><CodeLine lineNumber="8759"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08760" /><CodeLine lineNumber="8760"></CodeLine>
<Link id="l08761" /><CodeLine lineNumber="8761"><span class="doxyHighlight">    Expected&lt;Value &#42;&gt; CBResult = UpdateOp(OldExprVal, Builder);</span></CodeLine>
<Link id="l08762" /><CodeLine lineNumber="8762"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CBResult)</span></CodeLine>
<Link id="l08763" /><CodeLine lineNumber="8763"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CBResult.<a href="/docs/api/classes/llvm/expected/#a94789df4ebd03dc008e8adebaa66ac1f">takeError</a>();</span></CodeLine>
<Link id="l08764" /><CodeLine lineNumber="8764"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Upd = &#42;CBResult;</span></CodeLine>
<Link id="l08765" /><CodeLine lineNumber="8765"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Upd, NewAtomicAddr);</span></CodeLine>
<Link id="l08766" /><CodeLine lineNumber="8766"><span class="doxyHighlight">    LoadInst &#42;DesiredVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(IntCastTy, NewAtomicAddr);</span></CodeLine>
<Link id="l08767" /><CodeLine lineNumber="8767"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> <a href="/docs/api/namespaces/llvm/remarks/#aeb5853e98ae4d9ab7cb002879736527fae139a585510a502bbf1841cf589f5086">Failure</a> =</span></CodeLine>
<Link id="l08768" /><CodeLine lineNumber="8768"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/atomiccmpxchginst/#a7ce03ab5b2a6006ebcdfe804e4c8f1a1">llvm::AtomicCmpXchgInst::getStrongestFailureOrdering</a>(AO);</span></CodeLine>
<Link id="l08769" /><CodeLine lineNumber="8769"><span class="doxyHighlight">    AtomicCmpXchgInst &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a199f6765de1f6b1a242aac556528f3b3">CreateAtomicCmpXchg</a>(</span></CodeLine>
<Link id="l08770" /><CodeLine lineNumber="8770"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, DesiredVal, llvm::MaybeAlign(), AO, Failure);</span></CodeLine>
<Link id="l08771" /><CodeLine lineNumber="8771"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>-&gt;setVolatile(VolatileX);</span></CodeLine>
<Link id="l08772" /><CodeLine lineNumber="8772"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;PreviousVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a41cf66866b0b0e5a10038bfb77477419">CreateExtractValue</a>(Result, </span><span class="doxyHighlightComment">/&#42;Idxs=&#42;/</span><span class="doxyHighlight">0);</span></CodeLine>
<Link id="l08773" /><CodeLine lineNumber="8773"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SuccessFailureVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a41cf66866b0b0e5a10038bfb77477419">CreateExtractValue</a>(Result, </span><span class="doxyHighlightComment">/&#42;Idxs=&#42;/</span><span class="doxyHighlight">1);</span></CodeLine>
<Link id="l08774" /><CodeLine lineNumber="8774"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;addIncoming(PreviousVal, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>());</span></CodeLine>
<Link id="l08775" /><CodeLine lineNumber="8775"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(SuccessFailureVal, ExitBB, ContBB);</span></CodeLine>
<Link id="l08776" /><CodeLine lineNumber="8776"></CodeLine>
<Link id="l08777" /><CodeLine lineNumber="8777"><span class="doxyHighlight">    Res.first = OldExprVal;</span></CodeLine>
<Link id="l08778" /><CodeLine lineNumber="8778"><span class="doxyHighlight">    Res.second = Upd;</span></CodeLine>
<Link id="l08779" /><CodeLine lineNumber="8779"></CodeLine>
<Link id="l08780" /><CodeLine lineNumber="8780"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// set Insertion point in exit block</span></CodeLine>
<Link id="l08781" /><CodeLine lineNumber="8781"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UnreachableInst &#42;ExitTI =</span></CodeLine>
<Link id="l08782" /><CodeLine lineNumber="8782"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;UnreachableInst&gt;</a>(ExitBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())) &#123;</span></CodeLine>
<Link id="l08783" /><CodeLine lineNumber="8783"><span class="doxyHighlight">      CurBBTI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l08784" /><CodeLine lineNumber="8784"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ExitBB);</span></CodeLine>
<Link id="l08785" /><CodeLine lineNumber="8785"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08786" /><CodeLine lineNumber="8786"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ExitTI);</span></CodeLine>
<Link id="l08787" /><CodeLine lineNumber="8787"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08788" /><CodeLine lineNumber="8788"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08789" /><CodeLine lineNumber="8789"></CodeLine>
<Link id="l08790" /><CodeLine lineNumber="8790"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Res;</span></CodeLine>
<Link id="l08791" /><CodeLine lineNumber="8791"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08792" /><CodeLine lineNumber="8792"></CodeLine>
<Link id="l08793" /><CodeLine lineNumber="8793" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a6cc340cf5dc46cf45eb6f784577cadbd"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a> <a href="/docs/api/classes/llvm/openmpirbuilder/#a6cc340cf5dc46cf45eb6f784577cadbd">OpenMPIRBuilder::createAtomicCapture</a>(</span></CodeLine>
<Link id="l08794" /><CodeLine lineNumber="8794"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AllocaIP, AtomicOpValue &amp;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>,</span></CodeLine>
<Link id="l08795" /><CodeLine lineNumber="8795"><span class="doxyHighlight">    AtomicOpValue &amp;V, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Expr, <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> AO,</span></CodeLine>
<Link id="l08796" /><CodeLine lineNumber="8796"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615">AtomicRMWInst::BinOp</a> RMWOp, AtomicUpdateCallbackTy &amp;UpdateOp,</span></CodeLine>
<Link id="l08797" /><CodeLine lineNumber="8797"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UpdateExpr, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsPostfixUpdate, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsXBinopExpr) &#123;</span></CodeLine>
<Link id="l08798" /><CodeLine lineNumber="8798"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l08799" /><CodeLine lineNumber="8799"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP;</span></CodeLine>
<Link id="l08800" /><CodeLine lineNumber="8800"></CodeLine>
<Link id="l08801" /><CodeLine lineNumber="8801"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l08802" /><CodeLine lineNumber="8802"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;XTy = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var-&gt;getType();</span></CodeLine>
<Link id="l08803" /><CodeLine lineNumber="8803"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(XTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l08804" /><CodeLine lineNumber="8804"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;OMP Atomic expects a pointer to target memory&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08805" /><CodeLine lineNumber="8805"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;XElemTy = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.ElemTy;</span></CodeLine>
<Link id="l08806" /><CodeLine lineNumber="8806"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>() || XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() ||</span></CodeLine>
<Link id="l08807" /><CodeLine lineNumber="8807"><span class="doxyHighlight">            XElemTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) &amp;&amp;</span></CodeLine>
<Link id="l08808" /><CodeLine lineNumber="8808"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;OMP atomic capture expected a scalar type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08809" /><CodeLine lineNumber="8809"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((RMWOp != <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615aa1184a7e35e94d162a2d40f2b11beeb2">AtomicRMWInst::Max</a>) &amp;&amp; (RMWOp != <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a39edb6e51c1ad37244e8b32a2af4077d">AtomicRMWInst::Min</a>) &amp;&amp;</span></CodeLine>
<Link id="l08810" /><CodeLine lineNumber="8810"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;OpenMP atomic does not support LT or GT operations&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08811" /><CodeLine lineNumber="8811"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l08812" /><CodeLine lineNumber="8812"></CodeLine>
<Link id="l08813" /><CodeLine lineNumber="8813"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If UpdateExpr is &#39;x&#39; updated with some &#96;expr&#96; not based on &#39;x&#39;,</span></CodeLine>
<Link id="l08814" /><CodeLine lineNumber="8814"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#39;x&#39; is simply atomically rewritten with &#39;expr&#39;.</span></CodeLine>
<Link id="l08815" /><CodeLine lineNumber="8815"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615">AtomicRMWInst::BinOp</a> AtomicOp = (UpdateExpr ? RMWOp : <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615afc870a548088c5b7a93a34f648889d77">AtomicRMWInst::Xchg</a>);</span></CodeLine>
<Link id="l08816" /><CodeLine lineNumber="8816"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/expected">Expected&lt;std::pair&lt;Value &#42;, Value &#42;&gt;</a>&gt; AtomicResult =</span></CodeLine>
<Link id="l08817" /><CodeLine lineNumber="8817"><span class="doxyHighlight">      emitAtomicUpdate(AllocaIP, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.ElemTy, Expr, AO, AtomicOp, UpdateOp,</span></CodeLine>
<Link id="l08818" /><CodeLine lineNumber="8818"><span class="doxyHighlight">                       <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.IsVolatile, IsXBinopExpr);</span></CodeLine>
<Link id="l08819" /><CodeLine lineNumber="8819"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AtomicResult)</span></CodeLine>
<Link id="l08820" /><CodeLine lineNumber="8820"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AtomicResult.<a href="/docs/api/classes/llvm/expected/#a94789df4ebd03dc008e8adebaa66ac1f">takeError</a>();</span></CodeLine>
<Link id="l08821" /><CodeLine lineNumber="8821"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CapturedVal =</span></CodeLine>
<Link id="l08822" /><CodeLine lineNumber="8822"><span class="doxyHighlight">      (IsPostfixUpdate ? AtomicResult-&gt;first : AtomicResult-&gt;second);</span></CodeLine>
<Link id="l08823" /><CodeLine lineNumber="8823"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CapturedVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != V.Var-&gt;getType())</span></CodeLine>
<Link id="l08824" /><CodeLine lineNumber="8824"><span class="doxyHighlight">    CapturedVal = <a href="#a91b7eb2a05d10c788413bec7977f3474">emitImplicitCast</a>(Builder, CapturedVal, V.Var);</span></CodeLine>
<Link id="l08825" /><CodeLine lineNumber="8825"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(CapturedVal, V.Var, V.IsVolatile);</span></CodeLine>
<Link id="l08826" /><CodeLine lineNumber="8826"></CodeLine>
<Link id="l08827" /><CodeLine lineNumber="8827"><span class="doxyHighlight">  checkAndEmitFlushAfterAtomic(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, AO, AtomicKind::Capture);</span></CodeLine>
<Link id="l08828" /><CodeLine lineNumber="8828"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l08829" /><CodeLine lineNumber="8829"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08830" /><CodeLine lineNumber="8830"></CodeLine>
<Link id="l08831" /><CodeLine lineNumber="8831" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a6c4eeba23c6f192892487de272e8ce72"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> <a href="/docs/api/classes/llvm/openmpirbuilder/#a6c4eeba23c6f192892487de272e8ce72">OpenMPIRBuilder::createAtomicCompare</a>(</span></CodeLine>
<Link id="l08832" /><CodeLine lineNumber="8832"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, AtomicOpValue &amp;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, AtomicOpValue &amp;V,</span></CodeLine>
<Link id="l08833" /><CodeLine lineNumber="8833"><span class="doxyHighlight">    AtomicOpValue &amp;R, <a href="/docs/api/classes/llvm/value">Value</a> &#42;E, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> AO,</span></CodeLine>
<Link id="l08834" /><CodeLine lineNumber="8834"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#acb593a387130148478f3c30af0d322df">omp::OMPAtomicCompareOp</a> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsXBinopExpr, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsPostfixUpdate,</span></CodeLine>
<Link id="l08835" /><CodeLine lineNumber="8835"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsFailOnly) &#123;</span></CodeLine>
<Link id="l08836" /><CodeLine lineNumber="8836"></CodeLine>
<Link id="l08837" /><CodeLine lineNumber="8837"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> Failure = <a href="/docs/api/classes/llvm/atomiccmpxchginst/#a7ce03ab5b2a6006ebcdfe804e4c8f1a1">AtomicCmpXchgInst::getStrongestFailureOrdering</a>(AO);</span></CodeLine>
<Link id="l08838" /><CodeLine lineNumber="8838"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#a6c4eeba23c6f192892487de272e8ce72">createAtomicCompare</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, V, R, E, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, AO, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, IsXBinopExpr,</span></CodeLine>
<Link id="l08839" /><CodeLine lineNumber="8839"><span class="doxyHighlight">                             IsPostfixUpdate, IsFailOnly, Failure);</span></CodeLine>
<Link id="l08840" /><CodeLine lineNumber="8840"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08841" /><CodeLine lineNumber="8841"></CodeLine>
<Link id="l08842" /><CodeLine lineNumber="8842" lineLink="/docs/api/classes/llvm/openmpirbuilder/#ab84af206a9a08b9bf97eaadc87874c6c"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">OpenMPIRBuilder::InsertPointTy</a> <a href="/docs/api/classes/llvm/openmpirbuilder/#a6c4eeba23c6f192892487de272e8ce72">OpenMPIRBuilder::createAtomicCompare</a>(</span></CodeLine>
<Link id="l08843" /><CodeLine lineNumber="8843"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/openmpirbuilder/locationdescription">LocationDescription</a> &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>, AtomicOpValue &amp;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, AtomicOpValue &amp;V,</span></CodeLine>
<Link id="l08844" /><CodeLine lineNumber="8844"><span class="doxyHighlight">    AtomicOpValue &amp;R, <a href="/docs/api/classes/llvm/value">Value</a> &#42;E, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> AO,</span></CodeLine>
<Link id="l08845" /><CodeLine lineNumber="8845"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#acb593a387130148478f3c30af0d322df">omp::OMPAtomicCompareOp</a> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsXBinopExpr, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsPostfixUpdate,</span></CodeLine>
<Link id="l08846" /><CodeLine lineNumber="8846"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsFailOnly, <a href="/docs/api/namespaces/llvm/#a9bccbe67aaab722783ca4e7c504aaaa7">AtomicOrdering</a> Failure) &#123;</span></CodeLine>
<Link id="l08847" /><CodeLine lineNumber="8847"></CodeLine>
<Link id="l08848" /><CodeLine lineNumber="8848"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l08849" /><CodeLine lineNumber="8849"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/loc">Loc</a>.IP;</span></CodeLine>
<Link id="l08850" /><CodeLine lineNumber="8850"></CodeLine>
<Link id="l08851" /><CodeLine lineNumber="8851"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var-&gt;getType()-&gt;isPointerTy() &amp;&amp;</span></CodeLine>
<Link id="l08852" /><CodeLine lineNumber="8852"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;OMP atomic expects a pointer to target memory&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08853" /><CodeLine lineNumber="8853"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// compare capture</span></CodeLine>
<Link id="l08854" /><CodeLine lineNumber="8854"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V.Var) &#123;</span></CodeLine>
<Link id="l08855" /><CodeLine lineNumber="8855"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V.Var-&gt;getType()-&gt;isPointerTy() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;v.var must be of pointer type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08856" /><CodeLine lineNumber="8856"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V.ElemTy == <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.ElemTy &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;x and v must be of same type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08857" /><CodeLine lineNumber="8857"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08858" /><CodeLine lineNumber="8858"></CodeLine>
<Link id="l08859" /><CodeLine lineNumber="8859"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsInteger = E-&gt;getType()-&gt;isIntegerTy();</span></CodeLine>
<Link id="l08860" /><CodeLine lineNumber="8860"></CodeLine>
<Link id="l08861" /><CodeLine lineNumber="8861"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == OMPAtomicCompareOp::EQ) &#123;</span></CodeLine>
<Link id="l08862" /><CodeLine lineNumber="8862"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/atomiccmpxchginst">AtomicCmpXchgInst</a> &#42;Result = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08863" /><CodeLine lineNumber="8863"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsInteger) &#123;</span></CodeLine>
<Link id="l08864" /><CodeLine lineNumber="8864"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/integertype">IntegerType</a> &#42;IntCastTy =</span></CodeLine>
<Link id="l08865" /><CodeLine lineNumber="8865"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(M.getContext(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.ElemTy-&gt;getScalarSizeInBits());</span></CodeLine>
<Link id="l08866" /><CodeLine lineNumber="8866"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;EBCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(E, IntCastTy);</span></CodeLine>
<Link id="l08867" /><CodeLine lineNumber="8867"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;DBCast = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, IntCastTy);</span></CodeLine>
<Link id="l08868" /><CodeLine lineNumber="8868"><span class="doxyHighlight">      Result = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a199f6765de1f6b1a242aac556528f3b3">CreateAtomicCmpXchg</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var, EBCast, DBCast, <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a>(),</span></CodeLine>
<Link id="l08869" /><CodeLine lineNumber="8869"><span class="doxyHighlight">                                           AO, Failure);</span></CodeLine>
<Link id="l08870" /><CodeLine lineNumber="8870"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08871" /><CodeLine lineNumber="8871"><span class="doxyHighlight">      Result =</span></CodeLine>
<Link id="l08872" /><CodeLine lineNumber="8872"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a199f6765de1f6b1a242aac556528f3b3">CreateAtomicCmpXchg</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var, E, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a>(), AO, Failure);</span></CodeLine>
<Link id="l08873" /><CodeLine lineNumber="8873"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08874" /><CodeLine lineNumber="8874"></CodeLine>
<Link id="l08875" /><CodeLine lineNumber="8875"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V.Var) &#123;</span></CodeLine>
<Link id="l08876" /><CodeLine lineNumber="8876"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;OldValue = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a41cf66866b0b0e5a10038bfb77477419">CreateExtractValue</a>(Result, </span><span class="doxyHighlightComment">/&#42;Idxs=&#42;/</span><span class="doxyHighlight">0);</span></CodeLine>
<Link id="l08877" /><CodeLine lineNumber="8877"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsInteger)</span></CodeLine>
<Link id="l08878" /><CodeLine lineNumber="8878"><span class="doxyHighlight">        OldValue = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(OldValue, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.ElemTy);</span></CodeLine>
<Link id="l08879" /><CodeLine lineNumber="8879"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == V.ElemTy &amp;&amp;</span></CodeLine>
<Link id="l08880" /><CodeLine lineNumber="8880"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;OldValue and V must be of same type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08881" /><CodeLine lineNumber="8881"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsPostfixUpdate) &#123;</span></CodeLine>
<Link id="l08882" /><CodeLine lineNumber="8882"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(OldValue, V.Var, V.IsVolatile);</span></CodeLine>
<Link id="l08883" /><CodeLine lineNumber="8883"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08884" /><CodeLine lineNumber="8884"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;SuccessOrFail = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a41cf66866b0b0e5a10038bfb77477419">CreateExtractValue</a>(Result, </span><span class="doxyHighlightComment">/&#42;Idxs=&#42;/</span><span class="doxyHighlight">1);</span></CodeLine>
<Link id="l08885" /><CodeLine lineNumber="8885"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsFailOnly) &#123;</span></CodeLine>
<Link id="l08886" /><CodeLine lineNumber="8886"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// CurBB----</span></CodeLine>
<Link id="l08887" /><CodeLine lineNumber="8887"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">//   |     |</span></CodeLine>
<Link id="l08888" /><CodeLine lineNumber="8888"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">//   v     |</span></CodeLine>
<Link id="l08889" /><CodeLine lineNumber="8889"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// ContBB  |</span></CodeLine>
<Link id="l08890" /><CodeLine lineNumber="8890"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">//   |     |</span></CodeLine>
<Link id="l08891" /><CodeLine lineNumber="8891"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">//   v     |</span></CodeLine>
<Link id="l08892" /><CodeLine lineNumber="8892"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// ExitBB &lt;-</span></CodeLine>
<Link id="l08893" /><CodeLine lineNumber="8893"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l08894" /><CodeLine lineNumber="8894"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// where ContBB only contains the store of old value to &#39;v&#39;.</span></CodeLine>
<Link id="l08895" /><CodeLine lineNumber="8895"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CurBB = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>();</span></CodeLine>
<Link id="l08896" /><CodeLine lineNumber="8896"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CurBBTI = CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l08897" /><CodeLine lineNumber="8897"><span class="doxyHighlight">          CurBBTI = CurBBTI ? CurBBTI : Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a39acc29443d48968a798fb22a76fa4c0">CreateUnreachable</a>();</span></CodeLine>
<Link id="l08898" /><CodeLine lineNumber="8898"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBB = CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(</span></CodeLine>
<Link id="l08899" /><CodeLine lineNumber="8899"><span class="doxyHighlight">              CurBBTI, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.atomic.exit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08900" /><CodeLine lineNumber="8900"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ContBB = CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(</span></CodeLine>
<Link id="l08901" /><CodeLine lineNumber="8901"><span class="doxyHighlight">              CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.atomic.cont&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08902" /><CodeLine lineNumber="8902"><span class="doxyHighlight">          ContBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l08903" /><CodeLine lineNumber="8903"><span class="doxyHighlight">          CurBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l08904" /><CodeLine lineNumber="8904"></CodeLine>
<Link id="l08905" /><CodeLine lineNumber="8905"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(SuccessOrFail, ExitBB, ContBB);</span></CodeLine>
<Link id="l08906" /><CodeLine lineNumber="8906"></CodeLine>
<Link id="l08907" /><CodeLine lineNumber="8907"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ContBB);</span></CodeLine>
<Link id="l08908" /><CodeLine lineNumber="8908"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(OldValue, V.Var);</span></CodeLine>
<Link id="l08909" /><CodeLine lineNumber="8909"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#abab736a0141f903dc32a6f48828ad908">CreateBr</a>(ExitBB);</span></CodeLine>
<Link id="l08910" /><CodeLine lineNumber="8910"></CodeLine>
<Link id="l08911" /><CodeLine lineNumber="8911"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a> &#42;ExitTI =</span></CodeLine>
<Link id="l08912" /><CodeLine lineNumber="8912"><span class="doxyHighlight">                  <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;UnreachableInst&gt;</a>(ExitBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())) &#123;</span></CodeLine>
<Link id="l08913" /><CodeLine lineNumber="8913"><span class="doxyHighlight">            CurBBTI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l08914" /><CodeLine lineNumber="8914"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ExitBB);</span></CodeLine>
<Link id="l08915" /><CodeLine lineNumber="8915"><span class="doxyHighlight">          &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08916" /><CodeLine lineNumber="8916"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ExitTI);</span></CodeLine>
<Link id="l08917" /><CodeLine lineNumber="8917"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l08918" /><CodeLine lineNumber="8918"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08919" /><CodeLine lineNumber="8919"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/value">Value</a> &#42;CapturedValue =</span></CodeLine>
<Link id="l08920" /><CodeLine lineNumber="8920"><span class="doxyHighlight">              Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(SuccessOrFail, E, OldValue);</span></CodeLine>
<Link id="l08921" /><CodeLine lineNumber="8921"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(CapturedValue, V.Var, V.IsVolatile);</span></CodeLine>
<Link id="l08922" /><CodeLine lineNumber="8922"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l08923" /><CodeLine lineNumber="8923"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08924" /><CodeLine lineNumber="8924"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08925" /><CodeLine lineNumber="8925"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The comparison result has to be stored.</span></CodeLine>
<Link id="l08926" /><CodeLine lineNumber="8926"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (R.Var) &#123;</span></CodeLine>
<Link id="l08927" /><CodeLine lineNumber="8927"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(R.Var-&gt;getType()-&gt;isPointerTy() &amp;&amp;</span></CodeLine>
<Link id="l08928" /><CodeLine lineNumber="8928"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;r.var must be of pointer type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08929" /><CodeLine lineNumber="8929"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(R.ElemTy-&gt;isIntegerTy() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;r must be of integral type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08930" /><CodeLine lineNumber="8930"></CodeLine>
<Link id="l08931" /><CodeLine lineNumber="8931"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;SuccessFailureVal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a41cf66866b0b0e5a10038bfb77477419">CreateExtractValue</a>(Result, </span><span class="doxyHighlightComment">/&#42;Idxs=&#42;/</span><span class="doxyHighlight">1);</span></CodeLine>
<Link id="l08932" /><CodeLine lineNumber="8932"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;ResultCast = R.IsSigned</span></CodeLine>
<Link id="l08933" /><CodeLine lineNumber="8933"><span class="doxyHighlight">                              ? Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5253081f40ffcad9c0e8ba6a5c437006">CreateSExt</a>(SuccessFailureVal, R.ElemTy)</span></CodeLine>
<Link id="l08934" /><CodeLine lineNumber="8934"><span class="doxyHighlight">                              : Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9e6950f7f17700d5c0d61ad0b846ec5c">CreateZExt</a>(SuccessFailureVal, R.ElemTy);</span></CodeLine>
<Link id="l08935" /><CodeLine lineNumber="8935"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(ResultCast, R.Var, R.IsVolatile);</span></CodeLine>
<Link id="l08936" /><CodeLine lineNumber="8936"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08937" /><CodeLine lineNumber="8937"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08938" /><CodeLine lineNumber="8938"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == OMPAtomicCompareOp::MAX || <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == OMPAtomicCompareOp::MIN) &amp;&amp;</span></CodeLine>
<Link id="l08939" /><CodeLine lineNumber="8939"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Op should be either max or min at this point&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08940" /><CodeLine lineNumber="8940"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!IsFailOnly &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;IsFailOnly is only valid when the comparison is ==&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08941" /><CodeLine lineNumber="8941"></CodeLine>
<Link id="l08942" /><CodeLine lineNumber="8942"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reverse the ordop as the OpenMP forms are different from LLVM forms.</span></CodeLine>
<Link id="l08943" /><CodeLine lineNumber="8943"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Let&#39;s take max as example.</span></CodeLine>
<Link id="l08944" /><CodeLine lineNumber="8944"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// OpenMP form:</span></CodeLine>
<Link id="l08945" /><CodeLine lineNumber="8945"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// x = x &gt; expr ? expr : x;</span></CodeLine>
<Link id="l08946" /><CodeLine lineNumber="8946"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// LLVM form:</span></CodeLine>
<Link id="l08947" /><CodeLine lineNumber="8947"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#42;ptr = &#42;ptr &gt; val ? &#42;ptr : val;</span></CodeLine>
<Link id="l08948" /><CodeLine lineNumber="8948"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We need to transform to LLVM form.</span></CodeLine>
<Link id="l08949" /><CodeLine lineNumber="8949"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// x = x &lt;= expr ? x : expr;</span></CodeLine>
<Link id="l08950" /><CodeLine lineNumber="8950"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615">AtomicRMWInst::BinOp</a> NewOp;</span></CodeLine>
<Link id="l08951" /><CodeLine lineNumber="8951"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsXBinopExpr) &#123;</span></CodeLine>
<Link id="l08952" /><CodeLine lineNumber="8952"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsInteger) &#123;</span></CodeLine>
<Link id="l08953" /><CodeLine lineNumber="8953"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.IsSigned)</span></CodeLine>
<Link id="l08954" /><CodeLine lineNumber="8954"><span class="doxyHighlight">          NewOp = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == OMPAtomicCompareOp::MAX ? <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a39edb6e51c1ad37244e8b32a2af4077d">AtomicRMWInst::Min</a></span></CodeLine>
<Link id="l08955" /><CodeLine lineNumber="8955"><span class="doxyHighlight">                                                : <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615aa1184a7e35e94d162a2d40f2b11beeb2">AtomicRMWInst::Max</a>;</span></CodeLine>
<Link id="l08956" /><CodeLine lineNumber="8956"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08957" /><CodeLine lineNumber="8957"><span class="doxyHighlight">          NewOp = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == OMPAtomicCompareOp::MAX ? <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615aa53854e09143f57d2ff2ad6ac89dc55d">AtomicRMWInst::UMin</a></span></CodeLine>
<Link id="l08958" /><CodeLine lineNumber="8958"><span class="doxyHighlight">                                                : <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615abe171d96ba8de66fb30e08c00211591e">AtomicRMWInst::UMax</a>;</span></CodeLine>
<Link id="l08959" /><CodeLine lineNumber="8959"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08960" /><CodeLine lineNumber="8960"><span class="doxyHighlight">        NewOp = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == OMPAtomicCompareOp::MAX ? <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615abd5e733a10a36f3572105b1a67538e18">AtomicRMWInst::FMin</a></span></CodeLine>
<Link id="l08961" /><CodeLine lineNumber="8961"><span class="doxyHighlight">                                              : <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615acce124326ba87b0127b36c412bf555fd">AtomicRMWInst::FMax</a>;</span></CodeLine>
<Link id="l08962" /><CodeLine lineNumber="8962"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08963" /><CodeLine lineNumber="8963"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08964" /><CodeLine lineNumber="8964"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsInteger) &#123;</span></CodeLine>
<Link id="l08965" /><CodeLine lineNumber="8965"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.IsSigned)</span></CodeLine>
<Link id="l08966" /><CodeLine lineNumber="8966"><span class="doxyHighlight">          NewOp = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == OMPAtomicCompareOp::MAX ? <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615aa1184a7e35e94d162a2d40f2b11beeb2">AtomicRMWInst::Max</a></span></CodeLine>
<Link id="l08967" /><CodeLine lineNumber="8967"><span class="doxyHighlight">                                                : <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a39edb6e51c1ad37244e8b32a2af4077d">AtomicRMWInst::Min</a>;</span></CodeLine>
<Link id="l08968" /><CodeLine lineNumber="8968"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08969" /><CodeLine lineNumber="8969"><span class="doxyHighlight">          NewOp = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == OMPAtomicCompareOp::MAX ? <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615abe171d96ba8de66fb30e08c00211591e">AtomicRMWInst::UMax</a></span></CodeLine>
<Link id="l08970" /><CodeLine lineNumber="8970"><span class="doxyHighlight">                                                : <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615aa53854e09143f57d2ff2ad6ac89dc55d">AtomicRMWInst::UMin</a>;</span></CodeLine>
<Link id="l08971" /><CodeLine lineNumber="8971"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08972" /><CodeLine lineNumber="8972"><span class="doxyHighlight">        NewOp = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == OMPAtomicCompareOp::MAX ? <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615acce124326ba87b0127b36c412bf555fd">AtomicRMWInst::FMax</a></span></CodeLine>
<Link id="l08973" /><CodeLine lineNumber="8973"><span class="doxyHighlight">                                              : <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615abd5e733a10a36f3572105b1a67538e18">AtomicRMWInst::FMin</a>;</span></CodeLine>
<Link id="l08974" /><CodeLine lineNumber="8974"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l08975" /><CodeLine lineNumber="8975"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08976" /><CodeLine lineNumber="8976"></CodeLine>
<Link id="l08977" /><CodeLine lineNumber="8977"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/atomicrmwinst">AtomicRMWInst</a> &#42;OldValue =</span></CodeLine>
<Link id="l08978" /><CodeLine lineNumber="8978"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab2a2c89b21cf14b2c729a898006cb438">CreateAtomicRMW</a>(NewOp, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>.Var, E, <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a>(), AO);</span></CodeLine>
<Link id="l08979" /><CodeLine lineNumber="8979"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V.Var) &#123;</span></CodeLine>
<Link id="l08980" /><CodeLine lineNumber="8980"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;CapturedValue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08981" /><CodeLine lineNumber="8981"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsPostfixUpdate) &#123;</span></CodeLine>
<Link id="l08982" /><CodeLine lineNumber="8982"><span class="doxyHighlight">        CapturedValue = OldValue;</span></CodeLine>
<Link id="l08983" /><CodeLine lineNumber="8983"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08984" /><CodeLine lineNumber="8984"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred;</span></CodeLine>
<Link id="l08985" /><CodeLine lineNumber="8985"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (NewOp) &#123;</span></CodeLine>
<Link id="l08986" /><CodeLine lineNumber="8986"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615aa1184a7e35e94d162a2d40f2b11beeb2">AtomicRMWInst::Max</a>:</span></CodeLine>
<Link id="l08987" /><CodeLine lineNumber="8987"><span class="doxyHighlight">          Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba720a42e85f7e981afd61e28473b0000a">CmpInst::ICMP&#95;SGT</a>;</span></CodeLine>
<Link id="l08988" /><CodeLine lineNumber="8988"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08989" /><CodeLine lineNumber="8989"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615abe171d96ba8de66fb30e08c00211591e">AtomicRMWInst::UMax</a>:</span></CodeLine>
<Link id="l08990" /><CodeLine lineNumber="8990"><span class="doxyHighlight">          Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">CmpInst::ICMP&#95;UGT</a>;</span></CodeLine>
<Link id="l08991" /><CodeLine lineNumber="8991"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08992" /><CodeLine lineNumber="8992"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615acce124326ba87b0127b36c412bf555fd">AtomicRMWInst::FMax</a>:</span></CodeLine>
<Link id="l08993" /><CodeLine lineNumber="8993"><span class="doxyHighlight">          Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba4c399f525bbcf03d72af4b303e6eeca8">CmpInst::FCMP&#95;OGT</a>;</span></CodeLine>
<Link id="l08994" /><CodeLine lineNumber="8994"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08995" /><CodeLine lineNumber="8995"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615a39edb6e51c1ad37244e8b32a2af4077d">AtomicRMWInst::Min</a>:</span></CodeLine>
<Link id="l08996" /><CodeLine lineNumber="8996"><span class="doxyHighlight">          Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">CmpInst::ICMP&#95;SLT</a>;</span></CodeLine>
<Link id="l08997" /><CodeLine lineNumber="8997"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08998" /><CodeLine lineNumber="8998"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615aa53854e09143f57d2ff2ad6ac89dc55d">AtomicRMWInst::UMin</a>:</span></CodeLine>
<Link id="l08999" /><CodeLine lineNumber="8999"><span class="doxyHighlight">          Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">CmpInst::ICMP&#95;ULT</a>;</span></CodeLine>
<Link id="l09000" /><CodeLine lineNumber="9000"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09001" /><CodeLine lineNumber="9001"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/atomicrmwinst/#a461cfbbb5c7a57ab73210498923cf615abd5e733a10a36f3572105b1a67538e18">AtomicRMWInst::FMin</a>:</span></CodeLine>
<Link id="l09002" /><CodeLine lineNumber="9002"><span class="doxyHighlight">          Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba326bee0a4a424cef21c1cf8adb8b8dd8">CmpInst::FCMP&#95;OLT</a>;</span></CodeLine>
<Link id="l09003" /><CodeLine lineNumber="9003"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09004" /><CodeLine lineNumber="9004"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l09005" /><CodeLine lineNumber="9005"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;unexpected comparison op&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09006" /><CodeLine lineNumber="9006"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l09007" /><CodeLine lineNumber="9007"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;NonAtomicCmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a843d43d070f0b1c6a133403edce488ef">CreateCmp</a>(Pred, OldValue, E);</span></CodeLine>
<Link id="l09008" /><CodeLine lineNumber="9008"><span class="doxyHighlight">        CapturedValue = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(NonAtomicCmp, E, OldValue);</span></CodeLine>
<Link id="l09009" /><CodeLine lineNumber="9009"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09010" /><CodeLine lineNumber="9010"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(CapturedValue, V.Var, V.IsVolatile);</span></CodeLine>
<Link id="l09011" /><CodeLine lineNumber="9011"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09012" /><CodeLine lineNumber="9012"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09013" /><CodeLine lineNumber="9013"></CodeLine>
<Link id="l09014" /><CodeLine lineNumber="9014"><span class="doxyHighlight">  checkAndEmitFlushAfterAtomic(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, AO, AtomicKind::Compare);</span></CodeLine>
<Link id="l09015" /><CodeLine lineNumber="9015"></CodeLine>
<Link id="l09016" /><CodeLine lineNumber="9016"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l09017" /><CodeLine lineNumber="9017"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09018" /><CodeLine lineNumber="9018"></CodeLine>
<Link id="l09019" /><CodeLine lineNumber="9019"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#af24d1c61cec57095ced3b08a6dd99ee8">OpenMPIRBuilder::InsertPointOrErrorTy</a></span></CodeLine>
<Link id="l09020" /><CodeLine lineNumber="9020"><span class="doxyHighlight">OpenMPIRBuilder::createTeams(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> LocationDescription &amp;<a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l09021" /><CodeLine lineNumber="9021"><span class="doxyHighlight">                             BodyGenCallbackTy BodyGenCB, <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumTeamsLower,</span></CodeLine>
<Link id="l09022" /><CodeLine lineNumber="9022"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumTeamsUpper, <a href="/docs/api/classes/llvm/value">Value</a> &#42;ThreadLimit,</span></CodeLine>
<Link id="l09023" /><CodeLine lineNumber="9023"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/value">Value</a> &#42;IfExpr) &#123;</span></CodeLine>
<Link id="l09024" /><CodeLine lineNumber="9024"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!updateToLocation(<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l09025" /><CodeLine lineNumber="9025"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a>();</span></CodeLine>
<Link id="l09026" /><CodeLine lineNumber="9026"></CodeLine>
<Link id="l09027" /><CodeLine lineNumber="9027"><span class="doxyHighlight">  uint32&#95;t SrcLocStrSize;</span></CodeLine>
<Link id="l09028" /><CodeLine lineNumber="9028"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SrcLocStr = getOrCreateSrcLocStr(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, SrcLocStrSize);</span></CodeLine>
<Link id="l09029" /><CodeLine lineNumber="9029"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ident = getOrCreateIdent(SrcLocStr, SrcLocStrSize);</span></CodeLine>
<Link id="l09030" /><CodeLine lineNumber="9030"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;CurrentFunction = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l09031" /><CodeLine lineNumber="9031"></CodeLine>
<Link id="l09032" /><CodeLine lineNumber="9032"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Outer allocation basicblock is the entry block of the current function.</span></CodeLine>
<Link id="l09033" /><CodeLine lineNumber="9033"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;OuterAllocaBB = CurrentFunction-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>();</span></CodeLine>
<Link id="l09034" /><CodeLine lineNumber="9034"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&amp;OuterAllocaBB == Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a60a6d6c205f483fa96597a960f3c093b">GetInsertBlock</a>()) &#123;</span></CodeLine>
<Link id="l09035" /><CodeLine lineNumber="9035"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BodyBB = <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;teams.entry&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09036" /><CodeLine lineNumber="9036"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(BodyBB, BodyBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l09037" /><CodeLine lineNumber="9037"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09038" /><CodeLine lineNumber="9038"></CodeLine>
<Link id="l09039" /><CodeLine lineNumber="9039"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The current basic block is split into four basic blocks. After outlining,</span></CodeLine>
<Link id="l09040" /><CodeLine lineNumber="9040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// they will be mapped as follows:</span></CodeLine>
<Link id="l09041" /><CodeLine lineNumber="9041"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#96;&#96;&#96;</span></CodeLine>
<Link id="l09042" /><CodeLine lineNumber="9042"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// def current&#95;fn() &#123;</span></CodeLine>
<Link id="l09043" /><CodeLine lineNumber="9043"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   current&#95;basic&#95;block:</span></CodeLine>
<Link id="l09044" /><CodeLine lineNumber="9044"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     br label %teams.exit</span></CodeLine>
<Link id="l09045" /><CodeLine lineNumber="9045"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   teams.exit:</span></CodeLine>
<Link id="l09046" /><CodeLine lineNumber="9046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     ; instructions after teams</span></CodeLine>
<Link id="l09047" /><CodeLine lineNumber="9047"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#125;</span></CodeLine>
<Link id="l09048" /><CodeLine lineNumber="9048"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09049" /><CodeLine lineNumber="9049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// def outlined&#95;fn() &#123;</span></CodeLine>
<Link id="l09050" /><CodeLine lineNumber="9050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   teams.alloca:</span></CodeLine>
<Link id="l09051" /><CodeLine lineNumber="9051"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     br label %teams.body</span></CodeLine>
<Link id="l09052" /><CodeLine lineNumber="9052"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   teams.body:</span></CodeLine>
<Link id="l09053" /><CodeLine lineNumber="9053"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     ; instructions within teams body</span></CodeLine>
<Link id="l09054" /><CodeLine lineNumber="9054"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#125;</span></CodeLine>
<Link id="l09055" /><CodeLine lineNumber="9055"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#96;&#96;&#96;</span></CodeLine>
<Link id="l09056" /><CodeLine lineNumber="9056"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBB = <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;teams.exit&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09057" /><CodeLine lineNumber="9057"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BodyBB = <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;teams.body&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09058" /><CodeLine lineNumber="9058"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;AllocaBB =</span></CodeLine>
<Link id="l09059" /><CodeLine lineNumber="9059"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a85ee70791795fa2ddb07694182f783b2">splitBB</a>(Builder, </span><span class="doxyHighlightComment">/&#42;CreateBranch=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;teams.alloca&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09060" /><CodeLine lineNumber="9060"></CodeLine>
<Link id="l09061" /><CodeLine lineNumber="9061"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SubClausesPresent =</span></CodeLine>
<Link id="l09062" /><CodeLine lineNumber="9062"><span class="doxyHighlight">      (NumTeamsLower || NumTeamsUpper || ThreadLimit || IfExpr);</span></CodeLine>
<Link id="l09063" /><CodeLine lineNumber="9063"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Push num&#95;teams</span></CodeLine>
<Link id="l09064" /><CodeLine lineNumber="9064"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Config.isTargetDevice() &amp;&amp; SubClausesPresent) &#123;</span></CodeLine>
<Link id="l09065" /><CodeLine lineNumber="9065"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((NumTeamsLower == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> || NumTeamsUpper != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &amp;&amp;</span></CodeLine>
<Link id="l09066" /><CodeLine lineNumber="9066"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;if lowerbound is non-null, then upperbound must also be non-null &quot;</span></CodeLine>
<Link id="l09067" /><CodeLine lineNumber="9067"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;for bounds on num&#95;teams&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09068" /><CodeLine lineNumber="9068"></CodeLine>
<Link id="l09069" /><CodeLine lineNumber="9069"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumTeamsUpper == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l09070" /><CodeLine lineNumber="9070"><span class="doxyHighlight">      NumTeamsUpper = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(0);</span></CodeLine>
<Link id="l09071" /><CodeLine lineNumber="9071"></CodeLine>
<Link id="l09072" /><CodeLine lineNumber="9072"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumTeamsLower == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l09073" /><CodeLine lineNumber="9073"><span class="doxyHighlight">      NumTeamsLower = NumTeamsUpper;</span></CodeLine>
<Link id="l09074" /><CodeLine lineNumber="9074"></CodeLine>
<Link id="l09075" /><CodeLine lineNumber="9075"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfExpr) &#123;</span></CodeLine>
<Link id="l09076" /><CodeLine lineNumber="9076"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IfExpr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l09077" /><CodeLine lineNumber="9077"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;argument to if clause must be an integer value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09078" /><CodeLine lineNumber="9078"></CodeLine>
<Link id="l09079" /><CodeLine lineNumber="9079"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// upper = ifexpr ? upper : 1</span></CodeLine>
<Link id="l09080" /><CodeLine lineNumber="9080"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfExpr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64iseldagtodag-cpp/#a2098a5fa6ada61b6c4a1f210ad84e4a1a3cc05cd6e06dd1976f88ed7d808ac0a1">Int1</a>)</span></CodeLine>
<Link id="l09081" /><CodeLine lineNumber="9081"><span class="doxyHighlight">        IfExpr = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a6ef1729b04a4fbd6c6f27787cdd0e813">CreateICmpNE</a>(IfExpr,</span></CodeLine>
<Link id="l09082" /><CodeLine lineNumber="9082"><span class="doxyHighlight">                                      ConstantInt::get(IfExpr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 0));</span></CodeLine>
<Link id="l09083" /><CodeLine lineNumber="9083"><span class="doxyHighlight">      NumTeamsUpper = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(</span></CodeLine>
<Link id="l09084" /><CodeLine lineNumber="9084"><span class="doxyHighlight">          IfExpr, NumTeamsUpper, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(1), </span><span class="doxyHighlightStringLiteral">&quot;numTeamsUpper&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09085" /><CodeLine lineNumber="9085"></CodeLine>
<Link id="l09086" /><CodeLine lineNumber="9086"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// lower = ifexpr ? lower : 1</span></CodeLine>
<Link id="l09087" /><CodeLine lineNumber="9087"><span class="doxyHighlight">      NumTeamsLower = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(</span></CodeLine>
<Link id="l09088" /><CodeLine lineNumber="9088"><span class="doxyHighlight">          IfExpr, NumTeamsLower, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(1), </span><span class="doxyHighlightStringLiteral">&quot;numTeamsLower&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09089" /><CodeLine lineNumber="9089"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09090" /><CodeLine lineNumber="9090"></CodeLine>
<Link id="l09091" /><CodeLine lineNumber="9091"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ThreadLimit == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l09092" /><CodeLine lineNumber="9092"><span class="doxyHighlight">      ThreadLimit = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(0);</span></CodeLine>
<Link id="l09093" /><CodeLine lineNumber="9093"></CodeLine>
<Link id="l09094" /><CodeLine lineNumber="9094"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;ThreadNum = getOrCreateThreadID(Ident);</span></CodeLine>
<Link id="l09095" /><CodeLine lineNumber="9095"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(</span></CodeLine>
<Link id="l09096" /><CodeLine lineNumber="9096"><span class="doxyHighlight">        getOrCreateRuntimeFunctionPtr(OMPRTL&#95;&#95;&#95;kmpc&#95;push&#95;num&#95;teams&#95;51),</span></CodeLine>
<Link id="l09097" /><CodeLine lineNumber="9097"><span class="doxyHighlight">        &#123;Ident, ThreadNum, NumTeamsLower, NumTeamsUpper, ThreadLimit&#125;);</span></CodeLine>
<Link id="l09098" /><CodeLine lineNumber="9098"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09099" /><CodeLine lineNumber="9099"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate the body of teams.</span></CodeLine>
<Link id="l09100" /><CodeLine lineNumber="9100"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> AllocaIP(AllocaBB, AllocaBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l09101" /><CodeLine lineNumber="9101"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> CodeGenIP(BodyBB, BodyBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l09102" /><CodeLine lineNumber="9102"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac226f3d2b9ca090171a8e0a8cb92c343a902b0d55fddef6f8d651fe1035b7d4bd">Error</a> Err = BodyGenCB(AllocaIP, CodeGenIP))</span></CodeLine>
<Link id="l09103" /><CodeLine lineNumber="9103"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Err;</span></CodeLine>
<Link id="l09104" /><CodeLine lineNumber="9104"></CodeLine>
<Link id="l09105" /><CodeLine lineNumber="9105"><span class="doxyHighlight">  OutlineInfo OI;</span></CodeLine>
<Link id="l09106" /><CodeLine lineNumber="9106"><span class="doxyHighlight">  OI.EntryBB = AllocaBB;</span></CodeLine>
<Link id="l09107" /><CodeLine lineNumber="9107"><span class="doxyHighlight">  OI.ExitBB = ExitBB;</span></CodeLine>
<Link id="l09108" /><CodeLine lineNumber="9108"><span class="doxyHighlight">  OI.OuterAllocaBB = &amp;OuterAllocaBB;</span></CodeLine>
<Link id="l09109" /><CodeLine lineNumber="9109"></CodeLine>
<Link id="l09110" /><CodeLine lineNumber="9110"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert fake values for global tid and bound tid.</span></CodeLine>
<Link id="l09111" /><CodeLine lineNumber="9111"><span class="doxyHighlight">  SmallVector&lt;Instruction &#42;, 8&gt; ToBeDeleted;</span></CodeLine>
<Link id="l09112" /><CodeLine lineNumber="9112"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#aafc1886793b898052f87edd7e9fdbaa3">InsertPointTy</a> OuterAllocaIP(&amp;OuterAllocaBB, OuterAllocaBB.<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l09113" /><CodeLine lineNumber="9113"><span class="doxyHighlight">  OI.ExcludeArgsFromAggregate.push&#95;back(<a href="#a35409dbaffc2cf38fefec12e3cf9094d">createFakeIntVal</a>(</span></CodeLine>
<Link id="l09114" /><CodeLine lineNumber="9114"><span class="doxyHighlight">      Builder, OuterAllocaIP, ToBeDeleted, AllocaIP, </span><span class="doxyHighlightStringLiteral">&quot;gid&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l09115" /><CodeLine lineNumber="9115"><span class="doxyHighlight">  OI.ExcludeArgsFromAggregate.push&#95;back(<a href="#a35409dbaffc2cf38fefec12e3cf9094d">createFakeIntVal</a>(</span></CodeLine>
<Link id="l09116" /><CodeLine lineNumber="9116"><span class="doxyHighlight">      Builder, OuterAllocaIP, ToBeDeleted, AllocaIP, </span><span class="doxyHighlightStringLiteral">&quot;tid&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l09117" /><CodeLine lineNumber="9117"></CodeLine>
<Link id="l09118" /><CodeLine lineNumber="9118"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> HostPostOutlineCB = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, Ident,</span></CodeLine>
<Link id="l09119" /><CodeLine lineNumber="9119"><span class="doxyHighlight">                            ToBeDeleted&#93;(<a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &amp;OutlinedFn) </span><span class="doxyHighlightKeyword">mutable</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l09120" /><CodeLine lineNumber="9120"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The stale call instruction will be replaced with a new call instruction</span></CodeLine>
<Link id="l09121" /><CodeLine lineNumber="9121"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for runtime call with the outlined function.</span></CodeLine>
<Link id="l09122" /><CodeLine lineNumber="9122"></CodeLine>
<Link id="l09123" /><CodeLine lineNumber="9123"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFn.<a href="/docs/api/classes/llvm/value/#aba0055050d741f60b6e0523507a2c79f">getNumUses</a>() == 1 &amp;&amp;</span></CodeLine>
<Link id="l09124" /><CodeLine lineNumber="9124"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;there must be a single user for the outlined function&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09125" /><CodeLine lineNumber="9125"><span class="doxyHighlight">    CallInst &#42;StaleCI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(OutlinedFn.<a href="/docs/api/classes/llvm/value/#a46db903db2484e1ef5062d094d6b0854">user&#95;back</a>());</span></CodeLine>
<Link id="l09126" /><CodeLine lineNumber="9126"><span class="doxyHighlight">    ToBeDeleted.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(StaleCI);</span></CodeLine>
<Link id="l09127" /><CodeLine lineNumber="9127"></CodeLine>
<Link id="l09128" /><CodeLine lineNumber="9128"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((OutlinedFn.<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() == 2 || OutlinedFn.<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() == 3) &amp;&amp;</span></CodeLine>
<Link id="l09129" /><CodeLine lineNumber="9129"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Outlined function must have two or three arguments only&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09130" /><CodeLine lineNumber="9130"></CodeLine>
<Link id="l09131" /><CodeLine lineNumber="9131"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasShared = OutlinedFn.<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() == 3;</span></CodeLine>
<Link id="l09132" /><CodeLine lineNumber="9132"></CodeLine>
<Link id="l09133" /><CodeLine lineNumber="9133"><span class="doxyHighlight">    OutlinedFn.<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</span><span class="doxyHighlightStringLiteral">&quot;global.tid.ptr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09134" /><CodeLine lineNumber="9134"><span class="doxyHighlight">    OutlinedFn.<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(1)-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</span><span class="doxyHighlightStringLiteral">&quot;bound.tid.ptr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09135" /><CodeLine lineNumber="9135"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasShared)</span></CodeLine>
<Link id="l09136" /><CodeLine lineNumber="9136"><span class="doxyHighlight">      OutlinedFn.<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(2)-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</span><span class="doxyHighlightStringLiteral">&quot;data&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09137" /><CodeLine lineNumber="9137"></CodeLine>
<Link id="l09138" /><CodeLine lineNumber="9138"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Call to the runtime function for teams in the current function.</span></CodeLine>
<Link id="l09139" /><CodeLine lineNumber="9139"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StaleCI &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Error while outlining - no CallInst user found for the &quot;</span></CodeLine>
<Link id="l09140" /><CodeLine lineNumber="9140"><span class="doxyHighlight">                      </span><span class="doxyHighlightStringLiteral">&quot;outlined function.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09141" /><CodeLine lineNumber="9141"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(StaleCI);</span></CodeLine>
<Link id="l09142" /><CodeLine lineNumber="9142"><span class="doxyHighlight">    SmallVector&lt;Value &#42;&gt; <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a> = &#123;</span></CodeLine>
<Link id="l09143" /><CodeLine lineNumber="9143"><span class="doxyHighlight">        Ident, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8246a9e9405ffe2a9d8d020a949c8e96">getInt32</a>(StaleCI-&gt;<a href="/docs/api/classes/llvm/callbase/#adde2ea00dd2613ee41bfe91908e4e68e">arg&#95;size</a>() - 2), &amp;OutlinedFn&#125;;</span></CodeLine>
<Link id="l09144" /><CodeLine lineNumber="9144"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasShared)</span></CodeLine>
<Link id="l09145" /><CodeLine lineNumber="9145"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>.push&#95;back(StaleCI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(2));</span></CodeLine>
<Link id="l09146" /><CodeLine lineNumber="9146"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(getOrCreateRuntimeFunctionPtr(</span></CodeLine>
<Link id="l09147" /><CodeLine lineNumber="9147"><span class="doxyHighlight">                           omp::RuntimeFunction::OMPRTL&#95;&#95;&#95;kmpc&#95;fork&#95;teams),</span></CodeLine>
<Link id="l09148" /><CodeLine lineNumber="9148"><span class="doxyHighlight">                       Args);</span></CodeLine>
<Link id="l09149" /><CodeLine lineNumber="9149"></CodeLine>
<Link id="l09150" /><CodeLine lineNumber="9150"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">llvm::reverse</a>(ToBeDeleted))</span></CodeLine>
<Link id="l09151" /><CodeLine lineNumber="9151"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l09152" /><CodeLine lineNumber="9152"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l09153" /><CodeLine lineNumber="9153"></CodeLine>
<Link id="l09154" /><CodeLine lineNumber="9154"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Config.isTargetDevice())</span></CodeLine>
<Link id="l09155" /><CodeLine lineNumber="9155"><span class="doxyHighlight">    OI.PostOutlineCB = HostPostOutlineCB;</span></CodeLine>
<Link id="l09156" /><CodeLine lineNumber="9156"></CodeLine>
<Link id="l09157" /><CodeLine lineNumber="9157"><span class="doxyHighlight">  addOutlineInfo(std::move(OI));</span></CodeLine>
<Link id="l09158" /><CodeLine lineNumber="9158"></CodeLine>
<Link id="l09159" /><CodeLine lineNumber="9159"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(ExitBB, ExitBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l09160" /><CodeLine lineNumber="9160"></CodeLine>
<Link id="l09161" /><CodeLine lineNumber="9161"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a79479229269c1abc7dba0840d19b97cf">saveIP</a>();</span></CodeLine>
<Link id="l09162" /><CodeLine lineNumber="9162"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09163" /><CodeLine lineNumber="9163"></CodeLine>
<Link id="l09164" /><CodeLine lineNumber="9164"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;</span></CodeLine>
<Link id="l09165" /><CodeLine lineNumber="9165"><span class="doxyHighlight">OpenMPIRBuilder::createOffloadMapnames(<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;llvm::Constant &#42;&gt;</a> &amp;Names,</span></CodeLine>
<Link id="l09166" /><CodeLine lineNumber="9166"><span class="doxyHighlight">                                       std::string VarName) &#123;</span></CodeLine>
<Link id="l09167" /><CodeLine lineNumber="9167"><span class="doxyHighlight">  llvm::Constant &#42;MapNamesArrayInit = <a href="/docs/api/classes/llvm/constantarray/#a0900dacdc7ad8e3ea0cc92993c7fd422">llvm::ConstantArray::get</a>(</span></CodeLine>
<Link id="l09168" /><CodeLine lineNumber="9168"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">llvm::ArrayType::get</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">llvm::PointerType::getUnqual</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext()),</span></CodeLine>
<Link id="l09169" /><CodeLine lineNumber="9169"><span class="doxyHighlight">                           <a href="/docs/api/namespaces/anonymous-textstubv5-cpp-/#ad2f3f81faa370c8bf9a1f81612c90adfa638c40d9df2fbeba253de8cd53d19afd">Names</a>.size()),</span></CodeLine>
<Link id="l09170" /><CodeLine lineNumber="9170"><span class="doxyHighlight">      Names);</span></CodeLine>
<Link id="l09171" /><CodeLine lineNumber="9171"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MapNamesArrayGlobal = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> llvm::GlobalVariable(</span></CodeLine>
<Link id="l09172" /><CodeLine lineNumber="9172"><span class="doxyHighlight">      M, MapNamesArrayInit-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l09173" /><CodeLine lineNumber="9173"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;isConstant=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca04ed141708c0fd16723d212502b046ae">llvm::GlobalValue::PrivateLinkage</a>, MapNamesArrayInit,</span></CodeLine>
<Link id="l09174" /><CodeLine lineNumber="9174"><span class="doxyHighlight">      VarName);</span></CodeLine>
<Link id="l09175" /><CodeLine lineNumber="9175"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MapNamesArrayGlobal;</span></CodeLine>
<Link id="l09176" /><CodeLine lineNumber="9176"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09177" /><CodeLine lineNumber="9177"></CodeLine>
<Link id="l09178" /><CodeLine lineNumber="9178"><span class="doxyHighlightComment">// Create all simple and struct types exposed by the runtime and remember</span></CodeLine>
<Link id="l09179" /><CodeLine lineNumber="9179"><span class="doxyHighlightComment">// the llvm::PointerTypes of them for easy access later.</span></CodeLine>
<Link id="l09180" /><CodeLine lineNumber="9180"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::initializeTypes(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</span></CodeLine>
<Link id="l09181" /><CodeLine lineNumber="9181"><span class="doxyHighlight">  LLVMContext &amp;Ctx = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext();</span></CodeLine>
<Link id="l09182" /><CodeLine lineNumber="9182"><span class="doxyHighlight">  StructType &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>;</span></CodeLine>
<Link id="l09183" /><CodeLine lineNumber="9183"><span class="doxyHighlightPreprocessor">#define OMP&#95;TYPE(VarName, InitValue) VarName = InitValue;</span></CodeLine>
<Link id="l09184" /><CodeLine lineNumber="9184"><span class="doxyHighlightPreprocessor">#define OMP&#95;ARRAY&#95;TYPE(VarName, ElemTy, ArraySize)                             \\</span></CodeLine>
<Link id="l09185" /><CodeLine lineNumber="9185"><span class="doxyHighlightPreprocessor">  VarName##Ty = ArrayType::get(ElemTy, ArraySize);                             \\</span></CodeLine>
<Link id="l09186" /><CodeLine lineNumber="9186"><span class="doxyHighlightPreprocessor">  VarName##PtrTy = PointerType::getUnqual(Ctx);</span></CodeLine>
<Link id="l09187" /><CodeLine lineNumber="9187"><span class="doxyHighlightPreprocessor">#define OMP&#95;FUNCTION&#95;TYPE(VarName, IsVarArg, ReturnType, ...)                  \\</span></CodeLine>
<Link id="l09188" /><CodeLine lineNumber="9188"><span class="doxyHighlightPreprocessor">  VarName = FunctionType::get(ReturnType, &#123;&#95;&#95;VA&#95;ARGS&#95;&#95;&#125;, IsVarArg);            \\</span></CodeLine>
<Link id="l09189" /><CodeLine lineNumber="9189"><span class="doxyHighlightPreprocessor">  VarName##Ptr = PointerType::getUnqual(Ctx);</span></CodeLine>
<Link id="l09190" /><CodeLine lineNumber="9190"><span class="doxyHighlightPreprocessor">#define OMP&#95;STRUCT&#95;TYPE(VarName, StructName, Packed, ...)                      \\</span></CodeLine>
<Link id="l09191" /><CodeLine lineNumber="9191"><span class="doxyHighlightPreprocessor">  T = StructType::getTypeByName(Ctx, StructName);                              \\</span></CodeLine>
<Link id="l09192" /><CodeLine lineNumber="9192"><span class="doxyHighlightPreprocessor">  if (!T)                                                                      \\</span></CodeLine>
<Link id="l09193" /><CodeLine lineNumber="9193"><span class="doxyHighlightPreprocessor">    T = StructType::create(Ctx, &#123;&#95;&#95;VA&#95;ARGS&#95;&#95;&#125;, StructName, Packed);            \\</span></CodeLine>
<Link id="l09194" /><CodeLine lineNumber="9194"><span class="doxyHighlightPreprocessor">  VarName = T;                                                                 \\</span></CodeLine>
<Link id="l09195" /><CodeLine lineNumber="9195"><span class="doxyHighlightPreprocessor">  VarName##Ptr = PointerType::getUnqual(Ctx);</span></CodeLine>
<Link id="l09196" /><CodeLine lineNumber="9196"><span class="doxyHighlightPreprocessor">#include &quot;llvm/Frontend/OpenMP/OMPKinds.def&quot;</span></CodeLine>
<Link id="l09197" /><CodeLine lineNumber="9197"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09198" /><CodeLine lineNumber="9198"></CodeLine>
<Link id="l09199" /><CodeLine lineNumber="9199"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::OutlineInfo::collectBlocks(</span></CodeLine>
<Link id="l09200" /><CodeLine lineNumber="9200"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;BasicBlock &#42;&gt;</a> &amp;BlockSet,</span></CodeLine>
<Link id="l09201" /><CodeLine lineNumber="9201"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;BlockVector) &#123;</span></CodeLine>
<Link id="l09202" /><CodeLine lineNumber="9202"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 32&gt;</a> Worklist;</span></CodeLine>
<Link id="l09203" /><CodeLine lineNumber="9203"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/anonymous-spirvstructurizer-cpp-/#aa4ac0cf7354cfba97c5050380cb0d29f">BlockSet</a>.insert(EntryBB);</span></CodeLine>
<Link id="l09204" /><CodeLine lineNumber="9204"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/anonymous-spirvstructurizer-cpp-/#aa4ac0cf7354cfba97c5050380cb0d29f">BlockSet</a>.insert(ExitBB);</span></CodeLine>
<Link id="l09205" /><CodeLine lineNumber="9205"></CodeLine>
<Link id="l09206" /><CodeLine lineNumber="9206"><span class="doxyHighlight">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(EntryBB);</span></CodeLine>
<Link id="l09207" /><CodeLine lineNumber="9207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l09208" /><CodeLine lineNumber="9208"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l09209" /><CodeLine lineNumber="9209"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-webassemblyfixirreduciblecontrolflow-cpp-/#a3e92ddb387e221cd76d85d4f508b1716">BlockVector</a>.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(BB);</span></CodeLine>
<Link id="l09210" /><CodeLine lineNumber="9210"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccBB : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(BB))</span></CodeLine>
<Link id="l09211" /><CodeLine lineNumber="9211"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/anonymous-spirvstructurizer-cpp-/#aa4ac0cf7354cfba97c5050380cb0d29f">BlockSet</a>.insert(SuccBB).second)</span></CodeLine>
<Link id="l09212" /><CodeLine lineNumber="9212"><span class="doxyHighlight">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SuccBB);</span></CodeLine>
<Link id="l09213" /><CodeLine lineNumber="9213"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09214" /><CodeLine lineNumber="9214"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09215" /><CodeLine lineNumber="9215"></CodeLine>
<Link id="l09216" /><CodeLine lineNumber="9216"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::createOffloadEntry(<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Addr,</span></CodeLine>
<Link id="l09217" /><CodeLine lineNumber="9217"><span class="doxyHighlight">                                         uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, int32&#95;t <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a>,</span></CodeLine>
<Link id="l09218" /><CodeLine lineNumber="9218"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57c">GlobalValue::LinkageTypes</a>,</span></CodeLine>
<Link id="l09219" /><CodeLine lineNumber="9219"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name) &#123;</span></CodeLine>
<Link id="l09220" /><CodeLine lineNumber="9220"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Config.isGPU()) &#123;</span></CodeLine>
<Link id="l09221" /><CodeLine lineNumber="9221"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/offloading/#a4b79b6c874e2b55eb4dda2ae96867f84">llvm::offloading::emitOffloadingEntry</a>(</span></CodeLine>
<Link id="l09222" /><CodeLine lineNumber="9222"><span class="doxyHighlight">        M, <a href="/docs/api/namespaces/llvm/object/#a92b4561998310fbcfbeaeb7c449bad6aaf8060971587bf244fd04e657d00529ff">object::OffloadKind::OFK&#95;OpenMP</a>, <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>,</span></CodeLine>
<Link id="l09223" /><CodeLine lineNumber="9223"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/graphprogram/#a0ad4685976f8c4d4a697a53fbe05d10b">Name</a>.empty() ? Addr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() : Name, <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>, <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a>, </span><span class="doxyHighlightComment">/&#42;Data=&#42;/</span><span class="doxyHighlight">0,</span></CodeLine>
<Link id="l09224" /><CodeLine lineNumber="9224"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;offloading&#95;entries&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09225" /><CodeLine lineNumber="9225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09226" /><CodeLine lineNumber="9226"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09227" /><CodeLine lineNumber="9227"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Add support for global variables on the device after declare target</span></CodeLine>
<Link id="l09228" /><CodeLine lineNumber="9228"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// support.</span></CodeLine>
<Link id="l09229" /><CodeLine lineNumber="9229"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;Fn = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Function&gt;</a>(Addr);</span></CodeLine>
<Link id="l09230" /><CodeLine lineNumber="9230"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Fn)</span></CodeLine>
<Link id="l09231" /><CodeLine lineNumber="9231"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09232" /><CodeLine lineNumber="9232"></CodeLine>
<Link id="l09233" /><CodeLine lineNumber="9233"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add a function attribute for the kernel.</span></CodeLine>
<Link id="l09234" /><CodeLine lineNumber="9234"><span class="doxyHighlight">  Fn-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(</span><span class="doxyHighlightStringLiteral">&quot;kernel&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09235" /><CodeLine lineNumber="9235"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>.isAMDGCN())</span></CodeLine>
<Link id="l09236" /><CodeLine lineNumber="9236"><span class="doxyHighlight">    Fn-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(</span><span class="doxyHighlightStringLiteral">&quot;uniform-work-group-size&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;true&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09237" /><CodeLine lineNumber="9237"><span class="doxyHighlight">  Fn-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(Attribute::MustProgress);</span></CodeLine>
<Link id="l09238" /><CodeLine lineNumber="9238"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09239" /><CodeLine lineNumber="9239"></CodeLine>
<Link id="l09240" /><CodeLine lineNumber="9240"><span class="doxyHighlightComment">// We only generate metadata for function that contain target regions.</span></CodeLine>
<Link id="l09241" /><CodeLine lineNumber="9241"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OpenMPIRBuilder::createOffloadEntriesAndInfoMetadata(</span></CodeLine>
<Link id="l09242" /><CodeLine lineNumber="9242"><span class="doxyHighlight">    EmitMetadataErrorReportFunctionTy &amp;ErrorFn) &#123;</span></CodeLine>
<Link id="l09243" /><CodeLine lineNumber="9243"></CodeLine>
<Link id="l09244" /><CodeLine lineNumber="9244"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are no entries, we don&#39;t need to do anything.</span></CodeLine>
<Link id="l09245" /><CodeLine lineNumber="9245"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OffloadInfoManager.empty())</span></CodeLine>
<Link id="l09246" /><CodeLine lineNumber="9246"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09247" /><CodeLine lineNumber="9247"></CodeLine>
<Link id="l09248" /><CodeLine lineNumber="9248"><span class="doxyHighlight">  LLVMContext &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext();</span></CodeLine>
<Link id="l09249" /><CodeLine lineNumber="9249"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector</a>&lt;std::pair&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> OffloadEntriesInfoManager::OffloadEntryInfo &#42;,</span></CodeLine>
<Link id="l09250" /><CodeLine lineNumber="9250"><span class="doxyHighlight">                        TargetRegionEntryInfo&gt;,</span></CodeLine>
<Link id="l09251" /><CodeLine lineNumber="9251"><span class="doxyHighlight">              16&gt;</span></CodeLine>
<Link id="l09252" /><CodeLine lineNumber="9252"><span class="doxyHighlight">      OrderedEntries(OffloadInfoManager.size());</span></CodeLine>
<Link id="l09253" /><CodeLine lineNumber="9253"></CodeLine>
<Link id="l09254" /><CodeLine lineNumber="9254"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Auxiliary methods to create metadata values and strings.</span></CodeLine>
<Link id="l09255" /><CodeLine lineNumber="9255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&amp;GetMDInt = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>) &#123;</span></CodeLine>
<Link id="l09256" /><CodeLine lineNumber="9256"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantasmetadata/#a4c720c398a263087e00d7358b05636d5">ConstantAsMetadata::get</a>(ConstantInt::get(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5852dc0d180581d34902e8abcbf7e930">getInt32Ty</a>(), V));</span></CodeLine>
<Link id="l09257" /><CodeLine lineNumber="9257"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l09258" /><CodeLine lineNumber="9258"></CodeLine>
<Link id="l09259" /><CodeLine lineNumber="9259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&amp;GetMDString = &#91;&amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>&#93;(StringRef <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, V); &#125;;</span></CodeLine>
<Link id="l09260" /><CodeLine lineNumber="9260"></CodeLine>
<Link id="l09261" /><CodeLine lineNumber="9261"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the offloading info metadata node.</span></CodeLine>
<Link id="l09262" /><CodeLine lineNumber="9262"><span class="doxyHighlight">  NamedMDNode &#42;MD = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getOrInsertNamedMetadata(</span><span class="doxyHighlightStringLiteral">&quot;omp&#95;offload.info&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09263" /><CodeLine lineNumber="9263"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&amp;TargetRegionMetadataEmitter =</span></CodeLine>
<Link id="l09264" /><CodeLine lineNumber="9264"><span class="doxyHighlight">      &#91;&amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, MD, &amp;OrderedEntries, &amp;GetMDInt, &amp;GetMDString&#93;(</span></CodeLine>
<Link id="l09265" /><CodeLine lineNumber="9265"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> TargetRegionEntryInfo &amp;EntryInfo,</span></CodeLine>
<Link id="l09266" /><CodeLine lineNumber="9266"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> OffloadEntriesInfoManager::OffloadEntryInfoTargetRegion &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>) &#123;</span></CodeLine>
<Link id="l09267" /><CodeLine lineNumber="9267"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Generate metadata for target regions. Each entry of this metadata</span></CodeLine>
<Link id="l09268" /><CodeLine lineNumber="9268"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// contains:</span></CodeLine>
<Link id="l09269" /><CodeLine lineNumber="9269"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// - Entry 0 -&gt; Kind of this type of metadata (0).</span></CodeLine>
<Link id="l09270" /><CodeLine lineNumber="9270"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// - Entry 1 -&gt; Device ID of the file where the entry was identified.</span></CodeLine>
<Link id="l09271" /><CodeLine lineNumber="9271"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// - Entry 2 -&gt; File ID of the file where the entry was identified.</span></CodeLine>
<Link id="l09272" /><CodeLine lineNumber="9272"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// - Entry 3 -&gt; Mangled name of the function where the entry was</span></CodeLine>
<Link id="l09273" /><CodeLine lineNumber="9273"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// identified.</span></CodeLine>
<Link id="l09274" /><CodeLine lineNumber="9274"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// - Entry 4 -&gt; Line in the file where the entry was identified.</span></CodeLine>
<Link id="l09275" /><CodeLine lineNumber="9275"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// - Entry 5 -&gt; Count of regions at this DeviceID/FilesID/Line.</span></CodeLine>
<Link id="l09276" /><CodeLine lineNumber="9276"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// - Entry 6 -&gt; Order the entry was created.</span></CodeLine>
<Link id="l09277" /><CodeLine lineNumber="9277"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The first element of the metadata node is the kind.</span></CodeLine>
<Link id="l09278" /><CodeLine lineNumber="9278"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/directx/dxiltranslatemetadata-cpp/#a26b689be9525270658579553e0adfec1">Metadata</a> &#42;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;&#93; = &#123;</span></CodeLine>
<Link id="l09279" /><CodeLine lineNumber="9279"><span class="doxyHighlight">            GetMDInt(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.getKind()),      GetMDInt(EntryInfo.DeviceID),</span></CodeLine>
<Link id="l09280" /><CodeLine lineNumber="9280"><span class="doxyHighlight">            GetMDInt(EntryInfo.FileID), GetMDString(EntryInfo.ParentName),</span></CodeLine>
<Link id="l09281" /><CodeLine lineNumber="9281"><span class="doxyHighlight">            GetMDInt(EntryInfo.Line),   GetMDInt(EntryInfo.Count),</span></CodeLine>
<Link id="l09282" /><CodeLine lineNumber="9282"><span class="doxyHighlight">            GetMDInt(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.getOrder())&#125;;</span></CodeLine>
<Link id="l09283" /><CodeLine lineNumber="9283"></CodeLine>
<Link id="l09284" /><CodeLine lineNumber="9284"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Save this entry in the right position of the ordered entries array.</span></CodeLine>
<Link id="l09285" /><CodeLine lineNumber="9285"><span class="doxyHighlight">        OrderedEntries&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.getOrder()&#93; = std::make&#95;pair(&amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>, EntryInfo);</span></CodeLine>
<Link id="l09286" /><CodeLine lineNumber="9286"></CodeLine>
<Link id="l09287" /><CodeLine lineNumber="9287"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Add metadata to the named metadata node.</span></CodeLine>
<Link id="l09288" /><CodeLine lineNumber="9288"><span class="doxyHighlight">        MD-&gt;addOperand(<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>));</span></CodeLine>
<Link id="l09289" /><CodeLine lineNumber="9289"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l09290" /><CodeLine lineNumber="9290"></CodeLine>
<Link id="l09291" /><CodeLine lineNumber="9291"><span class="doxyHighlight">  OffloadInfoManager.actOnTargetRegionEntriesInfo(TargetRegionMetadataEmitter);</span></CodeLine>
<Link id="l09292" /><CodeLine lineNumber="9292"></CodeLine>
<Link id="l09293" /><CodeLine lineNumber="9293"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create function that emits metadata for each device global variable entry;</span></CodeLine>
<Link id="l09294" /><CodeLine lineNumber="9294"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&amp;DeviceGlobalVarMetadataEmitter =</span></CodeLine>
<Link id="l09295" /><CodeLine lineNumber="9295"><span class="doxyHighlight">      &#91;&amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, &amp;OrderedEntries, &amp;GetMDInt, &amp;GetMDString, MD&#93;(</span></CodeLine>
<Link id="l09296" /><CodeLine lineNumber="9296"><span class="doxyHighlight">          StringRef MangledName,</span></CodeLine>
<Link id="l09297" /><CodeLine lineNumber="9297"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> OffloadEntriesInfoManager::OffloadEntryInfoDeviceGlobalVar &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>) &#123;</span></CodeLine>
<Link id="l09298" /><CodeLine lineNumber="9298"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Generate metadata for global variables. Each entry of this metadata</span></CodeLine>
<Link id="l09299" /><CodeLine lineNumber="9299"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// contains:</span></CodeLine>
<Link id="l09300" /><CodeLine lineNumber="9300"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// - Entry 0 -&gt; Kind of this type of metadata (1).</span></CodeLine>
<Link id="l09301" /><CodeLine lineNumber="9301"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// - Entry 1 -&gt; Mangled name of the variable.</span></CodeLine>
<Link id="l09302" /><CodeLine lineNumber="9302"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// - Entry 2 -&gt; Declare target kind.</span></CodeLine>
<Link id="l09303" /><CodeLine lineNumber="9303"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// - Entry 3 -&gt; Order the entry was created.</span></CodeLine>
<Link id="l09304" /><CodeLine lineNumber="9304"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The first element of the metadata node is the kind.</span></CodeLine>
<Link id="l09305" /><CodeLine lineNumber="9305"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/directx/dxiltranslatemetadata-cpp/#a26b689be9525270658579553e0adfec1">Metadata</a> &#42;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;&#93; = &#123;GetMDInt(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.getKind()), GetMDString(MangledName),</span></CodeLine>
<Link id="l09306" /><CodeLine lineNumber="9306"><span class="doxyHighlight">                           GetMDInt(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.getFlags()), GetMDInt(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.getOrder())&#125;;</span></CodeLine>
<Link id="l09307" /><CodeLine lineNumber="9307"></CodeLine>
<Link id="l09308" /><CodeLine lineNumber="9308"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Save this entry in the right position of the ordered entries array.</span></CodeLine>
<Link id="l09309" /><CodeLine lineNumber="9309"><span class="doxyHighlight">        TargetRegionEntryInfo varInfo(MangledName, 0, 0, 0);</span></CodeLine>
<Link id="l09310" /><CodeLine lineNumber="9310"><span class="doxyHighlight">        OrderedEntries&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.getOrder()&#93; = std::make&#95;pair(&amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>, varInfo);</span></CodeLine>
<Link id="l09311" /><CodeLine lineNumber="9311"></CodeLine>
<Link id="l09312" /><CodeLine lineNumber="9312"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Add metadata to the named metadata node.</span></CodeLine>
<Link id="l09313" /><CodeLine lineNumber="9313"><span class="doxyHighlight">        MD-&gt;addOperand(<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>));</span></CodeLine>
<Link id="l09314" /><CodeLine lineNumber="9314"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l09315" /><CodeLine lineNumber="9315"></CodeLine>
<Link id="l09316" /><CodeLine lineNumber="9316"><span class="doxyHighlight">  OffloadInfoManager.actOnDeviceGlobalVarEntriesInfo(</span></CodeLine>
<Link id="l09317" /><CodeLine lineNumber="9317"><span class="doxyHighlight">      DeviceGlobalVarMetadataEmitter);</span></CodeLine>
<Link id="l09318" /><CodeLine lineNumber="9318"></CodeLine>
<Link id="l09319" /><CodeLine lineNumber="9319"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> : OrderedEntries) &#123;</span></CodeLine>
<Link id="l09320" /><CodeLine lineNumber="9320"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.first &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;All ordered entries must exist!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09321" /><CodeLine lineNumber="9321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CE =</span></CodeLine>
<Link id="l09322" /><CodeLine lineNumber="9322"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;OffloadEntriesInfoManager::OffloadEntryInfoTargetRegion&gt;</a>(</span></CodeLine>
<Link id="l09323" /><CodeLine lineNumber="9323"><span class="doxyHighlight">                <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.first)) &#123;</span></CodeLine>
<Link id="l09324" /><CodeLine lineNumber="9324"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getID() || !<a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getAddress()) &#123;</span></CodeLine>
<Link id="l09325" /><CodeLine lineNumber="9325"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Do not blame the entry if the parent funtion is not emitted.</span></CodeLine>
<Link id="l09326" /><CodeLine lineNumber="9326"><span class="doxyHighlight">        TargetRegionEntryInfo EntryInfo = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.second;</span></CodeLine>
<Link id="l09327" /><CodeLine lineNumber="9327"><span class="doxyHighlight">        StringRef FnName = EntryInfo.<a href="/docs/api/structs/llvm/targetregionentryinfo/#a89525afb0a8095beeb2dc7b083491942">ParentName</a>;</span></CodeLine>
<Link id="l09328" /><CodeLine lineNumber="9328"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getNamedValue(FnName))</span></CodeLine>
<Link id="l09329" /><CodeLine lineNumber="9329"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09330" /><CodeLine lineNumber="9330"><span class="doxyHighlight">        ErrorFn(EMIT&#95;MD&#95;TARGET&#95;REGION&#95;ERROR, EntryInfo);</span></CodeLine>
<Link id="l09331" /><CodeLine lineNumber="9331"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09332" /><CodeLine lineNumber="9332"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09333" /><CodeLine lineNumber="9333"><span class="doxyHighlight">      createOffloadEntry(<a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getID(), <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getAddress(),</span></CodeLine>
<Link id="l09334" /><CodeLine lineNumber="9334"><span class="doxyHighlight">                         </span><span class="doxyHighlightComment">/&#42;Size=&#42;/</span><span class="doxyHighlight">0, <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getFlags(),</span></CodeLine>
<Link id="l09335" /><CodeLine lineNumber="9335"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca8d13a9bcecfac72febceb1103afa048f">GlobalValue::WeakAnyLinkage</a>);</span></CodeLine>
<Link id="l09336" /><CodeLine lineNumber="9336"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CE = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast</a>&lt;</span></CodeLine>
<Link id="l09337" /><CodeLine lineNumber="9337"><span class="doxyHighlight">                   OffloadEntriesInfoManager::OffloadEntryInfoDeviceGlobalVar&gt;(</span></CodeLine>
<Link id="l09338" /><CodeLine lineNumber="9338"><span class="doxyHighlight">                   <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.first)) &#123;</span></CodeLine>
<Link id="l09339" /><CodeLine lineNumber="9339"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryKind</a> <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a> =</span></CodeLine>
<Link id="l09340" /><CodeLine lineNumber="9340"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryKind</a></span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l09341" /><CodeLine lineNumber="9341"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getFlags());</span></CodeLine>
<Link id="l09342" /><CodeLine lineNumber="9342"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a>) &#123;</span></CodeLine>
<Link id="l09343" /><CodeLine lineNumber="9343"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534a1b9b415348a31bfeaa94e778e0421ddf">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryEnter</a>:</span></CodeLine>
<Link id="l09344" /><CodeLine lineNumber="9344"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534acf96797e65a60ff4302eb2bbdbbd8880">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryTo</a>:</span></CodeLine>
<Link id="l09345" /><CodeLine lineNumber="9345"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Config.isTargetDevice() &amp;&amp; Config.hasRequiresUnifiedSharedMemory())</span></CodeLine>
<Link id="l09346" /><CodeLine lineNumber="9346"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09347" /><CodeLine lineNumber="9347"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getAddress()) &#123;</span></CodeLine>
<Link id="l09348" /><CodeLine lineNumber="9348"><span class="doxyHighlight">          ErrorFn(EMIT&#95;MD&#95;DECLARE&#95;TARGET&#95;ERROR, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.second);</span></CodeLine>
<Link id="l09349" /><CodeLine lineNumber="9349"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09350" /><CodeLine lineNumber="9350"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l09351" /><CodeLine lineNumber="9351"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The vaiable has no definition - no need to add the entry.</span></CodeLine>
<Link id="l09352" /><CodeLine lineNumber="9352"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getVarSize() == 0)</span></CodeLine>
<Link id="l09353" /><CodeLine lineNumber="9353"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09354" /><CodeLine lineNumber="9354"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09355" /><CodeLine lineNumber="9355"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534abe3a7916fb5f7a79d6aea6c0356e71a6">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryLink</a>:</span></CodeLine>
<Link id="l09356" /><CodeLine lineNumber="9356"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(((Config.isTargetDevice() &amp;&amp; !<a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getAddress()) ||</span></CodeLine>
<Link id="l09357" /><CodeLine lineNumber="9357"><span class="doxyHighlight">                (!Config.isTargetDevice() &amp;&amp; <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getAddress())) &amp;&amp;</span></CodeLine>
<Link id="l09358" /><CodeLine lineNumber="9358"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;Declaret target link address is set.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09359" /><CodeLine lineNumber="9359"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Config.isTargetDevice())</span></CodeLine>
<Link id="l09360" /><CodeLine lineNumber="9360"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09361" /><CodeLine lineNumber="9361"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getAddress()) &#123;</span></CodeLine>
<Link id="l09362" /><CodeLine lineNumber="9362"><span class="doxyHighlight">          ErrorFn(EMIT&#95;MD&#95;GLOBAL&#95;VAR&#95;LINK&#95;ERROR, TargetRegionEntryInfo());</span></CodeLine>
<Link id="l09363" /><CodeLine lineNumber="9363"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09364" /><CodeLine lineNumber="9364"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l09365" /><CodeLine lineNumber="9365"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09366" /><CodeLine lineNumber="9366"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l09367" /><CodeLine lineNumber="9367"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09368" /><CodeLine lineNumber="9368"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09369" /><CodeLine lineNumber="9369"></CodeLine>
<Link id="l09370" /><CodeLine lineNumber="9370"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Hidden or internal symbols on the device are not externally visible.</span></CodeLine>
<Link id="l09371" /><CodeLine lineNumber="9371"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We should not attempt to register them by creating an offloading</span></CodeLine>
<Link id="l09372" /><CodeLine lineNumber="9372"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// entry. Indirect variables are handled separately on the device.</span></CodeLine>
<Link id="l09373" /><CodeLine lineNumber="9373"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;GV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalValue&gt;</a>(<a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getAddress()))</span></CodeLine>
<Link id="l09374" /><CodeLine lineNumber="9374"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((GV-&gt;hasLocalLinkage() || GV-&gt;hasHiddenVisibility()) &amp;&amp;</span></CodeLine>
<Link id="l09375" /><CodeLine lineNumber="9375"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a> != <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534aba847264872ebbdaf660316167b89e15">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryIndirect</a>)</span></CodeLine>
<Link id="l09376" /><CodeLine lineNumber="9376"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09377" /><CodeLine lineNumber="9377"></CodeLine>
<Link id="l09378" /><CodeLine lineNumber="9378"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Indirect globals need to use a special name that doesn&#39;t match the name</span></CodeLine>
<Link id="l09379" /><CodeLine lineNumber="9379"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// of the associated host global.</span></CodeLine>
<Link id="l09380" /><CodeLine lineNumber="9380"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a> == <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534aba847264872ebbdaf660316167b89e15">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryIndirect</a>)</span></CodeLine>
<Link id="l09381" /><CodeLine lineNumber="9381"><span class="doxyHighlight">        createOffloadEntry(<a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getAddress(), <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getAddress(), <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getVarSize(),</span></CodeLine>
<Link id="l09382" /><CodeLine lineNumber="9382"><span class="doxyHighlight">                           <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a>, <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getLinkage(), <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getVarName());</span></CodeLine>
<Link id="l09383" /><CodeLine lineNumber="9383"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l09384" /><CodeLine lineNumber="9384"><span class="doxyHighlight">        createOffloadEntry(<a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getAddress(), <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getAddress(), <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getVarSize(),</span></CodeLine>
<Link id="l09385" /><CodeLine lineNumber="9385"><span class="doxyHighlight">                           <a href="/docs/api/namespaces/llvm/omp/#a16d7c5f77008a84ae20bf4a5c41e51f0a4ea7801f17a4e5485e8b050c052fb443">Flags</a>, <a href="/docs/api/namespaces/llvm/wineh/#a1c8d8103d6b914c2ade85873cb97f6d9a7a86131338bf955e0a56311f264aa6aa">CE</a>-&gt;getLinkage());</span></CodeLine>
<Link id="l09386" /><CodeLine lineNumber="9386"></CodeLine>
<Link id="l09387" /><CodeLine lineNumber="9387"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l09388" /><CodeLine lineNumber="9388"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unsupported entry kind.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09389" /><CodeLine lineNumber="9389"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09390" /><CodeLine lineNumber="9390"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09391" /><CodeLine lineNumber="9391"></CodeLine>
<Link id="l09392" /><CodeLine lineNumber="9392"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit requires directive globals to a special entry so the runtime can</span></CodeLine>
<Link id="l09393" /><CodeLine lineNumber="9393"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// register them when the device image is loaded.</span></CodeLine>
<Link id="l09394" /><CodeLine lineNumber="9394"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: This reduces the offloading entries to a 32-bit integer. Offloading</span></CodeLine>
<Link id="l09395" /><CodeLine lineNumber="9395"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       entries should be redesigned to better suit this use-case.</span></CodeLine>
<Link id="l09396" /><CodeLine lineNumber="9396"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Config.hasRequiresFlags() &amp;&amp; !Config.isTargetDevice())</span></CodeLine>
<Link id="l09397" /><CodeLine lineNumber="9397"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/offloading/#a4b79b6c874e2b55eb4dda2ae96867f84">offloading::emitOffloadingEntry</a>(</span></CodeLine>
<Link id="l09398" /><CodeLine lineNumber="9398"><span class="doxyHighlight">        M, <a href="/docs/api/namespaces/llvm/object/#a92b4561998310fbcfbeaeb7c449bad6aaf8060971587bf244fd04e657d00529ff">object::OffloadKind::OFK&#95;OpenMP</a>,</span></CodeLine>
<Link id="l09399" /><CodeLine lineNumber="9399"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext())),</span></CodeLine>
<Link id="l09400" /><CodeLine lineNumber="9400"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;Name=&#42;/</span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l09401" /><CodeLine lineNumber="9401"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;Size=&#42;/</span><span class="doxyHighlight">0, <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534ab16880c5ddd7886e422bf6dc1e670cca">OffloadEntriesInfoManager::OMPTargetGlobalRegisterRequires</a>,</span></CodeLine>
<Link id="l09402" /><CodeLine lineNumber="9402"><span class="doxyHighlight">        Config.getRequiresFlags(), </span><span class="doxyHighlightStringLiteral">&quot;omp&#95;offloading&#95;entries&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09403" /><CodeLine lineNumber="9403"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09404" /><CodeLine lineNumber="9404"></CodeLine>
<Link id="l09405" /><CodeLine lineNumber="9405" lineLink="/docs/api/structs/llvm/targetregionentryinfo/#a0a267f191642077971aa8eeba25ea6f5"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetregionentryinfo/#a0a267f191642077971aa8eeba25ea6f5">TargetRegionEntryInfo::getTargetRegionEntryFnName</a>(</span></CodeLine>
<Link id="l09406" /><CodeLine lineNumber="9406"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;char&gt;</a> &amp;Name, <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/structs/llvm/targetregionentryinfo/#a89525afb0a8095beeb2dc7b083491942">ParentName</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetregionentryinfo/#a50a8eeba86c83f02b7e129b7880ec654">DeviceID</a>,</span></CodeLine>
<Link id="l09407" /><CodeLine lineNumber="9407"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetregionentryinfo/#a80293a526ecd17ee44ce5b982dff1ca1">FileID</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetregionentryinfo/#a70f195e58ff3b0960a5c0884449d092a">Line</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetregionentryinfo/#a8cc8999b43ab73c1f7f8618f7735f3cd">Count</a>) &#123;</span></CodeLine>
<Link id="l09408" /><CodeLine lineNumber="9408"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/raw-svector-ostream">raw&#95;svector&#95;ostream</a> OS(Name);</span></CodeLine>
<Link id="l09409" /><CodeLine lineNumber="9409"><span class="doxyHighlight">  OS &lt;&lt; <a href="/docs/api/structs/llvm/targetregionentryinfo/#a3e78748236396089e6a27766e44407f9">KernelNamePrefix</a> &lt;&lt; <a href="/docs/api/namespaces/llvm/#a939bc2108d47080767f0c06ba56caec7">llvm::format</a>(</span><span class="doxyHighlightStringLiteral">&quot;%x&quot;</span><span class="doxyHighlight">, <a href="/docs/api/structs/llvm/targetregionentryinfo/#a50a8eeba86c83f02b7e129b7880ec654">DeviceID</a>)</span></CodeLine>
<Link id="l09410" /><CodeLine lineNumber="9410"><span class="doxyHighlight">     &lt;&lt; <a href="/docs/api/namespaces/llvm/#a939bc2108d47080767f0c06ba56caec7">llvm::format</a>(</span><span class="doxyHighlightStringLiteral">&quot;&#95;%x&#95;&quot;</span><span class="doxyHighlight">, <a href="/docs/api/structs/llvm/targetregionentryinfo/#a80293a526ecd17ee44ce5b982dff1ca1">FileID</a>) &lt;&lt; <a href="/docs/api/structs/llvm/targetregionentryinfo/#a89525afb0a8095beeb2dc7b083491942">ParentName</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#95;l&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/structs/llvm/targetregionentryinfo/#a70f195e58ff3b0960a5c0884449d092a">Line</a>;</span></CodeLine>
<Link id="l09411" /><CodeLine lineNumber="9411"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/targetregionentryinfo/#a8cc8999b43ab73c1f7f8618f7735f3cd">Count</a>)</span></CodeLine>
<Link id="l09412" /><CodeLine lineNumber="9412"><span class="doxyHighlight">    OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#95;&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/structs/llvm/targetregionentryinfo/#a8cc8999b43ab73c1f7f8618f7735f3cd">Count</a>;</span></CodeLine>
<Link id="l09413" /><CodeLine lineNumber="9413"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09414" /><CodeLine lineNumber="9414"></CodeLine>
<Link id="l09415" /><CodeLine lineNumber="9415" lineLink="/docs/api/classes/llvm/offloadentriesinfomanager/#a6827980ed8b61f42e680949ff4511b03"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a6827980ed8b61f42e680949ff4511b03">OffloadEntriesInfoManager::getTargetRegionEntryFnName</a>(</span></CodeLine>
<Link id="l09416" /><CodeLine lineNumber="9416"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;char&gt;</a> &amp;Name, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> &amp;EntryInfo) &#123;</span></CodeLine>
<Link id="l09417" /><CodeLine lineNumber="9417"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NewCount = getTargetRegionEntryInfoCount(EntryInfo);</span></CodeLine>
<Link id="l09418" /><CodeLine lineNumber="9418"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/targetregionentryinfo/#a0a267f191642077971aa8eeba25ea6f5">TargetRegionEntryInfo::getTargetRegionEntryFnName</a>(</span></CodeLine>
<Link id="l09419" /><CodeLine lineNumber="9419"><span class="doxyHighlight">      Name, EntryInfo.<a href="/docs/api/structs/llvm/targetregionentryinfo/#a89525afb0a8095beeb2dc7b083491942">ParentName</a>, EntryInfo.<a href="/docs/api/structs/llvm/targetregionentryinfo/#a50a8eeba86c83f02b7e129b7880ec654">DeviceID</a>, EntryInfo.<a href="/docs/api/structs/llvm/targetregionentryinfo/#a80293a526ecd17ee44ce5b982dff1ca1">FileID</a>,</span></CodeLine>
<Link id="l09420" /><CodeLine lineNumber="9420"><span class="doxyHighlight">      EntryInfo.<a href="/docs/api/structs/llvm/targetregionentryinfo/#a70f195e58ff3b0960a5c0884449d092a">Line</a>, NewCount);</span></CodeLine>
<Link id="l09421" /><CodeLine lineNumber="9421"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09422" /><CodeLine lineNumber="9422"></CodeLine>
<Link id="l09423" /><CodeLine lineNumber="9423"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a></span></CodeLine>
<Link id="l09424" /><CodeLine lineNumber="9424"><span class="doxyHighlight">OpenMPIRBuilder::getTargetEntryUniqueInfo(FileIdentifierInfoCallbackTy CallBack,</span></CodeLine>
<Link id="l09425" /><CodeLine lineNumber="9425"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/stringref">StringRef</a> ParentName) &#123;</span></CodeLine>
<Link id="l09426" /><CodeLine lineNumber="9426"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sys/fs/uniqueid">sys::fs::UniqueID</a> <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>;</span></CodeLine>
<Link id="l09427" /><CodeLine lineNumber="9427"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FileIDInfo = CallBack();</span></CodeLine>
<Link id="l09428" /><CodeLine lineNumber="9428"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EC = <a href="/docs/api/namespaces/llvm/sys/fs/#a7e0dd3b9d03107bf25def8333283d822">sys::fs::getUniqueID</a>(std::get&lt;0&gt;(FileIDInfo), <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>)) &#123;</span></CodeLine>
<Link id="l09429" /><CodeLine lineNumber="9429"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>((</span><span class="doxyHighlightStringLiteral">&quot;Unable to get unique ID for file, during &quot;</span></CodeLine>
<Link id="l09430" /><CodeLine lineNumber="9430"><span class="doxyHighlight">                        </span><span class="doxyHighlightStringLiteral">&quot;getTargetEntryUniqueInfo, error message: &quot;</span><span class="doxyHighlight"> +</span></CodeLine>
<Link id="l09431" /><CodeLine lineNumber="9431"><span class="doxyHighlight">                        EC.message())</span></CodeLine>
<Link id="l09432" /><CodeLine lineNumber="9432"><span class="doxyHighlight">                           .c&#95;str());</span></CodeLine>
<Link id="l09433" /><CodeLine lineNumber="9433"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09434" /><CodeLine lineNumber="9434"></CodeLine>
<Link id="l09435" /><CodeLine lineNumber="9435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a>(ParentName, <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getDevice(), <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getFile(),</span></CodeLine>
<Link id="l09436" /><CodeLine lineNumber="9436"><span class="doxyHighlight">                               std::get&lt;1&gt;(FileIDInfo));</span></CodeLine>
<Link id="l09437" /><CodeLine lineNumber="9437"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09438" /><CodeLine lineNumber="9438"></CodeLine>
<Link id="l09439" /><CodeLine lineNumber="9439" lineLink="/docs/api/classes/llvm/openmpirbuilder/#ac86b562509588cbc00fbdc441c615bd3"><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#ac86b562509588cbc00fbdc441c615bd3">OpenMPIRBuilder::getFlagMemberOffset</a>() &#123;</span></CodeLine>
<Link id="l09440" /><CodeLine lineNumber="9440"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = 0;</span></CodeLine>
<Link id="l09441" /><CodeLine lineNumber="9441"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (uint64&#95;t Remain =</span></CodeLine>
<Link id="l09442" /><CodeLine lineNumber="9442"><span class="doxyHighlight">           </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;omp::OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l09443" /><CodeLine lineNumber="9443"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/omp/#a02d7a52c47f2d71a111aef9d4fb70ecbaa450a4e59275b4081714a7a28f217e6c">omp::OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;MEMBER&#95;OF</a>);</span></CodeLine>
<Link id="l09444" /><CodeLine lineNumber="9444"><span class="doxyHighlight">       !(Remain &amp; 1); Remain = Remain &gt;&gt; 1)</span></CodeLine>
<Link id="l09445" /><CodeLine lineNumber="9445"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>++;</span></CodeLine>
<Link id="l09446" /><CodeLine lineNumber="9446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l09447" /><CodeLine lineNumber="9447"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09448" /><CodeLine lineNumber="9448"></CodeLine>
<Link id="l09449" /><CodeLine lineNumber="9449"><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/omp/#a02d7a52c47f2d71a111aef9d4fb70ecb">omp::OpenMPOffloadMappingFlags</a></span></CodeLine>
<Link id="l09450" /><CodeLine lineNumber="9450" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a4f82182a8cc23f854efdbd453f685086"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/openmpirbuilder/#a4f82182a8cc23f854efdbd453f685086">OpenMPIRBuilder::getMemberOfFlag</a>(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Position) &#123;</span></CodeLine>
<Link id="l09451" /><CodeLine lineNumber="9451"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Rotate by getFlagMemberOffset() bits.</span></CodeLine>
<Link id="l09452" /><CodeLine lineNumber="9452"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/omp/#a02d7a52c47f2d71a111aef9d4fb70ecb">omp::OpenMPOffloadMappingFlags</a></span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(((uint64&#95;t)Position + 1)</span></CodeLine>
<Link id="l09453" /><CodeLine lineNumber="9453"><span class="doxyHighlight">                                                     &lt;&lt; <a href="/docs/api/classes/llvm/openmpirbuilder/#ac86b562509588cbc00fbdc441c615bd3">getFlagMemberOffset</a>());</span></CodeLine>
<Link id="l09454" /><CodeLine lineNumber="9454"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09455" /><CodeLine lineNumber="9455"></CodeLine>
<Link id="l09456" /><CodeLine lineNumber="9456" lineLink="/docs/api/classes/llvm/openmpirbuilder/#abeea5a3df7d0266470cd04bb721db70e"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#abeea5a3df7d0266470cd04bb721db70e">OpenMPIRBuilder::setCorrectMemberOfFlag</a>(</span></CodeLine>
<Link id="l09457" /><CodeLine lineNumber="9457"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#a02d7a52c47f2d71a111aef9d4fb70ecb">omp::OpenMPOffloadMappingFlags</a> &amp;Flags,</span></CodeLine>
<Link id="l09458" /><CodeLine lineNumber="9458"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/omp/#a02d7a52c47f2d71a111aef9d4fb70ecb">omp::OpenMPOffloadMappingFlags</a> MemberOfFlag) &#123;</span></CodeLine>
<Link id="l09459" /><CodeLine lineNumber="9459"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the entry is PTR&#95;AND&#95;OBJ but has not been marked with the special</span></CodeLine>
<Link id="l09460" /><CodeLine lineNumber="9460"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// placeholder value 65535 in the MEMBER&#95;OF field, then it should not be</span></CodeLine>
<Link id="l09461" /><CodeLine lineNumber="9461"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// marked as MEMBER&#95;OF.</span></CodeLine>
<Link id="l09462" /><CodeLine lineNumber="9462"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;omp::OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l09463" /><CodeLine lineNumber="9463"><span class="doxyHighlight">          Flags &amp; <a href="/docs/api/namespaces/llvm/omp/#a02d7a52c47f2d71a111aef9d4fb70ecba67bb5754d8a930a0abad5e820064be2d">omp::OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;PTR&#95;AND&#95;OBJ</a>) &amp;&amp;</span></CodeLine>
<Link id="l09464" /><CodeLine lineNumber="9464"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">std::underlying&#95;type&#95;t&lt;omp::OpenMPOffloadMappingFlags&gt;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l09465" /><CodeLine lineNumber="9465"><span class="doxyHighlight">          (Flags &amp; <a href="/docs/api/namespaces/llvm/omp/#a02d7a52c47f2d71a111aef9d4fb70ecbaa450a4e59275b4081714a7a28f217e6c">omp::OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;MEMBER&#95;OF</a>) !=</span></CodeLine>
<Link id="l09466" /><CodeLine lineNumber="9466"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/omp/#a02d7a52c47f2d71a111aef9d4fb70ecbaa450a4e59275b4081714a7a28f217e6c">omp::OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;MEMBER&#95;OF</a>))</span></CodeLine>
<Link id="l09467" /><CodeLine lineNumber="9467"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09468" /><CodeLine lineNumber="9468"></CodeLine>
<Link id="l09469" /><CodeLine lineNumber="9469"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reset the placeholder value to prepare the flag for the assignment of the</span></CodeLine>
<Link id="l09470" /><CodeLine lineNumber="9470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// proper MEMBER&#95;OF value.</span></CodeLine>
<Link id="l09471" /><CodeLine lineNumber="9471"><span class="doxyHighlight">  Flags &amp;= <a href="/docs/api/namespaces/llvm/omp">~omp</a>::OpenMPOffloadMappingFlags::OMP&#95;MAP&#95;MEMBER&#95;OF;</span></CodeLine>
<Link id="l09472" /><CodeLine lineNumber="9472"><span class="doxyHighlight">  Flags |= MemberOfFlag;</span></CodeLine>
<Link id="l09473" /><CodeLine lineNumber="9473"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09474" /><CodeLine lineNumber="9474"></CodeLine>
<Link id="l09475" /><CodeLine lineNumber="9475" lineLink="/docs/api/classes/llvm/openmpirbuilder/#afdc1b8675a946ce055c64607ba75af3a"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/classes/llvm/openmpirbuilder/#afdc1b8675a946ce055c64607ba75af3a">OpenMPIRBuilder::getAddrOfDeclareTargetVar</a>(</span></CodeLine>
<Link id="l09476" /><CodeLine lineNumber="9476"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryKind</a> CaptureClause,</span></CodeLine>
<Link id="l09477" /><CodeLine lineNumber="9477"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a2dc9d099b77ee3b8db3b00ad9273823d">OffloadEntriesInfoManager::OMPTargetDeviceClauseKind</a> DeviceClause,</span></CodeLine>
<Link id="l09478" /><CodeLine lineNumber="9478"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsDeclaration, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsExternallyVisible,</span></CodeLine>
<Link id="l09479" /><CodeLine lineNumber="9479"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> EntryInfo, <a href="/docs/api/classes/llvm/stringref">StringRef</a> MangledName,</span></CodeLine>
<Link id="l09480" /><CodeLine lineNumber="9480"><span class="doxyHighlight">    std::vector&lt;GlobalVariable &#42;&gt; &amp;GeneratedRefs, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OpenMPSIMD,</span></CodeLine>
<Link id="l09481" /><CodeLine lineNumber="9481"><span class="doxyHighlight">    std::vector&lt;Triple&gt; TargetTriple, <a href="/docs/api/classes/llvm/type">Type</a> &#42;LlvmPtrTy,</span></CodeLine>
<Link id="l09482" /><CodeLine lineNumber="9482"><span class="doxyHighlight">    std::function&lt;<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;()&gt; GlobalInitializer,</span></CodeLine>
<Link id="l09483" /><CodeLine lineNumber="9483"><span class="doxyHighlight">    std::function&lt;<a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57c">GlobalValue::LinkageTypes</a>()&gt; VariableLinkage) &#123;</span></CodeLine>
<Link id="l09484" /><CodeLine lineNumber="9484"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: convert this to utilise the IRBuilder Config rather than</span></CodeLine>
<Link id="l09485" /><CodeLine lineNumber="9485"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a passed down argument.</span></CodeLine>
<Link id="l09486" /><CodeLine lineNumber="9486"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpenMPSIMD)</span></CodeLine>
<Link id="l09487" /><CodeLine lineNumber="9487"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09488" /><CodeLine lineNumber="9488"></CodeLine>
<Link id="l09489" /><CodeLine lineNumber="9489"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CaptureClause == <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534abe3a7916fb5f7a79d6aea6c0356e71a6">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryLink</a> ||</span></CodeLine>
<Link id="l09490" /><CodeLine lineNumber="9490"><span class="doxyHighlight">      ((CaptureClause == <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534acf96797e65a60ff4302eb2bbdbbd8880">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryTo</a> ||</span></CodeLine>
<Link id="l09491" /><CodeLine lineNumber="9491"><span class="doxyHighlight">        CaptureClause ==</span></CodeLine>
<Link id="l09492" /><CodeLine lineNumber="9492"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534a1b9b415348a31bfeaa94e778e0421ddf">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryEnter</a>) &amp;&amp;</span></CodeLine>
<Link id="l09493" /><CodeLine lineNumber="9493"><span class="doxyHighlight">       Config.hasRequiresUnifiedSharedMemory())) &#123;</span></CodeLine>
<Link id="l09494" /><CodeLine lineNumber="9494"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallstring">SmallString&lt;64&gt;</a> PtrName;</span></CodeLine>
<Link id="l09495" /><CodeLine lineNumber="9495"><span class="doxyHighlight">    &#123;</span></CodeLine>
<Link id="l09496" /><CodeLine lineNumber="9496"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/raw-svector-ostream">raw&#95;svector&#95;ostream</a> OS(PtrName);</span></CodeLine>
<Link id="l09497" /><CodeLine lineNumber="9497"><span class="doxyHighlight">      OS &lt;&lt; MangledName;</span></CodeLine>
<Link id="l09498" /><CodeLine lineNumber="9498"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsExternallyVisible)</span></CodeLine>
<Link id="l09499" /><CodeLine lineNumber="9499"><span class="doxyHighlight">        OS &lt;&lt; <a href="/docs/api/namespaces/llvm/#a939bc2108d47080767f0c06ba56caec7">format</a>(</span><span class="doxyHighlightStringLiteral">&quot;&#95;%x&quot;</span><span class="doxyHighlight">, EntryInfo.<a href="/docs/api/structs/llvm/targetregionentryinfo/#a80293a526ecd17ee44ce5b982dff1ca1">FileID</a>);</span></CodeLine>
<Link id="l09500" /><CodeLine lineNumber="9500"><span class="doxyHighlight">      OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#95;decl&#95;tgt&#95;ref&#95;ptr&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09501" /><CodeLine lineNumber="9501"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09502" /><CodeLine lineNumber="9502"></CodeLine>
<Link id="l09503" /><CodeLine lineNumber="9503"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = M.getNamedValue(PtrName);</span></CodeLine>
<Link id="l09504" /><CodeLine lineNumber="9504"></CodeLine>
<Link id="l09505" /><CodeLine lineNumber="9505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &#123;</span></CodeLine>
<Link id="l09506" /><CodeLine lineNumber="9506"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> = M.getNamedValue(MangledName);</span></CodeLine>
<Link id="l09507" /><CodeLine lineNumber="9507"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/classes/llvm/openmpirbuilder/#aa5ef00e5a7487cc6c5bfed0f301fa1cc">getOrCreateInternalVariable</a>(LlvmPtrTy, PtrName);</span></CodeLine>
<Link id="l09508" /><CodeLine lineNumber="9508"></CodeLine>
<Link id="l09509" /><CodeLine lineNumber="9509"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/structs/llvm/omp/gv">GV</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GlobalVariable&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l09510" /><CodeLine lineNumber="9510"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/omp/gv">GV</a>-&gt;setLinkage(<a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca8d13a9bcecfac72febceb1103afa048f">GlobalValue::WeakAnyLinkage</a>);</span></CodeLine>
<Link id="l09511" /><CodeLine lineNumber="9511"></CodeLine>
<Link id="l09512" /><CodeLine lineNumber="9512"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Config.isTargetDevice()) &#123;</span></CodeLine>
<Link id="l09513" /><CodeLine lineNumber="9513"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GlobalInitializer)</span></CodeLine>
<Link id="l09514" /><CodeLine lineNumber="9514"><span class="doxyHighlight">          <a href="/docs/api/structs/llvm/omp/gv">GV</a>-&gt;setInitializer(GlobalInitializer());</span></CodeLine>
<Link id="l09515" /><CodeLine lineNumber="9515"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l09516" /><CodeLine lineNumber="9516"><span class="doxyHighlight">          <a href="/docs/api/structs/llvm/omp/gv">GV</a>-&gt;setInitializer(<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a>);</span></CodeLine>
<Link id="l09517" /><CodeLine lineNumber="9517"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09518" /><CodeLine lineNumber="9518"></CodeLine>
<Link id="l09519" /><CodeLine lineNumber="9519"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/openmpirbuilder/#ae327be8503a76bd4dccfff4713a38553">registerTargetGlobalVariable</a>(</span></CodeLine>
<Link id="l09520" /><CodeLine lineNumber="9520"><span class="doxyHighlight">          CaptureClause, DeviceClause, IsDeclaration, IsExternallyVisible,</span></CodeLine>
<Link id="l09521" /><CodeLine lineNumber="9521"><span class="doxyHighlight">          EntryInfo, MangledName, GeneratedRefs, OpenMPSIMD, TargetTriple,</span></CodeLine>
<Link id="l09522" /><CodeLine lineNumber="9522"><span class="doxyHighlight">          GlobalInitializer, VariableLinkage, LlvmPtrTy, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>));</span></CodeLine>
<Link id="l09523" /><CodeLine lineNumber="9523"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09524" /><CodeLine lineNumber="9524"></CodeLine>
<Link id="l09525" /><CodeLine lineNumber="9525"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l09526" /><CodeLine lineNumber="9526"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09527" /><CodeLine lineNumber="9527"></CodeLine>
<Link id="l09528" /><CodeLine lineNumber="9528"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09529" /><CodeLine lineNumber="9529"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09530" /><CodeLine lineNumber="9530"></CodeLine>
<Link id="l09531" /><CodeLine lineNumber="9531" lineLink="/docs/api/classes/llvm/openmpirbuilder/#ae327be8503a76bd4dccfff4713a38553"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#ae327be8503a76bd4dccfff4713a38553">OpenMPIRBuilder::registerTargetGlobalVariable</a>(</span></CodeLine>
<Link id="l09532" /><CodeLine lineNumber="9532"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryKind</a> CaptureClause,</span></CodeLine>
<Link id="l09533" /><CodeLine lineNumber="9533"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a2dc9d099b77ee3b8db3b00ad9273823d">OffloadEntriesInfoManager::OMPTargetDeviceClauseKind</a> DeviceClause,</span></CodeLine>
<Link id="l09534" /><CodeLine lineNumber="9534"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsDeclaration, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsExternallyVisible,</span></CodeLine>
<Link id="l09535" /><CodeLine lineNumber="9535"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> EntryInfo, <a href="/docs/api/classes/llvm/stringref">StringRef</a> MangledName,</span></CodeLine>
<Link id="l09536" /><CodeLine lineNumber="9536"><span class="doxyHighlight">    std::vector&lt;GlobalVariable &#42;&gt; &amp;GeneratedRefs, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OpenMPSIMD,</span></CodeLine>
<Link id="l09537" /><CodeLine lineNumber="9537"><span class="doxyHighlight">    std::vector&lt;Triple&gt; TargetTriple,</span></CodeLine>
<Link id="l09538" /><CodeLine lineNumber="9538"><span class="doxyHighlight">    std::function&lt;<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;()&gt; GlobalInitializer,</span></CodeLine>
<Link id="l09539" /><CodeLine lineNumber="9539"><span class="doxyHighlight">    std::function&lt;<a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57c">GlobalValue::LinkageTypes</a>()&gt; VariableLinkage, <a href="/docs/api/classes/llvm/type">Type</a> &#42;LlvmPtrTy,</span></CodeLine>
<Link id="l09540" /><CodeLine lineNumber="9540"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Addr) &#123;</span></CodeLine>
<Link id="l09541" /><CodeLine lineNumber="9541"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DeviceClause != <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a2dc9d099b77ee3b8db3b00ad9273823da168f6569c38da7979aa5e36d0a21b871">OffloadEntriesInfoManager::OMPTargetDeviceClauseAny</a> ||</span></CodeLine>
<Link id="l09542" /><CodeLine lineNumber="9542"><span class="doxyHighlight">      (TargetTriple.empty() &amp;&amp; !Config.isTargetDevice()))</span></CodeLine>
<Link id="l09543" /><CodeLine lineNumber="9543"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09544" /><CodeLine lineNumber="9544"></CodeLine>
<Link id="l09545" /><CodeLine lineNumber="9545"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryKind</a> Flags;</span></CodeLine>
<Link id="l09546" /><CodeLine lineNumber="9546"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> VarName;</span></CodeLine>
<Link id="l09547" /><CodeLine lineNumber="9547"><span class="doxyHighlight">  int64&#95;t VarSize;</span></CodeLine>
<Link id="l09548" /><CodeLine lineNumber="9548"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57c">GlobalValue::LinkageTypes</a> Linkage;</span></CodeLine>
<Link id="l09549" /><CodeLine lineNumber="9549"></CodeLine>
<Link id="l09550" /><CodeLine lineNumber="9550"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((CaptureClause == <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534acf96797e65a60ff4302eb2bbdbbd8880">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryTo</a> ||</span></CodeLine>
<Link id="l09551" /><CodeLine lineNumber="9551"><span class="doxyHighlight">       CaptureClause ==</span></CodeLine>
<Link id="l09552" /><CodeLine lineNumber="9552"><span class="doxyHighlight">           <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534a1b9b415348a31bfeaa94e778e0421ddf">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryEnter</a>) &amp;&amp;</span></CodeLine>
<Link id="l09553" /><CodeLine lineNumber="9553"><span class="doxyHighlight">      !Config.hasRequiresUnifiedSharedMemory()) &#123;</span></CodeLine>
<Link id="l09554" /><CodeLine lineNumber="9554"><span class="doxyHighlight">    Flags = <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534acf96797e65a60ff4302eb2bbdbbd8880">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryTo</a>;</span></CodeLine>
<Link id="l09555" /><CodeLine lineNumber="9555"><span class="doxyHighlight">    VarName = MangledName;</span></CodeLine>
<Link id="l09556" /><CodeLine lineNumber="9556"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;LlvmVal = M.getNamedValue(VarName);</span></CodeLine>
<Link id="l09557" /><CodeLine lineNumber="9557"></CodeLine>
<Link id="l09558" /><CodeLine lineNumber="9558"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsDeclaration)</span></CodeLine>
<Link id="l09559" /><CodeLine lineNumber="9559"><span class="doxyHighlight">      VarSize = <a href="/docs/api/namespaces/llvm/#a9dda4472ee0b7ea92ab49eedf6e13d50">divideCeil</a>(</span></CodeLine>
<Link id="l09560" /><CodeLine lineNumber="9560"><span class="doxyHighlight">          M.getDataLayout().getTypeSizeInBits(LlvmVal-&gt;<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>()), 8);</span></CodeLine>
<Link id="l09561" /><CodeLine lineNumber="9561"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l09562" /><CodeLine lineNumber="9562"><span class="doxyHighlight">      VarSize = 0;</span></CodeLine>
<Link id="l09563" /><CodeLine lineNumber="9563"><span class="doxyHighlight">    Linkage = (VariableLinkage) ? VariableLinkage() : LlvmVal-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a3547d58a060ee2e4a29cbea85bef91af">getLinkage</a>();</span></CodeLine>
<Link id="l09564" /><CodeLine lineNumber="9564"></CodeLine>
<Link id="l09565" /><CodeLine lineNumber="9565"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This is a workaround carried over from Clang which prevents undesired</span></CodeLine>
<Link id="l09566" /><CodeLine lineNumber="9566"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// optimisation of internal variables.</span></CodeLine>
<Link id="l09567" /><CodeLine lineNumber="9567"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Config.isTargetDevice() &amp;&amp;</span></CodeLine>
<Link id="l09568" /><CodeLine lineNumber="9568"><span class="doxyHighlight">        (!IsExternallyVisible || Linkage == <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57caf2b592edf18170e7aff4e8f3bae3360c">GlobalValue::LinkOnceODRLinkage</a>)) &#123;</span></CodeLine>
<Link id="l09569" /><CodeLine lineNumber="9569"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Do not create a &quot;ref-variable&quot; if the original is not also available</span></CodeLine>
<Link id="l09570" /><CodeLine lineNumber="9570"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// on the host.</span></CodeLine>
<Link id="l09571" /><CodeLine lineNumber="9571"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OffloadInfoManager.hasDeviceGlobalVarEntryInfo(VarName))</span></CodeLine>
<Link id="l09572" /><CodeLine lineNumber="9572"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09573" /><CodeLine lineNumber="9573"></CodeLine>
<Link id="l09574" /><CodeLine lineNumber="9574"><span class="doxyHighlight">      std::string RefName = <a href="/docs/api/classes/llvm/openmpirbuilder/#a488c861f8a68e5f78ceca8b57acd8be5">createPlatformSpecificName</a>(&#123;VarName, </span><span class="doxyHighlightStringLiteral">&quot;ref&quot;</span><span class="doxyHighlight">&#125;);</span></CodeLine>
<Link id="l09575" /><CodeLine lineNumber="9575"></CodeLine>
<Link id="l09576" /><CodeLine lineNumber="9576"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!M.getNamedValue(RefName)) &#123;</span></CodeLine>
<Link id="l09577" /><CodeLine lineNumber="9577"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;AddrRef =</span></CodeLine>
<Link id="l09578" /><CodeLine lineNumber="9578"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/openmpirbuilder/#aa5ef00e5a7487cc6c5bfed0f301fa1cc">getOrCreateInternalVariable</a>(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), RefName);</span></CodeLine>
<Link id="l09579" /><CodeLine lineNumber="9579"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;GvAddrRef = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GlobalVariable&gt;</a>(AddrRef);</span></CodeLine>
<Link id="l09580" /><CodeLine lineNumber="9580"><span class="doxyHighlight">        GvAddrRef-&gt;setConstant(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09581" /><CodeLine lineNumber="9581"><span class="doxyHighlight">        GvAddrRef-&gt;setLinkage(<a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>);</span></CodeLine>
<Link id="l09582" /><CodeLine lineNumber="9582"><span class="doxyHighlight">        GvAddrRef-&gt;setInitializer(Addr);</span></CodeLine>
<Link id="l09583" /><CodeLine lineNumber="9583"><span class="doxyHighlight">        GeneratedRefs.push&#95;back(GvAddrRef);</span></CodeLine>
<Link id="l09584" /><CodeLine lineNumber="9584"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09585" /><CodeLine lineNumber="9585"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09586" /><CodeLine lineNumber="9586"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l09587" /><CodeLine lineNumber="9587"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CaptureClause == <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534abe3a7916fb5f7a79d6aea6c0356e71a6">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryLink</a>)</span></CodeLine>
<Link id="l09588" /><CodeLine lineNumber="9588"><span class="doxyHighlight">      Flags = <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534abe3a7916fb5f7a79d6aea6c0356e71a6">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryLink</a>;</span></CodeLine>
<Link id="l09589" /><CodeLine lineNumber="9589"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l09590" /><CodeLine lineNumber="9590"><span class="doxyHighlight">      Flags = <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534acf96797e65a60ff4302eb2bbdbbd8880">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryTo</a>;</span></CodeLine>
<Link id="l09591" /><CodeLine lineNumber="9591"></CodeLine>
<Link id="l09592" /><CodeLine lineNumber="9592"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Config.isTargetDevice()) &#123;</span></CodeLine>
<Link id="l09593" /><CodeLine lineNumber="9593"><span class="doxyHighlight">      VarName = (Addr) ? Addr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() : </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09594" /><CodeLine lineNumber="9594"><span class="doxyHighlight">      Addr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09595" /><CodeLine lineNumber="9595"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l09596" /><CodeLine lineNumber="9596"><span class="doxyHighlight">      Addr = <a href="/docs/api/classes/llvm/openmpirbuilder/#afdc1b8675a946ce055c64607ba75af3a">getAddrOfDeclareTargetVar</a>(</span></CodeLine>
<Link id="l09597" /><CodeLine lineNumber="9597"><span class="doxyHighlight">          CaptureClause, DeviceClause, IsDeclaration, IsExternallyVisible,</span></CodeLine>
<Link id="l09598" /><CodeLine lineNumber="9598"><span class="doxyHighlight">          EntryInfo, MangledName, GeneratedRefs, OpenMPSIMD, TargetTriple,</span></CodeLine>
<Link id="l09599" /><CodeLine lineNumber="9599"><span class="doxyHighlight">          LlvmPtrTy, GlobalInitializer, VariableLinkage);</span></CodeLine>
<Link id="l09600" /><CodeLine lineNumber="9600"><span class="doxyHighlight">      VarName = (Addr) ? Addr-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() : </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09601" /><CodeLine lineNumber="9601"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09602" /><CodeLine lineNumber="9602"><span class="doxyHighlight">    VarSize = M.getDataLayout().getPointerSize();</span></CodeLine>
<Link id="l09603" /><CodeLine lineNumber="9603"><span class="doxyHighlight">    Linkage = <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca8d13a9bcecfac72febceb1103afa048f">GlobalValue::WeakAnyLinkage</a>;</span></CodeLine>
<Link id="l09604" /><CodeLine lineNumber="9604"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09605" /><CodeLine lineNumber="9605"></CodeLine>
<Link id="l09606" /><CodeLine lineNumber="9606"><span class="doxyHighlight">  OffloadInfoManager.registerDeviceGlobalVarEntryInfo(VarName, Addr, VarSize,</span></CodeLine>
<Link id="l09607" /><CodeLine lineNumber="9607"><span class="doxyHighlight">                                                      Flags, Linkage);</span></CodeLine>
<Link id="l09608" /><CodeLine lineNumber="9608"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09609" /><CodeLine lineNumber="9609"></CodeLine>
<Link id="l09610" /><CodeLine lineNumber="9610"><span class="doxyHighlightComment">/// Loads all the offload entries information from the host IR</span></CodeLine>
<Link id="l09611" /><CodeLine lineNumber="9611"><span class="doxyHighlightComment">/// metadata.</span></CodeLine>
<Link id="l09612" /><CodeLine lineNumber="9612" lineLink="/docs/api/classes/llvm/openmpirbuilder/#a2242b144e54fa6203dae5c5b27fff17c"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#a2242b144e54fa6203dae5c5b27fff17c">OpenMPIRBuilder::loadOffloadInfoMetadata</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</span></CodeLine>
<Link id="l09613" /><CodeLine lineNumber="9613"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are in target mode, load the metadata from the host IR. This code has</span></CodeLine>
<Link id="l09614" /><CodeLine lineNumber="9614"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to match the metadata creation in createOffloadEntriesAndInfoMetadata().</span></CodeLine>
<Link id="l09615" /><CodeLine lineNumber="9615"></CodeLine>
<Link id="l09616" /><CodeLine lineNumber="9616"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/namedmdnode">NamedMDNode</a> &#42;MD = M.getNamedMetadata(<a href="/docs/api/classes/llvm/openmpirbuilder/#aefadc356da16598ff8c210dafbf4a2b7">ompOffloadInfoName</a>);</span></CodeLine>
<Link id="l09617" /><CodeLine lineNumber="9617"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MD)</span></CodeLine>
<Link id="l09618" /><CodeLine lineNumber="9618"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09619" /><CodeLine lineNumber="9619"></CodeLine>
<Link id="l09620" /><CodeLine lineNumber="9620"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;MN : MD-&gt;<a href="/docs/api/classes/llvm/namedmdnode/#adc55e223d70c06a924fd5cb248052d9d">operands</a>()) &#123;</span></CodeLine>
<Link id="l09621" /><CodeLine lineNumber="9621"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&amp;GetMDInt = &#91;MN&#93;(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx) &#123;</span></CodeLine>
<Link id="l09622" /><CodeLine lineNumber="9622"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;V = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantAsMetadata&gt;</a>(MN-&gt;getOperand(Idx));</span></CodeLine>
<Link id="l09623" /><CodeLine lineNumber="9623"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(V-&gt;getValue())-&gt;getZExtValue();</span></CodeLine>
<Link id="l09624" /><CodeLine lineNumber="9624"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l09625" /><CodeLine lineNumber="9625"></CodeLine>
<Link id="l09626" /><CodeLine lineNumber="9626"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&amp;GetMDString = &#91;MN&#93;(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx) &#123;</span></CodeLine>
<Link id="l09627" /><CodeLine lineNumber="9627"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;V = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MDString&gt;</a>(MN-&gt;getOperand(Idx));</span></CodeLine>
<Link id="l09628" /><CodeLine lineNumber="9628"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> V-&gt;getString();</span></CodeLine>
<Link id="l09629" /><CodeLine lineNumber="9629"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l09630" /><CodeLine lineNumber="9630"></CodeLine>
<Link id="l09631" /><CodeLine lineNumber="9631"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (GetMDInt(0)) &#123;</span></CodeLine>
<Link id="l09632" /><CodeLine lineNumber="9632"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l09633" /><CodeLine lineNumber="9633"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unexpected metadata!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09634" /><CodeLine lineNumber="9634"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09635" /><CodeLine lineNumber="9635"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OffloadEntriesInfoManager::OffloadEntryInfo::</span></CodeLine>
<Link id="l09636" /><CodeLine lineNumber="9636"><span class="doxyHighlight">        OffloadingEntryInfoTargetRegion: &#123;</span></CodeLine>
<Link id="l09637" /><CodeLine lineNumber="9637"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> EntryInfo(</span><span class="doxyHighlightComment">/&#42;ParentName=&#42;/</span><span class="doxyHighlight">GetMDString(3),</span></CodeLine>
<Link id="l09638" /><CodeLine lineNumber="9638"><span class="doxyHighlight">                                      </span><span class="doxyHighlightComment">/&#42;DeviceID=&#42;/</span><span class="doxyHighlight">GetMDInt(1),</span></CodeLine>
<Link id="l09639" /><CodeLine lineNumber="9639"><span class="doxyHighlight">                                      </span><span class="doxyHighlightComment">/&#42;FileID=&#42;/</span><span class="doxyHighlight">GetMDInt(2),</span></CodeLine>
<Link id="l09640" /><CodeLine lineNumber="9640"><span class="doxyHighlight">                                      </span><span class="doxyHighlightComment">/&#42;Line=&#42;/</span><span class="doxyHighlight">GetMDInt(4),</span></CodeLine>
<Link id="l09641" /><CodeLine lineNumber="9641"><span class="doxyHighlight">                                      </span><span class="doxyHighlightComment">/&#42;Count=&#42;/</span><span class="doxyHighlight">GetMDInt(5));</span></CodeLine>
<Link id="l09642" /><CodeLine lineNumber="9642"><span class="doxyHighlight">      OffloadInfoManager.initializeTargetRegionEntryInfo(EntryInfo,</span></CodeLine>
<Link id="l09643" /><CodeLine lineNumber="9643"><span class="doxyHighlight">                                                         </span><span class="doxyHighlightComment">/&#42;Order=&#42;/</span><span class="doxyHighlight">GetMDInt(6));</span></CodeLine>
<Link id="l09644" /><CodeLine lineNumber="9644"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09645" /><CodeLine lineNumber="9645"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09646" /><CodeLine lineNumber="9646"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> OffloadEntriesInfoManager::OffloadEntryInfo::</span></CodeLine>
<Link id="l09647" /><CodeLine lineNumber="9647"><span class="doxyHighlight">        OffloadingEntryInfoDeviceGlobalVar:</span></CodeLine>
<Link id="l09648" /><CodeLine lineNumber="9648"><span class="doxyHighlight">      OffloadInfoManager.initializeDeviceGlobalVarEntryInfo(</span></CodeLine>
<Link id="l09649" /><CodeLine lineNumber="9649"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">/&#42;MangledName=&#42;/</span><span class="doxyHighlight">GetMDString(1),</span></CodeLine>
<Link id="l09650" /><CodeLine lineNumber="9650"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryKind</a></span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span></CodeLine>
<Link id="l09651" /><CodeLine lineNumber="9651"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">/&#42;Flags=&#42;/</span><span class="doxyHighlight">GetMDInt(2)),</span></CodeLine>
<Link id="l09652" /><CodeLine lineNumber="9652"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">/&#42;Order=&#42;/</span><span class="doxyHighlight">GetMDInt(3));</span></CodeLine>
<Link id="l09653" /><CodeLine lineNumber="9653"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09654" /><CodeLine lineNumber="9654"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09655" /><CodeLine lineNumber="9655"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09656" /><CodeLine lineNumber="9656"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09657" /><CodeLine lineNumber="9657"></CodeLine>
<Link id="l09658" /><CodeLine lineNumber="9658" lineLink="/docs/api/classes/llvm/openmpirbuilder/#ac6293b7ea84a4deac85481dd10dad437"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/openmpirbuilder/#a2242b144e54fa6203dae5c5b27fff17c">OpenMPIRBuilder::loadOffloadInfoMetadata</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a> HostFilePath) &#123;</span></CodeLine>
<Link id="l09659" /><CodeLine lineNumber="9659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HostFilePath.<a href="/docs/api/classes/llvm/stringref/#a2dc80c585ad5882da8cae7b5968f7e74">empty</a>())</span></CodeLine>
<Link id="l09660" /><CodeLine lineNumber="9660"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09661" /><CodeLine lineNumber="9661"></CodeLine>
<Link id="l09662" /><CodeLine lineNumber="9662"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Buf = <a href="/docs/api/classes/llvm/memorybuffer/#aa98611beefe78f907beeee7305cc8174">MemoryBuffer::getFile</a>(HostFilePath);</span></CodeLine>
<Link id="l09663" /><CodeLine lineNumber="9663"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::error&#95;code Err = Buf.getError()) &#123;</span></CodeLine>
<Link id="l09664" /><CodeLine lineNumber="9664"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>((</span><span class="doxyHighlightStringLiteral">&quot;error opening host file from host file path inside of &quot;</span></CodeLine>
<Link id="l09665" /><CodeLine lineNumber="9665"><span class="doxyHighlight">                        </span><span class="doxyHighlightStringLiteral">&quot;OpenMPIRBuilder: &quot;</span><span class="doxyHighlight"> +</span></CodeLine>
<Link id="l09666" /><CodeLine lineNumber="9666"><span class="doxyHighlight">                        Err.message())</span></CodeLine>
<Link id="l09667" /><CodeLine lineNumber="9667"><span class="doxyHighlight">                           .c&#95;str());</span></CodeLine>
<Link id="l09668" /><CodeLine lineNumber="9668"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09669" /><CodeLine lineNumber="9669"></CodeLine>
<Link id="l09670" /><CodeLine lineNumber="9670"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> Ctx;</span></CodeLine>
<Link id="l09671" /><CodeLine lineNumber="9671"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> M = <a href="/docs/api/namespaces/llvm/#a4891d521956b735baba56d4dc193f5cd">expectedToErrorOrAndEmitErrors</a>(</span></CodeLine>
<Link id="l09672" /><CodeLine lineNumber="9672"><span class="doxyHighlight">      Ctx, <a href="/docs/api/namespaces/llvm/#a170525c5f5e06bd2555d40a0499b8b6d">parseBitcodeFile</a>(Buf.get()-&gt;getMemBufferRef(), Ctx));</span></CodeLine>
<Link id="l09673" /><CodeLine lineNumber="9673"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::error&#95;code Err = M.getError()) &#123;</span></CodeLine>
<Link id="l09674" /><CodeLine lineNumber="9674"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span></CodeLine>
<Link id="l09675" /><CodeLine lineNumber="9675"><span class="doxyHighlight">        (</span><span class="doxyHighlightStringLiteral">&quot;error parsing host file inside of OpenMPIRBuilder: &quot;</span><span class="doxyHighlight"> + Err.message())</span></CodeLine>
<Link id="l09676" /><CodeLine lineNumber="9676"><span class="doxyHighlight">            .c&#95;str());</span></CodeLine>
<Link id="l09677" /><CodeLine lineNumber="9677"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09678" /><CodeLine lineNumber="9678"></CodeLine>
<Link id="l09679" /><CodeLine lineNumber="9679"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/openmpirbuilder/#a2242b144e54fa6203dae5c5b27fff17c">loadOffloadInfoMetadata</a>(&#42;M.get());</span></CodeLine>
<Link id="l09680" /><CodeLine lineNumber="9680"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09681" /><CodeLine lineNumber="9681"></CodeLine>
<Link id="l09682" /><CodeLine lineNumber="9682"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l09683" /><CodeLine lineNumber="9683"><span class="doxyHighlightComment">// OffloadEntriesInfoManager</span></CodeLine>
<Link id="l09684" /><CodeLine lineNumber="9684"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l09685" /><CodeLine lineNumber="9685"></CodeLine>
<Link id="l09686" /><CodeLine lineNumber="9686" lineLink="/docs/api/classes/llvm/offloadentriesinfomanager/#af1c69166900a3ea831da7b0bda28554e"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#af1c69166900a3ea831da7b0bda28554e">OffloadEntriesInfoManager::empty</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l09687" /><CodeLine lineNumber="9687"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OffloadEntriesTargetRegion.empty() &amp;&amp;</span></CodeLine>
<Link id="l09688" /><CodeLine lineNumber="9688"><span class="doxyHighlight">         OffloadEntriesDeviceGlobalVar.empty();</span></CodeLine>
<Link id="l09689" /><CodeLine lineNumber="9689"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09690" /><CodeLine lineNumber="9690"></CodeLine>
<Link id="l09691" /><CodeLine lineNumber="9691"><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OffloadEntriesInfoManager::getTargetRegionEntryInfoCount(</span></CodeLine>
<Link id="l09692" /><CodeLine lineNumber="9692"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> &amp;EntryInfo)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l09693" /><CodeLine lineNumber="9693"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = OffloadEntriesTargetRegionCount.find(</span></CodeLine>
<Link id="l09694" /><CodeLine lineNumber="9694"><span class="doxyHighlight">      getTargetRegionEntryCountKey(EntryInfo));</span></CodeLine>
<Link id="l09695" /><CodeLine lineNumber="9695"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It == OffloadEntriesTargetRegionCount.end())</span></CodeLine>
<Link id="l09696" /><CodeLine lineNumber="9696"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l09697" /><CodeLine lineNumber="9697"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> It-&gt;second;</span></CodeLine>
<Link id="l09698" /><CodeLine lineNumber="9698"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09699" /><CodeLine lineNumber="9699"></CodeLine>
<Link id="l09700" /><CodeLine lineNumber="9700"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> OffloadEntriesInfoManager::incrementTargetRegionEntryInfoCount(</span></CodeLine>
<Link id="l09701" /><CodeLine lineNumber="9701"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> &amp;EntryInfo) &#123;</span></CodeLine>
<Link id="l09702" /><CodeLine lineNumber="9702"><span class="doxyHighlight">  OffloadEntriesTargetRegionCount&#91;getTargetRegionEntryCountKey(EntryInfo)&#93; =</span></CodeLine>
<Link id="l09703" /><CodeLine lineNumber="9703"><span class="doxyHighlight">      EntryInfo.<a href="/docs/api/structs/llvm/targetregionentryinfo/#a8cc8999b43ab73c1f7f8618f7735f3cd">Count</a> + 1;</span></CodeLine>
<Link id="l09704" /><CodeLine lineNumber="9704"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09705" /><CodeLine lineNumber="9705"></CodeLine>
<Link id="l09706" /><CodeLine lineNumber="9706"><span class="doxyHighlightComment">/// Initialize target region entry.</span></CodeLine>
<Link id="l09707" /><CodeLine lineNumber="9707" lineLink="/docs/api/classes/llvm/offloadentriesinfomanager/#ab05d360f14a80b1fc10d1632aa0f1433"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab05d360f14a80b1fc10d1632aa0f1433">OffloadEntriesInfoManager::initializeTargetRegionEntryInfo</a>(</span></CodeLine>
<Link id="l09708" /><CodeLine lineNumber="9708"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> &amp;EntryInfo, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Order) &#123;</span></CodeLine>
<Link id="l09709" /><CodeLine lineNumber="9709"><span class="doxyHighlight">  OffloadEntriesTargetRegion&#91;EntryInfo&#93; =</span></CodeLine>
<Link id="l09710" /><CodeLine lineNumber="9710"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/offloadentriesinfomanager/offloadentryinfotargetregion">OffloadEntryInfoTargetRegion</a>(Order, </span><span class="doxyHighlightComment">/&#42;Addr=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;ID=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l09711" /><CodeLine lineNumber="9711"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a4e85049eada7d6cc3bedde1433ce4a7ba1e2537a111117d2cebad779b6de1856b">OMPTargetRegionEntryTargetRegion</a>);</span></CodeLine>
<Link id="l09712" /><CodeLine lineNumber="9712"><span class="doxyHighlight">  ++OffloadingEntriesNum;</span></CodeLine>
<Link id="l09713" /><CodeLine lineNumber="9713"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09714" /><CodeLine lineNumber="9714"></CodeLine>
<Link id="l09715" /><CodeLine lineNumber="9715" lineLink="/docs/api/classes/llvm/offloadentriesinfomanager/#a9736eb60d11b4a8d644d3e32346e7f56"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a9736eb60d11b4a8d644d3e32346e7f56">OffloadEntriesInfoManager::registerTargetRegionEntryInfo</a>(</span></CodeLine>
<Link id="l09716" /><CodeLine lineNumber="9716"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> EntryInfo, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Addr, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>,</span></CodeLine>
<Link id="l09717" /><CodeLine lineNumber="9717"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a4e85049eada7d6cc3bedde1433ce4a7b">OMPTargetRegionEntryKind</a> Flags) &#123;</span></CodeLine>
<Link id="l09718" /><CodeLine lineNumber="9718"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EntryInfo.<a href="/docs/api/structs/llvm/targetregionentryinfo/#a8cc8999b43ab73c1f7f8618f7735f3cd">Count</a> == 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;expected default EntryInfo&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09719" /><CodeLine lineNumber="9719"></CodeLine>
<Link id="l09720" /><CodeLine lineNumber="9720"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the EntryInfo with the next available count for this location.</span></CodeLine>
<Link id="l09721" /><CodeLine lineNumber="9721"><span class="doxyHighlight">  EntryInfo.<a href="/docs/api/structs/llvm/targetregionentryinfo/#a8cc8999b43ab73c1f7f8618f7735f3cd">Count</a> = getTargetRegionEntryInfoCount(EntryInfo);</span></CodeLine>
<Link id="l09722" /><CodeLine lineNumber="9722"></CodeLine>
<Link id="l09723" /><CodeLine lineNumber="9723"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are emitting code for a target, the entry is already initialized,</span></CodeLine>
<Link id="l09724" /><CodeLine lineNumber="9724"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// only has to be registered.</span></CodeLine>
<Link id="l09725" /><CodeLine lineNumber="9725"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OMPBuilder-&gt;Config.isTargetDevice()) &#123;</span></CodeLine>
<Link id="l09726" /><CodeLine lineNumber="9726"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This could happen if the device compilation is invoked standalone.</span></CodeLine>
<Link id="l09727" /><CodeLine lineNumber="9727"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a8a88ec295fa5c83572df98cfaff271ed">hasTargetRegionEntryInfo</a>(EntryInfo)) &#123;</span></CodeLine>
<Link id="l09728" /><CodeLine lineNumber="9728"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09729" /><CodeLine lineNumber="9729"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09730" /><CodeLine lineNumber="9730"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Entry = OffloadEntriesTargetRegion&#91;EntryInfo&#93;;</span></CodeLine>
<Link id="l09731" /><CodeLine lineNumber="9731"><span class="doxyHighlight">    Entry.setAddress(Addr);</span></CodeLine>
<Link id="l09732" /><CodeLine lineNumber="9732"><span class="doxyHighlight">    Entry.setID(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>);</span></CodeLine>
<Link id="l09733" /><CodeLine lineNumber="9733"><span class="doxyHighlight">    Entry.setFlags(Flags);</span></CodeLine>
<Link id="l09734" /><CodeLine lineNumber="9734"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l09735" /><CodeLine lineNumber="9735"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Flags == <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a4e85049eada7d6cc3bedde1433ce4a7ba1e2537a111117d2cebad779b6de1856b">OffloadEntriesInfoManager::OMPTargetRegionEntryTargetRegion</a> &amp;&amp;</span></CodeLine>
<Link id="l09736" /><CodeLine lineNumber="9736"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a8a88ec295fa5c83572df98cfaff271ed">hasTargetRegionEntryInfo</a>(EntryInfo, </span><span class="doxyHighlightComment">/&#42;IgnoreAddressId&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l09737" /><CodeLine lineNumber="9737"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09738" /><CodeLine lineNumber="9738"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a8a88ec295fa5c83572df98cfaff271ed">hasTargetRegionEntryInfo</a>(EntryInfo) &amp;&amp;</span></CodeLine>
<Link id="l09739" /><CodeLine lineNumber="9739"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Target region entry already registered!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09740" /><CodeLine lineNumber="9740"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/offloadentriesinfomanager/offloadentryinfotargetregion">OffloadEntryInfoTargetRegion</a> Entry(OffloadingEntriesNum, Addr, <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>, Flags);</span></CodeLine>
<Link id="l09741" /><CodeLine lineNumber="9741"><span class="doxyHighlight">    OffloadEntriesTargetRegion&#91;EntryInfo&#93; = Entry;</span></CodeLine>
<Link id="l09742" /><CodeLine lineNumber="9742"><span class="doxyHighlight">    ++OffloadingEntriesNum;</span></CodeLine>
<Link id="l09743" /><CodeLine lineNumber="9743"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09744" /><CodeLine lineNumber="9744"><span class="doxyHighlight">  incrementTargetRegionEntryInfoCount(EntryInfo);</span></CodeLine>
<Link id="l09745" /><CodeLine lineNumber="9745"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09746" /><CodeLine lineNumber="9746"></CodeLine>
<Link id="l09747" /><CodeLine lineNumber="9747" lineLink="/docs/api/classes/llvm/offloadentriesinfomanager/#a8a88ec295fa5c83572df98cfaff271ed"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a8a88ec295fa5c83572df98cfaff271ed">OffloadEntriesInfoManager::hasTargetRegionEntryInfo</a>(</span></CodeLine>
<Link id="l09748" /><CodeLine lineNumber="9748"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/targetregionentryinfo">TargetRegionEntryInfo</a> EntryInfo, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IgnoreAddressId)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l09749" /><CodeLine lineNumber="9749"></CodeLine>
<Link id="l09750" /><CodeLine lineNumber="9750"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the EntryInfo with the next available count for this location.</span></CodeLine>
<Link id="l09751" /><CodeLine lineNumber="9751"><span class="doxyHighlight">  EntryInfo.<a href="/docs/api/structs/llvm/targetregionentryinfo/#a8cc8999b43ab73c1f7f8618f7735f3cd">Count</a> = getTargetRegionEntryInfoCount(EntryInfo);</span></CodeLine>
<Link id="l09752" /><CodeLine lineNumber="9752"></CodeLine>
<Link id="l09753" /><CodeLine lineNumber="9753"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = OffloadEntriesTargetRegion.find(EntryInfo);</span></CodeLine>
<Link id="l09754" /><CodeLine lineNumber="9754"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It == OffloadEntriesTargetRegion.end()) &#123;</span></CodeLine>
<Link id="l09755" /><CodeLine lineNumber="9755"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09756" /><CodeLine lineNumber="9756"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09757" /><CodeLine lineNumber="9757"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Fail if this entry is already registered.</span></CodeLine>
<Link id="l09758" /><CodeLine lineNumber="9758"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IgnoreAddressId &amp;&amp; (It-&gt;second.getAddress() || It-&gt;second.getID()))</span></CodeLine>
<Link id="l09759" /><CodeLine lineNumber="9759"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09760" /><CodeLine lineNumber="9760"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09761" /><CodeLine lineNumber="9761"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09762" /><CodeLine lineNumber="9762"></CodeLine>
<Link id="l09763" /><CodeLine lineNumber="9763" lineLink="/docs/api/classes/llvm/offloadentriesinfomanager/#aa87d491241b8ff7bdec84f22843c6ab5"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#aa87d491241b8ff7bdec84f22843c6ab5">OffloadEntriesInfoManager::actOnTargetRegionEntriesInfo</a>(</span></CodeLine>
<Link id="l09764" /><CodeLine lineNumber="9764"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ac115d36d95b2d0b214799c15f2df8cbf">OffloadTargetRegionEntryInfoActTy</a> &amp;Action) &#123;</span></CodeLine>
<Link id="l09765" /><CodeLine lineNumber="9765"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan all target region entries and perform the provided action.</span></CodeLine>
<Link id="l09766" /><CodeLine lineNumber="9766"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;It : OffloadEntriesTargetRegion) &#123;</span></CodeLine>
<Link id="l09767" /><CodeLine lineNumber="9767"><span class="doxyHighlight">    Action(It.first, It.second);</span></CodeLine>
<Link id="l09768" /><CodeLine lineNumber="9768"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09769" /><CodeLine lineNumber="9769"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09770" /><CodeLine lineNumber="9770"></CodeLine>
<Link id="l09771" /><CodeLine lineNumber="9771" lineLink="/docs/api/classes/llvm/offloadentriesinfomanager/#a4503192ffc49753d6b8ec734f2927742"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a4503192ffc49753d6b8ec734f2927742">OffloadEntriesInfoManager::initializeDeviceGlobalVarEntryInfo</a>(</span></CodeLine>
<Link id="l09772" /><CodeLine lineNumber="9772"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name, <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534">OMPTargetGlobalVarEntryKind</a> Flags, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Order) &#123;</span></CodeLine>
<Link id="l09773" /><CodeLine lineNumber="9773"><span class="doxyHighlight">  OffloadEntriesDeviceGlobalVar.try&#95;emplace(Name, Order, Flags);</span></CodeLine>
<Link id="l09774" /><CodeLine lineNumber="9774"><span class="doxyHighlight">  ++OffloadingEntriesNum;</span></CodeLine>
<Link id="l09775" /><CodeLine lineNumber="9775"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09776" /><CodeLine lineNumber="9776"></CodeLine>
<Link id="l09777" /><CodeLine lineNumber="9777" lineLink="/docs/api/classes/llvm/offloadentriesinfomanager/#a4229a8d4526cc8fc7d5e043727b07128"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a4229a8d4526cc8fc7d5e043727b07128">OffloadEntriesInfoManager::registerDeviceGlobalVarEntryInfo</a>(</span></CodeLine>
<Link id="l09778" /><CodeLine lineNumber="9778"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/stringref">StringRef</a> VarName, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Addr, int64&#95;t VarSize,</span></CodeLine>
<Link id="l09779" /><CodeLine lineNumber="9779"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534">OMPTargetGlobalVarEntryKind</a> Flags, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57c">GlobalValue::LinkageTypes</a> Linkage) &#123;</span></CodeLine>
<Link id="l09780" /><CodeLine lineNumber="9780"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OMPBuilder-&gt;Config.isTargetDevice()) &#123;</span></CodeLine>
<Link id="l09781" /><CodeLine lineNumber="9781"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This could happen if the device compilation is invoked standalone.</span></CodeLine>
<Link id="l09782" /><CodeLine lineNumber="9782"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/offloadentriesinfomanager/#aca32e410f9038aada8d559cee9754d95">hasDeviceGlobalVarEntryInfo</a>(VarName))</span></CodeLine>
<Link id="l09783" /><CodeLine lineNumber="9783"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09784" /><CodeLine lineNumber="9784"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Entry = OffloadEntriesDeviceGlobalVar&#91;VarName&#93;;</span></CodeLine>
<Link id="l09785" /><CodeLine lineNumber="9785"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Entry.getAddress() &amp;&amp; <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#aca32e410f9038aada8d559cee9754d95">hasDeviceGlobalVarEntryInfo</a>(VarName)) &#123;</span></CodeLine>
<Link id="l09786" /><CodeLine lineNumber="9786"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Entry.getVarSize() == 0) &#123;</span></CodeLine>
<Link id="l09787" /><CodeLine lineNumber="9787"><span class="doxyHighlight">        Entry.setVarSize(VarSize);</span></CodeLine>
<Link id="l09788" /><CodeLine lineNumber="9788"><span class="doxyHighlight">        Entry.setLinkage(Linkage);</span></CodeLine>
<Link id="l09789" /><CodeLine lineNumber="9789"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09790" /><CodeLine lineNumber="9790"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09791" /><CodeLine lineNumber="9791"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09792" /><CodeLine lineNumber="9792"><span class="doxyHighlight">    Entry.setVarSize(VarSize);</span></CodeLine>
<Link id="l09793" /><CodeLine lineNumber="9793"><span class="doxyHighlight">    Entry.setLinkage(Linkage);</span></CodeLine>
<Link id="l09794" /><CodeLine lineNumber="9794"><span class="doxyHighlight">    Entry.setAddress(Addr);</span></CodeLine>
<Link id="l09795" /><CodeLine lineNumber="9795"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l09796" /><CodeLine lineNumber="9796"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/offloadentriesinfomanager/#aca32e410f9038aada8d559cee9754d95">hasDeviceGlobalVarEntryInfo</a>(VarName)) &#123;</span></CodeLine>
<Link id="l09797" /><CodeLine lineNumber="9797"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Entry = OffloadEntriesDeviceGlobalVar&#91;VarName&#93;;</span></CodeLine>
<Link id="l09798" /><CodeLine lineNumber="9798"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Entry.isValid() &amp;&amp; Entry.getFlags() == Flags &amp;&amp;</span></CodeLine>
<Link id="l09799" /><CodeLine lineNumber="9799"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Entry not initialized!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09800" /><CodeLine lineNumber="9800"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Entry.getVarSize() == 0) &#123;</span></CodeLine>
<Link id="l09801" /><CodeLine lineNumber="9801"><span class="doxyHighlight">        Entry.setVarSize(VarSize);</span></CodeLine>
<Link id="l09802" /><CodeLine lineNumber="9802"><span class="doxyHighlight">        Entry.setLinkage(Linkage);</span></CodeLine>
<Link id="l09803" /><CodeLine lineNumber="9803"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09804" /><CodeLine lineNumber="9804"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09805" /><CodeLine lineNumber="9805"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09806" /><CodeLine lineNumber="9806"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Flags == <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#ab9575c71365de4083a7be6ef6572d534aba847264872ebbdaf660316167b89e15">OffloadEntriesInfoManager::OMPTargetGlobalVarEntryIndirect</a>)</span></CodeLine>
<Link id="l09807" /><CodeLine lineNumber="9807"><span class="doxyHighlight">      OffloadEntriesDeviceGlobalVar.try&#95;emplace(VarName, OffloadingEntriesNum,</span></CodeLine>
<Link id="l09808" /><CodeLine lineNumber="9808"><span class="doxyHighlight">                                                Addr, VarSize, Flags, Linkage,</span></CodeLine>
<Link id="l09809" /><CodeLine lineNumber="9809"><span class="doxyHighlight">                                                VarName.str());</span></CodeLine>
<Link id="l09810" /><CodeLine lineNumber="9810"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l09811" /><CodeLine lineNumber="9811"><span class="doxyHighlight">      OffloadEntriesDeviceGlobalVar.try&#95;emplace(</span></CodeLine>
<Link id="l09812" /><CodeLine lineNumber="9812"><span class="doxyHighlight">          VarName, OffloadingEntriesNum, Addr, VarSize, Flags, Linkage, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09813" /><CodeLine lineNumber="9813"><span class="doxyHighlight">    ++OffloadingEntriesNum;</span></CodeLine>
<Link id="l09814" /><CodeLine lineNumber="9814"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09815" /><CodeLine lineNumber="9815"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09816" /><CodeLine lineNumber="9816"></CodeLine>
<Link id="l09817" /><CodeLine lineNumber="9817" lineLink="/docs/api/classes/llvm/offloadentriesinfomanager/#a453a107a33d0d865ed6e021fc6cdcc20"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a453a107a33d0d865ed6e021fc6cdcc20">OffloadEntriesInfoManager::actOnDeviceGlobalVarEntriesInfo</a>(</span></CodeLine>
<Link id="l09818" /><CodeLine lineNumber="9818"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/offloadentriesinfomanager/#a0035f4c66082f93a65972a35db34f497">OffloadDeviceGlobalVarEntryInfoActTy</a> &amp;Action) &#123;</span></CodeLine>
<Link id="l09819" /><CodeLine lineNumber="9819"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan all target region entries and perform the provided action.</span></CodeLine>
<Link id="l09820" /><CodeLine lineNumber="9820"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;E : OffloadEntriesDeviceGlobalVar)</span></CodeLine>
<Link id="l09821" /><CodeLine lineNumber="9821"><span class="doxyHighlight">    Action(E.getKey(), E.getValue());</span></CodeLine>
<Link id="l09822" /><CodeLine lineNumber="9822"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09823" /><CodeLine lineNumber="9823"></CodeLine>
<Link id="l09824" /><CodeLine lineNumber="9824"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l09825" /><CodeLine lineNumber="9825"><span class="doxyHighlightComment">// CanonicalLoopInfo</span></CodeLine>
<Link id="l09826" /><CodeLine lineNumber="9826"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l09827" /><CodeLine lineNumber="9827"></CodeLine>
<Link id="l09828" /><CodeLine lineNumber="9828"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> CanonicalLoopInfo::collectControlBlocks(</span></CodeLine>
<Link id="l09829" /><CodeLine lineNumber="9829"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;BBs) &#123;</span></CodeLine>
<Link id="l09830" /><CodeLine lineNumber="9830"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We only count those BBs as control block for which we do not need to</span></CodeLine>
<Link id="l09831" /><CodeLine lineNumber="9831"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reverse the CFG, i.e. not the loop body which can contain arbitrary control</span></CodeLine>
<Link id="l09832" /><CodeLine lineNumber="9832"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// flow. For consistency, this also means we do not add the Body block, which</span></CodeLine>
<Link id="l09833" /><CodeLine lineNumber="9833"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is just the entry to the body code.</span></CodeLine>
<Link id="l09834" /><CodeLine lineNumber="9834"><span class="doxyHighlight">  BBs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(BBs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() + 6);</span></CodeLine>
<Link id="l09835" /><CodeLine lineNumber="9835"><span class="doxyHighlight">  BBs.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(&#123;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>(), Header, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, Latch, Exit, <a href="/docs/api/classes/llvm/canonicalloopinfo/#a92d8bce979891dc43b6573e8cca2e58c">getAfter</a>()&#125;);</span></CodeLine>
<Link id="l09836" /><CodeLine lineNumber="9836"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09837" /><CodeLine lineNumber="9837"></CodeLine>
<Link id="l09838" /><CodeLine lineNumber="9838" lineLink="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">CanonicalLoopInfo::getPreheader</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l09839" /><CodeLine lineNumber="9839"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/canonicalloopinfo/#a4b2b7074e300c251f7cb8913620b1d80">isValid</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Requires a valid canonical loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09840" /><CodeLine lineNumber="9840"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Header)) &#123;</span></CodeLine>
<Link id="l09841" /><CodeLine lineNumber="9841"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred != Latch)</span></CodeLine>
<Link id="l09842" /><CodeLine lineNumber="9842"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Pred;</span></CodeLine>
<Link id="l09843" /><CodeLine lineNumber="9843"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09844" /><CodeLine lineNumber="9844"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Missing preheader&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09845" /><CodeLine lineNumber="9845"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09846" /><CodeLine lineNumber="9846"></CodeLine>
<Link id="l09847" /><CodeLine lineNumber="9847"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> CanonicalLoopInfo::setTripCount(<a href="/docs/api/classes/llvm/value">Value</a> &#42;TripCount) &#123;</span></CodeLine>
<Link id="l09848" /><CodeLine lineNumber="9848"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/canonicalloopinfo/#a4b2b7074e300c251f7cb8913620b1d80">isValid</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Requires a valid canonical loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09849" /><CodeLine lineNumber="9849"></CodeLine>
<Link id="l09850" /><CodeLine lineNumber="9850"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CmpI = &amp;<a href="/docs/api/classes/llvm/canonicalloopinfo/#acb5b5b136597312e0d5df6b746a7e6db">getCond</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>();</span></CodeLine>
<Link id="l09851" /><CodeLine lineNumber="9851"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CmpInst&gt;</a>(CmpI) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;First inst must compare IV with TripCount&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09852" /><CodeLine lineNumber="9852"><span class="doxyHighlight">  CmpI-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, TripCount);</span></CodeLine>
<Link id="l09853" /><CodeLine lineNumber="9853"></CodeLine>
<Link id="l09854" /><CodeLine lineNumber="9854"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l09855" /><CodeLine lineNumber="9855"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/canonicalloopinfo/#a32ff799dcb39887a8d21322020f305ba">assertOK</a>();</span></CodeLine>
<Link id="l09856" /><CodeLine lineNumber="9856"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l09857" /><CodeLine lineNumber="9857"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09858" /><CodeLine lineNumber="9858"></CodeLine>
<Link id="l09859" /><CodeLine lineNumber="9859"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> CanonicalLoopInfo::mapIndVar(</span></CodeLine>
<Link id="l09860" /><CodeLine lineNumber="9860"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function-ref">llvm::function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/value">Value</a> &#42;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;)&gt; Updater) &#123;</span></CodeLine>
<Link id="l09861" /><CodeLine lineNumber="9861"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/canonicalloopinfo/#a4b2b7074e300c251f7cb8913620b1d80">isValid</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Requires a valid canonical loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09862" /><CodeLine lineNumber="9862"></CodeLine>
<Link id="l09863" /><CodeLine lineNumber="9863"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OldIV = <a href="/docs/api/classes/llvm/canonicalloopinfo/#af4131f5f461f1138483addfd7cd7f579">getIndVar</a>();</span></CodeLine>
<Link id="l09864" /><CodeLine lineNumber="9864"></CodeLine>
<Link id="l09865" /><CodeLine lineNumber="9865"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Record all uses excluding those introduced by the updater. Uses by the</span></CodeLine>
<Link id="l09866" /><CodeLine lineNumber="9866"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// CanonicalLoopInfo itself to keep track of the number of iterations are</span></CodeLine>
<Link id="l09867" /><CodeLine lineNumber="9867"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// excluded.</span></CodeLine>
<Link id="l09868" /><CodeLine lineNumber="9868"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Use &#42;&gt;</a> ReplacableUses;</span></CodeLine>
<Link id="l09869" /><CodeLine lineNumber="9869"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : OldIV-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</span></CodeLine>
<Link id="l09870" /><CodeLine lineNumber="9870"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l09871" /><CodeLine lineNumber="9871"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/user">User</a>)</span></CodeLine>
<Link id="l09872" /><CodeLine lineNumber="9872"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09873" /><CodeLine lineNumber="9873"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent() == <a href="/docs/api/classes/llvm/canonicalloopinfo/#acb5b5b136597312e0d5df6b746a7e6db">getCond</a>())</span></CodeLine>
<Link id="l09874" /><CodeLine lineNumber="9874"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09875" /><CodeLine lineNumber="9875"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent() == <a href="/docs/api/classes/llvm/canonicalloopinfo/#ac37a6cf77f6f82b6bb28af4d9c8626d0">getLatch</a>())</span></CodeLine>
<Link id="l09876" /><CodeLine lineNumber="9876"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09877" /><CodeLine lineNumber="9877"><span class="doxyHighlight">    ReplacableUses.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;U);</span></CodeLine>
<Link id="l09878" /><CodeLine lineNumber="9878"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09879" /><CodeLine lineNumber="9879"></CodeLine>
<Link id="l09880" /><CodeLine lineNumber="9880"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Run the updater that may introduce new uses</span></CodeLine>
<Link id="l09881" /><CodeLine lineNumber="9881"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;NewIV = Updater(OldIV);</span></CodeLine>
<Link id="l09882" /><CodeLine lineNumber="9882"></CodeLine>
<Link id="l09883" /><CodeLine lineNumber="9883"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace the old uses with the value returned by the updater.</span></CodeLine>
<Link id="l09884" /><CodeLine lineNumber="9884"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &#42;U : ReplacableUses)</span></CodeLine>
<Link id="l09885" /><CodeLine lineNumber="9885"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;set(NewIV);</span></CodeLine>
<Link id="l09886" /><CodeLine lineNumber="9886"></CodeLine>
<Link id="l09887" /><CodeLine lineNumber="9887"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l09888" /><CodeLine lineNumber="9888"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/canonicalloopinfo/#a32ff799dcb39887a8d21322020f305ba">assertOK</a>();</span></CodeLine>
<Link id="l09889" /><CodeLine lineNumber="9889"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l09890" /><CodeLine lineNumber="9890"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09891" /><CodeLine lineNumber="9891"></CodeLine>
<Link id="l09892" /><CodeLine lineNumber="9892" lineLink="/docs/api/classes/llvm/canonicalloopinfo/#a32ff799dcb39887a8d21322020f305ba"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/canonicalloopinfo/#a32ff799dcb39887a8d21322020f305ba">CanonicalLoopInfo::assertOK</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l09893" /><CodeLine lineNumber="9893"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l09894" /><CodeLine lineNumber="9894"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// No constraints if this object currently does not describe a loop.</span></CodeLine>
<Link id="l09895" /><CodeLine lineNumber="9895"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/canonicalloopinfo/#a4b2b7074e300c251f7cb8913620b1d80">isValid</a>())</span></CodeLine>
<Link id="l09896" /><CodeLine lineNumber="9896"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09897" /><CodeLine lineNumber="9897"></CodeLine>
<Link id="l09898" /><CodeLine lineNumber="9898"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = <a href="/docs/api/classes/llvm/canonicalloopinfo/#ad50eb30e70ff2a9ea7f220547e2b6f6d">getPreheader</a>();</span></CodeLine>
<Link id="l09899" /><CodeLine lineNumber="9899"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Body = <a href="/docs/api/classes/llvm/canonicalloopinfo/#a47521ec347ef7b522745bf89e2e2d19a">getBody</a>();</span></CodeLine>
<Link id="l09900" /><CodeLine lineNumber="9900"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa7bfcadb5535fe8aad5032762b7bfe159">After</a> = <a href="/docs/api/classes/llvm/canonicalloopinfo/#a92d8bce979891dc43b6573e8cca2e58c">getAfter</a>();</span></CodeLine>
<Link id="l09901" /><CodeLine lineNumber="9901"></CodeLine>
<Link id="l09902" /><CodeLine lineNumber="9902"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Verify standard control-flow we use for OpenMP loops.</span></CodeLine>
<Link id="l09903" /><CodeLine lineNumber="9903"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Preheader);</span></CodeLine>
<Link id="l09904" /><CodeLine lineNumber="9904"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()) &amp;&amp;</span></CodeLine>
<Link id="l09905" /><CodeLine lineNumber="9905"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Preheader must terminate with unconditional branch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09906" /><CodeLine lineNumber="9906"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>() == Header &amp;&amp;</span></CodeLine>
<Link id="l09907" /><CodeLine lineNumber="9907"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Preheader must jump to header&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09908" /><CodeLine lineNumber="9908"></CodeLine>
<Link id="l09909" /><CodeLine lineNumber="9909"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Header);</span></CodeLine>
<Link id="l09910" /><CodeLine lineNumber="9910"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(Header-&gt;getTerminator()) &amp;&amp;</span></CodeLine>
<Link id="l09911" /><CodeLine lineNumber="9911"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Header must terminate with unconditional branch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09912" /><CodeLine lineNumber="9912"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Header-&gt;getSingleSuccessor() == Cond &amp;&amp;</span></CodeLine>
<Link id="l09913" /><CodeLine lineNumber="9913"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Header must jump to exiting block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09914" /><CodeLine lineNumber="9914"></CodeLine>
<Link id="l09915" /><CodeLine lineNumber="9915"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cond);</span></CodeLine>
<Link id="l09916" /><CodeLine lineNumber="9916"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cond-&gt;getSinglePredecessor() == Header &amp;&amp;</span></CodeLine>
<Link id="l09917" /><CodeLine lineNumber="9917"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Exiting block only reachable from header&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09918" /><CodeLine lineNumber="9918"></CodeLine>
<Link id="l09919" /><CodeLine lineNumber="9919"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(Cond-&gt;getTerminator()) &amp;&amp;</span></CodeLine>
<Link id="l09920" /><CodeLine lineNumber="9920"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Exiting block must terminate with conditional branch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09921" /><CodeLine lineNumber="9921"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmreflect-cpp/#ac934769d93af95250952646a3829df4c">size</a>(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(Cond)) == 2 &amp;&amp;</span></CodeLine>
<Link id="l09922" /><CodeLine lineNumber="9922"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Exiting block must have two successors&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09923" /><CodeLine lineNumber="9923"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Cond-&gt;getTerminator())-&gt;getSuccessor(0) == Body &amp;&amp;</span></CodeLine>
<Link id="l09924" /><CodeLine lineNumber="9924"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Exiting block&#39;s first successor jump to the body&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09925" /><CodeLine lineNumber="9925"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Cond-&gt;getTerminator())-&gt;getSuccessor(1) == Exit &amp;&amp;</span></CodeLine>
<Link id="l09926" /><CodeLine lineNumber="9926"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Exiting block&#39;s second successor must exit the loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09927" /><CodeLine lineNumber="9927"></CodeLine>
<Link id="l09928" /><CodeLine lineNumber="9928"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Body);</span></CodeLine>
<Link id="l09929" /><CodeLine lineNumber="9929"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Body-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>() == Cond &amp;&amp;</span></CodeLine>
<Link id="l09930" /><CodeLine lineNumber="9930"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Body only reachable from exiting block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09931" /><CodeLine lineNumber="9931"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(Body-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>()));</span></CodeLine>
<Link id="l09932" /><CodeLine lineNumber="9932"></CodeLine>
<Link id="l09933" /><CodeLine lineNumber="9933"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Latch);</span></CodeLine>
<Link id="l09934" /><CodeLine lineNumber="9934"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(Latch-&gt;getTerminator()) &amp;&amp;</span></CodeLine>
<Link id="l09935" /><CodeLine lineNumber="9935"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Latch must terminate with unconditional branch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09936" /><CodeLine lineNumber="9936"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Latch-&gt;getSingleSuccessor() == Header &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Latch must jump to header&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09937" /><CodeLine lineNumber="9937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: To support simple redirecting of the end of the body code that has</span></CodeLine>
<Link id="l09938" /><CodeLine lineNumber="9938"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// multiple; introduce another auxiliary basic block like preheader and after.</span></CodeLine>
<Link id="l09939" /><CodeLine lineNumber="9939"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Latch-&gt;getSinglePredecessor() != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09940" /><CodeLine lineNumber="9940"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(Latch-&gt;front()));</span></CodeLine>
<Link id="l09941" /><CodeLine lineNumber="9941"></CodeLine>
<Link id="l09942" /><CodeLine lineNumber="9942"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Exit);</span></CodeLine>
<Link id="l09943" /><CodeLine lineNumber="9943"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(Exit-&gt;getTerminator()) &amp;&amp;</span></CodeLine>
<Link id="l09944" /><CodeLine lineNumber="9944"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Exit block must terminate with unconditional branch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09945" /><CodeLine lineNumber="9945"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Exit-&gt;getSingleSuccessor() == <a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa7bfcadb5535fe8aad5032762b7bfe159">After</a> &amp;&amp;</span></CodeLine>
<Link id="l09946" /><CodeLine lineNumber="9946"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Exit block must jump to after block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09947" /><CodeLine lineNumber="9947"></CodeLine>
<Link id="l09948" /><CodeLine lineNumber="9948"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa7bfcadb5535fe8aad5032762b7bfe159">After</a>);</span></CodeLine>
<Link id="l09949" /><CodeLine lineNumber="9949"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa7bfcadb5535fe8aad5032762b7bfe159">After</a>-&gt;getSinglePredecessor() == Exit &amp;&amp;</span></CodeLine>
<Link id="l09950" /><CodeLine lineNumber="9950"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;After block only reachable from exit block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09951" /><CodeLine lineNumber="9951"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa7bfcadb5535fe8aad5032762b7bfe159">After</a>-&gt;empty() || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/passes/standardinstrumentations-cpp/#a6f1bbcae7288f05872dcfe811d0388baa7bfcadb5535fe8aad5032762b7bfe159">After</a>-&gt;front()));</span></CodeLine>
<Link id="l09952" /><CodeLine lineNumber="9952"></CodeLine>
<Link id="l09953" /><CodeLine lineNumber="9953"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IndVar = <a href="/docs/api/classes/llvm/canonicalloopinfo/#af4131f5f461f1138483addfd7cd7f579">getIndVar</a>();</span></CodeLine>
<Link id="l09954" /><CodeLine lineNumber="9954"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IndVar &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Canonical induction variable not found?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09955" /><CodeLine lineNumber="9955"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntegerType&gt;</a>(IndVar-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &amp;&amp;</span></CodeLine>
<Link id="l09956" /><CodeLine lineNumber="9956"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Induction variable must be an integer&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09957" /><CodeLine lineNumber="9957"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(IndVar)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() == Header &amp;&amp;</span></CodeLine>
<Link id="l09958" /><CodeLine lineNumber="9958"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Induction variable must be a PHI in the loop header&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09959" /><CodeLine lineNumber="9959"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(IndVar)-&gt;getIncomingBlock(0) == Preheader);</span></CodeLine>
<Link id="l09960" /><CodeLine lineNumber="9960"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l09961" /><CodeLine lineNumber="9961"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(IndVar)-&gt;getIncomingValue(0))-&gt;<a href="/docs/api/files/lib/lib/analysis/lint-cpp/#a45005634b54e2126cb3e6ec0dbc9ade4">isZero</a>());</span></CodeLine>
<Link id="l09962" /><CodeLine lineNumber="9962"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(IndVar)-&gt;getIncomingBlock(1) == Latch);</span></CodeLine>
<Link id="l09963" /><CodeLine lineNumber="9963"></CodeLine>
<Link id="l09964" /><CodeLine lineNumber="9964"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NextIndVar = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(IndVar)-&gt;getIncomingValue(1);</span></CodeLine>
<Link id="l09965" /><CodeLine lineNumber="9965"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(NextIndVar)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() == Latch);</span></CodeLine>
<Link id="l09966" /><CodeLine lineNumber="9966"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(NextIndVar)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanslp-cpp/#a06b4f19004df11b338ccc7e73bf47ab4">getOpcode</a>() == BinaryOperator::Add);</span></CodeLine>
<Link id="l09967" /><CodeLine lineNumber="9967"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(NextIndVar)-&gt;getOperand(0) == IndVar);</span></CodeLine>
<Link id="l09968" /><CodeLine lineNumber="9968"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(NextIndVar)-&gt;getOperand(1))</span></CodeLine>
<Link id="l09969" /><CodeLine lineNumber="9969"><span class="doxyHighlight">             -&gt;isOne());</span></CodeLine>
<Link id="l09970" /><CodeLine lineNumber="9970"></CodeLine>
<Link id="l09971" /><CodeLine lineNumber="9971"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;TripCount = <a href="/docs/api/classes/llvm/canonicalloopinfo/#a01560f4a4ff7bfc8a96bd406b6f17ea2">getTripCount</a>();</span></CodeLine>
<Link id="l09972" /><CodeLine lineNumber="9972"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TripCount &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Loop trip count not found?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09973" /><CodeLine lineNumber="9973"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IndVar-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == TripCount-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() &amp;&amp;</span></CodeLine>
<Link id="l09974" /><CodeLine lineNumber="9974"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Trip count and induction variable must have the same type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09975" /><CodeLine lineNumber="9975"></CodeLine>
<Link id="l09976" /><CodeLine lineNumber="9976"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CmpI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CmpInst&gt;</a>(&amp;Cond-&gt;front());</span></CodeLine>
<Link id="l09977" /><CodeLine lineNumber="9977"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CmpI-&gt;getPredicate() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">CmpInst::ICMP&#95;ULT</a> &amp;&amp;</span></CodeLine>
<Link id="l09978" /><CodeLine lineNumber="9978"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Exit condition must be a signed less-than comparison&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09979" /><CodeLine lineNumber="9979"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CmpI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == IndVar &amp;&amp;</span></CodeLine>
<Link id="l09980" /><CodeLine lineNumber="9980"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Exit condition must compare the induction variable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09981" /><CodeLine lineNumber="9981"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CmpI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) == TripCount &amp;&amp;</span></CodeLine>
<Link id="l09982" /><CodeLine lineNumber="9982"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Exit condition must compare with the trip count&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09983" /><CodeLine lineNumber="9983"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l09984" /><CodeLine lineNumber="9984"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09985" /><CodeLine lineNumber="9985"></CodeLine>
<Link id="l09986" /><CodeLine lineNumber="9986" lineLink="/docs/api/classes/llvm/canonicalloopinfo/#a9ce55b05f8ad85126fc92eeeb35457c7"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/canonicalloopinfo/#a9ce55b05f8ad85126fc92eeeb35457c7">CanonicalLoopInfo::invalidate</a>() &#123;</span></CodeLine>
<Link id="l09987" /><CodeLine lineNumber="9987"><span class="doxyHighlight">  Header = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09988" /><CodeLine lineNumber="9988"><span class="doxyHighlight">  Cond = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09989" /><CodeLine lineNumber="9989"><span class="doxyHighlight">  Latch = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09990" /><CodeLine lineNumber="9990"><span class="doxyHighlight">  Exit = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09991" /><CodeLine lineNumber="9991"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
