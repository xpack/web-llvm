---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `SimplifyIndVar.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/Utils/SimplifyIndVar.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/simplifyindvar-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looputils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/ScalarEvolutionExpander.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/scalarevolutionexpander-h"
  isLocal="true" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-simplifyindvar-cpp-">anonymous&#123;SimplifyIndVar.cpp&#125;</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/llvm">llvm</a></>}>
This is an optimization pass for GlobalISel generic memory operations. <a href="/docs/api/namespaces/llvm/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar">SimplifyIndvar</a></>}>
This is a utility for simplifying induction variables based on <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a>. <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv">WidenIV</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">NarrowIVDefUse</a></>}>
<a href="/docs/api/classes/llvm/record">Record</a> a link in the Narrow IV def-use chain along with the WideIV that computes the same value as the Narrow IV def. <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop">BinaryOp</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a61b5cb822ee8e25eee3418a520337962">findCommonDominator</a> (ArrayRef&lt; Instruction &#42; &gt; Instructions, DominatorTree &amp;DT)</>}>
Find a point in code which dominates all given instructions. <a href="#a61b5cb822ee8e25eee3418a520337962">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a995c9f54308d436b9046a8741b149671">getInsertPointForUses</a> (Instruction &#42;User, Value &#42;Def, DominatorTree &#42;DT, LoopInfo &#42;LI)</>}>
Determine the insertion point for this user. <a href="#a995c9f54308d436b9046a8741b149671">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;</>}
  name={<><a href="#a1869a16772f9088e7536b3488405a066">GetLoopInvariantInsertPosition</a> (Loop &#42;L, Instruction &#42;Hint)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3e219df8a1368668aa0aac77616a4ce9">isSimpleIVUser</a> (Instruction &#42;I, const Loop &#42;L, ScalarEvolution &#42;SE)</>}>
Return true if this instruction generates a simple <a href="/docs/api/classes/llvm/scev">SCEV</a> expression in terms of that IV. <a href="#a3e219df8a1368668aa0aac77616a4ce9">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; BinaryOp &gt;</>}
  name={<><a href="#aae7060f1dababae7ea60ae22eb9e9c6b">matchBinaryOp</a> (Instruction &#42;Op)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a878e62c5d5dbc2eba5a23597d9d806c2">STATISTIC</a> (NumElimIdentity, &quot;Number of IV identities eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a958f32850a8811206537c461ff8c4313">STATISTIC</a> (NumElimOperand, &quot;Number of IV operands folded into a use&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a9ea320b561fc86b369f98970c8f6c32f">STATISTIC</a> (NumFoldedUser, &quot;Number of IV users folded into a constant&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ada12d034147fb82ceac12398af5b97b7">STATISTIC</a> (NumElimRem, &quot;Number of IV remainder operations eliminated&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ae9528d718152c531b7d0640b108012b3">STATISTIC</a> (NumSimplifiedSDiv, &quot;Number of IV signed division operations converted to unsigned division&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a919d79e2f8928b438dd1313b4b6ae2ef">STATISTIC</a> (NumSimplifiedSRem, &quot;Number of IV signed remainder operations converted to unsigned remainder&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac43dd2255f015cc6a89b9b9cb6e02ab4">STATISTIC</a> (NumElimCmp, &quot;Number of IV comparisons eliminated&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;indvars&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### findCommonDominator() {#a61b5cb822ee8e25eee3418a520337962}

<MemberDefinition
  prototype={<>static Instruction &#42; findCommonDominator (<a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &gt; Instructions, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp; DT)</>}
  labels = {["static"]}>
Find a point in code which dominates all given instructions.

We can safely assume that, whatever fact we can prove at the found point, this fact is also true for each of the given instructions.

Definition at line <a href="#l00116">116</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

### getInsertPointForUses() {#a995c9f54308d436b9046a8741b149671}

<MemberDefinition
  prototype={<>static Instruction &#42; getInsertPointForUses (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; User, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Def, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI)</>}
  labels = {["static"]}>
Determine the insertion point for this user.

By default, insert immediately before the user. <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> or LICM will hoist loop invariants out of the loop. For PHI nodes, there may be multiple uses, so compute the nearest common dominator for the incoming blocks. A nullptr can be returned if no viable location is found: it may happen if <a href="/docs/api/classes/llvm/user">User</a> is a PHI and Def only comes to this PHI from unreachable blocks.

Definition at line <a href="#l01180">1180</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

### GetLoopInvariantInsertPosition() {#a1869a16772f9088e7536b3488405a066}

<MemberDefinition
  prototype={<>static Instruction &#42; GetLoopInvariantInsertPosition (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Hint)</>}
  labels = {["static"]}>

Definition at line <a href="#l00629">629</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

### isSimpleIVUser() {#a3e219df8a1368668aa0aac77616a4ce9}

<MemberDefinition
  prototype={<>static bool isSimpleIVUser (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42; SE)</>}
  labels = {["static"]}>
Return true if this instruction generates a simple <a href="/docs/api/classes/llvm/scev">SCEV</a> expression in terms of that IV.

This is similar to <a href="/docs/api/classes/llvm/ivusers">IVUsers</a>&#39; <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a5a81ec50ef587462736e1ba010fab186">isInteresting()</a> but processes each instruction non-recursively when the operand is already known to be a simpleIVUser.

Definition at line <a href="#l00884">884</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

### matchBinaryOp() {#aae7060f1dababae7ea60ae22eb9e9c6b}

<MemberDefinition
  prototype={<>static std::optional&lt; BinaryOp &gt; matchBinaryOp (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Op)</>}
  labels = {["static"]}>

Definition at line <a href="#l01426">1426</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a878e62c5d5dbc2eba5a23597d9d806c2}

<MemberDefinition
  prototype={<>STATISTIC (NumElimIdentity, &quot;Number of <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> identities eliminated&quot;)</>}>

Definition at line <a href="#l00036">36</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a958f32850a8811206537c461ff8c4313}

<MemberDefinition
  prototype={<>STATISTIC (NumElimOperand, &quot;Number of <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> operands folded into a use&quot;)</>}>

Definition at line <a href="#l00037">37</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a9ea320b561fc86b369f98970c8f6c32f}

<MemberDefinition
  prototype={<>STATISTIC (NumFoldedUser, &quot;Number of <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#ac2f338c3f467b3d09613e190d73044a5">users</a> folded into a constant&quot;)</>}>

Definition at line <a href="#l00038">38</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ada12d034147fb82ceac12398af5b97b7}

<MemberDefinition
  prototype={<>STATISTIC (NumElimRem, &quot;Number of <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> remainder <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/sioptimizeexecmasking-cpp/#a41f299460d380acb533b0d91dca4d45a">operations</a> eliminated&quot;)</>}>

Definition at line <a href="#l00039">39</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ae9528d718152c531b7d0640b108012b3}

<MemberDefinition
  prototype={<>STATISTIC (NumSimplifiedSDiv, &quot;Number of <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> signed division <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/sioptimizeexecmasking-cpp/#a41f299460d380acb533b0d91dca4d45a">operations</a> converted to unsigned division&quot;)</>}>

Definition at line <a href="#l00040">40</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a919d79e2f8928b438dd1313b4b6ae2ef}

<MemberDefinition
  prototype={<>STATISTIC (NumSimplifiedSRem, &quot;Number of <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> signed remainder <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/sioptimizeexecmasking-cpp/#a41f299460d380acb533b0d91dca4d45a">operations</a> converted to unsigned remainder&quot;)</>}>

Definition at line <a href="#l00043">43</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac43dd2255f015cc6a89b9b9cb6e02ab4}

<MemberDefinition
  prototype={<>STATISTIC (NumElimCmp, &quot;Number of <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> comparisons eliminated&quot;)</>}>

Definition at line <a href="#l00046">46</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;indvars&quot;</>}>

Definition at line <a href="#l00034">34</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/simplifyindvar-cpp">SimplifyIndVar.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===-- SimplifyIndVar.cpp - Induction variable simplification ------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This file implements induction variable simplification. It does</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// not define any actual pass or policy, but provides a single function to</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">// simplify a loop&#39;s induction variables based on ScalarEvolution.</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/simplifyindvar-h">llvm/Transforms/Utils/SimplifyIndVar.h</a>&quot;</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h">llvm/Analysis/LoopInfo.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looputils-h">llvm/Transforms/Utils/LoopUtils.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/scalarevolutionexpander-h">llvm/Transforms/Utils/ScalarEvolutionExpander.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;indvars&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36" lineLink="#a878e62c5d5dbc2eba5a23597d9d806c2"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumElimIdentity, </span><span class="doxyHighlightStringLiteral">&quot;Number of IV identities eliminated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37" lineLink="#a958f32850a8811206537c461ff8c4313"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumElimOperand,  </span><span class="doxyHighlightStringLiteral">&quot;Number of IV operands folded into a use&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38" lineLink="#a9ea320b561fc86b369f98970c8f6c32f"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumFoldedUser, </span><span class="doxyHighlightStringLiteral">&quot;Number of IV users folded into a constant&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39" lineLink="#ada12d034147fb82ceac12398af5b97b7"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumElimRem     , </span><span class="doxyHighlightStringLiteral">&quot;Number of IV remainder operations eliminated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40" lineLink="#ae9528d718152c531b7d0640b108012b3"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlight">    NumSimplifiedSDiv,</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;Number of IV signed division operations converted to unsigned division&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43" lineLink="#a919d79e2f8928b438dd1313b4b6ae2ef"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlight">    NumSimplifiedSRem,</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;Number of IV signed remainder operations converted to unsigned remainder&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46" lineLink="#ac43dd2255f015cc6a89b9b9cb6e02ab4"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumElimCmp     , </span><span class="doxyHighlightStringLiteral">&quot;Number of IV comparisons eliminated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48" lineLink="/docs/api/namespaces/anonymous-simplifyindvar-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightComment">  /// This is a utility for simplifying induction variables</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightComment">  /// based on ScalarEvolution. It is the primary instrument of the</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightComment">  /// IndvarSimplify pass, but it may also be directly invoked to cleanup after</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightComment">  /// other loop passes that preserve SCEV.</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ae9927ff53dcde314a02563533fd811b6">SimplifyIndvar</a> &#123;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loop">Loop</a>             &#42;L;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a>         &#42;LI;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a>  &#42;SE;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a>    &#42;DT;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a>     &amp;Rewriter;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;DeadInsts;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Changed = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RunUnswitching = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ae9927ff53dcde314a02563533fd811b6"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ae9927ff53dcde314a02563533fd811b6">SimplifyIndvar</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/loop">Loop</a>, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlight">                   <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI,</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlight">                   <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;Rewriter,</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlight">                   <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;Dead)</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">        : L(<a href="/docs/api/classes/llvm/loop">Loop</a>), LI(LI), SE(SE), DT(DT), TTI(TTI), Rewriter(Rewriter),</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlight">          DeadInsts(Dead) &#123;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;IV simplification requires LoopInfo&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ab034f8c7eb931424cbc2a9749f8356ab"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ab034f8c7eb931424cbc2a9749f8356ab">hasChanged</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Changed; &#125;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a018e1ba64d8ecb5b3a8a9c95cfd331da"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a018e1ba64d8ecb5b3a8a9c95cfd331da">runUnswitching</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RunUnswitching; &#125;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightComment">    /// Iteratively perform simplification on a worklist of users of the</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlightComment">    /// specified induction variable. This is the top-level driver that applies</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightComment">    /// all simplifications to users of an IV.</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> simplifyUsers(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;CurrIV, <a href="/docs/api/classes/llvm/ivvisitor">IVVisitor</a> &#42;V = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> pushIVUsers(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Def,</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 16&gt;</a> &amp;Simplified,</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;Instruction &#42;, Instruction &#42;&gt;&gt;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlight">                         &amp;SimpleIVUsers);</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;foldIVUser(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseInst, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand);</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> eliminateIdentitySCEV(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseInst, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand);</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> replaceIVUserWithLoopInvariant(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseInst);</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> replaceFloatIVWithIntegerIV(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseInst);</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> eliminateOverflowIntrinsic(<a href="/docs/api/classes/llvm/withoverflowinst">WithOverflowInst</a> &#42;WO);</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> eliminateSaturatingIntrinsic(<a href="/docs/api/classes/llvm/saturatinginst">SaturatingInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> eliminateTrunc(<a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &#42;TI);</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> eliminateIVUser(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseInst, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand);</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> makeIVComparisonInvariant(<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICmp, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand);</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> eliminateIVComparison(<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICmp, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand);</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> simplifyIVRemainder(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Rem, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand,</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSigned);</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> replaceRemWithNumerator(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Rem);</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> replaceRemWithNumeratorOrZero(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Rem);</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> replaceSRemWithURem(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Rem);</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> eliminateSDiv(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;SDiv);</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> strengthenBinaryOp(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand);</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> strengthenOverflowingOperation(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;OBO,</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand);</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> strengthenRightShift(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand);</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlightComment">/// Find a point in code which dominates all given instructions. We can safely</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlightComment">/// assume that, whatever fact we can prove at the found point, this fact is</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlightComment">/// also true for each of the given instructions.</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116" lineLink="#a61b5cb822ee8e25eee3418a520337962"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a61b5cb822ee8e25eee3418a520337962">findCommonDominator</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Instruction &#42;&gt;</a> Instructions,</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT) &#123;</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CommonDom = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a> : Instructions)</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlight">    CommonDom =</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">        CommonDom ? DT.<a href="/docs/api/classes/llvm/dominatortree/#a2ec50ab2c78eff965caf3da71cd08be4">findNearestCommonDominator</a>(CommonDom, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>) : <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CommonDom &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Common dominator not found?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CommonDom;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlightComment">/// Fold an IV operand into its use.  This removes increments of an</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlightComment">/// aligned IV when used by a instruction that ignores the low bits.</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlightComment">/// IVOperand is guaranteed SCEVable, but UseInst may not be.</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlightComment">/// Return the operand of IVOperand for this induction variable if IVOperand can</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlightComment">/// be folded (in case more folding opportunities have been exposed).</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlightComment">/// Otherwise return null.</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a12f6125cdd608cb0459585ddb68ead53"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a12f6125cdd608cb0459585ddb68ead53">SimplifyIndvar::foldIVUser</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseInst, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand) &#123;</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;IVSrc = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OperIdx = 0;</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;FoldedExpr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MustDropExactFlag = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (UseInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>()) &#123;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::UDiv:</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::LShr:</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We&#39;re only interested in the case where we know something about</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the numerator and have a constant denominator.</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IVOperand != UseInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(OperIdx) ||</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">        !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(UseInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)))</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Attempt to fold a binary operator with constant operand.</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// e.g. ((I + 1) &gt;&gt; 2) =&gt; I &gt;&gt; 2</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BinaryOperator&gt;</a>(IVOperand)</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">        || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(IVOperand-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1)))</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">    IVSrc = IVOperand-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// IVSrc must be the (SCEVable) IV, since the other operand is const.</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SE-&gt;isSCEVable(IVSrc-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expect SCEVable IV operand&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(UseInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::LShr) &#123;</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Get a constant for the divisor. See createSCEV.</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">      uint32&#95;t <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(UseInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())-&gt;getBitWidth();</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;getValue().uge(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>))</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = ConstantInt::get(UseInst-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(),</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/apint/#aec662ee6ab1490a4cabebf2812e5b9ca">APInt::getOneBitSet</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>-&gt;getZExtValue()));</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;LHS = SE-&gt;getSCEV(IVSrc);</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;RHS = SE-&gt;getSCEV(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>);</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">    FoldedExpr = SE-&gt;getUDivExpr(LHS, RHS);</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We might have &#39;exact&#39; flag set at this point which will no longer be</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// correct after we make the replacement.</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a689a03df5b4ae094d6a3a1bd13dac574">isExact</a>() &amp;&amp; LHS != SE-&gt;getMulExpr(FoldedExpr, RHS))</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">      MustDropExactFlag = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We have something that might fold it&#39;s operand. Compare SCEVs.</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;isSCEVable(UseInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Bypass the operand if SCEV can prove it has no effect.</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;getSCEV(UseInst) != FoldedExpr)</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Eliminated IV operand: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;IVOperand</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; -&gt; &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;UseInst &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">  UseInst-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(OperIdx, IVSrc);</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SE-&gt;getSCEV(UseInst) == FoldedExpr &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;bad SCEV with folded oper&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MustDropExactFlag)</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">    UseInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ad4613def4002aa69721553e567ca4187">dropPoisonGeneratingFlags</a>();</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">  ++NumElimOperand;</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">  Changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IVOperand-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">    DeadInsts.emplace&#95;back(IVOperand);</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IVSrc;</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a304f0837129322608c9e0384d193a0ba"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a304f0837129322608c9e0384d193a0ba">SimplifyIndvar::makeIVComparisonInvariant</a>(<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICmp,</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand) &#123;</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Preheader = L-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Preheader)</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IVOperIdx = 0;</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = ICmp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>();</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IVOperand != ICmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)) &#123;</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Swapped</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IVOperand == ICmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t find IVOperand&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    IVOperIdx = 1;</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a49a2d8f483ea08a3d6ea75f90c640d76">ICmpInst::getSwappedPredicate</a>(Pred);</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the SCEVs for the ICmp operands (in the specific context of the</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// current loop)</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;ICmpLoop = LI-&gt;getLoopFor(ICmp-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;S = SE-&gt;getSCEVAtScope(ICmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(IVOperIdx), ICmpLoop);</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = SE-&gt;getSCEVAtScope(ICmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1 - IVOperIdx), ICmpLoop);</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> LIP = SE-&gt;getLoopInvariantPredicate(Pred, S, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, L, ICmp);</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LIP)</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> InvariantPredicate = LIP-&gt;Pred;</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;InvariantLHS = LIP-&gt;LHS;</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;InvariantRHS = LIP-&gt;RHS;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not generate something ridiculous.</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PHTerm = Preheader-&gt;getTerminator();</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Rewriter.isHighCostExpansion(&#123;InvariantLHS, InvariantRHS&#125;, L,</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">                                   2 &#42; <a href="/docs/api/namespaces/llvm/#a837209d51e75f7afcfdf457b20e59493">SCEVCheapExpansionBudget</a>, TTI, PHTerm) ||</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">      !Rewriter.isSafeToExpandAt(InvariantLHS, PHTerm) ||</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">      !Rewriter.isSafeToExpandAt(InvariantRHS, PHTerm))</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewLHS =</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">      Rewriter.expandCodeFor(InvariantLHS, IVOperand-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), PHTerm);</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewRHS =</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">      Rewriter.expandCodeFor(InvariantRHS, IVOperand-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), PHTerm);</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Simplified comparison: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;ICmp &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">  ICmp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#a126a12b67fa620ad28ec0c919ca7a3e8">setPredicate</a>(InvariantPredicate);</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">  ICmp-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, NewLHS);</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">  ICmp-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, NewRHS);</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">  RunUnswitching = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlightComment">/// SimplifyIVUsers helper for eliminating useless</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlightComment">/// comparisons against an induction variable.</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#acccaf0eaeef2b860b1182f8985f59e94"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#acccaf0eaeef2b860b1182f8985f59e94">SimplifyIndvar::eliminateIVComparison</a>(<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICmp,</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand) &#123;</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IVOperIdx = 0;</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = ICmp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>();</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> OriginalPred = Pred;</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IVOperand != ICmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)) &#123;</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Swapped</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IVOperand == ICmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t find IVOperand&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">    IVOperIdx = 1;</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#a49a2d8f483ea08a3d6ea75f90c640d76">ICmpInst::getSwappedPredicate</a>(Pred);</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the SCEVs for the ICmp operands (in the specific context of the</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// current loop)</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;ICmpLoop = LI-&gt;getLoopFor(ICmp-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;S = SE-&gt;getSCEVAtScope(ICmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(IVOperIdx), ICmpLoop);</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> = SE-&gt;getSCEVAtScope(ICmp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1 - IVOperIdx), ICmpLoop);</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the condition is always true or always false in the given context,</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// replace it with a constant value.</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>;</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : ICmp-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.push&#95;back(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U));</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CtxI = <a href="#a61b5cb822ee8e25eee3418a520337962">findCommonDominator</a>(<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>, &#42;DT);</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Ev = SE-&gt;evaluatePredicateAt(Pred, S, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, CtxI)) &#123;</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">    SE-&gt;forgetValue(ICmp);</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">    ICmp-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/constantint/#afe7d477c6022fe7123b90e3b39c58e69">ConstantInt::getBool</a>(ICmp-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), &#42;Ev));</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">    DeadInsts.emplace&#95;back(ICmp);</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Eliminated comparison: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;ICmp &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a304f0837129322608c9e0384d193a0ba">makeIVComparisonInvariant</a>(ICmp, IVOperand)) &#123;</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// fallthrough to end of function</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/cmpinst/#a3712279d70deeec90a93db09deb12d02">ICmpInst::isSigned</a>(OriginalPred) &amp;&amp;</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">             SE-&gt;isKnownNonNegative(S) &amp;&amp; SE-&gt;isKnownNonNegative(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>)) &#123;</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we were unable to make anything above, all we can is to canonicalize</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the comparison hoping that it will open the doors for other</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// optimizations. If we find out that we compare two non-negative values,</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we turn the instruction&#39;s predicate to its unsigned version. Note that</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we cannot rely on Pred here unless we check if we have swapped it.</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ICmp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>() == OriginalPred &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Predicate changed?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Turn to unsigned comparison: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;ICmp</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">    ICmp-&gt;<a href="/docs/api/classes/llvm/cmpinst/#a126a12b67fa620ad28ec0c919ca7a3e8">setPredicate</a>(<a href="/docs/api/classes/llvm/icmpinst/#af07a09f1cda33d984cc725dc9e856d40">ICmpInst::getUnsignedPredicate</a>(OriginalPred));</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">  ++NumElimCmp;</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">  Changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a664aaf46532d6ebeed0dfeb704308d33"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a664aaf46532d6ebeed0dfeb704308d33">SimplifyIndvar::eliminateSDiv</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;SDiv) &#123;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the SCEVs for the ICmp operands.</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = SE-&gt;getSCEV(SDiv-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = SE-&gt;getSCEV(SDiv-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Simplify unnecessary loops away.</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI-&gt;getLoopFor(SDiv-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = SE-&gt;getSCEVAtScope(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, L);</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = SE-&gt;getSCEVAtScope(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, L);</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace sdiv by udiv if both of the operands are non-negative</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;isKnownNonNegative(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>) &amp;&amp; SE-&gt;isKnownNonNegative(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>)) &#123;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UDiv = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">        BinaryOperator::UDiv, SDiv-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), SDiv-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1),</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">        SDiv-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.udiv&quot;</span><span class="doxyHighlight">, SDiv-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">    UDiv-&gt;setIsExact(SDiv-&gt;<a href="/docs/api/classes/llvm/instruction/#a689a03df5b4ae094d6a3a1bd13dac574">isExact</a>());</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">    SDiv-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(UDiv);</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">    UDiv-&gt;setDebugLoc(SDiv-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Simplified sdiv: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;SDiv &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">    ++NumSimplifiedSDiv;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">    Changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">    DeadInsts.push&#95;back(SDiv);</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlightComment">// i %s n -&gt; i %u n if i &gt;= 0 and n &gt;= 0</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a8a96c9b1143670a73852464de9950e8e"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a8a96c9b1143670a73852464de9950e8e">SimplifyIndvar::replaceSRemWithURem</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Rem) &#123;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = Rem-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = Rem-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;URem = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(BinaryOperator::URem, <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>,</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">                                      Rem-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.urem&quot;</span><span class="doxyHighlight">, Rem-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">  Rem-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(URem);</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  URem-&gt;setDebugLoc(Rem-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Simplified srem: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Rem &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">  ++NumSimplifiedSRem;</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">  Changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">  DeadInsts.emplace&#95;back(Rem);</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlightComment">// i % n  --&gt;  i  if i is in &#91;0,n).</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ad4ea440b89ee11cd2aaecfd52290e069"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ad4ea440b89ee11cd2aaecfd52290e069">SimplifyIndvar::replaceRemWithNumerator</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Rem) &#123;</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">  Rem-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Rem-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Simplified rem: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Rem &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">  ++NumElimRem;</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">  Changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  DeadInsts.emplace&#95;back(Rem);</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlightComment">// (i+1) % n  --&gt;  (i+1)==n?0:(i+1)  if i is in &#91;0,n).</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a645f6e970e94d7ca51922b3932338f51"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a645f6e970e94d7ca51922b3932338f51">SimplifyIndvar::replaceRemWithNumeratorOrZero</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Rem) &#123;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;T = Rem-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = Rem-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = Rem-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICmp = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a>(Rem-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>(), <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>, <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>);</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;Sel =</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/selectinst/#a09d8760fa31a7b8739acf71a4d2ac9d9">SelectInst::Create</a>(ICmp, ConstantInt::get(T, 0), <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, </span><span class="doxyHighlightStringLiteral">&quot;iv.rem&quot;</span><span class="doxyHighlight">, Rem-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">  Rem-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Sel);</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">  Sel-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(Rem-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Simplified rem: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Rem &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">  ++NumElimRem;</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">  Changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">  DeadInsts.emplace&#95;back(Rem);</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlightComment">/// SimplifyIVUsers helper for eliminating useless remainder operations</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlightComment">/// operating on an induction variable or replacing srem by urem.</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a9a4e22418fd040f349bdecefdc303c2e"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a9a4e22418fd040f349bdecefdc303c2e">SimplifyIndvar::simplifyIVRemainder</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Rem,</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand,</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">                                         </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSigned) &#123;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NValue = Rem-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DValue = Rem-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We&#39;re only interested in the case where we know something about</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the numerator, unless it is a srem, because we want to replace srem by urem</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in general.</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UsedAsNumerator = IVOperand == NValue;</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UsedAsNumerator &amp;&amp; !IsSigned)</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = SE-&gt;getSCEV(NValue);</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Simplify unnecessary loops away.</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;ICmpLoop = LI-&gt;getLoopFor(Rem-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = SE-&gt;getSCEVAtScope(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, ICmpLoop);</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNumeratorNonNegative = !IsSigned || SE-&gt;isKnownNonNegative(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>);</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not proceed if the Numerator may be negative</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsNumeratorNonNegative)</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = SE-&gt;getSCEV(DValue);</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a> = SE-&gt;getSCEVAtScope(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>, ICmpLoop);</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedAsNumerator) &#123;</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> LT = IsSigned ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba15ae464950ac676919c2f0c7aafc706c">ICmpInst::ICMP&#95;SLT</a> : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;isKnownPredicate(LT, <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>)) &#123;</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ad4ea440b89ee11cd2aaecfd52290e069">replaceRemWithNumerator</a>(Rem);</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;T = Rem-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;NLessOne = SE-&gt;getMinusSCEV(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, SE-&gt;getOne(T));</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;isKnownPredicate(LT, NLessOne, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>)) &#123;</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a645f6e970e94d7ca51922b3932338f51">replaceRemWithNumeratorOrZero</a>(Rem);</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to replace SRem with URem, if both N and D are known non-negative.</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Since we had already check N, we only need to check D now</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsSigned || !SE-&gt;isKnownNonNegative(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a6a9f043784cf87001c84980afa76da82">D</a>))</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a8a96c9b1143670a73852464de9950e8e">replaceSRemWithURem</a>(Rem);</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a5a706e35559bb3deb6e92a8ac4bfe1e8"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a5a706e35559bb3deb6e92a8ac4bfe1e8">SimplifyIndvar::eliminateOverflowIntrinsic</a>(<a href="/docs/api/classes/llvm/withoverflowinst">WithOverflowInst</a> &#42;WO) &#123;</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;LHS = SE-&gt;getSCEV(WO-&gt;<a href="/docs/api/classes/llvm/binaryopintrinsic/#abd530ffa05240e0728bf85169dc7abcc">getLHS</a>());</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;RHS = SE-&gt;getSCEV(WO-&gt;<a href="/docs/api/classes/llvm/binaryopintrinsic/#a0583d2d049d59cf53ccfd2b6f4e53c87">getRHS</a>());</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;willNotOverflow(WO-&gt;<a href="/docs/api/classes/llvm/binaryopintrinsic/#aa73e62aac1753cb7b3c3aaccef3df8b1">getBinaryOp</a>(), WO-&gt;<a href="/docs/api/classes/llvm/binaryopintrinsic/#a814f3097eebe0236748fcc2ab5ce59d5">isSigned</a>(), LHS, RHS))</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Proved no overflow, nuke the overflow check and, if possible, the overflow</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// intrinsic as well.</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;NewResult = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">      WO-&gt;<a href="/docs/api/classes/llvm/binaryopintrinsic/#aa73e62aac1753cb7b3c3aaccef3df8b1">getBinaryOp</a>(), WO-&gt;<a href="/docs/api/classes/llvm/binaryopintrinsic/#abd530ffa05240e0728bf85169dc7abcc">getLHS</a>(), WO-&gt;<a href="/docs/api/classes/llvm/binaryopintrinsic/#a0583d2d049d59cf53ccfd2b6f4e53c87">getRHS</a>(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, WO-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WO-&gt;<a href="/docs/api/classes/llvm/binaryopintrinsic/#a814f3097eebe0236748fcc2ab5ce59d5">isSigned</a>())</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">    NewResult-&gt;<a href="/docs/api/classes/llvm/instruction/#a4166b451a572b1e5d3fea7250af53653">setHasNoSignedWrap</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">    NewResult-&gt;<a href="/docs/api/classes/llvm/instruction/#a0c03b71c79206ec41270dc3788183e0d">setHasNoUnsignedWrap</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ExtractValueInst &#42;, 4&gt;</a> ToDelete;</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : WO-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EVI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ExtractValueInst&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EVI-&gt;getIndices()&#91;0&#93; == 1)</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">        EVI-&gt;replaceAllUsesWith(<a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(WO-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()));</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EVI-&gt;getIndices()&#91;0&#93; == 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Only two possibilities!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">        EVI-&gt;replaceAllUsesWith(NewResult);</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">        NewResult-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(EVI-&gt;getDebugLoc());</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">      ToDelete.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(EVI);</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EVI : ToDelete)</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">    EVI-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WO-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">    WO-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">  Changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ad8629a06eaa190b10f442dd35c1df09a"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ad8629a06eaa190b10f442dd35c1df09a">SimplifyIndvar::eliminateSaturatingIntrinsic</a>(<a href="/docs/api/classes/llvm/saturatinginst">SaturatingInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;LHS = SE-&gt;getSCEV(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getLHS());</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;RHS = SE-&gt;getSCEV(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getRHS());</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;willNotOverflow(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getBinaryOp(), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isSigned(), LHS, RHS))</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getBinaryOp(), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getLHS(), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getRHS(), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getName(), <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getIterator());</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isSigned())</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">    BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a4166b451a572b1e5d3fea7250af53653">setHasNoSignedWrap</a>();</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">    BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a0c03b71c79206ec41270dc3788183e0d">setHasNoUnsignedWrap</a>();</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;replaceAllUsesWith(BO);</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">  BO-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">  DeadInsts.emplace&#95;back(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">  Changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a6f5eb28a130d94e94dff2f9e798617ab"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a6f5eb28a130d94e94dff2f9e798617ab">SimplifyIndvar::eliminateTrunc</a>(<a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &#42;TI) &#123;</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is always legal to replace</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   icmp &lt;pred&gt; i32 trunc(iv), n</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   icmp &lt;pred&gt; i64 sext(trunc(iv)), sext(n), if pred is signed predicate.</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Or with</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   icmp &lt;pred&gt; i64 zext(trunc(iv)), zext(n), if pred is unsigned predicate.</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Or with either of these if pred is an equality predicate.</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we can prove that iv == sext(trunc(iv)) or iv == zext(trunc(iv)) for</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// every comparison which uses trunc, it means that we can replace each of</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them with comparison of iv against sext/zext(n). We no longer need trunc</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// after that.</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Should we do this if we can widen &#42;some&#42; comparisons, but not all</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of them? Sometimes it is enough to enable other optimizations, but the</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// trunc instruction will stay in the loop.</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = TI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;IVTy = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getType();</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;IVSCEV = SE-&gt;getSCEV(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>);</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;TISCEV = SE-&gt;getSCEV(TI);</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if iv == zext(trunc(iv)) and if iv == sext(trunc(iv)). If so, we can</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// get rid of trunc</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DoesSExtCollapse = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DoesZExtCollapse = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IVSCEV == SE-&gt;getSignExtendExpr(TISCEV, IVTy))</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">    DoesSExtCollapse = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IVSCEV == SE-&gt;getZeroExtendExpr(TISCEV, IVTy))</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">    DoesZExtCollapse = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If neither sext nor zext does collapse, it is not profitable to do any</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// transform. Bail.</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DoesSExtCollapse &amp;&amp; !DoesZExtCollapse)</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect users of the trunc that look like comparisons against invariants.</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Bail if we find something different.</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ICmpInst &#42;, 4&gt;</a> ICmpUsers;</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : TI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We don&#39;t care about users in unreachable blocks.</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(U) &amp;&amp;</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">        !DT-&gt;isReachableFromEntry(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)-&gt;getParent()))</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(U);</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ICI) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L-&gt;contains(ICI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;LCSSA form broken?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!(ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == TI &amp;&amp; L-&gt;isLoopInvariant(ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))) &amp;&amp;</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">        !(ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) == TI &amp;&amp; L-&gt;isLoopInvariant(ICI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0))))</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we cannot get rid of trunc, bail.</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICI-&gt;<a href="/docs/api/classes/llvm/cmpinst/#a3712279d70deeec90a93db09deb12d02">isSigned</a>() &amp;&amp; !DoesSExtCollapse)</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICI-&gt;<a href="/docs/api/classes/llvm/cmpinst/#af206a3d6f58d9e53b074460f0d1ecb86">isUnsigned</a>() &amp;&amp; !DoesZExtCollapse)</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For equality, either signed or unsigned works.</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">    ICmpUsers.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ICI);</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CanUseZExt = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICI) &#123;</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Unsigned comparison can be widened as unsigned.</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICI-&gt;isUnsigned())</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Is it profitable to do zext?</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DoesZExtCollapse)</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For equality, we can safely zext both parts.</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ICI-&gt;isEquality())</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise we can only use zext when comparing two non-negative or two</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// negative values. But in practice, we will never pass DoesZExtCollapse</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// check for a negative value, because zext(trunc(x)) is non-negative. So</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it only make sense to check for non-negativity here.</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;SCEVOP1 = SE-&gt;getSCEV(ICI-&gt;getOperand(0));</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;SCEVOP2 = SE-&gt;getSCEV(ICI-&gt;getOperand(1));</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SE-&gt;isKnownNonNegative(SCEVOP1) &amp;&amp; SE-&gt;isKnownNonNegative(SCEVOP2);</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace all comparisons against trunc with comparisons against IV.</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ICI : ICmpUsers) &#123;</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSwapped = L-&gt;isLoopInvariant(ICI-&gt;getOperand(0));</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Op1 = IsSwapped ? ICI-&gt;getOperand(0) : ICI-&gt;getOperand(1);</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(ICI);</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Ext = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For signed/unsigned predicate, replace the old comparison with comparison</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of immediate IV against sext/zext of the invariant argument. If we can</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// use either sext or zext (i.e. we are dealing with equality predicate),</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// then prefer zext as a more canonical form.</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: If we see a signed comparison which can be turned into unsigned,</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we can do it here for canonicalization purposes.</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = ICI-&gt;getPredicate();</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSwapped) Pred = <a href="/docs/api/classes/llvm/cmpinst/#a49a2d8f483ea08a3d6ea75f90c640d76">ICmpInst::getSwappedPredicate</a>(Pred);</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CanUseZExt(ICI)) &#123;</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DoesZExtCollapse &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unprofitable zext?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">      Ext = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9e6950f7f17700d5c0d61ad0b846ec5c">CreateZExt</a>(Op1, IVTy, </span><span class="doxyHighlightStringLiteral">&quot;zext&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">      Pred = <a href="/docs/api/classes/llvm/icmpinst/#af07a09f1cda33d984cc725dc9e856d40">ICmpInst::getUnsignedPredicate</a>(Pred);</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DoesSExtCollapse &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unprofitable sext?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">      Ext = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5253081f40ffcad9c0e8ba6a5c437006">CreateSExt</a>(Op1, IVTy, </span><span class="doxyHighlightStringLiteral">&quot;sext&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Pred == <a href="/docs/api/classes/llvm/icmpinst/#a9d5f70171d811078c4d263811f13c121">ICmpInst::getSignedPredicate</a>(Pred) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Must be signed!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Changed;</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">    L-&gt;makeLoopInvariant(Ext, Changed);</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">    (void)Changed;</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewCmp = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae0bd6c2fab2d18443038a8f3a2b64856">CreateICmp</a>(Pred, <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, Ext);</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">    ICI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewCmp);</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">    DeadInsts.emplace&#95;back(ICI);</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Trunc no longer needed.</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">  TI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(TI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">  DeadInsts.emplace&#95;back(TI);</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlightComment">/// Eliminate an operation that consumes a simple IV and has no observable</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlightComment">/// side-effect given the range of IV values.  IVOperand is guaranteed SCEVable,</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlightComment">/// but UseInst may not be.</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a08427a7d29ad22c694e5447d0d0adf4a"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a08427a7d29ad22c694e5447d0d0adf4a">SimplifyIndvar::eliminateIVUser</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseInst,</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand) &#123;</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;ICmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(UseInst)) &#123;</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#acccaf0eaeef2b860b1182f8985f59e94">eliminateIVComparison</a>(ICmp, IVOperand);</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;<a href="/docs/api/namespaces/llvm/#a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3">Bin</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(UseInst)) &#123;</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSRem = <a href="/docs/api/namespaces/llvm/#a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3">Bin</a>-&gt;getOpcode() == Instruction::SRem;</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsSRem || <a href="/docs/api/namespaces/llvm/#a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3">Bin</a>-&gt;getOpcode() == Instruction::URem) &#123;</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a9a4e22418fd040f349bdecefdc303c2e">simplifyIVRemainder</a>(<a href="/docs/api/namespaces/llvm/#a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3">Bin</a>, IVOperand, IsSRem);</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3">Bin</a>-&gt;getOpcode() == Instruction::SDiv)</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a664aaf46532d6ebeed0dfeb704308d33">eliminateSDiv</a>(<a href="/docs/api/namespaces/llvm/#a372f87e2cac1c83389c98554dc44806da807dbe7d1c25a633894d4a231b1c76d3">Bin</a>);</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;WithOverflowInst&gt;</a>(UseInst))</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a5a706e35559bb3deb6e92a8ac4bfe1e8">eliminateOverflowIntrinsic</a>(WO))</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SaturatingInst&gt;</a>(UseInst))</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ad8629a06eaa190b10f442dd35c1df09a">eliminateSaturatingIntrinsic</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>))</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;TI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;TruncInst&gt;</a>(UseInst))</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a6f5eb28a130d94e94dff2f9e798617ab">eliminateTrunc</a>(TI))</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ae45f11045718186c0300d34919228c2a">eliminateIdentitySCEV</a>(UseInst, IVOperand))</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629" lineLink="#a1869a16772f9088e7536b3488405a066"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a1869a16772f9088e7536b3488405a066">GetLoopInvariantInsertPosition</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Hint) &#123;</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB = L-&gt;getLoopPreheader())</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BB-&gt;getTerminator();</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Hint;</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlightComment">/// Replace the UseInst with a loop invariant expression if it is safe.</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a287ee23f262c0a9deb16096da9d34e7a"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a287ee23f262c0a9deb16096da9d34e7a">SimplifyIndvar::replaceIVUserWithLoopInvariant</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;isSCEVable(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()))</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the symbolic expression for this instruction.</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;S = SE-&gt;getSCEV(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;isLoopInvariant(S, L))</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not generate something ridiculous even if S is loop invariant.</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Rewriter.isHighCostExpansion(S, L, <a href="/docs/api/namespaces/llvm/#a837209d51e75f7afcfdf457b20e59493">SCEVCheapExpansionBudget</a>, TTI, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IP = <a href="#a1869a16772f9088e7536b3488405a066">GetLoopInvariantInsertPosition</a>(L, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Rewriter.isSafeToExpandAt(S, IP)) &#123;</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Can not replace IV user: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a></span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with non-speculable loop invariant: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;S &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Invariant = Rewriter.expandCodeFor(S, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), IP);</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedToEmitLCSSAPhis = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI-&gt;replacementPreservesLCSSAForm(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Invariant))</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">    NeedToEmitLCSSAPhis = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(Invariant);</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Replace IV user: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a></span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with loop invariant: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;S &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedToEmitLCSSAPhis) &#123;</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 1&gt;</a> NeedsLCSSAPhis;</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">    NeedsLCSSAPhis.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Invariant));</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac1c43bfed9a4937c8f7918ac6fb09c56">formLCSSAForInstructions</a>(NeedsLCSSAPhis, &#42;DT, &#42;LI, SE);</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; INDVARS: Replacement breaks LCSSA form&quot;</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; inserting LCSSA Phis&quot;</span><span class="doxyHighlight"> &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">  ++NumFoldedUser;</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">  Changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">  DeadInsts.emplace&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlightComment">/// Eliminate redundant type cast between integer and float.</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a16096e55b9292113f13073fa2343b9c7"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a16096e55b9292113f13073fa2343b9c7">SimplifyIndvar::replaceFloatIVWithIntegerIV</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseInst) &#123;</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() != CastInst::SIToFP &amp;&amp;</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">      UseInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() != CastInst::UIToFP)</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(UseInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the symbolic expression for this instruction.</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = SE-&gt;getSCEV(IVOperand);</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> MaskBits;</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == CastInst::SIToFP)</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">    MaskBits = (int)SE-&gt;getSignedRange(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>).getMinSignedBits();</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">    MaskBits = (int)SE-&gt;getUnsignedRange(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>).getActiveBits();</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> DestNumSigBits = UseInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ad9b99a13e459cb18bb386ddd610ecf8c">getFPMantissaWidth</a>();</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaskBits &lt;= DestNumSigBits) &#123;</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : UseInst-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Match for fptosi/fptoui of sitofp and with same type.</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(U);</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CI)</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">CastInst::CastOps</a> Opcode = CI-&gt;getOpcode();</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opcode != CastInst::FPToSI &amp;&amp; Opcode != CastInst::FPToUI)</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Conv = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IVOperand-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != CI-&gt;getType()) &#123;</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(CI);</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name = IVOperand-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>();</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// To match InstCombine logic, we only need sext if both fptosi and</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// sitofp are used. If one of them is unsigned, then we can use zext.</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;getTypeSizeInBits(IVOperand-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &gt;</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">            SE-&gt;getTypeSizeInBits(CI-&gt;getType())) &#123;</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">          Conv = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(IVOperand, CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), Name + </span><span class="doxyHighlightStringLiteral">&quot;.trunc&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opcode == CastInst::FPToUI ||</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">                   UseInst-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == CastInst::UIToFP) &#123;</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">          Conv = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9e6950f7f17700d5c0d61ad0b846ec5c">CreateZExt</a>(IVOperand, CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), Name + </span><span class="doxyHighlightStringLiteral">&quot;.zext&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">          Conv = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5253081f40ffcad9c0e8ba6a5c437006">CreateSExt</a>(IVOperand, CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), Name + </span><span class="doxyHighlightStringLiteral">&quot;.sext&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">        Conv = IVOperand;</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">      CI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Conv);</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">      DeadInsts.push&#95;back(CI);</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Replace IV user: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;CI</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Conv &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">      ++NumFoldedUser;</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">      Changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Changed;</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlightComment">/// Eliminate any operation that SCEV can prove is an identity function.</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ae45f11045718186c0300d34919228c2a"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ae45f11045718186c0300d34919228c2a">SimplifyIndvar::eliminateIdentitySCEV</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseInst,</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand) &#123;</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;isSCEVable(UseInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) ||</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">      UseInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != IVOperand-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;UseSCEV = SE-&gt;getSCEV(UseInst);</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseSCEV != SE-&gt;getSCEV(IVOperand))</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// getSCEV(X) == getSCEV(Y) does not guarantee that X and Y are related in the</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dominator tree, even if X is an operand to Y.  For instance, in</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %iv = phi i32 &#123;0,+,1&#125;</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     br %cond, label %left, label %merge</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   left:</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %X = add i32 %iv, 0</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     br label %merge</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   merge:</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     %M = phi (%X, %iv)</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// getSCEV(%M) == getSCEV(%X) == &#123;0,+,1&#125;, but %X does not dominate %M, and</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// %M.replaceAllUsesWith(%X) would be incorrect.</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(UseInst))</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If UseInst is not a PHI node then we know that IVOperand dominates</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// UseInst directly from the legality of SSA.</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT || !DT-&gt;dominates(IVOperand, UseInst))</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI-&gt;replacementPreservesLCSSAForm(UseInst, IVOperand))</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure the operand is not more poisonous than the instruction.</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a71a4a4e0f6178682ef05a0d85891e5a9">impliesPoison</a>(IVOperand, UseInst)) &#123;</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;&gt;</a> DropPoisonGeneratingInsts;</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;canReuseInstruction(UseSCEV, IVOperand, DropPoisonGeneratingInsts))</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DropPoisonGeneratingInsts)</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;dropPoisonGeneratingAnnotations();</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Eliminated identity: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;UseInst &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">  SE-&gt;forgetValue(UseInst);</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">  UseInst-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(IVOperand);</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">  ++NumElimIdentity;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">  Changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">  DeadInsts.emplace&#95;back(UseInst);</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a7ef1c9cb26f85c3ef0e39c3b0d6df989"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a7ef1c9cb26f85c3ef0e39c3b0d6df989">SimplifyIndvar::strengthenBinaryOp</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO,</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand) &#123;</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;OverflowingBinaryOperator&gt;</a>(BO) &amp;&amp;</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">          <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ad6315ffed3396dd69c53e1e51cfcd9f6">strengthenOverflowingOperation</a>(BO, IVOperand)) ||</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">         (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ShlOperator&gt;</a>(BO) &amp;&amp; <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a8ff215a6e938a8df32c29c99bc126603">strengthenRightShift</a>(BO, IVOperand));</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlightComment">/// Annotate BO with nsw / nuw if it provably does not signed-overflow /</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlightComment">/// unsigned-overflow.  Returns true if anything changed, false otherwise.</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ad6315ffed3396dd69c53e1e51cfcd9f6"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#ad6315ffed3396dd69c53e1e51cfcd9f6">SimplifyIndvar::strengthenOverflowingOperation</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO,</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">                                                    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand) &#123;</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Flags = SE-&gt;getStrengthenedNoWrapFlagsFromBinOp(</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;OverflowingBinaryOperator&gt;</a>(BO));</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Flags)</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">  BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a0c03b71c79206ec41270dc3788183e0d">setHasNoUnsignedWrap</a>(<a href="/docs/api/classes/llvm/scalarevolution/#adfe987ba0fa56ab9ecdb606c2462b6b9">ScalarEvolution::maskFlags</a>(&#42;Flags, <a href="/docs/api/classes/llvm/scev/#af43000d4dcb7d6d63cb6e36933ed3f6faafb62cd6afdc004ef6e8a1f6288eb382">SCEV::FlagNUW</a>) ==</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/scev/#af43000d4dcb7d6d63cb6e36933ed3f6faafb62cd6afdc004ef6e8a1f6288eb382">SCEV::FlagNUW</a>);</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">  BO-&gt;<a href="/docs/api/classes/llvm/instruction/#a4166b451a572b1e5d3fea7250af53653">setHasNoSignedWrap</a>(<a href="/docs/api/classes/llvm/scalarevolution/#adfe987ba0fa56ab9ecdb606c2462b6b9">ScalarEvolution::maskFlags</a>(&#42;Flags, <a href="/docs/api/classes/llvm/scev/#af43000d4dcb7d6d63cb6e36933ed3f6fa2f7a8775a783f7ea3ad24b3f9cb5d949">SCEV::FlagNSW</a>) ==</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/scev/#af43000d4dcb7d6d63cb6e36933ed3f6fa2f7a8775a783f7ea3ad24b3f9cb5d949">SCEV::FlagNSW</a>);</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The getStrengthenedNoWrapFlagsFromBinOp() check inferred additional nowrap</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// flags on addrecs while performing zero/sign extensions. We could call</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// forgetValue() here to make sure those flags also propagate to any other</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SCEV expressions based on the addrec. However, this can have pathological</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// compile-time impact, see https://bugs.llvm.org/show&#95;bug.cgi?id=50384.</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlightComment">/// Annotate the Shr in (X &lt;&lt; IVOperand) &gt;&gt; C as exact using the</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlightComment">/// information from the IV&#39;s range. Returns true if anything changed, false</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlightComment">/// otherwise.</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a8ff215a6e938a8df32c29c99bc126603"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a8ff215a6e938a8df32c29c99bc126603">SimplifyIndvar::strengthenRightShift</a>(<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO,</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand) &#123;</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BO-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::Shl) &#123;</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Changed = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantrange">ConstantRange</a> IVRange = SE-&gt;getUnsignedRange(SE-&gt;getSCEV(IVOperand));</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : BO-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U,</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">                <a href="/docs/api/namespaces/llvm/patternmatch/#a0c94f3ca4234f78cf22840e79087f3f2">m&#95;AShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(IVOperand)), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))) ||</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(U,</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">                <a href="/docs/api/namespaces/llvm/patternmatch/#ab8546ee1aaa68d6f4990e6241e24464c">m&#95;LShr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(IVOperand)), <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)))) &#123;</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;Shr = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(U);</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Shr-&gt;<a href="/docs/api/classes/llvm/instruction/#a689a03df5b4ae094d6a3a1bd13dac574">isExact</a>() &amp;&amp; IVRange.<a href="/docs/api/classes/llvm/constantrange/#a4d69e164b5fb0f73a15a07119c4302f7">getUnsignedMin</a>().<a href="/docs/api/classes/llvm/apint/#af4b1ccc0b78f9da9f3f3944e06007f1d">uge</a>(&#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)) &#123;</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">          Shr-&gt;<a href="/docs/api/classes/llvm/instruction/#ac01940f561517355e394911c203bcedf">setIsExact</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">          Changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Changed;</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlightComment">/// Add all uses of Def to the current IV&#39;s worklist.</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#abcbabc703d62c3cc425d6b03dd1d3ef5"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#abcbabc703d62c3cc425d6b03dd1d3ef5">SimplifyIndvar::pushIVUsers</a>(</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Def, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 16&gt;</a> &amp;Simplified,</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;Instruction &#42;, Instruction &#42;&gt;&gt; &amp;SimpleIVUsers) &#123;</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : Def-&gt;users()) &#123;</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Avoid infinite or exponential worklist processing.</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Also ensure unique worklist users.</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If Def is a LoopPhi, it may not be in the Simplified set, so check for</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// self edges first.</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UI == Def)</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only change the current Loop, do not change the other parts (e.g. other</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Loops).</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L-&gt;contains(UI))</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not push the same instruction more than once.</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Simplified.insert(UI).second)</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">    SimpleIVUsers.push&#95;back(std::make&#95;pair(UI, Def));</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlightComment">/// Return true if this instruction generates a simple SCEV</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlightComment">/// expression in terms of that IV.</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlightComment">/// This is similar to IVUsers&#39; isInteresting() but processes each instruction</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlightComment">/// non-recursively when the operand is already known to be a simpleIVUser.</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884" lineLink="#a3e219df8a1368668aa0aac77616a4ce9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a3e219df8a1368668aa0aac77616a4ce9">isSimpleIVUser</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE) &#123;</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a6d8769a72303e2b06ef63129cb231855">isSCEVable</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()))</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the symbolic expression for this instruction.</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;S = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only consider affine recurrences.</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;AR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(S);</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AR &amp;&amp; AR-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>() == L)</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlightComment">/// Iteratively perform simplification on a worklist of users</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlightComment">/// of the specified induction variable. Each successive simplification may push</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlightComment">/// more users which may themselves be candidates for simplification.</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlightComment">/// This algorithm does not require IVUsers analysis. Instead, it simplifies</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlightComment">/// instructions in-place during analysis. Rather than rewriting induction</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlightComment">/// variables bottom-up from their users, it transforms a chain of IVUsers</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlightComment">/// top-down, updating the IR only when it encounters a clear optimization</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlightComment">/// opportunity.</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlightComment">/// Once DisableIVRewrite is default, LSR will be the only client of IVUsers.</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a1ba99155749ea6a41858f9bc4449f543"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a1ba99155749ea6a41858f9bc4449f543">SimplifyIndvar::simplifyUsers</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;CurrIV, <a href="/docs/api/classes/llvm/ivvisitor">IVVisitor</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;isSCEVable(CurrIV-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()))</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Instructions processed by SimplifyIndvar for CurrIV.</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction&#42;,16&gt;</a> Simplified;</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use-def pairs if IV users waiting to be processed for CurrIV.</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;Instruction&#42;, Instruction&#42;&gt;</a>, 8&gt; SimpleIVUsers;</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Push users of the current LoopPhi. In rare cases, pushIVUsers may be</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// called multiple times for the same LoopPhi. This is the proper thing to</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// do for loop header phis that use each other.</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#abcbabc703d62c3cc425d6b03dd1d3ef5">pushIVUsers</a>(CurrIV, Simplified, SimpleIVUsers);</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!SimpleIVUsers.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">    std::pair&lt;Instruction&#42;, Instruction&#42;&gt; UseOper =</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">      SimpleIVUsers.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseInst = UseOper.first;</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If a user of the IndVar is trivially dead, we prefer just to mark it dead</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// rather than try to do some complex analysis or transformation (such as</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// widening) basing on it.</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Propagate TLI and pass it here to handle more cases.</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a627b2f86ac433d829482d5a5a0f50668">isInstructionTriviallyDead</a>(UseInst, </span><span class="doxyHighlightComment">/&#42; TLI &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">      DeadInsts.emplace&#95;back(UseInst);</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Bypass back edges to avoid extra work.</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseInst == CurrIV) </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Try to replace UseInst with a loop invariant before any other</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// simplifications.</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a287ee23f262c0a9deb16096da9d34e7a">replaceIVUserWithLoopInvariant</a>(UseInst))</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Go further for the bitcast &#39;prtoint ptr to i64&#39; or if the cast is done</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// by truncation</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PtrToIntInst&gt;</a>(UseInst)) || (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(UseInst)))</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : UseInst-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a287ee23f262c0a9deb16096da9d34e7a">replaceIVUserWithLoopInvariant</a>(<a href="/docs/api/classes/llvm/user">User</a>))</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// done replacing</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVOperand = UseOper.second;</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = 0; IVOperand; ++<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>) &#123;</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> &lt;= Simplified.size() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;runaway iteration&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">      (void) <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>;</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewOper = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a12f6125cdd608cb0459585ddb68ead53">foldIVUser</a>(UseInst, IVOperand);</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewOper)</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// done folding</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">      IVOperand = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(NewOper);</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IVOperand)</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a08427a7d29ad22c694e5447d0d0adf4a">eliminateIVUser</a>(UseInst, IVOperand)) &#123;</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#abcbabc703d62c3cc425d6b03dd1d3ef5">pushIVUsers</a>(IVOperand, Simplified, SimpleIVUsers);</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;BO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(UseInst)) &#123;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a7ef1c9cb26f85c3ef0e39c3b0d6df989">strengthenBinaryOp</a>(BO, IVOperand)) &#123;</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// re-queue uses of the now modified binary operator and fall</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// through to the checks that remain.</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">        <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#abcbabc703d62c3cc425d6b03dd1d3ef5">pushIVUsers</a>(IVOperand, Simplified, SimpleIVUsers);</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Try to use integer induction for FPToSI of float induction directly.</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#a16096e55b9292113f13073fa2343b9c7">replaceFloatIVWithIntegerIV</a>(UseInst)) &#123;</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Re-queue the potentially new direct uses of IVOperand.</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#abcbabc703d62c3cc425d6b03dd1d3ef5">pushIVUsers</a>(IVOperand, Simplified, SimpleIVUsers);</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;Cast = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(UseInst);</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V &amp;&amp; Cast) &#123;</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">      V-&gt;visitCast(Cast);</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a3e219df8a1368668aa0aac77616a4ce9">isSimpleIVUser</a>(UseInst, L, SE)) &#123;</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/simplifyindvar/#abcbabc703d62c3cc425d6b03dd1d3ef5">pushIVUsers</a>(UseInst, Simplified, SimpleIVUsers);</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003" lineLink="/docs/api/classes/llvm/ivvisitor/#adc922a312c925e0c0a180105b60bab10"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/ivvisitor/#adc922a312c925e0c0a180105b60bab10">IVVisitor::anchor</a>() &#123; &#125;</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlightComment">/// Simplify instructions that use this induction variable</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlightComment">/// by using ScalarEvolution to analyze the IV&#39;s recurrence.</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlightComment">///  Returns a pair where the first entry indicates that the function makes</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlightComment">///  changes and the second entry indicates that it introduced new opportunities</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlightComment">///  for loop unswitching.</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010" lineLink="/docs/api/namespaces/llvm/#a9796363223b02a1db7a9a7dca91e833f"><span class="doxyHighlight">std::pair&lt;bool, bool&gt; <a href="/docs/api/namespaces/llvm/#a9796363223b02a1db7a9a7dca91e833f">simplifyUsersOfIV</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;CurrIV, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE,</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI,</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;Dead,</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>, <a href="/docs/api/classes/llvm/ivvisitor">IVVisitor</a> &#42;V) &#123;</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">  SimplifyIndvar SIV(LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(CurrIV-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()), SE, DT, LI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">                     <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>, Dead);</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">  SIV.simplifyUsers(CurrIV, V);</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;SIV.hasChanged(), SIV.runUnswitching()&#125;;</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlightComment">/// Simplify users of induction variables within this</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlightComment">/// loop. This does not actually change or add IVs.</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023" lineLink="/docs/api/namespaces/llvm/#a8413a9136fa25e3dfdebc5cb8c111002"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a8413a9136fa25e3dfdebc5cb8c111002">simplifyLoopIVs</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;Dead) &#123;</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>(&#42;SE, SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a057ff1d04d6303e3402647132a66ab18">getDataLayout</a>(), </span><span class="doxyHighlightStringLiteral">&quot;indvars&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlightPreprocessor">#if LLVM&#95;ENABLE&#95;ABI&#95;BREAKING&#95;CHECKS</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.setDebugType(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>);</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = L-&gt;getHeader()-&gt;begin(); <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>&#93; =</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a9796363223b02a1db7a9a7dca91e833f">simplifyUsersOfIV</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), SE, DT, LI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, Dead, <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>);</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace llvm</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlightComment">// Widen Induction Variables - Extend the width of an IV to cover its</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlightComment">// widest uses.</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#aba677aadf1abee0a03e3e5744b9724cd">WidenIV</a> &#123;</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Parameters</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OrigPhi;</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;WideType;</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Context</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a>        &#42;LI;</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a>            &#42;L;</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE;</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a>   &#42;DT;</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Does the module have any calls to the llvm.experimental.guard intrinsic</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// at all? If not we can avoid scanning instructions looking for guards.</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasGuards;</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UsePostIncrementRanges;</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Statistics</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumElimExt = 0;</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumWidened = 0;</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Result</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;WidePhi = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;WideInc = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;WideIncExpr = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;DeadInsts;</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;,16&gt;</a> Widened;</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">enum class</span><span class="doxyHighlight"> ExtendKind &#123; Zero, Sign, Unknown &#125;;</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A map tracking the kind of extension used to widen each narrow IV</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and narrow IV user.</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Key: pointer to a narrow IV or IV user.</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Value: the kind of extension used to widen this Instruction.</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;AssertingVH&lt;Instruction&gt;</a>, ExtendKind&gt; ExtendKindMap;</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">DefUserPair = std::pair&lt;AssertingVH&lt;Value&gt;, <a href="/docs/api/classes/llvm/assertingvh">AssertingVH&lt;Instruction&gt;</a>&gt;;</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A map with control-dependent ranges for post increment IV uses. The key is</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a pair of IV def and a use of this def denoting the context. The value is</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a ConstantRange representing possible values of the def at the given</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// context.</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;DefUserPair, ConstantRange&gt;</a> PostIncRangeInfos;</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">  std::optional&lt;ConstantRange&gt; getPostIncRangeInfo(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Def,</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">                                                   <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseI) &#123;</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">    DefUserPair <a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>(Def, UseI);</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = PostIncRangeInfos.find(<a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>);</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> It == PostIncRangeInfos.end()</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">               ? std::optional&lt;ConstantRange&gt;(std::nullopt)</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">               : std::optional&lt;ConstantRange&gt;(It-&gt;second);</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> calculatePostIncRanges(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OrigPhi);</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> calculatePostIncRange(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowDef, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowUser);</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> updatePostIncRangeInfo(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Def, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UseI, <a href="/docs/api/classes/llvm/constantrange">ConstantRange</a> R) &#123;</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">    DefUserPair <a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>(Def, UseI);</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;It, Inserted&#93; = PostIncRangeInfos.try&#95;emplace(<a href="/docs/api/namespaces/llvm/#a98c6256d0644613c6b5b3e2ef06ef5ce">Key</a>, R);</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inserted)</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">      It-&gt;second = R.intersectWith(It-&gt;second);</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlightComment">  /// Record a link in the Narrow IV def-use chain along with the WideIV that</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlightComment">  /// computes the same value as the Narrow IV def.  This avoids caching Use&#42;</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlightComment">  /// pointers.</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a955ac9474c41fccd8a181bf35cb3f8a6">NarrowIVDefUse</a> &#123;</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// True if the narrow def is never negative.  Tracking this information lets</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// us use a sign extension instead of a zero extension or vice versa, when</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// profitable and legal.</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#aeef9f24cc8914e50d2296cdd85b87fdc"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#aeef9f24cc8914e50d2296cdd85b87fdc">NeverNegative</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a955ac9474c41fccd8a181bf35cb3f8a6"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a955ac9474c41fccd8a181bf35cb3f8a6">NarrowIVDefUse</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ND, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NU, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;WD,</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">                   </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#aeef9f24cc8914e50d2296cdd85b87fdc">NeverNegative</a>)</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">        : <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>(ND), <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>(NU), <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a>(WD),</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">          <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#aeef9f24cc8914e50d2296cdd85b87fdc">NeverNegative</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#aeef9f24cc8914e50d2296cdd85b87fdc">NeverNegative</a>) &#123;&#125;</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopflatten-cpp/#a7d78113283f5e24797aab3b98480e77b">WidenIV</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/wideivinfo">WideIVInfo</a> &amp;WI, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LInfo, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SEv,</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DTree, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;DI,</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasGuards, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp/#accc15a102c8ad5b2f46c6b23ca331f4c">UsePostIncrementRanges</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/namespaces/llvm/#a35edc71a3e9b62bcfa5b80ae369515d9">createWideIV</a>(<a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>);</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a6e00ac6fdaee0e1f14f90a12abd10dc7"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a6e00ac6fdaee0e1f14f90a12abd10dc7">getNumElimExt</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NumElimExt; &#125;;</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a20a835d33fbb0807cef6a8fb519b4ad5"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a20a835d33fbb0807cef6a8fb519b4ad5">getNumWidened</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NumWidened; &#125;;</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlightKeyword">protected</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;createExtendInst(<a href="/docs/api/classes/llvm/value">Value</a> &#42;NarrowOper, <a href="/docs/api/classes/llvm/type">Type</a> &#42;WideType, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSigned,</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/use">Use</a>);</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;cloneIVUser(NarrowIVDefUse DU, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;WideAR);</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;cloneArithmeticIVUser(NarrowIVDefUse DU,</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;WideAR);</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;cloneBitwiseIVUser(NarrowIVDefUse DU);</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">  ExtendKind getExtendKind(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a692ebb057bf10c9bf99b2354d10d5402"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a692ebb057bf10c9bf99b2354d10d5402">WidenedRecTy</a> = std::pair&lt;const SCEVAddRecExpr &#42;, ExtendKind&gt;;</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a692ebb057bf10c9bf99b2354d10d5402">WidenedRecTy</a> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a2c90afd148f896bab791bdcad6b41dd0">getWideRecurrence</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">NarrowIVDefUse</a> DU);</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a692ebb057bf10c9bf99b2354d10d5402">WidenedRecTy</a> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a5acadc27f8741ff017a264df16bb8885">getExtendedOperandRecurrence</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">NarrowIVDefUse</a> DU);</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a181037cb6974efc0dfabf5f48ebf8238">getSCEVByOpCode</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;LHS, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;RHS,</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">                              </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpCode) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a39eadf98e4773739cd4e7b4befee6fb5">widenIVUse</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">NarrowIVDefUse</a> DU, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>,</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OrigPhi, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;WidePhi);</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a821be8169bc31b8413a69cd7f22ff9ab">truncateIVUse</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">NarrowIVDefUse</a> DU);</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#aa9eefc297d0b2b8097701f80c06ba19d">widenLoopCompare</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">NarrowIVDefUse</a> DU);</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#acd093283d4e8d1301859f0a98a157680">widenWithVariantUse</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">NarrowIVDefUse</a> DU);</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#ac65b91bafca4f727e589bdfbfb79edc1">pushNarrowIVUsers</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowDef, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;WideDef);</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;NarrowIVDefUse, 8&gt;</a> NarrowIVUsers;</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlightComment">/// Determine the insertion point for this user. By default, insert immediately</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlightComment">/// before the user. SCEVExpander or LICM will hoist loop invariants out of the</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlightComment">/// loop. For PHI nodes, there may be multiple uses, so compute the nearest</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlightComment">/// common dominator for the incoming blocks. A nullptr can be returned if no</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlightComment">/// viable location is found: it may happen if User is a PHI and Def only comes</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlightComment">/// to this PHI from unreachable blocks.</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180" lineLink="#a995c9f54308d436b9046a8741b149671"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="#a995c9f54308d436b9046a8741b149671">getInsertPointForUses</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Def,</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI) &#123;</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a>;</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getNumIncomingValues(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getIncomingValue(i) != Def)</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InsertBB = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getIncomingBlock(i);</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a1a70f2c359aadd76a72aaaede16aca4a">isReachableFromEntry</a>(InsertBB))</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InsertPt) &#123;</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">      InsertPt = InsertBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">    InsertBB = DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a2ec50ab2c78eff965caf3da71cd08be4">findNearestCommonDominator</a>(InsertPt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), InsertBB);</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">    InsertPt = InsertBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have skipped all inputs, it means that Def only comes to Phi from</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unreachable blocks.</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InsertPt)</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DefI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Def);</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DefI)</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> InsertPt;</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(DefI, InsertPt) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;def does not dominate all uses&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;L = LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(DefI-&gt;getParent());</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!L || L-&gt;contains(LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(InsertPt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())));</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DTN = (&#42;DT)&#91;InsertPt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()&#93;; DTN; DTN = DTN-&gt;getIDom())</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(DTN-&gt;getBlock()) == L)</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> DTN-&gt;getBlock()-&gt;getTerminator();</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;DefI dominates InsertPt!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#aba677aadf1abee0a03e3e5744b9724cd"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#aba677aadf1abee0a03e3e5744b9724cd">WidenIV::WidenIV</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/wideivinfo">WideIVInfo</a> &amp;WI, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LInfo, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SEv,</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DTree, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;DI,</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasGuards, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UsePostIncrementRanges)</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">      : OrigPhi(WI.NarrowIV), WideType(WI.WidestNativeType), LI(LInfo),</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">        L(LI-&gt;getLoopFor(OrigPhi-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>())), SE(SEv), DT(DTree),</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">        HasGuards(HasGuards), UsePostIncrementRanges(UsePostIncrementRanges),</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">        DeadInsts(DI) &#123;</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L-&gt;getHeader() == OrigPhi-&gt;getParent() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Phi must be an IV&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">    ExtendKindMap&#91;OrigPhi&#93; = WI.<a href="/docs/api/structs/llvm/wideivinfo/#a45b4503c5e229503d60cc68c034286ab">IsSigned</a> ? ExtendKind::Sign : ExtendKind::Zero;</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a0d6b9e4d1f5157d53f36e8c37f218233"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a0d6b9e4d1f5157d53f36e8c37f218233">WidenIV::createExtendInst</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;NarrowOper, <a href="/docs/api/classes/llvm/type">Type</a> &#42;WideType,</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSigned, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/use">Use</a>) &#123;</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set the debug location and conservative insertion point.</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(<a href="/docs/api/classes/llvm/use">Use</a>);</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Hoist the insertion point into loop preheaders as far as possible.</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI-&gt;getLoopFor(<a href="/docs/api/classes/llvm/use">Use</a>-&gt;getParent());</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">       L &amp;&amp; L-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>() &amp;&amp; L-&gt;isLoopInvariant(NarrowOper);</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">       L = L-&gt;getParentLoop())</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(L-&gt;getLoopPreheader()-&gt;getTerminator());</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IsSigned ? Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5253081f40ffcad9c0e8ba6a5c437006">CreateSExt</a>(NarrowOper, WideType) :</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">                    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9e6950f7f17700d5c0d61ad0b846ec5c">CreateZExt</a>(NarrowOper, WideType);</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlightComment">/// Instantiate a wide operation to replace a narrow operation. This only needs</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlightComment">/// to handle operations that can evaluation to SCEVAddRec. It can safely return</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlightComment">/// 0 for any operation we decide not to clone.</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a7ee5e663199f460b53a80855073e21bd"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a7ee5e663199f460b53a80855073e21bd">WidenIV::cloneIVUser</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">WidenIV::NarrowIVDefUse</a> DU,</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;WideAR) &#123;</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opcode = DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>();</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Opcode) &#123;</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Mul:</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::UDiv:</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Sub:</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#aee57a451f8dea6781fa17e7728ee78b5">cloneArithmeticIVUser</a>(DU, WideAR);</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::And:</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Or:</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Xor:</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Shl:</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::LShr:</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::AShr:</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#ae5441d4cfeb857eb3f3afad58fd88c08">cloneBitwiseIVUser</a>(DU);</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#ae5441d4cfeb857eb3f3afad58fd88c08"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#ae5441d4cfeb857eb3f3afad58fd88c08">WidenIV::cloneBitwiseIVUser</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">WidenIV::NarrowIVDefUse</a> DU) &#123;</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowUse = DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>;</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowDef = DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>;</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;WideDef = DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a>;</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Cloning bitwise IVUser: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NarrowUse &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace NarrowDef operands with WideDef. Otherwise, we don&#39;t know anything</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// about the narrow operand yet so must insert a &#91;sz&#93;ext. It is probably loop</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// invariant and will be folded or hoisted. If it actually comes from a</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// widened IV, it should be removed during a future call to widenIVUse.</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSigned = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a49e339292d507be61d9087d9aa664595">getExtendKind</a>(NarrowDef) == ExtendKind::Sign;</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = (NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == NarrowDef)</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">                   ? WideDef</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">                   : <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a0d6b9e4d1f5157d53f36e8c37f218233">createExtendInst</a>(NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), WideType,</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">                                      IsSigned, NarrowUse);</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHS = (NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) == NarrowDef)</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">                   ? WideDef</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">                   : <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a0d6b9e4d1f5157d53f36e8c37f218233">createExtendInst</a>(NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), WideType,</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">                                      IsSigned, NarrowUse);</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NarrowBO = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(NarrowUse);</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WideBO = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(NarrowBO-&gt;getOpcode(), LHS, RHS,</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">                                        NarrowBO-&gt;getName());</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(NarrowUse);</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8ef25defccf4817608a13e7a9db4000d">Insert</a>(WideBO);</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">  WideBO-&gt;copyIRFlags(NarrowBO);</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WideBO;</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#aee57a451f8dea6781fa17e7728ee78b5"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#aee57a451f8dea6781fa17e7728ee78b5">WidenIV::cloneArithmeticIVUser</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">WidenIV::NarrowIVDefUse</a> DU,</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">                                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;WideAR) &#123;</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowUse = DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>;</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowDef = DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>;</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;WideDef = DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a>;</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Cloning arithmetic IVUser: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NarrowUse &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IVOpIdx = (NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == NarrowDef) ? 0 : 1;</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We&#39;re trying to find X such that</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  Widen(NarrowDef &#96;op&#96; NonIVNarrowDef) == WideAR == WideDef &#96;op.wide&#96; X</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We guess two solutions to X, sext(NonIVNarrowDef) and zext(NonIVNarrowDef),</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and check using SCEV if any of them are correct.</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Returns true if extending NonIVNarrowDef according to &#96;SignExt&#96; is a</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// correct solution to X.</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GuessNonIVOperand = &#91;&amp;&#93;(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SignExt) &#123;</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;WideLHS;</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;WideRHS;</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetExtend = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, SignExt&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;S, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SignExt)</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SE-&gt;getSignExtendExpr(S, Ty);</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SE-&gt;getZeroExtendExpr(S, Ty);</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IVOpIdx == 0) &#123;</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">      WideLHS = SE-&gt;getSCEV(WideDef);</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;NarrowRHS = SE-&gt;getSCEV(NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">      WideRHS = GetExtend(NarrowRHS, WideType);</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;NarrowLHS = SE-&gt;getSCEV(NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">      WideLHS = GetExtend(NarrowLHS, WideType);</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">      WideRHS = SE-&gt;getSCEV(WideDef);</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// WideUse is &quot;WideDef &#96;op.wide&#96; X&quot; as described in the comment.</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;WideUse =</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a181037cb6974efc0dfabf5f48ebf8238">getSCEVByOpCode</a>(WideLHS, WideRHS, NarrowUse-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>());</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WideUse == WideAR;</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SignExtend = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a49e339292d507be61d9087d9aa664595">getExtendKind</a>(NarrowDef) == ExtendKind::Sign;</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!GuessNonIVOperand(SignExtend)) &#123;</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">    SignExtend = !SignExtend;</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!GuessNonIVOperand(SignExtend))</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = (NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == NarrowDef)</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">                   ? WideDef</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">                   : <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a0d6b9e4d1f5157d53f36e8c37f218233">createExtendInst</a>(NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), WideType,</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">                                      SignExtend, NarrowUse);</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHS = (NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) == NarrowDef)</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">                   ? WideDef</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">                   : <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a0d6b9e4d1f5157d53f36e8c37f218233">createExtendInst</a>(NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), WideType,</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">                                      SignExtend, NarrowUse);</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NarrowBO = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(NarrowUse);</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WideBO = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(NarrowBO-&gt;getOpcode(), LHS, RHS,</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">                                        NarrowBO-&gt;getName());</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(NarrowUse);</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8ef25defccf4817608a13e7a9db4000d">Insert</a>(WideBO);</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">  WideBO-&gt;copyIRFlags(NarrowBO);</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WideBO;</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a49e339292d507be61d9087d9aa664595"><span class="doxyHighlight">WidenIV::ExtendKind <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a49e339292d507be61d9087d9aa664595">WidenIV::getExtendKind</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = ExtendKindMap.find(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It != ExtendKindMap.end() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Instruction not yet extended!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> It-&gt;second;</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a181037cb6974efc0dfabf5f48ebf8238"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a181037cb6974efc0dfabf5f48ebf8238">WidenIV::getSCEVByOpCode</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;LHS, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;RHS,</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpCode)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (OpCode) &#123;</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SE-&gt;getAddExpr(LHS, RHS);</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Sub:</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SE-&gt;getMinusSCEV(LHS, RHS);</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Mul:</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SE-&gt;getMulExpr(LHS, RHS);</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::UDiv:</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SE-&gt;getUDivExpr(LHS, RHS);</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unsupported opcode.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlightComment">// Represents a interesting integer binary operation for</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlightComment">// getExtendedOperandRecurrence. This may be a shl that is being treated as a</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlightComment">// multiply or a &#39;or disjoint&#39; that is being treated as &#39;add nsw nuw&#39;.</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#abff2b27e571ffb6e87ef6e12956a32f8">BinaryOp</a> &#123;</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#aa54d848645acbdcf88682d383735d692"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#aa54d848645acbdcf88682d383735d692">Opcode</a>;</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a00d92a7ba0e9080e093135fa6d2f2944"><span class="doxyHighlight">  std::array&lt;Value &#42;, 2&gt; <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a00d92a7ba0e9080e093135fa6d2f2944">Operands</a>;</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a0629da8f6a292d4d6a8f37b15a2d79da"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a0629da8f6a292d4d6a8f37b15a2d79da">IsNSW</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a306186638da88e08ec881f036bca6911"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a306186638da88e08ec881f036bca6911">IsNUW</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#abff2b27e571ffb6e87ef6e12956a32f8"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">explicit</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#abff2b27e571ffb6e87ef6e12956a32f8">BinaryOp</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">      : <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#aa54d848645acbdcf88682d383735d692">Opcode</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanslp-cpp/#a06b4f19004df11b338ccc7e73bf47ab4">getOpcode</a>()),</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">        <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a00d92a7ba0e9080e093135fa6d2f2944">Operands</a>(&#123;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getOperand(0), <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getOperand(1)&#125;) &#123;</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OBO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;OverflowingBinaryOperator&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a0629da8f6a292d4d6a8f37b15a2d79da">IsNSW</a> = OBO-&gt;hasNoSignedWrap();</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">      <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a306186638da88e08ec881f036bca6911">IsNUW</a> = OBO-&gt;hasNoUnsignedWrap();</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419" lineLink="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a1a88e83d6b4e40b1befda28f33fa9c72"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">explicit</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a1a88e83d6b4e40b1befda28f33fa9c72">BinaryOp</a>(<a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#aa54d848645acbdcf88682d383735d692">Opcode</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS, <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHS,</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a0629da8f6a292d4d6a8f37b15a2d79da">IsNSW</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a306186638da88e08ec881f036bca6911">IsNUW</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">      : <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#aa54d848645acbdcf88682d383735d692">Opcode</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#aa54d848645acbdcf88682d383735d692">Opcode</a>), <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a00d92a7ba0e9080e093135fa6d2f2944">Operands</a>(&#123;LHS, RHS&#125;), <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a0629da8f6a292d4d6a8f37b15a2d79da">IsNSW</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a0629da8f6a292d4d6a8f37b15a2d79da">IsNSW</a>), <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a306186638da88e08ec881f036bca6911">IsNUW</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/binaryop/#a306186638da88e08ec881f036bca6911">IsNUW</a>) &#123;&#125;</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426" lineLink="#aae7060f1dababae7ea60ae22eb9e9c6b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::optional&lt;BinaryOp&gt; <a href="#aae7060f1dababae7ea60ae22eb9e9c6b">matchBinaryOp</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123;</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Sub:</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Mul:</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOp(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Or: &#123;</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Convert or disjoint into add nuw nsw.</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PossiblyDisjointInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)-&gt;isDisjoint())</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOp(Instruction::Add, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getOperand(0), <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getOperand(1),</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">                      </span><span class="doxyHighlightComment">/&#42;IsNSW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;IsNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Shl: &#123;</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;SA = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getOperand(1))) &#123;</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(SA-&gt;getType())-&gt;getBitWidth();</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the shift count is not less than the bitwidth, the result of</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the shift is undefined. Don&#39;t try to analyze it, because the</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// resolution chosen here may differ from the resolution chosen in</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// other parts of the compiler.</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SA-&gt;getValue().ult(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>)) &#123;</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We can safely preserve the nuw flag in all cases. It&#39;s also safe to</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// turn a nuw nsw shl into a nuw nsw mul. However, nsw in isolation</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// requires special handling. It can be preserved as long as we&#39;re not</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// left shifting by bitwidth - 1</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNUW = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;hasNoUnsignedWrap();</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNSW = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;hasNoSignedWrap() &amp;&amp;</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">                     (IsNUW || SA-&gt;getValue().ult(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a> - 1));</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> =</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">            ConstantInt::get(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getContext(),</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/apint/#aec662ee6ab1490a4cabebf2812e5b9ca">APInt::getOneBitSet</a>(<a href="/docs/api/namespaces/llvm/#abee0df5f7f703bb4462aba260ba0a60f">BitWidth</a>, SA-&gt;getZExtValue()));</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BinaryOp(Instruction::Mul, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getOperand(0), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, IsNSW, IsNUW);</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlightComment">/// No-wrap operations can transfer sign extension of their result to their</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlightComment">/// operands. Generate the SCEV value for the widened operation without</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlightComment">/// actually modifying the IR yet. If the expression after extending the</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlightComment">/// operands is an AddRec for this loop, return the AddRec and the kind of</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlightComment">/// extension used.</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a692ebb057bf10c9bf99b2354d10d5402">WidenIV::WidenedRecTy</a></span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a5acadc27f8741ff017a264df16bb8885"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a5acadc27f8741ff017a264df16bb8885">WidenIV::getExtendedOperandRecurrence</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">WidenIV::NarrowIVDefUse</a> DU) &#123;</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="#aae7060f1dababae7ea60ae22eb9e9c6b">matchBinaryOp</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>);</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ExtendKind::Unknown&#125;;</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;Opcode == Instruction::Add || <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;Opcode == Instruction::Sub ||</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;Opcode == Instruction::Mul) &amp;&amp;</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected opcode&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// One operand (NarrowDef) has already been extended to WideDef. Now determine</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if extending the other will lead to a recurrence.</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ExtendOperIdx = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;Operands&#91;0&#93; == DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a> ? 1 : 0;</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;Operands&#91;1 - ExtendOperIdx&#93; == DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;bad DU&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">  ExtendKind ExtKind = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a49e339292d507be61d9087d9aa664595">getExtendKind</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>);</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!(ExtKind == ExtendKind::Sign &amp;&amp; <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;IsNSW) &amp;&amp;</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">      !(ExtKind == ExtendKind::Zero &amp;&amp; <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;IsNUW)) &#123;</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">    ExtKind = ExtendKind::Unknown;</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For a non-negative NarrowDef, we can choose either type of</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// extension.  We want to use the current extend kind if legal</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (see above), and we only hit this code if we need to check</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the opposite case.</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#aeef9f24cc8914e50d2296cdd85b87fdc">NeverNegative</a>) &#123;</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;IsNSW) &#123;</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">        ExtKind = ExtendKind::Sign;</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;IsNUW) &#123;</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">        ExtKind = ExtendKind::Zero;</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExtendOperExpr = SE-&gt;getSCEV(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;Operands&#91;ExtendOperIdx&#93;);</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtKind == ExtendKind::Sign)</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">    ExtendOperExpr = SE-&gt;getSignExtendExpr(ExtendOperExpr, WideType);</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtKind == ExtendKind::Zero)</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">    ExtendOperExpr = SE-&gt;getZeroExtendExpr(ExtendOperExpr, WideType);</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ExtendKind::Unknown&#125;;</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When creating this SCEV expr, don&#39;t apply the current operations NSW or NUW</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// flags. This instruction may be guarded by control flow that the no-wrap</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// behavior depends on. Non-control-equivalent instructions can be mapped to</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the same SCEV expression, and it would be incorrect to transfer NSW/NUW</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// semantics to those operations.</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;lhs = SE-&gt;getSCEV(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a>);</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;rhs = ExtendOperExpr;</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Let&#39;s swap operands to the initial order for the case of non-commutative</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// operations, like SUB. See PR21014.</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtendOperIdx == 0)</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(lhs, rhs);</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;AddRec =</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a181037cb6974efc0dfabf5f48ebf8238">getSCEVByOpCode</a>(lhs, rhs, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;Opcode));</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AddRec || AddRec-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>() != L)</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ExtendKind::Unknown&#125;;</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;AddRec, ExtKind&#125;;</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlightComment">/// Is this instruction potentially interesting for further simplification after</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlightComment">/// widening it&#39;s type? In other words, can the extend be safely hoisted out of</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlightComment">/// the loop with SCEV reducing the value to a recurrence on the same loop. If</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlightComment">/// so, return the extended recurrence and the kind of extension used. Otherwise</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlightComment">/// return &#123;nullptr, ExtendKind::Unknown&#125;.</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a2c90afd148f896bab791bdcad6b41dd0"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a692ebb057bf10c9bf99b2354d10d5402">WidenIV::WidenedRecTy</a> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a2c90afd148f896bab791bdcad6b41dd0">WidenIV::getWideRecurrence</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">WidenIV::NarrowIVDefUse</a> DU) &#123;</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>())</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ExtendKind::Unknown&#125;;</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;NarrowExpr = SE-&gt;getSCEV(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>);</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;getTypeSizeInBits(NarrowExpr-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()) &gt;=</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">      SE-&gt;getTypeSizeInBits(WideType)) &#123;</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// NarrowUse implicitly widens its operand. e.g. a gep with a narrow</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// index. So don&#39;t follow this use.</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ExtendKind::Unknown&#125;;</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;WideExpr;</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">  ExtendKind ExtKind;</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#aeef9f24cc8914e50d2296cdd85b87fdc">NeverNegative</a>) &#123;</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">    WideExpr = SE-&gt;getSignExtendExpr(NarrowExpr, WideType);</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVAddRecExpr&gt;</a>(WideExpr))</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">      ExtKind = ExtendKind::Sign;</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">      WideExpr = SE-&gt;getZeroExtendExpr(NarrowExpr, WideType);</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlight">      ExtKind = ExtendKind::Zero;</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a49e339292d507be61d9087d9aa664595">getExtendKind</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>) == ExtendKind::Sign) &#123;</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">    WideExpr = SE-&gt;getSignExtendExpr(NarrowExpr, WideType);</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">    ExtKind = ExtendKind::Sign;</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">    WideExpr = SE-&gt;getZeroExtendExpr(NarrowExpr, WideType);</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">    ExtKind = ExtendKind::Zero;</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;AddRec = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(WideExpr);</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AddRec || AddRec-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>() != L)</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, ExtendKind::Unknown&#125;;</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;AddRec, ExtKind&#125;;</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlightComment">/// This IV user cannot be widened. Replace this use of the original narrow IV</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlightComment">/// with a truncation of the new wide IV to isolate and eliminate the narrow IV.</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a821be8169bc31b8413a69cd7f22ff9ab"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a821be8169bc31b8413a69cd7f22ff9ab">WidenIV::truncateIVUse</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">NarrowIVDefUse</a> DU) &#123;</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;InsertPt = <a href="#a995c9f54308d436b9046a8741b149671">getInsertPointForUses</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>, DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>, DT, LI);</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InsertPt)</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Truncate IV &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for user &quot;</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">                    &lt;&lt; &#42;DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">  ExtendKind ExtKind = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a49e339292d507be61d9087d9aa664595">getExtendKind</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>);</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(InsertPt);</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Trunc =</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a>, DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">                          DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#aeef9f24cc8914e50d2296cdd85b87fdc">NeverNegative</a> || ExtKind == ExtendKind::Zero,</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">                          DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#aeef9f24cc8914e50d2296cdd85b87fdc">NeverNegative</a> || ExtKind == ExtendKind::Sign);</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">  DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>, Trunc);</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlightComment">/// If the narrow use is a compare instruction, then widen the compare</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlightComment">//  (and possibly the other operand).  The extend operation is hoisted into the</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlightComment">// loop preheader as far as possible.</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#aa9eefc297d0b2b8097701f80c06ba19d"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#aa9eefc297d0b2b8097701f80c06ba19d">WidenIV::widenLoopCompare</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">WidenIV::NarrowIVDefUse</a> DU) &#123;</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>);</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Cmp)</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can legally widen the comparison in the following two cases:</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  - The signedness of the IV extension and comparison match</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  - The narrow IV is always positive (and thus its sign extension is equal</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    to its zero extension).  For instance, let&#39;s say we&#39;re zero extending</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    %narrow for the following use</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      icmp slt i32 %narrow, %val   ... (A)</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    and %narrow is always positive.  Then</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      (A) == icmp slt i32 sext(%narrow), sext(%val)</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//          == icmp slt i32 zext(%narrow), sext(%val)</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSigned = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a49e339292d507be61d9087d9aa664595">getExtendKind</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>) == ExtendKind::Sign;</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#aeef9f24cc8914e50d2296cdd85b87fdc">NeverNegative</a> || IsSigned == Cmp-&gt;isSigned()))</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = Cmp-&gt;getOperand(Cmp-&gt;getOperand(0) == DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a> ? 1 : 0);</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CastWidth = SE-&gt;getTypeSizeInBits(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getType());</span></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IVWidth = SE-&gt;getTypeSizeInBits(WideType);</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CastWidth &lt;= IVWidth &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected width while widening compare.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Widen the compare instruction.</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">  DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>, DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a>);</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Widen the other operand of the compare, if necessary.</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CastWidth &lt; IVWidth) &#123;</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExtOp = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a0d6b9e4d1f5157d53f36e8c37f218233">createExtendInst</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, WideType, Cmp-&gt;isSigned(), Cmp);</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">    DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, ExtOp);</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlightComment">// The widenIVUse avoids generating trunc by evaluating the use as AddRec, this</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlightComment">// will not work when:</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlightComment">//    1) SCEV traces back to an instruction inside the loop that SCEV can not</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlightComment">// expand, eg. add %indvar, (load %addr)</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlightComment">//    2) SCEV finds a loop variant, eg. add %indvar, %loopvariant</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlightComment">// While SCEV fails to avoid trunc, we can still try to use instruction</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlightComment">// combining approach to prove trunc is not required. This can be further</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlightComment">// extended with other instruction combining checks, but for now we handle the</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlightComment">// following case (sub can be &quot;add&quot; and &quot;mul&quot;, &quot;nsw + sext&quot; can be &quot;nus + zext&quot;)</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlightComment">// Src:</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlightComment">//   %c = sub nsw %b, %indvar</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlightComment">//   %d = sext %c to i64</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlightComment">// Dst:</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlightComment">//   %indvar.ext1 = sext %indvar to i64</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlightComment">//   %m = sext %b to i64</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlightComment">//   %d = sub nsw i64 %m, %indvar.ext1</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlightComment">// Therefore, as long as the result of add/sub/mul is extended to wide type, no</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlightComment">// trunc is required regardless of how %b is generated. This pattern is common</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlightComment">// when calculating address in 64 bit architecture</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#acd093283d4e8d1301859f0a98a157680"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#acd093283d4e8d1301859f0a98a157680">WidenIV::widenWithVariantUse</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">WidenIV::NarrowIVDefUse</a> DU) &#123;</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowUse = DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>;</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowDef = DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>;</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;WideDef = DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a>;</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle the common case of add&lt;nsw/nuw&gt;</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpCode = NarrowUse-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>();</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only Add/Sub/Mul instructions are supported.</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpCode != Instruction::Add &amp;&amp; OpCode != Instruction::Sub &amp;&amp;</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">      OpCode != Instruction::Mul)</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The operand that is not defined by NarrowDef of DU. Let&#39;s call it the</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// other operand.</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == NarrowDef ||</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">          NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) == NarrowDef) &amp;&amp;</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;bad DU&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/overflowingbinaryoperator">OverflowingBinaryOperator</a> &#42;OBO =</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;OverflowingBinaryOperator&gt;</a>(NarrowUse);</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">  ExtendKind ExtKind = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a49e339292d507be61d9087d9aa664595">getExtendKind</a>(NarrowDef);</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CanSignExtend = ExtKind == ExtendKind::Sign &amp;&amp; OBO-&gt;<a href="/docs/api/classes/llvm/overflowingbinaryoperator/#a7876c618729b8764493aa340b53b574f">hasNoSignedWrap</a>();</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CanZeroExtend = ExtKind == ExtendKind::Zero &amp;&amp; OBO-&gt;<a href="/docs/api/classes/llvm/overflowingbinaryoperator/#a95474ea140862464db7ea0580f01eae9">hasNoUnsignedWrap</a>();</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AnotherOpExtKind = ExtKind;</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that all uses are either:</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// - narrow def (in case of we are widening the IV increment);</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// - single-input LCSSA Phis;</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// - comparison of the chosen type;</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// - extend of the chosen type (raison d&#39;etre).</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> ExtUsers;</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHINode &#42;, 4&gt;</a> LCSSAPhiUsers;</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ICmpInst &#42;, 4&gt;</a> ICmpUsers;</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : NarrowUse-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> == NarrowDef)</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L-&gt;contains(<a href="/docs/api/classes/llvm/user">User</a>)) &#123;</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LCSSAPhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Make sure there is only 1 input, so that we don&#39;t have to split</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// critical edges.</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LCSSAPhi-&gt;getNumOperands() != 1)</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">      LCSSAPhiUsers.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(LCSSAPhi);</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ICmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>)) &#123;</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Pred = ICmp-&gt;getPredicate();</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We have 3 types of predicates: signed, unsigned and equality</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// predicates. For equality, it&#39;s legal to widen icmp for either sign and</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// zero extend. For sign extend, we can also do so for signed predicates,</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// likeweise for zero extend we can widen icmp for unsigned predicates.</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtKind == ExtendKind::Zero &amp;&amp; <a href="/docs/api/classes/llvm/cmpinst/#a3712279d70deeec90a93db09deb12d02">ICmpInst::isSigned</a>(Pred))</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtKind == ExtendKind::Sign &amp;&amp; <a href="/docs/api/classes/llvm/cmpinst/#af206a3d6f58d9e53b074460f0d1ecb86">ICmpInst::isUnsigned</a>(Pred))</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">      ICmpUsers.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ICmp);</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtKind == ExtendKind::Sign)</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SExtInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/user">User</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ZExtInst&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/user">User</a> || <a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != WideType)</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">    ExtUsers.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtUsers.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">    DeadInsts.emplace&#95;back(NarrowUse);</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We&#39;ll prove some facts that should be true in the context of ext users. If</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// there is no users, we are done now. If there are some, pick their common</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dominator as context.</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CtxI = <a href="#a61b5cb822ee8e25eee3418a520337962">findCommonDominator</a>(ExtUsers, &#42;DT);</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CanSignExtend &amp;&amp; !CanZeroExtend) &#123;</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Because InstCombine turns &#39;sub nuw&#39; to &#39;add&#39; losing the no-wrap flag, we</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will most likely not see it. Let&#39;s try to prove it.</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpCode != Instruction::Add)</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtKind != ExtendKind::Zero)</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;LHS = SE-&gt;getSCEV(OBO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;RHS = SE-&gt;getSCEV(OBO-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Support case for NarrowDef = NarrowUse-&gt;getOperand(1).</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) != NarrowDef)</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We cannot use a different extend kind for the same operand.</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) == NarrowDef)</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;isKnownNegative(RHS))</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ProvedSubNUW = SE-&gt;isKnownPredicateAt(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba573bcd571c938fce863525330bbfc4b8">ICmpInst::ICMP&#95;UGE</a>, LHS,</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">                                               SE-&gt;getNegativeSCEV(RHS), CtxI);</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ProvedSubNUW)</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In fact, our &#39;add&#39; is &#39;sub nuw&#39;. We will need to widen the 2nd operand as</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// neg(zext(neg(op))), which is basically sext(op).</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">    AnotherOpExtKind = ExtendKind::Sign;</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Verifying that Defining operand is an AddRec</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;Op1 = SE-&gt;getSCEV(WideDef);</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;AddRecOp1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(Op1);</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AddRecOp1 || AddRecOp1-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>() != L)</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Cloning arithmetic IVUser: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NarrowUse &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generating a widening use instruction.</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS =</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">      (NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) == NarrowDef)</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlight">          ? WideDef</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlight">          : <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a0d6b9e4d1f5157d53f36e8c37f218233">createExtendInst</a>(NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0), WideType,</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">                             AnotherOpExtKind == ExtendKind::Sign, NarrowUse);</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RHS =</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">      (NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) == NarrowDef)</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlight">          ? WideDef</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">          : <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a0d6b9e4d1f5157d53f36e8c37f218233">createExtendInst</a>(NarrowUse-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1), WideType,</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlight">                             AnotherOpExtKind == ExtendKind::Sign, NarrowUse);</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NarrowBO = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BinaryOperator&gt;</a>(NarrowUse);</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WideBO = <a href="/docs/api/classes/llvm/binaryoperator/#a8f385eda0f71b4e8199b296fbc8e0da9">BinaryOperator::Create</a>(NarrowBO-&gt;getOpcode(), LHS, RHS,</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">                                        NarrowBO-&gt;getName());</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(NarrowUse);</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8ef25defccf4817608a13e7a9db4000d">Insert</a>(WideBO);</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">  WideBO-&gt;copyIRFlags(NarrowBO);</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">  ExtendKindMap&#91;NarrowUse&#93; = ExtKind;</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> : ExtUsers) &#123;</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == WideType &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Checked before!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: eliminating &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/classes/llvm/user">User</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; replaced by &quot;</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">                      &lt;&lt; &#42;WideBO &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlight">    ++NumElimExt;</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(WideBO);</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">    DeadInsts.emplace&#95;back(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> : LCSSAPhiUsers) &#123;</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>() == 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Checked before!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WidePN =</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(WideBO-&gt;getType(), 1, <a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.wide&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopExitingBlock = <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent()-&gt;getSinglePredecessor();</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LoopExitingBlock &amp;&amp; L-&gt;contains(LoopExitingBlock) &amp;&amp;</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Not a LCSSA Phi?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">    WidePN-&gt;addIncoming(WideBO, LoopExitingBlock);</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent(),</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/user">User</a>-&gt;getParent()-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;TruncPN = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(WidePN, <a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(TruncPN);</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">    DeadInsts.emplace&#95;back(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> : ICmpUsers) &#123;</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ExtendedOp = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42; V)-&gt;<a href="/docs/api/classes/llvm/value">Value</a> &#42; &#123;</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V == NarrowUse)</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WideBO;</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtKind == ExtendKind::Zero)</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9e6950f7f17700d5c0d61ad0b846ec5c">CreateZExt</a>(V, WideBO-&gt;getType());</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5253081f40ffcad9c0e8ba6a5c437006">CreateSExt</a>(V, WideBO-&gt;getType());</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Pred = <a href="/docs/api/classes/llvm/user">User</a>-&gt;getPredicate();</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LHS = ExtendedOp(<a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0));</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RHS = ExtendedOp(<a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WideCmp =</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae0bd6c2fab2d18443038a8f3a2b64856">CreateICmp</a>(Pred, LHS, RHS, <a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.wide&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(WideCmp);</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">    DeadInsts.emplace&#95;back(<a href="/docs/api/classes/llvm/user">User</a>);</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlightComment">/// Determine whether an individual user of the narrow IV can be widened. If so,</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlightComment">/// return the wide clone of the user.</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a39eadf98e4773739cd4e7b4befee6fb5"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a39eadf98e4773739cd4e7b4befee6fb5">WidenIV::widenIVUse</a>(<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">WidenIV::NarrowIVDefUse</a> DU,</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OrigPhi,</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;WidePhi) &#123;</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExtendKindMap.count(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>) &amp;&amp;</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Should already know the kind of extension used to widen NarrowDef&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This narrow use can be widened by a sext if it&#39;s non-negative or its narrow</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// def was widened by a sext. Same for zext.</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CanWidenBySExt =</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">      DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#aeef9f24cc8914e50d2296cdd85b87fdc">NeverNegative</a> || <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a49e339292d507be61d9087d9aa664595">getExtendKind</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>) == ExtendKind::Sign;</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CanWidenByZExt =</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">      DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#aeef9f24cc8914e50d2296cdd85b87fdc">NeverNegative</a> || <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a49e339292d507be61d9087d9aa664595">getExtendKind</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>) == ExtendKind::Zero;</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Stop traversing the def-use chain at inner-loop phis or post-loop phis.</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;UsePhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>)) &#123;</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;getLoopFor(UsePhi-&gt;getParent()) != L) &#123;</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For LCSSA phis, sink the truncate outside the loop.</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// After SimplifyCFG most loop exit targets have a single predecessor.</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Otherwise fall back to a truncate within the loop.</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsePhi-&gt;getNumOperands() != 1)</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">        <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a821be8169bc31b8413a69cd7f22ff9ab">truncateIVUse</a>(DU);</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Widening the PHI requires us to insert a trunc.  The logical place</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// for this trunc is in the same BB as the PHI.  This is not possible if</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the BB is terminated by a catchswitch.</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CatchSwitchInst&gt;</a>(UsePhi-&gt;getParent()-&gt;getTerminator()))</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;WidePhi =</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 1, UsePhi-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.wide&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">                          UsePhi-&gt;getIterator());</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">        WidePhi-&gt;addIncoming(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a>, UsePhi-&gt;getIncomingBlock(0));</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;WidePhiBB = WidePhi-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(WidePhiBB, WidePhiBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Trunc = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(WidePhi, DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">                                           CanWidenByZExt, CanWidenBySExt);</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">        UsePhi-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Trunc);</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">        DeadInsts.emplace&#95;back(UsePhi);</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: Widen lcssa phi &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;UsePhi &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to &quot;</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">                          &lt;&lt; &#42;WidePhi &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Our raison d&#39;etre! Eliminate sign and zero extension.</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a9ffe83e2db4b833b819ee721595c04dc">m&#95;SExtLike</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())) &amp;&amp; CanWidenBySExt) ||</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">      (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>) &amp;&amp; CanWidenByZExt)) &#123;</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewDef = DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a>;</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() != WideType) &#123;</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CastWidth = SE-&gt;getTypeSizeInBits(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IVWidth = SE-&gt;getTypeSizeInBits(WideType);</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CastWidth &lt; IVWidth) &#123;</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The cast isn&#39;t as wide as the IV, so insert a Trunc.</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>);</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">        NewDef = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab5b4acb0f45af3f2308cad1468804f1e">CreateTrunc</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a>, DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">                                     CanWidenByZExt, CanWidenBySExt);</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// A wider extend was hidden behind a narrower one. This may induce</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// another round of IV widening in which the intermediate IV becomes</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// dead. It should be very rare.</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: New IV &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;WidePhi</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">                          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; not wide enough to subsume &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a></span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">                          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">        DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>, DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a>);</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">        NewDef = DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>;</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewDef != DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>) &#123;</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;INDVARS: eliminating &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a></span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; replaced by &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a41ae7e1b14cb78ee141c769563f59a7c">WideDef</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">      ++NumElimExt;</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">      DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewDef);</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">      DeadInsts.emplace&#95;back(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>);</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now that the extend is gone, we want to expose it&#39;s uses for potential</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// further simplification. We don&#39;t need to directly inform SimplifyIVUsers</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of the new users, because their parent IV will be processed later as a</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// new loop phi. If we preserved IVUsers analysis, we would also want to</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// push the uses of WideDef here.</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// No further widening is needed. The deceased &#91;sz&#93;ext had done it for us.</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> tryAddRecExpansion = &#91;&amp;&#93;() -&gt; <a href="/docs/api/classes/llvm/instruction">Instruction</a>&#42; &#123;</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Does this user itself evaluate to a recurrence after widening?</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a692ebb057bf10c9bf99b2354d10d5402">WidenedRecTy</a> WideAddRec = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a5acadc27f8741ff017a264df16bb8885">getExtendedOperandRecurrence</a>(DU);</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WideAddRec.first)</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">      WideAddRec = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a2c90afd148f896bab791bdcad6b41dd0">getWideRecurrence</a>(DU);</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((WideAddRec.first == </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) ==</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">           (WideAddRec.second == ExtendKind::Unknown));</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WideAddRec.first)</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CanUseWideInc = &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WideInc)</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Reuse the IV increment that SCEVExpander created. Recompute flags,</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// unless the flags for both increments agree and it is safe to use the</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// ones from the original inc. In that case, the new use of the wide</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// increment won&#39;t be more poisonous.</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedToRecomputeFlags =</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">          !<a href="/docs/api/classes/llvm/scevexpander/#aad8311debca961aeee16791414f9efa1">SCEVExpander::canReuseFlagsFromOriginalIVInc</a>(</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">              OrigPhi, WidePhi, DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>, WideInc) ||</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">          DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>-&gt;<a href="/docs/api/classes/llvm/instruction/#a100c666f9253331dd1d166a863248326">hasNoUnsignedWrap</a>() != WideInc-&gt;hasNoUnsignedWrap() ||</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">          DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>-&gt;<a href="/docs/api/classes/llvm/instruction/#a350f4fdc01c770b5cf6a8be2624ae3e5">hasNoSignedWrap</a>() != WideInc-&gt;hasNoSignedWrap();</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WideAddRec.first == WideIncExpr &amp;&amp;</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">             <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.hoistIVInc(WideInc, DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>, NeedToRecomputeFlags);</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;WideUse = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CanUseWideInc())</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">      WideUse = WideInc;</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">      WideUse = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a7ee5e663199f460b53a80855073e21bd">cloneIVUser</a>(DU, WideAddRec.first);</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WideUse)</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Evaluation of WideAddRec ensured that the narrow expression could be</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// extended outside the loop without overflow. This suggests that the wide use</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// evaluates to the same expression as the extended narrow use, but doesn&#39;t</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// absolutely guarantee it. Hence the following failsafe check. In rare cases</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// where it fails, we simply throw away the newly created wide use.</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WideAddRec.first != SE-&gt;getSCEV(WideUse)) &#123;</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Wide use expression mismatch: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;WideUse &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;: &quot;</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">                 &lt;&lt; &#42;SE-&gt;getSCEV(WideUse) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; != &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;WideAddRec.first</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlight">                 &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">      DeadInsts.emplace&#95;back(WideUse);</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// if we reached this point then we are going to replace</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// DU.NarrowUse with WideUse. Reattach DbgValue then.</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a9784a018b2dd6a85ee8a70f5f5ab3d02">replaceAllDbgUsesWith</a>(&#42;DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>, &#42;WideUse, &#42;WideUse, &#42;DT);</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">    ExtendKindMap&#91;DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>&#93; = WideAddRec.second;</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Returning WideUse pushes it on the worklist.</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WideUse;</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = tryAddRecExpansion())</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If use is a loop condition, try to promote the condition instead of</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// truncating the IV first.</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#aa9eefc297d0b2b8097701f80c06ba19d">widenLoopCompare</a>(DU))</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are here about to generate a truncate instruction that may hurt</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// performance because the scalar evolution expression computed earlier</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in WideAddRec.first does not indicate a polynomial induction expression.</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In that case, look at the operands of the use instruction to determine</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if we can still widen the use instead of truncating its operand.</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#acd093283d4e8d1301859f0a98a157680">widenWithVariantUse</a>(DU))</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This user does not evaluate to a recurrence after widening, so don&#39;t</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// follow it. Instead insert a Trunc to kill off the original use,</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// eventually isolating the original narrow IV so it can be removed.</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a821be8169bc31b8413a69cd7f22ff9ab">truncateIVUse</a>(DU);</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlightComment">/// Add eligible users of NarrowDef to NarrowIVUsers.</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#ac65b91bafca4f727e589bdfbfb79edc1"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#ac65b91bafca4f727e589bdfbfb79edc1">WidenIV::pushNarrowIVUsers</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowDef, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;WideDef) &#123;</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;NarrowSCEV = SE-&gt;getSCEV(NarrowDef);</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NonNegativeDef =</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">      SE-&gt;isKnownPredicate(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac1aa7b798ba11d2e497d5cce6ce6d3dc">ICmpInst::ICMP&#95;SGE</a>, NarrowSCEV,</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">                           SE-&gt;getZero(NarrowSCEV-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()));</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : NarrowDef-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowUser = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Handle data flow merges and bizarre phi cycles.</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Widened.insert(NarrowUser).second)</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NonNegativeUse = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NonNegativeDef) &#123;</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We might have a control-dependent range information for this context.</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RangeInfo = getPostIncRangeInfo(NarrowDef, NarrowUser))</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">        NonNegativeUse = RangeInfo-&gt;getSignedMin().isNonNegative();</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">    NarrowIVUsers.emplace&#95;back(NarrowDef, NarrowUser, WideDef,</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">                               NonNegativeDef || NonNegativeUse);</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlightComment">/// Process a single induction variable. First use the SCEVExpander to create a</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlightComment">/// wide induction variable that evaluates to the same recurrence as the</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlightComment">/// original narrow IV. Then use a worklist to forward traverse the narrow IV&#39;s</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><span class="doxyHighlightComment">/// def-use chain. After widenIVUse has processed all interesting IV users, the</span></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlightComment">/// narrow IV will be isolated for removal by DeleteDeadPHIs.</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlightComment">/// It would be simpler to delete uses as they are processed, but we must avoid</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlightComment">/// invalidating SCEV expressions.</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034" lineLink="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a5586ec5eac8a93b87b095f949ea8daf3"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a5586ec5eac8a93b87b095f949ea8daf3">WidenIV::createWideIV</a>(<a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>) &#123;</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Is this phi an induction variable?</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;AddRec = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;getSCEV(OrigPhi));</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AddRec)</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Widen the induction variable expression.</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;WideIVExpr = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a49e339292d507be61d9087d9aa664595">getExtendKind</a>(OrigPhi) == ExtendKind::Sign</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">                               ? SE-&gt;getSignExtendExpr(AddRec, WideType)</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">                               : SE-&gt;getZeroExtendExpr(AddRec, WideType);</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SE-&gt;getEffectiveSCEVType(WideIVExpr-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()) == WideType &amp;&amp;</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expect the new IV expression to preserve its type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Can the IV be extended outside the loop without overflow?</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">  AddRec = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(WideIVExpr);</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AddRec || AddRec-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>() != L)</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// An AddRec must have loop-invariant operands. Since this AddRec is</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// materialized by a loop header phi, the expression cannot have any post-loop</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// operands, so they must dominate the loop header.</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">      SE-&gt;properlyDominates(AddRec-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a19c13fe96d59c787e900b7bbf7173263">getStart</a>(), L-&gt;getHeader()) &amp;&amp;</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">      SE-&gt;properlyDominates(AddRec-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a4049f7040a4628b15f182c3c9aaf802a">getStepRecurrence</a>(&#42;SE), L-&gt;getHeader()) &amp;&amp;</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;Loop header phi recurrence inputs do not dominate the loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate over IV uses (including transitive ones) looking for IV increments</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the form &#39;add nsw %iv, &lt;const&gt;&#39;. For each increment and each use of</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the increment calculate control-dependent range information basing on</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dominating conditions inside of the loop (e.g. a range check inside of the</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop). Calculated ranges are stored in PostIncRangeInfos map.</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Control-dependent range information is later used to prove that a narrow</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// definition is not negative (see pushNarrowIVUsers). It&#39;s difficult to do</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this on demand because when pushNarrowIVUsers needs this information some</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the dominating conditions might be already widened.</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsePostIncrementRanges)</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">    calculatePostIncRanges(OrigPhi);</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The rewriter provides a value for the desired IV expression. This may</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// either find an existing phi or materialize a new one. Either way, we</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// expect a well-formed cyclic phi-with-increments. i.e. any operand not part</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the phi-SCC dominates the loop entry.</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;InsertPt = &amp;&#42;L-&gt;getHeader()-&gt;getFirstInsertionPt();</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExpandInst = <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.expandCodeFor(AddRec, WideType, InsertPt);</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the wide phi is not a phi node, for example a cast node, like bitcast,</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// inttoptr, ptrtoint, just skip for now.</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!(WidePhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(ExpandInst))) &#123;</span></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// if the cast node is an inserted instruction without any user, we should</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// remove it to make sure the pass don&#39;t touch the function as we can not</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// wide the phi.</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExpandInst-&gt;<a href="/docs/api/classes/llvm/value/#a7c779ce2ba55bc94f52014fc25f3d520">hasNUses</a>(0) &amp;&amp;</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>.isInsertedInstruction(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(ExpandInst)))</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">      DeadInsts.emplace&#95;back(ExpandInst);</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remembering the WideIV increment generated by SCEVExpander allows</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// widenIVUse to reuse it when widening the narrow IV&#39;s increment. We don&#39;t</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// employ a general reuse mechanism because the call above is the only call to</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SCEVExpander. Henceforth, we produce 1-to-1 narrow to wide uses.</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LatchBlock = L-&gt;getLoopLatch()) &#123;</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">    WideInc =</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(WidePhi-&gt;getIncomingValueForBlock(LatchBlock));</span></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WideInc) &#123;</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">      WideIncExpr = SE-&gt;getSCEV(WideInc);</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Propagate the debug location associated with the original loop</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// increment to the new (widened) increment.</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OrigInc =</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(OrigPhi-&gt;getIncomingValueForBlock(LatchBlock));</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">      WideInc-&gt;setDebugLoc(OrigInc-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We are replacing a narrow IV increment with a wider IV increment. If</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the original (narrow) increment did not wrap, the wider increment one</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// should not wrap either. Set the flags to be the union of both wide</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// increment and original increment; this ensures we preserve flags SCEV</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// could infer for the wider increment. Limit this only to cases where</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// both increments directly increment the corresponding PHI nodes and have</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the same opcode. It is not safe to re-use the flags from the original</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// increment, if it is more complex and SCEV expansion may have yielded a</span></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// more simplified wider increment.</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/scevexpander/#aad8311debca961aeee16791414f9efa1">SCEVExpander::canReuseFlagsFromOriginalIVInc</a>(OrigPhi, WidePhi,</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlight">                                                       OrigInc, WideInc) &amp;&amp;</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;OverflowingBinaryOperator&gt;</a>(OrigInc) &amp;&amp;</span></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;OverflowingBinaryOperator&gt;</a>(WideInc)) &#123;</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">        WideInc-&gt;setHasNoUnsignedWrap(WideInc-&gt;hasNoUnsignedWrap() ||</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlight">                                      OrigInc-&gt;hasNoUnsignedWrap());</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">        WideInc-&gt;setHasNoSignedWrap(WideInc-&gt;hasNoSignedWrap() ||</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">                                    OrigInc-&gt;hasNoSignedWrap());</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Wide IV: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;WidePhi &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">  ++NumWidened;</span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Traverse the def-use chain using a worklist starting at the original IV.</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Widened.empty() &amp;&amp; NarrowIVUsers.empty() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;expect initial state&quot;</span><span class="doxyHighlight"> );</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlight">  Widened.insert(OrigPhi);</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#ac65b91bafca4f727e589bdfbfb79edc1">pushNarrowIVUsers</a>(OrigPhi, WidePhi);</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!NarrowIVUsers.empty()) &#123;</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse">WidenIV::NarrowIVDefUse</a> DU = NarrowIVUsers.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Process a def-use edge. This may replace the use, so don&#39;t hold a</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// use&#95;iterator across it.</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;WideUse = <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#a39eadf98e4773739cd4e7b4befee6fb5">widenIVUse</a>(DU, <a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>, OrigPhi, WidePhi);</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Follow all def-use edges from the previous narrow use.</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WideUse)</span></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-simplifyindvar-cpp-/wideniv/#ac65b91bafca4f727e589bdfbfb79edc1">pushNarrowIVUsers</a>(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a7d5e94a7ebb4f2950eec1132228f6556">NarrowUse</a>, WideUse);</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// widenIVUse may have removed the def-use edge.</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>-&gt;<a href="/docs/api/classes/llvm/value/#a9d7de807ebdfe1819df3ff6cb0f16158">use&#95;empty</a>())</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><span class="doxyHighlight">      DeadInsts.emplace&#95;back(DU.<a href="/docs/api/structs/anonymous-namespace-simplifyindvar-cpp-/wideniv/narrowivdefuse/#a5e016da67d6b8bbf10f63bb125d25e11">NarrowDef</a>);</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Attach any debug information to the new PHI.</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a9784a018b2dd6a85ee8a70f5f5ab3d02">replaceAllDbgUsesWith</a>(&#42;OrigPhi, &#42;WidePhi, &#42;WidePhi, &#42;DT);</span></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WidePhi;</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlightComment">/// Calculates control-dependent range for the given def at the given context</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><span class="doxyHighlightComment">/// by looking at dominating conditions inside of the loop</span></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> WidenIV::calculatePostIncRange(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowDef,</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NarrowUser) &#123;</span></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NarrowDefLHS;</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> &#42;NarrowDefRHS;</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(NarrowDef, <a href="/docs/api/namespaces/llvm/patternmatch/#ab65bddcf2ef369ad6d5678882800a7da">m&#95;NSWAdd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(NarrowDefLHS),</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlight">                                 <a href="/docs/api/namespaces/llvm/patternmatch/#aac9e78b3aa02ec087c4621358f506718">m&#95;APInt</a>(NarrowDefRHS))) ||</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><span class="doxyHighlight">      !NarrowDefRHS-&gt;<a href="/docs/api/classes/llvm/apint/#ac8c0157adbe12649beac0009c2f6ad8d">isNonNegative</a>())</span></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> UpdateRangeFromCondition = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Condition, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TrueDest) &#123;</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> Pred;</span></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CmpRHS;</span></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Condition, <a href="/docs/api/namespaces/llvm/patternmatch/#ab86c85b47e09489dcda68fd91d082d77">m&#95;ICmp</a>(Pred, <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(NarrowDefLHS),</span></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">                                 <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(CmpRHS))))</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = TrueDest ? Pred : <a href="/docs/api/classes/llvm/icmpinst/#a756b791b5d2db592f79607b0776caa8c">ICmpInst::getInverseCmpPredicate</a>(Pred);</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CmpRHSRange = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a3498df9755182f44e759fd3eeb688e9f">getSignedRange</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(CmpRHS));</span></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CmpConstrainedLHSRange =</span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/constantrange/#aa0830ec6778859b4abb3e8bf0b9e0e38">ConstantRange::makeAllowedICmpRegion</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, CmpRHSRange);</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> NarrowDefRange = CmpConstrainedLHSRange.addWithNoWrap(</span></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><span class="doxyHighlight">        &#42;NarrowDefRHS, <a href="/docs/api/classes/llvm/overflowingbinaryoperator/#a1d0f9e84fb5d277edd8530e7afbb674aac3172f238278728e355fc9a87c439dd5">OverflowingBinaryOperator::NoSignedWrap</a>);</span></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><span class="doxyHighlight">    updatePostIncRangeInfo(NarrowDef, NarrowUser, NarrowDefRange);</span></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> UpdateRangeFromGuards = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Ctx) &#123;</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasGuards)</span></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(Ctx-&gt;getIterator().getReverse(),</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">                                     Ctx-&gt;getParent()-&gt;rend())) &#123;</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::experimental&#95;guard&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))))</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><span class="doxyHighlight">        UpdateRangeFromCondition(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, </span><span class="doxyHighlightComment">/&#42;TrueDest=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">  UpdateRangeFromGuards(NarrowUser);</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;NarrowUserBB = NarrowUser-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If NarrowUserBB is statically unreachable asking dominator queries may</span></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// yield surprising results. (e.g. the block may not have a dom tree node)</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT-&gt;isReachableFromEntry(NarrowUserBB))</span></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;DTB = (&#42;DT)&#91;NarrowUserBB&#93;-&gt;getIDom();</span></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><span class="doxyHighlight">       L-&gt;contains(DTB-&gt;getBlock());</span></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight">       DTB = DTB-&gt;getIDom()) &#123;</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB = DTB-&gt;getBlock();</span></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;TI = BB-&gt;getTerminator();</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><span class="doxyHighlight">    UpdateRangeFromGuards(TI);</span></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(TI);</span></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI || !BI-&gt;isConditional())</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;TrueSuccessor = BI-&gt;getSuccessor(0);</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FalseSuccessor = BI-&gt;getSuccessor(1);</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DominatesNarrowUser = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, NarrowUser&#93; (BasicBlockEdge BBE) &#123;</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BBE.isSingleEdge() &amp;&amp;</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">             DT-&gt;dominates(BBE, NarrowUser-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DominatesNarrowUser(BasicBlockEdge(BB, TrueSuccessor)))</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><span class="doxyHighlight">      UpdateRangeFromCondition(BI-&gt;getCondition(), </span><span class="doxyHighlightComment">/&#42;TrueDest=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DominatesNarrowUser(BasicBlockEdge(BB, FalseSuccessor)))</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlight">      UpdateRangeFromCondition(BI-&gt;getCondition(), </span><span class="doxyHighlightComment">/&#42;TrueDest=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlightComment">/// Calculates PostIncRangeInfos map for the given IV</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> WidenIV::calculatePostIncRanges(PHINode &#42;OrigPhi) &#123;</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlight">  SmallPtrSet&lt;Instruction &#42;, 16&gt; Visited;</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Instruction &#42;, 6&gt;</a> Worklist;</span></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlight">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OrigPhi);</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><span class="doxyHighlight">  Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(OrigPhi);</span></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;NarrowDef = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &amp;U : NarrowDef-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</span></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NarrowUser = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser());</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t go looking outside the current loop.</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NarrowUserLoop = (&#42;LI)&#91;NarrowUser-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()&#93;;</span></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NarrowUserLoop || !L-&gt;contains(NarrowUserLoop))</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(NarrowUser).second)</span></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(NarrowUser);</span></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">      calculatePostIncRange(NarrowDef, NarrowUser);</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263" lineLink="/docs/api/namespaces/llvm/#a35edc71a3e9b62bcfa5b80ae369515d9"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/namespaces/llvm/#a35edc71a3e9b62bcfa5b80ae369515d9">llvm::createWideIV</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/wideivinfo">WideIVInfo</a> &amp;WI,</span></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE, <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> &amp;<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>,</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;WeakTrackingVH&gt;</a> &amp;DeadInsts,</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;NumElimExt, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;NumWidened,</span></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasGuards, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp/#accc15a102c8ad5b2f46c6b23ca331f4c">UsePostIncrementRanges</a>) &#123;</span></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopflatten-cpp/#a7d78113283f5e24797aab3b98480e77b">WidenIV</a> Widener(WI, LI, SE, DT, DeadInsts, HasGuards, <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/indvarsimplify-cpp/#accc15a102c8ad5b2f46c6b23ca331f4c">UsePostIncrementRanges</a>);</span></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;WidePHI = Widener.createWideIV(<a href="/docs/api/files/lib/lib/codegen/virtregmap-cpp/#a1ad52109a2ff430460c8776286b97b2e">Rewriter</a>);</span></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlight">  NumElimExt = Widener.getNumElimExt();</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlight">  NumWidened = Widener.getNumWidened();</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WidePHI;</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
