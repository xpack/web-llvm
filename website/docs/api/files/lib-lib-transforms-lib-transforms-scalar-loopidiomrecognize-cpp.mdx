---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `LoopIdiomRecognize.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/Scalar/LoopIdiomRecognize.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/loopidiomrecognize-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/APInt.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/MapVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/StringRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AliasAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CmpInstAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/cmpinstanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopPass.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/looppass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemoryLocation.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memorylocation-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemorySSA.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssa-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MemorySSAUpdater.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssaupdater-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/MustExecute.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/mustexecute-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/OptimizationRemarkEmitter.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolution.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolutionExpressions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetLibraryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugLoc.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalValue.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalVariable.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PassManager.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ValueHandle.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/InstructionCost.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/instructioncost-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BuildLibCalls.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/buildlibcalls-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looputils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/ScalarEvolutionExpander.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/scalarevolutionexpander-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-loopidiomrecognize-cpp-">anonymous&#123;LoopIdiomRecognize.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/loopidiomrecognize">LoopIdiomRecognize</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/memmoveverifier">MemmoveVerifier</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/match-loopinvariant">match_LoopInvariant&lt;SubPattern_t&gt;</a></>}>
Match loop-invariant value. <a href="/docs/api/structs/match-loopinvariant/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;</>}
  name={<><a href="#a30a82385a4d14528fdc9819501044523">createFFSIntrinsic</a> (IRBuilder&lt;&gt; &amp;IRBuilder, Value &#42;Val, const DebugLoc &amp;DL, bool ZeroCheck, Intrinsic::ID IID)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;</>}
  name={<><a href="#a7891243700b67217e42c82bb4224eb0c">createPopcntIntrinsic</a> (IRBuilder&lt;&gt; &amp;IRBuilder, Value &#42;Val, const DebugLoc &amp;DL)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aebc62faf59fecc07e8471fcf035d789e">deleteDeadInstruction</a> (Instruction &#42;I)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a48f061a53492f73dc9d82812f4350b44">detectPopcountIdiom</a> (Loop &#42;CurLoop, BasicBlock &#42;PreCondBB, Instruction &#42;&amp;CntInst, PHINode &#42;&amp;CntPhi, Value &#42;&amp;Var)</>}>
Return true iff the idiom is detected in the loop. <a href="#a48f061a53492f73dc9d82812f4350b44">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a419746e2bdc89fee0101b010a13ec0c7">detectShiftUntilBitTestIdiom</a> (Loop &#42;CurLoop, Value &#42;&amp;BaseX, Value &#42;&amp;BitMask, Value &#42;&amp;BitPos, Value &#42;&amp;CurrX, Instruction &#42;&amp;NextX)</>}>
Return true if the idiom is detected in the loop. <a href="#a419746e2bdc89fee0101b010a13ec0c7">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3a0cafd820690b73a6169ab519d77d2a">detectShiftUntilLessThanIdiom</a> (Loop &#42;CurLoop, const DataLayout &amp;DL, Intrinsic::ID &amp;IntrinID, Value &#42;&amp;InitX, Instruction &#42;&amp;CntInst, PHINode &#42;&amp;CntPhi, Instruction &#42;&amp;DefX, APInt &amp;Threshold)</>}>
Return true if the idiom is detected in the loop. <a href="#a3a0cafd820690b73a6169ab519d77d2a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a7ff0d8853961745bbe8afef66fab99dc">detectShiftUntilZeroIdiom</a> (Loop &#42;CurLoop, const DataLayout &amp;DL, Intrinsic::ID &amp;IntrinID, Value &#42;&amp;InitX, Instruction &#42;&amp;CntInst, PHINode &#42;&amp;CntPhi, Instruction &#42;&amp;DefX)</>}>
Return true if the idiom is detected in the loop. <a href="#a7ff0d8853961745bbe8afef66fab99dc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab329d363cb73927378483de592986282">detectShiftUntilZeroIdiom</a> (Loop &#42;CurLoop, ScalarEvolution &#42;SE, Instruction &#42;&amp;ValShiftedIsZero, Intrinsic::ID &amp;IntrinID, Instruction &#42;&amp;IV, Value &#42;&amp;Start, Value &#42;&amp;Val, const SCEV &#42;&amp;ExtraOffsetExpr, bool &amp;InvertedCond)</>}>
Return true if the idiom is detected in the loop. <a href="#ab329d363cb73927378483de592986282">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/constant">Constant</a> &#42;</>}
  name={<><a href="#a52ab2351fc0de7ffe5198fd144d98f8b">getMemSetPatternValue</a> (Value &#42;V, const DataLayout &#42;DL)</>}>
getMemSetPatternValue - If a strided store of the specified value is safe to turn into a memset&#95;pattern16, return a <a href="/docs/api/classes/llvm/constantarray">ConstantArray</a> of 16 bytes that should be passed in. <a href="#a52ab2351fc0de7ffe5198fd144d98f8b">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;</>}
  name={<><a href="#a7bdf6d6bf51cc1a22329cd775255d0c8">getNumBytes</a> (const SCEV &#42;BECount, Type &#42;IntPtr, const SCEV &#42;StoreSizeSCEV, Loop &#42;CurLoop, const DataLayout &#42;DL, ScalarEvolution &#42;SE)</>}>
Compute the number of bytes as a <a href="/docs/api/classes/llvm/scev">SCEV</a> from the backedge taken count. <a href="#a7bdf6d6bf51cc1a22329cd775255d0c8">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;</>}
  name={<><a href="#a0554350a6af85d4e8cf06cd9ca2b5556">getRecurrenceVar</a> (Value &#42;VarX, Instruction &#42;DefX, BasicBlock &#42;LoopEntry)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;</>}
  name={<><a href="#ab0f2467f35df49e4d9d0c9623e2530cf">getStartForNegStride</a> (const SCEV &#42;Start, const SCEV &#42;BECount, Type &#42;IntPtr, const SCEV &#42;StoreSizeSCEV, ScalarEvolution &#42;SE)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/apint">APInt</a></>}
  name={<><a href="#ab10dcc08be6d7ecc655688c7f5e5fcca">getStoreStride</a> (const SCEVAddRecExpr &#42;StoreEv)</>}>
</MembersIndexItem>

<MembersIndexItem
  template={<>template &lt;typename Ty&gt;</>}
  type="auto "
  name={<><a href="#aba9b4dc5dd854ec2a8c8d92c0df7b4cd">m&#95;LoopInvariant</a> (const Ty &amp;M, const Loop &#42;L) -&gt; <a href="/docs/api/structs/match-loopinvariant">match&#95;LoopInvariant</a>&lt; Ty &gt;</>}>
Matches if the value is loop-invariant. <a href="#aba9b4dc5dd854ec2a8c8d92c0df7b4cd">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a0334b7852f3d535571315a1c2a90a085">matchCondition</a> (BranchInst &#42;BI, BasicBlock &#42;LoopEntry, bool JmpOnZero=false)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the given conditional branch is based on the comparison between a variable and zero, and if the variable is non-zero or zero (JmpOnZero is true), the control yields to the loop entry. <a href="#a0334b7852f3d535571315a1c2a90a085">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#ab57bfa30e7fbef3fb394f7bd5cfa6d0a">matchShiftULTCondition</a> (BranchInst &#42;BI, BasicBlock &#42;LoopEntry, APInt &amp;Threshold)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the given conditional branch is based on an unsigned less-than comparison between a variable and a constant, and if the comparison is false the control yields to the loop entry. <a href="#ab57bfa30e7fbef3fb394f7bd5cfa6d0a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ade6253c0c19609ec9c632e60e08896fb">mayLoopAccessLocation</a> (Value &#42;Ptr, ModRefInfo Access, Loop &#42;L, const SCEV &#42;BECount, const SCEV &#42;StoreSizeSCEV, AliasAnalysis &amp;AA, SmallPtrSetImpl&lt; Instruction &#42; &gt; &amp;IgnoredInsts)</>}>
mayLoopAccessLocation - Return true if the specified loop might access the specified pointer location, which is a loop-strided access. <a href="#ade6253c0c19609ec9c632e60e08896fb">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a2b7da78e014d92d342aac4bfd3b3bc1e">STATISTIC</a> (NumMemSet, &quot;Number of memset&#39;s formed from loop stores&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a349e356d18ce46bb85b533143506f254">STATISTIC</a> (NumMemCpy, &quot;Number of memcpy&#39;s formed from loop load+stores&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a2d1bdae884eea22af54117c934c9c93d">STATISTIC</a> (NumMemMove, &quot;Number of memmove&#39;s formed from loop load+stores&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a89ad4acbf0681e12e43f7363cf71053b">STATISTIC</a> (NumShiftUntilBitTest, &quot;Number of uncountable loops recognized as &#39;shift until bitttest&#39; idiom&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a901ad8ccbb4877ea350b15fcdec2a123">STATISTIC</a> (NumShiftUntilZero, &quot;Number of uncountable loops recognized as &#39;shift until zero&#39; idiom&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool, <a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a> &gt;</>}
  name={<><a href="#adcce5ae6807bec6d3bdb7185bb663437">DisableLIRPAll</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool, <a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a> &gt;</>}
  name={<><a href="#a641a8a5a255b20fc675c2df1d5289f57">DisableLIRPMemcpy</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool, <a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a> &gt;</>}
  name={<><a href="#a1e107de4ffbcc60bc6234e85008da357">DisableLIRPMemset</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#af1a09d9861f8c2c215325b09560a2d24">UseLIRCodeSizeHeurs</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;loop-idiom&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### createFFSIntrinsic() {#a30a82385a4d14528fdc9819501044523}

<MemberDefinition
  prototype={<>static CallInst &#42; createFFSIntrinsic (<a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt; &amp; IRBuilder, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Val, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp; DL, bool ZeroCheck, <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID)</>}
  labels = {["static"]}>

Definition at line <a href="#l02130">2130</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### createPopcntIntrinsic() {#a7891243700b67217e42c82bb4224eb0c}

<MemberDefinition
  prototype={<>static CallInst &#42; createPopcntIntrinsic (<a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>&lt;&gt; &amp; IRBuilder, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Val, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp; DL)</>}
  labels = {["static"]}>

Definition at line <a href="#l02119">2119</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### deleteDeadInstruction() {#aebc62faf59fecc07e8471fcf035d789e}

<MemberDefinition
  prototype={<>static void deleteDeadInstruction (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I)</>}
  labels = {["static"]}>

Definition at line <a href="#l00278">278</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### detectPopcountIdiom() {#a48f061a53492f73dc9d82812f4350b44}

<MemberDefinition
  prototype={<>static bool detectPopcountIdiom (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; PreCondBB, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp; CntInst, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp; CntPhi, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; Var)</>}
  labels = {["static"]}>
Return true iff the idiom is detected in the loop.

Additionally: 1) <code>CntInst</code> is set to the instruction counting the population bit. 2) <code>CntPhi</code> is set to the corresponding phi node. 3) <code>Var</code> is set to the value whose population bits are being counted.

The core idiom we are trying to detect is: 
<ProgramListing>

<CodeLine><span class="doxyHighlight">   if (x0 != 0)</span></CodeLine>
<CodeLine><span class="doxyHighlight">     goto loop-exit // the precondition of the loop</span></CodeLine>
<CodeLine><span class="doxyHighlight">   cnt0 = init-val;</span></CodeLine>
<CodeLine><span class="doxyHighlight">   do &#123;</span></CodeLine>
<CodeLine><span class="doxyHighlight">      x1 = phi (x0, x2);</span></CodeLine>
<CodeLine><span class="doxyHighlight">      cnt1 = phi(cnt0, cnt2);</span></CodeLine>
<CodeLine></CodeLine>
<CodeLine><span class="doxyHighlight">      cnt2 = cnt1 + 1;</span></CodeLine>
<CodeLine><span class="doxyHighlight">       ...</span></CodeLine>
<CodeLine><span class="doxyHighlight">      x2 = x1 &amp; (x1 - 1);</span></CodeLine>
<CodeLine><span class="doxyHighlight">       ...</span></CodeLine>
<CodeLine><span class="doxyHighlight">   &#125; while(x != 0);</span></CodeLine>
<CodeLine></CodeLine>
<CodeLine><span class="doxyHighlight">loop-exit:</span></CodeLine>

</ProgramListing>

Definition at line <a href="#l01691">1691</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### detectShiftUntilBitTestIdiom() {#a419746e2bdc89fee0101b010a13ec0c7}

<MemberDefinition
  prototype={<>static bool detectShiftUntilBitTestIdiom (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; BaseX, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; BitMask, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; BitPos, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; CurrX, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp; NextX)</>}
  labels = {["static"]}>
Return true if the idiom is detected in the loop.

The core idiom we are trying to detect is: 
<ProgramListing>

<CodeLine><span class="doxyHighlight">entry:</span></CodeLine>
<CodeLine><span class="doxyHighlight">  &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %bitmask = shl i32 1, %bitpos</span></CodeLine>
<CodeLine><span class="doxyHighlight">  br label %loop</span></CodeLine>
<CodeLine></CodeLine>
<CodeLine><span class="doxyHighlight">loop:</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %x.curr = phi i32 &#91; %x, %entry &#93;, &#91; %x.next, %loop &#93;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %x.curr.bitmasked = and i32 %x.curr, %bitmask</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %x.curr.isbitunset = icmp eq i32 %x.curr.bitmasked, 0</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %x.next = shl i32 %x.curr, 1</span></CodeLine>
<CodeLine><span class="doxyHighlight">  &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  br i1 %x.curr.isbitunset, label %loop, label %end</span></CodeLine>
<CodeLine></CodeLine>
<CodeLine><span class="doxyHighlight">end:</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %x.curr.res = phi i32 &#91; %x.curr, %loop &#93; &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %x.next.res = phi i32 &#91; %x.next, %loop &#93; &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  &lt;...&gt;</span></CodeLine>

</ProgramListing>

Definition at line <a href="#l02415">2415</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### detectShiftUntilLessThanIdiom() {#a3a0cafd820690b73a6169ab519d77d2a}

<MemberDefinition
  prototype={<>static bool detectShiftUntilLessThanIdiom (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> &amp; IntrinID, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; InitX, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp; CntInst, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp; CntPhi, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp; DefX, <a href="/docs/api/classes/llvm/apint">APInt</a> &amp; Threshold)</>}
  labels = {["static"]}>
Return true if the idiom is detected in the loop.

Additionally: 1) <code>CntInst</code> is set to the instruction Counting Leading Zeros (CTLZ) or nullptr if there is no such. 2) <code>CntPhi</code> is set to the corresponding phi node or nullptr if there is no such. 3) <code>InitX</code> is set to the value whose CTLZ could be used. 4) <code>DefX</code> is set to the instruction calculating <a href="/docs/api/classes/llvm/loop">Loop</a> exit condition. 5) <code>Threshold</code> is set to the constant involved in the unsigned less-than comparison.

The core idiom we are trying to detect is: 
<ProgramListing>

<CodeLine><span class="doxyHighlight">   if (x0 &lt; 2)</span></CodeLine>
<CodeLine><span class="doxyHighlight">     goto loop-exit // the precondition of the loop</span></CodeLine>
<CodeLine><span class="doxyHighlight">   cnt0 = init-val</span></CodeLine>
<CodeLine><span class="doxyHighlight">   do &#123;</span></CodeLine>
<CodeLine><span class="doxyHighlight">     x = phi (x0, x.next);   //PhiX</span></CodeLine>
<CodeLine><span class="doxyHighlight">     cnt = phi (cnt0, cnt.next)</span></CodeLine>
<CodeLine></CodeLine>
<CodeLine><span class="doxyHighlight">     cnt.next = cnt + 1;</span></CodeLine>
<CodeLine><span class="doxyHighlight">      ...</span></CodeLine>
<CodeLine><span class="doxyHighlight">     x.next = x &gt;&gt; 1;   // DefX</span></CodeLine>
<CodeLine><span class="doxyHighlight">   &#125; while (x &gt;= 4)</span></CodeLine>
<CodeLine><span class="doxyHighlight">loop-exit:</span></CodeLine>

</ProgramListing>

Definition at line <a href="#l01593">1593</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### detectShiftUntilZeroIdiom() {#a7ff0d8853961745bbe8afef66fab99dc}

<MemberDefinition
  prototype={<>static bool detectShiftUntilZeroIdiom (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL, <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> &amp; IntrinID, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; InitX, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp; CntInst, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp; CntPhi, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp; DefX)</>}
  labels = {["static"]}>
Return true if the idiom is detected in the loop.

Additionally: 1) <code>CntInst</code> is set to the instruction Counting Leading Zeros (CTLZ) or nullptr if there is no such. 2) <code>CntPhi</code> is set to the corresponding phi node or nullptr if there is no such. 3) <code>Var</code> is set to the value whose CTLZ could be used. 4) <code>DefX</code> is set to the instruction calculating <a href="/docs/api/classes/llvm/loop">Loop</a> exit condition.

The core idiom we are trying to detect is: 
<ProgramListing>

<CodeLine><span class="doxyHighlight">   if (x0 == 0)</span></CodeLine>
<CodeLine><span class="doxyHighlight">     goto loop-exit // the precondition of the loop</span></CodeLine>
<CodeLine><span class="doxyHighlight">   cnt0 = init-val;</span></CodeLine>
<CodeLine><span class="doxyHighlight">   do &#123;</span></CodeLine>
<CodeLine><span class="doxyHighlight">      x = phi (x0, x.next);   //PhiX</span></CodeLine>
<CodeLine><span class="doxyHighlight">      cnt = phi(cnt0, cnt.next);</span></CodeLine>
<CodeLine></CodeLine>
<CodeLine><span class="doxyHighlight">      cnt.next = cnt + 1;</span></CodeLine>
<CodeLine><span class="doxyHighlight">       ...</span></CodeLine>
<CodeLine><span class="doxyHighlight">      x.next = x &gt;&gt; 1;   // DefX</span></CodeLine>
<CodeLine><span class="doxyHighlight">       ...</span></CodeLine>
<CodeLine><span class="doxyHighlight">   &#125; while(x.next != 0);</span></CodeLine>
<CodeLine></CodeLine>
<CodeLine><span class="doxyHighlight">loop-exit:</span></CodeLine>

</ProgramListing>

Definition at line <a href="#l01824">1824</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### detectShiftUntilZeroIdiom() {#ab329d363cb73927378483de592986282}

<MemberDefinition
  prototype={<>static bool detectShiftUntilZeroIdiom (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42; SE, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp; ValShiftedIsZero, <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> &amp; IntrinID, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp; IV, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; Start, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp; Val, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;&amp; ExtraOffsetExpr, bool &amp; InvertedCond)</>}
  labels = {["static"]}>
Return true if the idiom is detected in the loop.

The core idiom we are trying to detect is: 
<ProgramListing>

<CodeLine><span class="doxyHighlight">entry:</span></CodeLine>
<CodeLine><span class="doxyHighlight">  &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %start = &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %extraoffset = &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  br label %for.cond</span></CodeLine>
<CodeLine></CodeLine>
<CodeLine><span class="doxyHighlight">loop:</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %iv = phi i8 &#91; %start, %entry &#93;, &#91; %iv.next, %for.cond &#93;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %nbits = add nsw i8 %iv, %extraoffset</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %val.shifted = &#123;&#123;l,a&#125;shr,shl&#125; i8 %val, %nbits</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %val.shifted.iszero = icmp eq i8 %val.shifted, 0</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %iv.next = add i8 %iv, 1</span></CodeLine>
<CodeLine><span class="doxyHighlight">  &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  br i1 %val.shifted.iszero, label %end, label %loop</span></CodeLine>
<CodeLine></CodeLine>
<CodeLine><span class="doxyHighlight">end:</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %iv.res = phi i8 &#91; %iv, %loop &#93; &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %nbits.res = phi i8 &#91; %nbits, %loop &#93; &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %val.shifted.res = phi i8 &#91; %val.shifted, %loop &#93; &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %val.shifted.iszero.res = phi i1 &#91; %val.shifted.iszero, %loop &#93; &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  %iv.next.res = phi i8 &#91; %iv.next, %loop &#93; &lt;...&gt;</span></CodeLine>
<CodeLine><span class="doxyHighlight">  &lt;...&gt;</span></CodeLine>

</ProgramListing>

Definition at line <a href="#l02774">2774</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### getMemSetPatternValue() {#a52ab2351fc0de7ffe5198fd144d98f8b}

<MemberDefinition
  prototype={<>static Constant &#42; getMemSetPatternValue (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42; DL)</>}
  labels = {["static"]}>
getMemSetPatternValue - If a strided store of the specified value is safe to turn into a memset&#95;pattern16, return a <a href="/docs/api/classes/llvm/constantarray">ConstantArray</a> of 16 bytes that should be passed in.

Otherwise, return null.

Note that we don&#39;t ever attempt to use memset&#95;pattern8 or 4, because these just replicate their input array and then pass on to memset&#95;pattern16.

Definition at line <a href="#l00367">367</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### getNumBytes() {#a7bdf6d6bf51cc1a22329cd775255d0c8}

<MemberDefinition
  prototype={<>static const SCEV &#42; getNumBytes (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42; BECount, <a href="/docs/api/classes/llvm/type">Type</a> &#42; IntPtr, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42; StoreSizeSCEV, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; CurLoop, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42; DL, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42; SE)</>}
  labels = {["static"]}>
Compute the number of bytes as a <a href="/docs/api/classes/llvm/scev">SCEV</a> from the backedge taken count.

This also maps the <a href="/docs/api/classes/llvm/scev">SCEV</a> into the provided type and tries to handle the computation in a way that will fold cleanly.

Definition at line <a href="#l00992">992</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### getRecurrenceVar() {#a0554350a6af85d4e8cf06cd9ca2b5556}

<MemberDefinition
  prototype={<>static PHINode &#42; getRecurrenceVar (<a href="/docs/api/classes/llvm/value">Value</a> &#42; VarX, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; DefX, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; LoopEntry)</>}
  labels = {["static"]}>

Definition at line <a href="#l01557">1557</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### getStartForNegStride() {#ab0f2467f35df49e4d9d0c9623e2530cf}

<MemberDefinition
  prototype={<>static const SCEV &#42; getStartForNegStride (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42; Start, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42; BECount, <a href="/docs/api/classes/llvm/type">Type</a> &#42; IntPtr, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42; StoreSizeSCEV, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42; SE)</>}
  labels = {["static"]}>

Definition at line <a href="#l00974">974</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### getStoreStride() {#ab10dcc08be6d7ecc655688c7f5e5fcca}

<MemberDefinition
  prototype={<>static APInt getStoreStride (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42; StoreEv)</>}
  labels = {["static"]}>

Definition at line <a href="#l00356">356</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### m&#95;LoopInvariant() {#aba9b4dc5dd854ec2a8c8d92c0df7b4cd}

<MemberDefinition
  template={<>template &lt;typename Ty&gt;</>}
  prototype={<>match&#95;LoopInvariant&lt; Ty &gt; m&#95;LoopInvariant (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> Ty &amp; M, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L)</>}
  labels = {["inline"]}>
Matches if the value is loop-invariant.

Definition at line <a href="#l02389">2389</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### matchCondition() {#a0334b7852f3d535571315a1c2a90a085}

<MemberDefinition
  prototype={<>static Value &#42; matchCondition (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; LoopEntry, bool JmpOnZero=false)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the given conditional branch is based on the comparison between a variable and zero, and if the variable is non-zero or zero (JmpOnZero is true), the control yields to the loop entry.

If the branch matches the behavior, the variable involved in the comparison is returned. This function will be called to see if the precondition and postcondition of the loop are in desirable form.

Definition at line <a href="#l01501">1501</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### matchShiftULTCondition() {#ab57bfa30e7fbef3fb394f7bd5cfa6d0a}

<MemberDefinition
  prototype={<>static Value &#42; matchShiftULTCondition (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42; BI, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; LoopEntry, <a href="/docs/api/classes/llvm/apint">APInt</a> &amp; Threshold)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the given conditional branch is based on an unsigned less-than comparison between a variable and a constant, and if the comparison is false the control yields to the loop entry.

If the branch matches the behaviour, the variable involved in the comparison is returned.

Definition at line <a href="#l01531">1531</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### mayLoopAccessLocation() {#ade6253c0c19609ec9c632e60e08896fb}

<MemberDefinition
  prototype={<>static bool mayLoopAccessLocation (<a href="/docs/api/classes/llvm/value">Value</a> &#42; Ptr, <a href="/docs/api/namespaces/llvm/#a9db8c44b250b90e3ab7e4d144e7c9c2e">ModRefInfo</a> Access, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42; BECount, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42; StoreSizeSCEV, <a href="/docs/api/namespaces/llvm/#ae457f1cf451ed893666c4a384e58f8e5">AliasAnalysis</a> &amp; AA, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &gt; &amp; IgnoredInsts)</>}
  labels = {["static"]}>
mayLoopAccessLocation - Return true if the specified loop might access the specified pointer location, which is a loop-strided access.

The &#39;Access&#39; argument specifies what the verboten forms of access are (read or write).

Definition at line <a href="#l00936">936</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a2b7da78e014d92d342aac4bfd3b3bc1e}

<MemberDefinition
  prototype={<>STATISTIC (NumMemSet, &quot;Number of memset&#39;s formed from loop stores&quot;)</>}>

Definition at line <a href="#l00097">97</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a349e356d18ce46bb85b533143506f254}

<MemberDefinition
  prototype={<>STATISTIC (NumMemCpy, &quot;Number of memcpy&#39;s formed from loop <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpumarklastscratchload-cpp/#a8a3fe89940744b94ffe5dacd6704c2be">load</a>+stores&quot;)</>}>

Definition at line <a href="#l00098">98</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a2d1bdae884eea22af54117c934c9c93d}

<MemberDefinition
  prototype={<>STATISTIC (NumMemMove, &quot;Number of memmove&#39;s formed from loop <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpumarklastscratchload-cpp/#a8a3fe89940744b94ffe5dacd6704c2be">load</a>+stores&quot;)</>}>

Definition at line <a href="#l00099">99</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a89ad4acbf0681e12e43f7363cf71053b}

<MemberDefinition
  prototype={<>STATISTIC (NumShiftUntilBitTest, &quot;Number of uncountable <a href="/docs/api/files/lib/lib/analysis/loopinfo-cpp/#a49ae40a9c91d665793aaed656c26ca30">loops</a> recognized as &#39;shift until bitttest&#39; idiom&quot;)</>}>

Definition at line <a href="#l00100">100</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a901ad8ccbb4877ea350b15fcdec2a123}

<MemberDefinition
  prototype={<>STATISTIC (NumShiftUntilZero, &quot;Number of uncountable <a href="/docs/api/files/lib/lib/analysis/loopinfo-cpp/#a49ae40a9c91d665793aaed656c26ca30">loops</a> recognized as &#39;shift until <a href="/docs/api/files/lib/lib/objectyaml/elfemitter-cpp/#aa15f84f0499130c4cec8c17e7f7376ce">zero</a>&#39; idiom&quot;)</>}>

Definition at line <a href="#l00103">103</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### DisableLIRPAll {#adcce5ae6807bec6d3bdb7185bb663437}

<MemberDefinition
  prototype={<>cl::opt&lt; bool, true &gt; DisableLIRPAll(&quot;disable-&quot; DEBUG&#95;TYPE &quot;-all&quot;, cl::desc(&quot;Options to disable Loop Idiom Recognize Pass.&quot;), cl::location(DisableLIRP::All), cl::init(false), cl::ReallyHidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00108">108</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### DisableLIRPMemcpy {#a641a8a5a255b20fc675c2df1d5289f57}

<MemberDefinition
  prototype={<>cl::opt&lt; bool, true &gt; DisableLIRPMemcpy(&quot;disable-&quot; DEBUG&#95;TYPE &quot;-memcpy&quot;, cl::desc(&quot;Proceed with loop idiom recognize pass, but do &quot; &quot;not convert loop(s) to memcpy.&quot;), cl::location(DisableLIRP::Memcpy), cl::init(false), cl::ReallyHidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00123">123</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### DisableLIRPMemset {#a1e107de4ffbcc60bc6234e85008da357}

<MemberDefinition
  prototype={<>cl::opt&lt; bool, true &gt; DisableLIRPMemset(&quot;disable-&quot; DEBUG&#95;TYPE &quot;-memset&quot;, cl::desc(&quot;Proceed with loop idiom recognize pass, but do &quot; &quot;not convert loop(s) to memset.&quot;), cl::location(DisableLIRP::Memset), cl::init(false), cl::ReallyHidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00115">115</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

### UseLIRCodeSizeHeurs {#af1a09d9861f8c2c215325b09560a2d24}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; UseLIRCodeSizeHeurs(&quot;use-lir-code-size-heurs&quot;, cl::desc(&quot;Use loop idiom recognition code size heuristics when compiling &quot; &quot;with -Os/-Oz&quot;), cl::init(true), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00129">129</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;loop-idiom&quot;</>}>

Definition at line <a href="#l00095">95</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopidiomrecognize-cpp">LoopIdiomRecognize.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- LoopIdiomRecognize.cpp - Loop idiom recognition --------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This pass implements an idiom recognizer that transforms simple loops into a</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// non-loop form.  In cases that this kicks in, it can be a significant</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">// performance win.</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">// If compiling for code size we avoid idiom recognition if the resulting</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">// code could be larger than the code for the original loop. One way this could</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">// happen is if the loop is not removable after idiom recognition due to the</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">// presence of non-idiom instructions. The initial implementation of the</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">// heuristics applies to idioms in multi-block loops.</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">// TODO List:</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightComment">// Future loop memory idioms to recognize:</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightComment">//   memcmp, strlen, etc.</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightComment">// This could recognize common matrix multiplies and dot product idioms and</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightComment">// replace them with calls to BLAS (if linked in??).</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/scalar/loopidiomrecognize-h">llvm/Transforms/Scalar/LoopIdiomRecognize.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h">llvm/ADT/APInt.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h">llvm/ADT/MapVector.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h">llvm/ADT/StringRef.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/aliasanalysis-h">llvm/Analysis/AliasAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/cmpinstanalysis-h">llvm/Analysis/CmpInstAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h">llvm/Analysis/LoopInfo.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/looppass-h">llvm/Analysis/LoopPass.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memorylocation-h">llvm/Analysis/MemoryLocation.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssa-h">llvm/Analysis/MemorySSA.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/memoryssaupdater-h">llvm/Analysis/MemorySSAUpdater.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/mustexecute-h">llvm/Analysis/MustExecute.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h">llvm/Analysis/ScalarEvolution.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h">llvm/Analysis/ScalarEvolutionExpressions.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h">llvm/IR/DebugLoc.h</a>&quot;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h">llvm/IR/GlobalValue.h</a>&quot;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h">llvm/IR/GlobalVariable.h</a>&quot;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h">llvm/IR/PassManager.h</a>&quot;</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/valuehandle-h">llvm/IR/ValueHandle.h</a>&quot;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/instructioncost-h">llvm/Support/InstructionCost.h</a>&quot;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/buildlibcalls-h">llvm/Transforms/Utils/BuildLibCalls.h</a>&quot;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looputils-h">llvm/Transforms/Utils/LoopUtils.h</a>&quot;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/scalarevolutionexpander-h">llvm/Transforms/Utils/ScalarEvolutionExpander.h</a>&quot;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlightPreprocessor">#include &lt;algorithm&gt;</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlightPreprocessor">#include &lt;cstdint&gt;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlightPreprocessor">#include &lt;vector&gt;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;loop-idiom&quot;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97" lineLink="#a2b7da78e014d92d342aac4bfd3b3bc1e"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMemSet, </span><span class="doxyHighlightStringLiteral">&quot;Number of memset&#39;s formed from loop stores&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98" lineLink="#a349e356d18ce46bb85b533143506f254"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMemCpy, </span><span class="doxyHighlightStringLiteral">&quot;Number of memcpy&#39;s formed from loop load+stores&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99" lineLink="#a2d1bdae884eea22af54117c934c9c93d"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMemMove, </span><span class="doxyHighlightStringLiteral">&quot;Number of memmove&#39;s formed from loop load+stores&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100" lineLink="#a89ad4acbf0681e12e43f7363cf71053b"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">    NumShiftUntilBitTest,</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;Number of uncountable loops recognized as &#39;shift until bitttest&#39; idiom&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103" lineLink="#a901ad8ccbb4877ea350b15fcdec2a123"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumShiftUntilZero,</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of uncountable loops recognized as &#39;shift until zero&#39; idiom&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/disablelirp/#aac47a395ddc8679b300a4b6c112df309">DisableLIRP::All</a>;</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool, true&gt;</a></span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108" lineLink="#adcce5ae6807bec6d3bdb7185bb663437"><span class="doxyHighlight">    <a href="#adcce5ae6807bec6d3bdb7185bb663437">DisableLIRPAll</a>(</span><span class="doxyHighlightStringLiteral">&quot;disable-&quot;</span><span class="doxyHighlight"> <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot;-all&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">                   <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Options to disable Loop Idiom Recognize Pass.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">                   <a href="/docs/api/namespaces/llvm/cl/#ad4de522646a65d987250e3aba9c55931">cl::location</a>(<a href="/docs/api/structs/llvm/disablelirp/#aac47a395ddc8679b300a4b6c112df309">DisableLIRP::All</a>), <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">                   <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40ab81f279502bb9ca74e6629cfb62844be">cl::ReallyHidden</a>);</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/disablelirp/#a6d928236e02987de2267a46cd4211336">DisableLIRP::Memset</a>;</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool, true&gt;</a></span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115" lineLink="#a1e107de4ffbcc60bc6234e85008da357"><span class="doxyHighlight">    <a href="#a1e107de4ffbcc60bc6234e85008da357">DisableLIRPMemset</a>(</span><span class="doxyHighlightStringLiteral">&quot;disable-&quot;</span><span class="doxyHighlight"> <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot;-memset&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">                      <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Proceed with loop idiom recognize pass, but do &quot;</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">                               </span><span class="doxyHighlightStringLiteral">&quot;not convert loop(s) to memset.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">                      <a href="/docs/api/namespaces/llvm/cl/#ad4de522646a65d987250e3aba9c55931">cl::location</a>(<a href="/docs/api/structs/llvm/disablelirp/#a6d928236e02987de2267a46cd4211336">DisableLIRP::Memset</a>), <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">                      <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40ab81f279502bb9ca74e6629cfb62844be">cl::ReallyHidden</a>);</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/disablelirp/#ab19e3cae2e9e472353062a181092d68f">DisableLIRP::Memcpy</a>;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool, true&gt;</a></span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123" lineLink="#a641a8a5a255b20fc675c2df1d5289f57"><span class="doxyHighlight">    <a href="#a641a8a5a255b20fc675c2df1d5289f57">DisableLIRPMemcpy</a>(</span><span class="doxyHighlightStringLiteral">&quot;disable-&quot;</span><span class="doxyHighlight"> <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot;-memcpy&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">                      <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Proceed with loop idiom recognize pass, but do &quot;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">                               </span><span class="doxyHighlightStringLiteral">&quot;not convert loop(s) to memcpy.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">                      <a href="/docs/api/namespaces/llvm/cl/#ad4de522646a65d987250e3aba9c55931">cl::location</a>(<a href="/docs/api/structs/llvm/disablelirp/#ab19e3cae2e9e472353062a181092d68f">DisableLIRP::Memcpy</a>), <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">                      <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40ab81f279502bb9ca74e6629cfb62844be">cl::ReallyHidden</a>);</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129" lineLink="#af1a09d9861f8c2c215325b09560a2d24"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#af1a09d9861f8c2c215325b09560a2d24">UseLIRCodeSizeHeurs</a>(</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;use-lir-code-size-heurs&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Use loop idiom recognition code size heuristics when compiling &quot;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;with -Os/-Oz&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135" lineLink="/docs/api/namespaces/anonymous-loopidiomrecognize-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137" lineLink="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/loopidiomrecognize"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/loopidiomrecognize/#afb3715f0d190af3ef4d9d01a3a3301a5">LoopIdiomRecognize</a> &#123;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ae457f1cf451ed893666c4a384e58f8e5">AliasAnalysis</a> &#42;AA;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT;</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI;</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE;</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI;</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI;</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42;DL;</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &amp;ORE;</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ApplyCodeSizeHeuristics;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">  std::unique&#95;ptr&lt;MemorySSAUpdater&gt; MSSAU;</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151" lineLink="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/loopidiomrecognize/#afb3715f0d190af3ef4d9d01a3a3301a5"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">explicit</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/loopidiomrecognize/#afb3715f0d190af3ef4d9d01a3a3301a5">LoopIdiomRecognize</a>(<a href="/docs/api/namespaces/llvm/#ae457f1cf451ed893666c4a384e58f8e5">AliasAnalysis</a> &#42;AA, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE,</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI,</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">                              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI, <a href="/docs/api/classes/llvm/memoryssa">MemorySSA</a> &#42;MSSA,</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">                              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42;DL,</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &amp;ORE)</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">      : AA(AA), DT(DT), LI(LI), SE(SE), TLI(TLI), TTI(TTI), DL(DL), ORE(ORE) &#123;</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MSSA)</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">      MSSAU = std::make&#95;unique&lt;MemorySSAUpdater&gt;(MSSA);</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> runOnLoop(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L);</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">StoreList = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;StoreInst &#42;, 8&gt;</a>;</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">StoreListMap = <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;Value &#42;, StoreList&gt;</a>;</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">  StoreListMap StoreRefsForMemset;</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">  StoreListMap StoreRefsForMemsetPattern;</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">  StoreList StoreRefsForMemcpy;</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasMemset;</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasMemsetPattern;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasMemcpy;</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlightComment">  /// Return code for isLegalStore()</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> LegalStoreKind &#123;</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7a24c2247bd546fc56e2de6cfd04a3d7a116ebf2078ffd98178ffbdd2f544ebb7">None</a> = 0,</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">    Memset,</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">    MemsetPattern,</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">    Memcpy,</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">    UnorderedAtomicMemcpy,</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">    DontUse </span><span class="doxyHighlightComment">// Dummy retval never to be used. Allows catching errors in retval</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// handling.</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlightComment">  /// \\name Countable Loop Idiom Handling</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlightComment">  /// @&#123;</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> runOnCountableLoop();</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> runOnLoopBlock(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount,</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;ExitBlocks);</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> collectStores(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB);</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">  LegalStoreKind isLegalStore(<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">enum class</span><span class="doxyHighlight"> ForMemset &#123; <a href="/docs/api/namespaces/llvm/#adacba4cb06d1dd9232ee3d2d49a44d8fabafd7322c6e97d25b6299b5d6fe8920b">No</a>, <a href="/docs/api/namespaces/llvm/#ac505d74d262ee1e64d87b07121199e36a93cba07454f06a4a960172bbd6e2a435">Yes</a> &#125;;</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> processLoopStores(SmallVectorImpl&lt;StoreInst &#42;&gt; &amp;SL, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;BECount,</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">                         ForMemset For);</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> MemInst&gt;</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> processLoopMemIntrinsic(</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">      BasicBlock &#42;BB,</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/loopidiomrecognize/#afb3715f0d190af3ef4d9d01a3a3301a5">LoopIdiomRecognize</a>::&#42;Processor)(MemInst &#42;, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;),</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;BECount);</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> processLoopMemCpy(MemCpyInst &#42;MCI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;BECount);</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> processLoopMemSet(MemSetInst &#42;MSI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;BECount);</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> processLoopStridedStore(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DestPtr, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;StoreSizeSCEV,</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">                               MaybeAlign StoreAlignment, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;StoredVal,</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">                               Instruction &#42;TheStore,</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">                               SmallPtrSetImpl&lt;Instruction &#42;&gt; &amp;Stores,</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEVAddRecExpr &#42;Ev, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;BECount,</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNegStride, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLoopMemset = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> processLoopStoreOfLoopLoad(StoreInst &#42;SI, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;BECount);</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> processLoopStoreOfLoopLoad(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;DestPtr, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;SourcePtr,</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;StoreSize, MaybeAlign StoreAlign,</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">                                  MaybeAlign LoadAlign, Instruction &#42;TheStore,</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">                                  Instruction &#42;TheLoad,</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEVAddRecExpr &#42;StoreEv,</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEVAddRecExpr &#42;LoadEv,</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;BECount);</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> avoidLIRForMultiBlockLoop(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsMemset = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLoopMemset = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlightComment">  /// @&#125;</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlightComment">  /// \\name Noncountable Loop Idiom Handling</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlightComment">  /// @&#123;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> runOnNoncountableLoop();</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> recognizePopcount();</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> transformLoopToPopcount(BasicBlock &#42;PreCondBB, Instruction &#42;CntInst,</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">                               PHINode &#42;CntPhi, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Var);</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isProfitableToInsertFFS(<a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrinID, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;InitX,</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ZeroCheck, </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> CanonicalSize);</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> insertFFSIfProfitable(<a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrinID, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;InitX,</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">                             Instruction &#42;DefX, PHINode &#42;CntPhi,</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">                             Instruction &#42;CntInst);</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> recognizeAndInsertFFS();  </span><span class="doxyHighlightComment">/// Find First Set: ctlz or cttz</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> recognizeShiftUntilLessThan();</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> transformLoopToCountable(<a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrinID, BasicBlock &#42;PreCondBB,</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">                                Instruction &#42;CntInst, PHINode &#42;CntPhi,</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">                                <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Var, Instruction &#42;DefX,</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> &amp;DL, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ZeroCheck,</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsCntPhiUsedOutsideLoop,</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InsertSub = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> recognizeShiftUntilBitTest();</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> recognizeShiftUntilZero();</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlightComment">  /// @&#125;</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254" lineLink="/docs/api/classes/llvm/loopidiomrecognizepass/#a4a3aed1996ede85e98aa361e6f5d74a2"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/loopidiomrecognizepass/#a4a3aed1996ede85e98aa361e6f5d74a2">LoopIdiomRecognizePass::run</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L, <a href="/docs/api/namespaces/llvm/#a58dde534a0ea2a23cb6c779c5c283f75">LoopAnalysisManager</a> &amp;AM,</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">                                              <a href="/docs/api/structs/llvm/loopstandardanalysisresults">LoopStandardAnalysisResults</a> &amp;AR,</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">                                              <a href="/docs/api/classes/llvm/lpmupdater">LPMUpdater</a> &amp;) &#123;</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/disablelirp/#aac47a395ddc8679b300a4b6c112df309">DisableLIRP::All</a>)</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = &amp;L.getHeader()-&gt;getDataLayout();</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For the new PM, we also can&#39;t use OptimizationRemarkEmitter as an analysis</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pass.  Function analyses need to be preserved across loop transformations</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// but ORE cannot be preserved (see comment before the pass definition).</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> ORE(L.getHeader()-&gt;getParent());</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">  LoopIdiomRecognize LIR(&amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#abd7da877be8576011299f4fcaaf299be">AA</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#aaa96df870a1b3d7ffc56bec3eb0b0cff">DT</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#aa09379aa4435be95eb717dd9b5d8b4c5">LI</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a124376878e24aef4252795ba9fea420f">SE</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a9e363c1eaf112166372e2d52704981fb">TLI</a>, &amp;AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a3444a9359f5f17f1694f82c41d5fd574">TTI</a>,</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">                         AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a1cfb392c267da10531478c2f42baa603">MSSA</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ORE);</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LIR.runOnLoop(&amp;L))</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PA = <a href="/docs/api/namespaces/llvm/#ac7294ba4e105807674fe3a394437fcc1">getLoopPassPreservedAnalyses</a>();</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AR.<a href="/docs/api/structs/llvm/loopstandardanalysisresults/#a1cfb392c267da10531478c2f42baa603">MSSA</a>)</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">    PA.preserve&lt;<a href="/docs/api/classes/llvm/memoryssaanalysis">MemorySSAAnalysis</a>&gt;();</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PA;</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278" lineLink="#aebc62faf59fecc07e8471fcf035d789e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#aebc62faf59fecc07e8471fcf035d789e">deleteDeadInstruction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceAllUsesWith(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()));</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlightComment">//          Implementation of LoopIdiomRecognize</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289" lineLink="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/loopidiomrecognize/#aea65b347936a4be656b8ac3fe1ecd91b"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/loopidiomrecognize/#aea65b347936a4be656b8ac3fe1ecd91b">LoopIdiomRecognize::runOnLoop</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">  CurLoop = L;</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the loop could not be converted to canonical form, it must have an</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// indirectbr in it, just give up.</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L-&gt;getLoopPreheader())</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Disable loop idiom recognition if the function&#39;s name is a common idiom.</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name = L-&gt;getHeader()-&gt;getParent()-&gt;getName();</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Name == </span><span class="doxyHighlightStringLiteral">&quot;memset&quot;</span><span class="doxyHighlight"> || Name == </span><span class="doxyHighlightStringLiteral">&quot;memcpy&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine if code size heuristics need to be applied.</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">  ApplyCodeSizeHeuristics =</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">      L-&gt;getHeader()-&gt;getParent()-&gt;hasOptSize() &amp;&amp; <a href="#af1a09d9861f8c2c215325b09560a2d24">UseLIRCodeSizeHeurs</a>;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">  HasMemset = TLI-&gt;has(LibFunc&#95;memset);</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">  HasMemsetPattern = TLI-&gt;has(LibFunc&#95;memset&#95;pattern16);</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">  HasMemcpy = TLI-&gt;has(LibFunc&#95;memcpy);</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasMemset || HasMemsetPattern || HasMemcpy)</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;hasLoopInvariantBackedgeTakenCount(L))</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> runOnCountableLoop();</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> runOnNoncountableLoop();</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::runOnCountableLoop() &#123;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a22d9bcbd44563106d7217f3bd9a4039e">getBackedgeTakenCount</a>(CurLoop);</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(BECount) &amp;&amp;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;runOnCountableLoop() called on a loop without a predictable&quot;</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;backedge-taken count&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this loop executes exactly one time, then it should be peeled, not</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimized by this pass.</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevconstant">SCEVConstant</a> &#42;BECst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(BECount))</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BECst-&gt;getAPInt() == 0)</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 8&gt;</a> ExitBlocks;</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">  CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ae069a12f0a2d2deb69e30b439a91190e">getUniqueExitBlocks</a>(ExitBlocks);</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Scanning: F&#91;&quot;</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">                    &lt;&lt; CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#93; Countable Loop %&quot;</span><span class="doxyHighlight"> &lt;&lt; CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>()-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The following transforms hoist stores/memsets into the loop pre-header.</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Give up if the loop has instructions that may throw.</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/simpleloopsafetyinfo">SimpleLoopSafetyInfo</a> SafetyInfo;</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">  SafetyInfo.<a href="/docs/api/classes/llvm/simpleloopsafetyinfo/#a262c2df9639d3f71b8d2a8158b819809">computeLoopSafetyInfo</a>(CurLoop);</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SafetyInfo.<a href="/docs/api/classes/llvm/simpleloopsafetyinfo/#aa1b6a065ad4fde175bf904917241cba9">anyBlockMayThrow</a>())</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan all the blocks in the loop that are not in subloops.</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac94e1f7398df9df2508957f58a82279a">getBlocks</a>()) &#123;</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ignore blocks in subloops.</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#ad61bd84d4988c90bf6c5cd62d8e7fb00">getLoopFor</a>(BB) != CurLoop)</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">    MadeChange |= runOnLoopBlock(BB, BECount, ExitBlocks);</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356" lineLink="#ab10dcc08be6d7ecc655688c7f5e5fcca"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="#ab10dcc08be6d7ecc655688c7f5e5fcca">getStoreStride</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;StoreEv) &#123;</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevconstant">SCEVConstant</a> &#42;ConstStride = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVConstant&gt;</a>(StoreEv-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#ad99e00da7acb7973ae006f5b53ce04f6">getOperand</a>(1));</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ConstStride-&gt;<a href="/docs/api/classes/llvm/scevconstant/#a6caf7f3a0a4303e4c0bc06ed8e205126">getAPInt</a>();</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlightComment">/// getMemSetPatternValue - If a strided store of the specified value is safe to</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlightComment">/// turn into a memset&#95;pattern16, return a ConstantArray of 16 bytes that should</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlightComment">/// be passed in.  Otherwise, return null.</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlightComment">/// Note that we don&#39;t ever attempt to use memset&#95;pattern8 or 4, because these</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlightComment">/// just replicate their input array and then pass on to memset&#95;pattern16.</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367" lineLink="#a52ab2351fc0de7ffe5198fd144d98f8b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="#a52ab2351fc0de7ffe5198fd144d98f8b">getMemSetPatternValue</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: This could check for UndefValue because it can be merged into any</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// other valid pattern.</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the value isn&#39;t a constant, we can&#39;t promote it to being in a constant</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// array.  We could theoretically do a store to an alloca or something, but</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that doesn&#39;t seem worthwhile.</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V);</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantExpr&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only handle simple values that are a power of two bytes in size.</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeSizeInBits(V-&gt;getType());</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> == 0 || (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &amp; 7) || (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &amp; (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> - 1)))</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t care enough about darwin/ppc to implement this.</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;isBigEndian())</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convert to size in bytes.</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> /= 8;</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: If CI is larger than 16-bytes, we can try slicing it in half to see</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if the top and bottom are the same (e.g. for vectors and large integers).</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> &gt; 16)</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the constant is exactly 16 bytes, just use it.</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a> == 16)</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, we&#39;ll use an array of the constants.</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ArraySize = 16 / <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">  <a href="/docs/api/classes/arraytype">ArrayType</a> &#42;AT = <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">ArrayType::get</a>(V-&gt;getType(), ArraySize);</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantarray/#a0900dacdc7ad8e3ea0cc92993c7fd422">ConstantArray::get</a>(AT, std::vector&lt;Constant &#42;&gt;(ArraySize, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>));</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">LoopIdiomRecognize::LegalStoreKind</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">LoopIdiomRecognize::isLegalStore(<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t touch volatile stores.</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isVolatile())</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We only want simple or unordered-atomic stores.</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isUnordered())</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid merging nontemporal stores.</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getMetadata(LLVMContext::MD&#95;nontemporal))</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;StoredVal = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand();</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;StorePtr = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand();</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t convert stores of non-integral pointer types to memsets (which stores</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// integers).</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;isNonIntegralPointerType(StoredVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>()))</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reject stores that are so large that they overflow an unsigned.</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When storing out scalable vectors we bail out for now, since the code</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// below currently only works for constant strides.</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/typesize">TypeSize</a> SizeInBits = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeSizeInBits(StoredVal-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SizeInBits.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() || (SizeInBits.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>() &amp; 7) ||</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">      (SizeInBits.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>() &gt;&gt; 32) != 0)</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if the pointer expression is an AddRec like &#123;base,+,1&#125; on the current</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop, which indicates a strided store.  If we have something else, it&#39;s a</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// random store we can&#39;t handle.</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;StoreEv =</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(StorePtr));</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!StoreEv || StoreEv-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>() != CurLoop || !StoreEv-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a54bb7394d874cbbef1d81e6bea89d4f3">isAffine</a>())</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check to see if we have a constant stride.</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVConstant&gt;</a>(StoreEv-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#ad99e00da7acb7973ae006f5b53ce04f6">getOperand</a>(1)))</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if the store can be turned into a memset.</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the stored value is a byte-wise value (like i32 -1), then it may be</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// turned into a memset of i8 -1, assuming that all the consecutive bytes</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are stored.  A store of i32 16909060 can never be turned into a memset,</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// but it can be turned into memset&#95;pattern if the target supports it.</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SplatValue = <a href="/docs/api/namespaces/llvm/#acab8f775ddc87695d750e4838231b3ba">isBytewiseValue</a>(StoredVal, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note: memset and memset&#95;pattern on unordered-atomic is yet not supported</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UnorderedAtomic = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isUnordered() &amp;&amp; !<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isSimple();</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we&#39;re allowed to form a memset, and the stored value would be</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// acceptable for memset, use it.</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UnorderedAtomic &amp;&amp; HasMemset &amp;&amp; SplatValue &amp;&amp; !<a href="/docs/api/structs/llvm/disablelirp/#a6d928236e02987de2267a46cd4211336">DisableLIRP::Memset</a> &amp;&amp;</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Verify that the stored value is loop invariant.  If not, we can&#39;t</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// promote the memset.</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">      CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a6cb6a58fb0ded82b4c7755fc4c27c86d">isLoopInvariant</a>(SplatValue)) &#123;</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// It looks like we can use SplatValue.</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::Memset;</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UnorderedAtomic &amp;&amp; HasMemsetPattern &amp;&amp; !<a href="/docs/api/structs/llvm/disablelirp/#a6d928236e02987de2267a46cd4211336">DisableLIRP::Memset</a> &amp;&amp;</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t create memset&#95;pattern16s with address spaces.</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">      StorePtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>() == 0 &amp;&amp;</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">      <a href="#a52ab2351fc0de7ffe5198fd144d98f8b">getMemSetPatternValue</a>(StoredVal, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)) &#123;</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// It looks like we can use PatternValue!</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::MemsetPattern;</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Otherwise, see if the store can be turned into a memcpy.</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasMemcpy &amp;&amp; !<a href="/docs/api/structs/llvm/disablelirp/#ab19e3cae2e9e472353062a181092d68f">DisableLIRP::Memcpy</a>) &#123;</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check to see if the stride matches the size of the store.  If so, then we</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// know that every byte is touched in the loop.</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/apint">APInt</a> Stride = <a href="#ab10dcc08be6d7ecc655688c7f5e5fcca">getStoreStride</a>(StoreEv);</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StoreSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeStoreSize(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand()-&gt;getType());</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreSize != Stride &amp;&amp; StoreSize != -Stride)</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The store must be feeding a non-volatile load.</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand());</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only allow non-volatile loads</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI || LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2eccc19f9061eeb7ad1e30e21f76034d">isVolatile</a>())</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only allow simple or unordered-atomic loads</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#ac072f8698be17d52f20bb63d59e6ce41">isUnordered</a>())</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// See if the pointer expression is an AddRec like &#123;base,+,1&#125; on the current</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// loop, which indicates a strided load.  If we have something else, it&#39;s a</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// random load we can&#39;t handle.</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;LoadEv =</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>()));</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LoadEv || LoadEv-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>() != CurLoop || !LoadEv-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a54bb7394d874cbbef1d81e6bea89d4f3">isAffine</a>())</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The store and load must share the same stride.</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreEv-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#ad99e00da7acb7973ae006f5b53ce04f6">getOperand</a>(1) != LoadEv-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#ad99e00da7acb7973ae006f5b53ce04f6">getOperand</a>(1))</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Success.  This store can be converted into a memcpy.</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">    UnorderedAtomic = UnorderedAtomic || LI-&gt;<a href="/docs/api/classes/llvm/instruction/#a57efb022f2ee2e19e4cdf582f4d27f2d">isAtomic</a>();</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> UnorderedAtomic ? LegalStoreKind::UnorderedAtomicMemcpy</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">                           : LegalStoreKind::Memcpy;</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This store can&#39;t be transformed into a memset/memcpy.</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LegalStoreKind::None;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> LoopIdiomRecognize::collectStores(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">  StoreRefsForMemset.clear();</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">  StoreRefsForMemsetPattern.clear();</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">  StoreRefsForMemcpy.clear();</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/si">SI</a>)</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure this is a strided store with a constant stride.</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (isLegalStore(<a href="/docs/api/namespaces/llvm/si">SI</a>)) &#123;</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> LegalStoreKind::None:</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Nothing to do</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> LegalStoreKind::Memset: &#123;</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Find the base pointer.</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">      StoreRefsForMemset&#91;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>&#93;.push&#95;back(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> LegalStoreKind::MemsetPattern: &#123;</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Find the base pointer.</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a3b1c5788b85ffa254be0e834edf5cf8f">getUnderlyingObject</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">      StoreRefsForMemsetPattern&#91;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>&#93;.push&#95;back(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> LegalStoreKind::Memcpy:</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> LegalStoreKind::UnorderedAtomicMemcpy:</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">      StoreRefsForMemcpy.push&#95;back(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight"> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;unhandled return value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlightComment">/// runOnLoopBlock - Process the specified block, which lives in a counted loop</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlightComment">/// with the specified backedge count.  This block is known to be in the current</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlightComment">/// loop and not in any subloops.</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::runOnLoopBlock(</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount,</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;BasicBlock &#42;&gt;</a> &amp;ExitBlocks) &#123;</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can only promote stores in this block if they are unconditionally</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// executed in the loop.  For a block to be unconditionally executed, it has</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to dominate all the exit blocks of the loop.  Verify this now.</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBlock : ExitBlocks)</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(BB, ExitBlock))</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for store instructions, which may be optimized to memset/memcpy.</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">  collectStores(BB);</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for a single store or sets of stores with a common base, which can be</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimized into a memset (memset&#95;pattern).  The latter most commonly happens</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with structs and handunrolled loops.</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;SL : StoreRefsForMemset)</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">    MadeChange |= processLoopStores(SL.second, BECount, ForMemset::Yes);</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;SL : StoreRefsForMemsetPattern)</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">    MadeChange |= processLoopStores(SL.second, BECount, ForMemset::No);</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Optimize the store into a memcpy, if it feeds an similarly strided load.</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a> : StoreRefsForMemcpy)</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">    MadeChange |= processLoopStoreOfLoopLoad(<a href="/docs/api/namespaces/llvm/si">SI</a>, BECount);</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">  MadeChange |= processLoopMemIntrinsic&lt;MemCpyInst&gt;(</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">      BB, &amp;LoopIdiomRecognize::processLoopMemCpy, BECount);</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">  MadeChange |= processLoopMemIntrinsic&lt;MemSetInst&gt;(</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">      BB, &amp;LoopIdiomRecognize::processLoopMemSet, BECount);</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlightComment">/// See if this store(s) can be promoted to a memset.</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::processLoopStores(<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;StoreInst &#42;&gt;</a> &amp;SL,</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount, ForMemset For) &#123;</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to find consecutive stores that can be transformed into memsets.</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;StoreInst &#42;&gt;</a> Heads, Tails;</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;StoreInst &#42;, StoreInst &#42;&gt;</a> ConsecutiveChain;</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do a quadratic search on all of the given stores and find</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// all of the pairs of stores that follow each other.</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;unsigned, 16&gt;</a> IndexQueue;</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = SL.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); i &lt; e; ++i) &#123;</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SL&#91;i&#93;-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a3ca9742688618517cc4690fb947fb609">isSimple</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected only non-volatile stores.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;FirstStoredVal = SL&#91;i&#93;-&gt;getValueOperand();</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;FirstStorePtr = SL&#91;i&#93;-&gt;getPointerOperand();</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;FirstStoreEv =</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(FirstStorePtr));</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/apint">APInt</a> FirstStride = <a href="#ab10dcc08be6d7ecc655688c7f5e5fcca">getStoreStride</a>(FirstStoreEv);</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> FirstStoreSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeStoreSize(SL&#91;i&#93;-&gt;getValueOperand()-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>());</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// See if we can optimize just this store in isolation.</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstStride == FirstStoreSize || -FirstStride == FirstStoreSize) &#123;</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">      Heads.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(SL&#91;i&#93;);</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;FirstSplatValue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;FirstPatternValue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (For == ForMemset::Yes)</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">      FirstSplatValue = <a href="/docs/api/namespaces/llvm/#acab8f775ddc87695d750e4838231b3ba">isBytewiseValue</a>(FirstStoredVal, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">      FirstPatternValue = <a href="#a52ab2351fc0de7ffe5198fd144d98f8b">getMemSetPatternValue</a>(FirstStoredVal, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((FirstSplatValue || FirstPatternValue) &amp;&amp;</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Expected either splat value or pattern value.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">    IndexQueue.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If a store has multiple consecutive store candidates, search Stores</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// array according to the sequence: from i+1 to e, then from i-1 to 0</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This is because usually pairing with immediate succeeding or preceding</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// candidate create the best chance to find memset opportunity.</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea363b122c528f54df4a0446b6bab05515">j</a> = 0;</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (j = i + 1; <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea363b122c528f54df4a0446b6bab05515">j</a> &lt; <a href="/docs/api/namespaces/llvm/numbers/#a92f4283d4e0e2ea1776894b3ae93640f">e</a>; ++<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea363b122c528f54df4a0446b6bab05515">j</a>)</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">      IndexQueue.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(j);</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (j = i; <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea363b122c528f54df4a0446b6bab05515">j</a> &gt; 0; --<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea363b122c528f54df4a0446b6bab05515">j</a>)</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">      IndexQueue.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(j - 1);</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;k : IndexQueue) &#123;</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SL&#91;k&#93;-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/slpvectorizer-cpp/#a3ca9742688618517cc4690fb947fb609">isSimple</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected only non-volatile stores.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;SecondStorePtr = SL&#91;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea8ce4b16b22b58894aa86c421e8759df3">k</a>&#93;-&gt;getPointerOperand();</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;SecondStoreEv =</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(SecondStorePtr));</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a> SecondStride = <a href="#ab10dcc08be6d7ecc655688c7f5e5fcca">getStoreStride</a>(SecondStoreEv);</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstStride != SecondStride)</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;SecondStoredVal = SL&#91;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea8ce4b16b22b58894aa86c421e8759df3">k</a>&#93;-&gt;getValueOperand();</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;SecondSplatValue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;SecondPatternValue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (For == ForMemset::Yes)</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">        SecondSplatValue = <a href="/docs/api/namespaces/llvm/#acab8f775ddc87695d750e4838231b3ba">isBytewiseValue</a>(SecondStoredVal, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">        SecondPatternValue = <a href="#a52ab2351fc0de7ffe5198fd144d98f8b">getMemSetPatternValue</a>(SecondStoredVal, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((SecondSplatValue || SecondPatternValue) &amp;&amp;</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Expected either splat value or pattern value.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab1b85be3cd0fffad1d76673016015e02">isConsecutiveAccess</a>(SL&#91;i&#93;, SL&#91;k&#93;, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, &#42;SE, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (For == ForMemset::Yes) &#123;</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(FirstSplatValue))</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">            FirstSplatValue = SecondSplatValue;</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstSplatValue != SecondSplatValue)</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(FirstPatternValue))</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">            FirstPatternValue = SecondPatternValue;</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstPatternValue != SecondPatternValue)</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">        Tails.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(SL&#91;k&#93;);</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">        Heads.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(SL&#91;i&#93;);</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">        ConsecutiveChain&#91;SL&#91;i&#93;&#93; = SL&#91;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea8ce4b16b22b58894aa86c421e8759df3">k</a>&#93;;</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We may run into multiple chains that merge into a single chain. We mark the</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stores that we transformed so that we don&#39;t visit the same store twice.</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Value &#42;, 16&gt;</a> TransformedStores;</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For stores that start but don&#39;t end a link in the chain:</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Heads) &#123;</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Tails.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We found a store instr that starts a chain. Now follow the chain and try</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to transform it.</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 8&gt;</a> AdjacentStores;</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;HeadStore = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StoreSize = 0;</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Collect the chain into a list.</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (Tails.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || Heads.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TransformedStores.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">      AdjacentStores.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">      StoreSize += <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeStoreSize(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getValueOperand()-&gt;getType());</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Move to the next value in the chain.</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ConsecutiveChain&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;StoredVal = HeadStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a89caf38fb409b0217360689351f3b457">getValueOperand</a>();</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;StorePtr = HeadStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#aefb15964facf7f35f22a6e8a7fb67285">getPointerOperand</a>();</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;StoreEv = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(StorePtr));</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/apint">APInt</a> Stride = <a href="#ab10dcc08be6d7ecc655688c7f5e5fcca">getStoreStride</a>(StoreEv);</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check to see if the stride matches the size of the stores.  If so, then</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we know that every byte is touched in the loop.</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreSize != Stride &amp;&amp; StoreSize != -Stride)</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNegStride = StoreSize == -Stride;</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;IntIdxTy = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIndexType(StorePtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;StoreSizeSCEV = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(IntIdxTy, StoreSize);</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (processLoopStridedStore(StorePtr, StoreSizeSCEV,</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">                                <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a>(HeadStore-&gt;<a href="/docs/api/classes/llvm/storeinst/#a3b47950858d6ed72efd1010a35b81caa">getAlign</a>()), StoredVal,</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">                                HeadStore, AdjacentStores, StoreEv, BECount,</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">                                IsNegStride)) &#123;</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">      TransformedStores.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(AdjacentStores.<a href="/docs/api/classes/llvm/smallptrsetimpl/#abf73a826b5d6f739eb4af48ddf14c5b4">begin</a>(), AdjacentStores.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a7004354fbee1c8cd74ed9001915e1db5">end</a>());</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlightComment">/// processLoopMemIntrinsic - Template function for calling different processor</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlightComment">/// functions based on mem intrinsic type.</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> MemInst&gt;</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733" lineLink="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/loopidiomrecognize/#acb7fb9d90a0af01462f9b0ce7b3e6414"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::processLoopMemIntrinsic(</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> (<a href="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/loopidiomrecognize/#afb3715f0d190af3ef4d9d01a3a3301a5">LoopIdiomRecognize</a>::&#42;Processor)(MemInst &#42;, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;),</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount) &#123;</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), E = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;) &#123;</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = &amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Look for memory instructions, which may be optimized to a larger one.</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemInst &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MemInst&gt;</a>(Inst)) &#123;</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/weaktrackingvh">WeakTrackingVH</a> InstPtr(&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!(this-&gt;&#42;Processor)(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, BECount))</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If processing the instruction invalidated our iterator, start over from</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the top of the block.</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InstPtr)</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlightComment">/// processLoopMemCpy - See if this memcpy can be promoted to a large memcpy</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::processLoopMemCpy(<a href="/docs/api/classes/llvm/memcpyinst">MemCpyInst</a> &#42;MCI,</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount) &#123;</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can only handle non-volatile memcpys with a constant size.</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MCI-&gt;<a href="/docs/api/classes/llvm/memintrinsic/#ada78af22b202d8b7d9fe772c2c9476ce">isVolatile</a>() || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(MCI-&gt;<a href="/docs/api/classes/llvm/memintrinsicbase/#a0fef04103987e9763468d19eb680b223">getLength</a>()))</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we&#39;re not allowed to hack on memcpy, we fail.</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((!HasMemcpy &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;MemCpyInlineInst&gt;</a>(MCI)) || <a href="/docs/api/structs/llvm/disablelirp/#ab19e3cae2e9e472353062a181092d68f">DisableLIRP::Memcpy</a>)</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Dest = MCI-&gt;<a href="/docs/api/classes/llvm/memintrinsicbase/#a44f399ae5b08171d0b9886d0a27a582a">getDest</a>();</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Source = MCI-&gt;<a href="/docs/api/classes/llvm/memtransferbase/#aaebde92913b64b73fa77dd6e8767d9d9">getSource</a>();</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Dest || !Source)</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if the load and store pointer expressions are AddRec like &#123;base,+,1&#125; on</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the current loop, which indicates a strided load and store.  If we have</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// something else, it&#39;s a random load or store we can&#39;t handle.</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;StoreEv = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Dest));</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!StoreEv || StoreEv-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>() != CurLoop || !StoreEv-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a54bb7394d874cbbef1d81e6bea89d4f3">isAffine</a>())</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;LoadEv = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Source));</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LoadEv || LoadEv-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>() != CurLoop || !LoadEv-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a54bb7394d874cbbef1d81e6bea89d4f3">isAffine</a>())</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reject memcpys that are so large that they overflow an unsigned.</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">  uint64&#95;t SizeInBytes = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(MCI-&gt;<a href="/docs/api/classes/llvm/memintrinsicbase/#a0fef04103987e9763468d19eb680b223">getLength</a>())-&gt;getZExtValue();</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((SizeInBytes &gt;&gt; 32) != 0)</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if the stride matches the size of the memcpy. If so, then we know</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that every byte is touched in the loop.</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevconstant">SCEVConstant</a> &#42;ConstStoreStride =</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(StoreEv-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#ad99e00da7acb7973ae006f5b53ce04f6">getOperand</a>(1));</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevconstant">SCEVConstant</a> &#42;ConstLoadStride =</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(LoadEv-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#ad99e00da7acb7973ae006f5b53ce04f6">getOperand</a>(1));</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ConstStoreStride || !ConstLoadStride)</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/apint">APInt</a> StoreStrideValue = ConstStoreStride-&gt;<a href="/docs/api/classes/llvm/scevconstant/#a6caf7f3a0a4303e4c0bc06ed8e205126">getAPInt</a>();</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/apint">APInt</a> LoadStrideValue = ConstLoadStride-&gt;<a href="/docs/api/classes/llvm/scevconstant/#a6caf7f3a0a4303e4c0bc06ed8e205126">getAPInt</a>();</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Huge stride value - give up</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreStrideValue.<a href="/docs/api/classes/llvm/apint/#a512fe2c15ea651294688eeec1341644c">getBitWidth</a>() &gt; 64 || LoadStrideValue.<a href="/docs/api/classes/llvm/apint/#a512fe2c15ea651294688eeec1341644c">getBitWidth</a>() &gt; 64)</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SizeInBytes != StoreStrideValue &amp;&amp; SizeInBytes != -StoreStrideValue) &#123;</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">    ORE.<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkmissed">OptimizationRemarkMissed</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;SizeStrideUnequal&quot;</span><span class="doxyHighlight">, MCI)</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">             &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Inst&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;memcpy&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; in &quot;</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">             &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Function&quot;</span><span class="doxyHighlight">, MCI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>())</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; function will not be hoisted: &quot;</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">             &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Reason&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;memcpy size is not equal to stride&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">  int64&#95;t StoreStrideInt = StoreStrideValue.<a href="/docs/api/classes/llvm/apint/#af2daa0ee117afefed4c82eee55bf97b7">getSExtValue</a>();</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">  int64&#95;t LoadStrideInt = LoadStrideValue.<a href="/docs/api/classes/llvm/apint/#af2daa0ee117afefed4c82eee55bf97b7">getSExtValue</a>();</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if the load stride matches the store stride.</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreStrideInt != LoadStrideInt)</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> processLoopStoreOfLoopLoad(</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">      Dest, Source, SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(Dest-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), SizeInBytes),</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">      MCI-&gt;<a href="/docs/api/classes/llvm/memintrinsicbase/#ac03b57021568dcc4d9a685c40011ff09">getDestAlign</a>(), MCI-&gt;<a href="/docs/api/classes/llvm/memtransferbase/#aa512958c35cfdd696c21623a964fc2d9">getSourceAlign</a>(), MCI, MCI, StoreEv, LoadEv,</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">      BECount);</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlightComment">/// processLoopMemSet - See if this memset can be promoted to a large memset.</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::processLoopMemSet(<a href="/docs/api/classes/llvm/memsetinst">MemSetInst</a> &#42;MSI,</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount) &#123;</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can only handle non-volatile memsets.</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MSI-&gt;<a href="/docs/api/classes/llvm/memintrinsic/#ada78af22b202d8b7d9fe772c2c9476ce">isVolatile</a>())</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we&#39;re not allowed to hack on memset, we fail.</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasMemset || <a href="/docs/api/structs/llvm/disablelirp/#a6d928236e02987de2267a46cd4211336">DisableLIRP::Memset</a>)</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/codeview/#a0bfa8e65ecd85f3151f84bb53ad4bcbca61cf8510205077b6f5491d38cd44c0f7">Pointer</a> = MSI-&gt;<a href="/docs/api/classes/llvm/memintrinsicbase/#a44f399ae5b08171d0b9886d0a27a582a">getDest</a>();</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if the pointer expression is an AddRec like &#123;base,+,1&#125; on the current</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop, which indicates a strided store.  If we have something else, it&#39;s a</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// random store we can&#39;t handle.</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;Ev = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Pointer));</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Ev || Ev-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a99ab4a82c6d7373e2e367986b9527bf0">getLoop</a>() != CurLoop)</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Ev-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a54bb7394d874cbbef1d81e6bea89d4f3">isAffine</a>()) &#123;</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Pointer is not affine, abort\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;PointerStrideSCEV = Ev-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#ad99e00da7acb7973ae006f5b53ce04f6">getOperand</a>(1);</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;MemsetSizeSCEV = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(MSI-&gt;<a href="/docs/api/classes/llvm/memintrinsicbase/#a0fef04103987e9763468d19eb680b223">getLength</a>());</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PointerStrideSCEV || !MemsetSizeSCEV)</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNegStride = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsConstantSize = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(MSI-&gt;<a href="/docs/api/classes/llvm/memintrinsicbase/#a0fef04103987e9763468d19eb680b223">getLength</a>());</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsConstantSize) &#123;</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Memset size is constant.</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if the pointer stride matches the memset size. If so, then</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we know that every byte is touched in the loop.</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  memset size is constant\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">    uint64&#95;t SizeInBytes = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(MSI-&gt;<a href="/docs/api/classes/llvm/memintrinsicbase/#a0fef04103987e9763468d19eb680b223">getLength</a>())-&gt;getZExtValue();</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevconstant">SCEVConstant</a> &#42;ConstStride = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(Ev-&gt;<a href="/docs/api/classes/llvm/scevnaryexpr/#ad99e00da7acb7973ae006f5b53ce04f6">getOperand</a>(1));</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ConstStride)</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/apint">APInt</a> Stride = ConstStride-&gt;<a href="/docs/api/classes/llvm/scevconstant/#a6caf7f3a0a4303e4c0bc06ed8e205126">getAPInt</a>();</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SizeInBytes != Stride &amp;&amp; SizeInBytes != -Stride)</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">    IsNegStride = SizeInBytes == -Stride;</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Memset size is non-constant.</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if the pointer stride matches the memset size.</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// To be conservative, the pass would not promote pointers that aren&#39;t in</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// address space zero. Also, the pass only handles memset length and stride</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that are invariant for the top level loop.</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  memset size is non-constant\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/codeview/#a0bfa8e65ecd85f3151f84bb53ad4bcbca61cf8510205077b6f5491d38cd44c0f7">Pointer</a>-&gt;getType()-&gt;getPointerAddressSpace() != 0) &#123;</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  pointer is not in address space zero, &quot;</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;abort\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a5a19768af81df7e5fe571bc08dcd48b3">isLoopInvariant</a>(MemsetSizeSCEV, CurLoop)) &#123;</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  memset size is not a loop-invariant, &quot;</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;abort\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compare positive direction PointerStrideSCEV with MemsetSizeSCEV</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">    IsNegStride = PointerStrideSCEV-&gt;<a href="/docs/api/classes/llvm/scev/#a87b23e247f35b163544f1ce8e920801c">isNonConstantNegative</a>();</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;PositiveStrideSCEV =</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">        IsNegStride ? SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a083bb1deb1d2ba244a99ceae9e734bc1">getNegativeSCEV</a>(PointerStrideSCEV)</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">                    : PointerStrideSCEV;</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  MemsetSizeSCEV: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;MemsetSizeSCEV &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  PositiveStrideSCEV: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PositiveStrideSCEV</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PositiveStrideSCEV != MemsetSizeSCEV) &#123;</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If an expression is covered by the loop guard, compare again and</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// proceed with optimization if equal.</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;FoldedPositiveStride =</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">          SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#ad146072469181af4ccb7ef03c28999ba">applyLoopGuards</a>(PositiveStrideSCEV, CurLoop);</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;FoldedMemsetSize =</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">          SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#ad146072469181af4ccb7ef03c28999ba">applyLoopGuards</a>(MemsetSizeSCEV, CurLoop);</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Try to fold SCEV based on loop guard\\n&quot;</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    FoldedMemsetSize: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;FoldedMemsetSize &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    FoldedPositiveStride: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;FoldedPositiveStride</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FoldedPositiveStride != FoldedMemsetSize) &#123;</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  SCEV don&#39;t match, abort\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Verify that the memset value is loop invariant.  If not, we can&#39;t promote</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the memset.</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SplatValue = MSI-&gt;<a href="/docs/api/classes/llvm/memsetbase/#a770c508bbe4f9b480f0d08a839ca94ff">getValue</a>();</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SplatValue || !CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a6cb6a58fb0ded82b4c7755fc4c27c86d">isLoopInvariant</a>(SplatValue))</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 1&gt;</a> MSIs;</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">  MSIs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(MSI);</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> processLoopStridedStore(Pointer, SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(MSI-&gt;<a href="/docs/api/classes/llvm/memintrinsicbase/#a0fef04103987e9763468d19eb680b223">getLength</a>()),</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">                                 MSI-&gt;<a href="/docs/api/classes/llvm/memintrinsicbase/#ac03b57021568dcc4d9a685c40011ff09">getDestAlign</a>(), SplatValue, MSI, MSIs, Ev,</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">                                 BECount, IsNegStride, </span><span class="doxyHighlightComment">/&#42;IsLoopMemset=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlightComment">/// mayLoopAccessLocation - Return true if the specified loop might access the</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlightComment">/// specified pointer location, which is a loop-strided access.  The &#39;Access&#39;</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlightComment">/// argument specifies what the verboten forms of access are (read or write).</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936" lineLink="#ade6253c0c19609ec9c632e60e08896fb"><span class="doxyHighlight"><a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonloopidiomrecognition-cpp/#abeee69852204fbee049fd520bdedbaae">mayLoopAccessLocation</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/namespaces/llvm/#a9db8c44b250b90e3ab7e4d144e7c9c2e">ModRefInfo</a> <a href="/docs/api/files/lib/lib/target/lib/target/directx/dxilresourceaccess-cpp/#adb4fa2b9065093d32736f78ea43a8c8a">Access</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;StoreSizeSCEV,</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">                      <a href="/docs/api/namespaces/llvm/#ae457f1cf451ed893666c4a384e58f8e5">AliasAnalysis</a> &amp;<a href="/docs/api/namespaces/llvm/aa">AA</a>,</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;Instruction &#42;&gt;</a> &amp;IgnoredInsts) &#123;</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the location that may be stored across the loop.  Since the access is</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// strided positively through memory, we say that the modified location starts</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// at the pointer and has infinite size.</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/locationsize">LocationSize</a> AccessSize = <a href="/docs/api/classes/llvm/locationsize/#ac01c1aa625e97bf21d27474544c463e5">LocationSize::afterPointer</a>();</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the loop iterates a fixed number of times, we can refine the access size</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to be exactly the size of the memset, which is (BECount+1)&#42;StoreSize</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevconstant">SCEVConstant</a> &#42;BECst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(BECount);</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevconstant">SCEVConstant</a> &#42;ConstSize = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(StoreSizeSCEV);</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BECst &amp;&amp; ConstSize) &#123;</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">    std::optional&lt;uint64&#95;t&gt; BEInt = BECst-&gt;<a href="/docs/api/classes/llvm/scevconstant/#a6caf7f3a0a4303e4c0bc06ed8e205126">getAPInt</a>().<a href="/docs/api/classes/llvm/apint/#a03385a25be413259dc4abb7252b3aaa4">tryZExtValue</a>();</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">    std::optional&lt;uint64&#95;t&gt; SizeInt = ConstSize-&gt;<a href="/docs/api/classes/llvm/scevconstant/#a6caf7f3a0a4303e4c0bc06ed8e205126">getAPInt</a>().<a href="/docs/api/classes/llvm/apint/#a03385a25be413259dc4abb7252b3aaa4">tryZExtValue</a>();</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Should this check for overflow?</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BEInt &amp;&amp; SizeInt)</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">      AccessSize = <a href="/docs/api/classes/llvm/locationsize/#a131715ceeb92fb803a329d6b76d14e0d">LocationSize::precise</a>((&#42;BEInt + 1) &#42; &#42;SizeInt);</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: For this to be really effective, we have to dive into the pointer</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// operand in the store.  Store to &amp;A&#91;i&#93; of 100 will always return may alias</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with store of &amp;A&#91;100&#93;, we need to StoreLoc to be &quot;A&quot; with size of 100,</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which will then no-alias a store to &amp;A&#91;100&#93;.</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/memorylocation">MemoryLocation</a> StoreLoc(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, AccessSize);</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> : L-&gt;blocks())</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IgnoredInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a854abfc88bcd24e3878e2c9ab1f70fd3">isModOrRefSet</a>(<a href="/docs/api/namespaces/llvm/aa">AA</a>.getModRefInfo(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, StoreLoc) &amp; <a href="/docs/api/files/lib/lib/target/lib/target/directx/dxilresourceaccess-cpp/#adb4fa2b9065093d32736f78ea43a8c8a">Access</a>))</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlightComment">// If we have a negative stride, Start refers to the end of the memory location</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlightComment">// we&#39;re trying to memset.  Therefore, we need to recompute the base pointer,</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlightComment">// which is just Start - BECount&#42;Size.</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974" lineLink="#ab0f2467f35df49e4d9d0c9623e2530cf"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="#ab0f2467f35df49e4d9d0c9623e2530cf">getStartForNegStride</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;Start, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount,</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/type">Type</a> &#42;IntPtr, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;StoreSizeSCEV,</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE) &#123;</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;Index = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#adc040502444e4504cdbc04c87e4e3055">getTruncateOrZeroExtend</a>(BECount, IntPtr);</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!StoreSizeSCEV-&gt;<a href="/docs/api/classes/llvm/scev/#a1ecb726f4e7b445057b795ed500546a0">isOne</a>()) &#123;</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// index = back edge count &#42; store size</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">    Index = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#ad299b0f4378f644f67168c72c763716f">getMulExpr</a>(Index,</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">                           SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#adc040502444e4504cdbc04c87e4e3055">getTruncateOrZeroExtend</a>(StoreSizeSCEV, IntPtr),</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/scev/#af43000d4dcb7d6d63cb6e36933ed3f6faafb62cd6afdc004ef6e8a1f6288eb382">SCEV::FlagNUW</a>);</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// base pointer = start - index &#42; store size</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a8bcb86d8d126d95b0dc05f09e8f3df96">getMinusSCEV</a>(Start, Index);</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlightComment">/// Compute the number of bytes as a SCEV from the backedge taken count.</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlightComment">/// This also maps the SCEV into the provided type and tries to handle the</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlightComment">/// computation in a way that will fold cleanly.</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992" lineLink="#a7bdf6d6bf51cc1a22329cd775255d0c8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="#a7bdf6d6bf51cc1a22329cd775255d0c8">getNumBytes</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount, <a href="/docs/api/classes/llvm/type">Type</a> &#42;IntPtr,</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;StoreSizeSCEV, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop,</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE) &#123;</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;TripCountSCEV =</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">      SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a3e3935d45c4b79b85a117b47cc1d2e61">getTripCountFromExitCount</a>(BECount, IntPtr, CurLoop);</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#ad299b0f4378f644f67168c72c763716f">getMulExpr</a>(TripCountSCEV,</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">                        SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#adc040502444e4504cdbc04c87e4e3055">getTruncateOrZeroExtend</a>(StoreSizeSCEV, IntPtr),</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/scev/#af43000d4dcb7d6d63cb6e36933ed3f6faafb62cd6afdc004ef6e8a1f6288eb382">SCEV::FlagNUW</a>);</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlightComment">/// processLoopStridedStore - We see a strided store of some value.  If we can</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlightComment">/// transform this into a memset or memset&#95;pattern in the loop preheader, do so.</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::processLoopStridedStore(</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;DestPtr, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;StoreSizeSCEV, <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> StoreAlignment,</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;StoredVal, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TheStore,</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;Instruction &#42;&gt;</a> &amp;Stores, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;Ev,</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNegStride, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLoopMemset) &#123;</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/module">Module</a> &#42;<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a> = TheStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>();</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SplatValue = <a href="/docs/api/namespaces/llvm/#acab8f775ddc87695d750e4838231b3ba">isBytewiseValue</a>(StoredVal, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;PatternValue = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SplatValue)</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">    PatternValue = <a href="#a52ab2351fc0de7ffe5198fd144d98f8b">getMemSetPatternValue</a>(StoredVal, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((SplatValue || PatternValue) &amp;&amp;</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected either splat value or pattern value.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The trip count of the loop and the base pointer of the addrec SCEV is</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// guaranteed to be loop invariant, which means that it should dominate the</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// header.  This allows us to insert code for it in the preheader.</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DestAS = DestPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> Expander(&#42;SE, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightStringLiteral">&quot;loop-idiom&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scevexpandercleaner">SCEVExpanderCleaner</a> ExpCleaner(Expander);</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestInt8PtrTy = Builder.getPtrTy(DestAS);</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;IntIdxTy = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIndexType(DestPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/namespaces/llvm/memprof/#abee3ddc7c6eb611a3b96fb69489c81caaa6122a65eaa676f700ae68d393054a37">Start</a> = Ev-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a19c13fe96d59c787e900b7bbf7173263">getStart</a>();</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle negative strided loops.</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsNegStride)</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/memprof/#abee3ddc7c6eb611a3b96fb69489c81caaa6122a65eaa676f700ae68d393054a37">Start</a> = <a href="#ab0f2467f35df49e4d9d0c9623e2530cf">getStartForNegStride</a>(Start, BECount, IntIdxTy, StoreSizeSCEV, SE);</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: ideally we should still be able to generate memset if SCEV expander</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is taught to generate the dependencies at the latest point.</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Expander.isSafeToExpand(Start))</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, we have a strided store &quot;p&#91;i&#93;&quot; of a splattable value.  We can turn</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this into a memset in the loop preheader now if we want.  However, this</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// would be unsafe to do if there is anything else in the loop that may read</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or write to the aliased location.  Check for any overlap by generating the</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// base pointer and checking the region.</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/codeview/#aa8c11d016a2dd473a4cf0ed1da777f5ea67f23a49a4828b272554feea07834f7d">BasePtr</a> =</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">      Expander.expandCodeFor(Start, DestInt8PtrTy, Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// From here on out, conservatively report to the pass manager that we&#39;ve</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// changed the IR, even if we later clean up these added instructions. There</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// may be structural differences e.g. in the order of use lists not accounted</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for in just a textual dump of the IR. This is written as a variable, even</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// though statically all the places this dominates could be replaced with</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#39;true&#39;, with the hope that anyone trying to be clever / &quot;more precise&quot; with</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the return value will read this comment, and leave them alone.</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonloopidiomrecognition-cpp/#abeee69852204fbee049fd520bdedbaae">mayLoopAccessLocation</a>(BasePtr, <a href="/docs/api/namespaces/llvm/#a9db8c44b250b90e3ab7e4d144e7c9c2ea6524b183b5cd0850f2cff6d30d581af9">ModRefInfo::ModRef</a>, CurLoop, BECount,</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">                            StoreSizeSCEV, &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>, Stores))</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (avoidLIRForMultiBlockLoop(</span><span class="doxyHighlightComment">/&#42;IsMemset=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, IsLoopMemset))</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, everything looks good, insert the memset.</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;NumBytesS =</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">      <a href="#a7bdf6d6bf51cc1a22329cd775255d0c8">getNumBytes</a>(BECount, IntIdxTy, StoreSizeSCEV, CurLoop, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SE);</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: ideally we should still be able to generate memset if SCEV expander</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is taught to generate the dependencies at the latest point.</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Expander.isSafeToExpand(NumBytesS))</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumBytes =</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">      Expander.expandCodeFor(NumBytesS, IntIdxTy, Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SplatValue &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a57d0e3799b16937e1f8df20ca1f1f3df">isLibFuncEmittable</a>(M, TLI, LibFunc&#95;memset&#95;pattern16))</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/aamdnodes">AAMDNodes</a> AATags = TheStore-&gt;<a href="/docs/api/classes/llvm/instruction/#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>();</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Store : Stores)</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">    AATags = AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a6b173e97523275314f3f2b433a5f71a9">merge</a>(<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getAAMetadata());</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(NumBytes))</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">    AATags = AATags.<a href="/docs/api/structs/llvm/aamdnodes/#abc415418337d16a2b07a2b8ab6e8dc36">extendTo</a>(CI-&gt;getZExtValue());</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">    AATags = AATags.<a href="/docs/api/structs/llvm/aamdnodes/#abc415418337d16a2b07a2b8ab6e8dc36">extendTo</a>(-1);</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;NewCall;</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SplatValue) &#123;</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">    NewCall = Builder.CreateMemSet(</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">        BasePtr, SplatValue, NumBytes, <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a>(StoreAlignment),</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;isVolatile=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a56188042f9dd6003cb8ed087e8ae654f">TBAA</a>, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a5175e1defb539f65df5ded7a806fa5c8">Scope</a>, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a81f3c11f463009d8b19b544f5bfed40c">NoAlias</a>);</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a> (<a href="/docs/api/namespaces/llvm/#a57d0e3799b16937e1f8df20ca1f1f3df">isLibFuncEmittable</a>(M, TLI, LibFunc&#95;memset&#95;pattern16));</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Everything is emitted in default address space</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;Int8PtrTy = DestInt8PtrTy;</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/stringref">StringRef</a> FuncName = </span><span class="doxyHighlightStringLiteral">&quot;memset&#95;pattern16&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/functioncallee">FunctionCallee</a> MSP = <a href="/docs/api/namespaces/llvm/#a87cba3c4c88ab5df01a7f7dece1e0266">getOrInsertLibFunc</a>(M, &#42;TLI, LibFunc&#95;memset&#95;pattern16,</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">                            Builder.getVoidTy(), Int8PtrTy, Int8PtrTy, IntIdxTy);</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a4a57dcd94b6daa3eacdbe8471955f4b1">inferNonMandatoryLibFuncAttrs</a>(M, FuncName, &#42;TLI);</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise we should form a memset&#95;pattern16.  PatternValue is known to be</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// an constant array of 16-bytes.  Plop the value into a mergable global.</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;GV = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(&#42;M, PatternValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca04ed141708c0fd16723d212502b046ae">GlobalValue::PrivateLinkage</a>,</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">                                            PatternValue, </span><span class="doxyHighlightStringLiteral">&quot;.memset&#95;pattern&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">    GV-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a38c97622dccff7ae31fe0be3b21c9b3d">setUnnamedAddr</a>(<a href="/docs/api/classes/llvm/globalvalue/#ae8df4be75bfc50b1eadd74e85c25fa45a4cc6684df7b4a92b1dec6fce3264fac8">GlobalValue::UnnamedAddr::Global</a>); </span><span class="doxyHighlightComment">// Ok to merge these.</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">    GV-&gt;<a href="/docs/api/classes/llvm/globalobject/#a49b398b1c83ef4d42c8f7756b443f61f">setAlignment</a>(<a href="/docs/api/structs/llvm/align">Align</a>(16));</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;PatternPtr = GV;</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">    NewCall = Builder.CreateCall(MSP, &#123;<a href="/docs/api/namespaces/llvm/codeview/#aa8c11d016a2dd473a4cf0ed1da777f5ea67f23a49a4828b272554feea07834f7d">BasePtr</a>, PatternPtr, NumBytes&#125;);</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Set the TBAA info if present.</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a56188042f9dd6003cb8ed087e8ae654f">TBAA</a>)</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">      NewCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;tbaa, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a56188042f9dd6003cb8ed087e8ae654f">TBAA</a>);</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a5175e1defb539f65df5ded7a806fa5c8">Scope</a>)</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">      NewCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;alias&#95;scope, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a5175e1defb539f65df5ded7a806fa5c8">Scope</a>);</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a81f3c11f463009d8b19b544f5bfed40c">NoAlias</a>)</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">      NewCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(LLVMContext::MD&#95;noalias, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a81f3c11f463009d8b19b544f5bfed40c">NoAlias</a>);</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">  NewCall-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(TheStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MSSAU) &#123;</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/memoryaccess">MemoryAccess</a> &#42;NewMemAcc = MSSAU-&gt;createMemoryAccessInBB(</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">        NewCall, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, NewCall-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), <a href="/docs/api/classes/llvm/memoryssa/#a9773fde54683945b9e34a0f2e5c1a5a5a7806c120eb87aea9fbb52fed327e09de">MemorySSA::BeforeTerminator</a>);</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">    MSSAU-&gt;insertDef(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MemoryDef&gt;</a>(NewMemAcc), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Formed memset: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewCall &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    from store to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Ev &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; at: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;TheStore</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">  ORE.<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/optimizationremark">OptimizationRemark</a> <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;ProcessLoopStridedStore&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">                         NewCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>(), Preheader);</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Transformed loop-strided store in &quot;</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">      &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Function&quot;</span><span class="doxyHighlight">, TheStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>())</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; function into a call to &quot;</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">      &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;NewFunction&quot;</span><span class="doxyHighlight">, NewCall-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>())</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;() intrinsic&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Stores.empty())</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a9d0744ef97ceb024c603e0e5a1c3533e">ore::setExtraArgs</a>();</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Stores) &#123;</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;FromBlock&quot;</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()-&gt;getName())</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">        &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;ToBlock&quot;</span><span class="doxyHighlight">, Preheader-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>;</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, the memset has been formed.  Zap the original store and anything that</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// feeds into it.</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Stores) &#123;</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MSSAU)</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">      MSSAU-&gt;removeMemoryAccess(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">    <a href="#aebc62faf59fecc07e8471fcf035d789e">deleteDeadInstruction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MSSAU &amp;&amp; <a href="/docs/api/namespaces/llvm/#aa29fe161c408879ada30c90ebbf55dcf">VerifyMemorySSA</a>)</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">    MSSAU-&gt;getMemorySSA()-&gt;verifyMemorySSA();</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">  ++NumMemSet;</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">  ExpCleaner.markResultUsed();</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlightComment">/// If the stored value is a strided load in the same loop with the same stride</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlightComment">/// this may be transformable into a memcpy.  This kicks in for stuff like</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlightComment">/// for (i) A&#91;i&#93; = B&#91;i&#93;;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::processLoopStoreOfLoopLoad(<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>,</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">                                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount) &#123;</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;isUnordered() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected only non-volatile non-ordered stores.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;StorePtr = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand();</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;StoreEv = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(StorePtr));</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StoreSize = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getTypeStoreSize(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand()-&gt;getType());</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The store must be feeding a non-volatile load.</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand());</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#ac072f8698be17d52f20bb63d59e6ce41">isUnordered</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected only non-volatile non-ordered loads.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if the pointer expression is an AddRec like &#123;base,+,1&#125; on the current</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop, which indicates a strided load.  If we have something else, it&#39;s a</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// random load we can&#39;t handle.</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LoadPtr = LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>();</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;LoadEv = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(LoadPtr));</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;StoreSizeSCEV = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(StorePtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), StoreSize);</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> processLoopStoreOfLoopLoad(StorePtr, LoadPtr, StoreSizeSCEV,</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">                                    <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getAlign(), LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#af51c113a039c82f6870df5dc9666b5e3">getAlign</a>(), <a href="/docs/api/namespaces/llvm/si">SI</a>, LI,</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">                                    StoreEv, LoadEv, BECount);</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197" lineLink="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/memmoveverifier"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/memmoveverifier/#ac1b04de670416ee6d872ad577e5c5074">MemmoveVerifier</a> &#123;</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199" lineLink="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/memmoveverifier/#ac1b04de670416ee6d872ad577e5c5074"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">explicit</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/memmoveverifier/#ac1b04de670416ee6d872ad577e5c5074">MemmoveVerifier</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &amp;LoadBasePtr, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &amp;StoreBasePtr,</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;DL)</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">      : DL(DL), BP1(<a href="/docs/api/namespaces/llvm">llvm</a>::<a href="/docs/api/namespaces/llvm/#a3ac5d9eb48038aa973017317279eadf5">GetPointerBaseWithConstantOffset</a>(</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">                    LoadBasePtr.stripPointerCasts(), LoadOff, DL)),</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">        BP2(<a href="/docs/api/namespaces/llvm">llvm</a>::<a href="/docs/api/namespaces/llvm/#a3ac5d9eb48038aa973017317279eadf5">GetPointerBaseWithConstantOffset</a>(</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">            StoreBasePtr.stripPointerCasts(), StoreOff, DL)),</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">        <a href="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/memmoveverifier/#a4a40f8a8a26c9c96929ba8c79d09f0fc">IsSameObject</a>(BP1 == BP2) &#123;&#125;</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207" lineLink="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/memmoveverifier/#a2f0412aee208de4e6fe854c4c3b50937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/memmoveverifier/#a2f0412aee208de4e6fe854c4c3b50937">loadAndStoreMayFormMemmove</a>(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StoreSize, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNegStride,</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;TheLoad,</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsMemCpy)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsMemCpy) &#123;</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Ensure that LoadBasePtr is after StoreBasePtr or before StoreBasePtr</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// for negative stride.</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((!IsNegStride &amp;&amp; LoadOff &lt;= StoreOff) ||</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">          (IsNegStride &amp;&amp; LoadOff &gt;= StoreOff))</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Ensure that LoadBasePtr is after StoreBasePtr or before StoreBasePtr</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// for negative stride. LoadBasePtr shouldn&#39;t overlap with StoreBasePtr.</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">      int64&#95;t LoadSize =</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">          DL.getTypeSizeInBits(TheLoad.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()).getFixedValue() / 8;</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BP1 != BP2 || LoadSize != int64&#95;t(StoreSize))</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((!IsNegStride &amp;&amp; LoadOff &lt; StoreOff + int64&#95;t(StoreSize)) ||</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">          (IsNegStride &amp;&amp; LoadOff + LoadSize &gt; StoreOff))</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">  int64&#95;t LoadOff = 0;</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">  int64&#95;t StoreOff = 0;</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;BP1;</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;BP2;</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238" lineLink="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/memmoveverifier/#a4a40f8a8a26c9c96929ba8c79d09f0fc"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-loopidiomrecognize-cpp-/memmoveverifier/#a4a40f8a8a26c9c96929ba8c79d09f0fc">IsSameObject</a>;</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::processLoopStoreOfLoopLoad(</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;DestPtr, <a href="/docs/api/classes/llvm/value">Value</a> &#42;SourcePtr, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;StoreSizeSCEV,</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> StoreAlign, <a href="/docs/api/structs/llvm/maybealign">MaybeAlign</a> LoadAlign, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TheStore,</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TheLoad, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;StoreEv,</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevaddrecexpr">SCEVAddRecExpr</a> &#42;LoadEv, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BECount) &#123;</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: until llvm.memcpy.inline supports dynamic sizes, we need to</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// conservatively bail here, since otherwise we may have to transform</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// llvm.memcpy.inline into llvm.memcpy which is illegal.</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;MemCpyInlineInst&gt;</a>(TheStore))</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The trip count of the loop and the base pointer of the addrec SCEV is</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// guaranteed to be loop invariant, which means that it should dominate the</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// header.  This allows us to insert code for it in the preheader.</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> Expander(&#42;SE, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightStringLiteral">&quot;loop-idiom&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scevexpandercleaner">SCEVExpanderCleaner</a> ExpCleaner(Expander);</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;StrStart = StoreEv-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a19c13fe96d59c787e900b7bbf7173263">getStart</a>();</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StrAS = DestPtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;IntIdxTy = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a31e2db8d1b315202d2c19e711b5365fd">getIntNTy</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>-&gt;getIndexSizeInBits(StrAS));</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/apint">APInt</a> Stride = <a href="#ab10dcc08be6d7ecc655688c7f5e5fcca">getStoreStride</a>(StoreEv);</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevconstant">SCEVConstant</a> &#42;ConstStoreSize = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(StoreSizeSCEV);</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Deal with non-constant size; Currently expect constant store size</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ConstStoreSize &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;store size is expected to be a constant&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">  int64&#95;t StoreSize = ConstStoreSize-&gt;<a href="/docs/api/classes/llvm/scevconstant/#a476a7aca5d55536fcbfb498dfe5d380d">getValue</a>()-&gt;<a href="/docs/api/classes/llvm/constantint/#ac09a21c371a9c535cbc13e8f82503aec">getZExtValue</a>();</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsNegStride = StoreSize == -Stride;</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle negative strided loops.</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsNegStride)</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">    StrStart =</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">        <a href="#ab0f2467f35df49e4d9d0c9623e2530cf">getStartForNegStride</a>(StrStart, BECount, IntIdxTy, StoreSizeSCEV, SE);</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, we have a strided store &quot;p&#91;i&#93;&quot; of a loaded value.  We can turn</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this into a memcpy in the loop preheader now if we want.  However, this</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// would be unsafe to do if there is anything else in the loop that may read</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or write the memory region we&#39;re storing to.  This includes the load that</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// feeds the stores.  Check for an alias by generating the base address and</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// checking everything.</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;StoreBasePtr = Expander.<a href="/docs/api/classes/llvm/scevexpander/#ac711b5659270bd9e66b8f38ec481260c">expandCodeFor</a>(</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">      StrStart, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(StrAS), Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// From here on out, conservatively report to the pass manager that we&#39;ve</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// changed the IR, even if we later clean up these added instructions. There</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// may be structural differences e.g. in the order of use lists not accounted</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for in just a textual dump of the IR. This is written as a variable, even</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// though statically all the places this dominates could be replaced with</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#39;true&#39;, with the hope that anyone trying to be clever / &quot;more precise&quot; with</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the return value will read this comment, and leave them alone.</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 2&gt;</a> IgnoredInsts;</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">  IgnoredInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(TheStore);</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsMemCpy = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;MemCpyInst&gt;</a>(TheStore);</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> InstRemark = IsMemCpy ? </span><span class="doxyHighlightStringLiteral">&quot;memcpy&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;load and store&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopAccessStore =</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonloopidiomrecognition-cpp/#abeee69852204fbee049fd520bdedbaae">mayLoopAccessLocation</a>(StoreBasePtr, <a href="/docs/api/namespaces/llvm/#a9db8c44b250b90e3ab7e4d144e7c9c2ea6524b183b5cd0850f2cff6d30d581af9">ModRefInfo::ModRef</a>, CurLoop, BECount,</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">                            StoreSizeSCEV, &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>, IgnoredInsts);</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopAccessStore) &#123;</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For memmove case it&#39;s not enough to guarantee that loop doesn&#39;t access</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TheStore and TheLoad. Additionally we need to make sure that TheStore is</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the only user of TheLoad.</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TheLoad-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>())</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">    IgnoredInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(TheLoad);</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonloopidiomrecognition-cpp/#abeee69852204fbee049fd520bdedbaae">mayLoopAccessLocation</a>(StoreBasePtr, <a href="/docs/api/namespaces/llvm/#a9db8c44b250b90e3ab7e4d144e7c9c2ea6524b183b5cd0850f2cff6d30d581af9">ModRefInfo::ModRef</a>, CurLoop,</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">                              BECount, StoreSizeSCEV, &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>, IgnoredInsts)) &#123;</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">      ORE.<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkmissed">OptimizationRemarkMissed</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;LoopMayAccessStore&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">                                        TheStore)</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">               &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Inst&quot;</span><span class="doxyHighlight">, InstRemark) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; in &quot;</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">               &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Function&quot;</span><span class="doxyHighlight">, TheStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>())</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; function will not be hoisted: &quot;</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">               &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Reason&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;The loop may access store location&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">    IgnoredInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(TheLoad);</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;LdStart = LoadEv-&gt;<a href="/docs/api/classes/llvm/scevaddrecexpr/#a19c13fe96d59c787e900b7bbf7173263">getStart</a>();</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LdAS = SourcePtr-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a5ab2d0b0f0b8ceec3b907184e7567197">getPointerAddressSpace</a>();</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Handle negative strided loops.</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsNegStride)</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">    LdStart =</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">        <a href="#ab0f2467f35df49e4d9d0c9623e2530cf">getStartForNegStride</a>(LdStart, BECount, IntIdxTy, StoreSizeSCEV, SE);</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For a memcpy, we have to make sure that the input array is not being</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// mutated by the loop.</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LoadBasePtr = Expander.<a href="/docs/api/classes/llvm/scevexpander/#ac711b5659270bd9e66b8f38ec481260c">expandCodeFor</a>(LdStart, Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab73bb6948312ca0f98055c6a74c37045">getPtrTy</a>(LdAS),</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">                                              Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the store is a memcpy instruction, we must check if it will write to</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the load memory locations. So remove it from the ignored stores.</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">  MemmoveVerifier <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp/#ae91b89e3dbb8e36d143a6efcc4d5d85a">Verifier</a>(&#42;LoadBasePtr, &#42;StoreBasePtr, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsMemCpy &amp;&amp; !<a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp/#ae91b89e3dbb8e36d143a6efcc4d5d85a">Verifier</a>.IsSameObject)</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">    IgnoredInsts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(TheStore);</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonloopidiomrecognition-cpp/#abeee69852204fbee049fd520bdedbaae">mayLoopAccessLocation</a>(LoadBasePtr, <a href="/docs/api/namespaces/llvm/#a9db8c44b250b90e3ab7e4d144e7c9c2ea7aeb0277500c86e4aa6bd23f9a737942">ModRefInfo::Mod</a>, CurLoop, BECount,</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">                            StoreSizeSCEV, &#42;<a href="/docs/api/namespaces/llvm/aa">AA</a>, IgnoredInsts)) &#123;</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">    ORE.<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkmissed">OptimizationRemarkMissed</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;LoopMayAccessLoad&quot;</span><span class="doxyHighlight">, TheLoad)</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">             &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Inst&quot;</span><span class="doxyHighlight">, InstRemark) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; in &quot;</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">             &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Function&quot;</span><span class="doxyHighlight">, TheStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>())</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; function will not be hoisted: &quot;</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">             &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Reason&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;The loop may access load location&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseMemMove = IsMemCpy ? <a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp/#ae91b89e3dbb8e36d143a6efcc4d5d85a">Verifier</a>.IsSameObject : LoopAccessStore;</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseMemMove)</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/ir/safepointirverifier-cpp/#ae91b89e3dbb8e36d143a6efcc4d5d85a">Verifier</a>.loadAndStoreMayFormMemmove(StoreSize, IsNegStride, &#42;TheLoad,</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">                                             IsMemCpy))</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (avoidLIRForMultiBlockLoop())</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, everything is safe, we can transform this!</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;NumBytesS =</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">      <a href="#a7bdf6d6bf51cc1a22329cd775255d0c8">getNumBytes</a>(BECount, IntIdxTy, StoreSizeSCEV, CurLoop, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, SE);</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NumBytes =</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">      Expander.<a href="/docs/api/classes/llvm/scevexpander/#ac711b5659270bd9e66b8f38ec481260c">expandCodeFor</a>(NumBytesS, IntIdxTy, Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/aamdnodes">AAMDNodes</a> AATags = TheLoad-&gt;<a href="/docs/api/classes/llvm/instruction/#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>();</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/aamdnodes">AAMDNodes</a> StoreAATags = TheStore-&gt;<a href="/docs/api/classes/llvm/instruction/#aade703948f2fdabdc65868bdf42d3141">getAAMetadata</a>();</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">  AATags = AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a6b173e97523275314f3f2b433a5f71a9">merge</a>(StoreAATags);</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(NumBytes))</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">    AATags = AATags.<a href="/docs/api/structs/llvm/aamdnodes/#abc415418337d16a2b07a2b8ab6e8dc36">extendTo</a>(CI-&gt;getZExtValue());</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">    AATags = AATags.<a href="/docs/api/structs/llvm/aamdnodes/#abc415418337d16a2b07a2b8ab6e8dc36">extendTo</a>(-1);</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;NewCall = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check whether to generate an unordered atomic memcpy:</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  If the load or store are atomic, then they must necessarily be unordered</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  by previous checks.</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TheStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a57efb022f2ee2e19e4cdf582f4d27f2d">isAtomic</a>() &amp;&amp; !TheLoad-&gt;<a href="/docs/api/classes/llvm/instruction/#a57efb022f2ee2e19e4cdf582f4d27f2d">isAtomic</a>()) &#123;</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseMemMove)</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">      NewCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aea32ed404420c1968f50b168adedace9">CreateMemMove</a>(</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">          StoreBasePtr, StoreAlign, LoadBasePtr, LoadAlign, NumBytes,</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">/&#42;isVolatile=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a56188042f9dd6003cb8ed087e8ae654f">TBAA</a>, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a5175e1defb539f65df5ded7a806fa5c8">Scope</a>, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a81f3c11f463009d8b19b544f5bfed40c">NoAlias</a>);</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">      NewCall =</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">          Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae9f2730f66215fdb82f4e41e45124811">CreateMemCpy</a>(StoreBasePtr, StoreAlign, LoadBasePtr, LoadAlign,</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">                               NumBytes, </span><span class="doxyHighlightComment">/&#42;isVolatile=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a56188042f9dd6003cb8ed087e8ae654f">TBAA</a>,</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">                               AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a4831dbe1cbfb8f0e07600bf890af8353">TBAAStruct</a>, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a5175e1defb539f65df5ded7a806fa5c8">Scope</a>, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a81f3c11f463009d8b19b544f5bfed40c">NoAlias</a>);</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For now don&#39;t support unordered atomic memmove.</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseMemMove)</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We cannot allow unaligned ops for unordered load/store, so reject</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// anything where the alignment isn&#39;t at least the element size.</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((StoreAlign &amp;&amp; LoadAlign) &amp;&amp;</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Expect unordered load/store to have align.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&#42;StoreAlign &lt; StoreSize || &#42;LoadAlign &lt; StoreSize)</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the element.atomic memcpy is not lowered into explicit</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// loads/stores later, then it will be lowered into an element-size</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// specific lib call. If the lib call doesn&#39;t exist for our store size, then</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we shouldn&#39;t generate the memcpy.</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StoreSize &gt; <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getAtomicMemIntrinsicMaxElementSize())</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create the call.</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that unordered atomic loads/stores are &#42;required&#42; by the spec to</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// have an alignment but non-atomic loads/stores may not.</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">    NewCall = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a0097c4a6c82120f14b29ec4e3fb8abb8">CreateElementUnorderedAtomicMemCpy</a>(</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">        StoreBasePtr, &#42;StoreAlign, LoadBasePtr, &#42;LoadAlign, NumBytes, StoreSize,</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">        AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a56188042f9dd6003cb8ed087e8ae654f">TBAA</a>, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a4831dbe1cbfb8f0e07600bf890af8353">TBAAStruct</a>, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a5175e1defb539f65df5ded7a806fa5c8">Scope</a>, AATags.<a href="/docs/api/structs/llvm/aamdnodes/#a81f3c11f463009d8b19b544f5bfed40c">NoAlias</a>);</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">  NewCall-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(TheStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MSSAU) &#123;</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/memoryaccess">MemoryAccess</a> &#42;NewMemAcc = MSSAU-&gt;createMemoryAccessInBB(</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">        NewCall, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, NewCall-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), <a href="/docs/api/classes/llvm/memoryssa/#a9773fde54683945b9e34a0f2e5c1a5a5a7806c120eb87aea9fbb52fed327e09de">MemorySSA::BeforeTerminator</a>);</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">    MSSAU-&gt;insertDef(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;MemoryDef&gt;</a>(NewMemAcc), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  Formed new call: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;NewCall &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    from load ptr=&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;LoadEv &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; at: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;TheLoad</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;    from store ptr=&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;StoreEv &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; at: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;TheStore</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">  ORE.<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremark">OptimizationRemark</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;ProcessLoopStoreOfLoopLoad&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">                              NewCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>(), Preheader)</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Formed a call to &quot;</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">           &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;NewFunction&quot;</span><span class="doxyHighlight">, NewCall-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>())</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;() intrinsic from &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Inst&quot;</span><span class="doxyHighlight">, InstRemark)</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; instruction in &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Function&quot;</span><span class="doxyHighlight">, TheStore-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>())</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; function&quot;</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">           &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a9d0744ef97ceb024c603e0e5a1c3533e">ore::setExtraArgs</a>()</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">           &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;FromBlock&quot;</span><span class="doxyHighlight">, TheStore-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getName())</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">           &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;ToBlock&quot;</span><span class="doxyHighlight">, Preheader-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, a new call to memcpy/memmove has been formed.  Zap the original store</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and anything that feeds into it.</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MSSAU)</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">    MSSAU-&gt;removeMemoryAccess(TheStore, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">  <a href="#aebc62faf59fecc07e8471fcf035d789e">deleteDeadInstruction</a>(TheStore);</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MSSAU &amp;&amp; <a href="/docs/api/namespaces/llvm/#aa29fe161c408879ada30c90ebbf55dcf">VerifyMemorySSA</a>)</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">    MSSAU-&gt;getMemorySSA()-&gt;verifyMemorySSA();</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseMemMove)</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">    ++NumMemMove;</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlight">    ++NumMemCpy;</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">  ExpCleaner.<a href="/docs/api/classes/llvm/scevexpandercleaner/#adebccfabab3d98cd238936760a34a15d">markResultUsed</a>();</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlightComment">// When compiling for codesize we avoid idiom recognition for a multi-block loop</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlightComment">// unless it is a loop&#95;memset idiom or a memset/memcpy idiom in a nested loop.</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::avoidLIRForMultiBlockLoop(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsMemset,</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">                                                   </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLoopMemset) &#123;</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ApplyCodeSizeHeuristics &amp;&amp; CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a261ee3c4745564c7be9283984c9af06b">getNumBlocks</a>() &gt; 1) &#123;</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a0fa33dfd6ffaaae721fc05b6941263aa">isOutermost</a>() &amp;&amp; (!IsMemset || !IsLoopMemset)) &#123;</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  &quot;</span><span class="doxyHighlight"> &lt;&lt; CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; : LIR &quot;</span><span class="doxyHighlight"> &lt;&lt; (IsMemset ? </span><span class="doxyHighlightStringLiteral">&quot;Memset&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;Memcpy&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; avoided: multi-block top-level loop\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::runOnNoncountableLoop() &#123;</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Scanning: F&#91;&quot;</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">                    &lt;&lt; CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>()</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#93; Noncountable Loop %&quot;</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">                    &lt;&lt; CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>()-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> recognizePopcount() || recognizeAndInsertFFS() ||</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">         recognizeShiftUntilBitTest() || recognizeShiftUntilZero() ||</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">         recognizeShiftUntilLessThan();</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlightComment">/// Check if the given conditional branch is based on the comparison between</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlightComment">/// a variable and zero, and if the variable is non-zero or zero (JmpOnZero is</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlightComment">/// true), the control yields to the loop entry. If the branch matches the</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlightComment">/// behavior, the variable involved in the comparison is returned. This function</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlightComment">/// will be called to see if the precondition and postcondition of the loop are</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlightComment">/// in desirable form.</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501" lineLink="#a0334b7852f3d535571315a1c2a90a085"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#a0334b7852f3d535571315a1c2a90a085">matchCondition</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopEntry,</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> JmpOnZero = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI || !BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>())</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CmpZero = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CmpZero || !CmpZero-&gt;<a href="/docs/api/classes/llvm/constantint/#a882d55a6aa2028e1a5ad708b275334e0">isZero</a>())</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueSucc = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0);</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FalseSucc = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (JmpOnZero)</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(TrueSucc, FalseSucc);</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getPredicate();</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a> &amp;&amp; TrueSucc == LoopEntry) ||</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">      (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a> &amp;&amp; FalseSucc == LoopEntry))</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlightComment">/// Check if the given conditional branch is based on an unsigned less-than</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlightComment">/// comparison between a variable and a constant, and if the comparison is false</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlightComment">/// the control yields to the loop entry. If the branch matches the behaviour,</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlightComment">/// the variable involved in the comparison is returned.</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531" lineLink="#ab57bfa30e7fbef3fb394f7bd5cfa6d0a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#ab57bfa30e7fbef3fb394f7bd5cfa6d0a">matchShiftULTCondition</a>(<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopEntry,</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;Threshold) &#123;</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI || !BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>())</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ICmpInst&gt;</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;CmpConst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CmpConst)</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FalseSucc = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1);</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">ICmpInst::Predicate</a> Pred = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getPredicate();</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a> &amp;&amp; FalseSucc == LoopEntry) &#123;</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">    Threshold = CmpConst-&gt;<a href="/docs/api/classes/llvm/constantint/#af7e1934ed72a405ef073ea5f9bbe828e">getValue</a>();</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlightComment">// Check if the recurrence variable &#96;VarX&#96; is in the right form to create</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlightComment">// the idiom. Returns the value coerced to a PHINode if so.</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557" lineLink="#a0554350a6af85d4e8cf06cd9ca2b5556"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="#a0554350a6af85d4e8cf06cd9ca2b5556">getRecurrenceVar</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;VarX, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;DefX,</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopEntry) &#123;</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PhiX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(VarX);</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PhiX &amp;&amp; PhiX-&gt;getParent() == LoopEntry &amp;&amp;</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">      (PhiX-&gt;getOperand(0) == DefX || PhiX-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) == DefX))</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PhiX;</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlightComment">/// Return true if the idiom is detected in the loop.</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlightComment">/// Additionally:</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlightComment">/// 1) \\p CntInst is set to the instruction Counting Leading Zeros (CTLZ)</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlightComment">///       or nullptr if there is no such.</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlightComment">/// 2) \\p CntPhi is set to the corresponding phi node</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlightComment">///       or nullptr if there is no such.</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlightComment">/// 3) \\p InitX is set to the value whose CTLZ could be used.</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlightComment">/// 4) \\p DefX is set to the instruction calculating Loop exit condition.</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlightComment">/// 5) \\p Threshold is set to the constant involved in the unsigned less-than</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlightComment">///       comparison.</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlightComment">/// The core idiom we are trying to detect is:</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlightComment">///    if (x0 &lt; 2)</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlightComment">///      goto loop-exit // the precondition of the loop</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlightComment">///    cnt0 = init-val</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlightComment">///    do &#123;</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlightComment">///      x = phi (x0, x.next);   //PhiX</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlightComment">///      cnt = phi (cnt0, cnt.next)</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlightComment">///      cnt.next = cnt + 1;</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlightComment">///       ...</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlightComment">///      x.next = x &gt;&gt; 1;   // DefX</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlightComment">///    &#125; while (x &gt;= 4)</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlightComment">/// loop-exit:</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593" lineLink="#a3a0cafd820690b73a6169ab519d77d2a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a3a0cafd820690b73a6169ab519d77d2a">detectShiftUntilLessThanIdiom</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">                                          <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> &amp;IntrinID,</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;InitX, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp;CntInst,</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp;CntPhi, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp;DefX,</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/apint">APInt</a> &amp;Threshold) &#123;</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopEntry;</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">  DefX = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">  CntInst = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">  CntPhi = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">  LoopEntry = &#42;(CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#af9096a02aa326d9a55f4d16ba9f9d243">block&#95;begin</a>());</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 1: Check if the loop-back branch is in desirable form.</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = <a href="#ab57bfa30e7fbef3fb394f7bd5cfa6d0a">matchShiftULTCondition</a>(</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(LoopEntry-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()), LoopEntry,</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">          Threshold))</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">    DefX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 2: Check the recurrence of variable X</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DefX || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(DefX))</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;VarPhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(DefX);</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Idx = VarPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#ae9562b96f6f3fa41bd36538c080035ee">getBasicBlockIndex</a>(LoopEntry);</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Idx == -1)</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">  DefX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(VarPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(Idx));</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DefX || DefX-&gt;<a href="/docs/api/classes/llvm/user/#addec638786f763d967811b45cb662f1f">getNumOperands</a>() == 0 || DefX-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) != VarPhi)</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 3: detect instructions corresponding to &quot;x.next = x &gt;&gt; 1&quot;</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefX-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() != Instruction::LShr)</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">  IntrinID = Intrinsic::ctlz;</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Shft = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(DefX-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Shft || !Shft-&gt;<a href="/docs/api/classes/llvm/constantint/#a244bfbe5aae876e56cf5e62f0f27867a">isOne</a>())</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">  InitX = VarPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>());</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 4: Find the instruction which count the CTLZ: cnt.next = cnt + 1</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//         or cnt.next = cnt + -1</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We can skip the step. If loop trip count is known (CTLZ),</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       then all uses of &quot;cnt.next&quot; could be optimized to the trip count</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       plus &quot;cnt0&quot;. Currently it is not optimized.</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       This step could be used to detect POPCNT instruction:</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       cnt.next = cnt + (x.next &amp; 1)</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst :</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">       <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">llvm::make&#95;range</a>(LoopEntry-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>(), LoopEntry-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>())) &#123;</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst.getOpcode() != Instruction::Add)</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Inc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Inst.getOperand(1));</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inc || (!Inc-&gt;<a href="/docs/api/classes/llvm/constantint/#a244bfbe5aae876e56cf5e62f0f27867a">isOne</a>() &amp;&amp; !Inc-&gt;<a href="/docs/api/classes/llvm/constantint/#a13cc1f5d3225f4ec063520a747acec4c">isMinusOne</a>()))</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="#a0554350a6af85d4e8cf06cd9ca2b5556">getRecurrenceVar</a>(Inst.getOperand(0), &amp;Inst, LoopEntry);</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Phi)</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">    CntInst = &amp;Inst;</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">    CntPhi = Phi;</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CntInst)</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlightComment">/// Return true iff the idiom is detected in the loop.</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlightComment">/// Additionally:</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlightComment">/// 1) \\p CntInst is set to the instruction counting the population bit.</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlightComment">/// 2) \\p CntPhi is set to the corresponding phi node.</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlightComment">/// 3) \\p Var is set to the value whose population bits are being counted.</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlightComment">/// The core idiom we are trying to detect is:</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlightComment">///    if (x0 != 0)</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlightComment">///      goto loop-exit // the precondition of the loop</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlightComment">///    cnt0 = init-val;</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlightComment">///    do &#123;</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlightComment">///       x1 = phi (x0, x2);</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlightComment">///       cnt1 = phi(cnt0, cnt2);</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlightComment">///       cnt2 = cnt1 + 1;</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlightComment">///        ...</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlightComment">///       x2 = x1 &amp; (x1 - 1);</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlightComment">///        ...</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlightComment">///    &#125; while(x != 0);</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlightComment">/// loop-exit:</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691" lineLink="#a48f061a53492f73dc9d82812f4350b44"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a48f061a53492f73dc9d82812f4350b44">detectPopcountIdiom</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PreCondBB,</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp;CntInst, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp;CntPhi,</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;Var) &#123;</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 1: Check to see if the look-back branch match this pattern:</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    &quot;if (a!=0) goto loop-entry&quot;.</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopEntry;</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;DefX2, &#42;CountInst;</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VarX1, &#42;VarX0;</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PhiX, &#42;CountPhi;</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlight">  DefX2 = CountInst = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">  VarX1 = VarX0 = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">  PhiX = CountPhi = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">  LoopEntry = &#42;(CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#af9096a02aa326d9a55f4d16ba9f9d243">block&#95;begin</a>());</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 1: Check if the loop-back branch is in desirable form.</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">  &#123;</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = <a href="#a0334b7852f3d535571315a1c2a90a085">matchCondition</a>(</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(LoopEntry-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()), LoopEntry))</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">      DefX2 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 2: detect instructions corresponding to &quot;x2 = x1 &amp; (x1 - 1)&quot;</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">  &#123;</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DefX2 || DefX2-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() != Instruction::And)</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;SubOneOp;</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((SubOneOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(DefX2-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0))))</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">      VarX1 = DefX2-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1);</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">      VarX1 = DefX2-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">      SubOneOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(DefX2-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SubOneOp || SubOneOp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) != VarX1)</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Dec = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(SubOneOp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Dec ||</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">        !((SubOneOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::Sub &amp;&amp; Dec-&gt;<a href="/docs/api/classes/llvm/constantint/#a244bfbe5aae876e56cf5e62f0f27867a">isOne</a>()) ||</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">          (SubOneOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::Add &amp;&amp;</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">           Dec-&gt;<a href="/docs/api/classes/llvm/constantint/#a13cc1f5d3225f4ec063520a747acec4c">isMinusOne</a>()))) &#123;</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 3: Check the recurrence of variable X</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">  PhiX = <a href="#a0554350a6af85d4e8cf06cd9ca2b5556">getRecurrenceVar</a>(VarX1, DefX2, LoopEntry);</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PhiX)</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 4: Find the instruction which count the population: cnt2 = cnt1 + 1</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">  &#123;</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">    CountInst = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst :</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">llvm::make&#95;range</a>(LoopEntry-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>(), LoopEntry-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>())) &#123;</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst.getOpcode() != Instruction::Add)</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Inc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Inst.getOperand(1));</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inc || !Inc-&gt;<a href="/docs/api/classes/llvm/constantint/#a244bfbe5aae876e56cf5e62f0f27867a">isOne</a>())</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="#a0554350a6af85d4e8cf06cd9ca2b5556">getRecurrenceVar</a>(Inst.getOperand(0), &amp;Inst, LoopEntry);</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Phi)</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check if the result of the instruction is live of the loop.</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LiveOutLoop = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : Inst.<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U))-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() != LoopEntry) &#123;</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">          LiveOutLoop = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LiveOutLoop) &#123;</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlight">        CountInst = &amp;Inst;</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">        CountPhi = Phi;</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CountInst)</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 5: check if the precondition is in this form:</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &quot;if (x != 0) goto loop-head ; else goto somewhere-we-don&#39;t-care;&quot;</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">  &#123;</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PreCondBr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PreCondBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = <a href="#a0334b7852f3d535571315a1c2a90a085">matchCondition</a>(PreCondBr, CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>());</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> != PhiX-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> != PhiX-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlight">    CntInst = CountInst;</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">    CntPhi = CountPhi;</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlight">    Var = <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>;</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlightComment">/// Return true if the idiom is detected in the loop.</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlightComment">/// Additionally:</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlightComment">/// 1) \\p CntInst is set to the instruction Counting Leading Zeros (CTLZ)</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlightComment">///       or nullptr if there is no such.</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlightComment">/// 2) \\p CntPhi is set to the corresponding phi node</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlightComment">///       or nullptr if there is no such.</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlightComment">/// 3) \\p Var is set to the value whose CTLZ could be used.</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlightComment">/// 4) \\p DefX is set to the instruction calculating Loop exit condition.</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlightComment">/// The core idiom we are trying to detect is:</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlightComment">///    if (x0 == 0)</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlightComment">///      goto loop-exit // the precondition of the loop</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlightComment">///    cnt0 = init-val;</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlightComment">///    do &#123;</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlightComment">///       x = phi (x0, x.next);   //PhiX</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlightComment">///       cnt = phi(cnt0, cnt.next);</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlightComment">///       cnt.next = cnt + 1;</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlightComment">///        ...</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlightComment">///       x.next = x &gt;&gt; 1;   // DefX</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlightComment">///        ...</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlightComment">///    &#125; while(x.next != 0);</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlightComment">/// loop-exit:</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824" lineLink="#a7ff0d8853961745bbe8afef66fab99dc"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a7ff0d8853961745bbe8afef66fab99dc">detectShiftUntilZeroIdiom</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">                                      <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> &amp;IntrinID, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;InitX,</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp;CntInst, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;&amp;CntPhi,</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp;DefX) &#123;</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopEntry;</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;VarX = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">  DefX = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">  CntInst = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">  CntPhi = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">  LoopEntry = &#42;(CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#af9096a02aa326d9a55f4d16ba9f9d243">block&#95;begin</a>());</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 1: Check if the loop-back branch is in desirable form.</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = <a href="#a0334b7852f3d535571315a1c2a90a085">matchCondition</a>(</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(LoopEntry-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()), LoopEntry))</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">    DefX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 2: detect instructions corresponding to &quot;x.next = x &gt;&gt; 1 or x &lt;&lt; 1&quot;</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DefX || !DefX-&gt;<a href="/docs/api/classes/llvm/instruction/#ac5984d6827f6e6922bed00bf03ba9552">isShift</a>())</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">  IntrinID = DefX-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Shl ? Intrinsic::cttz :</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">                                                     Intrinsic::ctlz;</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Shft = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(DefX-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Shft || !Shft-&gt;<a href="/docs/api/classes/llvm/constantint/#a244bfbe5aae876e56cf5e62f0f27867a">isOne</a>())</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">  VarX = DefX-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0);</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 3: Check the recurrence of variable X</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PhiX = <a href="#a0554350a6af85d4e8cf06cd9ca2b5556">getRecurrenceVar</a>(VarX, DefX, LoopEntry);</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PhiX)</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">  InitX = PhiX-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>());</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure the initial value can&#39;t be negative otherwise the ashr in the</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop might never reach zero which would make the loop infinite.</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefX-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::AShr &amp;&amp; !<a href="/docs/api/namespaces/llvm/#ae7f4b5fbc0aa5c8204b9a4b06e070d75">isKnownNonNegative</a>(InitX, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 4: Find the instruction which count the CTLZ: cnt.next = cnt + 1</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//         or cnt.next = cnt + -1</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We can skip the step. If loop trip count is known (CTLZ),</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       then all uses of &quot;cnt.next&quot; could be optimized to the trip count</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       plus &quot;cnt0&quot;. Currently it is not optimized.</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       This step could be used to detect POPCNT instruction:</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       cnt.next = cnt + (x.next &amp; 1)</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst :</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">       <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">llvm::make&#95;range</a>(LoopEntry-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>(), LoopEntry-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>())) &#123;</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inst.getOpcode() != Instruction::Add)</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;Inc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Inst.getOperand(1));</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Inc || (!Inc-&gt;<a href="/docs/api/classes/llvm/constantint/#a244bfbe5aae876e56cf5e62f0f27867a">isOne</a>() &amp;&amp; !Inc-&gt;<a href="/docs/api/classes/llvm/constantint/#a13cc1f5d3225f4ec063520a747acec4c">isMinusOne</a>()))</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="#a0554350a6af85d4e8cf06cd9ca2b5556">getRecurrenceVar</a>(Inst.getOperand(0), &amp;Inst, LoopEntry);</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Phi)</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">    CntInst = &amp;Inst;</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">    CntPhi = Phi;</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CntInst)</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlightComment">// Check if CTLZ / CTTZ intrinsic is profitable. Assume it is always</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlightComment">// profitable if we delete the loop.</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::isProfitableToInsertFFS(<a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrinID,</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/value">Value</a> &#42;InitX, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ZeroCheck,</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">                                                 </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> CanonicalSize) &#123;</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;InitX,</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/constantint/#afe7d477c6022fe7123b90e3b39c58e69">ConstantInt::getBool</a>(InitX-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>(), ZeroCheck)&#125;;</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// @llvm.dbg doesn&#39;t count as they have no semantic effect.</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InstWithoutDebugIt = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a2069641f358ef416658a2f321ca19d74">instructionsWithoutDebug</a>();</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">  uint32&#95;t <a href="/docs/api/namespaces/llvm/btf/#ac469d636ea54a1eb9da4c1f633a4496ca4af5f992bdc47a779c499ffc6fdcaf43">HeaderSize</a> =</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">      std::distance(InstWithoutDebugIt.begin(), InstWithoutDebugIt.end());</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/intrinsiccostattributes">IntrinsicCostAttributes</a> <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>(IntrinID, InitX-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), Args);</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getIntrinsicInstrCost(</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">      Attrs, <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>);</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HeaderSize != CanonicalSize &amp;&amp; <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> &gt; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>)</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlightComment">/// Convert CTLZ / CTTZ idiom loop into countable loop.</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlightComment">/// If CTLZ / CTTZ inserted as a new trip count returns true; otherwise,</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlightComment">/// returns false.</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::insertFFSIfProfitable(<a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrinID,</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/value">Value</a> &#42;InitX, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;DefX,</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;CntPhi,</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CntInst) &#123;</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsCntPhiUsedOutsideLoop = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : CntPhi-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U))) &#123;</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">      IsCntPhiUsedOutsideLoop = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsCntInstUsedOutsideLoop = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : CntInst-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U))) &#123;</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">      IsCntInstUsedOutsideLoop = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If both CntInst and CntPhi are used outside the loop the profitability</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is questionable.</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsCntInstUsedOutsideLoop &amp;&amp; IsCntPhiUsedOutsideLoop)</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For some CPUs result of CTLZ(X) intrinsic is undefined</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// when X is 0 If we can not guarantee X != 0, we need to check this</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// when expand.</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ZeroCheck = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is safe to assume Preheader exist as it was checked in</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// parent function RunOnLoop.</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PH = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are using the count instruction outside the loop, make sure we</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have a zero check as a precondition. Without the check the loop would run</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// one iteration for before any check of the input value. This means 0 and 1</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// would have identical behavior in the original loop and thus</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsCntPhiUsedOutsideLoop) &#123;</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PreCondBB = PH-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PreCondBB)</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PreCondBI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PreCondBB-&gt;getTerminator());</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PreCondBI)</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a0334b7852f3d535571315a1c2a90a085">matchCondition</a>(PreCondBI, PH) != InitX)</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">    ZeroCheck = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FFS idiom loop has only 6 instructions:</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %n.addr.0 = phi &#91; %n, %entry &#93;, &#91; %shr, %while.cond &#93;</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %i.0 = phi &#91; %i0, %entry &#93;, &#91; %inc, %while.cond &#93;</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %shr = ashr %n.addr.0, 1</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %tobool = icmp eq %shr, 0</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %inc = add nsw %i.0, 1</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  br i1 %tobool</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> IdiomCanonicalSize = 6;</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isProfitableToInsertFFS(IntrinID, InitX, ZeroCheck, IdiomCanonicalSize))</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">  transformLoopToCountable(IntrinID, PH, CntInst, CntPhi, InitX, DefX,</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">                           DefX-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>(), ZeroCheck,</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">                           IsCntPhiUsedOutsideLoop);</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlightComment">/// Recognize CTLZ or CTTZ idiom in a non-countable loop and convert the loop</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlightComment">/// to countable (with CTLZ / CTTZ trip count). If CTLZ / CTTZ inserted as a new</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlightComment">/// trip count returns true; otherwise, returns false.</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::recognizeAndInsertFFS() &#123;</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Give up if the loop has multiple blocks or multiple backedges.</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a389bb3581ba3c8094b89642efaf8e514">getNumBackEdges</a>() != 1 || CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a261ee3c4745564c7be9283984c9af06b">getNumBlocks</a>() != 1)</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrinID;</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;InitX;</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;DefX = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;CntPhi = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CntInst = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a7ff0d8853961745bbe8afef66fab99dc">detectShiftUntilZeroIdiom</a>(CurLoop, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IntrinID, InitX, CntInst, CntPhi,</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">                                 DefX))</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> insertFFSIfProfitable(IntrinID, InitX, DefX, CntPhi, CntInst);</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::recognizeShiftUntilLessThan() &#123;</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Give up if the loop has multiple blocks or multiple backedges.</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a389bb3581ba3c8094b89642efaf8e514">getNumBackEdges</a>() != 1 || CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a261ee3c4745564c7be9283984c9af06b">getNumBlocks</a>() != 1)</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrinID;</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;InitX;</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;DefX = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;CntPhi = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CntInst = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/apint">APInt</a> LoopThreshold;</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a3a0cafd820690b73a6169ab519d77d2a">detectShiftUntilLessThanIdiom</a>(CurLoop, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, IntrinID, InitX, CntInst,</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">                                     CntPhi, DefX, LoopThreshold))</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopThreshold == 2) &#123;</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Treat as regular FFS.</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> insertFFSIfProfitable(IntrinID, InitX, DefX, CntPhi, CntInst);</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for Floor Log2 Idiom.</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopThreshold != 4)</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Abort if CntPhi is used outside of the loop.</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : CntPhi-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>())</span></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)))</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is safe to assume Preheader exist as it was checked in</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// parent function RunOnLoop.</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PH = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PreCondBB = PH-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PreCondBB)</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PreCondBI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PreCondBB-&gt;getTerminator());</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PreCondBI)</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/apint">APInt</a> PreLoopThreshold;</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ab57bfa30e7fbef3fb394f7bd5cfa6d0a">matchShiftULTCondition</a>(PreCondBI, PH, PreLoopThreshold) != InitX ||</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">      PreLoopThreshold != 2)</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ZeroCheck = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the loop has only 6 instructions:</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %n.addr.0 = phi &#91; %n, %entry &#93;, &#91; %shr, %while.cond &#93;</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %i.0 = phi &#91; %i0, %entry &#93;, &#91; %inc, %while.cond &#93;</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %shr = ashr %n.addr.0, 1</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %tobool = icmp ult %n.addr.0, C</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  %inc = add nsw %i.0, 1</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  br i1 %tobool</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> IdiomCanonicalSize = 6;</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isProfitableToInsertFFS(IntrinID, InitX, ZeroCheck, IdiomCanonicalSize))</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// log2(x) = w − 1 − clz(x)</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">  transformLoopToCountable(IntrinID, PH, CntInst, CntPhi, InitX, DefX,</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><span class="doxyHighlight">                           DefX-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>(), ZeroCheck,</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">                           </span><span class="doxyHighlightComment">/&#42;IsCntPhiUsedOutsideLoop=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">                           </span><span class="doxyHighlightComment">/&#42;InsertSub=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><span class="doxyHighlightComment">/// Recognizes a population count idiom in a non-countable loop.</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlightComment">/// If detected, transforms the relevant code to issue the popcount intrinsic</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlightComment">/// function call, and returns true; otherwise, returns false.</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::recognizePopcount() &#123;</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getPopcntSupport(32) != <a href="/docs/api/classes/llvm/targettransforminfo/#aa4c17e89b1ef061ed69f42b7cee93dbeac71465fd61f1ba8aa2c7c397722b5e05">TargetTransformInfo::PSK&#95;FastHardware</a>)</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Counting population are usually conducted by few arithmetic instructions.</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Such instructions can be easily &quot;absorbed&quot; by vacant slots in a</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// non-compact loop. Therefore, recognizing popcount idiom only makes sense</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in a compact loop.</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Give up if the loop has multiple blocks or multiple backedges.</span></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a389bb3581ba3c8094b89642efaf8e514">getNumBackEdges</a>() != 1 || CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a261ee3c4745564c7be9283984c9af06b">getNumBlocks</a>() != 1)</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopBody = &#42;(CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#af9096a02aa326d9a55f4d16ba9f9d243">block&#95;begin</a>());</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopBody-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>() &gt;= 20) &#123;</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The loop is too big, bail out.</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It should have a preheader containing nothing but an unconditional branch.</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PH = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PH || &amp;PH-&gt;<a href="/docs/api/classes/llvm/basicblock/#a63cfb2a0dae69153fd961eb335949caa">front</a>() != PH-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>())</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EntryBI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PH-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EntryBI || EntryBI-&gt;isConditional())</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It should have a precondition block where the generated popcount intrinsic</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function can be inserted.</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PreCondBB = PH-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PreCondBB)</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PreCondBI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(PreCondBB-&gt;getTerminator());</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PreCondBI || PreCondBI-&gt;isUnconditional())</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CntInst;</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;CntPhi;</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val;</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a48f061a53492f73dc9d82812f4350b44">detectPopcountIdiom</a>(CurLoop, PreCondBB, CntInst, CntPhi, Val))</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlight">  transformLoopToPopcount(PreCondBB, CntInst, CntPhi, Val);</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119" lineLink="#a7891243700b67217e42c82bb4224eb0c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="#a7891243700b67217e42c82bb4224eb0c">createPopcntIntrinsic</a>(<a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;<a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val,</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;&#93; = &#123;Val&#125;;</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Tys&#91;&#93; = &#123;Val-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()&#125;;</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a80eec4efbded89b11092babf42a65b82">CreateIntrinsic</a>(Intrinsic::ctpop, Tys, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>);</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">  CI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CI;</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130" lineLink="#a30a82385a4d14528fdc9819501044523"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="#a30a82385a4d14528fdc9819501044523">createFFSIntrinsic</a>(<a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> &amp;<a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val,</span></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ZeroCheck,</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">                                    <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID) &#123;</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;&#93; = &#123;Val, <a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a029317f08710bd90d20e85bdacdca921">getInt1</a>(ZeroCheck)&#125;;</span></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Tys&#91;&#93; = &#123;Val-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()&#125;;</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/classes/llvm/irbuilder">IRBuilder</a>.<a href="/docs/api/classes/llvm/irbuilderbase/#a80eec4efbded89b11092babf42a65b82">CreateIntrinsic</a>(IID, Tys, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>);</span></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlight">  CI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CI;</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlightComment">/// Transform the following loop (Using CTLZ, CTTZ is similar):</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><span class="doxyHighlightComment">/// loop:</span></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlightComment">///   CntPhi = PHI &#91;Cnt0, CntInst&#93;</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><span class="doxyHighlightComment">///   PhiX = PHI &#91;InitX, DefX&#93;</span></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlightComment">///   CntInst = CntPhi + 1</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlightComment">///   DefX = PhiX &gt;&gt; 1</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlightComment">///   LOOP&#95;BODY</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlightComment">///   Br: loop if (DefX != 0)</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><span class="doxyHighlightComment">/// Use(CntPhi) or Use(CntInst)</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlightComment">/// Into:</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlightComment">/// If CntPhi used outside the loop:</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><span class="doxyHighlightComment">///   CountPrev = BitWidth(InitX) - CTLZ(InitX &gt;&gt; 1)</span></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><span class="doxyHighlightComment">///   Count = CountPrev + 1</span></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlightComment">/// else</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><span class="doxyHighlightComment">///   Count = BitWidth(InitX) - CTLZ(InitX)</span></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><span class="doxyHighlightComment">/// loop:</span></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlightComment">///   CntPhi = PHI &#91;Cnt0, CntInst&#93;</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><span class="doxyHighlightComment">///   PhiX = PHI &#91;InitX, DefX&#93;</span></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlightComment">///   PhiCount = PHI &#91;Count, Dec&#93;</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><span class="doxyHighlightComment">///   CntInst = CntPhi + 1</span></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlightComment">///   DefX = PhiX &gt;&gt; 1</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlightComment">///   Dec = PhiCount - 1</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlightComment">///   LOOP&#95;BODY</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlightComment">///   Br: loop if (Dec != 0)</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><span class="doxyHighlightComment">/// Use(CountPrev + Cnt0) // Use(CntPhi)</span></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlightComment">/// or</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><span class="doxyHighlightComment">/// Use(Count + Cnt0) // Use(CntInst)</span></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><span class="doxyHighlightComment">/// If LOOP&#95;BODY is empty the loop will be deleted.</span></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><span class="doxyHighlightComment">/// If CntInst and DefX are not used in LOOP&#95;BODY they will be removed.</span></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> LoopIdiomRecognize::transformLoopToCountable(</span></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrinID, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CntInst,</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;CntPhi, <a href="/docs/api/classes/llvm/value">Value</a> &#42;InitX, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;DefX, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ZeroCheck, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsCntPhiUsedOutsideLoop, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InsertSub) &#123;</span></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;PreheaderBr = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 1: Insert the CTLZ/CTTZ instruction at the end of the preheader block</span></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(PreheaderBr);</span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are no uses of CntPhi crate:</span></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   Count = BitWidth - CTLZ(InitX);</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   NewCount = Count;</span></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are uses of CntPhi create:</span></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   NewCount = BitWidth - CTLZ(InitX &gt;&gt; 1);</span></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   Count = NewCount + 1;</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;InitXNext;</span></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsCntPhiUsedOutsideLoop) &#123;</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefX-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::AShr)</span></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">      InitXNext = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#adc6a2686b807c18e4a7f7fc58e68d423">CreateAShr</a>(InitX, 1);</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefX-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::LShr)</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">      InitXNext = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a5849d19e500f8c6713ec44889058f424">CreateLShr</a>(InitX, 1);</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefX-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Shl) </span><span class="doxyHighlightComment">// cttz</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><span class="doxyHighlight">      InitXNext = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b6a3be6451cf6a789d9305d90751c40">CreateShl</a>(InitX, 1);</span></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unexpected opcode!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">    InitXNext = InitX;</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> =</span></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlight">      <a href="#a30a82385a4d14528fdc9819501044523">createFFSIntrinsic</a>(Builder, InitXNext, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, ZeroCheck, IntrinID);</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CountTy = <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>-&gt;getType();</span></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><span class="doxyHighlight">      ConstantInt::get(CountTy, CountTy-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>()), <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>);</span></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InsertSub)</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>, ConstantInt::get(CountTy, 1));</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewCount = <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>;</span></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsCntPhiUsedOutsideLoop)</span></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>, ConstantInt::get(CountTy, 1));</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">  NewCount = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a36742c35a8fff5f74bb3d76c9c19dd47">CreateZExtOrTrunc</a>(NewCount, CntInst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CntInitVal = CntPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(Preheader);</span></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(CntInst-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1))-&gt;isOne()) &#123;</span></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the counter was being incremented in the loop, add NewCount to the</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// counter&#39;s initial value, but only if the initial value is not zero.</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;InitConst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(CntInitVal);</span></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InitConst || !InitConst-&gt;<a href="/docs/api/classes/llvm/constantint/#a882d55a6aa2028e1a5ad708b275334e0">isZero</a>())</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">      NewCount = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(NewCount, CntInitVal);</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the count was being decremented in the loop, subtract NewCount from</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the counter&#39;s initial value.</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">    NewCount = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(CntInitVal, NewCount);</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 2: Insert new IV and loop condition:</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop:</span></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   PhiCount = PHI &#91;Count, Dec&#93;</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   Dec = PhiCount - 1</span></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   Br: loop if (Dec != 0)</span></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Body = &#42;(CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#af9096a02aa326d9a55f4d16ba9f9d243">block&#95;begin</a>());</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LbBr = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Body-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;LbCond = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(LbBr-&gt;getCondition());</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;TcPhi = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(CountTy, 2, </span><span class="doxyHighlightStringLiteral">&quot;tcphi&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><span class="doxyHighlight">  TcPhi-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(Body-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(LbCond);</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TcDec = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(</span></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><span class="doxyHighlight">      TcPhi, ConstantInt::get(CountTy, 1), </span><span class="doxyHighlightStringLiteral">&quot;tcdec&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">  TcPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>, Preheader);</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><span class="doxyHighlight">  TcPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(TcDec, Body);</span></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred =</span></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">      (LbBr-&gt;getSuccessor(0) == Body) ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">CmpInst::ICMP&#95;NE</a> : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP&#95;EQ</a>;</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><span class="doxyHighlight">  LbCond-&gt;<a href="/docs/api/classes/llvm/cmpinst/#a126a12b67fa620ad28ec0c919ca7a3e8">setPredicate</a>(Pred);</span></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><span class="doxyHighlight">  LbCond-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, TcDec);</span></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><span class="doxyHighlight">  LbCond-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, ConstantInt::get(CountTy, 0));</span></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 3: All the references to the original counter outside</span></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  the loop are replaced with the NewCount</span></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsCntPhiUsedOutsideLoop)</span></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">    CntPhi-&gt;<a href="/docs/api/classes/llvm/value/#aa56e7093b552d99d48d66c5ae781236a">replaceUsesOutsideBlock</a>(NewCount, Body);</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><span class="doxyHighlight">    CntInst-&gt;<a href="/docs/api/classes/llvm/value/#aa56e7093b552d99d48d66c5ae781236a">replaceUsesOutsideBlock</a>(NewCount, Body);</span></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 4: Forget the &quot;non-computable&quot; trip-count SCEV associated with the</span></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   loop. The loop would otherwise not be deleted even if it becomes empty.</span></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">  SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a592bdd7731b14ff4ff5d646f6f399900">forgetLoop</a>(CurLoop);</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> LoopIdiomRecognize::transformLoopToPopcount(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PreCondBB,</span></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;CntInst,</span></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;CntPhi, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Var) &#123;</span></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PreHead = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PreCondBr = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(PreCondBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = CntInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>();</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Assuming before transformation, the loop is following:</span></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  if (x) // the precondition</span></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     do &#123; cnt++; x &amp;= x - 1; &#125; while(x);</span></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 1: Insert the ctpop instruction at the end of the precondition block</span></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(PreCondBr);</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;PopCnt, &#42;PopCntZext, &#42;NewCount, &#42;TripCnt;</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><span class="doxyHighlight">  &#123;</span></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><span class="doxyHighlight">    PopCnt = <a href="#a7891243700b67217e42c82bb4224eb0c">createPopcntIntrinsic</a>(Builder, Var, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><span class="doxyHighlight">    NewCount = PopCntZext =</span></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a36742c35a8fff5f74bb3d76c9c19dd47">CreateZExtOrTrunc</a>(PopCnt, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(CntPhi-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()));</span></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewCount != PopCnt)</span></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><span class="doxyHighlight">      (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(NewCount))-&gt;setDebugLoc(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TripCnt is exactly the number of iterations the loop has</span></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><span class="doxyHighlight">    TripCnt = NewCount;</span></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the population counter&#39;s initial value is not zero, insert Add Inst.</span></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CntInitVal = CntPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(PreHead);</span></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;InitConst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(CntInitVal);</span></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InitConst || !InitConst-&gt;<a href="/docs/api/classes/llvm/constantint/#a882d55a6aa2028e1a5ad708b275334e0">isZero</a>()) &#123;</span></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><span class="doxyHighlight">      NewCount = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(NewCount, CntInitVal);</span></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><span class="doxyHighlight">      (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(NewCount))-&gt;setDebugLoc(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 2: Replace the precondition from &quot;if (x == 0) goto loop-exit&quot; to</span></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &quot;if (NewCount == 0) loop-exit&quot;. Without this change, the intrinsic</span></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   function would be partial dead code, and downstream passes will drag</span></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   it back from the precondition block to the preheader.</span></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><span class="doxyHighlight">  &#123;</span></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;PreCond = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(PreCondBr-&gt;getCondition());</span></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd0 = PopCntZext;</span></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opnd1 = ConstantInt::get(PopCntZext-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 0);</span></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PreCond-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) != Var)</span></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><span class="doxyHighlight">      <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(Opnd0, Opnd1);</span></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;NewPreCond = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(</span></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ae0bd6c2fab2d18443038a8f3a2b64856">CreateICmp</a>(PreCond-&gt;<a href="/docs/api/classes/llvm/cmpinst/#aa7414ba9f658ff1287d22a4b8fe81bcb">getPredicate</a>(), Opnd0, Opnd1));</span></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><span class="doxyHighlight">    PreCondBr-&gt;setCondition(NewPreCond);</span></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a1106b8a15061e8494873e10bb8a364e5">RecursivelyDeleteTriviallyDeadInstructions</a>(PreCond, TLI);</span></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 3: Note that the population count is exactly the trip count of the</span></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop in question, which enable us to convert the loop from noncountable</span></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop into a countable one. The benefit is twofold:</span></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  - If the loop only counts population, the entire loop becomes dead after</span></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    the transformation. It is a lot easier to prove a countable loop dead</span></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    than to prove a noncountable one. (In some C dialects, an infinite loop</span></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    isn&#39;t dead even if it computes nothing useful. In general, DCE needs</span></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    to prove a noncountable loop finite before safely delete it.)</span></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  - If the loop also performs something else, it remains alive.</span></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    Since it is transformed to countable form, it can be aggressively</span></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    optimized by some optimizations which are in general not applicable</span></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    to a noncountable loop.</span></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// After this step, this loop (conceptually) would look like following:</span></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   newcnt = &#95;&#95;builtin&#95;ctpop(x);</span></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   t = newcnt;</span></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   if (x)</span></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//     do &#123; cnt++; x &amp;= x-1; t--) &#125; while (t &gt; 0);</span></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Body = &#42;(CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#af9096a02aa326d9a55f4d16ba9f9d243">block&#95;begin</a>());</span></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><span class="doxyHighlight">  &#123;</span></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LbBr = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Body-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/icmpinst">ICmpInst</a> &#42;LbCond = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(LbBr-&gt;getCondition());</span></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = TripCnt-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;TcPhi = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(Ty, 2, </span><span class="doxyHighlightStringLiteral">&quot;tcphi&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><span class="doxyHighlight">    TcPhi-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(Body-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(LbCond);</span></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TcDec = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(</span></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(TcPhi, ConstantInt::get(Ty, 1),</span></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><span class="doxyHighlight">                          </span><span class="doxyHighlightStringLiteral">&quot;tcdec&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><span class="doxyHighlight">    TcPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(TripCnt, PreHead);</span></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><span class="doxyHighlight">    TcPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(TcDec, Body);</span></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred =</span></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><span class="doxyHighlight">        (LbBr-&gt;getSuccessor(0) == Body) ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">CmpInst::ICMP&#95;UGT</a> : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba2751d6136a2819749dcef65dc19a4246">CmpInst::ICMP&#95;SLE</a>;</span></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><span class="doxyHighlight">    LbCond-&gt;<a href="/docs/api/classes/llvm/cmpinst/#a126a12b67fa620ad28ec0c919ca7a3e8">setPredicate</a>(Pred);</span></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><span class="doxyHighlight">    LbCond-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, TcDec);</span></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><span class="doxyHighlight">    LbCond-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(1, ConstantInt::get(Ty, 0));</span></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 4: All the references to the original population counter outside</span></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  the loop are replaced with the NewCount -- the value returned from</span></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  &#95;&#95;builtin&#95;ctpop().</span></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><span class="doxyHighlight">  CntInst-&gt;<a href="/docs/api/classes/llvm/value/#aa56e7093b552d99d48d66c5ae781236a">replaceUsesOutsideBlock</a>(NewCount, Body);</span></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// step 5: Forget the &quot;non-computable&quot; trip-count SCEV associated with the</span></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   loop. The loop would otherwise not be deleted even if it becomes empty.</span></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><span class="doxyHighlight">  SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a592bdd7731b14ff4ff5d646f6f399900">forgetLoop</a>(CurLoop);</span></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><span class="doxyHighlightComment">/// Match loop-invariant value.</span></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375" lineLink="/docs/api/structs/match-loopinvariant"><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> SubPattern&#95;t&gt; </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/match-loopinvariant/#a6f131444d55da7baae124947522860e5">match&#95;LoopInvariant</a> &#123;</span></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376" lineLink="/docs/api/structs/match-loopinvariant/#ab80c6bca262e3acb5a845956ee23ebe0"><span class="doxyHighlight">  SubPattern&#95;t <a href="/docs/api/structs/match-loopinvariant/#ab80c6bca262e3acb5a845956ee23ebe0">SubPattern</a>;</span></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377" lineLink="/docs/api/structs/match-loopinvariant/#ab4196b7cec294de605709d4e2f7bdca8"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/structs/match-loopinvariant/#ab4196b7cec294de605709d4e2f7bdca8">L</a>;</span></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379" lineLink="/docs/api/structs/match-loopinvariant/#a6f131444d55da7baae124947522860e5"><span class="doxyHighlight">  <a href="/docs/api/structs/match-loopinvariant/#a6f131444d55da7baae124947522860e5">match&#95;LoopInvariant</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SubPattern&#95;t &amp;SP, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/structs/match-loopinvariant/#ab4196b7cec294de605709d4e2f7bdca8">L</a>)</span></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><span class="doxyHighlight">      : <a href="/docs/api/structs/match-loopinvariant/#ab80c6bca262e3acb5a845956ee23ebe0">SubPattern</a>(SP), <a href="/docs/api/structs/match-loopinvariant/#ab4196b7cec294de605709d4e2f7bdca8">L</a>(<a href="/docs/api/structs/match-loopinvariant/#ab4196b7cec294de605709d4e2f7bdca8">L</a>) &#123;&#125;</span></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382" lineLink="/docs/api/structs/match-loopinvariant/#af1067ef7599d580590a21ba0dc9fd29b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> ITy&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/match-loopinvariant/#af1067ef7599d580590a21ba0dc9fd29b">match</a>(ITy &#42;V) &#123;</span></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/match-loopinvariant/#ab4196b7cec294de605709d4e2f7bdca8">L</a>-&gt;isLoopInvariant(V) &amp;&amp; <a href="/docs/api/structs/match-loopinvariant/#ab80c6bca262e3acb5a845956ee23ebe0">SubPattern</a>.match(V);</span></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><span class="doxyHighlightComment">/// Matches if the value is loop-invariant.</span></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> Ty&gt;</span></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389" lineLink="#aba9b4dc5dd854ec2a8c8d92c0df7b4cd"><span class="doxyHighlightKeyword">inline</span><span class="doxyHighlight"> <a href="/docs/api/structs/match-loopinvariant">match&#95;LoopInvariant&lt;Ty&gt;</a> <a href="#aba9b4dc5dd854ec2a8c8d92c0df7b4cd">m&#95;LoopInvariant</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Ty &amp;M, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</span></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/match-loopinvariant">match&#95;LoopInvariant&lt;Ty&gt;</a>(M, L);</span></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><span class="doxyHighlightComment">/// Return true if the idiom is detected in the loop.</span></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><span class="doxyHighlightComment">/// The core idiom we are trying to detect is:</span></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><span class="doxyHighlightComment">///   entry:</span></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><span class="doxyHighlightComment">///     %bitmask = shl i32 1, %bitpos</span></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><span class="doxyHighlightComment">///     br label %loop</span></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><span class="doxyHighlightComment">///   loop:</span></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><span class="doxyHighlightComment">///     %x.curr = phi i32 &#91; %x, %entry &#93;, &#91; %x.next, %loop &#93;</span></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><span class="doxyHighlightComment">///     %x.curr.bitmasked = and i32 %x.curr, %bitmask</span></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><span class="doxyHighlightComment">///     %x.curr.isbitunset = icmp eq i32 %x.curr.bitmasked, 0</span></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><span class="doxyHighlightComment">///     %x.next = shl i32 %x.curr, 1</span></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><span class="doxyHighlightComment">///     br i1 %x.curr.isbitunset, label %loop, label %end</span></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><span class="doxyHighlightComment">///   end:</span></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><span class="doxyHighlightComment">///     %x.curr.res = phi i32 &#91; %x.curr, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><span class="doxyHighlightComment">///     %x.next.res = phi i32 &#91; %x.next, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415" lineLink="#a419746e2bdc89fee0101b010a13ec0c7"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a419746e2bdc89fee0101b010a13ec0c7">detectShiftUntilBitTestIdiom</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;BaseX,</span></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;BitMask, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;BitPos,</span></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;CurrX, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp;NextX) &#123;</span></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a></span></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot; Performing shift-until-bittest idiom detection.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Give up if the loop has multiple blocks or multiple backedges.</span></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a261ee3c4745564c7be9283984c9af06b">getNumBlocks</a>() != 1 || CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a389bb3581ba3c8094b89642efaf8e514">getNumBackEdges</a>() != 1) &#123;</span></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Bad block/backedge count.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopHeaderBB = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>();</span></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopPreheaderBB = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</span></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LoopPreheaderBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There is always a loop preheader.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 1: Check if the loop backedge is in desirable form.</span></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> Pred;</span></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CmpLHS, &#42;CmpRHS;</span></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueBB, &#42;FalseBB;</span></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LoopHeaderBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(),</span></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/patternmatch/#a811d001fa503a556ac2a48d64366500f">m&#95;Br</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ab86c85b47e09489dcda68fd91d082d77">m&#95;ICmp</a>(Pred, <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(CmpLHS), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(CmpRHS)),</span></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><span class="doxyHighlight">                  <a href="/docs/api/namespaces/llvm/patternmatch/#ad856c036ca10c903c93082a4e784d4a6">m&#95;BasicBlock</a>(TrueBB), <a href="/docs/api/namespaces/llvm/patternmatch/#ad856c036ca10c903c93082a4e784d4a6">m&#95;BasicBlock</a>(FalseBB)))) &#123;</span></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Bad backedge structure.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 2: Check if the backedge&#39;s condition is in desirable form.</span></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MatchVariableBitMask = &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/icmpinst/#aaaeded5d0cab77f531b294638459aca5">ICmpInst::isEquality</a>(Pred) &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(CmpRHS, <a href="/docs/api/namespaces/llvm/patternmatch/#ae77be336e228cf9aa00709a8606dfb98">m&#95;Zero</a>()) &amp;&amp;</span></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(CmpLHS,</span></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><span class="doxyHighlight">                 <a href="/docs/api/namespaces/llvm/patternmatch/#a1981217907f3dfb1d21e902d0396fb4d">m&#95;c&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(CurrX),</span></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><span class="doxyHighlight">                         <a href="/docs/api/namespaces/llvm/patternmatch/#a469c3ed35e782000933c996ccd2d2333">m&#95;CombineAnd</a>(</span></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><span class="doxyHighlight">                             <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(BitMask),</span></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><span class="doxyHighlight">                             <a href="#aba9b4dc5dd854ec2a8c8d92c0df7b4cd">m&#95;LoopInvariant</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a3b3d2d8c64a7881acb82bc7467569aa9">m&#95;One</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(BitPos)),</span></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><span class="doxyHighlight">                                             CurLoop))));</span></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MatchConstantBitMask = &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/icmpinst/#aaaeded5d0cab77f531b294638459aca5">ICmpInst::isEquality</a>(Pred) &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(CmpRHS, <a href="/docs/api/namespaces/llvm/patternmatch/#ae77be336e228cf9aa00709a8606dfb98">m&#95;Zero</a>()) &amp;&amp;</span></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(CmpLHS, <a href="/docs/api/namespaces/llvm/patternmatch/#a014d851989a66ce781c4f89dfffb26b5">m&#95;And</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(CurrX),</span></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><span class="doxyHighlight">                               <a href="/docs/api/namespaces/llvm/patternmatch/#a469c3ed35e782000933c996ccd2d2333">m&#95;CombineAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(BitMask), <a href="/docs/api/namespaces/llvm/patternmatch/#a103f4e50bfeab3d598adc56e1235c241">m&#95;Power2</a>()))) &amp;&amp;</span></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><span class="doxyHighlight">           (BitPos = <a href="/docs/api/classes/llvm/constantexpr/#af46fd5126112a587bb12f09b1c0e385b">ConstantExpr::getExactLogBase2</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Constant&gt;</a>(BitMask)));</span></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MatchDecomposableConstantBitMask = &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Res = <a href="/docs/api/namespaces/llvm/#aaf52bffe6dc4a6d5d5cf515aac2e4450">llvm::decomposeBitTestICmp</a>(CmpLHS, CmpRHS, Pred);</span></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Res &amp;&amp; Res-&gt;Mask.isPowerOf2()) &#123;</span></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/icmpinst/#abe8988eef2e6fc2baba032cb22afedd7">ICmpInst::isEquality</a>(Res-&gt;Pred));</span></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><span class="doxyHighlight">      Pred = Res-&gt;Pred;</span></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><span class="doxyHighlight">      CurrX = Res-&gt;X;</span></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><span class="doxyHighlight">      BitMask = ConstantInt::get(CurrX-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), Res-&gt;Mask);</span></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><span class="doxyHighlight">      BitPos = ConstantInt::get(CurrX-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), Res-&gt;Mask.logBase2());</span></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MatchVariableBitMask() &amp;&amp; !MatchConstantBitMask() &amp;&amp;</span></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><span class="doxyHighlight">      !MatchDecomposableConstantBitMask()) &#123;</span></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Bad backedge comparison.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 3: Check if the recurrence is in desirable form.</span></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CurrXPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(CurrX);</span></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurrXPN || CurrXPN-&gt;getParent() != LoopHeaderBB) &#123;</span></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Not an expected PHI node.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><span class="doxyHighlight">  BaseX = CurrXPN-&gt;getIncomingValueForBlock(LoopPreheaderBB);</span></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><span class="doxyHighlight">  NextX =</span></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(CurrXPN-&gt;getIncomingValueForBlock(LoopHeaderBB));</span></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a6cb6a58fb0ded82b4c7755fc4c27c86d">isLoopInvariant</a>(BaseX) &amp;&amp;</span></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected BaseX to be available in the preheader!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NextX || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(NextX, <a href="/docs/api/namespaces/llvm/patternmatch/#ac1c7b78fe67245930be18441b77de500">m&#95;Shl</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(CurrX), <a href="/docs/api/namespaces/llvm/patternmatch/#a3b3d2d8c64a7881acb82bc7467569aa9">m&#95;One</a>()))) &#123;</span></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: support right-shift?</span></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Bad recurrence.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 4: Check if the backedge&#39;s destinations are in desirable form.</span></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/icmpinst/#abe8988eef2e6fc2baba032cb22afedd7">ICmpInst::isEquality</a>(Pred) &amp;&amp;</span></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Should only get equality predicates here.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cmp-br is commutative, so canonicalize to a single variant.</span></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::Predicate::ICMP&#95;EQ</a>) &#123;</span></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#aa2a54b545d237ecfe450fd1292f7675e">ICmpInst::getInversePredicate</a>(Pred);</span></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(TrueBB, FalseBB);</span></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We expect to exit loop when comparison yields false,</span></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so when it yields true we should branch back to loop header.</span></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TrueBB != LoopHeaderBB) &#123;</span></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Bad backedge flow.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, idiom checks out.</span></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><span class="doxyHighlightComment">/// Look for the following loop:</span></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><span class="doxyHighlightComment">///   entry:</span></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><span class="doxyHighlightComment">///     %bitmask = shl i32 1, %bitpos</span></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><span class="doxyHighlightComment">///     br label %loop</span></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><span class="doxyHighlightComment">///   loop:</span></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><span class="doxyHighlightComment">///     %x.curr = phi i32 &#91; %x, %entry &#93;, &#91; %x.next, %loop &#93;</span></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><span class="doxyHighlightComment">///     %x.curr.bitmasked = and i32 %x.curr, %bitmask</span></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><span class="doxyHighlightComment">///     %x.curr.isbitunset = icmp eq i32 %x.curr.bitmasked, 0</span></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><span class="doxyHighlightComment">///     %x.next = shl i32 %x.curr, 1</span></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><span class="doxyHighlightComment">///     br i1 %x.curr.isbitunset, label %loop, label %end</span></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><span class="doxyHighlightComment">///   end:</span></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><span class="doxyHighlightComment">///     %x.curr.res = phi i32 &#91; %x.curr, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><span class="doxyHighlightComment">///     %x.next.res = phi i32 &#91; %x.next, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><span class="doxyHighlightComment">/// And transform it into:</span></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><span class="doxyHighlightComment">///   entry:</span></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><span class="doxyHighlightComment">///     %bitmask = shl i32 1, %bitpos</span></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><span class="doxyHighlightComment">///     %lowbitmask = add i32 %bitmask, -1</span></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><span class="doxyHighlightComment">///     %mask = or i32 %lowbitmask, %bitmask</span></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><span class="doxyHighlightComment">///     %x.masked = and i32 %x, %mask</span></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><span class="doxyHighlightComment">///     %x.masked.numleadingzeros = call i32 @llvm.ctlz.i32(i32 %x.masked,</span></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><span class="doxyHighlightComment">///                                                         i1 true)</span></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><span class="doxyHighlightComment">///     %x.masked.numactivebits = sub i32 32, %x.masked.numleadingzeros</span></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><span class="doxyHighlightComment">///     %x.masked.leadingonepos = add i32 %x.masked.numactivebits, -1</span></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><span class="doxyHighlightComment">///     %backedgetakencount = sub i32 %bitpos, %x.masked.leadingonepos</span></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><span class="doxyHighlightComment">///     %tripcount = add i32 %backedgetakencount, 1</span></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><span class="doxyHighlightComment">///     %x.curr = shl i32 %x, %backedgetakencount</span></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><span class="doxyHighlightComment">///     %x.next = shl i32 %x, %tripcount</span></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><span class="doxyHighlightComment">///     br label %loop</span></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><span class="doxyHighlightComment">///   loop:</span></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><span class="doxyHighlightComment">///     %loop.iv = phi i32 &#91; 0, %entry &#93;, &#91; %loop.iv.next, %loop &#93;</span></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><span class="doxyHighlightComment">///     %loop.iv.next = add nuw i32 %loop.iv, 1</span></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><span class="doxyHighlightComment">///     %loop.ivcheck = icmp eq i32 %loop.iv.next, %tripcount</span></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><span class="doxyHighlightComment">///     br i1 %loop.ivcheck, label %end, label %loop</span></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><span class="doxyHighlightComment">///   end:</span></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><span class="doxyHighlightComment">///     %x.curr.res = phi i32 &#91; %x.curr, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><span class="doxyHighlightComment">///     %x.next.res = phi i32 &#91; %x.next, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::recognizeShiftUntilBitTest() &#123;</span></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;BitMask, &#42;BitPos, &#42;XCurr;</span></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;XNext;</span></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a419746e2bdc89fee0101b010a13ec0c7">detectShiftUntilBitTestIdiom</a>(CurLoop, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, BitMask, BitPos, XCurr,</span></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><span class="doxyHighlight">                                    XNext)) &#123;</span></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a></span></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot; shift-until-bittest idiom detection failed.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; shift-until-bittest idiom detected!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ok, it is the idiom we were looking for, we &#42;could&#42; transform this loop,</span></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// but is it profitable to transform?</span></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopHeaderBB = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>();</span></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopPreheaderBB = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</span></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LoopPreheaderBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There is always a loop preheader.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccessorBB = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ab48af53a5000ecede46c76dabb4578d2">getExitBlock</a>();</span></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SuccessorBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There is only a single successor.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(LoopPreheaderBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(XCurr)-&gt;<a href="/docs/api/files/lib/lib/codegen/machineinstrbundle-cpp/#af44c9b089359803924e0b92bea3b6d03">getDebugLoc</a>());</span></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrID = Intrinsic::ctlz;</span></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType();</span></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Bitwidth = Ty-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bb">TargetTransformInfo::TargetCostKind</a> <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a> =</span></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>;</span></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The rewrite is considered to be unprofitable iff and only iff the</span></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// intrinsic/shift we&#39;ll use are not cheap. Note that we are okay with &#42;just&#42;</span></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// making the loop countable, even if nothing else changes.</span></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/intrinsiccostattributes">IntrinsicCostAttributes</a> <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>(</span></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><span class="doxyHighlight">      IntrID, Ty, &#123;<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Ty), </span><span class="doxyHighlightComment">/&#42;is&#95;zero&#95;poison=&#42;/</span><span class="doxyHighlight">Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a42ce8aa34864a9d974958b9d3d36ad17">getTrue</a>()&#125;);</span></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getIntrinsicInstrCost(Attrs, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>);</span></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> &gt; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>) &#123;</span></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a></span></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot; Intrinsic is too costly, not beneficial\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getArithmeticInstrCost(Instruction::Shl, Ty, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>) &gt;</span></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>) &#123;</span></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Shift is too costly, not beneficial\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ok, transform appears worthwhile.</span></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><span class="doxyHighlight">  MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab8a7ef433279aabf7f30fa5504a4d4ef">isGuaranteedNotToBeUndefOrPoison</a>(BitPos)) &#123;</span></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// BitMask may be computed from BitPos, Freeze BitPos so we can increase</span></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it&#39;s use count.</span></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><span class="doxyHighlight">    std::optional&lt;BasicBlock::iterator&gt; InsertPt = std::nullopt;</span></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BitPosI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(BitPos))</span></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><span class="doxyHighlight">      InsertPt = BitPosI-&gt;getInsertionPointAfterDef();</span></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><span class="doxyHighlight">      InsertPt = DT-&gt;<a href="/docs/api/classes/llvm/dominatortreebase/#a81f7fe4844c408d799428082f599c40b">getRoot</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#aab4db88f47575918879912e8ca511756">getFirstNonPHIOrDbgOrAlloca</a>();</span></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InsertPt)</span></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/freezeinst">FreezeInst</a> &#42;BitPosFrozen =</span></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/freezeinst">FreezeInst</a>(BitPos, BitPos-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.fr&quot;</span><span class="doxyHighlight">, &#42;InsertPt);</span></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><span class="doxyHighlight">    BitPos-&gt;<a href="/docs/api/classes/llvm/value/#a7e8dad1701aa6445be4a29f654b0473c">replaceUsesWithIf</a>(BitPosFrozen, &#91;BitPosFrozen&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) &#123;</span></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.getUser() != BitPosFrozen;</span></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><span class="doxyHighlight">    BitPos = BitPosFrozen;</span></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 1: Compute the loop trip count.</span></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LowBitMask = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(BitMask, <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(Ty),</span></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><span class="doxyHighlight">                                        BitPos-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.lowbitmask&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/bitmaskenumdetail/#a4562904154aff9698a612bc7f6086a4c">Mask</a> =</span></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ab61be8e3cf17e9848aeeeabacfa1b09a">CreateOr</a>(LowBitMask, BitMask, BitPos-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.mask&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;XMasked = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aa4f2cec52a8e17a4c72319334fbef771">CreateAnd</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, Mask, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.masked&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;XMaskedNumLeadingZeros = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a80eec4efbded89b11092babf42a65b82">CreateIntrinsic</a>(</span></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><span class="doxyHighlight">      IntrID, Ty, &#123;XMasked, </span><span class="doxyHighlightComment">/&#42;is&#95;zero&#95;poison=&#42;/</span><span class="doxyHighlight">Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a42ce8aa34864a9d974958b9d3d36ad17">getTrue</a>()&#125;,</span></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;FMFSource=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, XMasked-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.numleadingzeros&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;XMaskedNumActiveBits = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(</span></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><span class="doxyHighlight">      ConstantInt::get(Ty, Ty-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()), XMaskedNumLeadingZeros,</span></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><span class="doxyHighlight">      XMasked-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.numactivebits&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;HasNSW=&#42;/</span><span class="doxyHighlight">Bitwidth != 2);</span></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;XMaskedLeadingOnePos =</span></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(XMaskedNumActiveBits, <a href="/docs/api/classes/llvm/constant/#a4d51384de6e1798bb6aa875aebeea9f0">Constant::getAllOnesValue</a>(Ty),</span></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><span class="doxyHighlight">                        XMasked-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.leadingonepos&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42;HasNSW=&#42;/</span><span class="doxyHighlight">Bitwidth &gt; 2);</span></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LoopBackedgeTakenCount = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(</span></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><span class="doxyHighlight">      BitPos, XMaskedLeadingOnePos, CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a917a64b00c1745fd0c78c2b2320cd4ad">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.backedgetakencount&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;HasNSW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We know loop&#39;s backedge-taken count, but what&#39;s loop&#39;s trip count?</span></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that while NUW is always safe, while NSW is only for bitwidths != 2</span></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LoopTripCount =</span></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(LoopBackedgeTakenCount, ConstantInt::get(Ty, 1),</span></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><span class="doxyHighlight">                        CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a917a64b00c1745fd0c78c2b2320cd4ad">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.tripcount&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42;HasNSW=&#42;/</span><span class="doxyHighlight">Bitwidth != 2);</span></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 2: Compute the recurrence&#39;s final value without a loop.</span></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NewX is always safe to compute, because &#96;LoopBackedgeTakenCount&#96;</span></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will always be smaller than &#96;bitwidth(X)&#96;, i.e. we never get poison.</span></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewX = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b6a3be6451cf6a789d9305d90751c40">CreateShl</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, LoopBackedgeTakenCount);</span></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><span class="doxyHighlight">  NewX-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(XCurr);</span></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(NewX))</span></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;copyIRFlags(XNext, </span><span class="doxyHighlightComment">/&#42;IncludeWrapFlags=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;NewXNext;</span></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Rewriting XNext is more complicated, however, because &#96;X &lt;&lt; LoopTripCount&#96;</span></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will be poison iff &#96;LoopTripCount == bitwidth(X)&#96; (which will happen</span></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iff &#96;BitPos&#96; is &#96;bitwidth(x) - 1&#96; and &#96;X&#96; is &#96;1&#96;). So unless we know</span></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that isn&#39;t the case, we&#39;ll need to emit an alternative, safe IR.</span></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XNext-&gt;<a href="/docs/api/classes/llvm/instruction/#a350f4fdc01c770b5cf6a8be2624ae3e5">hasNoSignedWrap</a>() || XNext-&gt;<a href="/docs/api/classes/llvm/instruction/#a100c666f9253331dd1d166a863248326">hasNoUnsignedWrap</a>() ||</span></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">PatternMatch::match</a>(</span></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><span class="doxyHighlight">          BitPos, <a href="/docs/api/namespaces/llvm/patternmatch/#afd8ce417d0ae1bee23037a373487fe42">PatternMatch::m&#95;SpecificInt&#95;ICMP</a>(</span></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">ICmpInst::ICMP&#95;NE</a>, <a href="/docs/api/classes/llvm/apint">APInt</a>(Ty-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>(),</span></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><span class="doxyHighlight">                                               Ty-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() - 1))))</span></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><span class="doxyHighlight">    NewXNext = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b6a3be6451cf6a789d9305d90751c40">CreateShl</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, LoopTripCount);</span></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, just additionally shift by one. It&#39;s the smallest solution,</span></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// alternatively, we could check that NewX is INT&#95;MIN (or BitPos is )</span></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and select 0 instead.</span></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><span class="doxyHighlight">    NewXNext = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b6a3be6451cf6a789d9305d90751c40">CreateShl</a>(NewX, ConstantInt::get(Ty, 1));</span></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><span class="doxyHighlight">  NewXNext-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(XNext);</span></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(NewXNext))</span></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;copyIRFlags(XNext, </span><span class="doxyHighlightComment">/&#42;IncludeWrapFlags=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 3: Adjust the successor basic block to recieve the computed</span></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//         recurrence&#39;s final value instead of the recurrence itself.</span></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><span class="doxyHighlight">  XCurr-&gt;<a href="/docs/api/classes/llvm/value/#aa56e7093b552d99d48d66c5ae781236a">replaceUsesOutsideBlock</a>(NewX, LoopHeaderBB);</span></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><span class="doxyHighlight">  XNext-&gt;<a href="/docs/api/classes/llvm/value/#aa56e7093b552d99d48d66c5ae781236a">replaceUsesOutsideBlock</a>(NewXNext, LoopHeaderBB);</span></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 4: Rewrite the loop into a countable form, with canonical IV.</span></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The new canonical induction variable.</span></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(LoopHeaderBB, LoopHeaderBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(Ty, 2, CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a917a64b00c1745fd0c78c2b2320cd4ad">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.iv&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The induction itself.</span></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that while NUW is always safe, while NSW is only for bitwidths != 2</span></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(LoopHeaderBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IVNext =</span></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, ConstantInt::get(Ty, 1), <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.next&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;HasNSW=&#42;/</span><span class="doxyHighlight">Bitwidth != 2);</span></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The loop trip count check.</span></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IVCheck = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(IVNext, LoopTripCount,</span></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><span class="doxyHighlight">                                       CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a917a64b00c1745fd0c78c2b2320cd4ad">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ivcheck&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(IVCheck, SuccessorBB, LoopHeaderBB);</span></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><span class="doxyHighlight">  LoopHeaderBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Populate the IV PHI.</span></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;addIncoming(ConstantInt::get(Ty, 0), LoopPreheaderBB);</span></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;addIncoming(IVNext, LoopHeaderBB);</span></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 5: Forget the &quot;non-computable&quot; trip-count SCEV associated with the</span></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   loop. The loop would otherwise not be deleted even if it becomes empty.</span></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><span class="doxyHighlight">  SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a592bdd7731b14ff4ff5d646f6f399900">forgetLoop</a>(CurLoop);</span></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Other passes will take care of actually deleting the loop if possible.</span></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; shift-until-bittest idiom optimized!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><span class="doxyHighlight">  ++NumShiftUntilBitTest;</span></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><span class="doxyHighlightComment">/// Return true if the idiom is detected in the loop.</span></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><span class="doxyHighlightComment">/// The core idiom we are trying to detect is:</span></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><span class="doxyHighlightComment">///   entry:</span></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><span class="doxyHighlightComment">///     %start = &lt;...&gt;</span></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><span class="doxyHighlightComment">///     %extraoffset = &lt;...&gt;</span></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><span class="doxyHighlightComment">///     br label %for.cond</span></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><span class="doxyHighlightComment">///   loop:</span></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><span class="doxyHighlightComment">///     %iv = phi i8 &#91; %start, %entry &#93;, &#91; %iv.next, %for.cond &#93;</span></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><span class="doxyHighlightComment">///     %nbits = add nsw i8 %iv, %extraoffset</span></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><span class="doxyHighlightComment">///     %val.shifted = &#123;&#123;l,a&#125;shr,shl&#125; i8 %val, %nbits</span></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><span class="doxyHighlightComment">///     %val.shifted.iszero = icmp eq i8 %val.shifted, 0</span></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><span class="doxyHighlightComment">///     %iv.next = add i8 %iv, 1</span></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><span class="doxyHighlightComment">///     br i1 %val.shifted.iszero, label %end, label %loop</span></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><span class="doxyHighlightComment">///   end:</span></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><span class="doxyHighlightComment">///     %iv.res = phi i8 &#91; %iv, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><span class="doxyHighlightComment">///     %nbits.res = phi i8 &#91; %nbits, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><span class="doxyHighlightComment">///     %val.shifted.res = phi i8 &#91; %val.shifted, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><span class="doxyHighlightComment">///     %val.shifted.iszero.res = phi i1 &#91; %val.shifted.iszero, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><span class="doxyHighlightComment">///     %iv.next.res = phi i8 &#91; %iv.next, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774" lineLink="#ab329d363cb73927378483de592986282"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a7ff0d8853961745bbe8afef66fab99dc">detectShiftUntilZeroIdiom</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;CurLoop, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE,</span></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp;ValShiftedIsZero,</span></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><span class="doxyHighlight">                                      <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> &amp;IntrinID, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;&amp;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>,</span></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;Start, <a href="/docs/api/classes/llvm/value">Value</a> &#42;&amp;Val,</span></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;&amp;ExtraOffsetExpr,</span></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;InvertedCond) &#123;</span></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a></span></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot; Performing shift-until-zero idiom detection.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Give up if the loop has multiple blocks or multiple backedges.</span></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a261ee3c4745564c7be9283984c9af06b">getNumBlocks</a>() != 1 || CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a389bb3581ba3c8094b89642efaf8e514">getNumBackEdges</a>() != 1) &#123;</span></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Bad block/backedge count.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ValShifted, &#42;NBits, &#42;IVNext;</span></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExtraOffset;</span></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopHeaderBB = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>();</span></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopPreheaderBB = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</span></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LoopPreheaderBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There is always a loop preheader.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">PatternMatch</a>;</span></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 1: Check if the loop backedge, condition is in desirable form.</span></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/cmppredicate">CmpPredicate</a> Pred;</span></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueBB, &#42;FalseBB;</span></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(LoopHeaderBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(),</span></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/patternmatch/#a811d001fa503a556ac2a48d64366500f">m&#95;Br</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(ValShiftedIsZero), <a href="/docs/api/namespaces/llvm/patternmatch/#ad856c036ca10c903c93082a4e784d4a6">m&#95;BasicBlock</a>(TrueBB),</span></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><span class="doxyHighlight">                  <a href="/docs/api/namespaces/llvm/patternmatch/#ad856c036ca10c903c93082a4e784d4a6">m&#95;BasicBlock</a>(FalseBB))) ||</span></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ValShiftedIsZero,</span></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/patternmatch/#ab86c85b47e09489dcda68fd91d082d77">m&#95;ICmp</a>(Pred, <a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(ValShifted), <a href="/docs/api/namespaces/llvm/patternmatch/#ae77be336e228cf9aa00709a8606dfb98">m&#95;Zero</a>())) ||</span></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><span class="doxyHighlight">      !<a href="/docs/api/classes/llvm/icmpinst/#abe8988eef2e6fc2baba032cb22afedd7">ICmpInst::isEquality</a>(Pred)) &#123;</span></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Bad backedge structure.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 2: Check if the comparison&#39;s operand is in desirable form.</span></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Val could be a one-input PHI node, which we should look past.</span></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ValShifted, <a href="/docs/api/namespaces/llvm/patternmatch/#aba80fdc6570c5a40cecd27fd7a06c858">m&#95;Shift</a>(<a href="#aba9b4dc5dd854ec2a8c8d92c0df7b4cd">m&#95;LoopInvariant</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Val), CurLoop),</span></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><span class="doxyHighlight">                                 <a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(NBits)))) &#123;</span></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Bad comparisons value computation.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><span class="doxyHighlight">  IntrinID = ValShifted-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Shl ? Intrinsic::cttz</span></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><span class="doxyHighlight">                                                         : Intrinsic::ctlz;</span></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 3: Check if the shift amount is in desirable form.</span></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(NBits, <a href="/docs/api/namespaces/llvm/patternmatch/#a9167d23c7fc4727aef51733d009e3f45">m&#95;c&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>),</span></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><span class="doxyHighlight">                           <a href="#aba9b4dc5dd854ec2a8c8d92c0df7b4cd">m&#95;LoopInvariant</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(ExtraOffset), CurLoop))) &amp;&amp;</span></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><span class="doxyHighlight">      (NBits-&gt;<a href="/docs/api/classes/llvm/instruction/#a350f4fdc01c770b5cf6a8be2624ae3e5">hasNoSignedWrap</a>() || NBits-&gt;<a href="/docs/api/classes/llvm/instruction/#a100c666f9253331dd1d166a863248326">hasNoUnsignedWrap</a>()))</span></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><span class="doxyHighlight">    ExtraOffsetExpr = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a083bb1deb1d2ba244a99ceae9e734bc1">getNegativeSCEV</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(ExtraOffset));</span></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(NBits,</span></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><span class="doxyHighlight">                 <a href="/docs/api/namespaces/llvm/patternmatch/#af5c293ba602295963ee06dd6f22e6335">m&#95;Sub</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>),</span></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><span class="doxyHighlight">                       <a href="#aba9b4dc5dd854ec2a8c8d92c0df7b4cd">m&#95;LoopInvariant</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(ExtraOffset), CurLoop))) &amp;&amp;</span></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><span class="doxyHighlight">           NBits-&gt;<a href="/docs/api/classes/llvm/instruction/#a350f4fdc01c770b5cf6a8be2624ae3e5">hasNoSignedWrap</a>())</span></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><span class="doxyHighlight">    ExtraOffsetExpr = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(ExtraOffset);</span></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = NBits;</span></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><span class="doxyHighlight">    ExtraOffsetExpr = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2579491850c605c8b7cf3439a907fbed">getZero</a>(NBits-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 4: Check if the recurrence is in desirable form.</span></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IVPN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>);</span></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IVPN || IVPN-&gt;getParent() != LoopHeaderBB) &#123;</span></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Not an expected PHI node.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><span class="doxyHighlight">  Start = IVPN-&gt;getIncomingValueForBlock(LoopPreheaderBB);</span></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><span class="doxyHighlight">  IVNext = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(IVPN-&gt;getIncomingValueForBlock(LoopHeaderBB));</span></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IVNext || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(IVNext, <a href="/docs/api/namespaces/llvm/patternmatch/#a062ccd76a126632721e9aa09775d6c0e">m&#95;Add</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(IVPN), <a href="/docs/api/namespaces/llvm/patternmatch/#a3b3d2d8c64a7881acb82bc7467569aa9">m&#95;One</a>()))) &#123;</span></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Bad recurrence.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 4: Check if the backedge&#39;s destinations are in desirable form.</span></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/icmpinst/#abe8988eef2e6fc2baba032cb22afedd7">ICmpInst::isEquality</a>(Pred) &amp;&amp;</span></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Should only get equality predicates here.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cmp-br is commutative, so canonicalize to a single variant.</span></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><span class="doxyHighlight">  InvertedCond = Pred != <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::Predicate::ICMP&#95;EQ</a>;</span></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InvertedCond) &#123;</span></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><span class="doxyHighlight">    Pred = <a href="/docs/api/classes/llvm/cmpinst/#aa2a54b545d237ecfe450fd1292f7675e">ICmpInst::getInversePredicate</a>(Pred);</span></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(TrueBB, FalseBB);</span></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We expect to exit loop when comparison yields true,</span></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so when it yields false we should branch back to loop header.</span></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FalseBB != LoopHeaderBB) &#123;</span></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Bad backedge flow.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The new, countable, loop will certainly only run a known number of</span></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iterations, It won&#39;t be infinite. But the old loop might be infinite</span></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// under certain conditions. For logical shifts, the value will become zero</span></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// after at most bitwidth(%Val) loop iterations. However, for arithmetic</span></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// right-shift, iff the sign bit was set, the value will never become zero,</span></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and the loop may never finish.</span></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ValShifted-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::AShr &amp;&amp;</span></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a6de4882dde0c939a449377f8f8abb8a8">isMustProgress</a>(CurLoop) &amp;&amp; !SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a06719fdab228f099aeac0c8ee40a7e34">isKnownNonNegative</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Val))) &#123;</span></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; Can not prove the loop is finite.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Okay, idiom checks out.</span></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><span class="doxyHighlightComment">/// Look for the following loop:</span></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><span class="doxyHighlightComment">///   entry:</span></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><span class="doxyHighlightComment">///     %start = &lt;...&gt;</span></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><span class="doxyHighlightComment">///     %extraoffset = &lt;...&gt;</span></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><span class="doxyHighlightComment">///     br label %for.cond</span></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><span class="doxyHighlightComment">///   loop:</span></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><span class="doxyHighlightComment">///     %iv = phi i8 &#91; %start, %entry &#93;, &#91; %iv.next, %for.cond &#93;</span></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><span class="doxyHighlightComment">///     %nbits = add nsw i8 %iv, %extraoffset</span></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><span class="doxyHighlightComment">///     %val.shifted = &#123;&#123;l,a&#125;shr,shl&#125; i8 %val, %nbits</span></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><span class="doxyHighlightComment">///     %val.shifted.iszero = icmp eq i8 %val.shifted, 0</span></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><span class="doxyHighlightComment">///     %iv.next = add i8 %iv, 1</span></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><span class="doxyHighlightComment">///     br i1 %val.shifted.iszero, label %end, label %loop</span></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><span class="doxyHighlightComment">///   end:</span></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><span class="doxyHighlightComment">///     %iv.res = phi i8 &#91; %iv, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><span class="doxyHighlightComment">///     %nbits.res = phi i8 &#91; %nbits, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><span class="doxyHighlightComment">///     %val.shifted.res = phi i8 &#91; %val.shifted, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><span class="doxyHighlightComment">///     %val.shifted.iszero.res = phi i1 &#91; %val.shifted.iszero, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><span class="doxyHighlightComment">///     %iv.next.res = phi i8 &#91; %iv.next, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><span class="doxyHighlightComment">/// And transform it into:</span></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><span class="doxyHighlightComment">/// \\code</span></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><span class="doxyHighlightComment">///   entry:</span></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><span class="doxyHighlightComment">///     %start = &lt;...&gt;</span></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><span class="doxyHighlightComment">///     %extraoffset = &lt;...&gt;</span></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><span class="doxyHighlightComment">///     %val.numleadingzeros = call i8 @llvm.ct&#123;l,t&#125;z.i8(i8 %val, i1 0)</span></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><span class="doxyHighlightComment">///     %val.numactivebits = sub i8 8, %val.numleadingzeros</span></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><span class="doxyHighlightComment">///     %extraoffset.neg = sub i8 0, %extraoffset</span></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><span class="doxyHighlightComment">///     %tmp = add i8 %val.numactivebits, %extraoffset.neg</span></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><span class="doxyHighlightComment">///     %iv.final = call i8 @llvm.smax.i8(i8 %tmp, i8 %start)</span></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><span class="doxyHighlightComment">///     %loop.tripcount = sub i8 %iv.final, %start</span></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><span class="doxyHighlightComment">///     br label %loop</span></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><span class="doxyHighlightComment">///   loop:</span></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><span class="doxyHighlightComment">///     %loop.iv = phi i8 &#91; 0, %entry &#93;, &#91; %loop.iv.next, %loop &#93;</span></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><span class="doxyHighlightComment">///     %loop.iv.next = add i8 %loop.iv, 1</span></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><span class="doxyHighlightComment">///     %loop.ivcheck = icmp eq i8 %loop.iv.next, %loop.tripcount</span></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><span class="doxyHighlightComment">///     %iv = add i8 %loop.iv, %start</span></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><span class="doxyHighlightComment">///     br i1 %loop.ivcheck, label %end, label %loop</span></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><span class="doxyHighlightComment">///   end:</span></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><span class="doxyHighlightComment">///     %iv.res = phi i8 &#91; %iv.final, %loop &#93; &lt;...&gt;</span></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><span class="doxyHighlightComment">///     &lt;...&gt;</span></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><span class="doxyHighlightComment">/// \\endcode</span></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopIdiomRecognize::recognizeShiftUntilZero() &#123;</span></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ValShiftedIsZero;</span></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IntrID;</span></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>;</span></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/memprof/#abee3ddc7c6eb611a3b96fb69489c81caaa6122a65eaa676f700ae68d393054a37">Start</a>, &#42;Val;</span></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExtraOffsetExpr;</span></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InvertedCond;</span></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a7ff0d8853961745bbe8afef66fab99dc">detectShiftUntilZeroIdiom</a>(CurLoop, SE, ValShiftedIsZero, IntrID, <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>,</span></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><span class="doxyHighlight">                                 Start, Val, ExtraOffsetExpr, InvertedCond)) &#123;</span></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a></span></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot; shift-until-zero idiom detection failed.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; shift-until-zero idiom detected!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ok, it is the idiom we were looking for, we &#42;could&#42; transform this loop,</span></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// but is it profitable to transform?</span></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopHeaderBB = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>();</span></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopPreheaderBB = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>();</span></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LoopPreheaderBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There is always a loop preheader.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SuccessorBB = CurLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#ab48af53a5000ecede46c76dabb4578d2">getExitBlock</a>();</span></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SuccessorBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;There is only a single successor.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(LoopPreheaderBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a63fc74646456a3bed261512f21efe29c">SetCurrentDebugLocation</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = Val-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Bitwidth = Ty-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bb">TargetTransformInfo::TargetCostKind</a> <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a> =</span></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TargetTransformInfo::TCK&#95;SizeAndLatency</a>;</span></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The rewrite is considered to be unprofitable iff and only iff the</span></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// intrinsic we&#39;ll use are not cheap. Note that we are okay with &#42;just&#42;</span></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// making the loop countable, even if nothing else changes.</span></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/intrinsiccostattributes">IntrinsicCostAttributes</a> <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a47142a8413e4b403d01f9365ac8d7ff7">Attrs</a>(</span></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><span class="doxyHighlight">      IntrID, Ty, &#123;<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(Ty), </span><span class="doxyHighlightComment">/&#42;is&#95;zero&#95;poison=&#42;/</span><span class="doxyHighlight">Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aaf3d3500cf7eb631e9095e87565410ed">getFalse</a>()&#125;);</span></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;getIntrinsicInstrCost(Attrs, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>);</span></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> &gt; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>) &#123;</span></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a></span></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot; Intrinsic is too costly, not beneficial\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ok, transform appears worthwhile.</span></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><span class="doxyHighlight">  MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OffsetIsZero = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExtraOffsetExprC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(ExtraOffsetExpr))</span></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><span class="doxyHighlight">    OffsetIsZero = ExtraOffsetExprC-&gt;isZero();</span></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 1: Compute the loop&#39;s final IV value / trip count.</span></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;ValNumLeadingZeros = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a80eec4efbded89b11092babf42a65b82">CreateIntrinsic</a>(</span></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><span class="doxyHighlight">      IntrID, Ty, &#123;Val, </span><span class="doxyHighlightComment">/&#42;is&#95;zero&#95;poison=&#42;/</span><span class="doxyHighlight">Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aaf3d3500cf7eb631e9095e87565410ed">getFalse</a>()&#125;,</span></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;FMFSource=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, Val-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.numleadingzeros&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ValNumActiveBits = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(</span></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><span class="doxyHighlight">      ConstantInt::get(Ty, Ty-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()), ValNumLeadingZeros,</span></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><span class="doxyHighlight">      Val-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.numactivebits&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;HasNSW=&#42;/</span><span class="doxyHighlight">Bitwidth != 2);</span></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> Expander(&#42;SE, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightStringLiteral">&quot;loop-idiom&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><span class="doxyHighlight">  Expander.<a href="/docs/api/classes/llvm/scevexpander/#afb583e40ce2835c2afa2e05e84fd5b87">setInsertPoint</a>(&amp;&#42;Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a4e5c1b91bf5e2860398e3fa35c96b5af">GetInsertPoint</a>());</span></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ExtraOffset = Expander.<a href="/docs/api/classes/llvm/scevexpander/#ac711b5659270bd9e66b8f38ec481260c">expandCodeFor</a>(ExtraOffsetExpr);</span></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;ValNumActiveBitsOffset = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(</span></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><span class="doxyHighlight">      ValNumActiveBits, ExtraOffset, ValNumActiveBits-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.offset&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlight">OffsetIsZero, </span><span class="doxyHighlightComment">/&#42;HasNSW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;IVFinal = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a80eec4efbded89b11092babf42a65b82">CreateIntrinsic</a>(Intrinsic::smax, &#123;Ty&#125;,</span></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><span class="doxyHighlight">                                           &#123;ValNumActiveBitsOffset, <a href="/docs/api/namespaces/llvm/memprof/#abee3ddc7c6eb611a3b96fb69489c81caaa6122a65eaa676f700ae68d393054a37">Start</a>&#125;,</span></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><span class="doxyHighlight">                                           </span><span class="doxyHighlightComment">/&#42;FMFSource=&#42;/</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;iv.final&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LoopBackedgeTakenCount = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a92c83e803f2cf22906da0aaec44ff6d7">CreateSub</a>(</span></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><span class="doxyHighlight">      IVFinal, Start, CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a917a64b00c1745fd0c78c2b2320cd4ad">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.backedgetakencount&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlight">OffsetIsZero, </span><span class="doxyHighlightComment">/&#42;HasNSW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: or when the offset was &#96;add nuw&#96;</span></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We know loop&#39;s backedge-taken count, but what&#39;s loop&#39;s trip count?</span></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;LoopTripCount =</span></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(LoopBackedgeTakenCount, ConstantInt::get(Ty, 1),</span></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><span class="doxyHighlight">                        CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a917a64b00c1745fd0c78c2b2320cd4ad">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.tripcount&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42;HasNSW=&#42;/</span><span class="doxyHighlight">Bitwidth != 2);</span></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 2: Adjust the successor basic block to recieve the original</span></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//         induction variable&#39;s final value instead of the orig. IV itself.</span></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;replaceUsesOutsideBlock(IVFinal, LoopHeaderBB);</span></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 3: Rewrite the loop into a countable form, with canonical IV.</span></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The new canonical induction variable.</span></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(LoopHeaderBB, LoopHeaderBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CIV = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a876fb556ecea804faa2cd8ad1e498ec3">CreatePHI</a>(Ty, 2, CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a917a64b00c1745fd0c78c2b2320cd4ad">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.iv&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The induction itself.</span></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(LoopHeaderBB, LoopHeaderBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>());</span></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CIVNext =</span></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(CIV, ConstantInt::get(Ty, 1), CIV-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.next&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;HasNSW=&#42;/</span><span class="doxyHighlight">Bitwidth != 2);</span></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The loop trip count check.</span></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CIVCheck = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(CIVNext, LoopTripCount,</span></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"><span class="doxyHighlight">                                        CurLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a917a64b00c1745fd0c78c2b2320cd4ad">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.ivcheck&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewIVCheck = CIVCheck;</span></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InvertedCond) &#123;</span></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"><span class="doxyHighlight">    NewIVCheck = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a89f675aadae7232445c74ee4167ff591">CreateNot</a>(CIVCheck);</span></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><span class="doxyHighlight">    NewIVCheck-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(ValShiftedIsZero);</span></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The original IV, but rebased to be an offset to the CIV.</span></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IVDePHId = Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#aada1d6d8de104a5cd1cb9a02c676cc6c">CreateAdd</a>(CIV, Start, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;HasNUW=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057"><span class="doxyHighlight">                                     </span><span class="doxyHighlightComment">/&#42;HasNSW=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">); </span><span class="doxyHighlightComment">// FIXME: what about NUW?</span></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058"><span class="doxyHighlight">  IVDePHId-&gt;<a href="/docs/api/classes/llvm/value/#ae855357b6c5e6e7ed1869272708a3a84">takeName</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>);</span></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059"></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The loop terminator.</span></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#ace45cae6925c65e9d6916e09dd5b17cc">SetInsertPoint</a>(LoopHeaderBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a972c30f044db799668bdcace5544edeb">CreateCondBr</a>(CIVCheck, SuccessorBB, LoopHeaderBB);</span></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063"><span class="doxyHighlight">  LoopHeaderBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064"></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Populate the IV PHI.</span></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066"><span class="doxyHighlight">  CIV-&gt;addIncoming(ConstantInt::get(Ty, 0), LoopPreheaderBB);</span></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067"><span class="doxyHighlight">  CIV-&gt;addIncoming(CIVNext, LoopHeaderBB);</span></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068"></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 4: Forget the &quot;non-computable&quot; trip-count SCEV associated with the</span></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   loop. The loop would otherwise not be deleted even if it becomes empty.</span></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072"><span class="doxyHighlight">  SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a592bdd7731b14ff4ff5d646f6f399900">forgetLoop</a>(CurLoop);</span></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 5: Try to cleanup the loop&#39;s body somewhat.</span></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;replaceAllUsesWith(IVDePHId);</span></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><span class="doxyHighlight">  ValShiftedIsZero-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewIVCheck);</span></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><span class="doxyHighlight">  ValShiftedIsZero-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080"></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Other passes will take care of actually deleting the loop if possible.</span></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot; shift-until-zero idiom optimized!\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085"><span class="doxyHighlight">  ++NumShiftUntilZero;</span></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
