---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/target/lib/target/mips/mipsbranchexpansion-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `MipsBranchExpansion.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>

This pass do two things: <a href="#details">More...</a>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="MCTargetDesc/MipsABIInfo.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/mips/lib/target/mips/mctargetdesc/mipsabiinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="MCTargetDesc/MipsBaseInfo.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/mips/lib/target/mips/mctargetdesc/mipsbaseinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="MCTargetDesc/MipsMCNaCl.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/mips/lib/target/mips/mctargetdesc/mipsmcnacl-h"
  isLocal="true" />
<IncludesListItem
  filePath="MCTargetDesc/MipsMCTargetDesc.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/mips/lib/target/mips/mctargetdesc/mipsmctargetdesc-h"
  isLocal="true" />
<IncludesListItem
  filePath="Mips.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/mips/mips-h"
  isLocal="true" />
<IncludesListItem
  filePath="MipsInstrInfo.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/mips/mipsinstrinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="MipsMachineFunction.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/mips/mipsmachinefunction-h"
  isLocal="true" />
<IncludesListItem
  filePath="MipsSubtarget.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/mips/mipssubtarget-h"
  isLocal="true" />
<IncludesListItem
  filePath="MipsTargetMachine.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/mips/mipstargetmachine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/StringRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineBasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebasicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunctionPass.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunctionpass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineInstr.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstr-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineInstrBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstrbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineModuleInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinemoduleinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineOperand.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineoperand-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetSubtargetInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetsubtargetinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugLoc.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetMachine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-">anonymous&#123;MipsBranchExpansion.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo">MBBInfo</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion">MipsBranchExpansion</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#adfd69c79b4eb159ce76cbc8cf5b06073">emitGPDisp</a> (MachineFunction &amp;F, const MipsInstrInfo &#42;TII)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::pair&lt; Iter, bool &gt;</>}
  name={<><a href="#a4801e594c6226fb9020a07ca36641c5b">getNextMachineInstr</a> (Iter Position, MachineBasicBlock &#42;Parent)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="Iter"
  name={<><a href="#afa225aa7b0b7c2076978f4991a00c7b5">getNextMachineInstrInBB</a> (Iter Position)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="ReverseIter"
  name={<><a href="#aee3bb13ddbd5b3613acda398cdd4d8d7">getNonDebugInstr</a> (ReverseIter B, const ReverseIter &amp;E)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</>}
  name={<><a href="#aaec6e6ec16a011ef89299012d0dbe146">getTargetMBB</a> (const MachineInstr &amp;Br)</>}>
Iterate over list of Br&#39;s operands and search for a <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> operand. <a href="#aaec6e6ec16a011ef89299012d0dbe146">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a397c79cf83999d28cc8b0f9effff2506">INITIALIZE&#95;PASS</a> (MipsBranchExpansion, DEBUG&#95;TYPE, &quot;Expand out of range branch instructions and fix forbidden&quot; &quot; slot hazards&quot;, false, false) FunctionPass &#42;llvm</>}>
Returns a pass that clears pipeline hazards. <a href="#a397c79cf83999d28cc8b0f9effff2506">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ad18e02bd50f0ad9c03b3d113956ae4ad">STATISTIC</a> (NumInsertedNops, &quot;Number of nops inserted&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#add318dbc2e3c572117ba3aed1590588d">STATISTIC</a> (LongBranches, &quot;Number of long branches.&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a55de83450b64f38db6fc2572748d8288">ForceLongBranch</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a6d2b3c062869b333c00917f7768d4468">SkipLongBranch</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;mips-branch-expansion&quot;</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

This pass do two things:

<ul>
<li>it expands a branch or jump instruction into a long branch if its offset is too large to fit into its immediate field,</li>
<li>it inserts nops to prevent forbidden slot hazards.</li>
</ul>


The reason why this pass combines these two tasks is that one of these two tasks can break the result of the previous one.

Example of that is a situation where at first, no branch should be expanded, but after adding at least one nop somewhere in the code to prevent a forbidden slot hazard, offset of some branches may go out of range. In that case it is necessary to check again if there is some branch that needs expansion. On the other hand, expanding some branch may cause a control transfer instruction to appear in the forbidden slot, which is a hazard that should be fixed. This pass alternates between this two tasks untill no changes are made. Only then we can be sure that all branches are expanded properly, and no hazard situations exist.

Regarding branch expanding:

When branch instruction like beqzc or bnezc has offset that is too large to fit into its immediate field, it has to be expanded to another instruction or series of instructions.

FIXME: Fix pc-region jump instructions which cross 256<a href="/docs/api/classes/mb">MB</a> segment boundaries. TODO: Handle out of range bc, b (pseudo) instructions.

Regarding compact branch hazard prevention:

Hazards handled: forbidden slots for MIPSR6, FPU slots for MIPS3 and below, load delay slots for MIPS1.

A forbidden slot hazard occurs when a compact branch instruction is executed and the adjacent instruction in memory is a control transfer instruction such as a branch or jump, ERET, ERETNC, DERET, WAIT and PAUSE.

For example:

0x8004 bnec a1,v0,&lt;P+0x18&gt; 0x8008 beqc a1,a2,&lt;P+0x54&gt;

In such cases, the processor is required to signal a Reserved <a href="/docs/api/classes/llvm/instruction">Instruction</a> exception.

Here, if the instruction at 0x8004 is executed, the processor will raise an exception as there is a control transfer instruction at 0x8008.

There are two sources of forbidden slot hazards:

A) A previous pass has created a compact branch directly. B) Transforming a delay slot branch into compact branch. This case can be difficult to process as lookahead for hazards is insufficient, as backwards delay slot fillling can also produce hazards in previously processed instuctions.

In future this pass can be extended (or new pass can be created) to handle other pipeline hazards, such as various MIPS1 hazards, processor errata that require instruction reorganization, etc.

This pass has to run after the delay slot filler as that pass can introduce pipeline hazards such as compact branch hazard, hence the existing hazard recognizer is not suitable.

<SectionDefinition>

## Functions

### emitGPDisp() {#adfd69c79b4eb159ce76cbc8cf5b06073}

<MemberDefinition
  prototype={<>static void emitGPDisp (<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp; F, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/mipsinstrinfo">MipsInstrInfo</a> &#42; TII)</>}
  labels = {["static"]}>

Definition at line <a href="#l00734">734</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsbranchexpansion-cpp">MipsBranchExpansion.cpp</a>.
</MemberDefinition>

### getNextMachineInstr() {#a4801e594c6226fb9020a07ca36641c5b}

<MemberDefinition
  prototype={<>static std::pair&lt; Iter, bool &gt; getNextMachineInstr (Iter Position, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; Parent)</>}
  labels = {["static"]}>

Definition at line <a href="#l00209">209</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsbranchexpansion-cpp">MipsBranchExpansion.cpp</a>.
</MemberDefinition>

### getNextMachineInstrInBB() {#afa225aa7b0b7c2076978f4991a00c7b5}

<MemberDefinition
  prototype="static Iter getNextMachineInstrInBB (Iter Position)"
  labels = {["static"]}>

Definition at line <a href="#l00199">199</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsbranchexpansion-cpp">MipsBranchExpansion.cpp</a>.
</MemberDefinition>

### getNonDebugInstr() {#aee3bb13ddbd5b3613acda398cdd4d8d7}

<MemberDefinition
  prototype={<>static ReverseIter getNonDebugInstr (ReverseIter B, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> ReverseIter &amp; E)</>}
  labels = {["static"]}>

Definition at line <a href="#l00245">245</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsbranchexpansion-cpp">MipsBranchExpansion.cpp</a>.
</MemberDefinition>

### getTargetMBB() {#aaec6e6ec16a011ef89299012d0dbe146}

<MemberDefinition
  prototype={<>static MachineBasicBlock &#42; getTargetMBB (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; Br)</>}
  labels = {["static"]}>
Iterate over list of Br&#39;s operands and search for a <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> operand.

Definition at line <a href="#l00232">232</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsbranchexpansion-cpp">MipsBranchExpansion.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS() {#a397c79cf83999d28cc8b0f9effff2506}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS (MipsBranchExpansion, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, &quot;Expand out of range branch <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> and <a href="/docs/api/files/lib/lib/target/lib/target/arm/armtargetmachine-cpp/#a86b29362e5d8fbb0d516610e4f988b5e">fix</a> forbidden&quot; &quot; slot hazards&quot;, false, false)</>}>
Returns a pass that clears pipeline hazards.

Definition at line <a href="#l00187">187</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsbranchexpansion-cpp">MipsBranchExpansion.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ad18e02bd50f0ad9c03b3d113956ae4ad}

<MemberDefinition
  prototype={<>STATISTIC (NumInsertedNops, &quot;Number of nops inserted&quot;)</>}>

Definition at line <a href="#l00109">109</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsbranchexpansion-cpp">MipsBranchExpansion.cpp</a>.
</MemberDefinition>

### STATISTIC() {#add318dbc2e3c572117ba3aed1590588d}

<MemberDefinition
  prototype={<>STATISTIC (LongBranches, &quot;Number of long branches.&quot;)</>}>

Definition at line <a href="#l00110">110</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsbranchexpansion-cpp">MipsBranchExpansion.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### ForceLongBranch {#a55de83450b64f38db6fc2572748d8288}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ForceLongBranch(&quot;force-mips-long-branch&quot;, cl::init(false), cl::desc(&quot;MIPS: Expand all branches to long format.&quot;), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00117">117</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsbranchexpansion-cpp">MipsBranchExpansion.cpp</a>.
</MemberDefinition>

### SkipLongBranch {#a6d2b3c062869b333c00917f7768d4468}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; SkipLongBranch(&quot;skip-mips-long-branch&quot;, cl::init(false), cl::desc(&quot;MIPS: Skip branch expansion pass.&quot;), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00113">113</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsbranchexpansion-cpp">MipsBranchExpansion.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;mips-branch-expansion&quot;</>}>

Definition at line <a href="#l00107">107</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsbranchexpansion-cpp">MipsBranchExpansion.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===----------------------- MipsBranchExpansion.cpp ----------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">/// \\file</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">/// This pass do two things:</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">/// - it expands a branch or jump instruction into a long branch if its offset</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">///   is too large to fit into its immediate field,</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">/// - it inserts nops to prevent forbidden slot hazards.</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">/// The reason why this pass combines these two tasks is that one of these two</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">/// tasks can break the result of the previous one.</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">/// Example of that is a situation where at first, no branch should be expanded,</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">/// but after adding at least one nop somewhere in the code to prevent a</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">/// forbidden slot hazard, offset of some branches may go out of range. In that</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">/// case it is necessary to check again if there is some branch that needs</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightComment">/// expansion. On the other hand, expanding some branch may cause a control</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightComment">/// transfer instruction to appear in the forbidden slot, which is a hazard that</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightComment">/// should be fixed. This pass alternates between this two tasks untill no</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightComment">/// changes are made. Only then we can be sure that all branches are expanded</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightComment">/// properly, and no hazard situations exist.</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightComment">/// Regarding branch expanding:</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightComment">/// When branch instruction like beqzc or bnezc has offset that is too large</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightComment">/// to fit into its immediate field, it has to be expanded to another</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightComment">/// instruction or series of instructions.</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightComment">/// FIXME: Fix pc-region jump instructions which cross 256MB segment boundaries.</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightComment">/// TODO: Handle out of range bc, b (pseudo) instructions.</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightComment">/// Regarding compact branch hazard prevention:</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightComment">/// Hazards handled: forbidden slots for MIPSR6, FPU slots for MIPS3 and below,</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightComment">/// load delay slots for MIPS1.</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightComment">/// A forbidden slot hazard occurs when a compact branch instruction is executed</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightComment">/// and the adjacent instruction in memory is a control transfer instruction</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightComment">/// such as a branch or jump, ERET, ERETNC, DERET, WAIT and PAUSE.</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightComment">/// For example:</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightComment">/// 32772      bnec    a1,v0,&lt;P+0x18&gt;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightComment">/// 32776      beqc    a1,a2,&lt;P+0x54&gt;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightComment">/// In such cases, the processor is required to signal a Reserved Instruction</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightComment">/// exception.</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightComment">/// Here, if the instruction at 32772 is executed, the processor will raise an</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightComment">/// exception as there is a control transfer instruction at 0x8008.</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightComment">/// There are two sources of forbidden slot hazards:</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightComment">/// A) A previous pass has created a compact branch directly.</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightComment">/// B) Transforming a delay slot branch into compact branch. This case can be</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightComment">///    difficult to process as lookahead for hazards is insufficient, as</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightComment">///    backwards delay slot fillling can also produce hazards in previously</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightComment">///    processed instuctions.</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightComment">/// In future this pass can be extended (or new pass can be created) to handle</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightComment">/// other pipeline hazards, such as various MIPS1 hazards, processor errata that</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightComment">/// require instruction reorganization, etc.</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightComment">/// This pass has to run after the delay slot filler as that pass can introduce</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightComment">/// pipeline hazards such as compact branch hazard, hence the existing hazard</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightComment">/// recognizer is not suitable.</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/mips/lib/target/mips/mctargetdesc/mipsabiinfo-h">MCTargetDesc/MipsABIInfo.h</a>&quot;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/mips/lib/target/mips/mctargetdesc/mipsbaseinfo-h">MCTargetDesc/MipsBaseInfo.h</a>&quot;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/mips/lib/target/mips/mctargetdesc/mipsmcnacl-h">MCTargetDesc/MipsMCNaCl.h</a>&quot;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/mips/lib/target/mips/mctargetdesc/mipsmctargetdesc-h">MCTargetDesc/MipsMCTargetDesc.h</a>&quot;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips-h">Mips.h</a>&quot;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsinstrinfo-h">MipsInstrInfo.h</a>&quot;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mipsmachinefunction-h">MipsMachineFunction.h</a>&quot;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mipssubtarget-h">MipsSubtarget.h</a>&quot;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mipstargetmachine-h">MipsTargetMachine.h</a>&quot;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h">llvm/ADT/StringRef.h</a>&quot;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebasicblock-h">llvm/CodeGen/MachineBasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h">llvm/CodeGen/MachineFunction.h</a>&quot;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunctionpass-h">llvm/CodeGen/MachineFunctionPass.h</a>&quot;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstr-h">llvm/CodeGen/MachineInstr.h</a>&quot;</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstrbuilder-h">llvm/CodeGen/MachineInstrBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinemoduleinfo-h">llvm/CodeGen/MachineModuleInfo.h</a>&quot;</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineoperand-h">llvm/CodeGen/MachineOperand.h</a>&quot;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetsubtargetinfo-h">llvm/CodeGen/TargetSubtargetInfo.h</a>&quot;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h">llvm/IR/DebugLoc.h</a>&quot;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h">llvm/Target/TargetMachine.h</a>&quot;</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlightPreprocessor">#include &lt;algorithm&gt;</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlightPreprocessor">#include &lt;cstdint&gt;</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlightPreprocessor">#include &lt;iterator&gt;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;mips-branch-expansion&quot;</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109" lineLink="#ad18e02bd50f0ad9c03b3d113956ae4ad"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumInsertedNops, </span><span class="doxyHighlightStringLiteral">&quot;Number of nops inserted&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110" lineLink="#add318dbc2e3c572117ba3aed1590588d"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(LongBranches, </span><span class="doxyHighlightStringLiteral">&quot;Number of long branches.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113" lineLink="#a6d2b3c062869b333c00917f7768d4468"><span class="doxyHighlight">    <a href="#a6d2b3c062869b333c00917f7768d4468">SkipLongBranch</a>(</span><span class="doxyHighlightStringLiteral">&quot;skip-mips-long-branch&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">                   <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;MIPS: Skip branch expansion pass.&quot;</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117" lineLink="#a55de83450b64f38db6fc2572748d8288"><span class="doxyHighlight">    <a href="#a55de83450b64f38db6fc2572748d8288">ForceLongBranch</a>(</span><span class="doxyHighlightStringLiteral">&quot;force-mips-long-branch&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">                    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;MIPS: Expand all branches to long format.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">                    <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121" lineLink="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123" lineLink="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> = <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a>;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124" lineLink="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#a7a84c21d9340186b61fbadc67f98d348"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#a7a84c21d9340186b61fbadc67f98d348">ReverseIter</a> = <a href="/docs/api/classes/llvm/machinebasicblock/#abada92f8cd2854d2b747f14c4a7be0ed">MachineBasicBlock::reverse&#95;iterator</a>;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126" lineLink="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo/#ac425dcfe9111323f8992c4e03d33bea0">MBBInfo</a> &#123;</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127" lineLink="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo/#af8e581f666428a2a2e9f887e77fcf21f"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo/#af8e581f666428a2a2e9f887e77fcf21f">Size</a> = 0;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128" lineLink="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo/#ae8b274f53923f6aeb23fb2c4f68599ea"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo/#ae8b274f53923f6aeb23fb2c4f68599ea">HasLongBranch</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129" lineLink="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo/#ab74c78995204fdc9a76a5a84a6412fa6"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo/#ab74c78995204fdc9a76a5a84a6412fa6">Br</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130" lineLink="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo/#ae4c334efcbccd991d73836c0a99046c3"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo/#ae4c334efcbccd991d73836c0a99046c3">Offset</a> = 0;</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131" lineLink="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo/#ac425dcfe9111323f8992c4e03d33bea0"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo/#ac425dcfe9111323f8992c4e03d33bea0">MBBInfo</a>() = </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134" lineLink="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a8592b6883e51c73ec1902172497656c3">MipsBranchExpansion</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a> &#123;</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136" lineLink="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a4cbebd1e94c3e942377d5316734b96b7"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a4cbebd1e94c3e942377d5316734b96b7">ID</a>;</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138" lineLink="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a8592b6883e51c73ec1902172497656c3"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a8592b6883e51c73ec1902172497656c3">MipsBranchExpansion</a>() : <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a>(<a href="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a4cbebd1e94c3e942377d5316734b96b7">ID</a>), ABI(<a href="/docs/api/classes/llvm/mipsabiinfo">MipsABIInfo</a>::<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvptxisellowering-cpp/#ae1a90b5d85643644483b2ca70da4d13fa4e81c184ac3ad48a389cd4454c4a05bb">Unknown</a>()) &#123;</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a289b379019a6300b4e98437202eb188b">initializeMipsBranchExpansionPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142" lineLink="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a6000c1574b35b3d221096e6c25de5ccf"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a6000c1574b35b3d221096e6c25de5ccf">getPassName</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;Mips Branch Expansion Pass&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> runOnMachineFunction(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148" lineLink="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a48c8239225d0a839cb10c1812b69d64b"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunctionproperties">MachineFunctionProperties</a> <a href="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a48c8239225d0a839cb10c1812b69d64b">getRequiredProperties</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunctionproperties">MachineFunctionProperties</a>().<a href="/docs/api/classes/llvm/machinefunctionproperties/#aa7780563d7ca260d0ae67d957b56427f">set</a>(</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/machinefunctionproperties/#ad85237c6c667e4713efe8921e9c32ac1a72f7d830dd5ddb30f06d8e9639558ac3">MachineFunctionProperties::Property::NoVRegs</a>);</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcreducecrlogicals-cpp/#a6268a1294b61555b575fbd131789aaf3">splitMBB</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> initMBBInfo();</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">  int64&#95;t computeOffset(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;Br);</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">  uint64&#95;t computeOffsetFromTheBeginning(</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> replaceBranch(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> Br, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MBBOpnd);</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> buildProperJumpMI(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> Pos, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> expandToLongBranch(<a href="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo">MBBInfo</a> &amp;Info);</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> Pred, </span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> Safe&gt;</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> handleSlot(Pred Predicate, Safe SafeInSlot);</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> handleForbiddenSlot();</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> handleFPUDelaySlot();</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> handleLoadDelaySlot();</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> handlePossibleLongBranch();</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> handleMFLO();</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> Pred, </span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> Safe&gt;</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> handleMFLOSlot(Pred Predicate, Safe SafeInSlot);</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mipssubtarget">MipsSubtarget</a> &#42;STI;</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mipsinstrinfo">MipsInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>;</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &#42;MFp;</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MBBInfo, 16&gt;</a> MBBInfos;</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsPIC;</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mipsabiinfo">MipsABIInfo</a> ABI;</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ForceLongBranchFirstPass = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end of anonymous namespace</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a4cbebd1e94c3e942377d5316734b96b7">MipsBranchExpansion::ID</a> = 0;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187" lineLink="#a397c79cf83999d28cc8b0f9effff2506"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#af807c9595d50b45c0008924c4679c85c">INITIALIZE&#95;PASS</a>(<a href="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a8592b6883e51c73ec1902172497656c3">MipsBranchExpansion</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot;Expand out of range branch instructions and fix forbidden&quot;</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot; slot hazards&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">                </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlightComment">/// Returns a pass that clears pipeline hazards.</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/functionpass">FunctionPass</a> &#42;<a href="/docs/api/namespaces/llvm">llvm</a>::<a href="/docs/api/namespaces/llvm/#a952831512f417d6cd6cbe78fba451186">createMipsBranchExpansion</a>() &#123;</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a8592b6883e51c73ec1902172497656c3">MipsBranchExpansion</a>();</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlightComment">// Find the next real instruction from the current position in current basic</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlightComment">// block.</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199" lineLink="#afa225aa7b0b7c2076978f4991a00c7b5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> <a href="#afa225aa7b0b7c2076978f4991a00c7b5">getNextMachineInstrInBB</a>(<a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> Position) &#123;</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Position, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Position-&gt;getParent()-&gt;end();</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = std::find&#95;if&#95;not(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>,</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">                       &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a96d5dc120196819fbfbc257cba09b2aa">Insn</a>-&gt;isTransient(); &#125;);</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlightComment">// Find the next real instruction from the current position, looking through</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlightComment">// basic block boundaries.</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209" lineLink="#a4801e594c6226fb9020a07ca36641c5b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::pair&lt;Iter, bool&gt; <a href="#a4801e594c6226fb9020a07ca36641c5b">getNextMachineInstr</a>(<a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> Position,</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Parent) &#123;</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Position == Parent-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>()) &#123;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ = Parent-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>();</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; Parent-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(Succ)) &#123;</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">        Position = Succ-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">        Parent = Succ;</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::make&#95;pair(Position, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (Parent-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a095ce2d870dadf620a4c887ecc0efef8">empty</a>());</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> Instr = <a href="#afa225aa7b0b7c2076978f4991a00c7b5">getNextMachineInstrInBB</a>(Position);</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Instr == Parent-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>()) &#123;</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a4801e594c6226fb9020a07ca36641c5b">getNextMachineInstr</a>(Instr, Parent);</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::make&#95;pair(Instr, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlightComment">/// Iterate over list of Br&#39;s operands and search for a MachineBasicBlock</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlightComment">/// operand.</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232" lineLink="#aaec6e6ec16a011ef89299012d0dbe146"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="#aaec6e6ec16a011ef89299012d0dbe146">getTargetMBB</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;Br) &#123;</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Br.<a href="/docs/api/classes/llvm/machineinstr/#a75a5f7e3b3d4ec79610b4e556d2f35ce">getDesc</a>().<a href="/docs/api/classes/llvm/mcinstrdesc/#a0ca904e64ee29c8812ed34e632d3c947">getNumOperands</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO = Br.<a href="/docs/api/classes/llvm/machineinstr/#ad67c9230577a0b640c52852c75c93939">getOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.<a href="/docs/api/classes/llvm/machineoperand/#afe1784e242ce66da6029b3a681896bd2">isMBB</a>())</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MO.<a href="/docs/api/classes/llvm/machineoperand/#a57e64b633278df75c699e6b98ce15031">getMBB</a>();</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;This instruction does not have an MBB operand.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlightComment">// Traverse the list of instructions backwards until a non-debug instruction is</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlightComment">// found or it reaches E.</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245" lineLink="#aee3bb13ddbd5b3613acda398cdd4d8d7"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#a7a84c21d9340186b61fbadc67f98d348">ReverseIter</a> <a href="#aee3bb13ddbd5b3613acda398cdd4d8d7">getNonDebugInstr</a>(<a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#a7a84c21d9340186b61fbadc67f98d348">ReverseIter</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#a7a84c21d9340186b61fbadc67f98d348">ReverseIter</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>) &#123;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;isDebugInstr())</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>;</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlightComment">// Split MBB if it has two direct jumps/branches.</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> MipsBranchExpansion::splitMBB(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#a7a84c21d9340186b61fbadc67f98d348">ReverseIter</a> End = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;rend();</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#a7a84c21d9340186b61fbadc67f98d348">ReverseIter</a> LastBr = <a href="#aee3bb13ddbd5b3613acda398cdd4d8d7">getNonDebugInstr</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;rbegin(), End);</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return if MBB has no branch instructions.</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((LastBr == End) ||</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">      (!LastBr-&gt;isConditionalBranch() &amp;&amp; !LastBr-&gt;isUnconditionalBranch()))</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#a7a84c21d9340186b61fbadc67f98d348">ReverseIter</a> FirstBr = <a href="#aee3bb13ddbd5b3613acda398cdd4d8d7">getNonDebugInstr</a>(std::next(LastBr), End);</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// MBB has only one branch instruction if FirstBr is not a branch</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction.</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((FirstBr == End) ||</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">      (!FirstBr-&gt;isConditionalBranch() &amp;&amp; !FirstBr-&gt;isUnconditionalBranch()))</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!FirstBr-&gt;isIndirectBranch() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected indirect branch found.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a new MBB. Move instructions in MBB to the newly created MBB.</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;NewMBB =</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">      MFp-&gt;CreateMachineBasicBlock(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getBasicBlock());</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert NewMBB and fix control flow.</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Tgt = <a href="#aaec6e6ec16a011ef89299012d0dbe146">getTargetMBB</a>(&#42;FirstBr);</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">  NewMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a31e57b158a17c459f0dc34b0e602ecc6">transferSuccessors</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Tgt != <a href="#aaec6e6ec16a011ef89299012d0dbe146">getTargetMBB</a>(&#42;LastBr))</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">    NewMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#aa7114bb360b922025e7a4fec442676db">removeSuccessor</a>(Tgt, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;addSuccessor(NewMBB);</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;addSuccessor(Tgt);</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">  MFp-&gt;insert(std::next(<a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)), NewMBB);</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">  NewMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adf0023bdc4f05a7849c35b1c859580d8">splice</a>(NewMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, LastBr.getReverse(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;end());</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlightComment">// Fill MBBInfos.</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> MipsBranchExpansion::initMBBInfo() &#123;</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Split the MBBs if they have two branches. Each basic block should have at</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// most one branch after this loop is executed.</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;MFp)</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/powerpc/ppcreducecrlogicals-cpp/#a6268a1294b61555b575fbd131789aaf3">splitMBB</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">  MFp-&gt;RenumberBlocks();</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">  MBBInfos.clear();</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">  MBBInfos.resize(MFp-&gt;size());</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = MBBInfos.size(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = MFp-&gt;getBlockNumbered(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute size of MBB.</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;instrs())</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">      MBBInfos&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;.Size += <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getInstSizeInBytes(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlightComment">// Compute offset of branch in number of bytes.</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">int64&#95;t MipsBranchExpansion::computeOffset(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;Br) &#123;</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">  int64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = 0;</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> ThisMBB = Br-&gt;<a href="/docs/api/classes/llvm/machineinstr/#a1e855100f407ca4be098d0050be403b0">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>();</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> TargetMBB = <a href="#aaec6e6ec16a011ef89299012d0dbe146">getTargetMBB</a>(&#42;Br)-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>();</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute offset of a forward branch.</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ThisMBB &lt; TargetMBB) &#123;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = ThisMBB + 1; <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> &lt; TargetMBB; ++<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>)</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += MBBInfos&#91;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>&#93;.<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> + 4;</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute offset of a backward branch.</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = ThisMBB; <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> &gt;= TargetMBB; --<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>)</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += MBBInfos&#91;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>&#93;.<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> -<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> + 4;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlightComment">// Returns the distance in bytes up until MBB</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">uint64&#95;t MipsBranchExpansion::computeOffsetFromTheBeginning(</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  uint64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = 0;</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = 0; <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> &lt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>; ++<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>)</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> += MBBInfos&#91;<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>&#93;.<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3a6f6cb72d544962fa333e2e34ce64f719">Size</a>;</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlightComment">// Replace Br with a branch which has the opposite condition code and a</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlightComment">// MachineBasicBlock operand MBBOpnd.</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> MipsBranchExpansion::replaceBranch(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> Br,</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MBBOpnd) &#123;</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NewOpc = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getOppositeBranchOpc(Br-&gt;getOpcode());</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mcinstrdesc">MCInstrDesc</a> &amp;NewDesc = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(NewOpc);</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineinstrbuilder">MachineInstrBuilder</a> MIB = <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, Br, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, NewDesc);</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Br-&gt;getDesc().getNumOperands(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO = Br-&gt;getOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (MO.<a href="/docs/api/classes/llvm/machineoperand/#ab313591ae4ea1e3a4ab59121a7dc2a2b">getType</a>()) &#123;</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand/#af269b990800f72c7cf535c407e8e639ba99b874c6560305fd292d20f6a06da166">MachineOperand::MO&#95;Register</a>:</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">      MIB.<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(MO.<a href="/docs/api/classes/llvm/machineoperand/#ac0035d7c1c860501c877c20e6e93297b">getReg</a>());</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand/#af269b990800f72c7cf535c407e8e639ba066f84460d9f7b61d54b187555756ef6">MachineOperand::MO&#95;Immediate</a>:</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Octeon BBIT family of branch has an immediate operand</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (e.g. BBIT0 $v0, 3, %bb.1).</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isBranchWithImm(Br-&gt;getOpcode()))</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unexpected immediate in branch instruction&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">      MIB.<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(MO.<a href="/docs/api/classes/llvm/machineoperand/#a38b28a85f818b49d8806c150b8a5b4f7">getImm</a>());</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand/#af269b990800f72c7cf535c407e8e639ba95566cb4525dab82db8cbbed3d634c23">MachineOperand::MO&#95;MachineBasicBlock</a>:</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">      MIB.<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(MBBOpnd);</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unexpected operand type in branch instruction&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Br-&gt;hasDelaySlot()) &#123;</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Bundle the instruction in the delay slot to the newly created branch</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and erase the original branch.</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Br-&gt;isBundledWithSucc());</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ab6395548cae73865213e279ae461db54">MachineBasicBlock::instr&#95;iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = Br.getInstrIterator();</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mibundlebuilder">MIBundleBuilder</a>(&amp;&#42;MIB).<a href="/docs/api/classes/llvm/mibundlebuilder/#a6c15d55cada45b3ba4ec4ba5560c39c4">append</a>((++<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)-&gt;removeFromBundle());</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">  Br-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MipsBranchExpansion::buildProperJumpMI(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> Pos,</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasR6 = ABI.IsN64() ? STI-&gt;hasMips64r6() : STI-&gt;hasMips32r6();</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AddImm = HasR6 &amp;&amp; !STI-&gt;useIndirectJumpsHazard();</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> JR = ABI.IsN64() ? Mips::JR64 : Mips::JR;</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> JIC = ABI.IsN64() ? Mips::JIC64 : Mips::JIC;</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> JR&#95;HB = ABI.IsN64() ? Mips::JR&#95;HB64 : Mips::JR&#95;HB;</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> JR&#95;HB&#95;R6 = ABI.IsN64() ? Mips::JR&#95;HB64&#95;R6 : Mips::JR&#95;HB&#95;R6;</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> JumpOp;</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STI-&gt;useIndirectJumpsHazard())</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">    JumpOp = HasR6 ? JR&#95;HB&#95;R6 : JR&#95;HB;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">    JumpOp = HasR6 ? JIC : JR;</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (JumpOp == Mips::JIC &amp;&amp; STI-&gt;inMicroMipsMode())</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">    JumpOp = Mips::JIC&#95;MMR6;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ATReg = ABI.IsN64() ? Mips::AT&#95;64 : Mips::AT;</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineinstrbuilder">MachineInstrBuilder</a> <a href="/docs/api/namespaces/llvm/rdf/#a173a2217e059f21fb25908fa2bf796d6">Instr</a> =</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(JumpOp)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(ATReg);</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddImm)</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/rdf/#a173a2217e059f21fb25908fa2bf796d6">Instr</a>.addImm(0);</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !AddImm;</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlightComment">// Expand branch instructions to long branches.</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlightComment">// TODO: This function has to be fixed for beqz16 and bnez16, because it</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlightComment">// currently assumes that all branches have 16-bit offsets, and will produce</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlightComment">// wrong code if branches whose allowed offsets are &#91;-128, -126, ..., 126&#93;</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlightComment">// are present.</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> MipsBranchExpansion::expandToLongBranch(<a href="/docs/api/structs/anonymous-namespace-mipsbranchexpansion-cpp-/mbbinfo/#ac425dcfe9111323f8992c4e03d33bea0">MBBInfo</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> Pos;</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.Br-&gt;getParent(), &#42;TgtMBB = <a href="#aaec6e6ec16a011ef89299012d0dbe146">getTargetMBB</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.Br);</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.Br-&gt;getDebugLoc();</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getBasicBlock();</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> FallThroughMBB = ++<a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LongBrMBB = MFp-&gt;CreateMachineBasicBlock(BB);</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">  MFp-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3435a2381e60e842e915f85c931b7dde">insert</a>(FallThroughMBB, LongBrMBB);</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;replaceSuccessor(TgtMBB, LongBrMBB);</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsPIC) &#123;</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BalTgtMBB = MFp-&gt;CreateMachineBasicBlock(BB);</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">    MFp-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3435a2381e60e842e915f85c931b7dde">insert</a>(FallThroughMBB, BalTgtMBB);</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">    LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(BalTgtMBB);</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">    BalTgtMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(TgtMBB);</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We must select between the MIPS32r6/MIPS64r6 BALC (which is a normal</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instruction) and the pre-MIPS32r6/MIPS64r6 definition (which is an</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pseudo-instruction wrapping BGEZAL).</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BalOp =</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">        STI-&gt;hasMips32r6()</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">            ? STI-&gt;inMicroMipsMode() ? Mips::BALC&#95;MMR6 : Mips::BALC</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">            : STI-&gt;inMicroMipsMode() ? Mips::BAL&#95;BR&#95;MM : Mips::BAL&#95;BR;</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ABI.IsN64()) &#123;</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Pre R6:</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $longbr:</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  addiu $sp, $sp, -8</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  sw $ra, 0($sp)</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  lui $at, %hi($tgt - $baltgt)</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  bal $baltgt</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  addiu $at, $at, %lo($tgt - $baltgt)</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $baltgt:</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  addu $at, $ra, $at</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  lw $ra, 0($sp)</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  jr $at</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  addiu $sp, $sp, 8</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $fallthrough:</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// R6:</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $longbr:</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  addiu $sp, $sp, -8</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  sw $ra, 0($sp)</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  lui $at, %hi($tgt - $baltgt)</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  addiu $at, $at, %lo($tgt - $baltgt)</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  balc $baltgt</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $baltgt:</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  addu $at, $ra, $at</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  lw $ra, 0($sp)</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  addiu $sp, $sp, 8</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  jic $at, 0</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $fallthrough:</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">      Pos = LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::ADDiu), Mips::SP)</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::SP)</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(-8);</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::SW))</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::RA)</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::SP)</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0);</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// LUi and ADDiu instructions create 32-bit offset of the target basic</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// block from the target of BAL(C) instruction.  We cannot use immediate</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// value for this offset because it cannot be determined accurately when</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the program has inline assembly statements.  We therefore use the</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// relocation expressions %hi($tgt-$baltgt) and %lo($tgt-$baltgt) which</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// are resolved during the fixup, so the values will always be correct.</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Since we cannot create %hi($tgt-$baltgt) and %lo($tgt-$baltgt)</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// expressions at this point (it is possible only at the MC layer),</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we replace LUi and ADDiu with pseudo instructions</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// LONG&#95;BRANCH&#95;LUi and LONG&#95;BRANCH&#95;ADDiu, and add both basic</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// blocks as operands to these instructions.  When lowering these pseudo</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instructions to LUi and ADDiu in the MC layer, we will create</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// %hi($tgt-$baltgt) and %lo($tgt-$baltgt) expressions and add them as</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// operands to lowered instructions.</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LONG&#95;BRANCH&#95;LUi), Mips::AT)</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(TgtMBB, <a href="/docs/api/namespaces/llvm/mipsii/#ab0cf5f5ed4db649fc89a1b41f8b5771fa5fbdfe4fb09a0dac0b32cce2d9d68624">MipsII::MO&#95;ABS&#95;HI</a>)</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(BalTgtMBB);</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineinstrbuilder">MachineInstrBuilder</a> BalInstr =</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;MFp, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(BalOp)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(BalTgtMBB);</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineinstrbuilder">MachineInstrBuilder</a> ADDiuInstr =</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;MFp, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LONG&#95;BRANCH&#95;ADDiu), Mips::AT)</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::AT)</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(TgtMBB, <a href="/docs/api/namespaces/llvm/mipsii/#ab0cf5f5ed4db649fc89a1b41f8b5771fa23c1a6183ec3becd204af9f074a6a10e">MipsII::MO&#95;ABS&#95;LO</a>)</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(BalTgtMBB);</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STI-&gt;hasMips32r6()) &#123;</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">        LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3435a2381e60e842e915f85c931b7dde">insert</a>(Pos, ADDiuInstr);</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">        LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3435a2381e60e842e915f85c931b7dde">insert</a>(Pos, BalInstr);</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">        LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3435a2381e60e842e915f85c931b7dde">insert</a>(Pos, BalInstr);</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">        LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3435a2381e60e842e915f85c931b7dde">insert</a>(Pos, ADDiuInstr);</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">        LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad8c9657cfb03ef2ebf6364ba9d68c127">rbegin</a>()-&gt;bundleWithPred();</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">      Pos = BalTgtMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;BalTgtMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::ADDu), Mips::AT)</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::RA)</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::AT);</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;BalTgtMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LW), Mips::RA)</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::SP)</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0);</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STI-&gt;isTargetNaCl())</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Bundle-align the target of indirect branch JR.</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">        TgtMBB-&gt;setAlignment(<a href="/docs/api/namespaces/llvm/#a9d541d8406ddf2e3d0245ab85de29523">MIPS&#95;NACL&#95;BUNDLE&#95;ALIGN</a>);</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// In NaCl, modifying the sp is not allowed in branch delay slot.</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For MIPS32R6, we can skip using a delay slot branch.</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> hasDelaySlot = buildProperJumpMI(BalTgtMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STI-&gt;isTargetNaCl() || !hasDelaySlot) &#123;</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;BalTgtMBB, std::prev(Pos), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::ADDiu), Mips::SP)</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::SP)</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(8);</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (hasDelaySlot) &#123;</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STI-&gt;isTargetNaCl()) &#123;</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;insertNop(&#42;BalTgtMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;BalTgtMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::ADDiu), Mips::SP)</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::SP)</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(8);</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">        BalTgtMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad8c9657cfb03ef2ebf6364ba9d68c127">rbegin</a>()-&gt;bundleWithPred();</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Pre R6:</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $longbr:</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  daddiu $sp, $sp, -16</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  sd $ra, 0($sp)</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  daddiu $at, $zero, %hi($tgt - $baltgt)</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  dsll $at, $at, 16</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  bal $baltgt</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  daddiu $at, $at, %lo($tgt - $baltgt)</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $baltgt:</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  daddu $at, $ra, $at</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  ld $ra, 0($sp)</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  jr64 $at</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  daddiu $sp, $sp, 16</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $fallthrough:</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// R6:</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $longbr:</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  daddiu $sp, $sp, -16</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  sd $ra, 0($sp)</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  daddiu $at, $zero, %hi($tgt - $baltgt)</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  dsll $at, $at, 16</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  daddiu $at, $at, %lo($tgt - $baltgt)</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  balc $baltgt</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $baltgt:</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  daddu $at, $ra, $at</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  ld $ra, 0($sp)</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  daddiu $sp, $sp, 16</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  jic $at, 0</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $fallthrough:</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We assume the branch is within-function, and that offset is within</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// +/- 2GB.  High 32 bits will therefore always be zero.</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Note that this will work even if the offset is negative, because</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// of the 1 modification that&#39;s added in that case.  For example, if the</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// offset is -1MB (0xFFFFFFFFFFF00000), the computation for %higher is</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// 18446744073708503000 + 2147516416 = 2146467840</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// and the bits &#91;47:32&#93; are zero.  For %highest</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// 18446744073708503000 + 140739635871744 = 140739634823168</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// and the bits &#91;63:48&#93; are zero.</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">      Pos = LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::DADDiu), Mips::SP&#95;64)</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::SP&#95;64)</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(-16);</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::SD))</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::RA&#95;64)</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::SP&#95;64)</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0);</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LONG&#95;BRANCH&#95;DADDiu),</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">              Mips::AT&#95;64)</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::ZERO&#95;64)</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(TgtMBB, <a href="/docs/api/namespaces/llvm/mipsii/#ab0cf5f5ed4db649fc89a1b41f8b5771fa5fbdfe4fb09a0dac0b32cce2d9d68624">MipsII::MO&#95;ABS&#95;HI</a>)</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(BalTgtMBB);</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::DSLL), Mips::AT&#95;64)</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::AT&#95;64)</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(16);</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineinstrbuilder">MachineInstrBuilder</a> BalInstr =</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;MFp, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(BalOp)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(BalTgtMBB);</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineinstrbuilder">MachineInstrBuilder</a> DADDiuInstr =</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;MFp, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LONG&#95;BRANCH&#95;DADDiu), Mips::AT&#95;64)</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::AT&#95;64)</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(TgtMBB, <a href="/docs/api/namespaces/llvm/mipsii/#ab0cf5f5ed4db649fc89a1b41f8b5771fa23c1a6183ec3becd204af9f074a6a10e">MipsII::MO&#95;ABS&#95;LO</a>)</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">              .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(BalTgtMBB);</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STI-&gt;hasMips32r6()) &#123;</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">        LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3435a2381e60e842e915f85c931b7dde">insert</a>(Pos, DADDiuInstr);</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">        LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3435a2381e60e842e915f85c931b7dde">insert</a>(Pos, BalInstr);</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">        LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3435a2381e60e842e915f85c931b7dde">insert</a>(Pos, BalInstr);</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">        LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3435a2381e60e842e915f85c931b7dde">insert</a>(Pos, DADDiuInstr);</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">        LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad8c9657cfb03ef2ebf6364ba9d68c127">rbegin</a>()-&gt;bundleWithPred();</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">      Pos = BalTgtMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;BalTgtMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::DADDu), Mips::AT&#95;64)</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::RA&#95;64)</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::AT&#95;64);</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;BalTgtMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LD), Mips::RA&#95;64)</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::SP&#95;64)</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(0);</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> hasDelaySlot = buildProperJumpMI(BalTgtMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If there is no delay slot, Insert stack adjustment before</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!hasDelaySlot) &#123;</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;BalTgtMBB, std::prev(Pos), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::DADDiu),</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">                Mips::SP&#95;64)</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::SP&#95;64)</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(16);</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;BalTgtMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::DADDiu), Mips::SP&#95;64)</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::SP&#95;64)</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(16);</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">        BalTgtMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad8c9657cfb03ef2ebf6364ba9d68c127">rbegin</a>()-&gt;bundleWithPred();</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123; </span><span class="doxyHighlightComment">// Not PIC</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">    Pos = LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">    LongBrMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(TgtMBB);</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the position of the potentiall jump instruction (basic blocks</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// before + 4 for the instruction)</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">    uint64&#95;t JOffset = computeOffsetFromTheBeginning(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getNumber()) +</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">                       MBBInfos&#91;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getNumber()&#93;.Size + 4;</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">    uint64&#95;t TgtMBBOffset = computeOffsetFromTheBeginning(TgtMBB-&gt;getNumber());</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If it&#39;s a forward jump, then TgtMBBOffset will be shifted by two</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (JOffset &lt; TgtMBBOffset)</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">      TgtMBBOffset += 2 &#42; 4;</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compare 4 upper bits to check if it&#39;s the same segment</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SameSegmentJump = JOffset &gt;&gt; 28 == TgtMBBOffset &gt;&gt; 28;</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STI-&gt;hasMips32r6() &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isBranchOffsetInRange(Mips::BC, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.Offset)) &#123;</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// R6:</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $longbr:</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  bc $tgt</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $fallthrough:</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">              <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(STI-&gt;inMicroMipsMode() ? Mips::BC&#95;MMR6 : Mips::BC))</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">          .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(TgtMBB);</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SameSegmentJump) &#123;</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Pre R6:</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $longbr:</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  j $tgt</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//  nop</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// $fallthrough:</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::J)).<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(TgtMBB);</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;insertNop(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)-&gt;bundleWithPred();</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// At this point, offset where we need to branch does not fit into</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// immediate field of the branch instruction and is not in the same</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// segment as jump instruction. Therefore we will break it into couple</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instructions, where we first load the offset into register, and then we</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// do branch register.</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ABI.IsN64()) &#123;</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LONG&#95;BRANCH&#95;LUi2Op&#95;64),</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">                Mips::AT&#95;64)</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(TgtMBB, <a href="/docs/api/namespaces/llvm/mipsii/#ab0cf5f5ed4db649fc89a1b41f8b5771fab607eb14b7755148dd000a00762e46a8">MipsII::MO&#95;HIGHEST</a>);</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LONG&#95;BRANCH&#95;DADDiu2Op),</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">                Mips::AT&#95;64)</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::AT&#95;64)</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(TgtMBB, <a href="/docs/api/namespaces/llvm/mipsii/#ab0cf5f5ed4db649fc89a1b41f8b5771fae9a6bcb93bd478212b515dedbcf7d07b">MipsII::MO&#95;HIGHER</a>);</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::DSLL), Mips::AT&#95;64)</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::AT&#95;64)</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(16);</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LONG&#95;BRANCH&#95;DADDiu2Op),</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">                Mips::AT&#95;64)</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::AT&#95;64)</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(TgtMBB, <a href="/docs/api/namespaces/llvm/mipsii/#ab0cf5f5ed4db649fc89a1b41f8b5771fa5fbdfe4fb09a0dac0b32cce2d9d68624">MipsII::MO&#95;ABS&#95;HI</a>);</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::DSLL), Mips::AT&#95;64)</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::AT&#95;64)</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a6c1f959947905135c7dd215b64957654">addImm</a>(16);</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LONG&#95;BRANCH&#95;DADDiu2Op),</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">                Mips::AT&#95;64)</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::AT&#95;64)</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(TgtMBB, <a href="/docs/api/namespaces/llvm/mipsii/#ab0cf5f5ed4db649fc89a1b41f8b5771fa23c1a6183ec3becd204af9f074a6a10e">MipsII::MO&#95;ABS&#95;LO</a>);</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LONG&#95;BRANCH&#95;LUi2Op),</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">                Mips::AT)</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(TgtMBB, <a href="/docs/api/namespaces/llvm/mipsii/#ab0cf5f5ed4db649fc89a1b41f8b5771fa5fbdfe4fb09a0dac0b32cce2d9d68624">MipsII::MO&#95;ABS&#95;HI</a>);</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LONG&#95;BRANCH&#95;ADDiu2Op),</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">                Mips::AT)</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::AT)</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/machineinstrbuilder/#abf1febf2a98f588146548a3a485d3838">addMBB</a>(TgtMBB, <a href="/docs/api/namespaces/llvm/mipsii/#ab0cf5f5ed4db649fc89a1b41f8b5771fa23c1a6183ec3becd204af9f074a6a10e">MipsII::MO&#95;ABS&#95;LO</a>);</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">      buildProperJumpMI(LongBrMBB, Pos, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.Br-&gt;isUnconditionalBranch()) &#123;</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Change branch destination.</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.Br-&gt;getDesc().getNumOperands() == 1);</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.Br-&gt;removeOperand(0);</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.Br-&gt;addOperand(<a href="/docs/api/classes/llvm/machineoperand/#af38d24646cd711efc334aee49919cdf5">MachineOperand::CreateMBB</a>(LongBrMBB));</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Change branch destination and reverse condition.</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">    replaceBranch(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.Br, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, &amp;&#42;FallThroughMBB);</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734" lineLink="#adfd69c79b4eb159ce76cbc8cf5b06073"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#adfd69c79b4eb159ce76cbc8cf5b06073">emitGPDisp</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mipsinstrinfo">MipsInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>) &#123;</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.front();</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin();</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.findDebugLoc(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.begin());</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::LUi), Mips::V0)</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a30a1feca92679c24a46b0b824a6de269">addExternalSymbol</a>(</span><span class="doxyHighlightStringLiteral">&quot;&#95;gp&#95;disp&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/mipsii/#ab0cf5f5ed4db649fc89a1b41f8b5771fa5fbdfe4fb09a0dac0b32cce2d9d68624">MipsII::MO&#95;ABS&#95;HI</a>);</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;get(Mips::ADDiu), Mips::V0)</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a927857fc69e4b4f0cde307f86f180df5">addReg</a>(Mips::V0)</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/machineinstrbuilder/#a30a1feca92679c24a46b0b824a6de269">addExternalSymbol</a>(</span><span class="doxyHighlightStringLiteral">&quot;&#95;gp&#95;disp&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/mipsii/#ab0cf5f5ed4db649fc89a1b41f8b5771fa23c1a6183ec3becd204af9f074a6a10e">MipsII::MO&#95;ABS&#95;LO</a>);</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.removeLiveIn(Mips::V0);</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> Pred, </span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> Safe&gt;</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747" lineLink="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#ab06856c9082a4798a4af7478b23213f4"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MipsBranchExpansion::handleMFLOSlot(Pred Predicate, Safe SafeInSlot) &#123;</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> hasPendingMFLO = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> FI = MFp-&gt;begin(); FI != MFp-&gt;end(); ++FI) &#123;</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = FI-&gt;begin(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != FI-&gt;end(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Predicate(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !hasPendingMFLO) &#123;</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> IInSlot;</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LastInstInFunction =</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">          std::next(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) == FI-&gt;end() &amp;&amp; std::next(FI) == MFp-&gt;end();</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We need process several situations:</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// mflo is last instruction, do not process;</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// mflo + div, add two nop between them;</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// mflo + none-div + none-div, do not process;</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// mflo + none-div + div, add nop between none-div and div.</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LastInstInFunction) &#123;</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">        std::pair&lt;Iter, bool&gt; Res = <a href="#a4801e594c6226fb9020a07ca36641c5b">getNextMachineInstr</a>(std::next(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), &amp;&#42;FI);</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">        LastInstInFunction |= Res.second;</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">        IInSlot = Res.first;</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LastInstInFunction)</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SafeInSlot(&#42;IInSlot, &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">          TII-&gt;insertNop(&#42;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()), std::next(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc())</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">              -&gt;bundleWithPred();</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">          NumInsertedNops++;</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips-h/#a644bb3cf996365271debaf13502ddc17">IsMFLOMFHI</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode())) &#123;</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">            TII-&gt;insertNop(&#42;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()), std::next(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc())</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">                -&gt;bundleWithPred();</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">            NumInsertedNops++;</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (hasPendingMFLO)</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">            hasPendingMFLO = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (hasPendingMFLO)</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">          hasPendingMFLO = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips-h/#a644bb3cf996365271debaf13502ddc17">IsMFLOMFHI</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()))</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">          hasPendingMFLO = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> Pred, </span><span class="doxyHighlightKeyword">typename</span><span class="doxyHighlight"> Safe&gt;</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796" lineLink="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a0b2dd21efa6b10de984a3bbd49e5e7eb"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MipsBranchExpansion::handleSlot(Pred Predicate, Safe SafeInSlot) &#123;</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> FI = MFp-&gt;begin(); FI != MFp-&gt;end(); ++FI) &#123;</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = FI-&gt;begin(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != FI-&gt;end(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Delay slot hazard handling. Use lookahead over state.</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Predicate(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#ac34e799fd29fd86fe9713599ed72a596">Iter</a> IInSlot;</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LastInstInFunction =</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">          std::next(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) == FI-&gt;end() &amp;&amp; std::next(FI) == MFp-&gt;end();</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LastInstInFunction) &#123;</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">        std::pair&lt;Iter, bool&gt; Res = <a href="#a4801e594c6226fb9020a07ca36641c5b">getNextMachineInstr</a>(std::next(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), &amp;&#42;FI);</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">        LastInstInFunction |= Res.second;</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">        IInSlot = Res.first;</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LastInstInFunction || !SafeInSlot(&#42;IInSlot, &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/machinebasicblock/#ab6395548cae73865213e279ae461db54">MachineBasicBlock::instr&#95;iterator</a> Iit = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIterator();</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::next(Iit) == FI-&gt;end() ||</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">            std::next(Iit)-&gt;getOpcode() != Mips::NOP) &#123;</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">          TII-&gt;insertNop(&#42;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()), std::next(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc())</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">              -&gt;bundleWithPred();</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">          NumInsertedNops++;</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MipsBranchExpansion::handleMFLO() &#123;</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// mips1-4 require a minimum of 2 instructions between a mflo/mfhi</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and the next mul/div instruction.</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STI-&gt;hasMips32() || STI-&gt;hasMips5())</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> handleMFLOSlot(</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">      &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;IsMfloOrMfhi(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); &#125;,</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">      &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;IInSlot, </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;SafeAfterMflo(IInSlot);</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MipsBranchExpansion::handleForbiddenSlot() &#123;</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Forbidden slot hazards are only defined for MIPSR6 but not microMIPSR6.</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!STI-&gt;hasMips32r6() || STI-&gt;inMicroMipsMode())</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> handleSlot(</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">      &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;HasForbiddenSlot(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); &#125;,</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">      &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;IInSlot, </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;SafeInForbiddenSlot(IInSlot);</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MipsBranchExpansion::handleFPUDelaySlot() &#123;</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FPU delay slots are only defined for MIPS3 and below.</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STI-&gt;hasMips32() || STI-&gt;hasMips4())</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> handleSlot(&#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;HasFPUDelaySlot(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); &#125;,</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">                    &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;IInSlot, </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;SafeInFPUDelaySlot(IInSlot, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">                    &#125;);</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MipsBranchExpansion::handleLoadDelaySlot() &#123;</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Load delay slot hazards are only for MIPS1.</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STI-&gt;hasMips2())</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> handleSlot(</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">      &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;HasLoadDelaySlot(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); &#125;,</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">      &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;IInSlot, </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;SafeInLoadDelaySlot(IInSlot, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MipsBranchExpansion::handlePossibleLongBranch() &#123;</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STI-&gt;inMips16Mode() || !STI-&gt;enableLongBranchPass())</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a6d2b3c062869b333c00917f7768d4468">SkipLongBranch</a>)</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EverMadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (MadeChange) &#123;</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">    initMBBInfo();</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = MBBInfos.size(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = MFp-&gt;getBlockNumbered(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Search for MBB&#39;s branch instruction.</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#a7a84c21d9340186b61fbadc67f98d348">ReverseIter</a> End = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;rend();</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">      <a href="/docs/api/namespaces/anonymous-mipsbranchexpansion-cpp-/#a7a84c21d9340186b61fbadc67f98d348">ReverseIter</a> Br = <a href="#aee3bb13ddbd5b3613acda398cdd4d8d7">getNonDebugInstr</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;rbegin(), End);</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Br != End) &amp;&amp; Br-&gt;isBranch() &amp;&amp; !Br-&gt;isIndirectBranch() &amp;&amp;</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">          (Br-&gt;isConditionalBranch() ||</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">           (Br-&gt;isUnconditionalBranch() &amp;&amp; IsPIC))) &#123;</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">        int64&#95;t <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = computeOffset(&amp;&#42;Br);</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (STI-&gt;isTargetNaCl()) &#123;</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// The offset calculation does not include sandboxing instructions</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// that will be added later in the MC layer.  Since at this point we</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// don&#39;t know the exact amount of code that &quot;sandboxing&quot; will add, we</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// conservatively estimate that code will not grow more than 100%.</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> &#42;= 2;</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ForceLongBranchFirstPass ||</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">            !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isBranchOffsetInRange(Br-&gt;getOpcode(), <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)) &#123;</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">          MBBInfos&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;.Offset = <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>;</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">          MBBInfos&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;.Br = &amp;&#42;Br;</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightComment">// End for</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">    ForceLongBranchFirstPass = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl/#ac5b936169badf0b703567eb960278648">SmallVectorImpl&lt;MBBInfo&gt;::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = MBBInfos.end();</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MBBInfos.begin(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip if this MBB doesn&#39;t have a branch or the branch has already been</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// converted to a long branch.</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;Br)</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">      expandToLongBranch(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">      ++LongBranches;</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">      EverMadeChange = MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">    MFp-&gt;RenumberBlocks();</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EverMadeChange;</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941" lineLink="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a3c8f821517aee816af530ae28a2f4b83"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-mipsbranchexpansion-cpp-/mipsbranchexpansion/#a3c8f821517aee816af530ae28a2f4b83">MipsBranchExpansion::runOnMachineFunction</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetmachine">TargetMachine</a> &amp;TM = MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>();</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">  IsPIC = TM.isPositionIndependent();</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">  ABI = </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeyword">const </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/mipstargetmachine">MipsTargetMachine</a> &amp;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(TM).getABI();</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">  STI = &amp;MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;<a href="/docs/api/classes/llvm/mipssubtarget">MipsSubtarget</a>&gt;();</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">  TII = </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeyword">const </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/mipsinstrinfo">MipsInstrInfo</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(STI-&gt;getInstrInfo());</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsPIC &amp;&amp; ABI.IsO32() &amp;&amp;</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">      MF.<a href="/docs/api/classes/llvm/machinefunction/#ab7feae1932b436c8630e247166ec42b7">getInfo</a>&lt;<a href="/docs/api/classes/llvm/mipsfunctioninfo">MipsFunctionInfo</a>&gt;()-&gt;<a href="/docs/api/classes/llvm/mipsfunctioninfo/#aa545181deae11accd7a2277fb53e3824">globalBaseRegSet</a>())</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">    <a href="#adfd69c79b4eb159ce76cbc8cf5b06073">emitGPDisp</a>(MF, TII);</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">  MFp = &amp;MF;</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">  ForceLongBranchFirstPass = <a href="#a55de83450b64f38db6fc2572748d8288">ForceLongBranch</a>;</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Run these at least once.</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> longBranchChanged = handlePossibleLongBranch();</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> forbiddenSlotChanged = handleForbiddenSlot();</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> fpuDelaySlotChanged = handleFPUDelaySlot();</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> loadDelaySlotChanged = handleLoadDelaySlot();</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MfloChanged = handleMFLO();</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = longBranchChanged || forbiddenSlotChanged ||</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">                 fpuDelaySlotChanged || loadDelaySlotChanged || MfloChanged;</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Then run them alternatively while there are changes.</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (forbiddenSlotChanged) &#123;</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">    longBranchChanged = handlePossibleLongBranch();</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">    fpuDelaySlotChanged = handleFPUDelaySlot();</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">    loadDelaySlotChanged = handleLoadDelaySlot();</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">    MfloChanged = handleMFLO();</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!longBranchChanged &amp;&amp; !fpuDelaySlotChanged &amp;&amp; !loadDelaySlotChanged &amp;&amp;</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">        !MfloChanged)</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">    forbiddenSlotChanged = handleForbiddenSlot();</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
