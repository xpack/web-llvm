---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/codegen/branchfolding-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `BranchFolding.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="BranchFolding.h"
  permalink="/docs/api/files/lib/lib/codegen/branchfolding-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/BitVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/bitvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ProfileSummaryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/Analysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/analysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MBFIWrapper.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/mbfiwrapper-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineBlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineblockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineBranchProbabilityInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebranchprobabilityinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunctionPass.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunctionpass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineInstr.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstr-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineInstrBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstrbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineJumpTableInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinejumptableinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineLoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineloopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineOperand.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineoperand-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineRegisterInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineregisterinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineSizeOpts.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinesizeopts-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetInstrInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetinstrinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetOpcodes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetopcodes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetPassConfig.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetpassconfig-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetRegisterInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetregisterinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetSubtargetInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetsubtargetinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfoMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugLoc.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/MC/LaneBitmask.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/mc/lanebitmask-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/MC/MCRegisterInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/mc/mcregisterinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Pass.h"
  permalink="/docs/api/files/include/include/llvm/pass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BlockFrequency.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/blockfrequency-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BranchProbability.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetMachine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h"
  isLocal="true" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstddef"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="numeric"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-branchfolding-cpp-">anonymous&#123;BranchFolding.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass">BranchFolderPass</a></>}>
<a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass">BranchFolderPass</a> - Wrap branch folder in a machine function pass. <a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  template={<>template &lt;class Container&gt;</>}
  type="void"
  name={<><a href="#a6afe81a8562ad740b6edd4c536974067">addRegAndItsAliases</a> (Register Reg, const TargetRegisterInfo &#42;TRI, Container &amp;Set)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3c776f3a438cc58490cf4af1ea63fac3">blockEndsInUnreachable</a> (const MachineBasicBlock &#42;MBB)</>}>
A no successor, non-return block probably ends in unreachable and is cold. <a href="#a3c776f3a438cc58490cf4af1ea63fac3">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a0ff8a27be1a6683026280a4611628562">ComputeCommonTailLength</a> (MachineBasicBlock &#42;MBB1, MachineBasicBlock &#42;MBB2, MachineBasicBlock::iterator &amp;I1, MachineBasicBlock::iterator &amp;I2)</>}>
Given two machine basic blocks, return the number of instructions they actually have in common together at their end. <a href="#a0ff8a27be1a6683026280a4611628562">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a287fa83baa277de19fb734bdda92f0c6">copyDebugInfoToPredecessor</a> (const TargetInstrInfo &#42;TII, MachineBasicBlock &amp;MBB, MachineBasicBlock &amp;PredMBB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aaaf533c4a29ff1fd44bfef2f8feb1c3c">copyDebugInfoToSuccessor</a> (const TargetInstrInfo &#42;TII, MachineBasicBlock &amp;MBB, MachineBasicBlock &amp;SuccMBB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a32ade962ece3d632aadbbb4a90eb8d37">countsAsInstruction</a> (const MachineInstr &amp;MI)</>}>
Whether MI should be counted as an instruction when calculating common tail. <a href="#a32ade962ece3d632aadbbb4a90eb8d37">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a3a41d2e125b5d09248ee68674761fb14">CountTerminators</a> (MachineBasicBlock &#42;MBB, MachineBasicBlock::iterator &amp;I)</>}>
CountTerminators - Count the number of terminators in the given block and set I to the position of the first non-terminator, if there is one, or MBB-&gt;end() otherwise. <a href="#a3a41d2e125b5d09248ee68674761fb14">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a0df528512b8aed2e9f70a3f9b3128507">EstimateRuntime</a> (MachineBasicBlock::iterator I, MachineBasicBlock::iterator E)</>}>
EstimateRuntime - Make a rough estimate for how long it will take to run the specified code. <a href="#a0df528512b8aed2e9f70a3f9b3128507">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</>}
  name={<><a href="#a22558d7c3b0ce9b0075ea086c1d3749d">findFalseBlock</a> (MachineBasicBlock &#42;BB, MachineBasicBlock &#42;TrueBB)</>}>
findFalseBlock - BB has a fallthrough. <a href="#a22558d7c3b0ce9b0075ea086c1d3749d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a></>}
  name={<><a href="#ae9089253a8c971c8429d201735c81ed6">findHoistingInsertPosAndDeps</a> (MachineBasicBlock &#42;MBB, const TargetInstrInfo &#42;TII, const TargetRegisterInfo &#42;TRI, SmallSet&lt; Register, 4 &gt; &amp;Uses, SmallSet&lt; Register, 4 &gt; &amp;Defs)</>}>
findHoistingInsertPosAndDeps - Find the location to move common instructions in successors to. <a href="#ae9089253a8c971c8429d201735c81ed6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#abbe6276e99bb565156d18a843ae1ccb9">FixTail</a> (MachineBasicBlock &#42;CurMBB, MachineBasicBlock &#42;SuccBB, const TargetInstrInfo &#42;TII, const DebugLoc &amp;BranchDL)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#adef2c46c3161a62af20d7f993a287a98">HashEndOfMBB</a> (const MachineBasicBlock &amp;MBB)</>}>
HashEndOfMBB - Hash the last instruction in the MBB. <a href="#adef2c46c3161a62af20d7f993a287a98">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#a2a51f503d36986f1828aacccbf3e64b4">HashMachineInstr</a> (const MachineInstr &amp;MI)</>}>
HashMachineInstr - Compute a hash value for MI and its operands. <a href="#a2a51f503d36986f1828aacccbf3e64b4">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a504736d0c95e44bc01df5707be6f7ab7">INITIALIZE&#95;PASS</a> (BranchFolderPass, DEBUG&#95;TYPE, &quot;Control Flow Optimizer&quot;, false, false) bool BranchFolderPass</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#acda790896623fd894c71bf79f1bbcfea">IsBetterFallthrough</a> (MachineBasicBlock &#42;MBB1, MachineBasicBlock &#42;MBB2)</>}>
IsBetterFallthrough - Return true if it would be clearly better to fall-through to MBB1 than to fall through into MBB2. <a href="#acda790896623fd894c71bf79f1bbcfea">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab17cea834a55a63f670e77230917423e">IsBranchOnlyBlock</a> (MachineBasicBlock &#42;MBB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a87d0fbdabd17122a3febe35d7fbefb60">IsEmptyBlock</a> (MachineBasicBlock &#42;MBB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ae7773e6945ecc33b1e3ab0d47f293665">mergeOperations</a> (MachineBasicBlock::iterator MBBIStartPos, MachineBasicBlock &amp;MBBCommon)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a905140abedaee343fc7ef33707052792">ProfitableToMerge</a> (MachineBasicBlock &#42;MBB1, MachineBasicBlock &#42;MBB2, unsigned MinCommonTailLength, unsigned &amp;CommonTailLen, MachineBasicBlock::iterator &amp;I1, MachineBasicBlock::iterator &amp;I2, MachineBasicBlock &#42;SuccBB, MachineBasicBlock &#42;PredBB, DenseMap&lt; const MachineBasicBlock &#42;, int &gt; &amp;EHScopeMembership, bool AfterPlacement, MBFIWrapper &amp;MBBFreqInfo, ProfileSummaryInfo &#42;PSI)</>}>
ProfitableToMerge - <a href="/docs/api/namespaces/llvm/check">Check</a> if two machine basic blocks have a common tail and decide if it would be profitable to merge those tails. <a href="#a905140abedaee343fc7ef33707052792">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a3fb0794be53f8c8e93e76861075a9a8a">salvageDebugInfoFromEmptyBlock</a> (const TargetInstrInfo &#42;TII, MachineBasicBlock &amp;MBB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a></>}
  name={<><a href="#a4b4e292651fcfd1d800e5292dfb6122c">skipBackwardPastNonInstructions</a> (MachineBasicBlock::iterator I, MachineBasicBlock &#42;MBB)</>}>
Iterate backwards from the given iterator <code>I</code>, towards the beginning of the block. <a href="#a4b4e292651fcfd1d800e5292dfb6122c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#abb44a1086dbc1e7375ccb5a837a32352">STATISTIC</a> (NumDeadBlocks, &quot;Number of dead blocks removed&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#af1773eebfd38bb8acaaeaa1e16fc2418">STATISTIC</a> (NumBranchOpts, &quot;Number of branches optimized&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a643e96d9076e12e4b32efa937a5b173e">STATISTIC</a> (NumTailMerge, &quot;Number of block tails merged&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ae13641ae965941f57763822b36f0493c">STATISTIC</a> (NumHoist, &quot;Number of times common instructions are hoisted&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a526d971070005b4bf5e134963ba43d5b">STATISTIC</a> (NumTailCalls, &quot;Number of tail calls optimized&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; <a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44">cl::boolOrDefault</a> &gt;</>}
  name={<><a href="#a6b557e923cdf31251289c0e07e382143">FlagEnableTailMerge</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a73423bf857429f170a6355ae20e1d798">TailMergeSize</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a63debb3136d590391f5f3765095afa5c">TailMergeThreshold</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;branch-folder&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### addRegAndItsAliases() {#a6afe81a8562ad740b6edd4c536974067}

<MemberDefinition
  template={<>template &lt;class Container&gt;</>}
  prototype={<>static void addRegAndItsAliases (<a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42; TRI, Container &amp; Set)</>}
  labels = {["static"]}>

Definition at line <a href="#l01798">1798</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### blockEndsInUnreachable() {#a3c776f3a438cc58490cf4af1ea63fac3}

<MemberDefinition
  prototype={<>static bool blockEndsInUnreachable (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB)</>}
  labels = {["static"]}>
A no successor, non-return block probably ends in unreachable and is cold.

Also consider a block that ends in an indirect branch to be a return block, since many targets use plain indirect branches to return.

Definition at line <a href="#l00519">519</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### ComputeCommonTailLength() {#a0ff8a27be1a6683026280a4611628562}

<MemberDefinition
  prototype={<>static unsigned ComputeCommonTailLength (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB1, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB2, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp; I1, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp; I2)</>}
  labels = {["static"]}>
Given two machine basic blocks, return the number of instructions they actually have in common together at their end.

If a common tail is found (at least by one instruction), then iterators for the first shared instruction in each block are returned as well.

Non-instructions according to countsAsInstruction are ignored.

Definition at line <a href="#l00329">329</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### copyDebugInfoToPredecessor() {#a287fa83baa277de19fb734bdda92f0c6}

<MemberDefinition
  prototype={<>static void copyDebugInfoToPredecessor (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42; TII, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; MBB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; PredMBB)</>}
  labels = {["static"]}>

Definition at line <a href="#l01271">1271</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### copyDebugInfoToSuccessor() {#aaaf533c4a29ff1fd44bfef2f8feb1c3c}

<MemberDefinition
  prototype={<>static void copyDebugInfoToSuccessor (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42; TII, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; MBB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; SuccMBB)</>}
  labels = {["static"]}>

Definition at line <a href="#l01283">1283</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### countsAsInstruction() {#a32ade962ece3d632aadbbb4a90eb8d37}

<MemberDefinition
  prototype={<>static bool countsAsInstruction (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; MI)</>}
  labels = {["static"]}>
Whether MI should be counted as an instruction when calculating common tail.

Definition at line <a href="#l00305">305</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### CountTerminators() {#a3a41d2e125b5d09248ee68674761fb14}

<MemberDefinition
  prototype={<>static unsigned CountTerminators (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp; I)</>}
  labels = {["static"]}>
CountTerminators - Count the number of terminators in the given block and set I to the position of the first non-terminator, if there is one, or MBB-&gt;end() otherwise.

Definition at line <a href="#l00500">500</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### EstimateRuntime() {#a0df528512b8aed2e9f70a3f9b3128507}

<MemberDefinition
  prototype={<>static unsigned EstimateRuntime (<a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> I, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> E)</>}
  labels = {["static"]}>
EstimateRuntime - Make a rough estimate for how long it will take to run the specified code.

Definition at line <a href="#l00441">441</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### findFalseBlock() {#a22558d7c3b0ce9b0075ea086c1d3749d}

<MemberDefinition
  prototype={<>static MachineBasicBlock &#42; findFalseBlock (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; BB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; TrueBB)</>}
  labels = {["static"]}>
findFalseBlock - BB has a fallthrough.

Find its &#39;false&#39; successor given its &#39;true&#39; successor.

Definition at line <a href="#l01789">1789</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### findHoistingInsertPosAndDeps() {#ae9089253a8c971c8429d201735c81ed6}

<MemberDefinition
  prototype={<>static MachineBasicBlock::iterator findHoistingInsertPosAndDeps (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42; TII, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42; TRI, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/register">Register</a>, 4 &gt; &amp; Uses, <a href="/docs/api/classes/llvm/smallset">SmallSet</a>&lt; <a href="/docs/api/classes/llvm/register">Register</a>, 4 &gt; &amp; Defs)</>}
  labels = {["static"]}>
findHoistingInsertPosAndDeps - Find the location to move common instructions in successors to.

The location is usually just before the terminator, however if the terminator is a conditional branch and its previous instruction is the flag setting instruction, the previous instruction is the preferred location. This function also gathers uses and defs of the instructions from the insertion point to the end of the block. The data is used by HoistCommonCodeInSuccs to ensure safety.

Definition at line <a href="#l01816">1816</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### FixTail() {#abbe6276e99bb565156d18a843ae1ccb9}

<MemberDefinition
  prototype={<>static void FixTail (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; CurMBB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; SuccBB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42; TII, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp; BranchDL)</>}
  labels = {["static"]}>

Definition at line <a href="#l00461">461</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### HashEndOfMBB() {#adef2c46c3161a62af20d7f993a287a98}

<MemberDefinition
  prototype={<>static unsigned HashEndOfMBB (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; MBB)</>}
  labels = {["static"]}>
HashEndOfMBB - Hash the last instruction in the MBB.

Definition at line <a href="#l00296">296</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### HashMachineInstr() {#a2a51f503d36986f1828aacccbf3e64b4}

<MemberDefinition
  prototype={<>static unsigned HashMachineInstr (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; MI)</>}
  labels = {["static"]}>
HashMachineInstr - Compute a hash value for MI and its operands.

Definition at line <a href="#l00256">256</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS() {#a504736d0c95e44bc01df5707be6f7ab7}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS (BranchFolderPass, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, &quot;Control <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a> Optimizer&quot;, false, false)</>}>

Definition at line <a href="#l00119">119</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### IsBetterFallthrough() {#acda790896623fd894c71bf79f1bbcfea}

<MemberDefinition
  prototype={<>static bool IsBetterFallthrough (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB1, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB2)</>}
  labels = {["static"]}>
IsBetterFallthrough - Return true if it would be clearly better to fall-through to MBB1 than to fall through into MBB2.

This has to return a strict ordering, returning true for both (MBB1,MBB2) and (MBB2,MBB1) will result in infinite loops.

Definition at line <a href="#l01250">1250</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### IsBranchOnlyBlock() {#ab17cea834a55a63f670e77230917423e}

<MemberDefinition
  prototype={<>static bool IsBranchOnlyBlock (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB)</>}
  labels = {["static"]}>

Definition at line <a href="#l01240">1240</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### IsEmptyBlock() {#a87d0fbdabd17122a3febe35d7fbefb60}

<MemberDefinition
  prototype={<>static bool IsEmptyBlock (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB)</>}
  labels = {["static"]}>

Definition at line <a href="#l01234">1234</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### mergeOperations() {#ae7773e6945ecc33b1e3ab0d47f293665}

<MemberDefinition
  prototype={<>static void mergeOperations (<a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> MBBIStartPos, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; MBBCommon)</>}
  labels = {["static"]}>

Definition at line <a href="#l00761">761</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### ProfitableToMerge() {#a905140abedaee343fc7ef33707052792}

<MemberDefinition
  prototype={<>static bool ProfitableToMerge (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB1, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB2, unsigned MinCommonTailLength, unsigned &amp; CommonTailLen, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp; I1, <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp; I2, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; SuccBB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; PredBB, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;, int &gt; &amp; EHScopeMembership, bool AfterPlacement, <a href="/docs/api/classes/llvm/mbfiwrapper">MBFIWrapper</a> &amp; MBBFreqInfo, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42; PSI)</>}
  labels = {["static"]}>
ProfitableToMerge - <a href="/docs/api/namespaces/llvm/check">Check</a> if two machine basic blocks have a common tail and decide if it would be profitable to merge those tails.

Return the length of the common tail and iterators to the first common instruction in each block. MBB1, MBB2 The blocks to check MinCommonTailLength Minimum size of tail block to be merged. CommonTailLen Out parameter to record the size of the shared tail between MBB1 and MBB2 I1, I2 Iterator references that will be changed to point to the first instruction in the common tail shared by MBB1,MBB2 SuccBB A common successor of MBB1, MBB2 which are in a canonical form relative to SuccBB PredBB The layout predecessor of SuccBB, if any. EHScopeMembership map from block to EH scope #. AfterPlacement True if we are merging blocks after layout. Stricter thresholds apply to prevent undoing tail-duplication.

Definition at line <a href="#l00544">544</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### salvageDebugInfoFromEmptyBlock() {#a3fb0794be53f8c8e93e76861075a9a8a}

<MemberDefinition
  prototype={<>static void salvageDebugInfoFromEmptyBlock (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42; TII, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; MBB)</>}
  labels = {["static"]}>

Definition at line <a href="#l01302">1302</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### skipBackwardPastNonInstructions() {#a4b4e292651fcfd1d800e5292dfb6122c}

<MemberDefinition
  prototype={<>static MachineBasicBlock::iterator skipBackwardPastNonInstructions (<a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> I, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB)</>}
  labels = {["static"]}>
Iterate backwards from the given iterator <code>I</code>, towards the beginning of the block.

If a MI satisfying &#39;countsAsInstruction&#39; is found, return an iterator pointing to that MI. If no such MI is found, return the end iterator.

Definition at line <a href="#l00313">313</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### STATISTIC() {#abb44a1086dbc1e7375ccb5a837a32352}

<MemberDefinition
  prototype={<>STATISTIC (NumDeadBlocks, &quot;Number of dead <a href="/docs/api/files/lib/lib/codegen/basicblocksections-cpp/#a6b480a971048f2d9cc342c18046d7774">blocks</a> removed&quot;)</>}>

Definition at line <a href="#l00067">67</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### STATISTIC() {#af1773eebfd38bb8acaaeaa1e16fc2418}

<MemberDefinition
  prototype={<>STATISTIC (NumBranchOpts, &quot;Number of <a href="/docs/api/files/lib/lib/target/lib/target/arc/arcbranchfinalize-cpp/#a14311558a7445776def2d5bc13161ba3">branches</a> optimized&quot;)</>}>

Definition at line <a href="#l00068">68</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a643e96d9076e12e4b32efa937a5b173e}

<MemberDefinition
  prototype={<>STATISTIC (NumTailMerge, &quot;Number of <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/unifyloopexits-cpp/#a4741a07a0e5675f89cfed122008e0a76">block</a> tails merged&quot;)</>}>

Definition at line <a href="#l00069">69</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ae13641ae965941f57763822b36f0493c}

<MemberDefinition
  prototype={<>STATISTIC (NumHoist, &quot;Number of times common <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a> are hoisted&quot;)</>}>

Definition at line <a href="#l00070">70</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a526d971070005b4bf5e134963ba43d5b}

<MemberDefinition
  prototype={<>STATISTIC (NumTailCalls, &quot;Number of tail calls optimized&quot;)</>}>

Definition at line <a href="#l00071">71</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### FlagEnableTailMerge {#a6b557e923cdf31251289c0e07e382143}

<MemberDefinition
  prototype={<>cl::opt&lt; cl::boolOrDefault &gt; FlagEnableTailMerge(&quot;enable-tail-merge&quot;, cl::init(cl::BOU&#95;UNSET), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00073">73</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### TailMergeSize {#a73423bf857429f170a6355ae20e1d798}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; TailMergeSize(&quot;tail-merge-size&quot;, cl::desc(&quot;Min number of instructions to consider tail merging&quot;), cl::init(3), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00084">84</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

### TailMergeThreshold {#a63debb3136d590391f5f3765095afa5c}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; TailMergeThreshold(&quot;tail-merge-threshold&quot;, cl::desc(&quot;Max number of predecessors to consider tail merging&quot;), cl::init(150), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00078">78</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;branch-folder&quot;</>}>

Definition at line <a href="#l00065">65</a> of file <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp">BranchFolding.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- BranchFolding.cpp - Fold machine code branch instructions ----------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This pass forwards branches to unconditional branches to make them branch</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// directly to the target block.  This pass often results in dead MBB&#39;s, which</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">// it then removes.</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">// Note that this pass must be run after register allocation, it cannot handle</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">// SSA form. It also must handle virtual registers for targets that emit virtual</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">// ISA (e.g. NVPTX).</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/codegen/branchfolding-h">BranchFolding.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/bitvector-h">llvm/ADT/BitVector.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallset-h">llvm/ADT/SmallSet.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h">llvm/Analysis/ProfileSummaryInfo.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/analysis-h">llvm/CodeGen/Analysis.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/mbfiwrapper-h">llvm/CodeGen/MBFIWrapper.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineblockfrequencyinfo-h">llvm/CodeGen/MachineBlockFrequencyInfo.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebranchprobabilityinfo-h">llvm/CodeGen/MachineBranchProbabilityInfo.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h">llvm/CodeGen/MachineFunction.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunctionpass-h">llvm/CodeGen/MachineFunctionPass.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstr-h">llvm/CodeGen/MachineInstr.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstrbuilder-h">llvm/CodeGen/MachineInstrBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinejumptableinfo-h">llvm/CodeGen/MachineJumpTableInfo.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineloopinfo-h">llvm/CodeGen/MachineLoopInfo.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineoperand-h">llvm/CodeGen/MachineOperand.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineregisterinfo-h">llvm/CodeGen/MachineRegisterInfo.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinesizeopts-h">llvm/CodeGen/MachineSizeOpts.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetinstrinfo-h">llvm/CodeGen/TargetInstrInfo.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetopcodes-h">llvm/CodeGen/TargetOpcodes.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetpassconfig-h">llvm/CodeGen/TargetPassConfig.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetregisterinfo-h">llvm/CodeGen/TargetRegisterInfo.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetsubtargetinfo-h">llvm/CodeGen/TargetSubtargetInfo.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h">llvm/IR/DebugInfoMetadata.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h">llvm/IR/DebugLoc.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/mc/lanebitmask-h">llvm/MC/LaneBitmask.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/mc/mcregisterinfo-h">llvm/MC/MCRegisterInfo.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/pass-h">llvm/Pass.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/blockfrequency-h">llvm/Support/BlockFrequency.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h">llvm/Support/BranchProbability.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h">llvm/Target/TargetMachine.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &lt;cstddef&gt;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &lt;iterator&gt;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &lt;numeric&gt;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;branch-folder&quot;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67" lineLink="#abb44a1086dbc1e7375ccb5a837a32352"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumDeadBlocks, </span><span class="doxyHighlightStringLiteral">&quot;Number of dead blocks removed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68" lineLink="#af1773eebfd38bb8acaaeaa1e16fc2418"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumBranchOpts, </span><span class="doxyHighlightStringLiteral">&quot;Number of branches optimized&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69" lineLink="#a643e96d9076e12e4b32efa937a5b173e"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumTailMerge , </span><span class="doxyHighlightStringLiteral">&quot;Number of block tails merged&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70" lineLink="#ae13641ae965941f57763822b36f0493c"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumHoist     , </span><span class="doxyHighlightStringLiteral">&quot;Number of times common instructions are hoisted&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71" lineLink="#a526d971070005b4bf5e134963ba43d5b"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumTailCalls,  </span><span class="doxyHighlightStringLiteral">&quot;Number of tail calls optimized&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73" lineLink="#a6b557e923cdf31251289c0e07e382143"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;cl::boolOrDefault&gt;</a> <a href="#a6b557e923cdf31251289c0e07e382143">FlagEnableTailMerge</a>(</span><span class="doxyHighlightStringLiteral">&quot;enable-tail-merge&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlight">                              <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44aa5bd521ebe67ddf0e90f1a9e540a6d43">cl::BOU&#95;UNSET</a>), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightComment">// Throttle for huge numbers of predecessors (compile speed problems)</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a></span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78" lineLink="#a63debb3136d590391f5f3765095afa5c"><span class="doxyHighlight"><a href="#a63debb3136d590391f5f3765095afa5c">TailMergeThreshold</a>(</span><span class="doxyHighlightStringLiteral">&quot;tail-merge-threshold&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlight">          <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Max number of predecessors to consider tail merging&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(150), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightComment">// Heuristic for tail merging (and, inversely, tail duplication).</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a></span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84" lineLink="#a73423bf857429f170a6355ae20e1d798"><span class="doxyHighlight"><a href="#a73423bf857429f170a6355ae20e1d798">TailMergeSize</a>(</span><span class="doxyHighlightStringLiteral">&quot;tail-merge-size&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlight">              <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Min number of instructions to consider tail merging&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(3), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88" lineLink="/docs/api/namespaces/anonymous-branchfolding-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlightComment">  /// BranchFolderPass - Wrap branch folder in a machine function pass.</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91" lineLink="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#adab8308d112166e0a7d51a4027a95aa1">BranchFolderPass</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a> &#123;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93" lineLink="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#abc396b1ad9cac962917aada90af773da"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#abc396b1ad9cac962917aada90af773da">ID</a>;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95" lineLink="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#adab8308d112166e0a7d51a4027a95aa1"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">explicit</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#adab8308d112166e0a7d51a4027a95aa1">BranchFolderPass</a>(): <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a>(<a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#abc396b1ad9cac962917aada90af773da">ID</a>) &#123;&#125;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97" lineLink="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#a1a365e884bd9eaacbf443dfee8579c2f"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#a1a365e884bd9eaacbf443dfee8579c2f">runOnMachineFunction</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99" lineLink="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#a78829d89aee87c166fde97d60972afab"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#a78829d89aee87c166fde97d60972afab">getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">      AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machineblockfrequencyinfowrapperpass">MachineBlockFrequencyInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">      AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machinebranchprobabilityinfowrapperpass">MachineBranchProbabilityInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">      AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/profilesummaryinfowrapperpass">ProfileSummaryInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">      AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targetpassconfig">TargetPassConfig</a>&gt;();</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinefunctionpass/#a864fd57b4304ef933b3281d0ef85a88e">MachineFunctionPass::getAnalysisUsage</a>(AU);</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#ab85f98c7f1e25360f7dbcde936ae8403"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunctionproperties">MachineFunctionProperties</a> <a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#ab85f98c7f1e25360f7dbcde936ae8403">getRequiredProperties</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunctionproperties">MachineFunctionProperties</a>().<a href="/docs/api/classes/llvm/machinefunctionproperties/#aa7780563d7ca260d0ae67d957b56427f">set</a>(</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/machinefunctionproperties/#ad85237c6c667e4713efe8921e9c32ac1a76eece0bfd57256980609b66faaef22c">MachineFunctionProperties::Property::NoPHIs</a>);</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#abc396b1ad9cac962917aada90af773da">BranchFolderPass::ID</a> = 0;</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117" lineLink="/docs/api/namespaces/llvm/#ae39ec6579da91ce8fa292f0a7205d98d"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#ae39ec6579da91ce8fa292f0a7205d98d">llvm::BranchFolderPassID</a> = <a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#abc396b1ad9cac962917aada90af773da">BranchFolderPass::ID</a>;</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119" lineLink="#a504736d0c95e44bc01df5707be6f7ab7"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#af807c9595d50b45c0008924c4679c85c">INITIALIZE&#95;PASS</a>(<a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#adab8308d112166e0a7d51a4027a95aa1">BranchFolderPass</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot;Control Flow Optimizer&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">bool <a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#adab8308d112166e0a7d51a4027a95aa1">BranchFolderPass</a>::<a href="/docs/api/classes/anonymous-namespace-branchfolding-cpp-/branchfolderpass/#a1a365e884bd9eaacbf443dfee8579c2f">runOnMachineFunction</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (skipFunction(MF.getFunction()))</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targetpassconfig">TargetPassConfig</a> &#42;PassConfig = &amp;getAnalysis&lt;TargetPassConfig&gt;();</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TailMerge can create jump into if branches that make CFG irreducible for</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// HW that requires structurized CFG.</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EnableTailMerge = !MF.getTarget().requiresStructuredCFG() &amp;&amp;</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">                         PassConfig-&gt;<a href="/docs/api/classes/llvm/targetpassconfig/#a251e15950e6d6eb0f677ef283a3fbf65">getEnableTailMerge</a>();</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mbfiwrapper">MBFIWrapper</a> MBBFreqInfo(</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">      getAnalysis&lt;MachineBlockFrequencyInfoWrapperPass&gt;().getMBFI());</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchfolder">BranchFolder</a> Folder(</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">      EnableTailMerge, </span><span class="doxyHighlightComment">/&#42;CommonHoist=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, MBBFreqInfo,</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">      getAnalysis&lt;MachineBranchProbabilityInfoWrapperPass&gt;().getMBPI(),</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">      &amp;getAnalysis&lt;ProfileSummaryInfoWrapperPass&gt;().getPSI());</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Folder.<a href="/docs/api/classes/llvm/branchfolder/#aa0d50fee4d0d41ccf591e29de109786f">OptimizeFunction</a>(MF, MF.getSubtarget().getInstrInfo(),</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">                                 MF.getSubtarget().getRegisterInfo());</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141" lineLink="/docs/api/classes/llvm/branchfolder/#acd1adbbf741128687beee153521c3318"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/branchfolder/#acd1adbbf741128687beee153521c3318">BranchFolder::BranchFolder</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DefaultEnableTailMerge, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CommonHoist,</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/mbfiwrapper">MBFIWrapper</a> &amp;FreqInfo,</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebranchprobabilityinfo">MachineBranchProbabilityInfo</a> &amp;ProbInfo,</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MinTailLength)</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">    : EnableHoistCommonCode(CommonHoist), MinCommonTailLength(MinTailLength),</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">      MBBFreqInfo(FreqInfo), MBPI(ProbInfo), PSI(PSI) &#123;</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="#a6b557e923cdf31251289c0e07e382143">FlagEnableTailMerge</a>) &#123;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44aa5bd521ebe67ddf0e90f1a9e540a6d43">cl::BOU&#95;UNSET</a>:</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">    EnableTailMerge = DefaultEnableTailMerge;</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44ad7c4bd83c337c86d34f6c2d8eba1e736">cl::BOU&#95;TRUE</a>: EnableTailMerge = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">; </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44a4e55599a5b5277382b14e6e8eb1f63ef">cl::BOU&#95;FALSE</a>: EnableTailMerge = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">; </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> BranchFolder::RemoveDeadBlock(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;pred&#95;empty() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;MBB must be dead!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nRemoving MBB: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &#42;MF = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getParent();</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// drop all successors.</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;succ&#95;empty())</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;removeSuccessor(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;succ&#95;end()-1);</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid matching if this pointer gets reused.</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">  TriedMerging.erase(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update call info.</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.shouldUpdateAdditionalCallInfo())</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">      MF-&gt;<a href="/docs/api/classes/llvm/machinefunction/#ac2bda6392e6a17af54b708e29f1fe744">eraseAdditionalCallInfo</a>(&amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove the block.</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">  MF-&gt;<a href="/docs/api/classes/llvm/machinefunction/#ae986afe2285d3980b27aa9763f3203e9">erase</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">  EHScopeMembership.<a href="/docs/api/classes/llvm/densemapbase/#a1eb8504bab5f794778d82db6ac829923">erase</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MLI)</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">    MLI-&gt;<a href="/docs/api/classes/llvm/loopinfobase/#a52cb018f4f53613b5369ddb5d9873286">removeBlock</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180" lineLink="/docs/api/classes/llvm/branchfolder/#aa0d50fee4d0d41ccf591e29de109786f"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/branchfolder/#aa0d50fee4d0d41ccf591e29de109786f">BranchFolder::OptimizeFunction</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;tii,</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">                                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;tri,</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/machineloopinfo">MachineLoopInfo</a> &#42;mli, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AfterPlacement) &#123;</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!tii) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">  TriedMerging.clear();</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineregisterinfo">MachineRegisterInfo</a> &amp;MRI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a810234b6b3d223b7c74a4253fcc5ea5e">getRegInfo</a>();</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">  AfterBlockPlacement = AfterPlacement;</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">  TII = tii;</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">  TRI = tri;</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">  MLI = mli;</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">  this-&gt;MRI = &amp;MRI;</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MinCommonTailLength == 0) &#123;</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">    MinCommonTailLength = <a href="#a73423bf857429f170a6355ae20e1d798">TailMergeSize</a>.getNumOccurrences() &gt; 0</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">                              ? <a href="#a73423bf857429f170a6355ae20e1d798">TailMergeSize</a></span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">                              : TII-&gt;getTailMergeSize(MF);</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">  UpdateLiveIns = MRI.<a href="/docs/api/classes/llvm/machineregisterinfo/#a218bf4a49a8808ebb854ec9b89907904">tracksLiveness</a>() &amp;&amp; TRI-&gt;trackLivenessAfterRegAlloc(MF);</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UpdateLiveIns)</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">    MRI.invalidateLiveness();</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Recalculate EH scope membership.</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">  EHScopeMembership = <a href="/docs/api/namespaces/llvm/#afa141935f9c9a1ad9c785d7b6200b119">getEHScopeMembership</a>(MF);</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChangeThisIteration = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (MadeChangeThisIteration) &#123;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    MadeChangeThisIteration    = TailMergeBlocks(MF);</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// No need to clean up if tail merging does not change anything after the</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block placement.</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AfterBlockPlacement || MadeChangeThisIteration)</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">      MadeChangeThisIteration |= OptimizeBranches(MF);</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EnableHoistCommonCode)</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">      MadeChangeThisIteration |= HoistCommonCode(MF);</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">    MadeChange |= MadeChangeThisIteration;</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if any jump tables have become dead as the code generator</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// did its thing.</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinejumptableinfo">MachineJumpTableInfo</a> &#42;JTI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ad828deab7de3b5f4d03fac86e26adae9">getJumpTableInfo</a>();</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!JTI)</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walk the function to find jump tables that are live.</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/bitvector">BitVector</a> JTIsLive(JTI-&gt;<a href="/docs/api/classes/llvm/machinejumptableinfo/#af9c60f4a0193375a5dd205fb945107a8">getJumpTables</a>().size());</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;BB : MF) &#123;</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB)</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) &#123;</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.isJTI()) </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Remember that this JT is live.</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">        JTIsLive.<a href="/docs/api/classes/llvm/bitvector/#a62237ebe27691377a942abe7446332ec">set</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getIndex());</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Finally, remove dead jump tables.  This happens when the</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// indirect jump was unreachable (and thus deleted).</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = JTIsLive.<a href="/docs/api/classes/llvm/bitvector/#abf86e1383aec181a5a2d9967eb8070fd">size</a>(); i != e; ++i)</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!JTIsLive.<a href="/docs/api/classes/llvm/bitvector/#a15d63c566878e964c19139b2c76c0dab">test</a>(i)) &#123;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">      JTI-&gt;<a href="/docs/api/classes/llvm/machinejumptableinfo/#a4884f00bcde9528a64e1c18adc789641">RemoveJumpTable</a>(i);</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlightComment">//  Tail Merging of Blocks</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlightComment">/// HashMachineInstr - Compute a hash value for MI and its operands.</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256" lineLink="#a2a51f503d36986f1828aacccbf3e64b4"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a2a51f503d36986f1828aacccbf3e64b4">HashMachineInstr</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Hash = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode();</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getNumOperands(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(i);</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Merge in bits from the operand if easy. We can&#39;t use MachineOperand&#39;s</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// hash&#95;code here because it&#39;s not deterministic and we sort by hash value</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// later.</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OperandHash = 0;</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getType()) &#123;</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand/#af269b990800f72c7cf535c407e8e639ba99b874c6560305fd292d20f6a06da166">MachineOperand::MO&#95;Register</a>:</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">      OperandHash = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getReg();</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand/#af269b990800f72c7cf535c407e8e639ba066f84460d9f7b61d54b187555756ef6">MachineOperand::MO&#95;Immediate</a>:</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">      OperandHash = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getImm();</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand/#af269b990800f72c7cf535c407e8e639ba95566cb4525dab82db8cbbed3d634c23">MachineOperand::MO&#95;MachineBasicBlock</a>:</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">      OperandHash = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getMBB()-&gt;getNumber();</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand/#af269b990800f72c7cf535c407e8e639ba97561985119c4a774e3ec6439240fa80">MachineOperand::MO&#95;FrameIndex</a>:</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand/#af269b990800f72c7cf535c407e8e639ba0d4fd3b1a2d5d46d77b66d5a35783580">MachineOperand::MO&#95;ConstantPoolIndex</a>:</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand/#af269b990800f72c7cf535c407e8e639baa1741ad7465d81fb3020b84c390ee49d">MachineOperand::MO&#95;JumpTableIndex</a>:</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">      OperandHash = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getIndex();</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand/#af269b990800f72c7cf535c407e8e639ba3f1f6bfc5aa57cf388201bf6b8fee7d3">MachineOperand::MO&#95;GlobalAddress</a>:</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand/#af269b990800f72c7cf535c407e8e639ba9d22ed12eec3e14283ed6a3617d12119">MachineOperand::MO&#95;ExternalSymbol</a>:</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Global address / external symbol are too hard, don&#39;t bother, but do</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// pull in the offset.</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">      OperandHash = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getOffset();</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">    Hash += ((OperandHash &lt;&lt; 3) | <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>.getType()) &lt;&lt; (i &amp; 31);</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Hash;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlightComment">/// HashEndOfMBB - Hash the last instruction in the MBB.</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296" lineLink="#adef2c46c3161a62af20d7f993a287a98"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#adef2c46c3161a62af20d7f993a287a98">HashEndOfMBB</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#a199a6e4bfdffc8f3379ef4f35004488f">MachineBasicBlock::const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getLastNonDebugInstr(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.end())</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a2a51f503d36986f1828aacccbf3e64b4">HashMachineInstr</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlightComment">/// Whether MI should be counted as an instruction when calculating common tail.</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305" lineLink="#a32ade962ece3d632aadbbb4a90eb8d37"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a32ade962ece3d632aadbbb4a90eb8d37">countsAsInstruction</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>) &#123;</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugInstr() || <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isCFIInstruction());</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlightComment">/// Iterate backwards from the given iterator \\p I, towards the beginning of the</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlightComment">/// block. If a MI satisfying &#39;countsAsInstruction&#39; is found, return an iterator</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlightComment">/// pointing to that MI. If no such MI is found, return the end iterator.</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a></span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313" lineLink="#a4b4e292651fcfd1d800e5292dfb6122c"><span class="doxyHighlight"><a href="#a4b4e292651fcfd1d800e5292dfb6122c">skipBackwardPastNonInstructions</a>(<a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;begin()) &#123;</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">    --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a32ade962ece3d632aadbbb4a90eb8d37">countsAsInstruction</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;end();</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlightComment">/// Given two machine basic blocks, return the number of instructions they</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlightComment">/// actually have in common together at their end. If a common tail is found (at</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlightComment">/// least by one instruction), then iterators for the first shared instruction</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlightComment">/// in each block are returned as well.</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlightComment">/// Non-instructions according to countsAsInstruction are ignored.</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329" lineLink="#a0ff8a27be1a6683026280a4611628562"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a0ff8a27be1a6683026280a4611628562">ComputeCommonTailLength</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MBB1,</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MBB2,</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp;I1,</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp;I2) &#123;</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> MBBI1 = MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>();</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> MBBI2 = MBB2-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>();</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TailLen = 0;</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">    MBBI1 = <a href="#a4b4e292651fcfd1d800e5292dfb6122c">skipBackwardPastNonInstructions</a>(MBBI1, MBB1);</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">    MBBI2 = <a href="#a4b4e292651fcfd1d800e5292dfb6122c">skipBackwardPastNonInstructions</a>(MBBI2, MBB2);</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MBBI1 == MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>() || MBBI2 == MBB2-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>())</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MBBI1-&gt;isIdenticalTo(&#42;MBBI2) ||</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// FIXME: This check is dubious. It&#39;s used to get around a problem where</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// people incorrectly expect inline asm directives to remain in the same</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// relative order. This is untenable because normal compiler</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// optimizations (like this one) may reorder and/or merge these</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// directives.</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">        MBBI1-&gt;isInlineAsm()) &#123;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MBBI1-&gt;getFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4a1592bf2f68ec050798e3aeb6a7b095">MachineInstr::NoMerge</a>) ||</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">        MBBI2-&gt;getFlag(<a href="/docs/api/classes/llvm/machineinstr/#aafacf84de1cb994a92dc045f4aa1d518a4a1592bf2f68ec050798e3aeb6a7b095">MachineInstr::NoMerge</a>))</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">    ++TailLen;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">    I1 = MBBI1;</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">    I2 = MBBI2;</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> TailLen;</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> BranchFolder::replaceTailWithBranchTo(<a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> OldInst,</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;NewDest) &#123;</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UpdateLiveIns) &#123;</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// OldInst should always point to an instruction.</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">    MachineBasicBlock &amp;OldMBB = &#42;OldInst-&gt;getParent();</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">    LiveRegs.clear();</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">    LiveRegs.addLiveOuts(OldMBB);</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Move backward to the place where will insert the jump.</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = OldMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>();</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">      --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">      LiveRegs.stepBackward(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != OldInst);</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Merging the tails may have switched some undef operand to non-undef ones.</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add IMPLICIT&#95;DEFS into OldMBB as necessary to have a definition of the</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// register.</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MachineBasicBlock::RegisterMaskPair <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : NewDest.<a href="/docs/api/classes/llvm/machinebasicblock/#a364ed6e68f92f797c0cd9e53ce5ea2a5">liveins</a>()) &#123;</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We computed the liveins with computeLiveIn earlier and should only see</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// full registers:</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.LaneMask == <a href="/docs/api/structs/llvm/lanebitmask/#a3714a639930eab71d7202da05ad82990">LaneBitmask::getAll</a>() &amp;&amp;</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Can only handle full register.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">      MCRegister <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.PhysReg;</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LiveRegs.available(&#42;MRI, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>))</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(OldMBB, OldInst, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TII-&gt;get(TargetOpcode::IMPLICIT&#95;DEF), <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>);</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  TII-&gt;ReplaceTailWithBranchTo(OldInst, &amp;NewDest);</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">  ++NumTailMerge;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BranchFolder::SplitMBBAt(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;CurMBB,</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> BBI1,</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">                                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TII-&gt;isLegalToSplitMBBAt(CurMBB, BBI1))</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">  MachineFunction &amp;MF = &#42;CurMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#acf6442108e21e7e5379feb8962de65b7">getParent</a>();</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the fall-through block.</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = CurMBB.<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">  MachineBasicBlock &#42;NewMBB = MF.<a href="/docs/api/classes/llvm/machinefunction/#adfc62ee16549afaac5bde30156ddc989">CreateMachineBasicBlock</a>(BB);</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">  CurMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#acf6442108e21e7e5379feb8962de65b7">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/machinefunction/#af4c0db6d503e0ba3b8e44067023ffbba">insert</a>(++<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>, NewMBB);</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Move all the successors of this block to the specified block.</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">  NewMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a31e57b158a17c459f0dc34b0e602ecc6">transferSuccessors</a>(&amp;CurMBB);</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add an edge from CurMBB to NewMBB for the fall-through.</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">  CurMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a935e2a8884592189d8f261634a0b24c5">addSuccessor</a>(NewMBB);</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Splice the code over.</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  NewMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adf0023bdc4f05a7849c35b1c859580d8">splice</a>(NewMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>(), &amp;CurMBB, BBI1, CurMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>());</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NewMBB belongs to the same loop as CurMBB.</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MLI)</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MachineLoop &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3ad01fd9b01e9dde8bd3dc247afbfb7218">ML</a> = MLI-&gt;getLoopFor(&amp;CurMBB))</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3ad01fd9b01e9dde8bd3dc247afbfb7218">ML</a>-&gt;addBasicBlockToLoop(NewMBB, &#42;MLI);</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NewMBB inherits CurMBB&#39;s block frequency.</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">  MBBFreqInfo.setBlockFreq(NewMBB, MBBFreqInfo.getBlockFreq(&amp;CurMBB));</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UpdateLiveIns)</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#acef857f72308ae9602dcf37ff032bc2f">computeAndAddLiveIns</a>(LiveRegs, &#42;NewMBB);</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add the new block to the EH scope.</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;EHScopeI = EHScopeMembership.find(&amp;CurMBB);</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EHScopeI != EHScopeMembership.end()) &#123;</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> n = EHScopeI-&gt;second;</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">    EHScopeMembership&#91;NewMBB&#93; = n;</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewMBB;</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlightComment">/// EstimateRuntime - Make a rough estimate for how long it will take to run</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlightComment">/// the specified code.</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441" lineLink="#a0df528512b8aed2e9f70a3f9b3128507"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a0df528512b8aed2e9f70a3f9b3128507">EstimateRuntime</a>(<a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>) &#123;</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Time = 0;</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a32ade962ece3d632aadbbb4a90eb8d37">countsAsInstruction</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isCall())</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">      Time += 10;</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayLoadOrStore())</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">      Time += 2;</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">      ++Time;</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Time;</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlightComment">// CurMBB needs to add an unconditional branch to SuccMBB (we removed these</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlightComment">// branches temporarily for tail merging).  In the case where CurMBB ends</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlightComment">// with a conditional branch to the next block, optimize by reversing the</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlightComment">// test and conditionally branching to SuccMBB instead.</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461" lineLink="#abbe6276e99bb565156d18a843ae1ccb9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#abbe6276e99bb565156d18a843ae1ccb9">FixTail</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;CurMBB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccBB,</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;BranchDL) &#123;</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &#42;MF = CurMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acf6442108e21e7e5379feb8962de65b7">getParent</a>();</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = std::next(<a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a>(CurMBB));</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;FBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineOperand, 4&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>;</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> dl = CurMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad81901d0d8b768b240e78bf357999f34">findBranchDebugLoc</a>();</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!dl)</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">    dl = BranchDL;</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != MF-&gt;<a href="/docs/api/classes/llvm/machinefunction/#a9d017af749f76484cb9aec9ff6e4330c">end</a>() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;analyzeBranch(&#42;CurMBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;NextBB = &amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> == NextBB &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.empty() &amp;&amp; !FBB) &#123;</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;reverseBranchCondition(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;removeBranch(&#42;CurMBB);</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;insertBranch(&#42;CurMBB, SuccBB, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, dl);</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;insertBranch(&#42;CurMBB, SuccBB, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineOperand, 0&gt;</a>(), dl);</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">BranchFolder::MergePotentialsElt::operator&lt;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> MergePotentialsElt &amp;o)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (getHash() &lt; <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead95679752134a2d9eb61dbd7b91c4bcc">o</a>.getHash())</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (getHash() &gt; <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead95679752134a2d9eb61dbd7b91c4bcc">o</a>.getHash())</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (getBlock()-&gt;getNumber() &lt; <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead95679752134a2d9eb61dbd7b91c4bcc">o</a>.getBlock()-&gt;getNumber())</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (getBlock()-&gt;getNumber() &gt; <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead95679752134a2d9eb61dbd7b91c4bcc">o</a>.getBlock()-&gt;getNumber())</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlightComment">/// CountTerminators - Count the number of terminators in the given</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlightComment">/// block and set I to the position of the first non-terminator, if there</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlightComment">/// is one, or MBB-&gt;end() otherwise.</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500" lineLink="#a3a41d2e125b5d09248ee68674761fb14"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#a3a41d2e125b5d09248ee68674761fb14">CountTerminators</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;end();</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumTerms = 0;</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;begin()) &#123;</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;end();</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">    --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator()) </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">    ++NumTerms;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NumTerms;</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlightComment">/// A no successor, non-return block probably ends in unreachable and is cold.</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlightComment">/// Also consider a block that ends in an indirect branch to be a return block,</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlightComment">/// since many targets use plain indirect branches to return.</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519" lineLink="#a3c776f3a438cc58490cf4af1ea63fac3"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a3c776f3a438cc58490cf4af1ea63fac3">blockEndsInUnreachable</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;succ&#95;empty())</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;empty())</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;back().isReturn() || <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;back().isIndirectBranch());</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlightComment">/// ProfitableToMerge - Check if two machine basic blocks have a common tail</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlightComment">/// and decide if it would be profitable to merge those tails.  Return the</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlightComment">/// length of the common tail and iterators to the first common instruction</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlightComment">/// in each block.</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlightComment">/// MBB1, MBB2      The blocks to check</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlightComment">/// MinCommonTailLength  Minimum size of tail block to be merged.</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlightComment">/// CommonTailLen   Out parameter to record the size of the shared tail between</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlightComment">///                 MBB1 and MBB2</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlightComment">/// I1, I2          Iterator references that will be changed to point to the first</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlightComment">///                 instruction in the common tail shared by MBB1,MBB2</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlightComment">/// SuccBB          A common successor of MBB1, MBB2 which are in a canonical form</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlightComment">///                 relative to SuccBB</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlightComment">/// PredBB          The layout predecessor of SuccBB, if any.</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlightComment">/// EHScopeMembership  map from block to EH scope #.</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlightComment">/// AfterPlacement  True if we are merging blocks after layout. Stricter</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlightComment">///                 thresholds apply to prevent undoing tail-duplication.</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544" lineLink="#a905140abedaee343fc7ef33707052792"><span class="doxyHighlight"><a href="#a905140abedaee343fc7ef33707052792">ProfitableToMerge</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MBB1, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MBB2,</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MinCommonTailLength, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;CommonTailLen,</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp;I1,</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> &amp;I2, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccBB,</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;PredBB,</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MachineBasicBlock &#42;, int&gt;</a> &amp;EHScopeMembership,</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AfterPlacement,</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/mbfiwrapper">MBFIWrapper</a> &amp;MBBFreqInfo,</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI) &#123;</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is never profitable to tail-merge blocks from two different EH scopes.</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EHScopeMembership.<a href="/docs/api/classes/llvm/densemapbase/#a49c487a9395a6c384be8544cfb2cfccf">empty</a>()) &#123;</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EHScope1 = EHScopeMembership.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(MBB1);</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EHScope1 != EHScopeMembership.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>());</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EHScope2 = EHScopeMembership.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(MBB2);</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EHScope2 != EHScopeMembership.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>());</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EHScope1-&gt;second != EHScope2-&gt;second)</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">  CommonTailLen = <a href="#a0ff8a27be1a6683026280a4611628562">ComputeCommonTailLength</a>(MBB1, MBB2, I1, I2);</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CommonTailLen == 0)</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Common tail length of &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;MBB1)</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; and &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;MBB2) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; is &quot;</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">                    &lt;&lt; CommonTailLen &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Move the iterators to the beginning of the MBB if we only got debug</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions before the tail. This is to avoid splitting a block when we</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// only got debug instructions before the tail (to be invariant on -g).</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a5bacbbd03e9261f7b30dc174f26d680c">skipDebugInstructionsForward</a>(MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>(), </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">) == I1)</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">    I1 = MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a5bacbbd03e9261f7b30dc174f26d680c">skipDebugInstructionsForward</a>(MBB2-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), MBB2-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>(), </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">) == I2)</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">    I2 = MBB2-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FullBlockTail1 = I1 == MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FullBlockTail2 = I2 == MBB2-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It&#39;s almost always profitable to merge any number of non-terminator</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions with the block that falls through into the common successor.</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is true only for a single successor. For multiple successors, we are</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// trading a conditional branch for an unconditional one.</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Re-visit successor size for non-layout tail merging.</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((MBB1 == PredBB || MBB2 == PredBB) &amp;&amp;</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">      (!AfterPlacement || MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>() == 1)) &#123;</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumTerms = <a href="#a3a41d2e125b5d09248ee68674761fb14">CountTerminators</a>(MBB1 == PredBB ? MBB2 : MBB1, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CommonTailLen &gt; NumTerms)</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If these are identical non-return blocks with no successors, merge them.</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Such blocks are typically cold calls to noreturn functions like abort, and</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are unlikely to become a fallthrough target after machine block placement.</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Tail merging these blocks is unlikely to create additional unconditional</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branches, and will reduce the size of this cold code.</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FullBlockTail1 &amp;&amp; FullBlockTail2 &amp;&amp;</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">      <a href="#a3c776f3a438cc58490cf4af1ea63fac3">blockEndsInUnreachable</a>(MBB1) &amp;&amp; <a href="#a3c776f3a438cc58490cf4af1ea63fac3">blockEndsInUnreachable</a>(MBB2))</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If one of the blocks can be completely merged and happens to be in</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a position where the other could fall through into it, merge any number</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of instructions, because it can be done without a branch.</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: If the blocks are not adjacent, move one of them so that they are?</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#abd85c9d7c51eb515a550069e9ad9445e">isLayoutSuccessor</a>(MBB2) &amp;&amp; FullBlockTail2)</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MBB2-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#abd85c9d7c51eb515a550069e9ad9445e">isLayoutSuccessor</a>(MBB1) &amp;&amp; FullBlockTail1)</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If both blocks are identical and end in a branch, merge them unless they</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// both have a fallthrough predecessor and successor.</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can only do this after block placement because it depends on whether</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// there are fallthroughs, and we don&#39;t know until after layout.</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AfterPlacement &amp;&amp; FullBlockTail1 &amp;&amp; FullBlockTail2) &#123;</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BothFallThrough = &#91;&#93;(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;succ&#95;empty() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;canFallThrough())</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &#42;MF = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getParent();</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> != &amp;&#42;MF-&gt;<a href="/docs/api/classes/llvm/machinefunction/#ab0789854909cf47f640a85fa2bac29c7">begin</a>()) &amp;&amp; std::prev(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;canFallThrough();</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BothFallThrough(MBB1) || !BothFallThrough(MBB2))</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If both blocks have an unconditional branch temporarily stripped out,</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// count that as an additional common instruction for the following</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// heuristics. This heuristic is only accurate for single-succ blocks, so to</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// make sure that during layout merging and duplicating don&#39;t crash, we check</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for that when merging during layout.</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EffectiveTailLen = CommonTailLen;</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccBB &amp;&amp; MBB1 != PredBB &amp;&amp; MBB2 != PredBB &amp;&amp;</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">      (MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>() == 1 || !AfterPlacement) &amp;&amp;</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">      !MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acf35424231192c6b4a3e22d711f50b1e">back</a>().<a href="/docs/api/classes/llvm/machineinstr/#a2dbc79cfed570a9127d2853385162bdf">isBarrier</a>() &amp;&amp;</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">      !MBB2-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acf35424231192c6b4a3e22d711f50b1e">back</a>().<a href="/docs/api/classes/llvm/machineinstr/#a2dbc79cfed570a9127d2853385162bdf">isBarrier</a>())</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">    ++EffectiveTailLen;</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if the common tail is long enough to be worthwhile.</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EffectiveTailLen &gt;= MinCommonTailLength)</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are optimizing for code size, 2 instructions in common is enough if</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we don&#39;t have to split a block.  At worst we will be introducing 1 new</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branch instruction, which is likely to be smaller than the 2</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions that would be deleted in the merge.</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> OptForSize = <a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(MBB1, PSI, &amp;MBBFreqInfo) &amp;&amp;</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">                    <a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(MBB2, PSI, &amp;MBBFreqInfo);</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EffectiveTailLen &gt;= 2 &amp;&amp; OptForSize &amp;&amp;</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">         (FullBlockTail1 || FullBlockTail2);</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BranchFolder::ComputeSameTails(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CurHash,</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MinCommonTailLength,</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">                                        MachineBasicBlock &#42;SuccBB,</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">                                        MachineBasicBlock &#42;PredBB) &#123;</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> maxCommonTailLength = 0<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>;</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">  SameTails.clear();</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> TrialBBI1, TrialBBI2;</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">  MPIterator HighestMPIter = std::prev(MergePotentials.end());</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MPIterator CurMPIter = std::prev(MergePotentials.end()),</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">                  <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = MergePotentials.begin();</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">       CurMPIter != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> &amp;&amp; CurMPIter-&gt;getHash() == CurHash; --CurMPIter) &#123;</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MPIterator <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = std::prev(CurMPIter); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getHash() == CurHash; --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CommonTailLen;</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a905140abedaee343fc7ef33707052792">ProfitableToMerge</a>(CurMPIter-&gt;getBlock(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getBlock(),</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">                            MinCommonTailLength,</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">                            CommonTailLen, TrialBBI1, TrialBBI2,</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">                            SuccBB, PredBB,</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">                            EHScopeMembership,</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">                            AfterBlockPlacement, MBBFreqInfo, PSI)) &#123;</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CommonTailLen &gt; maxCommonTailLength) &#123;</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">          SameTails.clear();</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">          maxCommonTailLength = CommonTailLen;</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">          HighestMPIter = CurMPIter;</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">          SameTails.push&#95;back(SameTailElt(CurMPIter, TrialBBI1));</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HighestMPIter == CurMPIter &amp;&amp;</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">            CommonTailLen == maxCommonTailLength)</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">          SameTails.push&#95;back(SameTailElt(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, TrialBBI2));</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> maxCommonTailLength;</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> BranchFolder::RemoveBlocksWithHash(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CurHash,</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">                                        MachineBasicBlock &#42;SuccBB,</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">                                        MachineBasicBlock &#42;PredBB,</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> &amp;BranchDL) &#123;</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">  MPIterator CurMPIter, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>;</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (CurMPIter = std::prev(MergePotentials.end()),</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = MergePotentials.begin();</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">       CurMPIter-&gt;getHash() == CurHash; --CurMPIter) &#123;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Put the unconditional branch back, if we need one.</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">    MachineBasicBlock &#42;CurMBB = CurMPIter-&gt;getBlock();</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccBB &amp;&amp; CurMBB != PredBB)</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">      <a href="#abbe6276e99bb565156d18a843ae1ccb9">FixTail</a>(CurMBB, SuccBB, TII, BranchDL);</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurMPIter == <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurMPIter-&gt;getHash() != CurHash)</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">    CurMPIter++;</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">  MergePotentials.erase(CurMPIter, MergePotentials.end());</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BranchFolder::CreateCommonTailOnlyBlock(MachineBasicBlock &#42;&amp;PredBB,</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">                                             MachineBasicBlock &#42;SuccBB,</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">                                             </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> maxCommonTailLength,</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">                                             </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;commonTailIndex) &#123;</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">  commonTailIndex = 0;</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TimeEstimate = ~0<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>;</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = SameTails.size(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Use PredBB if possible; that doesn&#39;t require a new branch.</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SameTails&#91;i&#93;.getBlock() == PredBB) &#123;</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">      commonTailIndex = i;</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, make a (fairly bogus) choice based on estimate of</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// how long it will take the various blocks to execute.</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> t = <a href="#a0df528512b8aed2e9f70a3f9b3128507">EstimateRuntime</a>(SameTails&#91;i&#93;.getBlock()-&gt;<a href="/docs/api/namespaces/llvm/sandboxir/#a2fdb10193ae65fe59b4d8df288044864">begin</a>(),</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">                                 SameTails&#91;i&#93;.getTailStartPos());</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (t &lt;= TimeEstimate) &#123;</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">      TimeEstimate = t;</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">      commonTailIndex = i;</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> BBI =</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">    SameTails&#91;commonTailIndex&#93;.getTailStartPos();</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">  MachineBasicBlock &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = SameTails&#91;commonTailIndex&#93;.getBlock();</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nSplitting &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, size &quot;</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">                    &lt;&lt; maxCommonTailLength);</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the split block unconditionally falls-thru to SuccBB, it will be</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// merged. In control flow terms it should then take SuccBB&#39;s name. e.g. If</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SuccBB is an inner loop, the common tail is still part of the inner loop.</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;BB = (SuccBB &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>() == 1) ?</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">    SuccBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a4874816314c3308be0bf1e71de2078d8">getBasicBlock</a>() : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a4874816314c3308be0bf1e71de2078d8">getBasicBlock</a>();</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">  MachineBasicBlock &#42;newMBB = SplitMBBAt(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, BBI, BB);</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!newMBB) &#123;</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;... failed!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">  SameTails&#91;commonTailIndex&#93;.setBlock(newMBB);</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">  SameTails&#91;commonTailIndex&#93;.setTailStartPos(newMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>());</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we split PredBB, newMBB is the new predecessor.</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBB == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">    PredBB = newMBB;</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761" lineLink="#ae7773e6945ecc33b1e3ab0d47f293665"><span class="doxyHighlight"><a href="#ae7773e6945ecc33b1e3ab0d47f293665">mergeOperations</a>(<a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> MBBIStartPos,</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;MBBCommon) &#123;</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = MBBIStartPos-&gt;getParent();</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note CommonTailLen does not necessarily matches the size of</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the common BB nor all its instructions because of debug</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions differences.</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CommonTailLen = 0;</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;end(); MBBIStartPos != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++MBBIStartPos)</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">    ++CommonTailLen;</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#abada92f8cd2854d2b747f14c4a7be0ed">MachineBasicBlock::reverse&#95;iterator</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;rbegin();</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#abada92f8cd2854d2b747f14c4a7be0ed">MachineBasicBlock::reverse&#95;iterator</a> MBBIE = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;rend();</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#abada92f8cd2854d2b747f14c4a7be0ed">MachineBasicBlock::reverse&#95;iterator</a> MBBICommon = MBBCommon.<a href="/docs/api/classes/llvm/machinebasicblock/#ad8c9657cfb03ef2ebf6364ba9d68c127">rbegin</a>();</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#abada92f8cd2854d2b747f14c4a7be0ed">MachineBasicBlock::reverse&#95;iterator</a> MBBIECommon = MBBCommon.<a href="/docs/api/classes/llvm/machinebasicblock/#a2a25c462b91ac5da41f4ab7edc32b650">rend</a>();</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (CommonTailLen--) &#123;</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a> != MBBIE &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Reached BB end within common tail length!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">    (void)MBBIE;</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a32ade962ece3d632aadbbb4a90eb8d37">countsAsInstruction</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>)) &#123;</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">      ++<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> ((MBBICommon != MBBIECommon) &amp;&amp; !<a href="#a32ade962ece3d632aadbbb4a90eb8d37">countsAsInstruction</a>(&#42;MBBICommon))</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">      ++MBBICommon;</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MBBICommon != MBBIECommon &amp;&amp;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Reached BB end within common tail length!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MBBICommon-&gt;isIdenticalTo(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected matching MIIs!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Merge MMOs from memory operations in the common block.</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MBBICommon-&gt;mayLoadOrStore())</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">      MBBICommon-&gt;cloneMergedMemRefs(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getParent(), &#123;&amp;&#42;MBBICommon, &amp;&#42;MBBI&#125;);</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Drop undef flags if they aren&#39;t present in all merged instructions.</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = MBBICommon-&gt;getNumOperands(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO = MBBICommon-&gt;getOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.<a href="/docs/api/classes/llvm/machineoperand/#a4c9594c955fec80c73ddd964b5efd554">isReg</a>() &amp;&amp; MO.<a href="/docs/api/classes/llvm/machineoperand/#a1255befbcd6e034394681b1bcd3529ff">isUndef</a>()) &#123;</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;OtherMO = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>-&gt;getOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OtherMO.<a href="/docs/api/classes/llvm/machineoperand/#a1255befbcd6e034394681b1bcd3529ff">isUndef</a>())</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">          MO.<a href="/docs/api/classes/llvm/machineoperand/#ab979122f21b7fa46d3d2d9b21983068b">setIsUndef</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">    ++<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad5f691fdc1a09aaf6df5fef958b35a3d">MBBI</a>;</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">    ++MBBICommon;</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> BranchFolder::mergeCommonTails(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> commonTailIndex) &#123;</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">  MachineBasicBlock &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = SameTails&#91;commonTailIndex&#93;.getBlock();</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">  std::vector&lt;MachineBasicBlock::iterator&gt; NextCommonInsts(SameTails.size());</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = 0 ; i != SameTails.size() ; ++i) &#123;</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (i != commonTailIndex) &#123;</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">      NextCommonInsts&#91;i&#93; = SameTails&#91;i&#93;.getTailStartPos();</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">      <a href="#ae7773e6945ecc33b1e3ab0d47f293665">mergeOperations</a>(SameTails&#91;i&#93;.getTailStartPos(), &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SameTails&#91;i&#93;.getTailStartPos() == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>() &amp;&amp;</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;MBB is not a common tail only block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a32ade962ece3d632aadbbb4a90eb8d37">countsAsInstruction</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>))</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getDebugLoc();</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = 0 ; i &lt; NextCommonInsts.size() ; i++) &#123;</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (i == commonTailIndex)</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pos = NextCommonInsts&#91;i&#93;;</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Pos != SameTails&#91;i&#93;.getBlock()-&gt;<a href="/docs/api/namespaces/llvm/sandboxir/#a64ac61287490361f2183faf1d7639ee9">end</a>() &amp;&amp;</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Reached BB end within common tail&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!<a href="#a32ade962ece3d632aadbbb4a90eb8d37">countsAsInstruction</a>(&#42;Pos)) &#123;</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">        ++Pos;</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Pos != SameTails&#91;i&#93;.getBlock()-&gt;<a href="/docs/api/namespaces/llvm/sandboxir/#a64ac61287490361f2183faf1d7639ee9">end</a>() &amp;&amp;</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">            </span><span class="doxyHighlightStringLiteral">&quot;Reached BB end within common tail&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isIdenticalTo(&#42;Pos) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected matching MIIs!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/classes/llvm/dilocation/#a78cc51c415c7e64b5efe2c8458fbd35a">DILocation::getMergedLocation</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, Pos-&gt;getDebugLoc());</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">      NextCommonInsts&#91;i&#93; = ++Pos;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.setDebugLoc(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UpdateLiveIns) &#123;</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">    LivePhysRegs NewLiveIns(&#42;TRI);</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#adf741b422c5f449eb83144c3c2fe9730">computeLiveIns</a>(NewLiveIns, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">    LiveRegs.init(&#42;TRI);</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The flag merging may lead to some register uses no longer using the</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &lt;undef&gt; flag, add IMPLICIT&#95;DEFs in the predecessors as necessary.</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MachineBasicBlock &#42;Pred : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">      LiveRegs.clear();</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">      LiveRegs.addLiveOuts(&#42;Pred);</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> InsertBefore = Pred-&gt;getFirstTerminator();</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> : NewLiveIns) &#123;</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LiveRegs.available(&#42;MRI, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>))</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Skip the register if we are about to add one of its super registers.</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// TODO: Common this up with the same logic in addLineIns().</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(TRI-&gt;superregs(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>), &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#aad72cfbb210808985a9dc19f4e5d8542">MCPhysReg</a> SReg) &#123;</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">              return NewLiveIns.contains(SReg) &amp;&amp; !MRI-&gt;isReserved(SReg);</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">            &#125;))</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>;</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;Pred, InsertBefore, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, TII-&gt;get(TargetOpcode::IMPLICIT&#95;DEF),</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">                <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>);</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a7c9de323398db302bf33de488a780467">clearLiveIns</a>();</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#af9a1ca470b2b9c8e97304f5be5448422">addLiveIns</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, NewLiveIns);</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlightComment">// See if any of the blocks in MergePotentials (which all have SuccBB as a</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlightComment">// successor, or all have no successor if it is null) can be tail-merged.</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlightComment">// If there is a successor, any blocks in MergePotentials that are not</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlightComment">// tail-merged and are not immediately before Succ must have an unconditional</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlightComment">// branch to Succ added (but the predecessor/successor lists need no</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlightComment">// adjustment). The lone predecessor of Succ that falls through into Succ,</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlightComment">// if any, is given in PredBB.</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlightComment">// MinCommonTailLength - Except for the special cases below, tail-merge if</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlightComment">// there are at least this many instructions in common.</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BranchFolder::TryTailMergeBlocks(MachineBasicBlock &#42;SuccBB,</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">                                      MachineBasicBlock &#42;PredBB,</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MinCommonTailLength) &#123;</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nTryTailMergeBlocks: &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = MergePotentials.size(); i != e; ++i)</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;MergePotentials&#91;i&#93;.getBlock())</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">             &lt;&lt; (i == <a href="/docs/api/namespaces/llvm/numbers/#a92f4283d4e0e2ea1776894b3ae93640f">e</a> - 1 ? </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;, &quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccBB) &#123;</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  with successor &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;SuccBB) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBB)</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  which has fall-through from &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;PredBB)</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Looking for common tails of at least &quot;</span><span class="doxyHighlight"> &lt;&lt; MinCommonTailLength</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; instruction&quot;</span><span class="doxyHighlight"> &lt;&lt; (MinCommonTailLength == 1 ? </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;s&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sort by hash value so that blocks with identical end sequences sort</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// together.</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#add1eb5637dd671428b6f138ed3db6428">array&#95;pod&#95;sort</a>(MergePotentials.begin(), MergePotentials.end());</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walk through equivalence sets looking for actual exact matches.</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (MergePotentials.size() &gt; 1) &#123;</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CurHash = MergePotentials.back().getHash();</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> &amp;BranchDL = MergePotentials.back().getBranchDebugLoc();</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Build SameTails, identifying the set of blocks with this hash code</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and with the maximum number of instructions in common.</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> maxCommonTailLength = ComputeSameTails(CurHash,</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">                                                    MinCommonTailLength,</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">                                                    SuccBB, PredBB);</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we didn&#39;t find any pair that has at least MinCommonTailLength</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions in common, remove all blocks with this hash code and retry.</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SameTails.empty()) &#123;</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">      RemoveBlocksWithHash(CurHash, SuccBB, PredBB, BranchDL);</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If one of the blocks is the entire common tail (and is not the entry</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block/an EH pad, which we can&#39;t jump to), we can treat all blocks with</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this same tail at once.  Use PredBB if that is one of the possibilities,</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as that will not introduce any extra branches.</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">    MachineBasicBlock &#42;EntryBB =</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">        &amp;MergePotentials.front().getBlock()-&gt;getParent()-&gt;front();</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> commonTailIndex = SameTails.size();</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are two blocks, check to see if one can be made to fall through</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// into the other.</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SameTails.size() == 2 &amp;&amp;</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">        SameTails&#91;0&#93;.getBlock()-&gt;isLayoutSuccessor(SameTails&#91;1&#93;.getBlock()) &amp;&amp;</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">        SameTails&#91;1&#93;.tailIsWholeBlock() &amp;&amp; !SameTails&#91;1&#93;.getBlock()-&gt;isEHPad())</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">      commonTailIndex = 1;</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SameTails.size() == 2 &amp;&amp;</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">             SameTails&#91;1&#93;.getBlock()-&gt;isLayoutSuccessor(</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">                 SameTails&#91;0&#93;.getBlock()) &amp;&amp;</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">             SameTails&#91;0&#93;.tailIsWholeBlock() &amp;&amp;</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">             !SameTails&#91;0&#93;.getBlock()-&gt;isEHPad())</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">      commonTailIndex = 0;</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Otherwise just pick one, favoring the fall-through predecessor if</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// there is one.</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = SameTails.size(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">        MachineBasicBlock &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = SameTails&#91;i&#93;.getBlock();</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> == EntryBB || <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a1100bfbadd996d464150c6a68fa8dc1d">isEHPad</a>()) &amp;&amp;</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">            SameTails&#91;i&#93;.tailIsWholeBlock())</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> == PredBB) &#123;</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">          commonTailIndex = i;</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SameTails&#91;i&#93;.tailIsWholeBlock())</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">          commonTailIndex = i;</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (commonTailIndex == SameTails.size() ||</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">        (SameTails&#91;commonTailIndex&#93;.getBlock() == PredBB &amp;&amp;</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">         !SameTails&#91;commonTailIndex&#93;.tailIsWholeBlock())) &#123;</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// None of the blocks consist entirely of the common tail.</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Split a block so that one does.</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CreateCommonTailOnlyBlock(PredBB, SuccBB,</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">                                     maxCommonTailLength, commonTailIndex)) &#123;</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">        RemoveBlocksWithHash(CurHash, SuccBB, PredBB, BranchDL);</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">    MachineBasicBlock &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = SameTails&#91;commonTailIndex&#93;.getBlock();</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Recompute common tail MBB&#39;s edge weights and block frequency.</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">    setCommonTailEdgeWeights(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Merge debug locations, MMOs and undef flags across identical instructions</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for common tail.</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">    mergeCommonTails(commonTailIndex);</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// MBB is common tail.  Adjust all other BB&#39;s to jump to this one.</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Traversal must be forwards so erases work.</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nUsing common tail in &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for &quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i=0, e = SameTails.size(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (commonTailIndex == i)</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;SameTails&#91;i&#93;.getBlock())</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">                        &lt;&lt; (i == e - 1 ? </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;, &quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Hack the end off BB i, making it jump to BB commonTailIndex instead.</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">      replaceTailWithBranchTo(SameTails&#91;i&#93;.getTailStartPos(), &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// BB i is no longer a predecessor of SuccBB; remove it from the worklist.</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">      MergePotentials.erase(SameTails&#91;i&#93;.getMPIter());</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We leave commonTailIndex in the worklist in case there are other blocks</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that match it with a smaller number of instructions.</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">    MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BranchFolder::TailMergeBlocks(MachineFunction &amp;MF) &#123;</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EnableTailMerge)</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First find blocks with no successors.</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Block placement may create new tail merging opportunities for these blocks.</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">  MergePotentials.clear();</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MachineBasicBlock &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : MF) &#123;</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MergePotentials.size() == <a href="#a63debb3136d590391f5f3765095afa5c">TailMergeThreshold</a>)</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TriedMerging.count(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#aa8d1d8d88835b75b05b14ab774785e8a">succ&#95;empty</a>())</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">      MergePotentials.push&#95;back(MergePotentialsElt(<a href="#adef2c46c3161a62af20d7f993a287a98">HashEndOfMBB</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>), &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">                                                   <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#ad81901d0d8b768b240e78bf357999f34">findBranchDebugLoc</a>()));</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is a large problem, avoid visiting the same basic blocks</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// multiple times.</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MergePotentials.size() == <a href="#a63debb3136d590391f5f3765095afa5c">TailMergeThreshold</a>)</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> MergePotentialsElt &amp;Elt : MergePotentials)</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">      TriedMerging.insert(Elt.getBlock());</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if we can do any tail merging on those.</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MergePotentials.size() &gt;= 2)</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">    MadeChange |= TryTailMergeBlocks(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, MinCommonTailLength);</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look at blocks (IBB) with multiple predecessors (PBB).</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We change each predecessor to a canonical form, by</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (1) temporarily removing any unconditional branch from the predecessor</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to IBB, and</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (2) alter conditional branches so they branch to the other block</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// not IBB; this may require adding back an unconditional branch to IBB</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// later, where there wasn&#39;t one coming in.  E.g.</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   Bcc IBB</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   fallthrough to QBB</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// here becomes</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   Bncc QBB</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with a conceptual B to IBB after that, which never actually exists.</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// With those changes, we see whether the predecessors&#39; tails match,</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and merge them if so.  We change things out of canonical form and</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// back to the way they were later in the process.  (OptimizeBranches</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// would undo some of this, but we can&#39;t use it, because we&#39;d get into</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a compile-time infinite loop repeatedly doing and undoing the same</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// transformations.)</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = std::next(MF.begin()), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = MF.end();</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">       <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;pred&#95;size() &lt; 2) </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">    SmallPtrSet&lt;MachineBasicBlock &#42;, 8&gt; UniquePreds;</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">    MachineBasicBlock &#42;IBB = &amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">    MachineBasicBlock &#42;PredBB = &amp;&#42;std::prev(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">    MergePotentials.clear();</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">    MachineLoop &#42;<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3ad01fd9b01e9dde8bd3dc247afbfb7218">ML</a>;</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Bail if merging after placement and IBB is the loop header because</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// -- If merging predecessors that belong to the same loop as IBB, the</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// common tail of merged predecessors may become the loop top if block</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// placement is called again and the predecessors may branch to this common</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// tail and require more branches. This can be relaxed if</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// MachineBlockPlacement::findBestLoopTop is more flexible.</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// --If merging predecessors that do not belong to the same loop as IBB, the</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// loop info of IBB&#39;s loop and the other loops may be affected. Calling the</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block placement again may make big change to the layout and eliminate the</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// reason to do tail merging here.</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AfterBlockPlacement &amp;&amp; MLI) &#123;</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3ad01fd9b01e9dde8bd3dc247afbfb7218">ML</a> = MLI-&gt;getLoopFor(IBB);</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3ad01fd9b01e9dde8bd3dc247afbfb7218">ML</a> &amp;&amp; IBB == <a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3ad01fd9b01e9dde8bd3dc247afbfb7218">ML</a>-&gt;getHeader())</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MachineBasicBlock &#42;PBB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;predecessors()) &#123;</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MergePotentials.size() == <a href="#a63debb3136d590391f5f3765095afa5c">TailMergeThreshold</a>)</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TriedMerging.count(PBB))</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip blocks that loop to themselves, can&#39;t tail merge these.</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBB == IBB)</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Visit each predecessor only once.</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UniquePreds.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PBB).second)</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip blocks which may jump to a landing pad or jump from an asm blob.</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Can&#39;t tail merge these.</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PBB-&gt;hasEHPadSuccessor() || PBB-&gt;mayHaveInlineAsmBr())</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// After block placement, only consider predecessors that belong to the</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// same loop as IBB.  The reason is the same as above when skipping loop</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// header.</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AfterBlockPlacement &amp;&amp; MLI)</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/inlineorder-cpp/#a7ee6f0cb51c3b9056199e9a0001fe8c3ad01fd9b01e9dde8bd3dc247afbfb7218">ML</a> != MLI-&gt;getLoopFor(PBB))</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">      MachineBasicBlock &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;FBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">      SmallVector&lt;MachineOperand, 4&gt; <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>;</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TII-&gt;analyzeBranch(&#42;PBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Failing case: IBB is the target of a cbr, and we cannot reverse the</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// branch.</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">        SmallVector&lt;MachineOperand, 4&gt; NewCond(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> == IBB) &#123;</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TII-&gt;reverseBranchCondition(NewCond))</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// This is the QBB case described above</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FBB) &#123;</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a> = ++PBB-&gt;getIterator();</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a> != MF.end())</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">              FBB = &amp;&#42;<a href="/docs/api/namespaces/llvm/#ab13c360340346d082b959b8cd79f2c1a">Next</a>;</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Remove the unconditional branch at the end, if any.</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> dl = PBB-&gt;findBranchDebugLoc();</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> &amp;&amp; (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() || FBB)) &#123;</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">          TII-&gt;removeBranch(&#42;PBB);</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// reinsert conditional branch only, for now</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">            TII-&gt;insertBranch(&#42;PBB, (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> == IBB) ? FBB : <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">                              NewCond, dl);</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">        MergePotentials.push&#95;back(</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">            MergePotentialsElt(<a href="#adef2c46c3161a62af20d7f993a287a98">HashEndOfMBB</a>(&#42;PBB), PBB, dl));</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is a large problem, avoid visiting the same basic blocks multiple</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// times.</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MergePotentials.size() == <a href="#a63debb3136d590391f5f3765095afa5c">TailMergeThreshold</a>)</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MergePotentialsElt &amp;Elt : MergePotentials)</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">        TriedMerging.insert(Elt.getBlock());</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MergePotentials.size() &gt;= 2)</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">      MadeChange |= TryTailMergeBlocks(IBB, PredBB, MinCommonTailLength);</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reinsert an unconditional branch if needed. The 1 below can occur as a</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// result of removing blocks in TryTailMergeBlocks.</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">    PredBB = &amp;&#42;std::prev(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); </span><span class="doxyHighlightComment">// this may have been changed in TryTailMergeBlocks</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MergePotentials.size() == 1 &amp;&amp;</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">        MergePotentials.begin()-&gt;getBlock() != PredBB)</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">      <a href="#abbe6276e99bb565156d18a843ae1ccb9">FixTail</a>(MergePotentials.begin()-&gt;getBlock(), IBB, TII,</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">              MergePotentials.begin()-&gt;getBranchDebugLoc());</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> BranchFolder::setCommonTailEdgeWeights(MachineBasicBlock &amp;TailMBB) &#123;</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;BlockFrequency, 2&gt;</a> EdgeFreqLs(TailMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>());</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">  BlockFrequency AccumulatedMBBFreq;</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Aggregate edge frequency of successor edge j:</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  edgeFreq(j) = sum (freq(bb) &#42; edgeProb(bb, j)),</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  where bb is a basic block that is in SameTails.</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Src : SameTails) &#123;</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> MachineBasicBlock &#42;SrcMBB = <a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>.getBlock();</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">    BlockFrequency BlockFreq = MBBFreqInfo.getBlockFreq(SrcMBB);</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">    AccumulatedMBBFreq += BlockFreq;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// It is not necessary to recompute edge weights if TailBB has less than two</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// successors.</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TailMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>() &lt;= 1)</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EdgeFreq = EdgeFreqLs.begin();</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SuccI = TailMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a6321b189ea8fd5058663f8a87d6c23e9">succ&#95;begin</a>(), SuccE = TailMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a3ddd708642d60c1661992ff8ba1b215d">succ&#95;end</a>();</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">         SuccI != SuccE; ++SuccI, ++EdgeFreq)</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">      &#42;EdgeFreq += BlockFreq &#42; MBPI.getEdgeProbability(SrcMBB, &#42;SuccI);</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">  MBBFreqInfo.setBlockFreq(&amp;TailMBB, AccumulatedMBBFreq);</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TailMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>() &lt;= 1)</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SumEdgeFreq =</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">      std::accumulate(EdgeFreqLs.begin(), EdgeFreqLs.end(), BlockFrequency(0))</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">          .getFrequency();</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EdgeFreq = EdgeFreqLs.begin();</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SumEdgeFreq &gt; 0) &#123;</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SuccI = TailMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a6321b189ea8fd5058663f8a87d6c23e9">succ&#95;begin</a>(), SuccE = TailMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a3ddd708642d60c1661992ff8ba1b215d">succ&#95;end</a>();</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">         SuccI != SuccE; ++SuccI, ++EdgeFreq) &#123;</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Prob = <a href="/docs/api/classes/llvm/branchprobability/#a0333345669e75a54c7de3d5fe0f6e746">BranchProbability::getBranchProbability</a>(</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">          EdgeFreq-&gt;getFrequency(), SumEdgeFreq);</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">      TailMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a6171d209616c58347dea44a49d7675c0">setSuccProbability</a>(SuccI, Prob);</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlightComment">//  Branch Optimization</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BranchFolder::OptimizeBranches(MachineFunction &amp;MF) &#123;</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure blocks are numbered in order</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">  MF.<a href="/docs/api/classes/llvm/machinefunction/#ac85349aab432e6b7d8b2e8926048a6de">RenumberBlocks</a>();</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Renumbering blocks alters EH scope membership, recalculate it.</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">  EHScopeMembership = <a href="/docs/api/namespaces/llvm/#afa141935f9c9a1ad9c785d7b6200b119">getEHScopeMembership</a>(MF);</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MachineBasicBlock &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> :</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">       <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">llvm::drop&#95;begin</a>(MF))) &#123;</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">    MadeChange |= OptimizeBlock(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If it is dead, remove it.</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#a877507fda31c207ec36a018784369708">pred&#95;empty</a>() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.<a href="/docs/api/classes/llvm/machinebasicblock/#ad934138cd088f6c08cbf0f373997fd17">isMachineBlockAddressTaken</a>()) &#123;</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">      RemoveDeadBlock(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">      ++NumDeadBlocks;</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlightComment">// Blocks should be considered empty if they contain only debug info;</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlightComment">// else the debug info would affect codegen.</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234" lineLink="#a87d0fbdabd17122a3febe35d7fbefb60"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a87d0fbdabd17122a3febe35d7fbefb60">IsEmptyBlock</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getFirstNonDebugInstr(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;end();</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlightComment">// Blocks with only debug info and branches should be considered the same</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlightComment">// as blocks with only branches.</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240" lineLink="#ab17cea834a55a63f670e77230917423e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ab17cea834a55a63f670e77230917423e">IsBranchOnlyBlock</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getFirstNonDebugInstr();</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;end() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;empty block!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isBranch();</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlightComment">/// IsBetterFallthrough - Return true if it would be clearly better to</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlightComment">/// fall-through to MBB1 than to fall through into MBB2.  This has to return</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlightComment">/// a strict ordering, returning true for both (MBB1,MBB2) and (MBB2,MBB1) will</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlightComment">/// result in infinite loops.</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250" lineLink="#acda790896623fd894c71bf79f1bbcfea"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#acda790896623fd894c71bf79f1bbcfea">IsBetterFallthrough</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MBB1,</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MBB2) &#123;</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MBB1 &amp;&amp; MBB2 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unknown MachineBasicBlock&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Right now, we use a simple heuristic.  If MBB2 ends with a call, and</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// MBB1 doesn&#39;t, we prefer to fall through into MBB1.  This allows us to</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimize branches that branch to either a return block or an assert block</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into a fallthrough to the return.</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> MBB1I = MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab8d7b8ff6803133d567fd4240e6364ce">getLastNonDebugInstr</a>();</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> MBB2I = MBB2-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab8d7b8ff6803133d567fd4240e6364ce">getLastNonDebugInstr</a>();</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MBB1I == MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>() || MBB2I == MBB2-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>())</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is a clear successor ordering we make sure that one block</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will fall through to the next</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MBB1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(MBB2)) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MBB2-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(MBB1)) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MBB2I-&gt;isCall() &amp;&amp; !MBB1I-&gt;isCall();</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271" lineLink="#a287fa83baa277de19fb734bdda92f0c6"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a287fa83baa277de19fb734bdda92f0c6">copyDebugInfoToPredecessor</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>,</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;PredMBB) &#123;</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InsertBefore = PredMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a7f0521fa2de44271fd4b909ea7351ef3">getFirstTerminator</a>();</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.instrs())</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugInstr()) &#123;</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;duplicate(PredMBB, InsertBefore, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Copied debug entity from empty block to pred: &quot;</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">                        &lt;&lt; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283" lineLink="#aaaf533c4a29ff1fd44bfef2f8feb1c3c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#aaaf533c4a29ff1fd44bfef2f8feb1c3c">copyDebugInfoToSuccessor</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>,</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;SuccMBB) &#123;</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InsertBefore = SuccMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a3be7d94076d328797ab57ce09cefab33">SkipPHIsAndLabels</a>(SuccMBB.<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>());</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.instrs())</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugInstr()) &#123;</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;duplicate(SuccMBB, InsertBefore, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Copied debug entity from empty block to succ: &quot;</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">                        &lt;&lt; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlightComment">// Try to salvage DBG&#95;VALUE instructions from an otherwise empty block. If such</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlightComment">// a basic block is removed we would lose the debug information unless we have</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlightComment">// copied the information to a predecessor/successor.</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlightComment">// TODO: This function only handles some simple cases. An alternative would be</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlightComment">// to run a heavier analysis, such as the LiveDebugValues pass, before we do</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlightComment">// branch folding.</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302" lineLink="#a3fb0794be53f8c8e93e76861075a9a8a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a3fb0794be53f8c8e93e76861075a9a8a">salvageDebugInfoFromEmptyBlock</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>,</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#a87d0fbdabd17122a3febe35d7fbefb60">IsEmptyBlock</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected an empty block (except debug info).&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this MBB is the only predecessor of a successor it is legal to copy</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DBG&#95;VALUE instructions to the beginning of the successor.</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccBB : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.successors())</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a03936a9b37da541420049422204ab206">pred&#95;size</a>() == 1)</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">      <a href="#aaaf533c4a29ff1fd44bfef2f8feb1c3c">copyDebugInfoToSuccessor</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, &#42;SuccBB);</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this MBB is the only successor of a predecessor it is legal to copy the</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// DBG&#95;VALUE instructions to the end of the predecessor (just before the</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// terminators, assuming that the terminator isn&#39;t affecting the DBG&#95;VALUE).</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;PredBB : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.predecessors())</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>() == 1)</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">      <a href="#a287fa83baa277de19fb734bdda92f0c6">copyDebugInfoToPredecessor</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, &#42;PredBB);</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BranchFolder::OptimizeBlock(MachineBasicBlock &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">  MachineFunction &amp;MF = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acf6442108e21e7e5379feb8962de65b7">getParent</a>();</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">ReoptimizeBlock:</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> FallThrough = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">  ++FallThrough;</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure MBB and FallThrough belong to the same EH scope.</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> SameEHScope = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EHScopeMembership.empty() &amp;&amp; FallThrough != MF.<a href="/docs/api/classes/llvm/machinefunction/#a9d017af749f76484cb9aec9ff6e4330c">end</a>()) &#123;</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MBBEHScope = EHScopeMembership.find(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MBBEHScope != EHScopeMembership.end());</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> FallThroughEHScope = EHScopeMembership.find(&amp;&#42;FallThrough);</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FallThroughEHScope != EHScopeMembership.end());</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><span class="doxyHighlight">    SameEHScope = MBBEHScope-&gt;second == FallThroughEHScope-&gt;second;</span></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Analyze the branch in the current block. As a side-effect, this may cause</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the block to become empty.</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">  MachineBasicBlock &#42;CurTBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;CurFBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">  SmallVector&lt;MachineOperand, 4&gt; CurCond;</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CurUnAnalyzable =</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">      TII-&gt;analyzeBranch(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, CurTBB, CurFBB, CurCond, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this block is empty, make everyone use its fall-through, not the block</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// explicitly.  Landing pads should not do this since the landing-pad table</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// points to this block.  Blocks with their addresses taken shouldn&#39;t be</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimized away.</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a87d0fbdabd17122a3febe35d7fbefb60">IsEmptyBlock</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a1100bfbadd996d464150c6a68fa8dc1d">isEHPad</a>() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a86ae593fc791eda3aae24bd9d6df2322">hasAddressTaken</a>() &amp;&amp;</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">      SameEHScope) &#123;</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">    <a href="#a3fb0794be53f8c8e93e76861075a9a8a">salvageDebugInfoFromEmptyBlock</a>(TII, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Dead block?  Leave for cleanup later.</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a877507fda31c207ec36a018784369708">pred&#95;empty</a>()) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FallThrough == MF.<a href="/docs/api/classes/llvm/machinefunction/#a9d017af749f76484cb9aec9ff6e4330c">end</a>()) &#123;</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Simplify preds to not branch here if possible!</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FallThrough-&gt;isEHPad()) &#123;</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t rewrite to a landing pad fallthough.  That could lead to the case</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// where a BB jumps to more than one landing pad.</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Is it ever worth rewriting predecessors which don&#39;t already</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// jump to a landing pad, and so can safely jump to the fallthrough?</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(&amp;&#42;FallThrough)) &#123;</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Rewrite all predecessors of the old block to go to the fallthrough</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instead.</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a877507fda31c207ec36a018784369708">pred&#95;empty</a>()) &#123;</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">        MachineBasicBlock &#42;Pred = &#42;(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a0359a738e0412c5a7ea55d61175e0661">pred&#95;end</a>()-1);</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">        Pred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab9a54fdc7456ee97cb54ff30d625b6b7">ReplaceUsesOfBlockWith</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, &amp;&#42;FallThrough);</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add rest successors of MBB to successors of FallThrough. Those</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// successors are not directly reachable via MBB, so it should be</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// landing-pad.</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SI = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a6321b189ea8fd5058663f8a87d6c23e9">succ&#95;begin</a>(), SE = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3ddd708642d60c1661992ff8ba1b215d">succ&#95;end</a>(); SI != SE; ++SI)</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&#42;SI != &amp;&#42;FallThrough &amp;&amp; !FallThrough-&gt;isSuccessor(&#42;SI)) &#123;</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((&#42;SI)-&gt;isEHPad() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Bad CFG&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">          FallThrough-&gt;copySuccessor(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, SI);</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If MBB was the target of a jump table, update jump tables to go to the</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// fallthrough instead.</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MachineJumpTableInfo &#42;MJTI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ad828deab7de3b5f4d03fac86e26adae9">getJumpTableInfo</a>())</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">        MJTI-&gt;ReplaceMBBInJumpTables(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, &amp;&#42;FallThrough);</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check to see if we can simplify the terminator of the block before this</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// one.</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">  MachineBasicBlock &amp;PrevBB = &#42;std::prev(<a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>));</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">  MachineBasicBlock &#42;PriorTBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;PriorFBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">  SmallVector&lt;MachineOperand, 4&gt; PriorCond;</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PriorUnAnalyzable =</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">      TII-&gt;analyzeBranch(PrevBB, PriorTBB, PriorFBB, PriorCond, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PriorUnAnalyzable) &#123;</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the previous branch is conditional and both conditions go to the same</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// destination, remove the branch, replacing it with an unconditional one or</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a fall-through.</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PriorTBB &amp;&amp; PriorTBB == PriorFBB) &#123;</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> Dl = PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#ad81901d0d8b768b240e78bf357999f34">findBranchDebugLoc</a>();</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">      TII-&gt;removeBranch(PrevBB);</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">      PriorCond.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PriorTBB != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">        TII-&gt;insertBranch(PrevBB, PriorTBB, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, PriorCond, Dl);</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">      ++NumBranchOpts;</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> ReoptimizeBlock;</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the previous block unconditionally falls through to this block and</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this block has no other predecessors, move the contents of this block</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// into the prior block. This doesn&#39;t usually happen when SimplifyCFG</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// has been used, but it can happen if tail merging splits a fall-through</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessor of a block.</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This has to check PrevBB-&gt;succ&#95;size() because EH edges are ignored by</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// analyzeBranch.</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PriorCond.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; !PriorTBB &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a03936a9b37da541420049422204ab206">pred&#95;size</a>() == 1 &amp;&amp;</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">        PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>() == 1 &amp;&amp; PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &amp;&amp;</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">        !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a86ae593fc791eda3aae24bd9d6df2322">hasAddressTaken</a>() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a1100bfbadd996d464150c6a68fa8dc1d">isEHPad</a>()) &#123;</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nMerging into block: &quot;</span><span class="doxyHighlight"> &lt;&lt; PrevBB</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;From MBB: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Remove redundant DBG&#95;VALUEs first.</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a095ce2d870dadf620a4c887ecc0efef8">empty</a>()) &#123;</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> PrevBBIter = PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>();</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">        --PrevBBIter;</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> MBBIter = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Check if DBG&#95;VALUE at the end of PrevBB is identical to the</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// DBG&#95;VALUE at the beginning of MBB.</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (PrevBBIter != PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>() &amp;&amp; MBBIter != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>()</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">               &amp;&amp; PrevBBIter-&gt;isDebugInstr() &amp;&amp; MBBIter-&gt;isDebugInstr()) &#123;</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MBBIter-&gt;isIdenticalTo(&#42;PrevBBIter))</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">          MachineInstr &amp;DuplicateDbg = &#42;MBBIter;</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">          ++MBBIter; -- PrevBBIter;</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlight">          DuplicateDbg.<a href="/docs/api/classes/llvm/machineinstr/#ac2421adbb9996e1b15f03a8abb6c70a8">eraseFromParent</a>();</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">      PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#adf0023bdc4f05a7849c35b1c859580d8">splice</a>(PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>());</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">      PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#aa7114bb360b922025e7a4fec442676db">removeSuccessor</a>(PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a6321b189ea8fd5058663f8a87d6c23e9">succ&#95;begin</a>());</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#aa8d1d8d88835b75b05b14ab774785e8a">succ&#95;empty</a>());</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">      PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a31e57b158a17c459f0dc34b0e602ecc6">transferSuccessors</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the previous branch &#42;only&#42; branches to &#42;this&#42; block (conditional or</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// not) remove the branch.</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PriorTBB == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> &amp;&amp; !PriorFBB) &#123;</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">      TII-&gt;removeBranch(PrevBB);</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">      ++NumBranchOpts;</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> ReoptimizeBlock;</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the prior block branches somewhere else on the condition and here if</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the condition is false, remove the uncond second branch.</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PriorFBB == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> Dl = PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#ad81901d0d8b768b240e78bf357999f34">findBranchDebugLoc</a>();</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">      TII-&gt;removeBranch(PrevBB);</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">      TII-&gt;insertBranch(PrevBB, PriorTBB, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, PriorCond, Dl);</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">      MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">      ++NumBranchOpts;</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> ReoptimizeBlock;</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the prior block branches here on true and somewhere else on false, and</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// if the branch condition is reversible, reverse the branch to create a</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// fall-through.</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PriorTBB == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">      SmallVector&lt;MachineOperand, 4&gt; NewPriorCond(PriorCond);</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TII-&gt;reverseBranchCondition(NewPriorCond)) &#123;</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> Dl = PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#ad81901d0d8b768b240e78bf357999f34">findBranchDebugLoc</a>();</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">        TII-&gt;removeBranch(PrevBB);</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">        TII-&gt;insertBranch(PrevBB, PriorFBB, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, NewPriorCond, Dl);</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">        MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">        ++NumBranchOpts;</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> ReoptimizeBlock;</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this block has no successors (e.g. it is a return block or ends with</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a call to a no-return function like abort or &#95;&#95;cxa&#95;throw) and if the pred</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// falls through into this block, and if it would otherwise fall through</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// into the block after this, move this block to the end of the function.</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We consider it more likely that execution will stay in the function (e.g.</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// due to loops) than it is to exit it.  This asserts in loops etc, moving</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the assert condition out of the loop body.</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#aa8d1d8d88835b75b05b14ab774785e8a">succ&#95;empty</a>() &amp;&amp; !PriorCond.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; !PriorFBB &amp;&amp;</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a>(PriorTBB) == FallThrough &amp;&amp;</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlight">        !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a5ffb77c69d69a5beff906caaecfd7be4">canFallThrough</a>()) &#123;</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DoTransform = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We have to be careful that the succs of PredBB aren&#39;t both no-successor</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// blocks.  If neither have successors and if PredBB is the second from</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// last block in the function, we&#39;d just keep swapping the two blocks for</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// last.  Only do the swap if one is clearly better to fall through than</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the other.</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FallThrough == --MF.<a href="/docs/api/classes/llvm/machinefunction/#a9d017af749f76484cb9aec9ff6e4330c">end</a>() &amp;&amp;</span></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">          !<a href="#acda790896623fd894c71bf79f1bbcfea">IsBetterFallthrough</a>(PriorTBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>))</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">        DoTransform = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DoTransform) &#123;</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Reverse the branch so we will fall through on the previous true cond.</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">        SmallVector&lt;MachineOperand, 4&gt; NewPriorCond(PriorCond);</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TII-&gt;reverseBranchCondition(NewPriorCond)) &#123;</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nMoving MBB: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a></span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">                            &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;To make fallthrough to: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;PriorTBB &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> Dl = PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#ad81901d0d8b768b240e78bf357999f34">findBranchDebugLoc</a>();</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlight">          TII-&gt;removeBranch(PrevBB);</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">          TII-&gt;insertBranch(PrevBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, NewPriorCond, Dl);</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Move this block to the end of the function.</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#af3c2dc75190645b72eee3c416cd14885">moveAfter</a>(&amp;MF.<a href="/docs/api/classes/llvm/machinefunction/#aa99535342c75b02dd086fd3a7633e747">back</a>());</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">          MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">          ++NumBranchOpts;</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a87d0fbdabd17122a3febe35d7fbefb60">IsEmptyBlock</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)) &#123;</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">    MachineInstr &amp;<a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba84922260d1582a0d4f6f0925cef648d7">TailCall</a> = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a62b5d2211c09378c471307293453d780">getFirstNonDebugInstr</a>();</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TII-&gt;isUnconditionalTailCall(TailCall)) &#123;</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;MachineBasicBlock &#42;&gt;</a> PredsChanged;</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pred : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">        MachineBasicBlock &#42;PredTBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;PredFBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">        SmallVector&lt;MachineOperand, 4&gt; PredCond;</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PredAnalyzable =</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">            !TII-&gt;analyzeBranch(&#42;Pred, PredTBB, PredFBB, PredCond, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Only eliminate if MBB == TBB (Taken Basic Block)</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredAnalyzable &amp;&amp; !PredCond.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; PredTBB == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> &amp;&amp;</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">            PredTBB != PredFBB) &#123;</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// The predecessor has a conditional branch to this block which</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// consists of only a tail call. Try to fold the tail call into the</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// conditional branch.</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TII-&gt;canMakeTailCallConditional(PredCond, TailCall)) &#123;</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// TODO: It would be nice if analyzeBranch() could provide a pointer</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// to the branch instruction so replaceBranchWithTailCall() doesn&#39;t</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// have to search for it.</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlight">            TII-&gt;replaceBranchWithTailCall(&#42;Pred, PredCond, TailCall);</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlight">            PredsChanged.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Pred);</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the predecessor is falling through to this block, we could reverse</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the branch condition and fold the tail call into that. However, after</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// that we might have to re-arrange the CFG to fall through to the other</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// block and there is a high risk of regressing code size rather than</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// improving it.</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredsChanged.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">        NumTailCalls += PredsChanged.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pred : PredsChanged)</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">          Pred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#aa7114bb360b922025e7a4fec442676db">removeSuccessor</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurUnAnalyzable) &#123;</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is a two-way branch, and the FBB branches to this block, reverse</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the condition so the single-basic-block loop is faster.  Instead of:</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    Loop: xxx; jcc Out; jmp Loop</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we want:</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//    Loop: xxx; jncc Loop; jmp Out</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurTBB &amp;&amp; CurFBB &amp;&amp; CurFBB == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> &amp;&amp; CurTBB != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">      SmallVector&lt;MachineOperand, 4&gt; NewCond(CurCond);</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TII-&gt;reverseBranchCondition(NewCond)) &#123;</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> Dl = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad81901d0d8b768b240e78bf357999f34">findBranchDebugLoc</a>();</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">        TII-&gt;removeBranch(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">        TII-&gt;insertBranch(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, CurFBB, CurTBB, NewCond, Dl);</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">        MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">        ++NumBranchOpts;</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> ReoptimizeBlock;</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this branch is the only thing in its block, see if we can forward</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// other blocks across it.</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurTBB &amp;&amp; CurCond.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; !CurFBB &amp;&amp;</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">        <a href="#ab17cea834a55a63f670e77230917423e">IsBranchOnlyBlock</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &amp;&amp; CurTBB != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> &amp;&amp;</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">        !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a86ae593fc791eda3aae24bd9d6df2322">hasAddressTaken</a>() &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a1100bfbadd996d464150c6a68fa8dc1d">isEHPad</a>()) &#123;</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> Dl = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad81901d0d8b768b240e78bf357999f34">findBranchDebugLoc</a>();</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This block may contain just an unconditional branch.  Because there can</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// be &#39;non-branch terminators&#39; in the block, try removing the branch and</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// then seeing if the block is empty.</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlight">      TII-&gt;removeBranch(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the only things remaining in the block are debug info, remove these</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// as well, so this will behave the same as an empty block in non-debug</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// mode.</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a87d0fbdabd17122a3febe35d7fbefb60">IsEmptyBlock</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)) &#123;</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Make the block empty, losing the debug info (we could probably</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// improve this in some cases.)</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad26bff839257f220557ce812b2159c72">erase</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>());</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this block is just an unconditional branch to CurTBB, we can</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// usually completely eliminate the block.  The only case we cannot</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// completely eliminate the block is when the block before this one</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// falls through into MBB and we can&#39;t understand the prior block&#39;s branch</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// condition.</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a095ce2d870dadf620a4c887ecc0efef8">empty</a>()) &#123;</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PredHasNoFallThrough = !PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a5ffb77c69d69a5beff906caaecfd7be4">canFallThrough</a>();</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredHasNoFallThrough || !PriorUnAnalyzable ||</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlight">            !PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)) &#123;</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If the prior block falls through into us, turn it into an</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// explicit branch to us to make updates simpler.</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredHasNoFallThrough &amp;&amp; PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &amp;&amp;</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">              PriorTBB != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> &amp;&amp; PriorFBB != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PriorTBB) &#123;</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">              <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PriorCond.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp; !PriorFBB &amp;&amp;</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">                     </span><span class="doxyHighlightStringLiteral">&quot;Bad branch analysis&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">              PriorTBB = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>;</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">            &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">              <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!PriorFBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Machine CFG out of date!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">              PriorFBB = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>;</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> PrevDl = PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#ad81901d0d8b768b240e78bf357999f34">findBranchDebugLoc</a>();</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">            TII-&gt;removeBranch(PrevBB);</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">            TII-&gt;insertBranch(PrevBB, PriorTBB, PriorFBB, PriorCond, PrevDl);</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Iterate through all the predecessors, revectoring each in-turn.</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> PI = 0;</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DidChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasBranchToSelf = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight">(PI != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a03936a9b37da541420049422204ab206">pred&#95;size</a>()) &#123;</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">            MachineBasicBlock &#42;PMBB = &#42;(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab644fcf07a4c2708333cf66276282357">pred&#95;begin</a>() + PI);</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PMBB == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// If this block has an uncond branch to itself, leave it.</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlight">              ++PI;</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">              HasBranchToSelf = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">            &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlight">              DidChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">              PMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab9a54fdc7456ee97cb54ff30d625b6b7">ReplaceUsesOfBlockWith</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, CurTBB);</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// Add rest successors of MBB to successors of CurTBB. Those</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// successors are not directly reachable via MBB, so it should be</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// landing-pad.</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SI = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a6321b189ea8fd5058663f8a87d6c23e9">succ&#95;begin</a>(), SE = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3ddd708642d60c1661992ff8ba1b215d">succ&#95;end</a>(); SI != SE;</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlight">                   ++SI)</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&#42;SI != CurTBB &amp;&amp; !CurTBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(&#42;SI)) &#123;</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">                  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((&#42;SI)-&gt;isEHPad() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Bad CFG&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlight">                  CurTBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a95933492048f0ea830f02f61b1329c12">copySuccessor</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, SI);</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">                &#125;</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// If this change resulted in PMBB ending in a conditional</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// branch where both conditions go to the same destination,</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">// change this to an unconditional branch.</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlight">              MachineBasicBlock &#42;NewCurTBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;NewCurFBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">              SmallVector&lt;MachineOperand, 4&gt; NewCurCond;</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NewCurUnAnalyzable = TII-&gt;analyzeBranch(</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlight">                  &#42;PMBB, NewCurTBB, NewCurFBB, NewCurCond, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewCurUnAnalyzable &amp;&amp; NewCurTBB &amp;&amp; NewCurTBB == NewCurFBB) &#123;</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">                <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> PrevDl = PMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad81901d0d8b768b240e78bf357999f34">findBranchDebugLoc</a>();</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">                TII-&gt;removeBranch(&#42;PMBB);</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">                NewCurCond.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlight">                TII-&gt;insertBranch(&#42;PMBB, NewCurTBB, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, NewCurCond,</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">                                  PrevDl);</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">                MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">                ++NumBranchOpts;</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlight">              &#125;</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Change any jumptables to go to the new MBB.</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MachineJumpTableInfo &#42;MJTI = MF.<a href="/docs/api/classes/llvm/machinefunction/#ad828deab7de3b5f4d03fac86e26adae9">getJumpTableInfo</a>())</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlight">            MJTI-&gt;ReplaceMBBInJumpTables(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, CurTBB);</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DidChange) &#123;</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">            ++NumBranchOpts;</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlight">            MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasBranchToSelf) </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add the branch back if the block is more than just an uncond branch.</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">      TII-&gt;insertBranch(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, CurTBB, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, CurCond, Dl);</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the prior block doesn&#39;t fall through into this block, and if this</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block doesn&#39;t fall through into some other block, see if we can find a</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// place to move this block where a fall-through will happen.</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#a5ffb77c69d69a5beff906caaecfd7be4">canFallThrough</a>()) &#123;</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now we know that there was no fall-through into this block, check to</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// see if it has a fall-through into its successor.</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CurFallsThru = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a5ffb77c69d69a5beff906caaecfd7be4">canFallThrough</a>();</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a1100bfbadd996d464150c6a68fa8dc1d">isEHPad</a>()) &#123;</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check all the predecessors of this block.  If one of them has no fall</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// throughs, and analyzeBranch thinks it &#95;could&#95; fallthrough to this</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// block, move this block right after it.</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MachineBasicBlock &#42;PredBB : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Analyze the branch at the end of the pred.</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">        MachineBasicBlock &#42;PredTBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;PredFBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">        SmallVector&lt;MachineOperand, 4&gt; PredCond;</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredBB != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> &amp;&amp; !PredBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a5ffb77c69d69a5beff906caaecfd7be4">canFallThrough</a>() &amp;&amp;</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">            !TII-&gt;analyzeBranch(&#42;PredBB, PredTBB, PredFBB, PredCond, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &amp;&amp;</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">            (PredTBB == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> || PredFBB == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &amp;&amp;</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">            (!CurFallsThru || !CurTBB || !CurFBB) &amp;&amp;</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">            (!CurFallsThru || <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>() &gt;= PredBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>())) &#123;</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If the current block doesn&#39;t fall through, just move it.</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If the current block can fall through and does not end with a</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// conditional branch, we need to append an unconditional jump to</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// the (current) next block.  To avoid a possible compile-time</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// infinite loop, move blocks only backward in this case.</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Also, if there are already 2 branches here, we cannot add a third;</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// this means we have the case</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Bcc next</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// B elsewhere</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// next:</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurFallsThru) &#123;</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">            MachineBasicBlock &#42;NextBB = &amp;&#42;std::next(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">            CurCond.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">            TII-&gt;insertBranch(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, NextBB, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, CurCond, <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#af3c2dc75190645b72eee3c416cd14885">moveAfter</a>(PredBB);</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">          MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> ReoptimizeBlock;</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurFallsThru) &#123;</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check analyzable branch-successors to see if we can move this block</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// before one.</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CurUnAnalyzable) &#123;</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MachineBasicBlock &#42;SuccBB : &#123;CurFBB, CurTBB&#125;) &#123;</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SuccBB)</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Analyze the branch at the end of the block before the succ.</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> SuccPrev = --SuccBB-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If this block doesn&#39;t already fall-through to that successor, and</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// if the succ doesn&#39;t already have a block that can fall through into</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// it, we can arrange for the fallthrough to happen.</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccBB != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> &amp;&amp; &amp;&#42;SuccPrev != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> &amp;&amp;</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">              !SuccPrev-&gt;canFallThrough()) &#123;</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a25c2a6ee39d0d97dac2184e8bd942300">moveBefore</a>(SuccBB);</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">            MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">goto</span><span class="doxyHighlight"> ReoptimizeBlock;</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Okay, there is no really great place to put this block.  If, however,</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the block before this one would be a fall-through if this block were</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// removed, move this block to the end of the function. There is no real</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// advantage in &quot;falling through&quot; to an EH block, so we don&#39;t want to</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// perform this transformation for that case.</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Also, Windows EH introduced the possibility of an arbitrary number of</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// successors to a given block.  The analyzeBranch call does not consider</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// exception handling and so we can get in a state where a block</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// containing a call is followed by multiple EH blocks that would be</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// rotated infinitely at the end of the function if the transformation</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// below were performed for EH &quot;FallThrough&quot; blocks.  Therefore, even if</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// that appears not to be happening anymore, we should assume that it is</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// possible and not remove the &quot;!FallThrough()-&gt;isEHPad&quot; condition below.</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">      MachineBasicBlock &#42;PrevTBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;PrevFBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">      SmallVector&lt;MachineOperand, 4&gt; PrevCond;</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FallThrough != MF.<a href="/docs/api/classes/llvm/machinefunction/#a9d017af749f76484cb9aec9ff6e4330c">end</a>() &amp;&amp;</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">          !FallThrough-&gt;isEHPad() &amp;&amp;</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">          !TII-&gt;analyzeBranch(PrevBB, PrevTBB, PrevFBB, PrevCond, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &amp;&amp;</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">          PrevBB.<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(&amp;&#42;FallThrough)) &#123;</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#af3c2dc75190645b72eee3c416cd14885">moveAfter</a>(&amp;MF.<a href="/docs/api/classes/llvm/machinefunction/#aa99535342c75b02dd086fd3a7633e747">back</a>());</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">        MadeChange = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlightComment">//  Hoist Common Code</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BranchFolder::HoistCommonCode(MachineFunction &amp;MF) &#123;</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MachineBasicBlock &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(MF))</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">    MadeChange |= HoistCommonCodeInSuccs(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlightComment">/// findFalseBlock - BB has a fallthrough. Find its &#39;false&#39; successor given</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlightComment">/// its &#39;true&#39; successor.</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789" lineLink="#a22558d7c3b0ce9b0075ea086c1d3749d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="#a22558d7c3b0ce9b0075ea086c1d3749d">findFalseBlock</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;TrueBB) &#123;</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccBB : BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>())</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SuccBB != TrueBB)</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SuccBB;</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlightKeyword">template</span><span class="doxyHighlight"> &lt;</span><span class="doxyHighlightKeyword">class</span><span class="doxyHighlight"> Container&gt;</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798" lineLink="#a6afe81a8562ad740b6edd4c536974067"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a6afe81a8562ad740b6edd4c536974067">addRegAndItsAliases</a>(<a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>,</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlight">                                Container &amp;Set) &#123;</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isPhysical()) &#123;</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/mcregaliasiterator">MCRegAliasIterator</a> AI(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">); AI.<a href="/docs/api/classes/llvm/mcregaliasiterator/#ac336c049c12ead7be5b86e6d046f8ab0">isValid</a>(); ++AI)</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">      Set.insert(&#42;AI);</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">    Set.insert(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>);</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlightComment">/// findHoistingInsertPosAndDeps - Find the location to move common instructions</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlightComment">/// in successors to. The location is usually just before the terminator,</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlightComment">/// however if the terminator is a conditional branch and its previous</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlightComment">/// instruction is the flag setting instruction, the previous instruction is</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><span class="doxyHighlightComment">/// the preferred location. This function also gathers uses and defs of the</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlightComment">/// instructions from the insertion point to the end of the block. The data is</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlightComment">/// used by HoistCommonCodeInSuccs to ensure safety.</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlightKeyword">static</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816" lineLink="#ae9089253a8c971c8429d201735c81ed6"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="#ae9089253a8c971c8429d201735c81ed6">findHoistingInsertPosAndDeps</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">                                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>,</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">                                                  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetregisterinfo">TargetRegisterInfo</a> &#42;<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>,</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">                                                  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;Register, 4&gt;</a> &amp;<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>,</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">                                                  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;Register, 4&gt;</a> &amp;Defs) &#123;</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> <a href="/docs/api/namespaces/llvm/loc">Loc</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getFirstTerminator();</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isUnpredicatedTerminator(&#42;<a href="/docs/api/namespaces/llvm/loc">Loc</a>))</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;end();</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/namespaces/llvm/loc">Loc</a>-&gt;operands()) &#123;</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isReg())</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.getReg();</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.isUse()) &#123;</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">      <a href="#a6afe81a8562ad740b6edd4c536974067">addRegAndItsAliases</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>);</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isDead())</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Don&#39;t try to hoist code in the rare case the terminator defines a</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// register that is later used.</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;end();</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the terminator defines a register, make sure we don&#39;t hoist</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the instruction whose def might be clobbered by the terminator.</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">      <a href="#a6afe81a8562ad740b6edd4c536974067">addRegAndItsAliases</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, Defs);</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.empty())</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/loc">Loc</a>;</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the terminator is the only instruction in the block and Uses is not</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// empty (or we would have returned above), we can still safely hoist</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions just before the terminator as long as the Defs/Uses are not</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// violated (which is checked in HoistCommonCodeInSuccs).</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/loc">Loc</a> == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;begin())</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/loc">Loc</a>;</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The terminator is probably a conditional branch, try not to separate the</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branch from condition setting instruction.</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> PI = <a href="/docs/api/namespaces/llvm/#ae74dcdb801fe44b3840dd93e6c395066">prev&#95;nodbg</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;begin());</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsDef = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : PI-&gt;operands()) &#123;</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If PI has a regmask operand, it is probably a call. Separate away.</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.isRegMask())</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/loc">Loc</a>;</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isReg() || MO.isUse())</span></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.getReg();</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.count(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">      IsDef = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsDef)</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The condition setting instruction is not just before the conditional</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// branch.</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/loc">Loc</a>;</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Be conservative, don&#39;t insert instruction above something that may have</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// side-effects. And since it&#39;s potentially bad to separate flag setting</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction from the conditional branch, just abort the optimization</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// completely.</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Also avoid moving code above predicated instruction since it&#39;s hard to</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reason about register liveness with predicated instruction.</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DontMoveAcrossStore = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PI-&gt;isSafeToMove(DontMoveAcrossStore) || <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;isPredicated(&#42;PI))</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;end();</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find out what registers are live. Note this routine is ignoring other live</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// registers which are only used by instructions in successor blocks.</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : PI-&gt;operands()) &#123;</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isReg())</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.getReg();</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.isUse()) &#123;</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">      <a href="#a6afe81a8562ad740b6edd4c536974067">addRegAndItsAliases</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>);</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.erase(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isPhysical()) &#123;</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aad72cfbb210808985a9dc19f4e5d8542">MCPhysReg</a> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#a92a6b0a9b7228d190b0a7d8ae3ef03c7">SubReg</a> : <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>-&gt;subregs(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>))</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.erase(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64advsimdscalarpass-cpp/#a92a6b0a9b7228d190b0a7d8ae3ef03c7">SubReg</a>); </span><span class="doxyHighlightComment">// Use sub-registers to be conservative</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">      <a href="#a6afe81a8562ad740b6edd4c536974067">addRegAndItsAliases</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a0f36ed1bc17fc1aa97fe291c439a0698">TRI</a>, Defs);</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PI;</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BranchFolder::HoistCommonCodeInSuccs(MachineBasicBlock &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">  MachineBasicBlock &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, &#42;FBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">  SmallVector&lt;MachineOperand, 4&gt; <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>;</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TII-&gt;analyzeBranch(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) || !<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> || <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FBB) FBB = <a href="#a22558d7c3b0ce9b0075ea086c1d3749d">findFalseBlock</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>);</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FBB)</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Malformed bcc? True and false blocks are the same?</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Restrict the optimization to cases where MBB is the only predecessor,</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it is an obvious win.</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>-&gt;pred&#95;size() &gt; 1 || FBB-&gt;pred&#95;size() &gt; 1)</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find a suitable position to hoist the common instructions to. Also figure</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// out which registers are used or defined by instructions from the insertion</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// point to the end of the block.</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">  SmallSet&lt;Register, 4&gt; <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>, Defs;</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> Loc =</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">    <a href="#ae9089253a8c971c8429d201735c81ed6">findHoistingInsertPosAndDeps</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, TII, TRI, <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>, Defs);</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Loc == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acbc921830578e2741be6549db716c0ce">end</a>())</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasDups = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">  SmallSet&lt;Register, 4&gt; ActiveDefsSet, AllDefsSet;</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> TIB = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>();</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> FIB = FBB-&gt;begin();</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> TIE = <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>();</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock/#ae34c996b58df9b9ce6695a0c8b70c533">MachineBasicBlock::iterator</a> FIE = FBB-&gt;end();</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (TIB != TIE &amp;&amp; FIB != FIE) &#123;</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip dbg&#95;value instructions. These do not count.</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">    TIB = <a href="/docs/api/namespaces/llvm/#a5bacbbd03e9261f7b30dc174f26d680c">skipDebugInstructionsForward</a>(TIB, TIE, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">    FIB = <a href="/docs/api/namespaces/llvm/#a5bacbbd03e9261f7b30dc174f26d680c">skipDebugInstructionsForward</a>(FIB, FIE, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TIB == TIE || FIB == FIE)</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TIB-&gt;isIdenticalTo(&#42;FIB, <a href="/docs/api/classes/llvm/machineinstr/#ab7650f958c093f7c5faf8c69dbc8c462ad84865ceeee6b326942a3ed2ad37f815">MachineInstr::CheckKillDead</a>))</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TII-&gt;isPredicated(&#42;TIB))</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Hard to reason about register liveness with predicated instruction.</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsSafe = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MachineOperand &amp;MO : TIB-&gt;operands()) &#123;</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t attempt to hoist instructions with register masks.</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.isRegMask()) &#123;</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">        IsSafe = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isReg())</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.getReg();</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.isDef()) &#123;</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.count(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Avoid clobbering a register that&#39;s used by the instruction at</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// the point of insertion.</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">          IsSafe = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Defs.<a href="/docs/api/classes/llvm/smallset/#a2a98f19750ba941ce791b75ca6d77e48">count</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>) &amp;&amp; !MO.isDead()) &#123;</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Don&#39;t hoist the instruction if the def would be clobber by the</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// instruction at the point insertion. FIXME: This is overly</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// conservative. It should be possible to hoist the instructions</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// in BB2 in the following example:</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// BB1:</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// r1, eflag = op1 r2, r3</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// brcc eflag</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// BB2:</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// r1 = op2, ...</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">//    = op3, killed r1</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">          IsSafe = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ActiveDefsSet.<a href="/docs/api/classes/llvm/smallset/#a2a98f19750ba941ce791b75ca6d77e48">count</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Defs.<a href="/docs/api/classes/llvm/smallset/#a2a98f19750ba941ce791b75ca6d77e48">count</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Use is defined by the instruction at the point of insertion.</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">          IsSafe = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.isKill() &amp;&amp; <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.count(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>))</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Kills a register that&#39;s read by the instruction at the point of</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// insertion. Remove the kill marker.</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><span class="doxyHighlight">          MO.setIsKill(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsSafe)</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DontMoveAcrossStore = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TIB-&gt;isSafeToMove(DontMoveAcrossStore))</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remove kills from ActiveDefsSet, these registers had short live ranges.</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> MachineOperand &amp;MO : TIB-&gt;all&#95;uses()) &#123;</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isKill())</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.getReg();</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AllDefsSet.<a href="/docs/api/classes/llvm/smallset/#a2a98f19750ba941ce791b75ca6d77e48">count</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>)) &#123;</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isPhysical()) &#123;</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (MCRegAliasIterator AI(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, TRI, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">); AI.isValid(); ++AI)</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">          ActiveDefsSet.<a href="/docs/api/classes/llvm/smallset/#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(&#42;AI);</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">        ActiveDefsSet.<a href="/docs/api/classes/llvm/smallset/#a75a2d2ad3b3dce6702750d570ee8f343">erase</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>);</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Track local defs so we can update liveins.</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> MachineOperand &amp;MO : TIB-&gt;all&#95;defs()) &#123;</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.isDead())</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> = MO.getReg();</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a> || <a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>.isVirtual())</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">      <a href="#a6afe81a8562ad740b6edd4c536974067">addRegAndItsAliases</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, TRI, ActiveDefsSet);</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">      <a href="#a6afe81a8562ad740b6edd4c536974067">addRegAndItsAliases</a>(<a href="/docs/api/files/lib/lib/codegen/machinesink-cpp/#a359e1ff26f6d466d927a61aae45b05c3">Reg</a>, TRI, AllDefsSet);</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">    HasDups = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">    ++TIB;</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">    ++FIB;</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasDups)</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adf0023bdc4f05a7849c35b1c859580d8">splice</a>(Loc, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), TIB);</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">  FBB-&gt;erase(FBB-&gt;begin(), FIB);</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UpdateLiveIns)</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aee5f6b149b3f5ee5ed6ad7db9b58b148">fullyRecomputeLiveIns</a>(&#123;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB&#125;);</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">  ++NumHoist;</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
