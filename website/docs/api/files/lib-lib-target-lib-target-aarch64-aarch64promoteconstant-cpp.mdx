---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'
import XrefSect from '@xpack/docusaurus-plugin-doxygen/components/XrefSect'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `AArch64PromoteConstant.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="AArch64.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalValue.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalVariable.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/institerator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Pass.h"
  permalink="/docs/api/files/include/include/llvm/pass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-aarch64promoteconstant-cpp-">anonymous&#123;AArch64PromoteConstant.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant">AArch64PromoteConstant</a></>}>
Promotes interesting constant into global variables. <a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant">PromotedConstant</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord">UpdateRecord</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="bool"
  name={<><a href="#a94b1b5e9307f524668a97d9628b3de2a">containsOnlyConstantData</a> (const Constant &#42;C)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ab5c7f0f9f87d69820d8e4d8b31f4b0ff">ensurePromotedGV</a> (Function &amp;F, Constant &amp;C, AArch64PromoteConstant::PromotedConstant &amp;PC)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#acddbaf5fc5a8735431a050af39909d9f">INITIALIZE&#95;PASS&#95;BEGIN</a> (AArch64PromoteConstant, &quot;aarch64-promote-const&quot;, &quot;AArch64 Promote Constant Pass&quot;, false, false) INITIALIZE&#95;PASS&#95;END(AArch64PromoteConstant</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a1a93639bd72c9cc80cf001e17599ff87">isConstantUsingVectorTy</a> (const Type &#42;CstTy)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the given type uses a vector type. <a href="#a1a93639bd72c9cc80cf001e17599ff87">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ada41eab274cc944643f8b6a74dc1e8a0">shouldConvert</a> (Constant &amp;C, AArch64PromoteConstant::PromotionCacheTy &amp;PromotionCache)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af6a1350b26889cb5eebc75372ab4d3f5">shouldConvertImpl</a> (const Constant &#42;Cst)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the given Cst should be converted into a load of a global variable initialized with Cst. <a href="#af6a1350b26889cb5eebc75372ab4d3f5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aff43b1c529b1af47195587ca0090f7ec">shouldConvertUse</a> (const Constant &#42;Cst, const Instruction &#42;Instr, unsigned OpIdx)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the given use (<a href="/docs/api/classes/llvm/instruction">Instruction</a> + OpIdx) of Cst should be converted into a load of a global variable initialized with Cst. <a href="#aff43b1c529b1af47195587ca0090f7ec">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a55ebb20f2bc5c5a8638bba9ec50b0a61">STATISTIC</a> (NumPromoted, &quot;Number of promoted constants&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a133efe6d5a6151cfb0c7d45047920524">STATISTIC</a> (NumPromotedUses, &quot;Number of promoted constants uses&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type="aarch64 promote"
  name={<><a href="#a90f8350fecae261c25be85d38b451bff">const</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>aarch64 promote AArch64 Promote <a href="/docs/api/classes/llvm/constant">Constant</a></>}
  name={<><a href="#a60ff0978cee670022cdc8743945e0eae">false</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>aarch64 promote AArch64 Promote <a href="/docs/api/classes/llvm/constant">Constant</a></>}
  name={<><a href="#a099cf45c11df5059934a293e57614b7c">Pass</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#af2894a28a533f577c4252eae792e3358">Stress</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;aarch64-promote-const&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### containsOnlyConstantData() {#a94b1b5e9307f524668a97d9628b3de2a}

<MemberDefinition
  prototype={<>static bool containsOnlyConstantData (<a href="#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; C)</>}
  labels = {["static"]}>

Definition at line <a href="#l00253">253</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

### ensurePromotedGV() {#ab5c7f0f9f87d69820d8e4d8b31f4b0ff}

<MemberDefinition
  prototype={<>static void ensurePromotedGV (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/classes/llvm/constant">Constant</a> &amp; C, <a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant">AArch64PromoteConstant::PromotedConstant</a> &amp; PC)</>}
  labels = {["static"]}>

Definition at line <a href="#l00481">481</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS&#95;BEGIN() {#acddbaf5fc5a8735431a050af39909d9f}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (AArch64PromoteConstant, &quot;aarch64-promote-const&quot;, &quot;AArch64 Promote <a href="/docs/api/classes/llvm/constant">Constant</a> Pass&quot;, false, false)</>}>

Definition at line <a href="#l00227">227</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

### isConstantUsingVectorTy() {#a1a93639bd72c9cc80cf001e17599ff87}

<MemberDefinition
  prototype={<>static bool isConstantUsingVectorTy (<a href="#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/type">Type</a> &#42; CstTy)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the given type uses a vector type.

Definition at line <a href="#l00238">238</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

### shouldConvert() {#ada41eab274cc944643f8b6a74dc1e8a0}

<MemberDefinition
  prototype={<>static bool shouldConvert (<a href="/docs/api/classes/llvm/constant">Constant</a> &amp; C, <a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a4e357c8b7364d5898a8085b69bf2191c">AArch64PromoteConstant::PromotionCacheTy</a> &amp; PromotionCache)</>}
  labels = {["static"]}>

Definition at line <a href="#l00360">360</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

### shouldConvertImpl() {#af6a1350b26889cb5eebc75372ab4d3f5}

<MemberDefinition
  prototype={<>static bool shouldConvertImpl (<a href="#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; Cst)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the given Cst should be converted into a load of a global variable initialized with Cst.

A constant should be converted if it is likely that the materialization of the constant will be tricky. Thus, we give up on zero or undef values.


<XrefSect
  title="Todo"
  permalink="/docs/api/pages/todo/#_todo000004">
Currently, accept only vector related types. Also we give up on all simple vector type to keep the existing behavior. Otherwise, we should push here all the check of the lowering of BUILD&#95;VECTOR. By giving up, we lose the potential benefit of merging constant via global merge and the fact that the same constant is stored only once with this method (versus, as many function that uses the constant for the regular approach, even for float). Again, the simplest solution would be to promote every constant and rematerialize them when they are actually cheap to create.
</XrefSect>

Definition at line <a href="#l00336">336</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

### shouldConvertUse() {#aff43b1c529b1af47195587ca0090f7ec}

<MemberDefinition
  prototype={<>static bool shouldConvertUse (<a href="#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; Cst, <a href="#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; Instr, unsigned OpIdx)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the given use (<a href="/docs/api/classes/llvm/instruction">Instruction</a> + OpIdx) of Cst should be converted into a load of a global variable initialized with Cst.

A use should be converted if it is legal to do so. For instance, it is not legal to turn the mask operand of a shuffle vector into a load of a global variable.

Definition at line <a href="#l00270">270</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a55ebb20f2bc5c5a8638bba9ec50b0a61}

<MemberDefinition
  prototype={<>STATISTIC (NumPromoted, &quot;Number of promoted constants&quot;)</>}>

Definition at line <a href="#l00057">57</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a133efe6d5a6151cfb0c7d45047920524}

<MemberDefinition
  prototype={<>STATISTIC (NumPromotedUses, &quot;Number of promoted constants uses&quot;)</>}>

Definition at line <a href="#l00058">58</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### const {#a90f8350fecae261c25be85d38b451bff}

<MemberDefinition
  prototype="aarch64 promote const">

Definition at line <a href="#l00230">230</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

### false {#a60ff0978cee670022cdc8743945e0eae}

<MemberDefinition
  prototype="aarch64 promote AArch64 Promote Constant false">

Definition at line <a href="#l00231">231</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

### Pass {#a099cf45c11df5059934a293e57614b7c}

<MemberDefinition
  prototype="aarch64 promote AArch64 Promote Constant Pass">

Definition at line <a href="#l00231">231</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

### Stress {#af2894a28a533f577c4252eae792e3358}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; Stress(&quot;aarch64-stress-promote-const&quot;, cl::Hidden, cl::desc(&quot;Promote all vector constants&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00054">54</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;aarch64-promote-const&quot;</>}>

Definition at line <a href="#l00051">51</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp">AArch64PromoteConstant.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//==- AArch64PromoteConstant.cpp - Promote constant to global for AArch64 --==//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This file implements the AArch64PromoteConstant pass which promotes constants</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// to global variables when this is likely to be more efficient. Currently only</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">// types related to constant vector (i.e., constant vector, array of constant</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">// vectors, constant structure with a constant vector field, etc.) are promoted</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">// to global variables. Constant vectors are likely to be lowered in target</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">// constant pool during instruction selection already; therefore, the access</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">// will remain the same (memory load), but the structure types are not split</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">// into different constant pool accesses for each field. A bonus side effect is</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">// that created globals may be merged by the global merge pass.</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">// FIXME: This pass may be useful for other targets too.</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64-h">AArch64.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h">llvm/IR/GlobalValue.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvariable-h">llvm/IR/GlobalVariable.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/institerator-h">llvm/IR/InstIterator.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/pass-h">llvm/Pass.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;aarch64-promote-const&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightComment">// Stress testing mode - disable heuristics.</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54" lineLink="#af2894a28a533f577c4252eae792e3358"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#af2894a28a533f577c4252eae792e3358">Stress</a>(</span><span class="doxyHighlightStringLiteral">&quot;aarch64-stress-promote-const&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlight">                            <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Promote all vector constants&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57" lineLink="#a55ebb20f2bc5c5a8638bba9ec50b0a61"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPromoted, </span><span class="doxyHighlightStringLiteral">&quot;Number of promoted constants&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58" lineLink="#a133efe6d5a6151cfb0c7d45047920524"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumPromotedUses, </span><span class="doxyHighlightStringLiteral">&quot;Number of promoted constants uses&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightComment">//                       AArch64PromoteConstant</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64" lineLink="/docs/api/namespaces/anonymous-aarch64promoteconstant-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightComment">/// Promotes interesting constant into global variables.</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightComment">/// The motivating example is:</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightComment">/// static const uint16&#95;t TableA&#91;32&#93; = &#123;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightComment">///   41944, 40330, 38837, 37450, 36158, 34953, 33826, 32768,</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightComment">///   31776, 30841, 29960, 29128, 28340, 27595, 26887, 26215,</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightComment">///   25576, 24967, 24386, 23832, 23302, 22796, 22311, 21846,</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightComment">///   21400, 20972, 20561, 20165, 19785, 19419, 19066, 18725,</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightComment">/// &#125;;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightComment">/// uint8x16x4&#95;t LoadStatic(void) &#123;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightComment">///   uint8x16x4&#95;t ret;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightComment">///   ret.val&#91;0&#93; = vld1q&#95;u16(TableA +  0);</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightComment">///   ret.val&#91;1&#93; = vld1q&#95;u16(TableA +  8);</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlightComment">///   ret.val&#91;2&#93; = vld1q&#95;u16(TableA + 16);</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightComment">///   ret.val&#91;3&#93; = vld1q&#95;u16(TableA + 24);</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightComment">///   return ret;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightComment">/// &#125;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightComment">/// The constants in this example are folded into the uses. Thus, 4 different</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightComment">/// constants are created.</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlightComment">/// As their type is vector the cheapest way to create them is to load them</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlightComment">/// for the memory.</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlightComment">/// Therefore the final assembly final has 4 different loads. With this pass</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlightComment">/// enabled, only one load is issued for the constants.</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92" lineLink="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a332e5f6f2291c407f086104317716727">AArch64PromoteConstant</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/modulepass/#a723659a08d210f4f566887bda3f9f976">ModulePass</a> &#123;</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94" lineLink="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant">PromotedConstant</a> &#123;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95" lineLink="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant/#af5057fe4659dae804a6517b5a3cfa707"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant/#af5057fe4659dae804a6517b5a3cfa707">ShouldConvert</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96" lineLink="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant/#a1aff3b665cce8bf73903e00a6f87e9be"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &#42;<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant/#a1aff3b665cce8bf73903e00a6f87e9be">GV</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98" lineLink="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a4e357c8b7364d5898a8085b69bf2191c"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a4e357c8b7364d5898a8085b69bf2191c">PromotionCacheTy</a> = <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Constant &#42;, PromotedConstant, 16&gt;</a>;</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100" lineLink="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#af9a1961c8b6f27f10fdc325b99ddc7c2">UpdateRecord</a> &#123;</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101" lineLink="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a96ea0be2eb4d581b87fe8d3489d74121"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a96ea0be2eb4d581b87fe8d3489d74121">C</a>;</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102" lineLink="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a9b7f01abb04d050ee171a2df9f537bc0"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a9b7f01abb04d050ee171a2df9f537bc0">User</a>;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103" lineLink="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a42789c9d5c79b6dfe0353d6b4bda70e3"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a42789c9d5c79b6dfe0353d6b4bda70e3">Op</a>;</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105" lineLink="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#af9a1961c8b6f27f10fdc325b99ddc7c2"><span class="doxyHighlight">    <a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#af9a1961c8b6f27f10fdc325b99ddc7c2">UpdateRecord</a>(<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a96ea0be2eb4d581b87fe8d3489d74121">C</a>, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a9b7f01abb04d050ee171a2df9f537bc0">User</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a42789c9d5c79b6dfe0353d6b4bda70e3">Op</a>)</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">        : <a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a96ea0be2eb4d581b87fe8d3489d74121">C</a>(<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a96ea0be2eb4d581b87fe8d3489d74121">C</a>), <a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a9b7f01abb04d050ee171a2df9f537bc0">User</a>(<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a9b7f01abb04d050ee171a2df9f537bc0">User</a>), <a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a42789c9d5c79b6dfe0353d6b4bda70e3">Op</a>(<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/updaterecord/#a42789c9d5c79b6dfe0353d6b4bda70e3">Op</a>) &#123;&#125;</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109" lineLink="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a71f2383fad0fb27c1a24f243ebc825da"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a71f2383fad0fb27c1a24f243ebc825da">ID</a>;</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111" lineLink="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a332e5f6f2291c407f086104317716727"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a332e5f6f2291c407f086104317716727">AArch64PromoteConstant</a>() : <a href="/docs/api/classes/llvm/modulepass/#a723659a08d210f4f566887bda3f9f976">ModulePass</a>(<a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a71f2383fad0fb27c1a24f243ebc825da">ID</a>) &#123;</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a31f7820c2baf31ef6792320e105af10d">initializeAArch64PromoteConstantPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115" lineLink="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a3f2805049a8572b7ccbb50e28bf92b25"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a3f2805049a8572b7ccbb50e28bf92b25">getPassName</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;AArch64 Promote Constant&quot;</span><span class="doxyHighlight">; &#125;</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlightComment">  /// Iterate over the functions and promote the interesting constants into</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlightComment">  /// global variables with module scope.</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119" lineLink="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a1ef722b33868983f0b2e4f6d3657a8ae"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a1ef722b33868983f0b2e4f6d3657a8ae">runOnModule</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M)</span><span class="doxyHighlightKeyword"> override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a3f2805049a8572b7ccbb50e28bf92b25">getPassName</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/modulepass/#ab0f92e1d06aa28c44dc236c73460ba7a">skipModule</a>(M))</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a4e357c8b7364d5898a8085b69bf2191c">PromotionCacheTy</a> PromotionCache;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MF : M) &#123;</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/entryexitinstrumenter-cpp/#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a>(MF, PromotionCache);</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlightComment">  /// Look for interesting constants used within the given function.</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlightComment">  /// Promote them into global variables, load these global variables within</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlightComment">  /// the related function, so that the number of inserted load is minimal.</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/entryexitinstrumenter-cpp/#a3985f1f39349428d17f0d2b81ebc6349">runOnFunction</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, PromotionCacheTy &amp;PromotionCache);</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This transformation requires dominator info</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> getAnalysisUsage(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/dominatortreewrapperpass">DominatorTreeWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/dominatortreewrapperpass">DominatorTreeWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlightComment">  /// Type to store a list of Uses.</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;Instruction &#42;, unsigned&gt;</a>, 4&gt;;</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlightComment">  /// Map an insertion point to all the uses it dominates.</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">InsertionPoints = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Instruction &#42;, Uses&gt;</a>;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlightComment">  /// Find the closest point that dominates the given Use.</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;findInsertionPoint(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/classes/llvm/user">User</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpNo);</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlightComment">  /// Check if the given insertion point is dominated by an existing</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlightComment">  /// insertion point.</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlightComment">  /// If true, the given use is added to the list of dominated uses for</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlightComment">  /// the related existing point.</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlightComment">  /// \\param NewPt the insertion point to be checked</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlightComment">  /// \\param User the user of the constant</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlightComment">  /// \\param OpNo the operand number of the use</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlightComment">  /// \\param InsertPts existing insertion points</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlightComment">  /// \\pre NewPt and all instruction in InsertPts belong to the same function</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlightComment">  /// \\return true if one of the insertion point in InsertPts dominates NewPt,</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlightComment">  ///         false otherwise</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isDominated(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewPt, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpNo,</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">                   InsertionPoints &amp;InsertPts);</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlightComment">  /// Check if the given insertion point can be merged with an existing</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlightComment">  /// insertion point in a common dominator.</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlightComment">  /// If true, the given use is added to the list of the created insertion</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlightComment">  /// point.</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlightComment">  /// \\param NewPt the insertion point to be checked</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlightComment">  /// \\param User the user of the constant</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlightComment">  /// \\param OpNo the operand number of the use</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlightComment">  /// \\param InsertPts existing insertion points</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlightComment">  /// \\pre NewPt and all instruction in InsertPts belong to the same function</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlightComment">  /// \\pre isDominated returns false for the exact same parameters.</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlightComment">  /// \\return true if it exists an insertion point in InsertPts that could</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlightComment">  ///         have been merged with NewPt in a common dominator,</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlightComment">  ///         false otherwise</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> tryAndMerge(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewPt, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpNo,</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">                   InsertionPoints &amp;InsertPts);</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlightComment">  /// Compute the minimal insertion points to dominates all the interesting</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlightComment">  /// uses of value.</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlightComment">  /// Insertion points are group per function and each insertion point</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlightComment">  /// contains a list of all the uses it dominates within the related function</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlightComment">  /// \\param User the user of the constant</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlightComment">  /// \\param OpNo the operand number of the constant</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlightComment">  /// \\param&#91;out&#93; InsertPts output storage of the analysis</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> computeInsertionPoint(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpNo,</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">                             InsertionPoints &amp;InsertPts);</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlightComment">  /// Insert a definition of a new global variable at each point contained in</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlightComment">  /// InsPtsPerFunc and update the related uses (also contained in</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlightComment">  /// InsPtsPerFunc).</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> insertDefinitions(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &amp;GV,</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">                         InsertionPoints &amp;InsertPts);</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlightComment">  /// Do the constant promotion indicated by the Updates records, keeping track</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlightComment">  /// of globals in PromotionCache.</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> promoteConstants(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;UpdateRecord&gt;</a> &amp;Updates,</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">                        PromotionCacheTy &amp;PromotionCache);</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlightComment">  /// Transfer the list of dominated uses of IPI to NewPt in InsertPts.</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlightComment">  /// Append Use to this list and delete the entry of IPI in InsertPts.</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> appendAndTransferDominatedUses(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewPt,</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpNo,</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">                                             InsertionPoints::iterator &amp;IPI,</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">                                             InsertionPoints &amp;InsertPts) &#123;</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Record the dominated use.</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">    IPI-&gt;second.emplace&#95;back(<a href="/docs/api/classes/llvm/user">User</a>, OpNo);</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Transfer the dominated uses of IPI to NewPt</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Inserting into the DenseMap may invalidate existing iterator.</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Keep a copy of the key to find the iterator to erase.  Keep a copy of the</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value so that we don&#39;t have to dereference IPI-&gt;second.</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OldInstr = IPI-&gt;first;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a> OldUses = std::move(IPI-&gt;second);</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">    InsertPts&#91;NewPt&#93; = std::move(OldUses);</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Erase IPI.</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">    InsertPts.erase(OldInstr);</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a71f2383fad0fb27c1a24f243ebc825da">AArch64PromoteConstant::ID</a> = 0;</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227" lineLink="#acddbaf5fc5a8735431a050af39909d9f"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(<a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a332e5f6f2291c407f086104317716727">AArch64PromoteConstant</a>, </span><span class="doxyHighlightStringLiteral">&quot;aarch64-promote-const&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">                      </span><span class="doxyHighlightStringLiteral">&quot;AArch64 Promote Constant Pass&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/dominatortreewrapperpass">DominatorTreeWrapperPass</a>)</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230" lineLink="#a90f8350fecae261c25be85d38b451bff"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(<a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a332e5f6f2291c407f086104317716727">AArch64PromoteConstant</a>, </span><span class="doxyHighlightStringLiteral">&quot;aarch64-promote-const&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231" lineLink="#a60ff0978cee670022cdc8743945e0eae"><span class="doxyHighlight">                    </span><span class="doxyHighlightStringLiteral">&quot;AArch64 Promote Constant Pass&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/false">false</a>, <a href="/docs/api/namespaces/false">false</a>)</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233" lineLink="/docs/api/namespaces/llvm/#ae1dee0e28b161d52ffd8a6921ad83e2b"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/modulepass">ModulePass</a> &#42;<a href="/docs/api/namespaces/llvm">llvm</a>::<a href="/docs/api/namespaces/llvm/#ae1dee0e28b161d52ffd8a6921ad83e2b">createAArch64PromoteConstantPass</a>() &#123;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a332e5f6f2291c407f086104317716727">AArch64PromoteConstant</a>();</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlightComment">/// Check if the given type uses a vector type.</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238" lineLink="#a1a93639bd72c9cc80cf001e17599ff87"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a1a93639bd72c9cc80cf001e17599ff87">isConstantUsingVectorTy</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/type">Type</a> &#42;CstTy) &#123;</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CstTy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>())</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CstTy-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>()) &#123;</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EltIdx = 0, EndEltIdx = CstTy-&gt;<a href="/docs/api/classes/llvm/type/#a58e54adaa7672bbf72091254a5391137">getStructNumElements</a>();</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">         EltIdx &lt; EndEltIdx; ++EltIdx)</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a1a93639bd72c9cc80cf001e17599ff87">isConstantUsingVectorTy</a>(CstTy-&gt;<a href="/docs/api/classes/llvm/type/#a15d34f8dc07013df378e0fb3d0134c08">getStructElementType</a>(EltIdx)))</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CstTy-&gt;<a href="/docs/api/classes/llvm/type/#a2a394517076e7dd2bdcd7dde33dfcb7d">isArrayTy</a>())</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a1a93639bd72c9cc80cf001e17599ff87">isConstantUsingVectorTy</a>(CstTy-&gt;<a href="/docs/api/classes/llvm/type/#a3fb19a71e602dce8ff646c3ac2f4ca0f">getArrayElementType</a>());</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlightComment">// Returns true if \\p C contains only ConstantData leafs and no global values,</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlightComment">// block addresses or constant expressions. Traverses ConstantAggregates.</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253" lineLink="#a94b1b5e9307f524668a97d9628b3de2a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a94b1b5e9307f524668a97d9628b3de2a">containsOnlyConstantData</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &#123;</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantData&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GlobalValue&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BlockAddress&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantExpr&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;operands(), &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/use">Use</a> &amp;U) &#123;</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">    return containsOnlyConstantData(cast&lt;Constant&gt;(&amp;U));</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlightComment">/// Check if the given use (Instruction + OpIdx) of Cst should be converted into</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlightComment">/// a load of a global variable initialized with Cst.</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlightComment">/// A use should be converted if it is legal to do so.</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlightComment">/// For instance, it is not legal to turn the mask operand of a shuffle vector</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlightComment">/// into a load of a global variable.</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270" lineLink="#aff43b1c529b1af47195587ca0090f7ec"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aff43b1c529b1af47195587ca0090f7ec">shouldConvertUse</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Cst, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr,</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpIdx) &#123;</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// shufflevector instruction expects a const for the mask argument, i.e., the</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// third argument. Do not promote this use in that case.</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;const ShuffleVectorInst&gt;</a>(Instr) &amp;&amp; OpIdx == 2)</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// extractvalue instruction expects a const idx.</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;const ExtractValueInst&gt;</a>(Instr) &amp;&amp; OpIdx &gt; 0)</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// extractvalue instruction expects a const idx.</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;const InsertValueInst&gt;</a>(Instr) &amp;&amp; OpIdx &gt; 1)</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;const AllocaInst&gt;</a>(Instr) &amp;&amp; OpIdx &gt; 0)</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Alignment argument must be constant.</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;const LoadInst&gt;</a>(Instr) &amp;&amp; OpIdx &gt; 0)</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Alignment argument must be constant.</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;const StoreInst&gt;</a>(Instr) &amp;&amp; OpIdx &gt; 1)</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Index must be constant.</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;const GetElementPtrInst&gt;</a>(Instr) &amp;&amp; OpIdx &gt; 0)</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Personality function and filters must be constant.</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Give up on that instruction.</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;const LandingPadInst&gt;</a>(Instr))</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Switch instruction expects constants to compare to.</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;const SwitchInst&gt;</a>(Instr))</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Expected address must be a constant.</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;const IndirectBrInst&gt;</a>(Instr))</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not mess with intrinsics.</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;const IntrinsicInst&gt;</a>(Instr))</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not mess with inline asm.</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;const CallInst&gt;</a>(Instr);</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !(CI &amp;&amp; CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a018f0394a375233d538109968b76a05a">isInlineAsm</a>());</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlightComment">/// Check if the given Cst should be converted into</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlightComment">/// a load of a global variable initialized with Cst.</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlightComment">/// A constant should be converted if it is likely that the materialization of</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlightComment">/// the constant will be tricky. Thus, we give up on zero or undef values.</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlightComment">/// \\todo Currently, accept only vector related types.</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlightComment">/// Also we give up on all simple vector type to keep the existing</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlightComment">/// behavior. Otherwise, we should push here all the check of the lowering of</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlightComment">/// BUILD&#95;VECTOR. By giving up, we lose the potential benefit of merging</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlightComment">/// constant via global merge and the fact that the same constant is stored</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlightComment">/// only once with this method (versus, as many function that uses the constant</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlightComment">/// for the regular approach, even for float).</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlightComment">/// Again, the simplest solution would be to promote every</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlightComment">/// constant and rematerialize them when they are actually cheap to create.</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336" lineLink="#af6a1350b26889cb5eebc75372ab4d3f5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#af6a1350b26889cb5eebc75372ab4d3f5">shouldConvertImpl</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Cst) &#123;</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;const UndefValue&gt;</a>(Cst))</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: In some cases, it may be interesting to promote in memory</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a zero initialized constant.</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// E.g., when the type of Cst require more instructions than the</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// adrp/add/load sequence or when this sequence can be shared by several</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instances of Cst.</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ideally, we could promote this into a global and rematerialize the constant</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// when it was a bad idea.</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cst-&gt;<a href="/docs/api/classes/llvm/constant/#ad97fc23e85a854a19101bf8e861356aa">isZeroValue</a>())</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/earlyifconversion-cpp/#ab03b4c4121954359c7380f0e60888bf5">Stress</a>)</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: see function \\todo</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>())</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a1a93639bd72c9cc80cf001e17599ff87">isConstantUsingVectorTy</a>(Cst-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360" lineLink="#ada41eab274cc944643f8b6a74dc1e8a0"><span class="doxyHighlight"><a href="#ada41eab274cc944643f8b6a74dc1e8a0">shouldConvert</a>(<a href="/docs/api/classes/llvm/constant">Constant</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>,</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">              <a href="/docs/api/classes/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/#a4e357c8b7364d5898a8085b69bf2191c">AArch64PromoteConstant::PromotionCacheTy</a> &amp;PromotionCache) &#123;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Converted = PromotionCache.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">      std::make&#95;pair(&amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant">AArch64PromoteConstant::PromotedConstant</a>()));</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Converted.second)</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">    Converted.first-&gt;second.ShouldConvert = <a href="#af6a1350b26889cb5eebc75372ab4d3f5">shouldConvertImpl</a>(&amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Converted.first-&gt;second.ShouldConvert;</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;AArch64PromoteConstant::findInsertionPoint(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/classes/llvm/user">User</a>,</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">                                                        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpNo) &#123;</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this user is a phi, the insertion point is in the related</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// incoming basic block.</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PhiInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;<a href="/docs/api/classes/llvm/user">User</a>))</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PhiInst-&gt;getIncomingBlock(OpNo)-&gt;getTerminator();</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;<a href="/docs/api/classes/llvm/user">User</a>;</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AArch64PromoteConstant::isDominated(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewPt, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>,</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">                                         </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpNo,</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">                                         InsertionPoints &amp;InsertPts) &#123;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT = getAnalysis&lt;DominatorTreeWrapperPass&gt;(</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">      &#42;NewPt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent()).getDomTree();</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Traverse all the existing insertion points and check if one is dominating</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NewPt. If it is, remember that.</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;IPI : InsertPts) &#123;</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewPt == IPI.first || DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(IPI.first, NewPt) ||</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// When IPI.first is a terminator instruction, DT may think that</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the result is defined on the edge.</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Here we are testing the insertion point, not the definition.</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">        (IPI.first-&gt;getParent() != NewPt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() &amp;&amp;</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">         DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(IPI.first-&gt;getParent(), NewPt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()))) &#123;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// No need to insert this point. Just record the dominated use.</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Insertion point dominated by:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(IPI.first-&gt;print(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">      IPI.second.emplace&#95;back(<a href="/docs/api/classes/llvm/user">User</a>, OpNo);</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AArch64PromoteConstant::tryAndMerge(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NewPt, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>,</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">                                         </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpNo,</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">                                         InsertionPoints &amp;InsertPts) &#123;</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT = getAnalysis&lt;DominatorTreeWrapperPass&gt;(</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">      &#42;NewPt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent()).getDomTree();</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB = NewPt-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Traverse all the existing insertion point and check if one is dominated by</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NewPt and thus useless or can be combined with NewPt into a common</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dominator.</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (InsertionPoints::iterator IPI = InsertPts.begin(),</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">                                 EndIPI = InsertPts.end();</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">       IPI != EndIPI; ++IPI) &#123;</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CurBB = IPI-&gt;first-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewBB == CurBB) &#123;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Instructions are in the same block.</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// By construction, NewPt is dominating the other.</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Indeed, isDominated returned false with the exact same arguments.</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Merge insertion point with:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(IPI-&gt;first-&gt;print(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nat considered insertion point.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">      appendAndTransferDominatedUses(NewPt, <a href="/docs/api/classes/llvm/user">User</a>, OpNo, IPI, InsertPts);</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Look for a common dominator</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CommonDominator = DT.<a href="/docs/api/classes/llvm/dominatortree/#a2ec50ab2c78eff965caf3da71cd08be4">findNearestCommonDominator</a>(NewBB, CurBB);</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If none exists, we cannot merge these two points.</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CommonDominator)</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CommonDominator != NewBB) &#123;</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// By construction, the CommonDominator cannot be CurBB.</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CommonDominator != CurBB &amp;&amp;</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Instruction has not been rejected during isDominated check!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Take the last instruction of the CommonDominator as insertion point</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">      NewPt = CommonDominator-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// else, CommonDominator is the block of NewBB, hence NewBB is the last</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// possible insertion point in that block.</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Merge insertion point with:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(IPI-&gt;first-&gt;print(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(NewPt-&gt;<a href="/docs/api/classes/llvm/value/#a1e56c814d11206720cc23059b871128d">print</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">    appendAndTransferDominatedUses(NewPt, <a href="/docs/api/classes/llvm/user">User</a>, OpNo, IPI, InsertPts);</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> AArch64PromoteConstant::computeInsertionPoint(</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/classes/llvm/user">User</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpNo, InsertionPoints &amp;InsertPts) &#123;</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Considered use, opidx &quot;</span><span class="doxyHighlight"> &lt;&lt; OpNo &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/classes/llvm/user">User</a>-&gt;<a href="/docs/api/classes/llvm/value/#a1e56c814d11206720cc23059b871128d">print</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/structs/insertionpoint">InsertionPoint</a> = findInsertionPoint(&#42;<a href="/docs/api/classes/llvm/user">User</a>, OpNo);</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Considered insertion point:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/structs/insertionpoint">InsertionPoint</a>-&gt;print(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isDominated(<a href="/docs/api/structs/insertionpoint">InsertionPoint</a>, <a href="/docs/api/classes/llvm/user">User</a>, OpNo, InsertPts))</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This insertion point is useful, check if we can merge some insertion</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// point in a common dominator or if NewPt dominates an existing one.</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (tryAndMerge(<a href="/docs/api/structs/insertionpoint">InsertionPoint</a>, <a href="/docs/api/classes/llvm/user">User</a>, OpNo, InsertPts))</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Keep considered insertion point\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is definitely useful by its own</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">  InsertPts&#91;<a href="/docs/api/structs/insertionpoint">InsertionPoint</a>&#93;.emplace&#95;back(<a href="/docs/api/classes/llvm/user">User</a>, OpNo);</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481" lineLink="#ab5c7f0f9f87d69820d8e4d8b31f4b0ff"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ab5c7f0f9f87d69820d8e4d8b31f4b0ff">ensurePromotedGV</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/constant">Constant</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>,</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">                             <a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant">AArch64PromoteConstant::PromotedConstant</a> &amp;PC) &#123;</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PC.<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant/#af5057fe4659dae804a6517b5a3cfa707">ShouldConvert</a> &amp;&amp;</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected that we should convert this to a global&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PC.<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant/#a1aff3b665cce8bf73903e00a6f87e9be">GV</a>)</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">  PC.<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant/#a1aff3b665cce8bf73903e00a6f87e9be">GV</a> = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">      &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent(), <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getType(), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;&#95;PromotedConst&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/globalvalue/#a05c6b3b9372b56d130e005db4837da62a7483b56cbb22b39c485b4648ea3374b0">GlobalVariable::NotThreadLocal</a>);</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">  PC.<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant/#a1aff3b665cce8bf73903e00a6f87e9be">GV</a>-&gt;<a href="/docs/api/classes/llvm/globalvariable/#a095f8f031d99ce3c0b25478713293dea">setInitializer</a>(&amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Global replacement: &quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(PC.<a href="/docs/api/structs/anonymous-namespace-aarch64promoteconstant-cpp-/aarch64promoteconstant/promotedconstant/#a1aff3b665cce8bf73903e00a6f87e9be">GV</a>-&gt;<a href="/docs/api/classes/llvm/value/#a1e56c814d11206720cc23059b871128d">print</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">  ++NumPromoted;</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> AArch64PromoteConstant::insertDefinitions(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a> &amp;PromotedGV,</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">                                               InsertionPoints &amp;InsertPts) &#123;</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do more checking for debug purposes.</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &amp;DT = getAnalysis&lt;DominatorTreeWrapperPass&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>).getDomTree();</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!InsertPts.empty() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Empty uses does not need a definition&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;IPI : InsertPts) &#123;</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create the load of the global variable.</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(IPI.first);</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LoadedCst =</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">        Builder.CreateLoad(PromotedGV.<a href="/docs/api/classes/llvm/globalvalue/#af1dd2acfc2950742e41a64a342b15c80">getValueType</a>(), &amp;PromotedGV);</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;New def: &quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(LoadedCst-&gt;<a href="/docs/api/classes/llvm/value/#a1e56c814d11206720cc23059b871128d">print</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update the dominated uses.</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/use">Use</a> : IPI.second) &#123;</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT.<a href="/docs/api/classes/llvm/dominatortree/#a5c69311e8d44898dac36a155c3d8691d">dominates</a>(LoadedCst,</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">                          findInsertionPoint(&#42;<a href="/docs/api/classes/llvm/use">Use</a>.first, <a href="/docs/api/classes/llvm/use">Use</a>.second)) &amp;&amp;</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Inserted definition does not dominate all its uses!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Use to update &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/classes/llvm/use">Use</a>.second &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;:&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/use">Use</a>.first-&gt;<a href="/docs/api/classes/llvm/value/#a1e56c814d11206720cc23059b871128d">print</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>());</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/use">Use</a>.first-&gt;setOperand(<a href="/docs/api/classes/llvm/use">Use</a>.second, LoadedCst);</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">      ++NumPromotedUses;</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> AArch64PromoteConstant::promoteConstants(</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;UpdateRecord&gt;</a> &amp;Updates,</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">    PromotionCacheTy &amp;PromotionCache) &#123;</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Promote the constants.</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> U = Updates.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Updates.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>(); U != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;) &#123;</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#42;&#42; Compute insertion points &#42;&#42;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a> = U;</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>-&gt;C;</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">    InsertionPoints InsertPts;</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">      computeInsertionPoint(U-&gt;User, U-&gt;Op, InsertPts);</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (++U != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> &amp;&amp; U-&gt;C == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>);</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Promotion = PromotionCache&#91;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>&#93;;</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">    <a href="#ab5c7f0f9f87d69820d8e4d8b31f4b0ff">ensurePromotedGV</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, Promotion);</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">    insertDefinitions(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;Promotion.GV, InsertPts);</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AArch64PromoteConstant::runOnFunction(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">                                           PromotionCacheTy &amp;PromotionCache) &#123;</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for instructions using constant vector. Promote that constant to a</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// global variable. Create as few loads of this variable as possible and</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// update the uses accordingly.</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;UpdateRecord, 64&gt;</a> Updates;</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) &#123;</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Traverse the operand, looking for constant vectors. Replace them by a</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// load of a global variable of constant vector type.</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) &#123;</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Cst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(U);</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// There is no point in promoting global values as they are already</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// global. Do not promote constants containing constant expression, global</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// values or blockaddresses either, as they may require some code</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// expansion.</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Cst || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GlobalValue&gt;</a>(Cst) || !<a href="#a94b1b5e9307f524668a97d9628b3de2a">containsOnlyConstantData</a>(Cst))</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check if this constant is worth promoting.</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#ada41eab274cc944643f8b6a74dc1e8a0">shouldConvert</a>(&#42;Cst, PromotionCache))</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check if this use should be promoted.</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpNo = &amp;U - <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.op&#95;begin();</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#aff43b1c529b1af47195587ca0090f7ec">shouldConvertUse</a>(Cst, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, OpNo))</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">      Updates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(Cst, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, OpNo);</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Updates.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">  promoteConstants(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Updates, PromotionCache);</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
