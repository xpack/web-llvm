---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/target/lib/target/amdgpu/sioptimizevgprliverange-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `SIOptimizeVGPRLiveRange.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>

This pass tries to remove unnecessary VGPR live ranges in divergent if-else structures and waterfall loops. <a href="#details">More...</a>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="SIOptimizeVGPRLiveRange.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/amdgpu/sioptimizevgprliverange-h"
  isLocal="true" />
<IncludesListItem
  filePath="AMDGPU.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpu-h"
  isLocal="true" />
<IncludesListItem
  filePath="GCNSubtarget.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/amdgpu/gcnsubtarget-h"
  isLocal="true" />
<IncludesListItem
  filePath="MCTargetDesc/AMDGPUMCTargetDesc.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/amdgpu/lib/target/amdgpu/mctargetdesc/amdgpumctargetdesc-h"
  isLocal="true" />
<IncludesListItem
  filePath="SIMachineFunctionInfo.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/amdgpu/simachinefunctioninfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/LiveVariables.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/livevariables-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineDominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinedominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineLoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineloopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetRegisterInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetregisterinfo-h"
  isLocal="true" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-sioptimizevgprliverange-cpp-">anonymous&#123;SIOptimizeVGPRLiveRange.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange">SIOptimizeVGPRLiveRange</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy">SIOptimizeVGPRLiveRangeLegacy</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#ad745a4d895a366bdfc3486d667aaa3b2">INITIALIZE&#95;PASS&#95;BEGIN</a> (SIOptimizeVGPRLiveRangeLegacy, DEBUG&#95;TYPE, &quot;SI Optimize VGPR LiveRange&quot;, false, false) INITIALIZE&#95;PASS&#95;END(SIOptimizeVGPRLiveRangeLegacy</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#a030569d5a541b6110f2ae1b6a3413a58">DEBUG&#95;TYPE</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a10fde6bea2f819ef87db20d8fe3085c7">SI</a> Optimize VGPR</>}
  name={<><a href="#a3f8ae3038974369df91a2df8bf131749">false</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a10fde6bea2f819ef87db20d8fe3085c7">SI</a> Optimize VGPR</>}
  name={<><a href="#acc192e3e53887e1d6fa56abbe10530e6">LiveRange</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;si-<a href="/docs/api/files/lib/lib/target/lib/target/arm/armloadstoreoptimizer-cpp/#ab3bfc7321acfbc3619170d5bed907cb3">opt</a>-vgpr-liverange&quot;</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

This pass tries to remove unnecessary VGPR live ranges in divergent if-else structures and waterfall loops.

When we do structurization, we usually transform an if-else into two successive if-then (with a flow block to do predicate inversion). Consider a simple case after structurization: A divergent value a was defined before if-else and used in both THEN (use in THEN is optional) and ELSE part: bb.if: a = ... ... bb.then: ... = op a ... // a can be dead here bb.flow: ... bb.else: ... = a ... bb.endif

As register allocator has no idea of the thread-control-flow, it will just assume a would be alive in the whole range of bb.then because of a later use in bb.else. On <a href="/docs/api/namespaces/llvm/amdgpu">AMDGPU</a> architecture, the VGPR is accessed with respect to exec mask. For this if-else case, the lanes active in bb.then will be inactive in bb.else, and vice-versa. So we are safe to say that a was dead after the last use in bb.then until the end of the block. The reason is the instructions in bb.then will only overwrite lanes that will never be accessed in bb.else.

This pass aims to tell register allocator that a is in-fact dead, through inserting a phi-node in bb.flow saying that a is undef when coming from bb.then, and then replace the uses in the bb.else with the result of newly inserted phi.

Two key conditions must be met to ensure correctness: 1.) The def-point should be in the same loop-level as if-else-endif to make sure the second loop iteration still get correct data. 2.) There should be no further uses after the IF-ELSE region.

Waterfall loops get inserted around instructions that use divergent values but can only be executed with a uniform value. For example an indirect call to a divergent address: bb.start: a = ... fun = ... ... bb.loop: call fun (a) ... // a can be dead here loop bb.loop

The loop block is executed multiple times, but it is run exactly once for each active lane. Similar to the if-else case, the register allocator assumes that a is live throughout the loop as it is used again in the next iteration. If a is a VGPR that is unused after the loop, it does not need to be live after its last use in the loop block. By inserting a phi-node at the start of bb.loop that is undef when coming from bb.loop, the register allocation knows that the value of a does not need to be preserved through iterations of the loop.

<SectionDefinition>

## Functions

### INITIALIZE&#95;PASS&#95;BEGIN() {#ad745a4d895a366bdfc3486d667aaa3b2}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (SIOptimizeVGPRLiveRangeLegacy, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, &quot;SI Optimize VGPR LiveRange&quot;, false, false)</>}>

Definition at line <a href="#l00626">626</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/sioptimizevgprliverange-cpp">SIOptimizeVGPRLiveRange.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### DEBUG&#95;TYPE {#a030569d5a541b6110f2ae1b6a3413a58}

<MemberDefinition
  prototype={<>DEBUG&#95;TYPE</>}>

Definition at line <a href="#l00631">631</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/sioptimizevgprliverange-cpp">SIOptimizeVGPRLiveRange.cpp</a>.
</MemberDefinition>

### false {#a3f8ae3038974369df91a2df8bf131749}

<MemberDefinition
  prototype="SI Optimize VGPR false">

Definition at line <a href="#l00632">632</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/sioptimizevgprliverange-cpp">SIOptimizeVGPRLiveRange.cpp</a>.
</MemberDefinition>

### LiveRange {#acc192e3e53887e1d6fa56abbe10530e6}

<MemberDefinition
  prototype="SI Optimize VGPR LiveRange">

Definition at line <a href="#l00632">632</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/sioptimizevgprliverange-cpp">SIOptimizeVGPRLiveRange.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;si-<a href="/docs/api/files/lib/lib/target/lib/target/arm/armloadstoreoptimizer-cpp/#ab3bfc7321acfbc3619170d5bed907cb3">opt</a>-vgpr-liverange&quot;</>}>

Definition at line <a href="#l00086">86</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/sioptimizevgprliverange-cpp">SIOptimizeVGPRLiveRange.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===--------------------- SIOptimizeVGPRLiveRange.cpp  -------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">/// \\file</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">/// This pass tries to remove unnecessary VGPR live ranges in divergent if-else</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">/// structures and waterfall loops.</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">/// When we do structurization, we usually transform an if-else into two</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">/// successive if-then (with a flow block to do predicate inversion). Consider a</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">/// simple case after structurization: A divergent value %a was defined before</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">/// if-else and used in both THEN (use in THEN is optional) and ELSE part:</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">///    bb.if:</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">///      %a = ...</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">///      ...</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">///    bb.then:</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">///      ... = op %a</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightComment">///      ... // %a can be dead here</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightComment">///    bb.flow:</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightComment">///      ...</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightComment">///    bb.else:</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightComment">///      ... = %a</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightComment">///      ...</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightComment">///    bb.endif</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightComment">///  As register allocator has no idea of the thread-control-flow, it will just</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightComment">///  assume %a would be alive in the whole range of bb.then because of a later</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightComment">///  use in bb.else. On AMDGPU architecture, the VGPR is accessed with respect</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightComment">///  to exec mask. For this if-else case, the lanes active in bb.then will be</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightComment">///  inactive in bb.else, and vice-versa. So we are safe to say that %a was dead</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightComment">///  after the last use in bb.then until the end of the block. The reason is</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightComment">///  the instructions in bb.then will only overwrite lanes that will never be</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightComment">///  accessed in bb.else.</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightComment">///  This pass aims to tell register allocator that %a is in-fact dead,</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightComment">///  through inserting a phi-node in bb.flow saying that %a is undef when coming</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightComment">///  from bb.then, and then replace the uses in the bb.else with the result of</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightComment">///  newly inserted phi.</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightComment">///  Two key conditions must be met to ensure correctness:</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightComment">///  1.) The def-point should be in the same loop-level as if-else-endif to make</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightComment">///      sure the second loop iteration still get correct data.</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightComment">///  2.) There should be no further uses after the IF-ELSE region.</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightComment">/// Waterfall loops get inserted around instructions that use divergent values</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightComment">/// but can only be executed with a uniform value. For example an indirect call</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightComment">/// to a divergent address:</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightComment">///    bb.start:</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightComment">///      %a = ...</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightComment">///      %fun = ...</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightComment">///      ...</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightComment">///    bb.loop:</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightComment">///      call %fun (%a)</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightComment">///      ... // %a can be dead here</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightComment">///      loop %bb.loop</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightComment">///  The loop block is executed multiple times, but it is run exactly once for</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightComment">///  each active lane. Similar to the if-else case, the register allocator</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightComment">///  assumes that %a is live throughout the loop as it is used again in the next</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightComment">///  iteration. If %a is a VGPR that is unused after the loop, it does not need</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightComment">///  to be live after its last use in the loop block. By inserting a phi-node at</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightComment">///  the start of bb.loop that is undef when coming from bb.loop, the register</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightComment">///  allocation knows that the value of %a does not need to be preserved through</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightComment">///  iterations of the loop.</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/sioptimizevgprliverange-h">SIOptimizeVGPRLiveRange.h</a>&quot;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpu-h">AMDGPU.h</a>&quot;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/gcnsubtarget-h">GCNSubtarget.h</a>&quot;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/lib/target/amdgpu/mctargetdesc/amdgpumctargetdesc-h">MCTargetDesc/AMDGPUMCTargetDesc.h</a>&quot;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/simachinefunctioninfo-h">SIMachineFunctionInfo.h</a>&quot;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/livevariables-h">llvm/CodeGen/LiveVariables.h</a>&quot;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinedominators-h">llvm/CodeGen/MachineDominators.h</a>&quot;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineloopinfo-h">llvm/CodeGen/MachineLoopInfo.h</a>&quot;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetregisterinfo-h">llvm/CodeGen/TargetRegisterInfo.h</a>&quot;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;si-opt-vgpr-liverange&quot;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88" lineLink="/docs/api/namespaces/anonymous-sioptimizevgprliverange-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a6c869caeb4216a049b9090c45733a594">SIOptimizeVGPRLiveRange</a> &#123;</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/siregisterinfo">SIRegisterInfo</a> &#42;TRI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/siinstrinfo">SIInstrInfo</a> &#42;TII = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/livevariables">LiveVariables</a> &#42;LV = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinedominatortree">MachineDominatorTree</a> &#42;MDT = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineloopinfo">MachineLoopInfo</a> &#42;Loops = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineregisterinfo">MachineRegisterInfo</a> &#42;MRI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a6c869caeb4216a049b9090c45733a594"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a6c869caeb4216a049b9090c45733a594">SIOptimizeVGPRLiveRange</a>(<a href="/docs/api/classes/llvm/livevariables">LiveVariables</a> &#42;LV, <a href="/docs/api/classes/llvm/machinedominatortree">MachineDominatorTree</a> &#42;MDT,</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">                          <a href="/docs/api/classes/llvm/machineloopinfo">MachineLoopInfo</a> &#42;Loops)</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">      : LV(LV), MDT(MDT), Loops(Loops) &#123;&#125;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> run(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF);</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;getElseTarget(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> collectElseRegionBlocks(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>,</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Endif,</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 16&gt;</a> &amp;) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">  collectCandidateRegisters(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;If, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>,</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Endif,</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 16&gt;</a> &amp;ElseBlocks,</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Register&gt;</a> &amp;CandidateRegs) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> collectWaterfallCandidateRegisters(</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopHeader, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopEnd,</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;Register, 16&gt;</a> &amp;CandidateRegs,</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 2&gt;</a> &amp;Blocks,</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineInstr &#42;&gt;</a> &amp;Instructions) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> findNonPHIUsesInBlock(<a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineInstr &#42;&gt;</a> &amp;<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> updateLiveRangeInThenRegion(<a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;If,</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> updateLiveRangeInElseRegion(</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/register">Register</a> NewReg, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>,</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Endif,</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 16&gt;</a> &amp;ElseBlocks) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">  optimizeLiveRange(<a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;If,</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Endif,</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 16&gt;</a> &amp;ElseBlocks) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> optimizeWaterfallLiveRange(</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopHeader,</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 2&gt;</a> &amp;LoopBlocks,</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineInstr &#42;&gt;</a> &amp;Instructions) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#a68a1a4864199d14588dd82c0a5eee4dd">SIOptimizeVGPRLiveRangeLegacy</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a> &#123;</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#ac0ea6d061ee2d141a7ba5896f2defa6b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#ac0ea6d061ee2d141a7ba5896f2defa6b">ID</a>;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#a68a1a4864199d14588dd82c0a5eee4dd"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#a68a1a4864199d14588dd82c0a5eee4dd">SIOptimizeVGPRLiveRangeLegacy</a>() : <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a>(<a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#ac0ea6d061ee2d141a7ba5896f2defa6b">ID</a>) &#123;&#125;</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> runOnMachineFunction(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#afa6bc14ab1a74668b86ade19071c0830"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#afa6bc14ab1a74668b86ade19071c0830">getPassName</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightStringLiteral">&quot;SI Optimize VGPR LiveRange&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#a6b6807c43df612f845d9d5bea25804e6"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#a6b6807c43df612f845d9d5bea25804e6">getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/livevariableswrapperpass">LiveVariablesWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machinedominatortreewrapperpass">MachineDominatorTreeWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machineloopinfowrapperpass">MachineLoopInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/livevariableswrapperpass">LiveVariablesWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/machinedominatortreewrapperpass">MachineDominatorTreeWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae9356b720f6fbab112d809738dcc4f2a">addPreserved</a>&lt;<a href="/docs/api/classes/llvm/machineloopinfowrapperpass">MachineLoopInfoWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinefunctionpass/#a864fd57b4304ef933b3281d0ef85a88e">MachineFunctionPass::getAnalysisUsage</a>(AU);</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#a078447a30cacbeb6a45627a607bf8a30"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunctionproperties">MachineFunctionProperties</a> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#a078447a30cacbeb6a45627a607bf8a30">getRequiredProperties</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunctionproperties">MachineFunctionProperties</a>().<a href="/docs/api/classes/llvm/machinefunctionproperties/#aa7780563d7ca260d0ae67d957b56427f">set</a>(</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/machinefunctionproperties/#ad85237c6c667e4713efe8921e9c32ac1a4fc3b812627e58da17a703f73013db96">MachineFunctionProperties::Property::IsSSA</a>);</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#ac53e8af16ea744f989d915430ff14acf"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunctionproperties">MachineFunctionProperties</a> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#ac53e8af16ea744f989d915430ff14acf">getClearedProperties</a>()</span><span class="doxyHighlightKeyword"> const override </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunctionproperties">MachineFunctionProperties</a>().<a href="/docs/api/classes/llvm/machinefunctionproperties/#aa7780563d7ca260d0ae67d957b56427f">set</a>(</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/machinefunctionproperties/#ad85237c6c667e4713efe8921e9c32ac1a76eece0bfd57256980609b66faaef22c">MachineFunctionProperties::Property::NoPHIs</a>);</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlightComment">// Check whether the MBB is a else flow block and get the branching target which</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlightComment">// is the Endif block</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#acebe90db937b6d2feb9c97f0c37b33ef"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#acebe90db937b6d2feb9c97f0c37b33ef">SIOptimizeVGPRLiveRange::getElseTarget</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BR : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;terminators()) &#123;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BR.getOpcode() == AMDGPU::SI&#95;ELSE)</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BR.getOperand(2).getMBB();</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a43905da53a96adf8e5dfbe0f18f60e3c"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a43905da53a96adf8e5dfbe0f18f60e3c">SIOptimizeVGPRLiveRange::collectElseRegionBlocks</a>(</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Endif,</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 16&gt;</a> &amp;Blocks)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a> != Endif);</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = Endif;</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Cur = 0;</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;predecessors()) &#123;</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred != <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>)</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">        Blocks.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Pred);</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cur &lt; Blocks.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>())</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = Blocks&#91;Cur++&#93;;</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Found Else blocks: &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : Blocks)</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39; &#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlightComment">/// Find the instructions(excluding phi) in \\p MBB that uses the \\p Reg.</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#ab88eabb9aada899a03069797171cd2d5"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#ab88eabb9aada899a03069797171cd2d5">SIOptimizeVGPRLiveRange::findNonPHIUsesInBlock</a>(</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineInstr &#42;&gt;</a> &amp;<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a> : MRI-&gt;use&#95;nodbg&#95;instructions(Reg)) &#123;</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>.getParent() == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> &amp;&amp; !<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>.isPHI())</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.push&#95;back(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>);</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlightComment">/// Collect the killed registers in the ELSE region which are not alive through</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlightComment">/// the whole THEN region.</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a5290bdffbf68a26e47345d1bb2abb246"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a5290bdffbf68a26e47345d1bb2abb246">SIOptimizeVGPRLiveRange::collectCandidateRegisters</a>(</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;If, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Endif,</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 16&gt;</a> &amp;ElseBlocks,</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Register&gt;</a> &amp;CandidateRegs)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;Register, 8&gt;</a> KillsInElse;</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Else : ElseBlocks) &#123;</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : Else-&gt;instrs()) &#123;</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugInstr())</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.operands()) &#123;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isReg() || !MO.getReg() || MO.isDef())</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/register">Register</a> MOReg = MO.getReg();</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We can only optimize AGPR/VGPR virtual register</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MOReg.<a href="/docs/api/classes/llvm/register/#affdbf5b92ed7e01352e2f39466efbe21">isPhysical</a>() || !TRI-&gt;isVectorRegister(&#42;MRI, MOReg))</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.readsReg()) &#123;</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">          <a href="/docs/api/structs/llvm/livevariables/varinfo">LiveVariables::VarInfo</a> &amp;VI = LV-&gt;getVarInfo(MOReg);</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;DefMBB = MRI-&gt;getVRegDef(MOReg)-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acf6442108e21e7e5379feb8962de65b7">getParent</a>();</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Make sure two conditions are met:</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// a.) the value is defined before/in the IF block</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// b.) should be defined in the same loop-level.</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((VI.AliveBlocks.test(If-&gt;getNumber()) || DefMBB == If) &amp;&amp;</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">              Loops-&gt;getLoopFor(DefMBB) == Loops-&gt;getLoopFor(If)) &#123;</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Check if the register is live into the endif block. If not,</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// consider it killed in the else region.</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">            <a href="/docs/api/structs/llvm/livevariables/varinfo">LiveVariables::VarInfo</a> &amp;VI = LV-&gt;getVarInfo(MOReg);</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VI.isLiveIn(&#42;Endif, MOReg, &#42;MRI)) &#123;</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">              KillsInElse.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(MOReg);</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">            &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">              <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Excluding &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af085ea923a328b9fa6a1975f1a4ff987">printReg</a>(MOReg, TRI)</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">                                &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; as Live in Endif\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check the phis in the Endif, looking for value coming from the ELSE</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// region. Make sure the phi-use is the last use.</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : Endif-&gt;phis()) &#123;</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 1; Idx &lt; <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getNumOperands(); Idx += 2) &#123;</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MO = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(Idx);</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(Idx + 1).getMBB();</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred == <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>)</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ElseBlocks.<a href="/docs/api/classes/llvm/setvector/#afebe38e4f4ade382a8e857b27cd990a2">contains</a>(Pred) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Should be from Else region\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isReg() || !MO.getReg() || MO.isUndef())</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/register">Register</a> Reg = MO.getReg();</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Reg.isPhysical() || !TRI-&gt;isVectorRegister(&#42;MRI, Reg))</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/livevariables/varinfo">LiveVariables::VarInfo</a> &amp;VI = LV-&gt;getVarInfo(Reg);</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VI.isLiveIn(&#42;Endif, Reg, &#42;MRI)) &#123;</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Excluding &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af085ea923a328b9fa6a1975f1a4ff987">printReg</a>(Reg, TRI)</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">                          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; as Live in Endif\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Make sure two conditions are met:</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// a.) the value is defined before/in the IF block</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// b.) should be defined in the same loop-level.</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;DefMBB = MRI-&gt;getVRegDef(Reg)-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acf6442108e21e7e5379feb8962de65b7">getParent</a>();</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((VI.AliveBlocks.test(If-&gt;getNumber()) || DefMBB == If) &amp;&amp;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">          Loops-&gt;getLoopFor(DefMBB) == Loops-&gt;getLoopFor(If))</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">        KillsInElse.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(Reg);</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsLiveThroughThen = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/register">Register</a> Reg) &#123;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MRI-&gt;use&#95;nodbg&#95;begin(Reg), E = MRI-&gt;use&#95;nodbg&#95;end(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">         ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;readsReg())</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UseMBB = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>-&gt;getParent();</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseMBB == <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a> || UseMBB == Endif) &#123;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>-&gt;isPHI())</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IncomingMBB = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>-&gt;getOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperandNo() + 1).getMBB();</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The register is live through the path If-&gt;Flow or Flow-&gt;Endif.</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// we should not optimize for such cases.</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((UseMBB == <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a> &amp;&amp; IncomingMBB != If) ||</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">            (UseMBB == Endif &amp;&amp; IncomingMBB == <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>))</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Reg : KillsInElse) &#123;</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsLiveThroughThen(Reg))</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">      CandidateRegs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Reg);</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlightComment">/// Collect the registers used in the waterfall loop block that are defined</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlightComment">/// before.</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#ab47a3d3cac0564876929e77389dbe569"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#ab47a3d3cac0564876929e77389dbe569">SIOptimizeVGPRLiveRange::collectWaterfallCandidateRegisters</a>(</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopHeader, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopEnd,</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;Register, 16&gt;</a> &amp;CandidateRegs,</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 2&gt;</a> &amp;Blocks,</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineInstr &#42;&gt;</a> &amp;Instructions)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect loop instructions, potentially spanning multiple blocks</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = LoopHeader;</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (;;) &#123;</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">    Blocks.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugInstr())</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">      Instructions.push&#95;back(&amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> == LoopEnd)</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> != LoopHeader &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;pred&#95;size() != 1) ||</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">        (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> == LoopHeader &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;pred&#95;size() != 2) || <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;succ&#95;size() != 1) &#123;</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected edges in CFG, ignoring loop\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;succ&#95;begin();</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Instructions) &#123;</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> = &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.all&#95;uses()) &#123;</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.getReg())</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/register">Register</a> MOReg = MO.getReg();</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We can only optimize AGPR/VGPR virtual register</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MOReg.<a href="/docs/api/classes/llvm/register/#affdbf5b92ed7e01352e2f39466efbe21">isPhysical</a>() || !TRI-&gt;isVectorRegister(&#42;MRI, MOReg))</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MO.readsReg()) &#123;</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;DefMBB = MRI-&gt;getVRegDef(MOReg)-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acf6442108e21e7e5379feb8962de65b7">getParent</a>();</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Make sure the value is defined before the LOOP block</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Blocks.<a href="/docs/api/classes/llvm/setvector/#afebe38e4f4ade382a8e857b27cd990a2">contains</a>(DefMBB) &amp;&amp; !CandidateRegs.<a href="/docs/api/classes/llvm/setvector/#afebe38e4f4ade382a8e857b27cd990a2">contains</a>(MOReg)) &#123;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If the variable is used after the loop, the register coalescer will</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// merge the newly created register and remove the phi node again.</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Just do nothing in that case.</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">          <a href="/docs/api/structs/llvm/livevariables/varinfo">LiveVariables::VarInfo</a> &amp;OldVarInfo = LV-&gt;getVarInfo(MOReg);</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsUsed = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Succ : LoopEnd-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>()) &#123;</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Blocks.<a href="/docs/api/classes/llvm/setvector/#afebe38e4f4ade382a8e857b27cd990a2">contains</a>(Succ) &amp;&amp;</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">                OldVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#ade24291007dd6f2b3c90c4323499d7eb">isLiveIn</a>(&#42;Succ, MOReg, &#42;MRI)) &#123;</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">              IsUsed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsUsed) &#123;</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Found candidate reg: &quot;</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">                              &lt;&lt; <a href="/docs/api/namespaces/llvm/#af085ea923a328b9fa6a1975f1a4ff987">printReg</a>(MOReg, TRI, 0, MRI) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">            CandidateRegs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(MOReg);</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">          &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Reg is used after loop, ignoring: &quot;</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">                              &lt;&lt; <a href="/docs/api/namespaces/llvm/#af085ea923a328b9fa6a1975f1a4ff987">printReg</a>(MOReg, TRI, 0, MRI) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlightComment">// Re-calculate the liveness of \\p Reg in the THEN-region</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a05ac0dbbd44f86b9fe34282e8109c1ee"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a05ac0dbbd44f86b9fe34282e8109c1ee">SIOptimizeVGPRLiveRange::updateLiveRangeInThenRegion</a>(</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;If, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;MachineBasicBlock &#42;&gt;</a> Blocks;</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;&gt;</a> WorkList(&#123;If&#125;);</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect all successors until we see the flow block, where we should</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reconverge.</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!WorkList.empty()) &#123;</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> = WorkList.pop&#95;back&#95;val();</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Succ : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;successors()) &#123;</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ != <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a> &amp;&amp; Blocks.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Succ))</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">        WorkList.push&#95;back(Succ);</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/livevariables/varinfo">LiveVariables::VarInfo</a> &amp;OldVarInfo = LV-&gt;getVarInfo(Reg);</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : Blocks) &#123;</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Clear Live bit, as we will recalculate afterwards</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Clear AliveBlock &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">    OldVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a76321b20db4feab750d85c2329cfcbc6">AliveBlocks</a>.<a href="/docs/api/classes/llvm/sparsebitvector/#ac07751f1f51f55723eeb3feca9a2a115">reset</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getNumber());</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;MachineBasicBlock &#42;, 4&gt;</a> PHIIncoming;</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the blocks the Reg should be alive through</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = MRI-&gt;use&#95;nodbg&#95;begin(Reg), E = MRI-&gt;use&#95;nodbg&#95;end(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E;</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">       ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>-&gt;isPHI() &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;readsReg()) &#123;</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Blocks.<a href="/docs/api/classes/llvm/setvector/#afebe38e4f4ade382a8e857b27cd990a2">contains</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>-&gt;getParent()))</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">        PHIIncoming.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>-&gt;getOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOperandNo() + 1).getMBB());</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : Blocks) &#123;</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineInstr &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>;</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// PHI instructions has been processed before.</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#ab88eabb9aada899a03069797171cd2d5">findNonPHIUsesInBlock</a>(Reg, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>);</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.size() == 1) &#123;</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Found one Non-PHI use in &quot;</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">                        &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">      LV-&gt;HandleVirtRegUse(Reg, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, &#42;(&#42;<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.begin()));</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.size() &gt; 1) &#123;</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Process the instructions in-order</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Found &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.size() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; Non-PHI uses in &quot;</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">                        &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">llvm::is&#95;contained</a>(<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>, &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>))</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">          LV-&gt;HandleVirtRegUse(Reg, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Mark Reg alive through the block if this is a PHI incoming block</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHIIncoming.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>))</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">      LV-&gt;MarkVirtRegAliveInBlock(OldVarInfo, MRI-&gt;getVRegDef(Reg)-&gt;getParent(),</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">                                  <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set the isKilled flag if we get new Kills in the THEN region.</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : OldVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a65c816771eca7465f5e3e0bb6624ad88">Kills</a>) &#123;</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Blocks.<a href="/docs/api/classes/llvm/setvector/#afebe38e4f4ade382a8e857b27cd990a2">contains</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;getParent()))</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;addRegisterKilled(Reg, TRI);</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#ad445b6093f4c4a8237493928b1a7c6f9"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#ad445b6093f4c4a8237493928b1a7c6f9">SIOptimizeVGPRLiveRange::updateLiveRangeInElseRegion</a>(</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/register">Register</a> NewReg, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>,</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Endif,</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 16&gt;</a> &amp;ElseBlocks)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/livevariables/varinfo">LiveVariables::VarInfo</a> &amp;NewVarInfo = LV-&gt;getVarInfo(NewReg);</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/livevariables/varinfo">LiveVariables::VarInfo</a> &amp;OldVarInfo = LV-&gt;getVarInfo(Reg);</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Transfer aliveBlocks from Reg to NewReg</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : ElseBlocks) &#123;</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BBNum = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getNumber();</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a76321b20db4feab750d85c2329cfcbc6">AliveBlocks</a>.<a href="/docs/api/classes/llvm/sparsebitvector/#aaa2827e67554a0b81f693dc61a3a40b5">test</a>(BBNum)) &#123;</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">      NewVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a76321b20db4feab750d85c2329cfcbc6">AliveBlocks</a>.<a href="/docs/api/classes/llvm/sparsebitvector/#a613c1e44c4e88e9a1e0be386cb5fa828">set</a>(BBNum);</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Removing AliveBlock &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">      OldVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a76321b20db4feab750d85c2329cfcbc6">AliveBlocks</a>.<a href="/docs/api/classes/llvm/sparsebitvector/#ac07751f1f51f55723eeb3feca9a2a115">reset</a>(BBNum);</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Transfer the possible Kills in ElseBlocks from Reg to NewReg</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = OldVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a65c816771eca7465f5e3e0bb6624ad88">Kills</a>.begin();</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != OldVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a65c816771eca7465f5e3e0bb6624ad88">Kills</a>.end()) &#123;</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ElseBlocks.<a href="/docs/api/classes/llvm/setvector/#afebe38e4f4ade382a8e857b27cd990a2">contains</a>((&#42;I)-&gt;getParent())) &#123;</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">      NewVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a65c816771eca7465f5e3e0bb6624ad88">Kills</a>.push&#95;back(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = OldVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a65c816771eca7465f5e3e0bb6624ad88">Kills</a>.erase(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">      ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a86f2353949000eecd69fbbe3c669efc4"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a86f2353949000eecd69fbbe3c669efc4">SIOptimizeVGPRLiveRange::optimizeLiveRange</a>(</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;If, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>,</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Endif,</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 16&gt;</a> &amp;ElseBlocks)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert a new PHI, marking the value from the THEN region being</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// undef.</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Optimizing &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af085ea923a328b9fa6a1975f1a4ff987">printReg</a>(Reg, TRI) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RC = MRI-&gt;getRegClass(Reg);</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> NewReg = MRI-&gt;createVirtualRegister(RC);</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> UndefReg = MRI-&gt;createVirtualRegister(RC);</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineinstrbuilder">MachineInstrBuilder</a> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>-&gt;getFirstNonPHI(), <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a>(),</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">                                    TII-&gt;<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">get</a>(TargetOpcode::PHI), NewReg);</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred : <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>-&gt;predecessors()) &#123;</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred == If)</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.addReg(Reg).addMBB(Pred);</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.addReg(UndefReg, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5ab502f975742e9bff6d6dd7b49439b806">RegState::Undef</a>).addMBB(Pred);</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace all uses in the ELSE region or the PHIs in ENDIF block</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use early increment range because setReg() will update the linked list.</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;O : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(MRI-&gt;use&#95;operands(Reg))) &#123;</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a> = O.getParent();</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UseBlock = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>-&gt;getParent();</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace uses in Endif block</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseBlock == Endif) &#123;</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>-&gt;isPHI())</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">        O.setReg(NewReg);</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>-&gt;isDebugInstr())</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// DetectDeadLanes may mark register uses as undef without removing</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// them, in which case a non-phi instruction using the original register</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// may exist in the Endif block even though the register is not live</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// into it.</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!O.readsReg());</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace uses in Else region</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ElseBlocks.<a href="/docs/api/classes/llvm/setvector/#afebe38e4f4ade382a8e857b27cd990a2">contains</a>(UseBlock))</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">      O.setReg(NewReg);</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The optimized Reg is not alive through Flow blocks anymore.</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/livevariables/varinfo">LiveVariables::VarInfo</a> &amp;OldVarInfo = LV-&gt;getVarInfo(Reg);</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">  OldVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a76321b20db4feab750d85c2329cfcbc6">AliveBlocks</a>.<a href="/docs/api/classes/llvm/sparsebitvector/#ac07751f1f51f55723eeb3feca9a2a115">reset</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>-&gt;getNumber());</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#ad445b6093f4c4a8237493928b1a7c6f9">updateLiveRangeInElseRegion</a>(Reg, NewReg, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>, Endif, ElseBlocks);</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a05ac0dbbd44f86b9fe34282e8109c1ee">updateLiveRangeInThenRegion</a>(Reg, If, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/siannotatecontrolflow-cpp/#acf797fa91d5b7065dfb68a2492df28c1">Flow</a>);</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#aa35ddcfd60c7c4587ea25cb27e25968e"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#aa35ddcfd60c7c4587ea25cb27e25968e">SIOptimizeVGPRLiveRange::optimizeWaterfallLiveRange</a>(</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopHeader,</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 2&gt;</a> &amp;Blocks,</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineInstr &#42;&gt;</a> &amp;Instructions)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert a new PHI, marking the value from the last loop iteration undef.</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Optimizing &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af085ea923a328b9fa6a1975f1a4ff987">printReg</a>(Reg, TRI) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RC = MRI-&gt;getRegClass(Reg);</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> NewReg = MRI-&gt;createVirtualRegister(RC);</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> UndefReg = MRI-&gt;createVirtualRegister(RC);</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace all uses in the LOOP region</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use early increment range because setReg() will update the linked list.</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;O : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(MRI-&gt;use&#95;operands(Reg))) &#123;</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a> = O.getParent();</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UseBlock = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a6cf2f8996b1e9aaf2d7a435aaa62382f">UseMI</a>-&gt;getParent();</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace uses in Loop blocks</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Blocks.<a href="/docs/api/classes/llvm/setvector/#afebe38e4f4ade382a8e857b27cd990a2">contains</a>(UseBlock))</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">      O.setReg(NewReg);</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineinstrbuilder">MachineInstrBuilder</a> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> =</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a17e04afcf0c5efeb0eb6a9a45287b5e4">BuildMI</a>(&#42;LoopHeader, LoopHeader-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#aa7dc7faaab4856b8f0014b8283e26c7b">getFirstNonPHI</a>(), <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a>(),</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">              TII-&gt;<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">get</a>(TargetOpcode::PHI), NewReg);</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred : LoopHeader-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Blocks.<a href="/docs/api/classes/llvm/setvector/#afebe38e4f4ade382a8e857b27cd990a2">contains</a>(Pred))</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.addReg(UndefReg, <a href="/docs/api/namespaces/llvm/regstate/#ade26fe5c9b3fe6948def36f7ca12dfc5ab502f975742e9bff6d6dd7b49439b806">RegState::Undef</a>).addMBB(Pred);</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>.addReg(Reg).addMBB(Pred);</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/livevariables/varinfo">LiveVariables::VarInfo</a> &amp;NewVarInfo = LV-&gt;getVarInfo(NewReg);</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/livevariables/varinfo">LiveVariables::VarInfo</a> &amp;OldVarInfo = LV-&gt;getVarInfo(Reg);</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find last use and mark as kill</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;Kill = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(Instructions)) &#123;</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;readsRegister(NewReg, TRI)) &#123;</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;addRegisterKilled(NewReg, TRI);</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">      NewVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a65c816771eca7465f5e3e0bb6624ad88">Kills</a>.push&#95;back(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">      Kill = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>;</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Kill &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Failed to find last usage of register in loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;KillBlock = Kill-&gt;getParent();</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PostKillBlock = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : Blocks) &#123;</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BBNum = <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>-&gt;getNumber();</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// collectWaterfallCandidateRegisters only collects registers that are dead</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// after the loop. So we know that the old reg is no longer live throughout</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the waterfall loop.</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">    OldVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a76321b20db4feab750d85c2329cfcbc6">AliveBlocks</a>.<a href="/docs/api/classes/llvm/sparsebitvector/#ac07751f1f51f55723eeb3feca9a2a115">reset</a>(BBNum);</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The new register is live up to (and including) the block that kills it.</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">    PostKillBlock |= (<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> == KillBlock);</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PostKillBlock) &#123;</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">      NewVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a76321b20db4feab750d85c2329cfcbc6">AliveBlocks</a>.<a href="/docs/api/classes/llvm/sparsebitvector/#ac07751f1f51f55723eeb3feca9a2a115">reset</a>(BBNum);</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> != LoopHeader) &#123;</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">      NewVarInfo.<a href="/docs/api/structs/llvm/livevariables/varinfo/#a76321b20db4feab750d85c2329cfcbc6">AliveBlocks</a>.<a href="/docs/api/classes/llvm/sparsebitvector/#a613c1e44c4e88e9a1e0be386cb5fa828">set</a>(BBNum);</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#ac0ea6d061ee2d141a7ba5896f2defa6b">SIOptimizeVGPRLiveRangeLegacy::ID</a> = 0;</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626" lineLink="#ad745a4d895a366bdfc3486d667aaa3b2"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(<a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#a68a1a4864199d14588dd82c0a5eee4dd">SIOptimizeVGPRLiveRangeLegacy</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">                      </span><span class="doxyHighlightStringLiteral">&quot;SI Optimize VGPR LiveRange&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/machinedominatortreewrapperpass">MachineDominatorTreeWrapperPass</a>)</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/machineloopinfowrapperpass">MachineLoopInfoWrapperPass</a>)</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/livevariableswrapperpass">LiveVariablesWrapperPass</a>)</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631" lineLink="#a030569d5a541b6110f2ae1b6a3413a58"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(<a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#a68a1a4864199d14588dd82c0a5eee4dd">SIOptimizeVGPRLiveRangeLegacy</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632" lineLink="#a3f8ae3038974369df91a2df8bf131749"><span class="doxyHighlight">                    </span><span class="doxyHighlightStringLiteral">&quot;SI Optimize VGPR LiveRange&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/false">false</a>, <a href="/docs/api/namespaces/false">false</a>)</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634" lineLink="/docs/api/namespaces/llvm/#a61bc27bebda7aee457afef9c6ed2679a"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm">llvm</a>::<a href="/docs/api/namespaces/llvm/#a61bc27bebda7aee457afef9c6ed2679a">SIOptimizeVGPRLiveRangeLegacyID</a> = <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#a68a1a4864199d14588dd82c0a5eee4dd">SIOptimizeVGPRLiveRangeLegacy</a>::<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>;</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636" lineLink="/docs/api/namespaces/llvm/#ab73a545cd754eaf1aa60f20ae1897f19"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/functionpass">FunctionPass</a> &#42;<a href="/docs/api/namespaces/llvm">llvm</a>::<a href="/docs/api/namespaces/llvm/#ab73a545cd754eaf1aa60f20ae1897f19">createSIOptimizeVGPRLiveRangeLegacyPass</a>() &#123;</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#a68a1a4864199d14588dd82c0a5eee4dd">SIOptimizeVGPRLiveRangeLegacy</a>();</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#afc439d8fd92fc2513ddcf060ad04c896"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverangelegacy/#afc439d8fd92fc2513ddcf060ad04c896">SIOptimizeVGPRLiveRangeLegacy::runOnMachineFunction</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/functionpass/#af9f5f511d75e16f09a5520cb9444cfa8">skipFunction</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>()))</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/livevariables">LiveVariables</a> &#42;LV = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;LiveVariablesWrapperPass&gt;</a>().getLV();</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinedominatortree">MachineDominatorTree</a> &#42;MDT =</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">      &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachineDominatorTreeWrapperPass&gt;</a>().getDomTree();</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineloopinfo">MachineLoopInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a> = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachineLoopInfoWrapperPass&gt;</a>().getLI();</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a6c869caeb4216a049b9090c45733a594">SIOptimizeVGPRLiveRange</a>(LV, MDT, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>).run(MF);</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a></span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652" lineLink="/docs/api/classes/llvm/sioptimizevgprliverangepass/#a7bf8baafeef111584b003c06f997080a"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/sioptimizevgprliverangepass/#a7bf8baafeef111584b003c06f997080a">SIOptimizeVGPRLiveRangePass::run</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">                                 <a href="/docs/api/namespaces/llvm/#a064825a8817522ca733ac413a7122d36">MachineFunctionAnalysisManager</a> &amp;MFAM) &#123;</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mfpropsmodifier">MFPropsModifier</a> <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>(&#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, MF);</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/livevariables">LiveVariables</a> &#42;LV = &amp;MFAM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/livevariablesanalysis">LiveVariablesAnalysis</a>&gt;(MF);</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinedominatortree">MachineDominatorTree</a> &#42;MDT = &amp;MFAM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/machinedominatortreeanalysis">MachineDominatorTreeAnalysis</a>&gt;(MF);</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineloopinfo">MachineLoopInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a> = &amp;MFAM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/machineloopanalysis">MachineLoopAnalysis</a>&gt;(MF);</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = SIOptimizeVGPRLiveRange(LV, MDT, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagonhardwareloops-cpp/#ada7c1594a393ede3ce32602d64d7ddb2">Loops</a>).run(MF);</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>)</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PA = <a href="/docs/api/namespaces/llvm/#a596ca6eb2e24883789eb3b1596974d83">getMachineFunctionPassPreservedAnalyses</a>();</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">  PA.preserve&lt;<a href="/docs/api/classes/llvm/livevariablesanalysis">LiveVariablesAnalysis</a>&gt;();</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">  PA.preserve&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;();</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">  PA.preserve&lt;<a href="/docs/api/classes/llvm/machineloopanalysis">MachineLoopAnalysis</a>&gt;();</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">  PA.preserveSet&lt;<a href="/docs/api/classes/llvm/cfganalyses">CFGAnalyses</a>&gt;();</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PA;</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671" lineLink="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#ab0ed42131f44a7ce15c2e5ba199bbfe3"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#ab0ed42131f44a7ce15c2e5ba199bbfe3">SIOptimizeVGPRLiveRange::run</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/gcnsubtarget">GCNSubtarget</a> &amp;ST = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>&lt;<a href="/docs/api/classes/llvm/gcnsubtarget">GCNSubtarget</a>&gt;();</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">  TII = ST.getInstrInfo();</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">  TRI = &amp;TII-&gt;getRegisterInfo();</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">  MRI = &amp;MF.<a href="/docs/api/classes/llvm/machinefunction/#a810234b6b3d223b7c74a4253fcc5ea5e">getRegInfo</a>();</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MadeChange = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: we need to think about the order of visiting the blocks to get</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimal result for nesting if-else cases.</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : MF) &#123;</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.terminators()) &#123;</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Detect the if-else blocks</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::SI&#95;IF) &#123;</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;IfTarget = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(2).getMBB();</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Endif = <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#acebe90db937b6d2feb9c97f0c37b33ef">getElseTarget</a>(IfTarget);</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Endif)</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Skip unexpected control flow.</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MDT-&gt;dominates(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, IfTarget) || !MDT-&gt;dominates(IfTarget, Endif))</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 16&gt;</a> ElseBlocks;</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Register&gt;</a> CandidateRegs;</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Checking IF-ELSE-ENDIF: &quot;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">                          &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39; &#39;</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">                          &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;IfTarget) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39; &#39;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">                          &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;Endif) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Collect all the blocks in the ELSE region</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">        <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a43905da53a96adf8e5dfbe0f18f60e3c">collectElseRegionBlocks</a>(IfTarget, Endif, ElseBlocks);</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Collect the registers can be optimized</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">        <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a5290bdffbf68a26e47345d1bb2abb246">collectCandidateRegisters</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, IfTarget, Endif, ElseBlocks,</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">                                  CandidateRegs);</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">        MadeChange |= !CandidateRegs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>();</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Now we are safe to optimize.</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Reg : CandidateRegs)</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">          <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#a86f2353949000eecd69fbbe3c669efc4">optimizeLiveRange</a>(Reg, &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, IfTarget, Endif, ElseBlocks);</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == AMDGPU::SI&#95;WATERFALL&#95;LOOP) &#123;</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LoopHeader = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(0).getMBB();</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LoopEnd = &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>;</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Checking Waterfall loop: &quot;</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">                          &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;LoopHeader) &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;Register, 16&gt;</a> CandidateRegs;</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineInstr &#42;, 16&gt;</a> Instructions;</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;MachineBasicBlock &#42;, 2&gt;</a> Blocks;</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">        <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#ab47a3d3cac0564876929e77389dbe569">collectWaterfallCandidateRegisters</a>(LoopHeader, LoopEnd, CandidateRegs,</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">                                           Blocks, Instructions);</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">        MadeChange |= !CandidateRegs.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>();</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Now we are safe to optimize.</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Reg : CandidateRegs)</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">          <a href="/docs/api/classes/anonymous-namespace-sioptimizevgprliverange-cpp-/sioptimizevgprliverange/#aa35ddcfd60c7c4587ea25cb27e25968e">optimizeWaterfallLiveRange</a>(Reg, LoopHeader, Blocks, Instructions);</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MadeChange;</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
