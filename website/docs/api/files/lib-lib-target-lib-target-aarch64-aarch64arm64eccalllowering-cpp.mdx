---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/target/lib/target/aarch64/aarch64arm64eccalllowering-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `AArch64Arm64ECCallLowering.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>

This file contains the IR transform to lower external or indirect calls for the ARM64EC calling convention. <a href="#details">More...</a>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="AArch64.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallString.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallstring-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CallingConv.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/callingconv-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalAlias.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalalias-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Mangler.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/mangler-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Object/COFF.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/object/coff-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Pass.h"
  permalink="/docs/api/files/include/include/llvm/pass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/TargetParser/Triple.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/targetparser/triple-h"
  isLocal="true" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-">anonymous&#123;AArch64Arm64ECCallLowering.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-aarch64arm64eccalllowering-cpp-/thunkarginfo">ThunkArgInfo</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering">AArch64Arm64ECCallLowering</a></>}>
</MembersIndexItem>

</MembersIndex>

## Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="using"
  name={<><a href="#a8fbbe9d9f2856e8ab2a4545a97607245">OperandBundleDef</a> = <a href="/docs/api/classes/llvm/operandbundledeft">OperandBundleDefT</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt;</>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#aacc28ff27759d26e74d37a78470ce0b7">INITIALIZE&#95;PASS</a> (AArch64Arm64ECCallLowering, &quot;Arm64ECCallLowering&quot;, &quot;AArch64Arm64ECCallLowering&quot;, false, false) ModulePass &#42;llvm</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ae89ca481411851b8b68f1d74957a9440">STATISTIC</a> (Arm64ECCallsLowered, &quot;Number of Arm64EC calls lowered&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a7108745163cc6894b9a0e9c9430a48b8">GenerateThunks</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a079a08ba8e62d90d8a2d789fde93633b">LowerDirectToIndirect</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;arm64eccalllowering&quot;</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

This file contains the IR transform to lower external or indirect calls for the ARM64EC calling convention.

Such calls must go through the runtime, so we can translate the calling convention for calls into the emulator.

This subsumes Control Flow Guard handling.

<SectionDefinition>

## Typedefs

### OperandBundleDef {#a8fbbe9d9f2856e8ab2a4545a97607245}

<MemberDefinition
  prototype={<>using OperandBundleDef =  OperandBundleDefT&lt;Value &#42;&gt;</>}>

Definition at line <a href="#l00038">38</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64arm64eccalllowering-cpp">AArch64Arm64ECCallLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### INITIALIZE&#95;PASS() {#aacc28ff27759d26e74d37a78470ce0b7}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS (AArch64Arm64ECCallLowering, &quot;Arm64ECCallLowering&quot;, &quot;AArch64Arm64ECCallLowering&quot;, false, false)</>}>

Definition at line <a href="#l00984">984</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64arm64eccalllowering-cpp">AArch64Arm64ECCallLowering.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ae89ca481411851b8b68f1d74957a9440}

<MemberDefinition
  prototype={<>STATISTIC (Arm64ECCallsLowered, &quot;Number of Arm64EC calls lowered&quot;)</>}>

Definition at line <a href="#l00042">42</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64arm64eccalllowering-cpp">AArch64Arm64ECCallLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### GenerateThunks {#a7108745163cc6894b9a0e9c9430a48b8}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; GenerateThunks(&quot;arm64ec-generate-thunks&quot;, cl::Hidden, cl::init(true))</>}
  labels = {["static"]}>

Definition at line <a href="#l00046">46</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64arm64eccalllowering-cpp">AArch64Arm64ECCallLowering.cpp</a>.
</MemberDefinition>

### LowerDirectToIndirect {#a079a08ba8e62d90d8a2d789fde93633b}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; LowerDirectToIndirect(&quot;arm64ec-lower-direct-to-indirect&quot;, cl::Hidden, cl::init(true))</>}
  labels = {["static"]}>

Definition at line <a href="#l00044">44</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64arm64eccalllowering-cpp">AArch64Arm64ECCallLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;arm64eccalllowering&quot;</>}>

Definition at line <a href="#l00040">40</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64arm64eccalllowering-cpp">AArch64Arm64ECCallLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===-- AArch64Arm64ECCallLowering.cpp - Lower Arm64EC calls ----&#42;- C++ -&#42;-===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">/// \\file</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">/// This file contains the IR transform to lower external or indirect calls for</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">/// the ARM64EC calling convention. Such calls must go through the runtime, so</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">/// we can translate the calling convention for calls into the emulator.</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">/// This subsumes Control Flow Guard handling.</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64-h">AArch64.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallstring-h">llvm/ADT/SmallString.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/callingconv-h">llvm/IR/CallingConv.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalalias-h">llvm/IR/GlobalAlias.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/mangler-h">llvm/IR/Mangler.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/object/coff-h">llvm/Object/COFF.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/pass-h">llvm/Pass.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/targetparser/triple-h">llvm/TargetParser/Triple.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/coff">llvm::COFF</a>;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38" lineLink="#a8fbbe9d9f2856e8ab2a4545a97607245"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/#aa97c65466bdd34abda6772dd32eb5d19">OperandBundleDef</a> = <a href="/docs/api/classes/llvm/operandbundledeft">OperandBundleDefT&lt;Value &#42;&gt;</a>;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;arm64eccalllowering&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42" lineLink="#ae89ca481411851b8b68f1d74957a9440"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(Arm64ECCallsLowered, </span><span class="doxyHighlightStringLiteral">&quot;Number of Arm64EC calls lowered&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44" lineLink="#a079a08ba8e62d90d8a2d789fde93633b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a079a08ba8e62d90d8a2d789fde93633b">LowerDirectToIndirect</a>(</span><span class="doxyHighlightStringLiteral">&quot;arm64ec-lower-direct-to-indirect&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlight">                                           <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46" lineLink="#a7108745163cc6894b9a0e9c9430a48b8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a7108745163cc6894b9a0e9c9430a48b8">GenerateThunks</a>(</span><span class="doxyHighlightStringLiteral">&quot;arm64ec-generate-thunks&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlight">                                    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49" lineLink="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51" lineLink="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59e"><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59e">ThunkArgTranslation</a> : uint8&#95;t &#123;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52" lineLink="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea2ae40416f6380618d5b202ac553d6bdc"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea2ae40416f6380618d5b202ac553d6bdc">Direct</a>,</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53" lineLink="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea8e0d8fd987857f4309346ef8d456f262"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea8e0d8fd987857f4309346ef8d456f262">Bitcast</a>,</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54" lineLink="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ead1f6023b9a6528d5f52dc7de2650be19"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ead1f6023b9a6528d5f52dc7de2650be19">PointerIndirection</a>,</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57" lineLink="/docs/api/structs/anonymous-namespace-aarch64arm64eccalllowering-cpp-/thunkarginfo"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-aarch64arm64eccalllowering-cpp-/thunkarginfo">ThunkArgInfo</a> &#123;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58" lineLink="/docs/api/structs/anonymous-namespace-aarch64arm64eccalllowering-cpp-/thunkarginfo/#a0496c491c39bc76b6f1230b6cffa8853"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/structs/anonymous-namespace-aarch64arm64eccalllowering-cpp-/thunkarginfo/#a0496c491c39bc76b6f1230b6cffa8853">Arm64Ty</a>;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59" lineLink="/docs/api/structs/anonymous-namespace-aarch64arm64eccalllowering-cpp-/thunkarginfo/#a2a9f4abbd7b4004bfb92fe705ddd24df"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/structs/anonymous-namespace-aarch64arm64eccalllowering-cpp-/thunkarginfo/#a2a9f4abbd7b4004bfb92fe705ddd24df">X64Ty</a>;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60" lineLink="/docs/api/structs/anonymous-namespace-aarch64arm64eccalllowering-cpp-/thunkarginfo/#a183bf70d379a1dc731b7b9257c74d2fc"><span class="doxyHighlight">  <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59e">ThunkArgTranslation</a> <a href="/docs/api/structs/anonymous-namespace-aarch64arm64eccalllowering-cpp-/thunkarginfo/#a183bf70d379a1dc731b7b9257c74d2fc">Translation</a>;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63" lineLink="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a8ed0ce49492f441faef4ff3eda95feef">AArch64Arm64ECCallLowering</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/modulepass/#a723659a08d210f4f566887bda3f9f976">ModulePass</a> &#123;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65" lineLink="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a7cfd5aff2bec223cd6100ca7eaf231cb"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a7cfd5aff2bec223cd6100ca7eaf231cb">ID</a>;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66" lineLink="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a8ed0ce49492f441faef4ff3eda95feef"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a8ed0ce49492f441faef4ff3eda95feef">AArch64Arm64ECCallLowering</a>() : <a href="/docs/api/classes/llvm/modulepass/#a723659a08d210f4f566887bda3f9f976">ModulePass</a>(<a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a7cfd5aff2bec223cd6100ca7eaf231cb">ID</a>) &#123;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a4e5b0febbb4d15587bb9a3fb24d5e6cf">initializeAArch64Arm64ECCallLoweringPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;buildExitThunk(<a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;FnTy, AttributeList Attrs);</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;buildEntryThunk(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> lowerCall(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CB);</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;buildGuestExitThunk(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;buildPatchableThunk(<a href="/docs/api/classes/llvm/globalalias">GlobalAlias</a> &#42;UnmangledAlias,</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/globalalias">GlobalAlias</a> &#42;MangledAlias);</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> processFunction(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/setvector">SetVector&lt;GlobalValue &#42;&gt;</a> &amp;DirectCalledFns,</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;GlobalAlias &#42;, GlobalAlias &#42;&gt;</a> &amp;FnsMap);</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> runOnModule(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> cfguard&#95;module&#95;flag = 0;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;GuardFnType = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/pointertype">PointerType</a> &#42;GuardFnPtrType = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;DispatchFnType = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/pointertype">PointerType</a> &#42;DispatchFnPtrType = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;GuardFnCFGlobal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;GuardFnGlobal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;DispatchFnGlobal = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/module">Module</a> &#42;M = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;PtrTy;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;I64Ty;</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;VoidTy;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> getThunkType(<a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;FT, AttributeList AttrList,</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">                    <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39c">Arm64ECThunkType</a> TT, <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;Out,</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;&amp;Arm64Ty, <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;&amp;X64Ty,</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ThunkArgTranslation&gt;</a> &amp;ArgTranslations);</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> getThunkRetType(<a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;FT, AttributeList AttrList,</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;Out, <a href="/docs/api/classes/llvm/type">Type</a> &#42;&amp;Arm64RetTy, <a href="/docs/api/classes/llvm/type">Type</a> &#42;&amp;X64RetTy,</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Type &#42;&gt;</a> &amp;Arm64ArgTypes,</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Type &#42;&gt;</a> &amp;X64ArgTypes,</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ThunkArgTranslation&gt;</a> &amp;ArgTranslations,</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">                       </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;HasSretPtr);</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> getThunkArgTypes(<a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;FT, AttributeList AttrList,</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">                        <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39c">Arm64ECThunkType</a> TT, <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;Out,</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Type &#42;&gt;</a> &amp;Arm64ArgTypes,</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Type &#42;&gt;</a> &amp;X64ArgTypes,</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;ThunkArgTranslation&gt;</a> &amp;ArgTranslations,</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasSretPtr);</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">  <a href="/docs/api/structs/anonymous-namespace-aarch64arm64eccalllowering-cpp-/thunkarginfo">ThunkArgInfo</a> canonicalizeThunkType(<a href="/docs/api/classes/llvm/type">Type</a> &#42;T, <a href="/docs/api/structs/llvm/align">Align</a> Alignment, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Ret,</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">                                     uint64&#95;t ArgSizeBytes, <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;Out);</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> AArch64Arm64ECCallLowering::getThunkType(</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">    <a href="/docs/api/classes/functiontype">FunctionType</a> &#42;FT, AttributeList AttrList, <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39c">Arm64ECThunkType</a> TT,</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;Out, <a href="/docs/api/classes/functiontype">FunctionType</a> &#42;&amp;Arm64Ty, <a href="/docs/api/classes/functiontype">FunctionType</a> &#42;&amp;X64Ty,</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ThunkArgTranslation&gt;</a> &amp;ArgTranslations) &#123;</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">  Out &lt;&lt; (<a href="/docs/api/namespaces/llvm/arm/#a5667e0461a51d2c4887056c3f684c341adf1f3edb9115acb0a1e04209b7a9937b">TT</a> == <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Arm64ECThunkType::Entry</a> ? </span><span class="doxyHighlightStringLiteral">&quot;$ientry&#95;thunk$cdecl$&quot;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">                                        : </span><span class="doxyHighlightStringLiteral">&quot;$iexit&#95;thunk$cdecl$&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Arm64RetTy;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;X64RetTy;</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Type &#42;&gt;</a> Arm64ArgTypes;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Type &#42;&gt;</a> X64ArgTypes;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The first argument to a thunk is the called function, stored in x9.</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For exit thunks, we pass the called function down to the emulator;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for entry/guest exit thunks, we just call the Arm64 function directly.</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TT == <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39cacd4cef2a5a26efd5d75ecca95bc6ff24">Arm64ECThunkType::Exit</a>)</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">    Arm64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PtrTy);</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">  X64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PtrTy);</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasSretPtr = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">  getThunkRetType(FT, AttrList, Out, Arm64RetTy, X64RetTy, Arm64ArgTypes,</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">                  X64ArgTypes, ArgTranslations, HasSretPtr);</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">  getThunkArgTypes(FT, AttrList, TT, Out, Arm64ArgTypes, X64ArgTypes,</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">                   ArgTranslations, HasSretPtr);</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">  Arm64Ty = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(Arm64RetTy, Arm64ArgTypes, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">  X64Ty = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(X64RetTy, X64ArgTypes, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> AArch64Arm64ECCallLowering::getThunkArgTypes(</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">    <a href="/docs/api/classes/functiontype">FunctionType</a> &#42;FT, AttributeList AttrList, <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39c">Arm64ECThunkType</a> TT,</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;Out, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Type &#42;&gt;</a> &amp;Arm64ArgTypes,</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Type &#42;&gt;</a> &amp;X64ArgTypes,</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;ThunkArgTranslation&gt;</a> &amp;ArgTranslations, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasSretPtr) &#123;</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">  Out &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;$&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FT-&gt;isVarArg()) &#123;</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We treat the variadic function&#39;s thunk as a normal function</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// with the following type on the ARM side:</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   rettype exitthunk(</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     ptr x9, ptr x0, i64 x1, i64 x2, i64 x3, ptr x4, i64 x5)</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that can coverage all types of variadic function.</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// x9 is similar to normal exit thunk, store the called function.</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// x0-x3 is the arguments be stored in registers.</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// x4 is the address of the arguments on the stack.</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// x5 is the size of the arguments on the stack.</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// On the x64 side, it&#39;s the same except that x5 isn&#39;t set.</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If both the ARM and X64 sides are sret, there are only three</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// arguments in registers.</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the X64 side is sret, but the ARM side isn&#39;t, we pass an extra value</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to/from the X64 side, and let SelectionDAG transform it into a memory</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// location.</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">    Out &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;varargs&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// x0-x3</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i = HasSretPtr ? 1 : 0; i &lt; 4; i++) &#123;</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">      Arm64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(I64Ty);</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">      X64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(I64Ty);</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">      ArgTranslations.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea2ae40416f6380618d5b202ac553d6bdc">ThunkArgTranslation::Direct</a>);</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// x4</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">    Arm64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PtrTy);</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">    X64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PtrTy);</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">    ArgTranslations.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea2ae40416f6380618d5b202ac553d6bdc">ThunkArgTranslation::Direct</a>);</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// x5</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">    Arm64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(I64Ty);</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TT != <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Arm64ECThunkType::Entry</a>) &#123;</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FIXME: x5 isn&#39;t actually used by the x64 side; revisit once we</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// have proper isel for varargs</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">      X64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(I64Ty);</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">      ArgTranslations.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea2ae40416f6380618d5b202ac553d6bdc">ThunkArgTranslation::Direct</a>);</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0;</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasSretPtr)</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == FT-&gt;getNumParams()) &#123;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">    Out &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;v&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = FT-&gt;getNumParams(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlightPreprocessor">#if 0</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Need more information about argument size; see</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// https://reviews.llvm.org/D132926</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">    uint64&#95;t ArgSizeBytes = AttrList.getParamArm64ECArgSizeBytes(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/align">Align</a> ParamAlign = AttrList.getParamAlignment(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).valueOrOne();</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlightPreprocessor">#else</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">    uint64&#95;t ArgSizeBytes = 0;</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/align">Align</a> ParamAlign = <a href="/docs/api/structs/llvm/align">Align</a>();</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;Arm64Ty, X64Ty, ArgTranslation&#93; =</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">        canonicalizeThunkType(FT-&gt;getParamType(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), ParamAlign,</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">                              </span><span class="doxyHighlightComment">/&#42;Ret&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, ArgSizeBytes, Out);</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">    Arm64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Arm64Ty);</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">    X64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(X64Ty);</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">    ArgTranslations.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ArgTranslation);</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> AArch64Arm64ECCallLowering::getThunkRetType(</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">    <a href="/docs/api/classes/functiontype">FunctionType</a> &#42;FT, AttributeList AttrList, <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;Out,</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;&amp;Arm64RetTy, <a href="/docs/api/classes/llvm/type">Type</a> &#42;&amp;X64RetTy, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Type &#42;&gt;</a> &amp;Arm64ArgTypes,</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Type &#42;&gt;</a> &amp;X64ArgTypes,</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ThunkArgTranslation&gt;</a> &amp;ArgTranslations, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;HasSretPtr) &#123;</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = FT-&gt;getReturnType();</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlightPreprocessor">#if 0</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Need more information about argument size; see</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// https://reviews.llvm.org/D132926</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">  uint64&#95;t ArgSizeBytes = AttrList.getRetArm64ECArgSizeBytes();</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlightPreprocessor">#else</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">  int64&#95;t ArgSizeBytes = 0;</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;isVoidTy()) &#123;</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FT-&gt;getNumParams()) &#123;</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/attribute">Attribute</a> SRetAttr0 = AttrList.getParamAttr(0, Attribute::StructRet);</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/attribute">Attribute</a> InRegAttr0 = AttrList.getParamAttr(0, Attribute::InReg);</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/attribute">Attribute</a> SRetAttr1, InRegAttr1;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FT-&gt;getNumParams() &gt; 1) &#123;</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Also check the second parameter (for class methods, the first</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// parameter is &quot;this&quot;, and the second parameter is the sret pointer.)</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// It doesn&#39;t matter which one is sret.</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">        SRetAttr1 = AttrList.getParamAttr(1, Attribute::StructRet);</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">        InRegAttr1 = AttrList.getParamAttr(1, Attribute::InReg);</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((SRetAttr0.<a href="/docs/api/classes/llvm/attribute/#adf4d22686e85732b2fef71e3c45531c6">isValid</a>() &amp;&amp; InRegAttr0.<a href="/docs/api/classes/llvm/attribute/#adf4d22686e85732b2fef71e3c45531c6">isValid</a>()) ||</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">          (SRetAttr1.<a href="/docs/api/classes/llvm/attribute/#adf4d22686e85732b2fef71e3c45531c6">isValid</a>() &amp;&amp; InRegAttr1.<a href="/docs/api/classes/llvm/attribute/#adf4d22686e85732b2fef71e3c45531c6">isValid</a>())) &#123;</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// sret+inreg indicates a call that returns a C++ class value. This is</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// actually equivalent to just passing and returning a void&#42; pointer</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// as the first or second argument. Translate it that way, instead of</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// trying to model &quot;inreg&quot; in the thunk&#39;s calling convention; this</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// simplfies the rest of the code, and matches MSVC mangling.</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">        Out &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;i8&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">        Arm64RetTy = I64Ty;</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">        X64RetTy = I64Ty;</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SRetAttr0.<a href="/docs/api/classes/llvm/attribute/#adf4d22686e85732b2fef71e3c45531c6">isValid</a>()) &#123;</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// FIXME: Sanity-check the sret type; if it&#39;s an integer or pointer,</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// we&#39;ll get screwy mangling/codegen.</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// FIXME: For large struct types, mangle as an integer argument and</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// integer return, so we can reuse more thunks, instead of &quot;m&quot; syntax.</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// (MSVC mangles this case as an integer return with no argument, but</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// that&#39;s a miscompile.)</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/type">Type</a> &#42;SRetType = SRetAttr0.<a href="/docs/api/classes/llvm/attribute/#aff1705f60feb6936d4e9cf126347c5e7">getValueAsType</a>();</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">        <a href="/docs/api/structs/llvm/align">Align</a> SRetAlign = AttrList.getParamAlignment(0).valueOrOne();</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">        canonicalizeThunkType(SRetType, SRetAlign, </span><span class="doxyHighlightComment">/&#42;Ret&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, ArgSizeBytes,</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">                              Out);</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">        Arm64RetTy = VoidTy;</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">        X64RetTy = VoidTy;</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">        Arm64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FT-&gt;getParamType(0));</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">        X64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FT-&gt;getParamType(0));</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">        ArgTranslations.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea2ae40416f6380618d5b202ac553d6bdc">ThunkArgTranslation::Direct</a>);</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">        HasSretPtr = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    Out &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;v&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">    Arm64RetTy = VoidTy;</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">    X64RetTy = VoidTy;</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/lazyvalueinfo-cpp/#ad7f64bcc544dcefb2e068282af1c549d">info</a> =</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">      canonicalizeThunkType(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, <a href="/docs/api/structs/llvm/align">Align</a>(), </span><span class="doxyHighlightComment">/&#42;Ret&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, ArgSizeBytes, Out);</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">  Arm64RetTy = <a href="/docs/api/files/lib/lib/analysis/lazyvalueinfo-cpp/#ad7f64bcc544dcefb2e068282af1c549d">info</a>.Arm64Ty;</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">  X64RetTy = <a href="/docs/api/files/lib/lib/analysis/lazyvalueinfo-cpp/#ad7f64bcc544dcefb2e068282af1c549d">info</a>.X64Ty;</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X64RetTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) &#123;</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the X64 type is canonicalized to a pointer, that means it&#39;s</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// passed/returned indirectly. For a return value, that means it&#39;s an</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sret pointer.</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">    X64ArgTypes.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(X64RetTy);</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">    X64RetTy = VoidTy;</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">ThunkArgInfo AArch64Arm64ECCallLowering::canonicalizeThunkType(</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, <a href="/docs/api/structs/llvm/align">Align</a> Alignment, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Ret, uint64&#95;t ArgSizeBytes,</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;Out) &#123;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> direct = &#91;&#93;(<a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>) &#123;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ThunkArgInfo&#123;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea2ae40416f6380618d5b202ac553d6bdc">ThunkArgTranslation::Direct</a>&#125;;</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> bitcast = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Arm64Ty, uint64&#95;t SizeInBytes) &#123;</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ThunkArgInfo&#123;Arm64Ty,</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/type/#acaf8e4c3e40e01e848c1fad5f05b81cd">llvm::Type::getIntNTy</a>(M-&gt;getContext(), SizeInBytes &#42; 8),</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">                        <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea8e0d8fd987857f4309346ef8d456f262">ThunkArgTranslation::Bitcast</a>&#125;;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> pointerIndirection = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Arm64Ty) &#123;</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ThunkArgInfo&#123;Arm64Ty, PtrTy,</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">                        <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ead1f6023b9a6528d5f52dc7de2650be19">ThunkArgTranslation::PointerIndirection</a>&#125;;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;isFloatTy()) &#123;</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">    Out &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;f&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> direct(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;isDoubleTy()) &#123;</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">    Out &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;d&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> direct(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;isFloatingPointTy()) &#123;</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Only 32 and 64 bit floating points are supported for ARM64EC thunks&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = M-&gt;getDataLayout();</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StructTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StructType&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>))</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (StructTy-&gt;getNumElements() == 1)</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = StructTy-&gt;getElementType(0);</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;isArrayTy()) &#123;</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ElementTy = <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;getArrayElementType();</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">    uint64&#95;t ElementCnt = <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;getArrayNumElements();</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">    uint64&#95;t ElementSizePerBytes = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(ElementTy) / 8;</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">    uint64&#95;t TotalSizeBytes = ElementCnt &#42; ElementSizePerBytes;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ElementTy-&gt;<a href="/docs/api/classes/llvm/type/#a3ffc75c3a4cb82ba307a3334483eb4ac">isFloatTy</a>() || ElementTy-&gt;<a href="/docs/api/classes/llvm/type/#aa0fd6bf3d33236279db7b707bba755f4">isDoubleTy</a>()) &#123;</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">      Out &lt;&lt; (ElementTy-&gt;<a href="/docs/api/classes/llvm/type/#a3ffc75c3a4cb82ba307a3334483eb4ac">isFloatTy</a>() ? </span><span class="doxyHighlightStringLiteral">&quot;F&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;D&quot;</span><span class="doxyHighlight">) &lt;&lt; TotalSizeBytes;</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Alignment.<a href="/docs/api/structs/llvm/align/#a80735739b49cf97a491922c8f9af2cc1">value</a>() &gt;= 16 &amp;&amp; !Ret)</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">        Out &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;a&quot;</span><span class="doxyHighlight"> &lt;&lt; Alignment.<a href="/docs/api/structs/llvm/align/#a80735739b49cf97a491922c8f9af2cc1">value</a>();</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TotalSizeBytes &lt;= 8) &#123;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Arm64 returns small structs of float/double in float registers;</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// X64 uses RAX.</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> bitcast(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, TotalSizeBytes);</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Struct is passed directly on Arm64, but indirectly on X64.</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> pointerIndirection(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;isFloatingPointTy()) &#123;</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</span><span class="doxyHighlightStringLiteral">&quot;Only 32 and 64 bit floating points are supported for &quot;</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;ARM64EC thunks&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;isIntegerTy() || <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;isPointerTy()) &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>) &lt;= 64) &#123;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">    Out &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;i8&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> direct(I64Ty);</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/typesize">TypeSize</a> = ArgSizeBytes;</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/typesize">TypeSize</a> == 0)</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/typesize">TypeSize</a> = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>) / 8;</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">  Out &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;m&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/typesize">TypeSize</a> != 4)</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">    Out &lt;&lt; <a href="/docs/api/classes/llvm/typesize">TypeSize</a>;</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Alignment.<a href="/docs/api/structs/llvm/align/#a80735739b49cf97a491922c8f9af2cc1">value</a>() &gt;= 16 &amp;&amp; !Ret)</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">    Out &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;a&quot;</span><span class="doxyHighlight"> &lt;&lt; Alignment.<a href="/docs/api/structs/llvm/align/#a80735739b49cf97a491922c8f9af2cc1">value</a>();</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Try to canonicalize Arm64Ty more thoroughly?</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/typesize">TypeSize</a> == 1 || <a href="/docs/api/classes/llvm/typesize">TypeSize</a> == 2 || <a href="/docs/api/classes/llvm/typesize">TypeSize</a> == 4 || <a href="/docs/api/classes/llvm/typesize">TypeSize</a> == 8) &#123;</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Pass directly in an integer register</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> bitcast(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>, <a href="/docs/api/classes/llvm/typesize">TypeSize</a>);</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Passed directly on Arm64, but indirectly on X64.</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> pointerIndirection(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlightComment">// This function builds the &quot;exit thunk&quot;, a function which translates</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlightComment">// arguments and return values when calling x64 code from AArch64 code.</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393" lineLink="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#ac134215053dd186eca7bdd553eabc68c"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#ac134215053dd186eca7bdd553eabc68c">AArch64Arm64ECCallLowering::buildExitThunk</a>(<a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;FT,</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">                                                     AttributeList Attrs) &#123;</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallstring">SmallString&lt;256&gt;</a> ExitThunkName;</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/raw-svector-ostream">llvm::raw&#95;svector&#95;ostream</a> ExitThunkStream(ExitThunkName);</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;Arm64Ty, &#42;X64Ty;</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ThunkArgTranslation&gt;</a> ArgTranslations;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">  getThunkType(FT, Attrs, <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39cacd4cef2a5a26efd5d75ecca95bc6ff24">Arm64ECThunkType::Exit</a>, ExitThunkStream, Arm64Ty,</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">               X64Ty, ArgTranslations);</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = M-&gt;getFunction(ExitThunkName))</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>;</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(Arm64Ty, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57caf2b592edf18170e7aff4e8f3bae3360c">GlobalValue::LinkOnceODRLinkage</a>, 0,</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">                                 ExitThunkName, M);</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;setCallingConv(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca047fefb5017b2873eb2e88f1a27fb14a">CallingConv::ARM64EC&#95;Thunk&#95;Native</a>);</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;setSection(</span><span class="doxyHighlightStringLiteral">&quot;.wowthk$aa&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;setComdat(M-&gt;getOrInsertComdat(ExitThunkName));</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Copy MSVC, and always set up a frame pointer. (Maybe this isn&#39;t necessary.)</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;addFnAttr(</span><span class="doxyHighlightStringLiteral">&quot;frame-pointer&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;all&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only copy sret from the first argument. For C++ instance methods, clang can</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stick an sret marking on a later argument, but it doesn&#39;t actually affect</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the ABI, so we can omit it. This avoids triggering a verifier assertion.</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FT-&gt;<a href="/docs/api/classes/llvm/functiontype/#a104d6154321899b53e40455e71d8e83a">getNumParams</a>()) &#123;</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SRet = Attrs.getParamAttr(0, Attribute::StructRet);</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InReg = Attrs.getParamAttr(0, Attribute::InReg);</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SRet.isValid() &amp;&amp; !InReg.isValid())</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;addParamAttr(1, SRet);</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Copy anything other than sret?  Shouldn&#39;t be necessary for normal</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// C ABI, but might show up in other cases.</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(M-&gt;getContext(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> IRB(BB);</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CalleePtr =</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">      M-&gt;getOrInsertGlobal(</span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;os&#95;arm64x&#95;dispatch&#95;call&#95;no&#95;redirect&quot;</span><span class="doxyHighlight">, PtrTy);</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Callee = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(PtrTy, CalleePtr);</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = M-&gt;getDataLayout();</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> Args;</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Pass the called function in x9.</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> X64TyOffset = 1;</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">  Args.push&#95;back(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;arg&#95;begin());</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = Arm64Ty-&gt;<a href="/docs/api/classes/llvm/functiontype/#ad65790aa94dd4678a1d339d8304e1965">getReturnType</a>();</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RetTy != X64Ty-&gt;<a href="/docs/api/classes/llvm/functiontype/#ad65790aa94dd4678a1d339d8304e1965">getReturnType</a>()) &#123;</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the return type is an array or struct, translate it. Values of size</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// 8 or less go into RAX; bigger values go into memory, and we pass a</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointer.</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(RetTy) &gt; 8) &#123;</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">      Args.push&#95;back(IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(RetTy));</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">      X64TyOffset++;</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;Arg, X64ArgType, ArgTranslation&#93; : <a href="/docs/api/namespaces/llvm/#a19010bf2388f505d1262e23f9f87a813">llvm::zip&#95;equal</a>(</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;arg&#95;begin() + 1, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;arg&#95;end()),</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(X64Ty-&gt;<a href="/docs/api/classes/llvm/functiontype/#a05d5616e1422394b4d350c008b0cc5e0">param&#95;begin</a>() + X64TyOffset, X64Ty-&gt;<a href="/docs/api/classes/llvm/functiontype/#aeae69a459419ec0bb738cdc73f4fc2a1">param&#95;end</a>()),</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">           ArgTranslations)) &#123;</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Translate arguments from AArch64 calling convention to x86 calling</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// convention.</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For simple types, we don&#39;t need to do any translation: they&#39;re</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// represented the same way. (Implicit sign extension is not part of</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// either convention.)</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The big thing we have to worry about is struct types... but</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// fortunately AArch64 clang is pretty friendly here: the cases that need</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// translation are always passed as a struct or array. (If we run into</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// some cases where this doesn&#39;t work, we can teach clang to mark it up</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// with an attribute.)</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The first argument is the called function, stored in x9.</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgTranslation != <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea2ae40416f6380618d5b202ac553d6bdc">ThunkArgTranslation::Direct</a>) &#123;</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Mem = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(Arg.getType());</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">      IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(&amp;Arg, Mem);</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgTranslation == <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea8e0d8fd987857f4309346ef8d456f262">ThunkArgTranslation::Bitcast</a>) &#123;</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/type">Type</a> &#42;IntTy = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a31e2db8d1b315202d2c19e711b5365fd">getIntNTy</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSizeInBits(Arg.getType()));</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">        Args.push&#95;back(IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(IntTy, IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(Mem, PtrTy)));</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ArgTranslation == <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ead1f6023b9a6528d5f52dc7de2650be19">ThunkArgTranslation::PointerIndirection</a>);</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">        Args.push&#95;back(Mem);</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">      Args.push&#95;back(&amp;Arg);</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Args.back()-&gt;getType() == X64ArgType);</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Transfer necessary attributes? sret? anything else?</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">  Callee = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(Callee, PtrTy);</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(X64Ty, Callee, Args);</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setCallingConv(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4caf80cc3a71c40926e6c35a60ccdc6428e">CallingConv::ARM64EC&#95;Thunk&#95;X64</a>);</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetVal = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RetTy != X64Ty-&gt;<a href="/docs/api/classes/llvm/functiontype/#ad65790aa94dd4678a1d339d8304e1965">getReturnType</a>()) &#123;</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we rewrote the return type earlier, convert the return value to</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the proper type.</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeStoreSize(RetTy) &gt; 8) &#123;</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">      RetVal = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(RetTy, Args&#91;1&#93;);</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastAlloca = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(RetTy);</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">      IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(CastAlloca, PtrTy));</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">      RetVal = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(RetTy, CastAlloca);</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RetTy-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>())</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">    IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">    IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a5d0c52ee1cde6421f98c193e0e42b97d">CreateRet</a>(RetVal);</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>;</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlightComment">// This function builds the &quot;entry thunk&quot;, a function which translates</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlightComment">// arguments and return values when calling AArch64 code from x64 code.</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506" lineLink="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a101a4250b1fd5a230a766de2a14cb271"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a101a4250b1fd5a230a766de2a14cb271">AArch64Arm64ECCallLowering::buildEntryThunk</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallstring">SmallString&lt;256&gt;</a> EntryThunkName;</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/raw-svector-ostream">llvm::raw&#95;svector&#95;ostream</a> EntryThunkStream(EntryThunkName);</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;Arm64Ty, &#42;X64Ty;</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ThunkArgTranslation&gt;</a> ArgTranslations;</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">  getThunkType(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes(),</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Arm64ECThunkType::Entry</a>, EntryThunkStream, Arm64Ty, X64Ty,</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">               ArgTranslations);</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = M-&gt;getFunction(EntryThunkName))</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>;</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Thunk = <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(X64Ty, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57caf2b592edf18170e7aff4e8f3bae3360c">GlobalValue::LinkOnceODRLinkage</a>, 0,</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">                                     EntryThunkName, M);</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">  Thunk-&gt;setCallingConv(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4caf80cc3a71c40926e6c35a60ccdc6428e">CallingConv::ARM64EC&#95;Thunk&#95;X64</a>);</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">  Thunk-&gt;setSection(</span><span class="doxyHighlightStringLiteral">&quot;.wowthk$aa&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">  Thunk-&gt;setComdat(M-&gt;getOrInsertComdat(EntryThunkName));</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Copy MSVC, and always set up a frame pointer. (Maybe this isn&#39;t necessary.)</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">  Thunk-&gt;addFnAttr(</span><span class="doxyHighlightStringLiteral">&quot;frame-pointer&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;all&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(M-&gt;getContext(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, Thunk);</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> IRB(BB);</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = Arm64Ty-&gt;<a href="/docs/api/classes/llvm/functiontype/#ad65790aa94dd4678a1d339d8304e1965">getReturnType</a>();</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;X64RetType = X64Ty-&gt;<a href="/docs/api/classes/llvm/functiontype/#ad65790aa94dd4678a1d339d8304e1965">getReturnType</a>();</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TransformDirectToSRet = X64RetType-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>() &amp;&amp; !RetTy-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>();</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ThunkArgOffset = TransformDirectToSRet ? 2 : 1;</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PassthroughArgSize =</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">      (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isVarArg() ? 5 : Thunk-&gt;arg&#95;size()) - ThunkArgOffset;</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ArgTranslations.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isVarArg() ? 5 : PassthroughArgSize));</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Translate arguments to call.</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> Args;</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i != PassthroughArgSize; ++i) &#123;</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = Thunk-&gt;getArg(i + ThunkArgOffset);</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ArgTy = Arm64Ty-&gt;<a href="/docs/api/classes/llvm/functiontype/#a1e415dc42f391c1d0cfcc1c28c00b2f4">getParamType</a>(i);</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">    <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59e">ThunkArgTranslation</a> ArgTranslation = ArgTranslations&#91;i&#93;;</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgTranslation != <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea2ae40416f6380618d5b202ac553d6bdc">ThunkArgTranslation::Direct</a>) &#123;</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Translate array/struct arguments to the expected type.</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgTranslation == <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ea8e0d8fd987857f4309346ef8d456f262">ThunkArgTranslation::Bitcast</a>) &#123;</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastAlloca = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(ArgTy);</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">        IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(Arg, IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(CastAlloca, PtrTy));</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">        Arg = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(ArgTy, CastAlloca);</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ArgTranslation == <a href="/docs/api/namespaces/anonymous-aarch64arm64eccalllowering-cpp-/#a90d5de758d7bbed5750d7f8756efd59ead1f6023b9a6528d5f52dc7de2650be19">ThunkArgTranslation::PointerIndirection</a>);</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">        Arg = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(ArgTy, IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(Arg, PtrTy));</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Arg-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == ArgTy);</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">    Args.push&#95;back(Arg);</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isVarArg()) &#123;</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The 5th argument to variadic entry thunks is used to model the x64 sp</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// which is passed to the thunk in x4, this can be passed to the callee as</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the variadic argument start address after skipping over the 32 byte</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// shadow store.</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The EC thunk CC will assign any argument marked as InReg to x4.</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">    Thunk-&gt;addParamAttr(5, Attribute::InReg);</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg = Thunk-&gt;getArg(5);</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">    Arg = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a5b416a8603ccb844165c8df22454ac05">CreatePtrAdd</a>(Arg, IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(0x20));</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">    Args.push&#95;back(Arg);</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Pass in a zero variadic argument size (in x5).</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">    Args.push&#95;back(IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a73f286a780fbb8c82c0a8574540719ea">getInt64</a>(0));</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Call the function passed to the thunk.</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Callee = Thunk-&gt;getArg(0);</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">  Callee = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(Callee, PtrTy);</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#ab086c5b9f9563eda0cdd703f454e041e">CreateCall</a>(Arm64Ty, Callee, Args);</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SRetAttr = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes().getParamAttr(0, Attribute::StructRet);</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InRegAttr = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes().getParamAttr(0, Attribute::InReg);</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SRetAttr.isValid() &amp;&amp; !InRegAttr.isValid()) &#123;</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">    Thunk-&gt;addParamAttr(1, SRetAttr);</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;addParamAttr(0, SRetAttr);</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetVal = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TransformDirectToSRet) &#123;</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">    IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(RetVal, IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(Thunk-&gt;getArg(1), PtrTy));</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X64RetType != RetTy) &#123;</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastAlloca = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a1b30cd686a320a8e5cb4532fd3a552a8">CreateAlloca</a>(X64RetType);</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">    IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#aabfc20af4dcf7d94262824dcac2e7bed">CreateStore</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a932f08e32ea37a7019902ee467beb268">CreateBitCast</a>(CastAlloca, PtrTy));</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">    RetVal = IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a9b01712e5f196d6d3d021ef23aad50e4">CreateLoad</a>(X64RetType, CastAlloca);</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return to the caller.  Note that the isel has code to translate this</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &quot;ret&quot; to a tail call to &#95;&#95;os&#95;arm64x&#95;dispatch&#95;ret.  (Alternatively, we</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// could emit a tail call here, but that would require a dedicated calling</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// convention, which seems more complicated overall.)</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (X64RetType-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>())</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">    IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#aa6536556982b7e6e2e5884e471f3ce6b">CreateRetVoid</a>();</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">    IRB.<a href="/docs/api/classes/llvm/irbuilderbase/#a5d0c52ee1cde6421f98c193e0e42b97d">CreateRet</a>(RetVal);</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Thunk;</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlightComment">// Builds the &quot;guest exit thunk&quot;, a helper to call a function which may or may</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlightComment">// not be an exit thunk. (We optimistically assume non-dllimport function</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlightComment">// declarations refer to functions defined in AArch64 code; if the linker</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlightComment">// can&#39;t prove that, we use this routine instead.)</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611" lineLink="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a7990af2ca325a18286d49b694c835c98"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a7990af2ca325a18286d49b694c835c98">AArch64Arm64ECCallLowering::buildGuestExitThunk</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/raw-null-ostream">llvm::raw&#95;null&#95;ostream</a> NullThunkName;</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;Arm64Ty, &#42;X64Ty;</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ThunkArgTranslation&gt;</a> ArgTranslations;</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">  getThunkType(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes(),</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">Arm64ECThunkType::GuestExit</a>, NullThunkName, Arm64Ty, X64Ty,</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">               ArgTranslations);</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MangledName = <a href="/docs/api/namespaces/llvm/#a0cc2ab42606e3b20a8746fa57c046ae8">getArm64ECMangledFunctionName</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName().str());</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MangledName &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t guest exit to function that&#39;s already native&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">  std::string ThunkName = &#42;MangledName;</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ThunkName&#91;0&#93; == </span><span class="doxyHighlightCharLiteral">&#39;?&#39;</span><span class="doxyHighlight"> &amp;&amp; ThunkName.find(</span><span class="doxyHighlightStringLiteral">&quot;@&quot;</span><span class="doxyHighlight">) != std::string::npos) &#123;</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">    ThunkName.insert(ThunkName.find(</span><span class="doxyHighlightStringLiteral">&quot;@&quot;</span><span class="doxyHighlight">), </span><span class="doxyHighlightStringLiteral">&quot;$exit&#95;thunk&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">    ThunkName.append(</span><span class="doxyHighlightStringLiteral">&quot;$exit&#95;thunk&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a> =</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(Arm64Ty, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca696bb1c9b0b0e76bb70c61f68866452a">GlobalValue::WeakODRLinkage</a>, 0, ThunkName, M);</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>-&gt;setComdat(M-&gt;getOrInsertComdat(ThunkName));</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>-&gt;setSection(</span><span class="doxyHighlightStringLiteral">&quot;.wowthk$aa&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>-&gt;setMetadata(</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;arm64ec&#95;unmangled&#95;name&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(M-&gt;getContext(),</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(M-&gt;getContext(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName())));</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>-&gt;setMetadata(</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;arm64ec&#95;ecmangled&#95;name&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(M-&gt;getContext(),</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(M-&gt;getContext(), &#42;MangledName)));</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;setMetadata(</span><span class="doxyHighlightStringLiteral">&quot;arm64ec&#95;hasguestexit&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(M-&gt;getContext(), &#123;&#125;));</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(M-&gt;getContext(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>);</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>(BB);</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Load the global symbol as a pointer to the check function.</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;GuardFn;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (cfguard&#95;module&#95;flag == 2 &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasFnAttribute(</span><span class="doxyHighlightStringLiteral">&quot;guard&#95;nocf&quot;</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">    GuardFn = GuardFnCFGlobal;</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">    GuardFn = GuardFnGlobal;</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;GuardCheckLoad = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateLoad(GuardFnPtrType, GuardFn);</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create new call instruction. The CFGuard check should always be a call,</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// even if the original CallBase is an Invoke or CallBr instruction.</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Thunk = <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#ac134215053dd186eca7bdd553eabc68c">buildExitThunk</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes());</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;GuardCheck = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateCall(</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">      GuardFnType, GuardCheckLoad,</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">      &#123;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateBitCast(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getPtrTy()), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateBitCast(Thunk, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getPtrTy())&#125;);</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ensure that the first argument is passed in the correct register.</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">  GuardCheck-&gt;<a href="/docs/api/classes/llvm/callbase/#a0851b4de29686e9c3918449b054cfada">setCallingConv</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca3f8227288993442d6f4a0bb234c9bc5b">CallingConv::CFGuard&#95;Check</a>);</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;GuardRetVal = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateBitCast(GuardCheck, PtrTy);</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> Args;</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/argument">Argument</a> &amp;Arg : <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>-&gt;args())</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">    Args.push&#95;back(&amp;Arg);</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateCall(Arm64Ty, GuardRetVal, Args);</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setTailCallKind(<a href="/docs/api/classes/llvm/callinst/#ad682514c13f12f1a8d759d422fce6aefa2c3fc2c37f5db1dd777fad4e0d33ec7e">llvm::CallInst::TCK&#95;MustTail</a>);</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getType()-&gt;isVoidTy())</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateRetVoid();</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateRet(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>);</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SRetAttr = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes().getParamAttr(0, Attribute::StructRet);</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InRegAttr = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes().getParamAttr(0, Attribute::InReg);</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SRetAttr.isValid() &amp;&amp; !InRegAttr.isValid()) &#123;</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>-&gt;addParamAttr(0, SRetAttr);</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;addParamAttr(0, SRetAttr);</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>;</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/function">Function</a> &#42;</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683" lineLink="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a3f27dda1e68a24fab4b3ed4a9cfc0e7c"><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a3f27dda1e68a24fab4b3ed4a9cfc0e7c">AArch64Arm64ECCallLowering::buildPatchableThunk</a>(<a href="/docs/api/classes/llvm/globalalias">GlobalAlias</a> &#42;UnmangledAlias,</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/globalalias">GlobalAlias</a> &#42;MangledAlias) &#123;</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/raw-null-ostream">llvm::raw&#95;null&#95;ostream</a> NullThunkName;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;Arm64Ty, &#42;X64Ty;</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Function&gt;</a>(MangledAlias-&gt;<a href="/docs/api/classes/llvm/globalalias/#a7666cc7bd9294c7ae9992c41c591e08b">getAliasee</a>());</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ThunkArgTranslation&gt;</a> ArgTranslations;</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">  getThunkType(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes(),</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">Arm64ECThunkType::GuestExit</a>, NullThunkName, Arm64Ty, X64Ty,</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">               ArgTranslations);</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">  std::string ThunkName(MangledAlias-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ThunkName&#91;0&#93; == </span><span class="doxyHighlightCharLiteral">&#39;?&#39;</span><span class="doxyHighlight"> &amp;&amp; ThunkName.find(</span><span class="doxyHighlightStringLiteral">&quot;@&quot;</span><span class="doxyHighlight">) != std::string::npos) &#123;</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">    ThunkName.insert(ThunkName.find(</span><span class="doxyHighlightStringLiteral">&quot;@&quot;</span><span class="doxyHighlight">), </span><span class="doxyHighlightStringLiteral">&quot;$hybpatch&#95;thunk&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">    ThunkName.append(</span><span class="doxyHighlightStringLiteral">&quot;$hybpatch&#95;thunk&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a> =</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(Arm64Ty, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca696bb1c9b0b0e76bb70c61f68866452a">GlobalValue::WeakODRLinkage</a>, 0, ThunkName, M);</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>-&gt;setComdat(M-&gt;getOrInsertComdat(ThunkName));</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>-&gt;setSection(</span><span class="doxyHighlightStringLiteral">&quot;.wowthk$aa&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(M-&gt;getContext(), </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>);</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>(BB);</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Load the global symbol as a pointer to the check function.</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;DispatchLoad = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateLoad(DispatchFnPtrType, DispatchFnGlobal);</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create new dispatch call instruction.</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;ExitThunk =</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#ac134215053dd186eca7bdd553eabc68c">buildExitThunk</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes());</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;Dispatch =</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateCall(DispatchFnType, DispatchLoad,</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">                   &#123;UnmangledAlias, ExitThunk, UnmangledAlias-&gt;<a href="/docs/api/classes/llvm/globalalias/#a7666cc7bd9294c7ae9992c41c591e08b">getAliasee</a>()&#125;);</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ensure that the first arguments are passed in the correct registers.</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">  Dispatch-&gt;<a href="/docs/api/classes/llvm/callbase/#a0851b4de29686e9c3918449b054cfada">setCallingConv</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca3f8227288993442d6f4a0bb234c9bc5b">CallingConv::CFGuard&#95;Check</a>);</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;DispatchRetVal = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateBitCast(Dispatch, PtrTy);</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;&gt;</a> Args;</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/argument">Argument</a> &amp;Arg : <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>-&gt;args())</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">    Args.push&#95;back(&amp;Arg);</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateCall(Arm64Ty, DispatchRetVal, Args);</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setTailCallKind(<a href="/docs/api/classes/llvm/callinst/#ad682514c13f12f1a8d759d422fce6aefa2c3fc2c37f5db1dd777fad4e0d33ec7e">llvm::CallInst::TCK&#95;MustTail</a>);</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getType()-&gt;isVoidTy())</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateRetVoid();</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateRet(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>);</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SRetAttr = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes().getParamAttr(0, Attribute::StructRet);</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InRegAttr = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes().getParamAttr(0, Attribute::InReg);</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SRetAttr.isValid() &amp;&amp; !InRegAttr.isValid()) &#123;</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>-&gt;addParamAttr(0, SRetAttr);</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;addParamAttr(0, SRetAttr);</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">  MangledAlias-&gt;<a href="/docs/api/classes/llvm/globalalias/#a629a9b41f0b6dfa91f5b0a7ac34f2d1a">setAliasee</a>(<a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>);</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">GuestExit</a>;</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlightComment">// Lower an indirect call with inline code.</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743" lineLink="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a7791efd93b12280fdad994fb6073933d"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a7791efd93b12280fdad994fb6073933d">AArch64Arm64ECCallLowering::lowerCall</a>(<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CB) &#123;</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/triple">Triple</a>(CB-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>()-&gt;<a href="/docs/api/classes/llvm/module/#a6b882824580b4666f692474ecbae56ad">getTargetTriple</a>()).<a href="/docs/api/classes/llvm/triple/#a7736bfc4c1afef875ecf02f2a7701fe3">isOSWindows</a>() &amp;&amp;</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Only applicable for Windows targets&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>(CB);</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CalledOperand = CB-&gt;<a href="/docs/api/classes/llvm/callbase/#a8d13199cbf4d080d3b5dcf330dad5d2c">getCalledOperand</a>();</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the indirect call is called within catchpad or cleanuppad,</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we need to copy &quot;funclet&quot; bundle of the call.</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;llvm::OperandBundleDef, 1&gt;</a> Bundles;</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Bundle = CB-&gt;<a href="/docs/api/classes/llvm/callbase/#a23ab5f34fb7b9476d45da0102ecbfae6">getOperandBundle</a>(<a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca8997c6b0930e2c05209e95e7172c6cf3">LLVMContext::OB&#95;funclet</a>))</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">    Bundles.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#aa97c65466bdd34abda6772dd32eb5d19">OperandBundleDef</a>(&#42;Bundle));</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Load the global symbol as a pointer to the check function.</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;GuardFn;</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (cfguard&#95;module&#95;flag == 2 &amp;&amp; !CB-&gt;<a href="/docs/api/classes/llvm/callbase/#a2fbfe5377a984518a7c03d8558df726d">hasFnAttr</a>(</span><span class="doxyHighlightStringLiteral">&quot;guard&#95;nocf&quot;</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">    GuardFn = GuardFnCFGlobal;</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">    GuardFn = GuardFnGlobal;</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;GuardCheckLoad = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateLoad(GuardFnPtrType, GuardFn);</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create new call instruction. The CFGuard check should always be a call,</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// even if the original CallBase is an Invoke or CallBr instruction.</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Thunk = <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#ac134215053dd186eca7bdd553eabc68c">buildExitThunk</a>(CB-&gt;<a href="/docs/api/classes/llvm/callbase/#ac3c35bd078a268a207f607d0f57dadba">getFunctionType</a>(), CB-&gt;<a href="/docs/api/classes/llvm/callbase/#ae0c55761fce39dd71617690b04385193">getAttributes</a>());</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;GuardCheck =</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateCall(GuardFnType, GuardCheckLoad,</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">                   &#123;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateBitCast(CalledOperand, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getPtrTy()),</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">                    <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateBitCast(Thunk, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.getPtrTy())&#125;,</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">                   Bundles);</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ensure that the first argument is passed in the correct register.</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">  GuardCheck-&gt;<a href="/docs/api/classes/llvm/callbase/#a0851b4de29686e9c3918449b054cfada">setCallingConv</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca3f8227288993442d6f4a0bb234c9bc5b">CallingConv::CFGuard&#95;Check</a>);</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;GuardRetVal = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateBitCast(GuardCheck, CalledOperand-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">  CB-&gt;<a href="/docs/api/classes/llvm/callbase/#ad70fe60b7ed052c6a74863944b518251">setCalledOperand</a>(GuardRetVal);</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780" lineLink="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a7b0a136ac6a10743ef5d3cbc1ee0190e"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a7b0a136ac6a10743ef5d3cbc1ee0190e">AArch64Arm64ECCallLowering::runOnModule</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a>) &#123;</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a7108745163cc6894b9a0e9c9430a48b8">GenerateThunks</a>)</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">  M = &amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a>;</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if this module has the cfguard flag and read its value.</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MD =</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/mdconst/#a86397deb1d9d25f7a17ce22c4d66482f">mdconst::extract&#95;or&#95;null&lt;ConstantInt&gt;</a>(M-&gt;getModuleFlag(</span><span class="doxyHighlightStringLiteral">&quot;cfguard&quot;</span><span class="doxyHighlight">)))</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">    cfguard&#95;module&#95;flag = MD-&gt;getZExtValue();</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">  PtrTy = <a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(M-&gt;getContext());</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">  I64Ty = <a href="/docs/api/classes/llvm/type/#a05186fa23e4d11b9855a9599ba87a4b7">Type::getInt64Ty</a>(M-&gt;getContext());</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">  VoidTy = <a href="/docs/api/classes/llvm/type/#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(M-&gt;getContext());</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">  GuardFnType = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(PtrTy, &#123;PtrTy, PtrTy&#125;, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">  GuardFnPtrType = <a href="/docs/api/classes/llvm/pointertype/#a8d7f800be5fd53dcfcdcbdc6fd9ccfe3">PointerType::get</a>(M-&gt;getContext(), 0);</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">  DispatchFnType = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(PtrTy, &#123;PtrTy, PtrTy, PtrTy&#125;, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">  DispatchFnPtrType = <a href="/docs/api/classes/llvm/pointertype/#a8d7f800be5fd53dcfcdcbdc6fd9ccfe3">PointerType::get</a>(M-&gt;getContext(), 0);</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">  GuardFnCFGlobal =</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">      M-&gt;getOrInsertGlobal(</span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;os&#95;arm64x&#95;check&#95;icall&#95;cfg&quot;</span><span class="doxyHighlight">, GuardFnPtrType);</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">  GuardFnGlobal =</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">      M-&gt;getOrInsertGlobal(</span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;os&#95;arm64x&#95;check&#95;icall&quot;</span><span class="doxyHighlight">, GuardFnPtrType);</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">  DispatchFnGlobal =</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">      M-&gt;getOrInsertGlobal(</span><span class="doxyHighlightStringLiteral">&quot;&#95;&#95;os&#95;arm64x&#95;dispatch&#95;call&quot;</span><span class="doxyHighlight">, DispatchFnPtrType);</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;GlobalAlias &#42;, GlobalAlias &#42;&gt;</a> FnsMap;</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;GlobalAlias &#42;&gt;</a> PatchableFns;</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a>) &#123;</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(Attribute::HybridPatchable) || <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDeclaration() ||</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasLocalLinkage() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName().ends&#95;with(</span><span class="doxyHighlightStringLiteral">&quot;$hp&#95;target&quot;</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Rename hybrid patchable functions and change callers to use a global</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// alias instead.</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::optional&lt;std::string&gt; MangledName =</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a0cc2ab42606e3b20a8746fa57c046ae8">getArm64ECMangledFunctionName</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName().str())) &#123;</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">      std::string OrigName(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName());</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setName(MangledName.value() + </span><span class="doxyHighlightStringLiteral">&quot;$hp&#95;target&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The unmangled symbol is a weak alias to an undefined symbol with the</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// &quot;EXP+&quot; prefix. This undefined symbol is resolved by the linker by</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// creating an x86 thunk that jumps back to the actual EC target. Since we</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// can&#39;t represent that in IR, we create an alias to the target instead.</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The &quot;EXP+&quot; symbol is set as metadata, which is then used by</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// emitGlobalAlias to emit the right alias.</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> =</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/globalalias/#a8a638534b520f72ab7f2c886da739a6c">GlobalAlias::create</a>(<a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57caf2b592edf18170e7aff4e8f3bae3360c">GlobalValue::LinkOnceODRLinkage</a>, OrigName, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.replaceAllUsesWith(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setMetadata(</span><span class="doxyHighlightStringLiteral">&quot;arm64ec&#95;exp&#95;name&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(M-&gt;getContext(),</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(M-&gt;getContext(),</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">                                              </span><span class="doxyHighlightStringLiteral">&quot;EXP+&quot;</span><span class="doxyHighlight"> + MangledName.value())));</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;setAliasee(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasDLLExportStorageClass()) &#123;</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;setDLLStorageClass(<a href="/docs/api/classes/llvm/globalvalue/#a6948096330886cc831391c75adbadaf8a81819441fb6de420d4290ac79aaf9dc0">GlobalValue::DLLExportStorageClass</a>);</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setDLLStorageClass(<a href="/docs/api/classes/llvm/globalvalue/#a6948096330886cc831391c75adbadaf8a5354f0f932438b7ec4d5d82d4ec1ae22">GlobalValue::DefaultStorageClass</a>);</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">      FnsMap&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>&#93; = <a href="/docs/api/classes/llvm/globalalias/#a8a638534b520f72ab7f2c886da739a6c">GlobalAlias::create</a>(<a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57caf2b592edf18170e7aff4e8f3bae3360c">GlobalValue::LinkOnceODRLinkage</a>,</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">                                      MangledName.value(), &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">      PatchableFns.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;GlobalValue &#42;&gt;</a> DirectCalledFns;</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a>)</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDeclaration() &amp;&amp;</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getCallingConv() != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca047fefb5017b2873eb2e88f1a27fb14a">CallingConv::ARM64EC&#95;Thunk&#95;Native</a> &amp;&amp;</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getCallingConv() != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4caf80cc3a71c40926e6c35a60ccdc6428e">CallingConv::ARM64EC&#95;Thunk&#95;X64</a>)</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">      <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a471ef961ae64095de93c59dea0a3262f">processFunction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, DirectCalledFns, FnsMap);</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">ThunkInfo &#123;</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Src;</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;Dst;</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39c">Arm64ECThunkType</a> Kind;</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ThunkInfo&gt;</a> ThunkMapping;</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a>) &#123;</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.isDeclaration() &amp;&amp; (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasLocalLinkage() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasAddressTaken()) &amp;&amp;</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getCallingConv() != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca047fefb5017b2873eb2e88f1a27fb14a">CallingConv::ARM64EC&#95;Thunk&#95;Native</a> &amp;&amp;</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getCallingConv() != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4caf80cc3a71c40926e6c35a60ccdc6428e">CallingConv::ARM64EC&#95;Thunk&#95;X64</a>) &#123;</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasComdat())</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setComdat(<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a>.getOrInsertComdat(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()));</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">      ThunkMapping.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">          &#123;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a101a4250b1fd5a230a766de2a14cb271">buildEntryThunk</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>), <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Arm64ECThunkType::Entry</a>&#125;);</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/globalvalue">GlobalValue</a> &#42;O : DirectCalledFns) &#123;</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GA = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalAlias&gt;</a>(O);</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Function&gt;</a>(GA ? GA-&gt;getAliasee() : O);</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">    ThunkMapping.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">        &#123;O, <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#ac134215053dd186eca7bdd553eabc68c">buildExitThunk</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes()),</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39cacd4cef2a5a26efd5d75ecca95bc6ff24">Arm64ECThunkType::Exit</a>&#125;);</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!GA &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasDLLImportStorageClass())</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">      ThunkMapping.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">          &#123;<a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a7990af2ca325a18286d49b694c835c98">buildGuestExitThunk</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>), <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">Arm64ECThunkType::GuestExit</a>&#125;);</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/globalalias">GlobalAlias</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : PatchableFns) &#123;</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;Thunk = <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a3f27dda1e68a24fab4b3ed4a9cfc0e7c">buildPatchableThunk</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, FnsMap&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>&#93;);</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">    ThunkMapping.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;Thunk, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39ca7404e0873ae6dcd0018aa365c1b61029">Arm64ECThunkType::GuestExit</a>&#125;);</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ThunkMapping.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Constant &#42;&gt;</a> ThunkMappingArrayElems;</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (ThunkInfo &amp;Thunk : ThunkMapping) &#123;</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">      ThunkMappingArrayElems.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/constantstruct/#ab154936bb49a215c32bdbd18254fc477">ConstantStruct::getAnon</a>(</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">          &#123;<a href="/docs/api/classes/llvm/constantexpr/#ae79d05dd3d0b05e080e08f8c5c33f880">ConstantExpr::getBitCast</a>(Thunk.Src, PtrTy),</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">           <a href="/docs/api/classes/llvm/constantexpr/#ae79d05dd3d0b05e080e08f8c5c33f880">ConstantExpr::getBitCast</a>(Thunk.Dst, PtrTy),</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">           ConstantInt::get(M-&gt;getContext(), <a href="/docs/api/classes/llvm/apint">APInt</a>(32, uint8&#95;t(Thunk.Kind)))&#125;));</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;ThunkMappingArray = <a href="/docs/api/classes/llvm/constantarray/#a0900dacdc7ad8e3ea0cc92993c7fd422">ConstantArray::get</a>(</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/arraytype/#a309fed0882f9d27038ff2df2afed7a00">llvm::ArrayType::get</a>(ThunkMappingArrayElems&#91;0&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>(),</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">                             ThunkMappingArrayElems.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>()),</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">        ThunkMappingArrayElems);</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/globalvariable">GlobalVariable</a>(<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a4aca2bf0c649ae08d5627e350bb80eb6">Mod</a>, ThunkMappingArray-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), </span><span class="doxyHighlightComment">/&#42;isConstant&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca6c93794d7b99cd433e96c53eadb15a6e">GlobalValue::ExternalLinkage</a>, ThunkMappingArray,</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">                       </span><span class="doxyHighlightStringLiteral">&quot;llvm.arm64ec.symbolmap&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905" lineLink="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a471ef961ae64095de93c59dea0a3262f"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a471ef961ae64095de93c59dea0a3262f">AArch64Arm64ECCallLowering::processFunction</a>(</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/setvector">SetVector&lt;GlobalValue &#42;&gt;</a> &amp;DirectCalledFns,</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;GlobalAlias &#42;, GlobalAlias &#42;&gt;</a> &amp;FnsMap) &#123;</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;CallBase &#42;, 8&gt;</a> IndirectCalls;</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For ARM64EC targets, a function definition&#39;s name is mangled differently</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from the normal symbol. We currently have no representation of this sort</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of symbol in IR, so we change the name to the mangled name, then store</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the unmangled name as metadata.  Later passes that need the unmangled</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// name (emitting the definition) can grab it from the metadata.</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Handle functions with weak linkage?</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasLocalLinkage() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasAddressTaken()) &#123;</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::optional&lt;std::string&gt; MangledName =</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a0cc2ab42606e3b20a8746fa57c046ae8">getArm64ECMangledFunctionName</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName().str())) &#123;</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setMetadata(</span><span class="doxyHighlightStringLiteral">&quot;arm64ec&#95;unmangled&#95;name&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(M-&gt;getContext(),</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(M-&gt;getContext(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName())));</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasComdat() &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getComdat()-&gt;getName() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()) &#123;</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/comdat">Comdat</a> &#42;MangledComdat = M-&gt;getOrInsertComdat(MangledName.value());</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;GlobalObject &#42;&gt;</a> ComdatUsers =</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a886094eaed7ce32029ea52a641142b88">to&#95;vector</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getComdat()-&gt;getUsers());</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/globalobject">GlobalObject</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> : ComdatUsers)</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/user">User</a>-&gt;setComdat(MangledComdat);</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.setName(MangledName.value());</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate over the instructions to find all indirect call/invoke/callbr</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions. Make a separate list of pointers to indirect</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call/invoke/callbr instructions because the original instructions will be</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// deleted as the checks are added.</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB) &#123;</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CB || CB-&gt;getCallingConv() == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4caf80cc3a71c40926e6c35a60ccdc6428e">CallingConv::ARM64EC&#95;Thunk&#95;X64</a> ||</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">          CB-&gt;isInlineAsm())</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We need to instrument any call that isn&#39;t directly calling an</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// ARM64 function.</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FIXME: getCalledFunction() fails if there&#39;s a bitcast (e.g.</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// unprototyped functions in C)</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CB-&gt;getCalledFunction()) &#123;</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a079a08ba8e62d90d8a2d789fde93633b">LowerDirectToIndirect</a> || <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasLocalLinkage() ||</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isIntrinsic() || !<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isDeclaration())</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">        DirectCalledFns.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Use mangled global alias for direct calls to patchable functions.</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/globalalias">GlobalAlias</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalAlias&gt;</a>(CB-&gt;getCalledOperand())) &#123;</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = FnsMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != FnsMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">          CB-&gt;setCalledOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second);</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">          DirectCalledFns.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;first);</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">      IndirectCalls.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CB);</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">      ++Arm64ECCallsLowered;</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IndirectCalls.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CB : IndirectCalls)</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">    <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a7791efd93b12280fdad994fb6073933d">lowerCall</a>(CB);</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a7cfd5aff2bec223cd6100ca7eaf231cb">AArch64Arm64ECCallLowering::ID</a> = 0;</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984" lineLink="#aacc28ff27759d26e74d37a78470ce0b7"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#af807c9595d50b45c0008924c4679c85c">INITIALIZE&#95;PASS</a>(<a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a8ed0ce49492f441faef4ff3eda95feef">AArch64Arm64ECCallLowering</a>, </span><span class="doxyHighlightStringLiteral">&quot;Arm64ECCallLowering&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot;AArch64Arm64ECCallLowering&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/modulepass">ModulePass</a> &#42;<a href="/docs/api/namespaces/llvm">llvm</a>::<a href="/docs/api/namespaces/llvm/#a79e6b86c713155bca69e937aa91d47ee">createAArch64Arm64ECCallLoweringPass</a>() &#123;</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-aarch64arm64eccalllowering-cpp-/aarch64arm64eccalllowering/#a8ed0ce49492f441faef4ff3eda95feef">AArch64Arm64ECCallLowering</a>;</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
