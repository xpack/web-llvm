---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/target/lib/target/webassembly/webassemblyfixfunctionbitcasts-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `WebAssemblyFixFunctionBitcasts.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>

Fix bitcasted functions. <a href="#details">More...</a>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="WebAssembly.h"
  permalink="/docs/api/files/lib/lib/target/lib/target/webassembly/webassembly-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Operator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Pass.h"
  permalink="/docs/api/files/include/include/llvm/pass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-webassemblyfixfunctionbitcasts-cpp-">anonymous&#123;WebAssemblyFixFunctionBitcasts.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-webassemblyfixfunctionbitcasts-cpp-/fixfunctionbitcasts">FixFunctionBitcasts</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/function">Function</a> &#42;</>}
  name={<><a href="#a96fb322d124e55de8f0fa2fe7e19e175">createWrapper</a> (Function &#42;F, FunctionType &#42;Ty)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a25bb1b65c9a916d968fcc66158103506">findUses</a> (Value &#42;V, Function &amp;F, SmallVectorImpl&lt; std::pair&lt; CallBase &#42;, Function &#42; &gt; &gt; &amp;Uses)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a01ffc29e5604616bbfef1469ae15b90d">INITIALIZE&#95;PASS</a> (FixFunctionBitcasts, DEBUG&#95;TYPE, &quot;Fix mismatching bitcasts for WebAssembly&quot;, false, false) ModulePass &#42;llvm</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a67f1f2b4ec605efc77e9bdab4ed7a82a">shouldFixMainFunction</a> (FunctionType &#42;FuncTy, FunctionType &#42;MainTy)</>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;wasm-<a href="/docs/api/files/lib/lib/target/lib/target/arm/armtargetmachine-cpp/#a86b29362e5d8fbb0d516610e4f988b5e">fix</a>-<a href="/docs/api/files/lib/lib/analysis/regionprinter-cpp/#aa37fbbce2360106772fd97ed06455d55">function</a>-bitcasts&quot;</>}>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

Fix bitcasted functions.

<a href="/docs/api/namespaces/llvm/webassembly">WebAssembly</a> requires caller and callee signatures to match, however in LLVM, some amount of slop is vaguely permitted. Detect mismatch by looking for bitcasts of functions and rewrite them to use wrapper functions instead.

This doesn&#39;t catch all cases, such as when a function&#39;s address is taken in one place and casted in another, but it works for many common cases.

Note that LLVM already optimizes away function bitcasts in common cases by dropping arguments as needed, so this pass only ends up getting used in less common cases.

<SectionDefinition>

## Functions

### createWrapper() {#a96fb322d124e55de8f0fa2fe7e19e175}

<MemberDefinition
  prototype={<>static Function &#42; createWrapper (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F, <a href="/docs/api/classes/functiontype">FunctionType</a> &#42; Ty)</>}
  labels = {["static"]}>

Definition at line <a href="#l00109">109</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblyfixfunctionbitcasts-cpp">WebAssemblyFixFunctionBitcasts.cpp</a>.
</MemberDefinition>

### findUses() {#a25bb1b65c9a916d968fcc66158103506}

<MemberDefinition
  prototype={<>static void findUses (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; std::pair&lt; <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;, <a href="/docs/api/classes/llvm/function">Function</a> &#42; &gt; &gt; &amp; Uses)</>}
  labels = {["static"]}>

Definition at line <a href="#l00066">66</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblyfixfunctionbitcasts-cpp">WebAssemblyFixFunctionBitcasts.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS() {#a01ffc29e5604616bbfef1469ae15b90d}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS (FixFunctionBitcasts, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, &quot;Fix mismatching bitcasts <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> WebAssembly&quot;, false, false)</>}>

Definition at line <a href="#l00057">57</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblyfixfunctionbitcasts-cpp">WebAssemblyFixFunctionBitcasts.cpp</a>.
</MemberDefinition>

### shouldFixMainFunction() {#a67f1f2b4ec605efc77e9bdab4ed7a82a}

<MemberDefinition
  prototype={<>static bool shouldFixMainFunction (<a href="/docs/api/classes/functiontype">FunctionType</a> &#42; FuncTy, <a href="/docs/api/classes/functiontype">FunctionType</a> &#42; MainTy)</>}
  labels = {["static"]}>

Definition at line <a href="#l00221">221</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblyfixfunctionbitcasts-cpp">WebAssemblyFixFunctionBitcasts.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;wasm-<a href="/docs/api/files/lib/lib/target/lib/target/arm/armtargetmachine-cpp/#a86b29362e5d8fbb0d516610e4f988b5e">fix</a>-<a href="/docs/api/files/lib/lib/analysis/regionprinter-cpp/#aa37fbbce2360106772fd97ed06455d55">function</a>-bitcasts&quot;</>}>

Definition at line <a href="#l00035">35</a> of file <a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassemblyfixfunctionbitcasts-cpp">WebAssemblyFixFunctionBitcasts.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===-- WebAssemblyFixFunctionBitcasts.cpp - Fix function bitcasts --------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="comment">/// \\file</Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="comment">/// Fix bitcasted functions.</Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="comment">/// WebAssembly requires caller and callee signatures to match, however in LLVM,</Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="comment">/// some amount of slop is vaguely permitted. Detect mismatch by looking for</Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="comment">/// bitcasts of functions and rewrite them to use wrapper functions instead.</Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="comment">/// This doesn&#39;t catch all cases, such as when a function&#39;s address is taken in</Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="comment">/// one place and casted in another, but it works for many common cases.</Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="comment">/// Note that LLVM already optimizes away function bitcasts in common cases by</Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="comment">/// dropping arguments as needed, so this pass only ends up getting used in less</Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="comment">/// common cases.</Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="comment">///</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/target/lib/target/webassembly/webassembly-h">WebAssembly.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h">llvm/IR/Operator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/pass-h">llvm/Pass.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;wasm-fix-function-bitcasts&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37" lineLink="/docs/api/namespaces/anonymous-webassemblyfixfunctionbitcasts-cpp-"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38" lineLink="/docs/api/classes/anonymous-namespace-webassemblyfixfunctionbitcasts-cpp-/fixfunctionbitcasts"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-webassemblyfixfunctionbitcasts-cpp-/fixfunctionbitcasts/#a7678b957c2c7e962ae90a4194ca768d2">FixFunctionBitcasts</a> final : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/modulepass/#a723659a08d210f4f566887bda3f9f976">ModulePass</a> &#123;</Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> getPassName()</Highlight><Highlight kind="keyword"> const override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="stringliteral">&quot;WebAssembly Fix Function Bitcasts&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> getAnalysisUsage(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</Highlight><Highlight kind="keyword"> const override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#af11a6ebf7ab3c388234cb6d5378439a3">setPreservesCFG</a>();</Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/pass/#a6590d0486104165ca40c7df0707f7b9e">ModulePass::getAnalysisUsage</a>(AU);</Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> runOnModule(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) </Highlight><Highlight kind="keyword">override</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51" lineLink="/docs/api/classes/anonymous-namespace-webassemblyfixfunctionbitcasts-cpp-/fixfunctionbitcasts/#ab4e363186db7fefa79678d2dcf6c1a53"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-webassemblyfixfunctionbitcasts-cpp-/fixfunctionbitcasts/#ab4e363186db7fefa79678d2dcf6c1a53">ID</a>;</Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52" lineLink="/docs/api/classes/anonymous-namespace-webassemblyfixfunctionbitcasts-cpp-/fixfunctionbitcasts/#a7678b957c2c7e962ae90a4194ca768d2"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-webassemblyfixfunctionbitcasts-cpp-/fixfunctionbitcasts/#a7678b957c2c7e962ae90a4194ca768d2">FixFunctionBitcasts</a>() : <a href="/docs/api/classes/llvm/modulepass/#a723659a08d210f4f566887bda3f9f976">ModulePass</a>(<a href="/docs/api/classes/anonymous-namespace-webassemblyfixfunctionbitcasts-cpp-/fixfunctionbitcasts/#ab4e363186db7fefa79678d2dcf6c1a53">ID</a>) &#123;&#125;</Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// End anonymous namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-webassemblyfixfunctionbitcasts-cpp-/fixfunctionbitcasts/#ab4e363186db7fefa79678d2dcf6c1a53">FixFunctionBitcasts::ID</a> = 0;</Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57" lineLink="#a01ffc29e5604616bbfef1469ae15b90d"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#af807c9595d50b45c0008924c4679c85c">INITIALIZE&#95;PASS</a>(<a href="/docs/api/classes/anonymous-namespace-webassemblyfixfunctionbitcasts-cpp-/fixfunctionbitcasts/#a7678b957c2c7e962ae90a4194ca768d2">FixFunctionBitcasts</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><Highlight kind="normal">                </Highlight><Highlight kind="stringliteral">&quot;Fix mismatching bitcasts for WebAssembly&quot;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal"><a href="/docs/api/classes/llvm/modulepass">ModulePass</a> &#42;<a href="/docs/api/namespaces/llvm">llvm</a>::<a href="/docs/api/namespaces/llvm/#ac190cf7a0c3d21937ee46d261fdbeee4">createWebAssemblyFixFunctionBitcasts</a>() &#123;</Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-webassemblyfixfunctionbitcasts-cpp-/fixfunctionbitcasts/#a7678b957c2c7e962ae90a4194ca768d2">FixFunctionBitcasts</a>();</Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Recursively descend the def-use lists from V to find non-bitcast users of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal"></Highlight><Highlight kind="comment">// bitcasts of V.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66" lineLink="#a25bb1b65c9a916d968fcc66158103506"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a25bb1b65c9a916d968fcc66158103506">findUses</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="normal">                     <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;CallBase &#42;, Function &#42;&gt;&gt; &amp;<a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>) &#123;</Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : V-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BC = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastOperator&gt;</a>(U))</Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="normal">      <a href="#a25bb1b65c9a916d968fcc66158103506">findUses</a>(BC, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>);</Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GlobalAlias&gt;</a>(U))</Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><Highlight kind="normal">      <a href="#a25bb1b65c9a916d968fcc66158103506">findUses</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>);</Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallBase&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Callee = CB-&gt;getCalledOperand();</Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Callee != V)</Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Skip calls where the function isn&#39;t the callee</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CB-&gt;getFunctionType() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getValueType())</Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Skip uses that are immediately called</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.push&#95;back(std::make&#95;pair(CB, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Create a wrapper function with type Ty that calls F (which may have a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><Highlight kind="normal"></Highlight><Highlight kind="comment">// different type). Attempt to support common bitcasted function idioms:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  - Call with more arguments than needed: arguments are dropped</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  - Call with fewer arguments than needed: arguments are filled in with poison</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  - Return value is not needed: drop it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  - Return value needed but not present: supply a poison value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><Highlight kind="normal"></Highlight><Highlight kind="comment">// If the all the argument types of trivially castable to one another (i.e.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="normal"></Highlight><Highlight kind="comment">// I32 vs pointer type) then we don&#39;t create a wrapper at all (return nullptr</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><Highlight kind="normal"></Highlight><Highlight kind="comment">// instead).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="normal"></Highlight><Highlight kind="comment">// If there is a type mismatch that we know would result in an invalid wasm</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><Highlight kind="normal"></Highlight><Highlight kind="comment">// module then generate wrapper that contains unreachable (i.e. abort at</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><Highlight kind="normal"></Highlight><Highlight kind="comment">// runtime).  Such programs are deep into undefined behaviour territory,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="normal"></Highlight><Highlight kind="comment">// but we choose to fail at runtime rather than generate and invalid module</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="normal"></Highlight><Highlight kind="comment">// or fail at compiler time.  The reason we delay the error is that we want</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><Highlight kind="normal"></Highlight><Highlight kind="comment">// to support the CMake which expects to be able to compile and link programs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal"></Highlight><Highlight kind="comment">// that refer to functions with entirely incorrect signatures (this is how</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="normal"></Highlight><Highlight kind="comment">// CMake detects the existence of a function in a toolchain).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="normal"></Highlight><Highlight kind="comment">// For bitcasts that involve struct types we don&#39;t know at this stage if they</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><Highlight kind="normal"></Highlight><Highlight kind="comment">// would be equivalent at the wasm level and so we can&#39;t know if we need to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="normal"></Highlight><Highlight kind="comment">// generate a wrapper.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109" lineLink="#a96fb322d124e55de8f0fa2fe7e19e175"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="#a96fb322d124e55de8f0fa2fe7e19e175">createWrapper</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/functiontype">FunctionType</a> &#42;Ty) &#123;</Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/module">Module</a> &#42;M = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a> = <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(Ty, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca04ed141708c0fd16723d212502b046ae">Function::PrivateLinkage</a>,</Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><Highlight kind="normal">                                       <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;&#95;bitcast&quot;</Highlight><Highlight kind="normal">, M);</Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a>-&gt;setAttributes(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes());</Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(M-&gt;getContext(), </Highlight><Highlight kind="stringliteral">&quot;body&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a>);</Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a858cab21fd29000697171b2f5b4bde31">getDataLayout</a>();</Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Determine what arguments to pass.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> Args;</Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function/#a1c9f2f058966db1f8ca270398bda8362">Function::arg&#95;iterator</a> AI = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a>-&gt;arg&#95;begin();</Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function/#a1c9f2f058966db1f8ca270398bda8362">Function::arg&#95;iterator</a> AE = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a>-&gt;arg&#95;end();</Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/functiontype/#a169beeeb49e770cbdbd9448ffd2af534">FunctionType::param&#95;iterator</a> PI = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType()-&gt;param&#95;begin();</Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/functiontype/#a169beeeb49e770cbdbd9448ffd2af534">FunctionType::param&#95;iterator</a> PE = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType()-&gt;param&#95;end();</Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> TypeMismatch = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> WrapperNeeded = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ExpectedRtnType = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType()-&gt;getReturnType();</Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RtnType = Ty-&gt;getReturnType();</Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType()-&gt;getNumParams() != Ty-&gt;getNumParams()) ||</Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><Highlight kind="normal">      (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType()-&gt;isVarArg() != Ty-&gt;isVarArg()) ||</Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="normal">      (ExpectedRtnType != RtnType))</Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="normal">    WrapperNeeded = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (; AI != AE &amp;&amp; PI != PE; ++AI, ++PI) &#123;</Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ArgType = AI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ParamType = &#42;PI;</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ArgType == ParamType) &#123;</Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="normal">      Args.push&#95;back(&amp;&#42;AI);</Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/castinst/#a94f850488e8bda1d1b400821d6d61bd1">CastInst::isBitOrNoopPointerCastable</a>(ArgType, ParamType, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)) &#123;</Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PtrCast =</Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/castinst/#acdb02479a44bbebcabf8b7b5e1baa921">CastInst::CreateBitOrPointerCast</a>(AI, ParamType, </Highlight><Highlight kind="stringliteral">&quot;cast&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="normal">        PtrCast-&gt;<a href="/docs/api/classes/llvm/instruction/#afcd9d2ea284c4d90541291ff9c47d332">insertInto</a>(BB, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="normal">        Args.push&#95;back(PtrCast);</Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ArgType-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>() || ParamType-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>()) &#123;</Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;createWrapper: struct param type in bitcast: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal">                          &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><Highlight kind="normal">        WrapperNeeded = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;createWrapper: arg type mismatch calling: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="normal">                          &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Arg&#91;&quot;</Highlight><Highlight kind="normal"> &lt;&lt; Args.size() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;&#93; Expected: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="normal">                          &lt;&lt; &#42;ParamType &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; Got: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;ArgType &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><Highlight kind="normal">        TypeMismatch = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (WrapperNeeded &amp;&amp; !TypeMismatch) &#123;</Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (; PI != PE; ++PI)</Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="normal">      Args.push&#95;back(<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(&#42;PI));</Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;isVarArg())</Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (; AI != AE; ++AI)</Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="normal">        Args.push&#95;back(&amp;&#42;AI);</Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Args, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, BB);</Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ExpectedRtnType = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType()-&gt;getReturnType();</Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;RtnType = Ty-&gt;getReturnType();</Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Determine what value to return.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RtnType-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>()) &#123;</Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/returninst/#a932710d4c1c965497707751eb4f7948f">ReturnInst::Create</a>(M-&gt;getContext(), BB);</Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExpectedRtnType-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>()) &#123;</Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Creating dummy return: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;RtnType &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/returninst/#a932710d4c1c965497707751eb4f7948f">ReturnInst::Create</a>(M-&gt;getContext(), <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(RtnType), BB);</Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RtnType == ExpectedRtnType) &#123;</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/returninst/#a932710d4c1c965497707751eb4f7948f">ReturnInst::Create</a>(M-&gt;getContext(), <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, BB);</Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/castinst/#a94f850488e8bda1d1b400821d6d61bd1">CastInst::isBitOrNoopPointerCastable</a>(ExpectedRtnType, RtnType,</Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal">                                                    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)) &#123;</Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Cast =</Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/castinst/#acdb02479a44bbebcabf8b7b5e1baa921">CastInst::CreateBitOrPointerCast</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, RtnType, </Highlight><Highlight kind="stringliteral">&quot;cast&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal">      Cast-&gt;<a href="/docs/api/classes/llvm/instruction/#afcd9d2ea284c4d90541291ff9c47d332">insertInto</a>(BB, BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/returninst/#a932710d4c1c965497707751eb4f7948f">ReturnInst::Create</a>(M-&gt;getContext(), Cast, BB);</Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RtnType-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>() || ExpectedRtnType-&gt;<a href="/docs/api/classes/llvm/type/#a81eef9d7336f7ee43be79630d8e8ec86">isStructTy</a>()) &#123;</Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;createWrapper: struct return type in bitcast: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><Highlight kind="normal">                        &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">      WrapperNeeded = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;createWrapper: return type mismatch calling: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="normal">                        &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Expected: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;ExpectedRtnType</Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; Got: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;RtnType &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="normal">      TypeMismatch = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TypeMismatch) &#123;</Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create a new wrapper that simply contains &#96;unreachable&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a> = <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(Ty, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca04ed141708c0fd16723d212502b046ae">Function::PrivateLinkage</a>,</Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal">                               <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;&#95;bitcast&#95;invalid&quot;</Highlight><Highlight kind="normal">, M);</Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a>-&gt;setAttributes(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getAttributes());</Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(M-&gt;getContext(), </Highlight><Highlight kind="stringliteral">&quot;body&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a>);</Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(M-&gt;getContext(), BB);</Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a>-&gt;setName(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;&#95;bitcast&#95;invalid&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!WrapperNeeded) &#123;</Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;createWrapper: no wrapper needed: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName()</Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;createWrapper: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a>;</Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Test whether a main function with type FuncTy should be rewritten to have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="normal"></Highlight><Highlight kind="comment">// type MainTy.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221" lineLink="#a67f1f2b4ec605efc77e9bdab4ed7a82a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a67f1f2b4ec605efc77e9bdab4ed7a82a">shouldFixMainFunction</a>(<a href="/docs/api/classes/functiontype">FunctionType</a> &#42;FuncTy, <a href="/docs/api/classes/functiontype">FunctionType</a> &#42;MainTy) &#123;</Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only fix the main function if it&#39;s the standard zero-arg form. That way,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the standard cases will work as expected, and users will see signature</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// mismatches from the linker for non-standard cases.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> FuncTy-&gt;getReturnType() == MainTy-&gt;getReturnType() &amp;&amp;</Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="normal">         FuncTy-&gt;getNumParams() == 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal">         !FuncTy-&gt;isVarArg();</Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> FixFunctionBitcasts::runOnModule(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42; Fix Function Bitcasts &#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Main = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CallMain = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;CallBase &#42;, Function &#42;&gt;</a>, 0&gt; <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>;</Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect all the places that need wrappers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : M) &#123;</Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip to fix when the function is swiftcc because swiftcc allows</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// bitcast type difference for swiftself and swifterror.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getCallingConv() == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca2740493172a4ce246941c8cff95e0f83">CallingConv::Swift</a>)</Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="normal">    <a href="#a25bb1b65c9a916d968fcc66158103506">findUses</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>);</Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we have a &quot;main&quot; function, and its type isn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &quot;int main(int argc, char &#42;argv&#91;&#93;)&quot;, create an artificial call with it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// bitcasted to that type so that we generate a wrapper for it, so that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the C runtime can call it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName() == </Highlight><Highlight kind="stringliteral">&quot;main&quot;</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="normal">      Main = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>;</Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = M.getContext();</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;MainArgTys&#91;&#93; = &#123;<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>), <a href="/docs/api/classes/llvm/pointertype/#a8d7f800be5fd53dcfcdcbdc6fd9ccfe3">PointerType::get</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, 0)&#125;;</Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="normal">      <a href="/docs/api/classes/functiontype">FunctionType</a> &#42;MainTy = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>), MainArgTys,</Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="normal">                                               </Highlight><Highlight kind="comment">/&#42;isVarArg=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a67f1f2b4ec605efc77e9bdab4ed7a82a">shouldFixMainFunction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getFunctionType(), MainTy)) &#123;</Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Found &#96;main&#96; function with incorrect type: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><Highlight kind="normal">                          &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getFunctionType() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/key/#a1958a762261549463a280bac3274d6d5">Args</a>&#91;&#93; = &#123;<a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(MainArgTys&#91;0&#93;),</Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="normal">                         <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(MainArgTys&#91;1&#93;)&#125;;</Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="normal">        CallMain = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(MainTy, Main, Args, </Highlight><Highlight kind="stringliteral">&quot;call&#95;main&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>.push&#95;back(std::make&#95;pair(CallMain, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;std::pair&lt;Function &#42;, FunctionType &#42;&gt;</a>, <a href="/docs/api/classes/llvm/function">Function</a> &#42;&gt; Wrappers;</Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;UseFunc : <a href="/docs/api/files/lib/lib/codegen/removeloadsintofakeuses-cpp/#a0b427ca665b192edbeb8d6ca3c8f19fd">Uses</a>) &#123;</Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;CB = UseFunc.first;</Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = UseFunc.second;</Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="normal">    <a href="/docs/api/classes/functiontype">FunctionType</a> &#42;Ty = CB-&gt;<a href="/docs/api/classes/llvm/callbase/#ac3c35bd078a268a207f607d0f57dadba">getFunctionType</a>();</Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Pair = Wrappers.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make&#95;pair(std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Ty), </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pair.second)</Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="normal">      Pair.first-&gt;second = <a href="#a96fb322d124e55de8f0fa2fe7e19e175">createWrapper</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, Ty);</Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a> = Pair.first-&gt;second;</Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a>)</Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><Highlight kind="normal">    CB-&gt;<a href="/docs/api/classes/llvm/callbase/#ad70fe60b7ed052c6a74863944b518251">setCalledOperand</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpualiasanalysis-cpp/#a63f565f28385a6f2c7a4756ff6f3fa16">Wrapper</a>);</Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we created a wrapper for main, rename the wrapper so that it&#39;s the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// one that gets called from startup.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallMain) &#123;</Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="normal">    Main-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</Highlight><Highlight kind="stringliteral">&quot;&#95;&#95;original&#95;main&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MainWrapper =</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Function&gt;</a>(CallMain-&gt;<a href="/docs/api/classes/llvm/callbase/#a8d13199cbf4d080d3b5dcf330dad5d2c">getCalledOperand</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a966eb231e7d4e572874d2cb49b18faea">stripPointerCasts</a>());</Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">delete</Highlight><Highlight kind="normal"> CallMain;</Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Main-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a32e606ac4c88f71f14212e42b808e7f4">isDeclaration</a>()) &#123;</Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The wrapper is not needed in this case as we don&#39;t need to export</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// it to anyone else.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal">      MainWrapper-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Otherwise give the wrapper the same linkage as the original main</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// function, so that it can be called from the same places.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><Highlight kind="normal">      MainWrapper-&gt;setName(</Highlight><Highlight kind="stringliteral">&quot;main&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><Highlight kind="normal">      MainWrapper-&gt;setLinkage(Main-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a3547d58a060ee2e4a29cbea85bef91af">getLinkage</a>());</Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal">      MainWrapper-&gt;setVisibility(Main-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a28b9561d9ef3d237ef894023187fa26c">getVisibility</a>());</Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>

</DoxygenPage>
