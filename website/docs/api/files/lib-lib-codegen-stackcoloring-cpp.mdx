---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/codegen/stackcoloring-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `StackColoring.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/CodeGen/StackColoring.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/stackcoloring-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/BitVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/bitvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DepthFirstIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/depthfirstiterator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/LiveInterval.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/liveinterval-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineBasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebasicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFrameInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineframeinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunctionPass.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunctionpass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineInstr.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstr-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineMemOperand.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinememoperand-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineOperand.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineoperand-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/Passes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/passes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/PseudoSourceValueManager.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/pseudosourcevaluemanager-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/SlotIndexes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/slotindexes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetOpcodes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetopcodes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/WinEHFuncInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/winehfuncinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Config/llvm-config.h"
  permalink=""
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfoMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Metadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Use.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/use-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Pass.h"
  permalink="/docs/api/files/include/include/llvm/pass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Compiler.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="limits"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="memory"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-stackcoloring-cpp-">anonymous&#123;StackColoring.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloring">StackColoring</a></>}>
<a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloring">StackColoring</a> - A machine pass for merging disjoint stack allocations, marked by the LIFETIME&#95;START and LIFETIME&#95;END pseudo instructions. <a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloring/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-stackcoloring-cpp-/stackcoloring/blocklifetimeinfo">BlockLifetimeInfo</a></>}>
A class representing liveness information for a single basic block. <a href="/docs/api/structs/anonymous-namespace-stackcoloring-cpp-/stackcoloring/blocklifetimeinfo/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy">StackColoringLegacy</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="int"
  name={<><a href="#a43f5859dde0766edb4f29aa13b5fb2cb">getStartOrEndSlot</a> (const MachineInstr &amp;MI)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a4cb1c1ecb52c8f4f676c55e1868ecf99">INITIALIZE&#95;PASS&#95;BEGIN</a> (StackColoringLegacy, DEBUG&#95;TYPE, &quot;Merge disjoint stack slots&quot;, false, false) INITIALIZE&#95;PASS&#95;END(StackColoringLegacy</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aa8b567861ccd4d18eec0502ff6a31601">STATISTIC</a> (NumMarkerSeen, &quot;Number of lifetime markers found.&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a4510e30ea295467b1a8841ed4a5939f5">STATISTIC</a> (StackSpaceSaved, &quot;Number of bytes saved due to merging slots.&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ae61759438a0bc1b71a92cfd9f6adb3fe">STATISTIC</a> (StackSlotMerged, &quot;Number of stack slot merged.&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a4235c2c9abcdf5628a8227462b200c20">STATISTIC</a> (EscapedAllocas, &quot;Number of allocas that escaped the lifetime region&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  name={<><a href="#a030569d5a541b6110f2ae1b6a3413a58">DEBUG&#95;TYPE</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a53f7abea6827cac44c5cc170ed1b2429">DisableColoring</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600clausemergepass-cpp/#aba99928790de45fa7aa12b47fbd828ff">Merge</a> disjoint stack</>}
  name={<><a href="#a70eb9db92f54bf1d91b4ade3eea56c64">false</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aa22542bc186b5f8835f2201b0e660685">LifetimeStartOnFirstUse</a></>}>
Enable enhanced dataflow scheme for lifetime analysis (treat first use of stack slot as start of slot lifetime, as opposed to looking for LIFETIME&#95;START marker). <a href="#aa22542bc186b5f8835f2201b0e660685">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a64335ebd86014e6660bc751627663b31">ProtectFromEscapedAllocas</a></>}>
The user may write code that uses allocas outside of the declared lifetime zone. <a href="#a64335ebd86014e6660bc751627663b31">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600clausemergepass-cpp/#aba99928790de45fa7aa12b47fbd828ff">Merge</a> disjoint stack</>}
  name={<><a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;stack-coloring&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### getStartOrEndSlot() {#a43f5859dde0766edb4f29aa13b5fb2cb}

<MemberDefinition
  prototype={<>static int getStartOrEndSlot (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp; MI)</>}
  labels = {["inline", "static"]}>

Definition at line <a href="#l00570">570</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS&#95;BEGIN() {#a4cb1c1ecb52c8f4f676c55e1868ecf99}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (StackColoringLegacy, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, &quot;Merge disjoint stack slots&quot;, false, false)</>}>

Definition at line <a href="#l00523">523</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aa8b567861ccd4d18eec0502ff6a31601}

<MemberDefinition
  prototype={<>STATISTIC (NumMarkerSeen, &quot;Number of lifetime markers found.&quot;)</>}>

Definition at line <a href="#l00094">94</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a4510e30ea295467b1a8841ed4a5939f5}

<MemberDefinition
  prototype={<>STATISTIC (StackSpaceSaved, &quot;Number of bytes saved due to merging slots.&quot;)</>}>

Definition at line <a href="#l00095">95</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ae61759438a0bc1b71a92cfd9f6adb3fe}

<MemberDefinition
  prototype={<>STATISTIC (StackSlotMerged, &quot;Number of stack slot merged.&quot;)</>}>

Definition at line <a href="#l00096">96</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a4235c2c9abcdf5628a8227462b200c20}

<MemberDefinition
  prototype={<>STATISTIC (EscapedAllocas, &quot;Number of allocas that escaped the lifetime region&quot;)</>}>

Definition at line <a href="#l00097">97</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### DEBUG&#95;TYPE {#a030569d5a541b6110f2ae1b6a3413a58}

<MemberDefinition
  prototype={<>DEBUG&#95;TYPE</>}>

Definition at line <a href="#l00526">526</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

### DisableColoring {#a53f7abea6827cac44c5cc170ed1b2429}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; DisableColoring(&quot;no-stack-coloring&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Disable stack coloring&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00069">69</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

### false {#a70eb9db92f54bf1d91b4ade3eea56c64}

<MemberDefinition
  prototype="Merge disjoint stack false">

Definition at line <a href="#l00527">527</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

### LifetimeStartOnFirstUse {#aa22542bc186b5f8835f2201b0e660685}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; LifetimeStartOnFirstUse(&quot;stackcoloring-lifetime-start-on-first-use&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Treat stack lifetimes as starting on first use, not on START marker.&quot;))</>}
  labels = {["static"]}>
Enable enhanced dataflow scheme for lifetime analysis (treat first use of stack slot as start of slot lifetime, as opposed to looking for LIFETIME&#95;START marker).

See &quot;Implementation notes&quot; below for more info.

Definition at line <a href="#l00089">89</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

### ProtectFromEscapedAllocas {#a64335ebd86014e6660bc751627663b31}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ProtectFromEscapedAllocas(&quot;protect-from-escaped-allocas&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Do not optimize lifetime zones that &quot; &quot;are broken&quot;))</>}
  labels = {["static"]}>
The user may write code that uses allocas outside of the declared lifetime zone.

This can happen when the user returns a reference to a local data-structure. We can detect these cases and decide not to optimize the code. If this flag is enabled, we try to save the user. This option is treated as overriding LifetimeStartOnFirstUse below.

Definition at line <a href="#l00079">79</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

### slots {#ad95860b0cf8da9d86f5683f19fafbb32}

<MemberDefinition
  prototype="Merge disjoint stack slots">

Definition at line <a href="#l00527">527</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;stack-coloring&quot;</>}>

Definition at line <a href="#l00066">66</a> of file <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp">StackColoring.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- StackColoring.cpp --------------------------------------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This pass implements the stack-coloring optimization that looks for</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// lifetime markers machine instructions (LIFETIME&#95;START and LIFETIME&#95;END),</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">// which represent the possible lifetime of stack slots. It attempts to</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">// merge disjoint stack slots and reduce the used stack space.</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">// NOTE: This pass is not StackSlotColoring, which optimizes spill slots.</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">// TODO: In the future we plan to improve stack coloring in the following ways:</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">// 1 Allow merging multiple small slots into a single larger slot at different</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">//    offsets.</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">// 2 Merge this pass with StackSlotColoring and allow merging of allocas with</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">//    spill slots.</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/stackcoloring-h">llvm/CodeGen/StackColoring.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/bitvector-h">llvm/ADT/BitVector.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/depthfirstiterator-h">llvm/ADT/DepthFirstIterator.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/liveinterval-h">llvm/CodeGen/LiveInterval.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebasicblock-h">llvm/CodeGen/MachineBasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineframeinfo-h">llvm/CodeGen/MachineFrameInfo.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h">llvm/CodeGen/MachineFunction.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunctionpass-h">llvm/CodeGen/MachineFunctionPass.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineinstr-h">llvm/CodeGen/MachineInstr.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinememoperand-h">llvm/CodeGen/MachineMemOperand.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineoperand-h">llvm/CodeGen/MachineOperand.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/passes-h">llvm/CodeGen/Passes.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/pseudosourcevaluemanager-h">llvm/CodeGen/PseudoSourceValueManager.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/slotindexes-h">llvm/CodeGen/SlotIndexes.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetopcodes-h">llvm/CodeGen/TargetOpcodes.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/winehfuncinfo-h">llvm/CodeGen/WinEHFuncInfo.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;llvm/Config/llvm-config.h&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h">llvm/IR/DebugInfoMetadata.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h">llvm/IR/Metadata.h</a>&quot;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/use-h">llvm/IR/Use.h</a>&quot;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/pass-h">llvm/Pass.h</a>&quot;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h">llvm/Support/Compiler.h</a>&quot;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &lt;algorithm&gt;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &lt;limits&gt;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &lt;memory&gt;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;stack-coloring&quot;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69" lineLink="#a53f7abea6827cac44c5cc170ed1b2429"><span class="doxyHighlight"><a href="#a53f7abea6827cac44c5cc170ed1b2429">DisableColoring</a>(</span><span class="doxyHighlightStringLiteral">&quot;no-stack-coloring&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlight">        <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Disable stack coloring&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightComment">/// The user may write code that uses allocas outside of the declared lifetime</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightComment">/// zone. This can happen when the user returns a reference to a local</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightComment">/// data-structure. We can detect these cases and decide not to optimize the</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightComment">/// code. If this flag is enabled, we try to save the user. This option</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightComment">/// is treated as overriding LifetimeStartOnFirstUse below.</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79" lineLink="#a64335ebd86014e6660bc751627663b31"><span class="doxyHighlight"><a href="#a64335ebd86014e6660bc751627663b31">ProtectFromEscapedAllocas</a>(</span><span class="doxyHighlightStringLiteral">&quot;protect-from-escaped-allocas&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlight">                          <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlight">                          <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Do not optimize lifetime zones that &quot;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlight">                                   </span><span class="doxyHighlightStringLiteral">&quot;are broken&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightComment">/// Enable enhanced dataflow scheme for lifetime analysis (treat first</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightComment">/// use of stack slot as start of slot lifetime, as opposed to looking</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlightComment">/// for LIFETIME&#95;START marker). See &quot;Implementation notes&quot; below for</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlightComment">/// more info.</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89" lineLink="#aa22542bc186b5f8835f2201b0e660685"><span class="doxyHighlight"><a href="#aa22542bc186b5f8835f2201b0e660685">LifetimeStartOnFirstUse</a>(</span><span class="doxyHighlightStringLiteral">&quot;stackcoloring-lifetime-start-on-first-use&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">        <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Treat stack lifetimes as starting on first use, not on START marker.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94" lineLink="#aa8b567861ccd4d18eec0502ff6a31601"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumMarkerSeen,  </span><span class="doxyHighlightStringLiteral">&quot;Number of lifetime markers found.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95" lineLink="#a4510e30ea295467b1a8841ed4a5939f5"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(StackSpaceSaved, </span><span class="doxyHighlightStringLiteral">&quot;Number of bytes saved due to merging slots.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96" lineLink="#ae61759438a0bc1b71a92cfd9f6adb3fe"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(StackSlotMerged, </span><span class="doxyHighlightStringLiteral">&quot;Number of stack slot merged.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97" lineLink="#a4235c2c9abcdf5628a8227462b200c20"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(EscapedAllocas, </span><span class="doxyHighlightStringLiteral">&quot;Number of allocas that escaped the lifetime region&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlightComment">//                           StackColoring Pass</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlightComment">// Stack Coloring reduces stack usage by merging stack slots when they</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlightComment">// can&#39;t be used together. For example, consider the following C program:</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlightComment">//     void bar(char &#42;, int);</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlightComment">//     void foo(bool var) &#123;</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlightComment">//         A: &#123;</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlightComment">//             char z&#91;4096&#93;;</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlightComment">//             bar(z, 0);</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlightComment">//         &#125;</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlightComment">//         char &#42;p;</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlightComment">//         char x&#91;4096&#93;;</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlightComment">//         char y&#91;4096&#93;;</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlightComment">//         if (var) &#123;</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlightComment">//             p = x;</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlightComment">//         &#125; else &#123;</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlightComment">//             bar(y, 1);</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlightComment">//             p = y + 1024;</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlightComment">//         &#125;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlightComment">//     B:</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlightComment">//         bar(p, 2);</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlightComment">//     &#125;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlightComment">// Naively-compiled, this program would use 12k of stack space. However, the</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlightComment">// stack slot corresponding to &#96;z&#96; is always destroyed before either of the</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlightComment">// stack slots for &#96;x&#96; or &#96;y&#96; are used, and then &#96;x&#96; is only used if &#96;var&#96;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlightComment">// is true, while &#96;y&#96; is only used if &#96;var&#96; is false. So in no time are 2</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlightComment">// of the stack slots used together, and therefore we can merge them,</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlightComment">// compiling the function using only a single 4k alloca:</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlightComment">//     void foo(bool var) &#123; // equivalent</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlightComment">//         char x&#91;4096&#93;;</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlightComment">//         char &#42;p;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlightComment">//         bar(x, 0);</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlightComment">//         if (var) &#123;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlightComment">//             p = x;</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlightComment">//         &#125; else &#123;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlightComment">//             bar(x, 1);</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlightComment">//             p = x + 1024;</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlightComment">//         &#125;</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlightComment">//         bar(p, 2);</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlightComment">//     &#125;</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlightComment">// This is an important optimization if we want stack space to be under</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlightComment">// control in large functions, both open-coded ones and ones created by</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlightComment">// inlining.</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlightComment">// Implementation Notes:</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlightComment">// ---------------------</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlightComment">// An important part of the above reasoning is that &#96;z&#96; can&#39;t be accessed</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlightComment">// while the latter 2 calls to &#96;bar&#96; are running. This is justified because</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlightComment">// &#96;z&#96;&#39;s lifetime is over after we exit from block &#96;A:&#96;, so any further</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlightComment">// accesses to it would be UB. The way we represent this information</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlightComment">// in LLVM is by having frontends delimit blocks with &#96;lifetime.start&#96;</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlightComment">// and &#96;lifetime.end&#96; intrinsics.</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlightComment">// The effect of these intrinsics seems to be as follows (maybe I should</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlightComment">// specify this in the reference?):</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlightComment">//   L1) at start, each stack-slot is marked as &#42;out-of-scope&#42;, unless no</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlightComment">//   lifetime intrinsic refers to that stack slot, in which case</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlightComment">//   it is marked as &#42;in-scope&#42;.</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlightComment">//   L2) on a &#96;lifetime.start&#96;, a stack slot is marked as &#42;in-scope&#42; and</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlightComment">//   the stack slot is overwritten with &#96;undef&#96;.</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlightComment">//   L3) on a &#96;lifetime.end&#96;, a stack slot is marked as &#42;out-of-scope&#42;.</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlightComment">//   L4) on function exit, all stack slots are marked as &#42;out-of-scope&#42;.</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlightComment">//   L5) &#96;lifetime.end&#96; is a no-op when called on a slot that is already</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlightComment">//   &#42;out-of-scope&#42;.</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlightComment">//   L6) memory accesses to &#42;out-of-scope&#42; stack slots are UB.</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlightComment">//   L7) when a stack-slot is marked as &#42;out-of-scope&#42;, all pointers to it</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlightComment">//   are invalidated, unless the slot is &quot;degenerate&quot;. This is used to</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlightComment">//   justify not marking slots as in-use until the pointer to them is</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlightComment">//   used, but feels a bit hacky in the presence of things like LICM. See</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlightComment">//   the &quot;Degenerate Slots&quot; section for more details.</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlightComment">// Now, let&#39;s ground stack coloring on these rules. We&#39;ll define a slot</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlightComment">// as &#42;in-use&#42; at a (dynamic) point in execution if it either can be</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlightComment">// written to at that point, or if it has a live and non-undef content</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlightComment">// at that point.</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlightComment">// Obviously, slots that are never &#42;in-use&#42; together can be merged, and</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlightComment">// in our example &#96;foo&#96;, the slots for &#96;x&#96;, &#96;y&#96; and &#96;z&#96; are never</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlightComment">// in-use together (of course, sometimes slots that &#42;are&#42; in-use together</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlightComment">// might still be mergable, but we don&#39;t care about that here).</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlightComment">// In this implementation, we successively merge pairs of slots that are</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlightComment">// not &#42;in-use&#42; together. We could be smarter - for example, we could merge</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlightComment">// a single large slot with 2 small slots, or we could construct the</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlightComment">// interference graph and run a &quot;smart&quot; graph coloring algorithm, but with</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlightComment">// that aside, how do we find out whether a pair of slots might be &#42;in-use&#42;</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlightComment">// together?</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlightComment">// From our rules, we see that &#42;out-of-scope&#42; slots are never &#42;in-use&#42;,</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlightComment">// and from (L7) we see that &quot;non-degenerate&quot; slots remain non-&#42;in-use&#42;</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlightComment">// until their address is taken. Therefore, we can approximate slot activity</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlightComment">// using dataflow.</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlightComment">// A subtle point: naively, we might try to figure out which pairs of</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlightComment">// stack-slots interfere by propagating &#96;S in-use&#96; through the CFG for every</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlightComment">// stack-slot &#96;S&#96;, and having &#96;S&#96; and &#96;T&#96; interfere if there is a CFG point in</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlightComment">// which they are both &#42;in-use&#42;.</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlightComment">// That is sound, but overly conservative in some cases: in our (artificial)</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlightComment">// example &#96;foo&#96;, either &#96;x&#96; or &#96;y&#96; might be in use at the label &#96;B:&#96;, but</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlightComment">// as &#96;x&#96; is only in use if we came in from the &#96;var&#96; edge and &#96;y&#96; only</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlightComment">// if we came from the &#96;!var&#96; edge, they still can&#39;t be in use together.</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlightComment">// See PR32488 for an important real-life case.</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlightComment">// If we wanted to find all points of interference precisely, we could</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlightComment">// propagate &#96;S in-use&#96; and &#96;S&amp;T in-use&#96; predicates through the CFG. That</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlightComment">// would be precise, but requires propagating &#96;O(n^2)&#96; dataflow facts.</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlightComment">// However, we aren&#39;t interested in the &#42;set&#42; of points of interference</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlightComment">// between 2 stack slots, only &#42;whether&#42; there &#42;is&#42; such a point. So we</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlightComment">// can rely on a little trick: for &#96;S&#96; and &#96;T&#96; to be in-use together,</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlightComment">// one of them needs to become in-use while the other is in-use (or</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlightComment">// they might both become in use simultaneously). We can check this</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlightComment">// by also keeping track of the points at which a stack slot might &#42;start&#42;</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlightComment">// being in-use.</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlightComment">// Exact first use:</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlightComment">// ----------------</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlightComment">// Consider the following motivating example:</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlightComment">//     int foo() &#123;</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlightComment">//       char b1&#91;1024&#93;, b2&#91;1024&#93;;</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlightComment">//       if (...) &#123;</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlightComment">//         char b3&#91;1024&#93;;</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlightComment">//         &lt;uses of b1, b3&gt;;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlightComment">//         return x;</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlightComment">//       &#125; else &#123;</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlightComment">//         char b4&#91;1024&#93;, b5&#91;1024&#93;;</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlightComment">//         &lt;uses of b2, b4, b5&gt;;</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlightComment">//         return y;</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlightComment">//       &#125;</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlightComment">//     &#125;</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlightComment">// In the code above, &quot;b3&quot; and &quot;b4&quot; are declared in distinct lexical</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlightComment">// scopes, meaning that it is easy to prove that they can share the</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlightComment">// same stack slot. Variables &quot;b1&quot; and &quot;b2&quot; are declared in the same</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlightComment">// scope, meaning that from a lexical point of view, their lifetimes</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlightComment">// overlap. From a control flow pointer of view, however, the two</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlightComment">// variables are accessed in disjoint regions of the CFG, thus it</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlightComment">// should be possible for them to share the same stack slot. An ideal</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlightComment">// stack allocation for the function above would look like:</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlightComment">//     slot 0: b1, b2</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlightComment">//     slot 1: b3, b4</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlightComment">//     slot 2: b5</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlightComment">// Achieving this allocation is tricky, however, due to the way</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlightComment">// lifetime markers are inserted. Here is a simplified view of the</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlightComment">// control flow graph for the code above:</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlightComment">//                +------  block 0 -------+</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlightComment">//               0| LIFETIME&#95;START b1, b2 |</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlightComment">//               1| &lt;test &#39;if&#39; condition&gt; |</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlightComment">//                +-----------------------+</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlightComment">//                   ./              \\.</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlightComment">//   +------  block 1 -------+   +------  block 2 -------+</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlightComment">//  2| LIFETIME&#95;START b3     |  5| LIFETIME&#95;START b4, b5 |</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlightComment">//  3| &lt;uses of b1, b3&gt;      |  6| &lt;uses of b2, b4, b5&gt;  |</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlightComment">//  4| LIFETIME&#95;END b3       |  7| LIFETIME&#95;END b4, b5   |</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlightComment">//   +-----------------------+   +-----------------------+</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlightComment">//                   \\.              /.</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlightComment">//                +------  block 3 -------+</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlightComment">//               8| &lt;cleanupcode&gt;         |</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlightComment">//               9| LIFETIME&#95;END b1, b2   |</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlightComment">//              10| return                |</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlightComment">//                +-----------------------+</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlightComment">// If we create live intervals for the variables above strictly based</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlightComment">// on the lifetime markers, we&#39;ll get the set of intervals on the</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlightComment">// left. If we ignore the lifetime start markers and instead treat a</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlightComment">// variable&#39;s lifetime as beginning with the first reference to the</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlightComment">// var, then we get the intervals on the right.</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlightComment">//            LIFETIME&#95;START      First Use</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlightComment">//     b1:    &#91;0,9&#93;               &#91;3,4&#93; &#91;8,9&#93;</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlightComment">//     b2:    &#91;0,9&#93;               &#91;6,9&#93;</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlightComment">//     b3:    &#91;2,4&#93;               &#91;3,4&#93;</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlightComment">//     b4:    &#91;5,7&#93;               &#91;6,7&#93;</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlightComment">//     b5:    &#91;5,7&#93;               &#91;6,7&#93;</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlightComment">// For the intervals on the left, the best we can do is overlap two</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlightComment">// variables (b3 and b4, for example); this gives us a stack size of</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlightComment">// 4&#42;1024 bytes, not ideal. When treating first-use as the start of a</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlightComment">// lifetime, we can additionally overlap b1 and b5, giving us a 3&#42;1024</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlightComment">// byte stack (better).</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlightComment">// Degenerate Slots:</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlightComment">// -----------------</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlightComment">// Relying entirely on first-use of stack slots is problematic,</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlightComment">// however, due to the fact that optimizations can sometimes migrate</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlightComment">// uses of a variable outside of its lifetime start/end region. Here</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlightComment">// is an example:</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlightComment">//     int bar() &#123;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlightComment">//       char b1&#91;1024&#93;, b2&#91;1024&#93;;</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlightComment">//       if (...) &#123;</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlightComment">//         &lt;uses of b2&gt;</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlightComment">//         return y;</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlightComment">//       &#125; else &#123;</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlightComment">//         &lt;uses of b1&gt;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlightComment">//         while (...) &#123;</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlightComment">//           char b3&#91;1024&#93;;</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlightComment">//           &lt;uses of b3&gt;</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlightComment">//         &#125;</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlightComment">//       &#125;</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlightComment">//     &#125;</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlightComment">// Before optimization, the control flow graph for the code above</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlightComment">// might look like the following:</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlightComment">//                +------  block 0 -------+</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlightComment">//               0| LIFETIME&#95;START b1, b2 |</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlightComment">//               1| &lt;test &#39;if&#39; condition&gt; |</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlightComment">//                +-----------------------+</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlightComment">//                   ./              \\.</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlightComment">//   +------  block 1 -------+    +------- block 2 -------+</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlightComment">//  2| &lt;uses of b2&gt;          |   3| &lt;uses of b1&gt;          |</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlightComment">//   +-----------------------+    +-----------------------+</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlightComment">//              |                            |</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlightComment">//              |                 +------- block 3 -------+ &lt;-\\.</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlightComment">//              |                4| &lt;while condition&gt;     |    |</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlightComment">//              |                 +-----------------------+    |</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlightComment">//              |               /          |                   |</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlightComment">//              |              /  +------- block 4 -------+</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlightComment">//              \\             /  5| LIFETIME&#95;START b3     |    |</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlightComment">//               \\           /   6| &lt;uses of b3&gt;          |    |</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlightComment">//                \\         /    7| LIFETIME&#95;END b3       |    |</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlightComment">//                 \\        |    +------------------------+    |</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlightComment">//                  \\       |                 \\                /</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlightComment">//                +------  block 5 -----+      \\---------------</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlightComment">//               8| &lt;cleanupcode&gt;       |</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlightComment">//               9| LIFETIME&#95;END b1, b2 |</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlightComment">//              10| return              |</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlightComment">//                +---------------------+</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlightComment">// During optimization, however, it can happen that an instruction</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlightComment">// computing an address in &quot;b3&quot; (for example, a loop-invariant GEP) is</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlightComment">// hoisted up out of the loop from block 4 to block 2  &#91;Note that</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlightComment">// this is not an actual load from the stack, only an instruction that</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlightComment">// computes the address to be loaded&#93;. If this happens, there is now a</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlightComment">// path leading from the first use of b3 to the return instruction</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlightComment">// that does not encounter the b3 LIFETIME&#95;END, hence b3&#39;s lifetime is</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlightComment">// now larger than if we were computing live intervals strictly based</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlightComment">// on lifetime markers. In the example above, this lengthened lifetime</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlightComment">// would mean that it would appear illegal to overlap b3 with b2.</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlightComment">// To deal with this such cases, the code in ::collectMarkers() below</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlightComment">// tries to identify &quot;degenerate&quot; slots -- those slots where on a single</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlightComment">// forward pass through the CFG we encounter a first reference to slot</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlightComment">// K before we hit the slot K lifetime start marker. For such slots,</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlightComment">// we fall back on using the lifetime start marker as the beginning of</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlightComment">// the variable&#39;s lifetime.  NB: with this implementation, slots can</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlightComment">// appear degenerate in cases where there is unstructured control flow:</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlightComment">//    if (q) goto mid;</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlightComment">//    if (x &gt; 9) &#123;</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlightComment">//         int b&#91;100&#93;;</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlightComment">//         memcpy(&amp;b&#91;0&#93;, ...);</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlightComment">//    mid: b&#91;k&#93; = ...;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlightComment">//         abc(&amp;b);</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlightComment">//    &#125;</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlightComment">// If in RPO ordering chosen to walk the CFG  we happen to visit the b&#91;k&#93;</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlightComment">// before visiting the memcpy block (which will contain the lifetime start</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlightComment">// for &quot;b&quot; then it will appear that &#39;b&#39; has a degenerate lifetime.</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376" lineLink="/docs/api/namespaces/anonymous-stackcoloring-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlightComment">/// StackColoring - A machine pass for merging disjoint stack allocations,</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlightComment">/// marked by the LIFETIME&#95;START and LIFETIME&#95;END pseudo instructions.</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380" lineLink="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloring"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloring/#af7c4d85591a3578b1b420dbde4c42580">StackColoring</a> &#123;</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &#42;MFI = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &#42;MF = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlightComment">  /// A class representing liveness information for a single basic block.</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlightComment">  /// Each bit in the BitVector represents the liveness property</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlightComment">  /// for a different stack slot.</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight">BlockLifetimeInfo &#123;</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlightComment">    /// Which slots BEGINs in each basic block.</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/bitvector">BitVector</a> Begin;</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlightComment">    /// Which slots ENDs in each basic block.</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/bitvector">BitVector</a> End;</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlightComment">    /// Which slots are marked as LIVE&#95;IN, coming into each basic block.</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/bitvector">BitVector</a> LiveIn;</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlightComment">    /// Which slots are marked as LIVE&#95;OUT, coming out of each basic block.</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/bitvector">BitVector</a> LiveOut;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlightComment">  /// Maps active slots (per bit) for each basic block.</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">LivenessMap = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MachineBasicBlock &#42;, BlockLifetimeInfo&gt;</a>;</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">  LivenessMap BlockLiveness;</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlightComment">  /// Maps serial numbers to basic blocks.</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MachineBasicBlock &#42;, int&gt;</a> BasicBlocks;</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlightComment">  /// Maps basic blocks to a serial number.</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const MachineBasicBlock &#42;, 8&gt;</a> BasicBlockNumbering;</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlightComment">  /// Maps slots to their use interval. Outside of this interval, slots</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlightComment">  /// values are either dead or &#96;undef&#96; and they will not be written to.</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::unique&#95;ptr&lt;LiveInterval&gt;</a>, 16&gt; Intervals;</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlightComment">  /// Maps slots to the points where they can become in-use.</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SmallVector&lt;SlotIndex, 4&gt;</a>, 16&gt; LiveStarts;</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlightComment">  /// VNInfo is used for the construction of LiveIntervals.</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vninfo/#aa750a7f159760b9c378d930deb6a9837">VNInfo::Allocator</a> VNInfoAllocator;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlightComment">  /// SlotIndex analysis object.</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/slotindexes">SlotIndexes</a> &#42;Indexes = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlightComment">  /// The list of lifetime markers found. These markers are to be removed</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlightComment">  /// once the coloring is done.</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineInstr&#42;, 8&gt;</a> Markers;</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlightComment">  /// Record the FI slots for which we have seen some sort of</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlightComment">  /// lifetime marker (either start or end).</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/bitvector">BitVector</a> InterestingSlots;</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlightComment">  /// FI slots that need to be handled conservatively (for these</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlightComment">  /// slots lifetime-start-on-first-use is disabled).</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/bitvector">BitVector</a> ConservativeSlots;</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlightComment">  /// Number of iterations taken during data flow analysis.</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumIterations;</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440" lineLink="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloring/#af7c4d85591a3578b1b420dbde4c42580"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloring/#af7c4d85591a3578b1b420dbde4c42580">StackColoring</a>(<a href="/docs/api/classes/llvm/slotindexes">SlotIndexes</a> &#42;Indexes) : Indexes(Indexes) &#123;&#125;</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> run(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;Func);</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlightComment">  /// Used in collectMarkers</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">BlockBitVecMap = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MachineBasicBlock &#42;, BitVector&gt;</a>;</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlightComment">  /// Debug.</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a03503773241005f01b090b9862aad304">dump</a>() </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> dumpIntervals() </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> dumpBB(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> dumpBV(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> &#42;tag, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/bitvector">BitVector</a> &amp;BV) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlightComment">  /// Removes all of the lifetime marker instructions from the function.</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlightComment">  /// \\returns true if any markers were removed.</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> removeAllMarkers();</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlightComment">  /// Scan the machine function and find all of the lifetime markers.</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlightComment">  /// Record the findings in the BEGIN and END vectors.</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlightComment">  /// \\returns the number of markers found.</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> collectMarkers(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumSlot);</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlightComment">  /// Perform the dataflow calculation and calculate the lifetime for each of</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlightComment">  /// the slots, based on the BEGIN/END vectors. Set the LifetimeLIVE&#95;IN and</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlightComment">  /// LifetimeLIVE&#95;OUT maps that represent which stack slots are live coming</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlightComment">  /// in and out blocks.</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> calculateLocalLiveness();</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlightComment">  /// Returns TRUE if we&#39;re using the first-use-begins-lifetime method for</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlightComment">  /// this slot (if FALSE, then the start marker is treated as start of lifetime).</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> applyFirstUse(</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Slot) &#123;</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#aa22542bc186b5f8835f2201b0e660685">LifetimeStartOnFirstUse</a> || <a href="#a64335ebd86014e6660bc751627663b31">ProtectFromEscapedAllocas</a>)</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ConservativeSlots.<a href="/docs/api/classes/llvm/bitvector/#a15d63c566878e964c19139b2c76c0dab">test</a>(Slot))</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlightComment">  /// Examines the specified instruction and returns TRUE if the instruction</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlightComment">  /// represents the start or end of an interesting lifetime. The slot or slots</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlightComment">  /// starting or ending are added to the vector &quot;slots&quot; and &quot;isStart&quot; is set</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlightComment">  /// accordingly.</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlightComment">  /// \\returns True if inst contains a lifetime start or end</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isLifetimeStartOrEnd(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 4&gt;</a> &amp;<a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>,</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;isStart);</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlightComment">  /// Construct the LiveIntervals for the slots.</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> calculateLiveIntervals(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumSlots);</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlightComment">  /// Go over the machine function and change instructions which use stack</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlightComment">  /// slots to use the joint slots.</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> remapInstructions(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;int, int&gt;</a> &amp;SlotRemap);</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlightComment">  /// The input program may contain instructions which are not inside lifetime</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlightComment">  /// markers. This can happen due to a bug in the compiler or due to a bug in</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlightComment">  /// user code (for example, returning a reference to a local variable).</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlightComment">  /// This procedure checks all of the instructions in the function and</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlightComment">  /// invalidates lifetime ranges which do not contain all of the instructions</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlightComment">  /// which access that frame slot.</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> removeInvalidSlotRanges();</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlightComment">  /// Map entries which point to other entries to their destination.</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlightComment">  ///   A-&gt;B-&gt;C becomes A-&gt;C.</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> expungeSlotMap(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;int, int&gt;</a> &amp;SlotRemap, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumSlots);</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507" lineLink="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a4f74535c0615ecc8267a10e9f0e05241">StackColoringLegacy</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a> &#123;</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509" lineLink="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a936c3cb788f6cdc6f0dc9a88eb73a13e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a936c3cb788f6cdc6f0dc9a88eb73a13e">ID</a>;</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511" lineLink="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a4f74535c0615ecc8267a10e9f0e05241"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a4f74535c0615ecc8267a10e9f0e05241">StackColoringLegacy</a>() : <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a>(<a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a936c3cb788f6cdc6f0dc9a88eb73a13e">ID</a>) &#123;&#125;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> getAnalysisUsage(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU) </span><span class="doxyHighlightKeyword">const override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> runOnMachineFunction(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;Func) </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a936c3cb788f6cdc6f0dc9a88eb73a13e">StackColoringLegacy::ID</a> = 0;</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521" lineLink="/docs/api/namespaces/llvm/#ac0e496ce1c3c373c5737a6d9d2c84237"><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#ac0e496ce1c3c373c5737a6d9d2c84237">llvm::StackColoringLegacyID</a> = <a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a936c3cb788f6cdc6f0dc9a88eb73a13e">StackColoringLegacy::ID</a>;</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523" lineLink="#a4cb1c1ecb52c8f4f676c55e1868ecf99"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(<a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a4f74535c0615ecc8267a10e9f0e05241">StackColoringLegacy</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">                      </span><span class="doxyHighlightStringLiteral">&quot;Merge disjoint stack slots&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/slotindexeswrapperpass">SlotIndexesWrapperPass</a>)</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526" lineLink="#a030569d5a541b6110f2ae1b6a3413a58"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(<a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a4f74535c0615ecc8267a10e9f0e05241">StackColoringLegacy</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527" lineLink="#a70eb9db92f54bf1d91b4ade3eea56c64"><span class="doxyHighlight">                    </span><span class="doxyHighlightStringLiteral">&quot;Merge disjoint stack slots&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/false">false</a>, <a href="/docs/api/namespaces/false">false</a>)</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529" lineLink="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a2af177a11ce6f912ac57015b4eb1614a"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a4f74535c0615ecc8267a10e9f0e05241">StackColoringLegacy</a>::<a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#a2af177a11ce6f912ac57015b4eb1614a">getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">  AU.addRequired&lt;<a href="/docs/api/classes/llvm/slotindexeswrapperpass">SlotIndexesWrapperPass</a>&gt;();</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinefunctionpass/#a864fd57b4304ef933b3281d0ef85a88e">MachineFunctionPass::getAnalysisUsage</a>(AU);</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlightPreprocessor">#if !defined(NDEBUG) || defined(LLVM&#95;ENABLE&#95;DUMP)</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#aa863693eef567397d9c292da5bf22d34">LLVM&#95;DUMP&#95;METHOD</a> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> StackColoring::dumpBV(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> &#42;tag,</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">                                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/bitvector">BitVector</a> &amp;BV)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; tag &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; : &#123; &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = BV.<a href="/docs/api/classes/llvm/bitvector/#abf86e1383aec181a5a2d9967eb8070fd">size</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; BV.<a href="/docs/api/classes/llvm/bitvector/#a15d63c566878e964c19139b2c76c0dab">test</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#125;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#aa863693eef567397d9c292da5bf22d34">LLVM&#95;DUMP&#95;METHOD</a> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> StackColoring::dumpBB(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">  LivenessMap::const&#95;iterator BI = BlockLiveness.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI != BlockLiveness.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Block not found&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> BlockLifetimeInfo &amp;BlockInfo = BI-&gt;second;</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">  dumpBV(</span><span class="doxyHighlightStringLiteral">&quot;BEGIN&quot;</span><span class="doxyHighlight">, BlockInfo.Begin);</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">  dumpBV(</span><span class="doxyHighlightStringLiteral">&quot;END&quot;</span><span class="doxyHighlight">, BlockInfo.End);</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">  dumpBV(</span><span class="doxyHighlightStringLiteral">&quot;LIVE&#95;IN&quot;</span><span class="doxyHighlight">, BlockInfo.LiveIn);</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">  dumpBV(</span><span class="doxyHighlightStringLiteral">&quot;LIVE&#95;OUT&quot;</span><span class="doxyHighlight">, BlockInfo.LiveOut);</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#aa863693eef567397d9c292da5bf22d34">LLVM&#95;DUMP&#95;METHOD</a> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> StackColoring::dump()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : <a href="/docs/api/namespaces/llvm/#ad6e19a09aeed4c56617c284e099c81de">depth&#95;first</a>(MF)) &#123;</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Inspecting block #&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getNumber() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &#91;&quot;</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">           &lt;&lt; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#93;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">    dumpBB(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#aa863693eef567397d9c292da5bf22d34">LLVM&#95;DUMP&#95;METHOD</a> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> StackColoring::dumpIntervals()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = Intervals.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Interval&#91;&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#93;:\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">    Intervals&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;-&gt;dump();</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570" lineLink="#a43f5859dde0766edb4f29aa13b5fb2cb"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">inline</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="#a43f5859dde0766edb4f29aa13b5fb2cb">getStartOrEndSlot</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>)</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == TargetOpcode::LIFETIME&#95;START ||</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == TargetOpcode::LIFETIME&#95;END) &amp;&amp;</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected LIFETIME&#95;START or LIFETIME&#95;END op&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOperand(0);</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Slot = MO.<a href="/docs/api/classes/llvm/machineoperand/#aaa68daaf8d7b773d012887c92c2023ce">getIndex</a>();</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Slot &gt;= 0)</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Slot;</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> -1;</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlightComment">// At the moment the only way to end a variable lifetime is with</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlightComment">// a VARIABLE&#95;LIFETIME op (which can&#39;t contain a start). If things</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlightComment">// change and the IR allows for a single inst that both begins</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlightComment">// and ends lifetime(s), this interface will need to be reworked.</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> StackColoring::isLifetimeStartOrEnd(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>,</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 4&gt;</a> &amp;<a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>,</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">                                         </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &amp;isStart) &#123;</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == TargetOpcode::LIFETIME&#95;START ||</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == TargetOpcode::LIFETIME&#95;END) &#123;</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a> = <a href="#a43f5859dde0766edb4f29aa13b5fb2cb">getStartOrEndSlot</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Slot &lt; 0)</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InterestingSlots.<a href="/docs/api/classes/llvm/bitvector/#a15d63c566878e964c19139b2c76c0dab">test</a>(Slot))</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">    <a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>.push&#95;back(Slot);</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == TargetOpcode::LIFETIME&#95;END) &#123;</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">      isStart = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!applyFirstUse(Slot)) &#123;</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">      isStart = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aa22542bc186b5f8835f2201b0e660685">LifetimeStartOnFirstUse</a> &amp;&amp; !<a href="#a64335ebd86014e6660bc751627663b31">ProtectFromEscapedAllocas</a>) &#123;</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugInstr()) &#123;</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> found = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.operands()) &#123;</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isFI())</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a> = MO.getIndex();</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Slot&lt;0)</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InterestingSlots.<a href="/docs/api/classes/llvm/bitvector/#a15d63c566878e964c19139b2c76c0dab">test</a>(Slot) &amp;&amp; applyFirstUse(Slot)) &#123;</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">          <a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>.push&#95;back(Slot);</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">          found = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (found) &#123;</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">        isStart = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StackColoring::collectMarkers(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumSlot) &#123;</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MarkersFound = 0;</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">  BlockBitVecMap SeenStartMap;</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">  InterestingSlots.<a href="/docs/api/classes/llvm/bitvector/#a35bbc237e4a675c5332103ac6e7dcce1">clear</a>();</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">  InterestingSlots.<a href="/docs/api/classes/llvm/bitvector/#a32859a24aa7a3be269855b989d92a4b4">resize</a>(NumSlot);</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">  ConservativeSlots.<a href="/docs/api/classes/llvm/bitvector/#a35bbc237e4a675c5332103ac6e7dcce1">clear</a>();</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">  ConservativeSlots.<a href="/docs/api/classes/llvm/bitvector/#a32859a24aa7a3be269855b989d92a4b4">resize</a>(NumSlot);</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// number of start and end lifetime ops for each slot</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 8&gt;</a> NumStartLifetimes(NumSlot, 0);</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 8&gt;</a> NumEndLifetimes(NumSlot, 0);</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 1: collect markers and populate the &quot;InterestingSlots&quot;</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and &quot;ConservativeSlots&quot; sets.</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : <a href="/docs/api/namespaces/llvm/#ad6e19a09aeed4c56617c284e099c81de">depth&#95;first</a>(MF)) &#123;</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the set of slots for which we&#39;ve seen a START marker but have</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// not yet seen an END marker at this point in the walk (e.g. on entry</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to this bb).</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/bitvector">BitVector</a> BetweenStartEnd;</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">    BetweenStartEnd.<a href="/docs/api/classes/llvm/bitvector/#a32859a24aa7a3be269855b989d92a4b4">resize</a>(NumSlot);</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;predecessors()) &#123;</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">      BlockBitVecMap::const&#95;iterator <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = SeenStartMap.find(Pred);</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != SeenStartMap.end()) &#123;</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">        BetweenStartEnd |= <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Walk the instructions in the block to look for start/end ops.</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isDebugInstr())</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == TargetOpcode::LIFETIME&#95;START ||</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == TargetOpcode::LIFETIME&#95;END) &#123;</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a> = <a href="#a43f5859dde0766edb4f29aa13b5fb2cb">getStartOrEndSlot</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Slot &lt; 0)</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">        InterestingSlots.<a href="/docs/api/classes/llvm/bitvector/#a62237ebe27691377a942abe7446332ec">set</a>(Slot);</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == TargetOpcode::LIFETIME&#95;START) &#123;</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">          BetweenStartEnd.<a href="/docs/api/classes/llvm/bitvector/#a62237ebe27691377a942abe7446332ec">set</a>(Slot);</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">          NumStartLifetimes&#91;<a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a>&#93; += 1;</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">          BetweenStartEnd.<a href="/docs/api/classes/llvm/bitvector/#a168122d6ac4ed2a8b722e01b592ad289">reset</a>(Slot);</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">          NumEndLifetimes&#91;<a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a>&#93; += 1;</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Allocation = MFI-&gt;<a href="/docs/api/classes/llvm/machineframeinfo/#a171600b1de399e1d60976508ffb38ea3">getObjectAllocation</a>(Slot);</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Allocation) &#123;</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Found a lifetime &quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.getOpcode() == TargetOpcode::LIFETIME&#95;START</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">                                    ? </span><span class="doxyHighlightStringLiteral">&quot;start&quot;</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">                                    : </span><span class="doxyHighlightStringLiteral">&quot;end&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; marker for slot #&quot;</span><span class="doxyHighlight"> &lt;&lt; Slot);</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">                     &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with allocation: &quot;</span><span class="doxyHighlight"> &lt;&lt; Allocation-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600emitclausemarkers-cpp/#a3e626da28e8adca2cea957462d9fe860">Markers</a>.push&#95;back(&amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">        MarkersFound += 1;</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.operands()) &#123;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isFI())</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a> = MO.getIndex();</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Slot &lt; 0)</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (! BetweenStartEnd.<a href="/docs/api/classes/llvm/bitvector/#a15d63c566878e964c19139b2c76c0dab">test</a>(Slot)) &#123;</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">            ConservativeSlots.<a href="/docs/api/classes/llvm/bitvector/#a62237ebe27691377a942abe7446332ec">set</a>(Slot);</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/bitvector">BitVector</a> &amp;SeenStart = SeenStartMap&#91;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93;;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">    SeenStart |= BetweenStartEnd;</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MarkersFound) &#123;</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PR27903: slots with multiple start or end lifetime ops are not</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// safe to enable for &quot;lifetime-start-on-first-use&quot;.</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> slot = 0; slot &lt; NumSlot; ++slot) &#123;</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumStartLifetimes&#91;slot&#93; &gt; 1 || NumEndLifetimes&#91;slot&#93; &gt; 1)</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">      ConservativeSlots.<a href="/docs/api/classes/llvm/bitvector/#a62237ebe27691377a942abe7446332ec">set</a>(slot);</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The write to the catch object by the personality function is not propely</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// modeled in IR: It happens before any cleanuppads are executed, even if the</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// first mention of the catch object is in a catchpad. As such, mark catch</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// object slots as conservative, so they are excluded from first-use analysis.</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/winehfuncinfo">WinEHFuncInfo</a> &#42;EHInfo = MF-&gt;<a href="/docs/api/classes/llvm/machinefunction/#a11cf771f7f11ea4fdacdbd5420371172">getWinEHFuncInfo</a>())</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/winehtryblockmapentry">WinEHTryBlockMapEntry</a> &amp;TBME : EHInfo-&gt;TryBlockMap)</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/winehhandlertype">WinEHHandlerType</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ae42219072d798876e6b08e6b78614ff6">H</a> : TBME.<a href="/docs/api/structs/llvm/winehtryblockmapentry/#a203f60eaca27055d5b7395fca270037e">HandlerArray</a>)</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ae42219072d798876e6b08e6b78614ff6">H</a>.CatchObj.FrameIndex != std::numeric&#95;limits&lt;int&gt;::max() &amp;&amp;</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ae42219072d798876e6b08e6b78614ff6">H</a>.CatchObj.FrameIndex &gt;= 0)</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">          ConservativeSlots.<a href="/docs/api/classes/llvm/bitvector/#a62237ebe27691377a942abe7446332ec">set</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ae42219072d798876e6b08e6b78614ff6">H</a>.CatchObj.FrameIndex);</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(dumpBV(</span><span class="doxyHighlightStringLiteral">&quot;Conservative slots&quot;</span><span class="doxyHighlight">, ConservativeSlots));</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Step 2: compute begin/end sets for each block</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NOTE: We use a depth-first iteration to ensure that we obtain a</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// deterministic numbering.</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : <a href="/docs/api/namespaces/llvm/#ad6e19a09aeed4c56617c284e099c81de">depth&#95;first</a>(MF)) &#123;</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Assign a serial number to this basic block.</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">    BasicBlocks&#91;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93; = BasicBlockNumbering.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">    BasicBlockNumbering.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Keep a reference to avoid repeated lookups.</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">    BlockLifetimeInfo &amp;BlockInfo = BlockLiveness&#91;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93;;</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">    BlockInfo.Begin.resize(NumSlot);</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">    BlockInfo.End.resize(NumSlot);</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 4&gt;</a> <a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>;</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isStart = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">      <a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>.clear();</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isLifetimeStartOrEnd(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>, isStart)) &#123;</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isStart) &#123;</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>.size() == 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;unexpected: MI ends multiple slots&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a> = <a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>&#91;0&#93;;</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BlockInfo.Begin.test(Slot)) &#123;</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">            BlockInfo.Begin.reset(Slot);</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">          BlockInfo.End.set(Slot);</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Slot : <a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>) &#123;</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Found a use of slot #&quot;</span><span class="doxyHighlight"> &lt;&lt; Slot);</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">                       &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; at &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; index &quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(Indexes-&gt;<a href="/docs/api/classes/llvm/slotindexes/#aa429e211fd041cb42d26e49dd5d95d75">getInstructionIndex</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>).<a href="/docs/api/classes/llvm/slotindex/#ac2683f7e08d14ae4a3509d8c55d83bb6">print</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Allocation = MFI-&gt;<a href="/docs/api/classes/llvm/machineframeinfo/#a171600b1de399e1d60976508ffb38ea3">getObjectAllocation</a>(Slot);</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Allocation) &#123;</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">              <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">                         &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with allocation: &quot;</span><span class="doxyHighlight"> &lt;&lt; Allocation-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>());</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BlockInfo.End.test(Slot)) &#123;</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">              BlockInfo.End.reset(Slot);</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">            BlockInfo.Begin.set(Slot);</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update statistics.</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">  NumMarkerSeen += MarkersFound;</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MarkersFound;</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> StackColoring::calculateLocalLiveness() &#123;</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumIters = 0;</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create BitVector outside the loop and reuse them to avoid repeated heap</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allocations.</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/bitvector">BitVector</a> LocalLiveIn;</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/bitvector">BitVector</a> LocalLiveOut;</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (changed) &#123;</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">    changed = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">    ++NumIters;</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB : BasicBlockNumbering) &#123;</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Use an iterator to avoid repeated lookups.</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">      LivenessMap::iterator BI = BlockLiveness.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(BB);</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI != BlockLiveness.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Block not found&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">      BlockLifetimeInfo &amp;BlockInfo = BI-&gt;second;</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Compute LiveIn by unioning together the LiveOut sets of all preds.</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">      LocalLiveIn.<a href="/docs/api/classes/llvm/bitvector/#a35bbc237e4a675c5332103ac6e7dcce1">clear</a>();</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">        LivenessMap::const&#95;iterator <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BlockLiveness.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Pred);</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// PR37130: transformations prior to stack coloring can</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// sometimes leave behind statically unreachable blocks; these</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// can be safely skipped here.</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != BlockLiveness.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">          LocalLiveIn |= <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second.LiveOut;</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Compute LiveOut by subtracting out lifetimes that end in this</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// block, then adding in lifetimes that begin in this block.  If</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we have both BEGIN and END markers in the same basic block</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// then we know that the BEGIN marker comes after the END,</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// because we already handle the case where the BEGIN comes</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// before the END when collecting the markers (and building the</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// BEGIN/END vectors).</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">      LocalLiveOut = LocalLiveIn;</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">      LocalLiveOut.<a href="/docs/api/classes/llvm/bitvector/#a168122d6ac4ed2a8b722e01b592ad289">reset</a>(BlockInfo.End);</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">      LocalLiveOut |= BlockInfo.Begin;</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Update block LiveIn set, noting whether it has changed.</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LocalLiveIn.<a href="/docs/api/classes/llvm/bitvector/#a15d63c566878e964c19139b2c76c0dab">test</a>(BlockInfo.LiveIn)) &#123;</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">        changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">        BlockInfo.LiveIn |= LocalLiveIn;</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Update block LiveOut set, noting whether it has changed.</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LocalLiveOut.<a href="/docs/api/classes/llvm/bitvector/#a15d63c566878e964c19139b2c76c0dab">test</a>(BlockInfo.LiveOut)) &#123;</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">        changed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">        BlockInfo.LiveOut |= LocalLiveOut;</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightComment">// while changed.</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">  NumIterations = NumIters;</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> StackColoring::calculateLiveIntervals(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumSlots) &#123;</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SlotIndex, 16&gt;</a> Starts;</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;bool, 16&gt;</a> DefinitelyInUse;</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For each block, find which slots are active within this block</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and update the live intervals.</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;MF) &#123;</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">    Starts.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">    Starts.<a href="/docs/api/classes/llvm/smallvectorimpl/#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(NumSlots);</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">    DefinitelyInUse.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">    DefinitelyInUse.<a href="/docs/api/classes/llvm/smallvectorimpl/#ad0b3d8447f88377b62d9c019f3c4e118">resize</a>(NumSlots);</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Start the interval of the slots that we previously found to be &#39;in-use&#39;.</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">    BlockLifetimeInfo &amp;MBBLiveness = BlockLiveness&#91;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93;;</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> pos = MBBLiveness.LiveIn.find&#95;first(); pos != -1;</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">         pos = MBBLiveness.LiveIn.find&#95;next(pos)) &#123;</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">      Starts&#91;pos&#93; = Indexes-&gt;<a href="/docs/api/classes/llvm/slotindexes/#aaf0c07cc1cdb9c78c6dfdfdd5913420a">getMBBStartIdx</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create the interval for the basic blocks containing lifetime begin/end.</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 4&gt;</a> <a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>;</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsStart = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isLifetimeStartOrEnd(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>, <a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>, IsStart))</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/slotindex">SlotIndex</a> ThisIndex = Indexes-&gt;<a href="/docs/api/classes/llvm/slotindexes/#aa429e211fd041cb42d26e49dd5d95d75">getInstructionIndex</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>);</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Slot : <a href="#ad95860b0cf8da9d86f5683f19fafbb32">slots</a>) &#123;</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsStart) &#123;</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// If a slot is already definitely in use, we don&#39;t have to emit</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// a new start marker because there is already a pre-existing</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// one.</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!DefinitelyInUse&#91;Slot&#93;) &#123;</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">            LiveStarts&#91;<a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a>&#93;.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ThisIndex);</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">            DefinitelyInUse&#91;<a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a>&#93; = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Starts&#91;Slot&#93;.<a href="/docs/api/files/lib/lib/demangle/rustdemangle-cpp/#a103d8cfe62c1651cd70e181746f8a840">isValid</a>())</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">            Starts&#91;<a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a>&#93; = ThisIndex;</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Starts&#91;Slot&#93;.<a href="/docs/api/files/lib/lib/demangle/rustdemangle-cpp/#a103d8cfe62c1651cd70e181746f8a840">isValid</a>()) &#123;</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/vninfo">VNInfo</a> &#42;VNI = Intervals&#91;<a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a>&#93;-&gt;getValNumInfo(0);</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">            Intervals&#91;<a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a>&#93;-&gt;addSegment(</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">                <a href="/docs/api/structs/llvm/liverange/segment">LiveInterval::Segment</a>(Starts&#91;Slot&#93;, ThisIndex, VNI));</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">            Starts&#91;<a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a>&#93; = <a href="/docs/api/classes/llvm/slotindex">SlotIndex</a>(); </span><span class="doxyHighlightComment">// Invalidate the start index</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">            DefinitelyInUse&#91;<a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a>&#93; = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Finish up started segments</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i &lt; NumSlots; ++i) &#123;</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Starts&#91;i&#93;.<a href="/docs/api/files/lib/lib/demangle/rustdemangle-cpp/#a103d8cfe62c1651cd70e181746f8a840">isValid</a>())</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/slotindex">SlotIndex</a> EndIdx = Indexes-&gt;<a href="/docs/api/classes/llvm/slotindexes/#a662867d9274595cdac0092afa45888be">getMBBEndIdx</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vninfo">VNInfo</a> &#42;VNI = Intervals&#91;i&#93;-&gt;getValNumInfo(0);</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">      Intervals&#91;i&#93;-&gt;addSegment(<a href="/docs/api/structs/llvm/liverange/segment">LiveInterval::Segment</a>(Starts&#91;i&#93;, EndIdx, VNI));</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> StackColoring::removeAllMarkers() &#123;</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = 0;</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600emitclausemarkers-cpp/#a3e626da28e8adca2cea957462d9fe860">Markers</a>) &#123;</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>++;</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/r600emitclausemarkers-cpp/#a3e626da28e8adca2cea957462d9fe860">Markers</a>.clear();</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Removed &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; markers.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>;</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> StackColoring::remapInstructions(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;int, int&gt;</a> &amp;SlotRemap) &#123;</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> FixedInstr = 0;</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> FixedMemOp = 0;</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> FixedDbg = 0;</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remap debug information that refers to stack slots.</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;VI : MF-&gt;getVariableDbgInfo()) &#123;</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VI.Var || !VI.inStackSlot())</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a> = VI.getStackSlot();</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SlotRemap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(Slot)) &#123;</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Remapping debug info for &#91;&quot;</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">                        &lt;&lt; <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;DILocalVariable&gt;</a>(VI.Var)-&gt;getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#93;.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">      VI.updateStackSlot(SlotRemap&#91;Slot&#93;);</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">      FixedDbg++;</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep a list of &#42;allocas&#42; which need to be remapped.</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const AllocaInst&#42;, const AllocaInst&#42;&gt;</a> Allocas;</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep a list of allocas which has been affected by the remap.</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const AllocaInst&#42;, 32&gt;</a> MergedAllocas;</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::pair&lt;int, int&gt; &amp;<a href="/docs/api/namespaces/llvm/si">SI</a> : SlotRemap) &#123;</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;From = MFI-&gt;<a href="/docs/api/classes/llvm/machineframeinfo/#a171600b1de399e1d60976508ffb38ea3">getObjectAllocation</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.first);</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;To = MFI-&gt;<a href="/docs/api/classes/llvm/machineframeinfo/#a171600b1de399e1d60976508ffb38ea3">getObjectAllocation</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.second);</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(To &amp;&amp; From &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Invalid allocation object&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">    Allocas&#91;From&#93; = To;</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If From is before wo, its possible that there is a use of From between</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// them.</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (From-&gt;<a href="/docs/api/classes/llvm/instruction/#a784097fca76abad9e815cf1692de79c4">comesBefore</a>(To))</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(To)-&gt;moveBefore(</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">const&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(From)-&gt;getIterator());</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// AA might be used later for instruction scheduling, and we need it to be</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// able to deduce the correct aliasing releationships between pointers</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// derived from the alloca being remapped and the target of that remapping.</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The only safe way, without directly informing AA about the remapping</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// somehow, is to directly update the IR to reflect the change being made</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// here.</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = </span><span class="doxyHighlightKeyword">const&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(To);</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (From-&gt;<a href="/docs/api/classes/llvm/allocainst/#a5d19f3955a23e8eb2a974efcc8fb19da">getType</a>() != To-&gt;<a href="/docs/api/classes/llvm/allocainst/#a5d19f3955a23e8eb2a974efcc8fb19da">getType</a>()) &#123;</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;Cast = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a>(Inst, From-&gt;<a href="/docs/api/classes/llvm/allocainst/#a5d19f3955a23e8eb2a974efcc8fb19da">getType</a>());</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">      Cast-&gt;<a href="/docs/api/classes/llvm/instruction/#af09e4096de244d2fb345891328714a63">insertAfter</a>(Inst-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">      Inst = Cast;</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We keep both slots to maintain AliasAnalysis metadata later.</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">    MergedAllocas.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(From);</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">    MergedAllocas.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(To);</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Transfer the stack protector layout tag, but make sure that SSPLK&#95;AddrOf</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// does not overwrite SSPLK&#95;SmallArray or SSPLK&#95;LargeArray, and make sure</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that SSPLK&#95;SmallArray does not overwrite SSPLK&#95;LargeArray.</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineframeinfo/#a3df888d2d0447ad8ff7b616b080d9f13">MachineFrameInfo::SSPLayoutKind</a> FromKind</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">        = MFI-&gt;<a href="/docs/api/classes/llvm/machineframeinfo/#a0e63dce45e27f16d0fe42d473c9598c8">getObjectSSPLayout</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.first);</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineframeinfo/#a3df888d2d0447ad8ff7b616b080d9f13">MachineFrameInfo::SSPLayoutKind</a> ToKind = MFI-&gt;<a href="/docs/api/classes/llvm/machineframeinfo/#a0e63dce45e27f16d0fe42d473c9598c8">getObjectSSPLayout</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.second);</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FromKind != <a href="/docs/api/classes/llvm/machineframeinfo/#a3df888d2d0447ad8ff7b616b080d9f13ae58c4225f24cd64ac3846a49952e48e1">MachineFrameInfo::SSPLK&#95;None</a> &amp;&amp;</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">        (ToKind == <a href="/docs/api/classes/llvm/machineframeinfo/#a3df888d2d0447ad8ff7b616b080d9f13ae58c4225f24cd64ac3846a49952e48e1">MachineFrameInfo::SSPLK&#95;None</a> ||</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">         (ToKind != <a href="/docs/api/classes/llvm/machineframeinfo/#a3df888d2d0447ad8ff7b616b080d9f13a76435b76764cc940002d104e49c49c26">MachineFrameInfo::SSPLK&#95;LargeArray</a> &amp;&amp;</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">          FromKind != <a href="/docs/api/classes/llvm/machineframeinfo/#a3df888d2d0447ad8ff7b616b080d9f13adec9480be1bffa4bb7a4ff2352b371f0">MachineFrameInfo::SSPLK&#95;AddrOf</a>)))</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">      MFI-&gt;<a href="/docs/api/classes/llvm/machineframeinfo/#a5938f9d0441c7b989d3e08e4dbd81ddf">setObjectSSPLayout</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.second, FromKind);</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The new alloca might not be valid in a llvm.dbg.declare for this</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// variable, so poison out the use to make the verifier happy.</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;FromAI = </span><span class="doxyHighlightKeyword">const&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(From);</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FromAI-&gt;<a href="/docs/api/classes/llvm/value/#a6cfd8c0f6033a51197c2ef2b00beeca6">isUsedByMetadata</a>())</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/valueasmetadata/#a7f7861a70cfa57999c2b47e570be2127">ValueAsMetadata::handleRAUW</a>(FromAI, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(FromAI-&gt;<a href="/docs/api/classes/llvm/allocainst/#a5d19f3955a23e8eb2a974efcc8fb19da">getType</a>()));</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/classes/llvm/use">Use</a> : FromAI-&gt;<a href="/docs/api/classes/llvm/value/#abf855b7cd63a0cd7f73759e396f280c9">uses</a>()) &#123;</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;BCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(<a href="/docs/api/classes/llvm/use">Use</a>.<a href="/docs/api/classes/llvm/use/#ad77c21b5dd2c8765f87e3fb054d68def">get</a>()))</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BCI-&gt;isUsedByMetadata())</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/valueasmetadata/#a7f7861a70cfa57999c2b47e570be2127">ValueAsMetadata::handleRAUW</a>(BCI, <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(BCI-&gt;getType()));</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that this will not replace uses in MMOs (which we&#39;ll update below),</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// or anywhere else (which is why we won&#39;t delete the original</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instruction).</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">    FromAI-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(Inst);</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remap all instructions to the new stack slots.</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">  std::vector&lt;std::vector&lt;MachineMemOperand &#42;&gt;&gt; SSRefs(</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">      MFI-&gt;<a href="/docs/api/classes/llvm/machineframeinfo/#ac51e2d34abb79b72afef355fac525c76">getObjectIndexEnd</a>());</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;BB : &#42;MF)</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB) &#123;</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip lifetime markers. We&#39;ll remove them soon.</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode() == TargetOpcode::LIFETIME&#95;START ||</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode() == TargetOpcode::LIFETIME&#95;END)</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Update the MachineMemOperand to use the new alloca.</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a> &#42;MMO : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.memoperands()) &#123;</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We&#39;ve replaced IR-level uses of the remapped allocas, so we only</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// need to replace direct uses here.</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;AllocaInst&gt;</a>(MMO-&gt;getValue());</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AI)</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Allocas.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(AI))</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">        MMO-&gt;setValue(Allocas&#91;AI&#93;);</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">        FixedMemOp++;</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Update all of the machine instruction operands.</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) &#123;</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isFI())</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FromSlot = MO.getIndex();</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Don&#39;t touch arguments.</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FromSlot&lt;0)</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Only look at mapped slots.</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SlotRemap.count(FromSlot))</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// In a debug build, check that the instruction that we are modifying is</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// inside the expected live range. If the instruction is not inside</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the calculated range then it means that the alloca usage moved</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// outside of the lifetime markers, or that the user has a bug.</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// NOTE: Alloca address calculations which happen outside the lifetime</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// zone are okay, despite the fact that we don&#39;t have a good way</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// for validating all of the usages of the calculation.</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TouchesMemory = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayLoadOrStore();</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If we &#42;don&#39;t&#42; protect the user from escaped allocas, don&#39;t bother</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// validating the instructions.</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isDebugInstr() &amp;&amp; TouchesMemory &amp;&amp; <a href="#a64335ebd86014e6660bc751627663b31">ProtectFromEscapedAllocas</a>) &#123;</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/slotindex">SlotIndex</a> Index = Indexes-&gt;<a href="/docs/api/classes/llvm/slotindexes/#aa429e211fd041cb42d26e49dd5d95d75">getInstructionIndex</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/liveinterval">LiveInterval</a> &#42;<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a> = &amp;&#42;Intervals&#91;FromSlot&#93;;</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a>-&gt;find(Index) != <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a>-&gt;end() &amp;&amp;</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;Found instruction usage outside of live range.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Fix the machine instructions.</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> ToSlot = SlotRemap&#91;FromSlot&#93;;</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">        MO.setIndex(ToSlot);</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">        FixedInstr++;</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We adjust AliasAnalysis information for merged stack slots.</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineMemOperand &#42;, 2&gt;</a> NewMMOs;</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ReplaceMemOps = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a> &#42;MMO : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.memoperands()) &#123;</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Collect MachineMemOperands which reference</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// FixedStackPseudoSourceValues with old frame indices.</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FSV = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;FixedStackPseudoSourceValue&gt;</a>(</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">                MMO-&gt;getPseudoValue())) &#123;</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI = FSV-&gt;getFrameIndex();</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> To = SlotRemap.find(FI);</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (To != SlotRemap.end())</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">            SSRefs&#91;FI&#93;.push&#95;back(MMO);</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If this memory location can be a slot remapped here,</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// we remove AA information.</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MayHaveConflictingAAMD = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MMO-&gt;getAAInfo()) &#123;</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;MMOV = MMO-&gt;getValue()) &#123;</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> Objs;</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a317172388c9d0d3c601070d588a104d2">getUnderlyingObjectsForCodeGen</a>(MMOV, Objs);</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Objs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">              MayHaveConflictingAAMD = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : Objs) &#123;</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// If this memory location comes from a known stack slot</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// that is not remapped, we continue checking.</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">                </span><span class="doxyHighlightComment">// Otherwise, we need to invalidate AA infomation.</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;AllocaInst&gt;</a>(V);</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">                </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AI &amp;&amp; MergedAllocas.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(AI)) &#123;</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">                  MayHaveConflictingAAMD = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">                &#125;</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">              &#125;</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MayHaveConflictingAAMD) &#123;</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">          NewMMOs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MF-&gt;getMachineMemOperand(MMO, <a href="/docs/api/structs/llvm/aamdnodes">AAMDNodes</a>()));</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">          ReplaceMemOps = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">          NewMMOs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MMO);</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If any memory operand is updated, set memory references of</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// this instruction.</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReplaceMemOps)</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setMemRefs(&#42;MF, NewMMOs);</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Rewrite MachineMemOperands that reference old frame indices.</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(SSRefs))</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.value().empty()) &#123;</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/pseudosourcevalue">PseudoSourceValue</a> &#42;NewSV =</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">          MF-&gt;getPSVManager().getFixedStack(SlotRemap.find(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.index())-&gt;second);</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a> &#42;<a href="/docs/api/namespaces/llvm/#a9db8c44b250b90e3ab7e4d144e7c9c2ea60baadb22e80b147e4885ad16760e569">Ref</a> : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>.value())</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a9db8c44b250b90e3ab7e4d144e7c9c2ea60baadb22e80b147e4885ad16760e569">Ref</a>-&gt;setValue(NewSV);</span></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the location of C++ catch objects for the MSVC personality routine.</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/winehfuncinfo">WinEHFuncInfo</a> &#42;EHInfo = MF-&gt;getWinEHFuncInfo())</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/winehtryblockmapentry">WinEHTryBlockMapEntry</a> &amp;TBME : EHInfo-&gt;TryBlockMap)</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/winehhandlertype">WinEHHandlerType</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ae42219072d798876e6b08e6b78614ff6">H</a> : TBME.<a href="/docs/api/structs/llvm/winehtryblockmapentry/#a203f60eaca27055d5b7395fca270037e">HandlerArray</a>)</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ae42219072d798876e6b08e6b78614ff6">H</a>.CatchObj.FrameIndex != std::numeric&#95;limits&lt;int&gt;::max() &amp;&amp;</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">            SlotRemap.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ae42219072d798876e6b08e6b78614ff6">H</a>.CatchObj.FrameIndex))</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ae42219072d798876e6b08e6b78614ff6">H</a>.CatchObj.FrameIndex = SlotRemap&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ae42219072d798876e6b08e6b78614ff6">H</a>.CatchObj.FrameIndex&#93;;</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fixed &quot;</span><span class="doxyHighlight"> &lt;&lt; FixedMemOp &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; machine memory operands.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fixed &quot;</span><span class="doxyHighlight"> &lt;&lt; FixedDbg &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; debug locations.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Fixed &quot;</span><span class="doxyHighlight"> &lt;&lt; FixedInstr &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; machine instructions.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">  (void) FixedMemOp;</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">  (void) FixedDbg;</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">  (void) FixedInstr;</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> StackColoring::removeInvalidSlotRanges() &#123;</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;BB : &#42;MF)</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB) &#123;</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode() == TargetOpcode::LIFETIME&#95;START ||</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getOpcode() == TargetOpcode::LIFETIME&#95;END || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isDebugInstr())</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Some intervals are suspicious! In some cases we find address</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// calculations outside of the lifetime zone, but not actual memory</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// read or write. Memory accesses outside of the lifetime zone are a clear</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// violation, but address calculations are okay. This can happen when</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// GEPs are hoisted outside of the lifetime zone.</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// So, in here we only check instructions which can read or write memory.</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayLoad() &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.mayStore())</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check all of the machine operands.</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machineoperand">MachineOperand</a> &amp;MO : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) &#123;</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MO.isFI())</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a> = MO.getIndex();</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Slot&lt;0)</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Intervals&#91;Slot&#93;-&gt;<a href="/docs/api/namespaces/llvm/sandboxir/#a0e9cf49b789ff0825ffea99d23afd013">empty</a>())</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Check that the used slot is inside the calculated lifetime range.</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If it is not, warn about it and invalidate the range.</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/liveinterval">LiveInterval</a> &#42;<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a> = &amp;&#42;Intervals&#91;<a href="/docs/api/namespaces/llvm/pdb/#a5dbb1abfb6d3c14555304f9c56703234a9234cc57c43f272b55a94b0069fe62d1">Slot</a>&#93;;</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/slotindex">SlotIndex</a> Index = Indexes-&gt;<a href="/docs/api/classes/llvm/slotindexes/#aa429e211fd041cb42d26e49dd5d95d75">getInstructionIndex</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a>-&gt;find(Index) == <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a>-&gt;end()) &#123;</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a>-&gt;clear();</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Invalidating range #&quot;</span><span class="doxyHighlight"> &lt;&lt; Slot &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">          EscapedAllocas++;</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> StackColoring::expungeSlotMap(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;int, int&gt;</a> &amp;SlotRemap,</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">                                   </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumSlots) &#123;</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Expunge slot remap map.</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i=0; i &lt; NumSlots; ++i) &#123;</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we are remapping i</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SlotRemap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(i)) &#123;</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/target">Target</a> = SlotRemap&#91;i&#93;;</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// As long as our target is mapped to something else, follow it.</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (SlotRemap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(<a href="/docs/api/classes/llvm/target">Target</a>)) &#123;</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/target">Target</a> = SlotRemap&#91;<a href="/docs/api/classes/llvm/target">Target</a>&#93;;</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">        SlotRemap&#91;i&#93; = <a href="/docs/api/classes/llvm/target">Target</a>;</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187" lineLink="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#aebba3fc564ac51598f1af02c540bc1ed"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloringlegacy/#aebba3fc564ac51598f1af02c540bc1ed">StackColoringLegacy::runOnMachineFunction</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/functionpass/#af9f5f511d75e16f09a5520cb9444cfa8">skipFunction</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>()))</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloring">StackColoring</a> SC(&amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;SlotIndexesWrapperPass&gt;</a>().getSI());</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SC.run(MF);</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195" lineLink="/docs/api/classes/llvm/stackcoloringpass/#a693535db98527be92419386a4baba10a"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/stackcoloringpass/#a693535db98527be92419386a4baba10a">StackColoringPass::run</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">                                         <a href="/docs/api/namespaces/llvm/#a064825a8817522ca733ac413a7122d36">MachineFunctionAnalysisManager</a> &amp;MFAM) &#123;</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">  StackColoring SC(&amp;MFAM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/slotindexesanalysis">SlotIndexesAnalysis</a>&gt;(MF));</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SC.run(MF))</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a03797a73044a81cbc6a3409d6c72ee8f">PreservedAnalyses::none</a>();</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203" lineLink="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloring/#a97d6b0d6fae6fc47e5e354e6c3382938"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-stackcoloring-cpp-/stackcoloring/#a97d6b0d6fae6fc47e5e354e6c3382938">StackColoring::run</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;Func) &#123;</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42; Stack Coloring &#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;\\n&quot;</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42;&#42; Function: &quot;</span><span class="doxyHighlight"> &lt;&lt; Func.getName() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">  MF = &amp;Func;</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">  MFI = &amp;MF-&gt;getFrameInfo();</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">  BlockLiveness.clear();</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">  BasicBlocks.clear();</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">  BasicBlockNumbering.clear();</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">  Markers.clear();</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">  Intervals.clear();</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">  LiveStarts.clear();</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">  VNInfoAllocator.Reset();</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumSlots = MFI-&gt;getObjectIndexEnd();</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are no stack slots then there are no markers to remove.</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NumSlots)</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int, 8&gt;</a> SortedSlots;</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">  SortedSlots.<a href="/docs/api/classes/llvm/smallvectorimpl/#a499ea32ca1b8d16cedfe01d1e5b08f29">reserve</a>(NumSlots);</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">  Intervals.reserve(NumSlots);</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">  LiveStarts.resize(NumSlots);</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumMarkers = collectMarkers(NumSlots);</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TotalSize = 0;</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Found &quot;</span><span class="doxyHighlight"> &lt;&lt; NumMarkers &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; markers and &quot;</span><span class="doxyHighlight"> &lt;&lt; NumSlots</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; slots\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Slot structure:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> i=0; i &lt; MFI-&gt;getObjectIndexEnd(); ++i) &#123;</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Slot #&quot;</span><span class="doxyHighlight"> &lt;&lt; i &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; - &quot;</span><span class="doxyHighlight"> &lt;&lt; MFI-&gt;getObjectSize(i)</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; bytes.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">    TotalSize += MFI-&gt;getObjectSize(i);</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Total Stack size: &quot;</span><span class="doxyHighlight"> &lt;&lt; TotalSize &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; bytes\\n\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t continue because there are not enough lifetime markers, or the</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stack is too small, or we are told not to optimize the slots.</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumMarkers &lt; 2 || TotalSize &lt; 16 || <a href="#a53f7abea6827cac44c5cc170ed1b2429">DisableColoring</a>) &#123;</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Will not try to merge slots.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> removeAllMarkers();</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i=0; i &lt; NumSlots; ++i) &#123;</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">    std::unique&#95;ptr&lt;LiveInterval&gt; LI(</span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/liveinterval">LiveInterval</a>(i, 0));</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">    LI-&gt;getNextValue(Indexes-&gt;getZeroIndex(), VNInfoAllocator);</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">    Intervals.push&#95;back(std::move(LI));</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">    SortedSlots.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(i);</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Calculate the liveness of each block.</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">  calculateLocalLiveness();</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Dataflow iterations: &quot;</span><span class="doxyHighlight"> &lt;&lt; NumIterations &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a03503773241005f01b090b9862aad304">dump</a>());</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Propagate the liveness information.</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">  calculateLiveIntervals(NumSlots);</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(dumpIntervals());</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Search for allocas which are used outside of the declared lifetime</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// markers.</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a64335ebd86014e6660bc751627663b31">ProtectFromEscapedAllocas</a>)</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">    removeInvalidSlotRanges();</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Maps old slots to new slots.</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;int, int&gt;</a> SlotRemap;</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> RemovedSlots = 0;</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ReducedSize = 0;</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not bother looking at empty intervals.</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumSlots; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Intervals&#91;SortedSlots&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;&#93;-&gt;empty())</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">      SortedSlots&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = -1;</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is a simple greedy algorithm for merging allocas. First, sort the</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// slots, placing the largest slots first. Next, perform an n^2 scan and look</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for disjoint slots. When you find disjoint slots, merge the smaller one</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into the bigger one and update the live interval. Remove the small alloca</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and continue.</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sort the slots according to their size. Place unused slots at the end.</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use stable sort to guarantee deterministic code generation.</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(SortedSlots, &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> LHS, </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> RHS) &#123;</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We use -1 to denote a uninteresting slot. Place these slots at the end.</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LHS == -1)</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RHS == -1)</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Sort according to size.</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MFI-&gt;getObjectSize(LHS) &gt; MFI-&gt;getObjectSize(RHS);</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;s : LiveStarts)</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">llvm::sort</a>(s);</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>) &#123;</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumSlots; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SortedSlots&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; == -1)</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> J=<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>+1; J &lt; NumSlots; ++J) &#123;</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SortedSlots&#91;J&#93; == -1)</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FirstSlot = SortedSlots&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> SecondSlot = SortedSlots&#91;J&#93;;</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Objects with different stack IDs cannot be merged.</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MFI-&gt;getStackID(FirstSlot) != MFI-&gt;getStackID(SecondSlot))</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/liveinterval">LiveInterval</a> &#42;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a> = &amp;&#42;Intervals&#91;FirstSlot&#93;;</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/liveinterval">LiveInterval</a> &#42;Second = &amp;&#42;Intervals&#91;SecondSlot&#93;;</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;FirstS = LiveStarts&#91;FirstSlot&#93;;</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;SecondS = LiveStarts&#91;SecondSlot&#93;;</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>-&gt;empty() &amp;&amp; !Second-&gt;<a href="/docs/api/classes/llvm/liverange/#a66ff664a97cd3c30de7e873335a0c075">empty</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Found an empty range&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Merge disjoint slots. This is a little bit tricky - see the</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Implementation Notes section for an explanation.</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>-&gt;isLiveAtIndexes(SecondS) &amp;&amp;</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">            !Second-&gt;<a href="/docs/api/classes/llvm/liverange/#a4e12c0cb71a44b8822c5a35cbbe5c731">isLiveAtIndexes</a>(FirstS)) &#123;</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">          <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>-&gt;MergeSegmentsInAsValue(&#42;Second, <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa7fb55ed0b7a30342ba6da306428cae04">First</a>-&gt;getValNumInfo(0));</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> OldSize = FirstS.size();</span></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">          FirstS.append(SecondS.begin(), SecondS.end());</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Mid = FirstS.begin() + OldSize;</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlight">          std::inplace&#95;merge(FirstS.begin(), Mid, FirstS.end());</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">          SlotRemap&#91;SecondSlot&#93; = FirstSlot;</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">          SortedSlots&#91;J&#93; = -1;</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">          <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Merging #&quot;</span><span class="doxyHighlight"> &lt;&lt; FirstSlot &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; and slots #&quot;</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">                            &lt;&lt; SecondSlot &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; together.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">          <a href="/docs/api/structs/llvm/align">Align</a> MaxAlignment = std::max(MFI-&gt;getObjectAlign(FirstSlot),</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">                                        MFI-&gt;getObjectAlign(SecondSlot));</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MFI-&gt;getObjectSize(FirstSlot) &gt;=</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">                 MFI-&gt;getObjectSize(SecondSlot) &amp;&amp;</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;Merging a small object into a larger one&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">          RemovedSlots+=1;</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">          ReducedSize += MFI-&gt;getObjectSize(SecondSlot);</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">          MFI-&gt;setObjectAlignment(FirstSlot, MaxAlignment);</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">          MFI-&gt;RemoveStackObject(SecondSlot);</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">  &#125;</span><span class="doxyHighlightComment">// While changed.</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Record statistics.</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">  StackSpaceSaved += ReducedSize;</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">  StackSlotMerged += RemovedSlots;</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Merge &quot;</span><span class="doxyHighlight"> &lt;&lt; RemovedSlots &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; slots. Saved &quot;</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">                    &lt;&lt; ReducedSize &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; bytes\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan the entire function and update all machine operands that use frame</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// indices to use the remapped frame index.</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SlotRemap.<a href="/docs/api/classes/llvm/densemapbase/#a49c487a9395a6c384be8544cfb2cfccf">empty</a>()) &#123;</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">    expungeSlotMap(SlotRemap, NumSlots);</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">    remapInstructions(SlotRemap);</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> removeAllMarkers();</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
