---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ParametersList from '@xpack/docusaurus-plugin-doxygen/components/ParametersList'
import ParametersListItem from '@xpack/docusaurus-plugin-doxygen/components/ParametersListItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'
import SectionUser from '@xpack/docusaurus-plugin-doxygen/components/SectionUser'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `IROutliner.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/IPO/IROutliner.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/ipo/iroutliner-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/IRSimilarityIdentifier.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/irsimilarityidentifier-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/OptimizationRemarkEmitter.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Attributes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DIBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfoMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Mangler.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/mangler-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PassManager.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/IPO.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/ipo-h"
  isLocal="true" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/llvm">llvm</a></>}>
This is an optimization pass for GlobalISel generic memory operations. <a href="/docs/api/namespaces/llvm/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a></>}>
The <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> holds all the overarching information for outlining a set of regions that are structurally similar to one another, such as the types of the overall function, the output blocks, the sets of stores needed and a list of the different regions. <a href="/docs/api/structs/outlinablegroup/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="using"
  name={<><a href="#ad0fabe111fc0db047a04c21481fa6aab">ArgLocWithBBCanon</a> = std::pair&lt; unsigned, unsigned &gt;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="using"
  name={<><a href="#a69893e3a4e9fbee5b5aa9ac4b036dc5c">CanonList</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; unsigned, 2 &gt;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="using"
  name={<><a href="#a0389cc3001a985e14dcff4067684ad70">PHINodeData</a> = std::pair&lt; <a href="#ad0fabe111fc0db047a04c21481fa6aab">ArgLocWithBBCanon</a>, <a href="#a69893e3a4e9fbee5b5aa9ac4b036dc5c">CanonList</a> &gt;</>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a4fcb90c9c38b3381765a891d0a61c1ea">alignOutputBlockWithAggFunc</a> (OutlinableGroup &amp;OG, OutlinableRegion &amp;Region, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;OutputBBs, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;EndBBs, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, std::vector&lt; DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &gt; &amp;OutputStoreBBs)</>}>
For the outlined section, move needed the StoreInsts for the output registers into their own block. <a href="#a4fcb90c9c38b3381765a891d0a61c1ea">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a57d54880afa1fb74833cc7c43ad33377">analyzeAndPruneOutputBlocks</a> (DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;BlocksToPrune, OutlinableRegion &amp;Region)</>}>
Remove empty output blocks from the outlined region. <a href="#a57d54880afa1fb74833cc7c43ad33377">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a882dcfc2455d525e78a8bbf46863ace2">analyzeExitPHIsForOutputUses</a> (BasicBlock &#42;CurrentExitFromRegion, SmallPtrSet&lt; BasicBlock &#42;, 1 &gt; &amp;PotentialExitsFromRegion, DenseSet&lt; BasicBlock &#42; &gt; &amp;RegionBlocks, SetVector&lt; Value &#42; &gt; &amp;Outputs, DenseSet&lt; Value &#42; &gt; &amp;OutputsReplacedByPHINode, DenseSet&lt; Value &#42; &gt; &amp;OutputsWithNonPhiUses)</>}>
Test whether <code>CurrentExitFromRegion</code> contains any PhiNodes that should be considered outputs. <a href="#a882dcfc2455d525e78a8bbf46863ace2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a52a09c04ddc4ec6d039f1f11f01d019e">collectRegionsConstants</a> (OutlinableRegion &amp;Region, DenseMap&lt; unsigned, Constant &#42; &gt; &amp;GVNToConstant, DenseSet&lt; unsigned &gt; &amp;NotSame)</>}>
Find whether <code><a href="/docs/api/classes/llvm/region">Region</a></code> matches the global value numbering to <a href="/docs/api/classes/llvm/constant">Constant</a> mapping found so far. <a href="#a52a09c04ddc4ec6d039f1f11f01d019e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; bool &gt;</>}
  name={<><a href="#ac77f2569521257316a0f374b9a2682c5">constantMatches</a> (Value &#42;V, unsigned GVN, DenseMap&lt; unsigned, Constant &#42; &gt; &amp;GVNToConstant)</>}>
Find whether <code>V</code> matches the Constants previously found for the <code>GVN</code>. <a href="#ac77f2569521257316a0f374b9a2682c5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8120984c169f2ea17e785e7c6887702a">createAndInsertBasicBlocks</a> (DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;OldMap, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;NewMap, Function &#42;ParentFunc, Twine BaseName)</>}>
Takes in a mapping, <code>OldMap</code> of ConstantValues to BasicBlocks, sorts keys, before creating a basic block for each <code>NewMap</code>, and inserting into the new block. <a href="#a8120984c169f2ea17e785e7c6887702a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ae86fef7fc5831c2514bff95bdf784d09">createSwitchStatement</a> (Module &amp;M, OutlinableGroup &amp;OG, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;EndBBs, std::vector&lt; DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &gt; &amp;OutputStoreBBs)</>}>
Create the switch statement for outlined function to differentiate between all the output blocks. <a href="#ae86fef7fc5831c2514bff95bdf784d09">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/hash-code">hash&#95;code</a></>}
  name={<><a href="#a652d50395284a0dec463c533709bc231">encodePHINodeData</a> (PHINodeData &amp;PND)</>}>
Encode <code>PND</code> as an integer for easy lookup based on the argument location, the parent <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> canonical numbering, and the canonical numbering of the values stored in the <a href="/docs/api/classes/llvm/phinode">PHINode</a>. <a href="#a652d50395284a0dec463c533709bc231">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a4e06ebf129ddfb3b33a64f1a456cfc24">fillOverallFunction</a> (Module &amp;M, OutlinableGroup &amp;CurrentGroup, std::vector&lt; DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &gt; &amp;OutputStoreBBs, std::vector&lt; Function &#42; &gt; &amp;FuncsToRemove, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings)</>}>
Fill the new function that will serve as the replacement function for all of the extracted regions of a certain structure from the first region in the list of regions. <a href="#a4e06ebf129ddfb3b33a64f1a456cfc24">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a26b0639ceb3f28de2e6a283098c525b2">findCanonNumsForPHI</a> (PHINode &#42;PN, OutlinableRegion &amp;Region, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, SmallVector&lt; std::pair&lt; unsigned, BasicBlock &#42; &gt; &gt; &amp;CanonNums, bool ReplacedWithOutlinedCall=true)</>}>
Find the canonical numbering for the incoming Values into the <a href="/docs/api/classes/llvm/phinode">PHINode</a> <code>PN</code>. <a href="#a26b0639ceb3f28de2e6a283098c525b2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#acda959f961048eba09125aba48d1142e">findConstants</a> (IRSimilarityCandidate &amp;C, DenseSet&lt; unsigned &gt; &amp;NotSame, std::vector&lt; unsigned &gt; &amp;Inputs)</>}>
Find the constants that will need to be lifted into arguments as they are not the same in each instance of the region. <a href="#acda959f961048eba09125aba48d1142e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></>}
  name={<><a href="#a8b12ae89227758cb5684cc7cf25a7f43">findCostForOutputBlocks</a> (Module &amp;M, OutlinableGroup &amp;CurrentGroup, TargetTransformInfo &amp;TTI)</>}>
Find the extra instructions needed to handle any output values for the region. <a href="#a8b12ae89227758cb5684cc7cf25a7f43">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; unsigned &gt;</>}
  name={<><a href="#af714eb55aced0ac27294c881d8be6ecb">findDuplicateOutputBlock</a> (DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;OutputBBs, std::vector&lt; DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &gt; &amp;OutputStoreBBs)</>}>
It is possible that there is a basic block that already performs the same stores. <a href="#af714eb55aced0ac27294c881d8be6ecb">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a9148948069532c9a5e1b59e3668b8cc3">findExtractedInputToOverallInputMapping</a> (OutlinableRegion &amp;Region, std::vector&lt; unsigned &gt; &amp;InputGVNs, SetVector&lt; Value &#42; &gt; &amp;ArgInputs)</>}>
Look over the inputs and map each input argument to an argument in the overall function for the OutlinableRegions. <a href="#a9148948069532c9a5e1b59e3668b8cc3">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a4eb66b98a828331ed6cb79ae82c0336f">findExtractedOutputToOverallOutputMapping</a> (Module &amp;M, OutlinableRegion &amp;Region, SetVector&lt; Value &#42; &gt; &amp;Outputs)</>}>
Create a mapping of the output arguments for the <code><a href="/docs/api/classes/llvm/region">Region</a></code> to the output arguments of the overall outlined function. <a href="#a4eb66b98a828331ed6cb79ae82c0336f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</>}
  name={<><a href="#af30ff2458bb283e423c1fc242a468579">findOrCreatePHIBlock</a> (OutlinableGroup &amp;Group, Value &#42;RetVal)</>}>
Find or create a <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> in the outlined function containing PhiBlocks for <code>RetVal</code>. <a href="#af30ff2458bb283e423c1fc242a468579">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;</>}
  name={<><a href="#a556a77d9b9acf322358b2c4131986b13">findOrCreatePHIInBlock</a> (PHINode &amp;PN, OutlinableRegion &amp;Region, BasicBlock &#42;OverallPhiBlock, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, DenseSet&lt; PHINode &#42; &gt; &amp;UsedPHIs)</>}>
Find, or add <a href="/docs/api/classes/llvm/phinode">PHINode</a> <code>PN</code> to the combined <a href="/docs/api/classes/llvm/phinode">PHINode</a> Block <code>OverallPHIBlock</code> in order to condense the number of instructions added to the outlined function. <a href="#a556a77d9b9acf322358b2c4131986b13">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#ab0d72084e637eaecbbadd192d547ef8e">findOutputMapping</a> (const DenseMap&lt; Value &#42;, Value &#42; &gt; OutputMappings, Value &#42;Input)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> the <code>OutputMappings</code> structure for value <code><a href="/docs/api/classes/input">Input</a></code>, if it exists it has been used as an output for outlining, and has been renamed, and we return the new value, otherwise, we return the same value. <a href="#ab0d72084e637eaecbbadd192d547ef8e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#ab4b0641c5ffeeb3249b4ce9bb98c1a2d">findOutputValueInRegion</a> (OutlinableRegion &amp;Region, unsigned OutputCanon)</>}>
For the <code>OutputCanon</code> number passed in find the value represented by this canonical number. <a href="#ab4b0641c5ffeeb3249b4ce9bb98c1a2d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a48d81e3f58b8db143bc85763d25dbc7a">getCodeExtractorArguments</a> (OutlinableRegion &amp;Region, std::vector&lt; unsigned &gt; &amp;InputGVNs, DenseSet&lt; unsigned &gt; &amp;NotSame, DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, SetVector&lt; Value &#42; &gt; &amp;ArgInputs, SetVector&lt; Value &#42; &gt; &amp;Outputs)</>}>
Find the input GVNs and the output values for a region of Instructions. <a href="#a48d81e3f58b8db143bc85763d25dbc7a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; unsigned &gt;</>}
  name={<><a href="#a1c7b2c4c8824cfb8d35c97f6923c3fe2">getGVNForPHINode</a> (OutlinableRegion &amp;Region, PHINode &#42;PN, DenseSet&lt; BasicBlock &#42; &gt; &amp;Blocks, unsigned AggArgIdx)</>}>
Create a special GVN for PHINodes that will be used outside of the region. <a href="#a1c7b2c4c8824cfb8d35c97f6923c3fe2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a202f8ebe30581a7e75bcedc9dee531af">getPassedArgumentAndAdjustArgumentLocation</a> (const Argument &#42;A, const OutlinableRegion &amp;Region)</>}>
For the function call now representing the <code><a href="/docs/api/classes/llvm/region">Region</a></code>, find the passed value to that call that represents <a href="/docs/api/classes/llvm/argument">Argument</a> <code>A</code> at the call location if the call has only been replaced by the call to the aggregate function. <a href="#a202f8ebe30581a7e75bcedc9dee531af">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#ad69884d9bf751011f8f9049542bbbd01">getPassedArgumentInAlreadyOutlinedFunction</a> (const Argument &#42;A, const OutlinableRegion &amp;Region)</>}>
For the function call now representing the <code><a href="/docs/api/classes/llvm/region">Region</a></code>, find the passed value to that call that represents <a href="/docs/api/classes/llvm/argument">Argument</a> <code>A</code> at the call location if the call has already been replaced with a call to the overall, aggregate function. <a href="#ad69884d9bf751011f8f9049542bbbd01">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8ad786f21829d9e92d31cc0b80c53dbb">getSortedConstantKeys</a> (std::vector&lt; Value &#42; &gt; &amp;SortedKeys, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;Map)</>}>
A function to sort the keys of <code>Map</code>, which must be a mapping of constant values to basic blocks and return it in <code>SortedKeys</code>. <a href="#a8ad786f21829d9e92d31cc0b80c53dbb">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;</>}
  name={<><a href="#aac5cfc936b6963f4e848982328d39e8e">getSubprogramOrNull</a> (OutlinableGroup &amp;Group)</>}>
Get the subprogram if it exists for one of the outlined regions. <a href="#aac5cfc936b6963f4e848982328d39e8e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a9165dd298666d75ed2e5be7d5d8b50e5">mapInputsToGVNs</a> (IRSimilarityCandidate &amp;C, SetVector&lt; Value &#42; &gt; &amp;CurrentInputs, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, std::vector&lt; unsigned &gt; &amp;EndInputNumbers)</>}>
Find the GVN for the inputs that have been found by the <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a>. <a href="#a9165dd298666d75ed2e5be7d5d8b50e5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">moveBBContents</a> (BasicBlock &amp;SourceBB, BasicBlock &amp;TargetBB)</>}>
Move the contents of <code>SourceBB</code> to before the last instruction of <code>TargetBB</code>. <a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a4047976de351f78967fba27df7a6361f">moveFunctionData</a> (Function &amp;Old, Function &amp;New, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;NewEnds)</>}>
Move each <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> in <code>Old</code> to <code>New</code>. <a href="#a4047976de351f78967fba27df7a6361f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3bc949e06e148a6d2879eb45ca164146">nextIRInstructionDataMatchesNextInst</a> (IRInstructionData &amp;ID)</>}>
Checks that the next instruction in the InstructionDataList matches the next instruction in the module. <a href="#a3bc949e06e148a6d2879eb45ca164146">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a84e785627d5ab55370b5fa402ad7193f">outputHasNonPHI</a> (Value &#42;V, unsigned PHILoc, PHINode &amp;PN, SmallPtrSet&lt; BasicBlock &#42;, 1 &gt; &amp;Exits, DenseSet&lt; BasicBlock &#42; &gt; &amp;BlocksInRegion)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the <code>V</code> has any uses outside of the region other than <code>PN</code>. <a href="#a84e785627d5ab55370b5fa402ad7193f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a09e9f16b4a1aaf539000b95bf5442155">remapExtractedInputs</a> (const ArrayRef&lt; Value &#42; &gt; ArgInputs, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, SetVector&lt; Value &#42; &gt; &amp;RemappedArgInputs)</>}>
Find the original value for the <code>ArgInput</code> values if any one of them was replaced during a previous extraction. <a href="#a09e9f16b4a1aaf539000b95bf5442155">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a96b5bd50d8e96b4c76ffc26508ce774d">replaceArgumentUses</a> (OutlinableRegion &amp;Region, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;OutputBBs, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, bool FirstFunction=false)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;</>}
  name={<><a href="#a7e2cad7ab18db9a3c940afc609c223dc">replaceCalledFunction</a> (Module &amp;M, OutlinableRegion &amp;Region)</>}>
Replace the extracted function in the <a href="/docs/api/classes/llvm/region">Region</a> with a call to the overall function constructed from the deduplicated similar regions, replacing and remapping the values passed to the extracted function as arguments to the new arguments of the overall function. <a href="#a7e2cad7ab18db9a3c940afc609c223dc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ace02ac07a3f704ffd345301bff92e5a8">replaceConstants</a> (OutlinableRegion &amp;Region)</>}>
Within an extracted function, replace the constants that need to be lifted into arguments with the actual argument. <a href="#ace02ac07a3f704ffd345301bff92e5a8">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8e5c4577c64728c435eca5f4f7e163ab">replaceTargetsFromPHINode</a> (BasicBlock &#42;PHIBlock, BasicBlock &#42;Find, BasicBlock &#42;Replace, DenseSet&lt; BasicBlock &#42; &gt; &amp;Included)</>}>
Rewrite the BranchInsts in the incoming blocks to <code>PHIBlock</code> that are found in <code>Included</code> to branch to <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> <code>Replace</code> if they currently branch to the <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> <code>Find</code>. <a href="#a8e5c4577c64728c435eca5f4f7e163ab">More...</a>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a415af6f4421aa68820b3279b48acd928">EnableLinkOnceODRIROutlining</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a2dfbf70cabc04c37f6f46b2c312b2506">NoCostModel</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;iroutliner&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Typedefs

### ArgLocWithBBCanon {#ad0fabe111fc0db047a04c21481fa6aab}

<MemberDefinition
  prototype={<>using ArgLocWithBBCanon =  std::pair&lt;unsigned, unsigned&gt;</>}>

Definition at line <a href="#l01141">1141</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### CanonList {#a69893e3a4e9fbee5b5aa9ac4b036dc5c}

<MemberDefinition
  prototype={<>using CanonList =  SmallVector&lt;unsigned, 2&gt;</>}>

Definition at line <a href="#l01143">1143</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### PHINodeData {#a0389cc3001a985e14dcff4067684ad70}

<MemberDefinition
  prototype={<>using PHINodeData =  std::pair&lt;ArgLocWithBBCanon, CanonList&gt;</>}>

Definition at line <a href="#l01146">1146</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### alignOutputBlockWithAggFunc() {#a4fcb90c9c38b3381765a891d0a61c1ea}

<MemberDefinition
  prototype={<>static void alignOutputBlockWithAggFunc (<a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp; OG, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; OutputBBs, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; EndBBs, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &gt; &amp; OutputStoreBBs)</>}
  labels = {["static"]}>
For the outlined section, move needed the StoreInsts for the output registers into their own block.

Then, determine if there is a duplicate output block already created.


<ParametersList title="Parameters">
<ParametersListItem name="[in] OG">- The <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> of regions to be outlined.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> that is being analyzed.</ParametersListItem>
<ParametersListItem name="[inout] OutputBBs">- the blocks that stores for this region will be placed in.</ParametersListItem>
<ParametersListItem name="[in] EndBBs">- the final blocks of the extracted function.</ParametersListItem>
<ParametersListItem name="[in] OutputMappings">- OutputMappings the mapping of values that have been replaced by a new output value.</ParametersListItem>
<ParametersListItem name="[inout] OutputStoreBBs">- The existing output blocks.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l02069">2069</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### analyzeAndPruneOutputBlocks() {#a57d54880afa1fb74833cc7c43ad33377}

<MemberDefinition
  prototype={<>static bool analyzeAndPruneOutputBlocks (<a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; BlocksToPrune, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region)</>}
  labels = {["static"]}>
Remove empty output blocks from the outlined region.

<ParametersList title="Parameters">
<ParametersListItem name="BlocksToPrune">- Mapping of return values output blocks for the <code><a href="/docs/api/classes/llvm/region">Region</a></code>.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> we are analyzing.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l02022">2022</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### analyzeExitPHIsForOutputUses() {#a882dcfc2455d525e78a8bbf46863ace2}

<MemberDefinition
  prototype={<>static void analyzeExitPHIsForOutputUses (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; CurrentExitFromRegion, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 1 &gt; &amp; PotentialExitsFromRegion, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; RegionBlocks, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; Outputs, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputsReplacedByPHINode, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputsWithNonPhiUses)</>}
  labels = {["static"]}>
Test whether <code>CurrentExitFromRegion</code> contains any PhiNodes that should be considered outputs.

A PHINodes is an output when more than one incoming value has been marked by the <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a> as an output.


<ParametersList title="Parameters">
<ParametersListItem name="CurrentExitFromRegion">&#91;in&#93; - The block to analyze.</ParametersListItem>
<ParametersListItem name="PotentialExitsFromRegion">&#91;in&#93; - The potential exit blocks from the region.</ParametersListItem>
<ParametersListItem name="RegionBlocks">&#91;in&#93; - The basic blocks in the region.</ParametersListItem>
<ParametersListItem name="Outputs">&#91;in, out&#93; - The existing outputs for the region, we may add PHINodes to this as we find that they replace output values.</ParametersListItem>
<ParametersListItem name="OutputsReplacedByPHINode">&#91;out&#93; - A set containing outputs that are totally replaced by a <a href="/docs/api/classes/llvm/phinode">PHINode</a>.</ParametersListItem>
<ParametersListItem name="OutputsWithNonPhiUses">&#91;out&#93; - A set containing outputs that are used in PHINodes, but have other uses, and should still be considered outputs.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l01093">1093</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### collectRegionsConstants() {#a52a09c04ddc4ec6d039f1f11f01d019e}

<MemberDefinition
  prototype={<>static bool collectRegionsConstants (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; unsigned, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; &gt; &amp; GVNToConstant, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; unsigned &gt; &amp; NotSame)</>}
  labels = {["static"]}>
Find whether <code><a href="/docs/api/classes/llvm/region">Region</a></code> matches the global value numbering to <a href="/docs/api/classes/llvm/constant">Constant</a> mapping found so far.

<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> we are checking for constants</ParametersListItem>
<ParametersListItem name="GVNToConstant">- The mapping of global value number to Constants.</ParametersListItem>
<ParametersListItem name="NotSame">- The set of global value numbers that do not have the same constant in each region.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
true if all Constants are the same in every use of a <a href="/docs/api/classes/llvm/constant">Constant</a> in <code><a href="/docs/api/classes/llvm/region">Region</a></code> and false if not
</SectionUser>

Definition at line <a href="#l00549">549</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### constantMatches() {#ac77f2569521257316a0f374b9a2682c5}

<MemberDefinition
  prototype={<>static std::optional&lt; bool &gt; constantMatches (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, unsigned GVN, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; unsigned, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; &gt; &amp; GVNToConstant)</>}
  labels = {["static"]}>
Find whether <code>V</code> matches the Constants previously found for the <code>GVN</code>.

<ParametersList title="Parameters">
<ParametersListItem name="V">- The value to check for consistency.</ParametersListItem>
<ParametersListItem name="GVN">- The global value number assigned to <code>V</code>.</ParametersListItem>
<ParametersListItem name="GVNToConstant">- The mapping of global value number to Constants.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
true if the <a href="/docs/api/classes/llvm/value">Value</a> matches the <a href="/docs/api/classes/llvm/constant">Constant</a> mapped to by V and false if it <code>V</code> is a <a href="/docs/api/classes/llvm/constant">Constant</a> but does not match.
</SectionUser>


<SectionUser title="Returns">
std::nullopt if <code>V</code> is not a <a href="/docs/api/classes/llvm/constant">Constant</a>.
</SectionUser>

Definition at line <a href="#l00463">463</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### createAndInsertBasicBlocks() {#a8120984c169f2ea17e785e7c6887702a}

<MemberDefinition
  prototype={<>static void createAndInsertBasicBlocks (<a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; OldMap, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; NewMap, <a href="/docs/api/classes/llvm/function">Function</a> &#42; ParentFunc, <a href="/docs/api/classes/llvm/twine">Twine</a> BaseName)</>}
  labels = {["static"]}>
Takes in a mapping, <code>OldMap</code> of ConstantValues to BasicBlocks, sorts keys, before creating a basic block for each <code>NewMap</code>, and inserting into the new block.

Each <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> is named with the scheme &quot;&lt;basename&gt;&#95;&lt;key&#95;idx&gt;&quot;.


<ParametersList title="Parameters">
<ParametersListItem name="OldMap">&#91;in&#93; - The mapping to base the new mapping off of.</ParametersListItem>
<ParametersListItem name="NewMap">&#91;out&#93; - The output mapping using the keys of <code>OldMap</code>.</ParametersListItem>
<ParametersListItem name="ParentFunc">&#91;in&#93; - The function to put the new basic block in.</ParametersListItem>
<ParametersListItem name="BaseName">&#91;in&#93; - The start of the <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> names to be appended to by an index value.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l02124">2124</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### createSwitchStatement() {#ae86fef7fc5831c2514bff95bdf784d09}

<MemberDefinition
  prototype={<>void createSwitchStatement (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp; OG, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; EndBBs, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &gt; &amp; OutputStoreBBs)</>}>
Create the switch statement for outlined function to differentiate between all the output blocks.

For the outlined section, determine if an outlined block already exists that matches the needed stores for the extracted section. 
<ParametersList title="Parameters">
<ParametersListItem name="[in] M">- The module we are outlining from.</ParametersListItem>
<ParametersListItem name="[in] OG">- The group of regions to be outlined.</ParametersListItem>
<ParametersListItem name="[in] EndBBs">- The final blocks of the extracted function.</ParametersListItem>
<ParametersListItem name="[inout] OutputStoreBBs">- The existing output blocks.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l02150">2150</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### encodePHINodeData() {#a652d50395284a0dec463c533709bc231}

<MemberDefinition
  prototype={<>static hash&#95;code encodePHINodeData (<a href="#a0389cc3001a985e14dcff4067684ad70">PHINodeData</a> &amp; PND)</>}
  labels = {["static"]}>
Encode <code>PND</code> as an integer for easy lookup based on the argument location, the parent <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> canonical numbering, and the canonical numbering of the values stored in the <a href="/docs/api/classes/llvm/phinode">PHINode</a>.

<ParametersList title="Parameters">
<ParametersListItem name="PND">- The data to hash.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
The hash code of <code>PND</code>.
</SectionUser>

Definition at line <a href="#l01154">1154</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### fillOverallFunction() {#a4e06ebf129ddfb3b33a64f1a456cfc24}

<MemberDefinition
  prototype={<>static void fillOverallFunction (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp; CurrentGroup, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &gt; &amp; OutputStoreBBs, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/function">Function</a> &#42; &gt; &amp; FuncsToRemove, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings)</>}
  labels = {["static"]}>
Fill the new function that will serve as the replacement function for all of the extracted regions of a certain structure from the first region in the list of regions.

Replace this first region&#39;s extracted function with the new overall function.


<ParametersList title="Parameters">
<ParametersListItem name="[in] M">- The module we are outlining from.</ParametersListItem>
<ParametersListItem name="[in] CurrentGroup">- The group of regions to be outlined.</ParametersListItem>
<ParametersListItem name="[inout] OutputStoreBBs">- The output blocks for each different set of stores needed for the different functions.</ParametersListItem>
<ParametersListItem name="[inout] FuncsToRemove">- Extracted functions to erase from module once outlining is complete.</ParametersListItem>
<ParametersListItem name="[in] OutputMappings">- Extracted functions to erase from module once outlining is complete.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l02243">2243</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findCanonNumsForPHI() {#a26b0639ceb3f28de2e6a283098c525b2}

<MemberDefinition
  prototype={<>static void findCanonNumsForPHI (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; std::pair&lt; unsigned, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &gt; &amp; CanonNums, bool ReplacedWithOutlinedCall=<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a>)</>}
  labels = {["static"]}>
Find the canonical numbering for the incoming Values into the <a href="/docs/api/classes/llvm/phinode">PHINode</a> <code>PN</code>.

<ParametersList title="Parameters">
<ParametersListItem name="PN">&#91;in&#93; - The <a href="/docs/api/classes/llvm/phinode">PHINode</a> that we are finding the canonical numbers for.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">&#91;in&#93; - The <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> containing <code>PN</code>.</ParametersListItem>
<ParametersListItem name="OutputMappings">&#91;in&#93; - The mapping of output values from outlined region to their original values.</ParametersListItem>
<ParametersListItem name="CanonNums">&#91;out&#93; - The canonical numbering for the incoming values to <code>PN</code> paired with their incoming block.</ParametersListItem>
<ParametersListItem name="ReplacedWithOutlinedCall">- A flag to use the extracted function call of <code><a href="/docs/api/classes/llvm/region">Region</a></code> rather than the overall function&#39;s call.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l01634">1634</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findConstants() {#acda959f961048eba09125aba48d1142e}

<MemberDefinition
  prototype={<>static void findConstants (<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp; C, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; unsigned &gt; &amp; NotSame, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; unsigned &gt; &amp; Inputs)</>}
  labels = {["static"]}>
Find the constants that will need to be lifted into arguments as they are not the same in each instance of the region.

<ParametersList title="Parameters">
<ParametersListItem name="[in] C">- The <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> containing the region we are analyzing.</ParametersListItem>
<ParametersListItem name="[in] NotSame">- The set of global value numbers that do not have a single <a href="/docs/api/classes/llvm/constant">Constant</a> across all OutlinableRegions similar to <code>C</code>.</ParametersListItem>
<ParametersListItem name="[out] Inputs">- The list containing the global value numbers of the arguments needed for the region of code.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00778">778</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findCostForOutputBlocks() {#a8b12ae89227758cb5684cc7cf25a7f43}

<MemberDefinition
  prototype={<>static InstructionCost findCostForOutputBlocks (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp; CurrentGroup, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
Find the extra instructions needed to handle any output values for the region.

<ParametersList title="Parameters">
<ParametersListItem name="[in] M">- The <a href="/docs/api/classes/llvm/module">Module</a> to outline from.</ParametersListItem>
<ParametersListItem name="[in] CurrentGroup">- The collection of OutlinableRegions to analyze.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068&quot;>TTI</a>">- The <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> used to collect information for new instruction costs.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
the additional cost to handle the outputs.
</SectionUser>

Definition at line <a href="#l02556">2556</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findDuplicateOutputBlock() {#af714eb55aced0ac27294c881d8be6ecb}

<MemberDefinition
  prototype={<>std::optional&lt; unsigned &gt; findDuplicateOutputBlock (<a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; OutputBBs, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &gt; &amp; OutputStoreBBs)</>}>
It is possible that there is a basic block that already performs the same stores.

This returns a duplicate block, if it exists


<ParametersList title="Parameters">
<ParametersListItem name="OutputBBs">&#91;in&#93; the blocks we are looking for a duplicate of.</ParametersListItem>
<ParametersListItem name="OutputStoreBBs">&#91;in&#93; The existing output blocks.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
an optional value with the number output block if there is a match.
</SectionUser>

Definition at line <a href="#l01967">1967</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findExtractedInputToOverallInputMapping() {#a9148948069532c9a5e1b59e3668b8cc3}

<MemberDefinition
  prototype={<>static void findExtractedInputToOverallInputMapping (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; unsigned &gt; &amp; InputGVNs, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; ArgInputs)</>}
  labels = {["static"]}>
Look over the inputs and map each input argument to an argument in the overall function for the OutlinableRegions.

This creates a way to replace the arguments of the extracted function with the arguments of the new overall function.


<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The region of code to be analyzed.</ParametersListItem>
<ParametersListItem name="[in] InputGVNs">- The global value numbering of the input values collected.</ParametersListItem>
<ParametersListItem name="[in] ArgInputs">- The values of the arguments to the extracted function.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00934">934</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findExtractedOutputToOverallOutputMapping() {#a4eb66b98a828331ed6cb79ae82c0336f}

<MemberDefinition
  prototype={<>static void findExtractedOutputToOverallOutputMapping (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; Outputs)</>}
  labels = {["static"]}>
Create a mapping of the output arguments for the <code><a href="/docs/api/classes/llvm/region">Region</a></code> to the output arguments of the overall outlined function.

<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The region of code to be analyzed.</ParametersListItem>
<ParametersListItem name="[in] Outputs">- The values found by the code extractor.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l01276">1276</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findOrCreatePHIBlock() {#af30ff2458bb283e423c1fc242a468579}

<MemberDefinition
  prototype={<>static BasicBlock &#42; findOrCreatePHIBlock (<a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp; Group, <a href="/docs/api/classes/llvm/value">Value</a> &#42; RetVal)</>}
  labels = {["static"]}>
Find or create a <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> in the outlined function containing PhiBlocks for <code>RetVal</code>.

<ParametersList title="Parameters">
<ParametersListItem name="Group">- The <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> containing the information about the overall outlined function.</ParametersListItem>
<ParametersListItem name="RetVal">- The return value or exit option that we are currently evaluating.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
The found or newly created <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> to contain the needed PHINodes to be used as outputs.
</SectionUser>

Definition at line <a href="#l01540">1540</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findOrCreatePHIInBlock() {#a556a77d9b9acf322358b2c4131986b13}

<MemberDefinition
  prototype={<>static PHINode &#42; findOrCreatePHIInBlock (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp; PN, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; OverallPhiBlock, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; &gt; &amp; UsedPHIs)</>}
  labels = {["static"]}>
Find, or add <a href="/docs/api/classes/llvm/phinode">PHINode</a> <code>PN</code> to the combined <a href="/docs/api/classes/llvm/phinode">PHINode</a> Block <code>OverallPHIBlock</code> in order to condense the number of instructions added to the outlined function.

<ParametersList title="Parameters">
<ParametersListItem name="PN">&#91;in&#93; - The <a href="/docs/api/classes/llvm/phinode">PHINode</a> that we are finding the canonical numbers for.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">&#91;in&#93; - The <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> containing <code>PN</code>.</ParametersListItem>
<ParametersListItem name="OverallPhiBlock">&#91;in&#93; - The overall PHIBlock we are trying to find <code>PN</code> in.</ParametersListItem>
<ParametersListItem name="OutputMappings">&#91;in&#93; - The mapping of output values from outlined region to their original values.</ParametersListItem>
<ParametersListItem name="UsedPHIs">&#91;in, out&#93; - The PHINodes in the block that have already been matched.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
the newly found or created <a href="/docs/api/classes/llvm/phinode">PHINode</a> in <code>OverallPhiBlock</code>.
</SectionUser>

Definition at line <a href="#l01678">1678</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findOutputMapping() {#ab0d72084e637eaecbbadd192d547ef8e}

<MemberDefinition
  prototype={<>static Value &#42; findOutputMapping (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; OutputMappings, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Input)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> the <code>OutputMappings</code> structure for value <code><a href="/docs/api/classes/input">Input</a></code>, if it exists it has been used as an output for outlining, and has been renamed, and we return the new value, otherwise, we return the same value.

<ParametersList title="Parameters">
<ParametersListItem name="OutputMappings">&#91;in&#93; - The mapping of values to their renamed value after being used as an output for an outlined region.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/input&quot;>Input</a>">&#91;in&#93; - The value to find the remapped value of, if it exists.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
The remapped value if it has been renamed, and the same value if has not.
</SectionUser>

Definition at line <a href="#l00530">530</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findOutputValueInRegion() {#ab4b0641c5ffeeb3249b4ce9bb98c1a2d}

<MemberDefinition
  prototype={<>static Value &#42; findOutputValueInRegion (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, unsigned OutputCanon)</>}
  labels = {["static"]}>
For the <code>OutputCanon</code> number passed in find the value represented by this canonical number.

If it is from a <a href="/docs/api/classes/llvm/phinode">PHINode</a>, we pick the first incoming value and return that <a href="/docs/api/classes/llvm/value">Value</a> instead.


<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> to get the <a href="/docs/api/classes/llvm/value">Value</a> from.</ParametersListItem>
<ParametersListItem name="OutputCanon">- The canonical number to find the <a href="/docs/api/classes/llvm/value">Value</a> from.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
The <a href="/docs/api/classes/llvm/value">Value</a> represented by a canonical number <code>OutputCanon</code> in <code><a href="/docs/api/classes/llvm/region">Region</a></code>.
</SectionUser>

Definition at line <a href="#l02504">2504</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### getCodeExtractorArguments() {#a48d81e3f58b8db143bc85763d25dbc7a}

<MemberDefinition
  prototype={<>static void getCodeExtractorArguments (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; unsigned &gt; &amp; InputGVNs, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; unsigned &gt; &amp; NotSame, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; ArgInputs, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; Outputs)</>}
  labels = {["static"]}>
Find the input GVNs and the output values for a region of Instructions.

Using the code extractor, we collect the inputs to the extracted function.

The <code><a href="/docs/api/classes/llvm/region">Region</a></code> can be identified as needing to be ignored in this function. It should be checked whether it should be ignored after a call to this function.


<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The region of code to be analyzed.</ParametersListItem>
<ParametersListItem name="[out] InputGVNs">- The global value numbers for the extracted arguments.</ParametersListItem>
<ParametersListItem name="[in] NotSame">- The global value numbers in the region that do not have the same constant value in the regions structurally similar to <code><a href="/docs/api/classes/llvm/region">Region</a></code>.</ParametersListItem>
<ParametersListItem name="[in] OutputMappings">- The mapping of values that have been replaced by a new output value after extraction.</ParametersListItem>
<ParametersListItem name="[out] ArgInputs">- The values of the inputs to the extracted function.</ParametersListItem>
<ParametersListItem name="[out] Outputs">- The set of values extracted by the <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a> as outputs.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00863">863</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### getGVNForPHINode() {#a1c7b2c4c8824cfb8d35c97f6923c3fe2}

<MemberDefinition
  prototype={<>static std::optional&lt; unsigned &gt; getGVNForPHINode (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; Blocks, unsigned AggArgIdx)</>}
  labels = {["static"]}>
Create a special GVN for PHINodes that will be used outside of the region.

We create a hash code based on the Canonical number of the parent <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a>, the canonical numbering of the values stored in the <a href="/docs/api/classes/llvm/phinode">PHINode</a> and the aggregate argument location. This is used to find whether this <a href="/docs/api/classes/llvm/phinode">PHINode</a> type has been given a canonical numbering already. If not, we assign it a value and store it for later use. The value is returned to identify different output schemes for the set of regions.


<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The region that <code>PN</code> is an output for.</ParametersListItem>
<ParametersListItem name="PN">- The <a href="/docs/api/classes/llvm/phinode">PHINode</a> we are analyzing.</ParametersListItem>
<ParametersListItem name="Blocks">- The blocks for the region we are analyzing.</ParametersListItem>
<ParametersListItem name="AggArgIdx">- The argument <code>PN</code> will be stored into.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
An optional holding the assigned canonical number, or std::nullopt if there is some attribute of the <a href="/docs/api/classes/llvm/phinode">PHINode</a> blocking it from being used.
</SectionUser>

Definition at line <a href="#l01174">1174</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### getPassedArgumentAndAdjustArgumentLocation() {#a202f8ebe30581a7e75bcedc9dee531af}

<MemberDefinition
  prototype={<>static Value &#42; getPassedArgumentAndAdjustArgumentLocation (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42; A, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region)</>}
  labels = {["static"]}>
For the function call now representing the <code><a href="/docs/api/classes/llvm/region">Region</a></code>, find the passed value to that call that represents <a href="/docs/api/classes/llvm/argument">Argument</a> <code>A</code> at the call location if the call has only been replaced by the call to the aggregate function.

<ParametersList title="Parameters">
<ParametersListItem name="A">- The <a href="/docs/api/classes/llvm/argument">Argument</a> to get the passed value for.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The extracted <a href="/docs/api/classes/llvm/region">Region</a> corresponding to the outlined function.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
The <a href="/docs/api/classes/llvm/value">Value</a> representing <code>A</code> at the call site.
</SectionUser>

Definition at line <a href="#l01609">1609</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### getPassedArgumentInAlreadyOutlinedFunction() {#ad69884d9bf751011f8f9049542bbbd01}

<MemberDefinition
  prototype={<>static Value &#42; getPassedArgumentInAlreadyOutlinedFunction (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42; A, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region)</>}
  labels = {["static"]}>
For the function call now representing the <code><a href="/docs/api/classes/llvm/region">Region</a></code>, find the passed value to that call that represents <a href="/docs/api/classes/llvm/argument">Argument</a> <code>A</code> at the call location if the call has already been replaced with a call to the overall, aggregate function.

<ParametersList title="Parameters">
<ParametersListItem name="A">- The <a href="/docs/api/classes/llvm/argument">Argument</a> to get the passed value for.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The extracted <a href="/docs/api/classes/llvm/region">Region</a> corresponding to the outlined function.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
The <a href="/docs/api/classes/llvm/value">Value</a> representing <code>A</code> at the call site.
</SectionUser>

Definition at line <a href="#l01593">1593</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### getSortedConstantKeys() {#a8ad786f21829d9e92d31cc0b80c53dbb}

<MemberDefinition
  prototype={<>static void getSortedConstantKeys (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; SortedKeys, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; Map)</>}
  labels = {["static"]}>
A function to sort the keys of <code>Map</code>, which must be a mapping of constant values to basic blocks and return it in <code>SortedKeys</code>.

<ParametersList title="Parameters">
<ParametersListItem name="SortedKeys">- The vector the keys will be return in and sorted.</ParametersListItem>
<ParametersListItem name="Map">- The <a href="/docs/api/classes/llvm/densemap">DenseMap</a> containing keys to sort.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00165">165</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### getSubprogramOrNull() {#aac5cfc936b6963f4e848982328d39e8e}

<MemberDefinition
  prototype={<>static DISubprogram &#42; getSubprogramOrNull (<a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp; Group)</>}
  labels = {["static"]}>
Get the subprogram if it exists for one of the outlined regions.

<ParametersList title="Parameters">
<ParametersListItem name="[in] Group">- The set of regions to find a subprogram for.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
the subprogram if it exists, or nullptr.
</SectionUser>

Definition at line <a href="#l00620">620</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### mapInputsToGVNs() {#a9165dd298666d75ed2e5be7d5d8b50e5}

<MemberDefinition
  prototype={<>static void mapInputsToGVNs (<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp; C, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; CurrentInputs, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; unsigned &gt; &amp; EndInputNumbers)</>}
  labels = {["static"]}>
Find the GVN for the inputs that have been found by the <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a>.

<ParametersList title="Parameters">
<ParametersListItem name="[in] C">- The <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> containing the region we are analyzing.</ParametersListItem>
<ParametersListItem name="[in] CurrentInputs">- The set of inputs found by the <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a>.</ParametersListItem>
<ParametersListItem name="[in] OutputMappings">- The mapping of values that have been replaced by a new output value.</ParametersListItem>
<ParametersListItem name="[out] EndInputNumbers">- The global value numbers for the extracted arguments.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00806">806</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### moveBBContents() {#a3afc8c0c69b0c55edce3be13d5b7cc32}

<MemberDefinition
  prototype={<>static void moveBBContents (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp; SourceBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp; TargetBB)</>}
  labels = {["static"]}>
Move the contents of <code>SourceBB</code> to before the last instruction of <code>TargetBB</code>.

<ParametersList title="Parameters">
<ParametersListItem name="SourceBB">- the <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> to pull Instructions from.</ParametersListItem>
<ParametersListItem name="TargetBB">- the <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> to put <a href="/docs/api/classes/llvm/instruction">Instruction</a> into.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00156">156</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### moveFunctionData() {#a4047976de351f78967fba27df7a6361f}

<MemberDefinition
  prototype={<>static void moveFunctionData (<a href="/docs/api/classes/llvm/function">Function</a> &amp; Old, <a href="/docs/api/classes/llvm/function">Function</a> &amp; New, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; NewEnds)</>}
  labels = {["static"]}>
Move each <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> in <code>Old</code> to <code>New</code>.

<ParametersList title="Parameters">
<ParametersListItem name="[in] Old">- The function to move the basic blocks from.</ParametersListItem>
<ParametersListItem name="[in] New">- The function to move the basic blocks to.</ParametersListItem>
<ParametersListItem name="[out] NewEnds">- The return blocks of the new overall function.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00706">706</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### nextIRInstructionDataMatchesNextInst() {#a3bc949e06e148a6d2879eb45ca164146}

<MemberDefinition
  prototype={<>static bool nextIRInstructionDataMatchesNextInst (<a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata">IRInstructionData</a> &amp; ID)</>}
  labels = {["static"]}>
Checks that the next instruction in the InstructionDataList matches the next instruction in the module.

If they do not, there could be the possibility that extra code has been inserted, and we must ignore it.


<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed&quot;>ID</a>">- The <a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata">IRInstructionData</a> to check the next instruction of.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
true if the InstructionDataList and actual instruction match.
</SectionUser>

Definition at line <a href="#l02337">2337</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### outputHasNonPHI() {#a84e785627d5ab55370b5fa402ad7193f}

<MemberDefinition
  prototype={<>static bool outputHasNonPHI (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, unsigned PHILoc, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp; PN, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 1 &gt; &amp; Exits, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; BlocksInRegion)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the <code>V</code> has any uses outside of the region other than <code>PN</code>.

<ParametersList title="Parameters">
<ParametersListItem name="V">&#91;in&#93; - The value to check.</ParametersListItem>
<ParametersListItem name="PHILoc">&#91;in&#93; - The location in the <a href="/docs/api/classes/llvm/phinode">PHINode</a> of <code>V</code>.</ParametersListItem>
<ParametersListItem name="PN">&#91;in&#93; - The <a href="/docs/api/classes/llvm/phinode">PHINode</a> using <code>V</code>.</ParametersListItem>
<ParametersListItem name="Exits">&#91;in&#93; - The potential blocks we exit to from the outlined region.</ParametersListItem>
<ParametersListItem name="BlocksInRegion">&#91;in&#93; - The basic blocks contained in the region.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
true if <code>V</code> has any use soutside its region other than <code>PN</code>.
</SectionUser>

Definition at line <a href="#l01036">1036</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### remapExtractedInputs() {#a09e9f16b4a1aaf539000b95bf5442155}

<MemberDefinition
  prototype={<>static void remapExtractedInputs (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; ArgInputs, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; RemappedArgInputs)</>}
  labels = {["static"]}>
Find the original value for the <code>ArgInput</code> values if any one of them was replaced during a previous extraction.

<ParametersList title="Parameters">
<ParametersListItem name="[in] ArgInputs">- The inputs to be extracted by the code extractor.</ParametersListItem>
<ParametersListItem name="[in] OutputMappings">- The mapping of values that have been replaced by a new output value.</ParametersListItem>
<ParametersListItem name="[out] RemappedArgInputs">- The remapped values according to <code>OutputMappings</code> that will be extracted.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00832">832</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### replaceArgumentUses() {#a96b5bd50d8e96b4c76ffc26508ce774d}

<MemberDefinition
  prototype={<>static void replaceArgumentUses (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; OutputBBs, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, bool FirstFunction=false)</>}
  labels = {["static"]}>

<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The region of extracted code to be changed.</ParametersListItem>
<ParametersListItem name="[inout] OutputBBs">- The <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> for the output stores for this region.</ParametersListItem>
<ParametersListItem name="[in] FirstFunction">- A flag to indicate whether we are using this function to define the overall outlined function for all the regions, or if we are operating on one of the following regions.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l01800">1800</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### replaceCalledFunction() {#a7e2cad7ab18db9a3c940afc609c223dc}

<MemberDefinition
  prototype={<>CallInst &#42; replaceCalledFunction (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region)</>}>
Replace the extracted function in the <a href="/docs/api/classes/llvm/region">Region</a> with a call to the overall function constructed from the deduplicated similar regions, replacing and remapping the values passed to the extracted function as arguments to the new arguments of the overall function.

<ParametersList title="Parameters">
<ParametersListItem name="[in] M">- The module to outline from.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The regions of extracted code to be replaced with a new function.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
a call instruction with the replaced function.
</SectionUser>

Definition at line <a href="#l01429">1429</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### replaceConstants() {#ace02ac07a3f704ffd345301bff92e5a8}

<MemberDefinition
  prototype={<>void replaceConstants (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region)</>}>
Within an extracted function, replace the constants that need to be lifted into arguments with the actual argument.

<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">&#91;in&#93; - The region of extracted code to be changed.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l01934">1934</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### replaceTargetsFromPHINode() {#a8e5c4577c64728c435eca5f4f7e163ab}

<MemberDefinition
  prototype={<>static void replaceTargetsFromPHINode (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; PHIBlock, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; Find, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; Replace, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; Included)</>}
  labels = {["static"]}>
Rewrite the BranchInsts in the incoming blocks to <code>PHIBlock</code> that are found in <code>Included</code> to branch to <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> <code>Replace</code> if they currently branch to the <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> <code>Find</code>.

This is used to fix up the incoming basic blocks when PHINodes are included in outlined regions.


<ParametersList title="Parameters">
<ParametersListItem name="PHIBlock">- The <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> containing the PHINodes that need to be checked.</ParametersListItem>
<ParametersListItem name="Find">- The successor block to be replaced.</ParametersListItem>
<ParametersListItem name="Replace">- The new succesor block to branch to.</ParametersListItem>
<ParametersListItem name="Included">- The set of blocks about to be outlined.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00220">220</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### EnableLinkOnceODRIROutlining {#a415af6f4421aa68820b3279b48acd928}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableLinkOnceODRIROutlining(&quot;enable-linkonceodr-ir-outlining&quot;, cl::Hidden, cl::desc(&quot;Enable the IR outliner on linkonceodr functions&quot;), cl::init(false))</>}
  labels = {["static"]}>

Definition at line <a href="#l00055">55</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### NoCostModel {#a2dfbf70cabc04c37f6f46b2c312b2506}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; NoCostModel(&quot;ir-outlining-no-cost&quot;, cl::init(false), cl::ReallyHidden, cl::desc(&quot;Debug option to outline greedily, without restriction that &quot; &quot;calculated benefit outweighs cost&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00062">62</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;iroutliner&quot;</>}>

Definition at line <a href="#l00030">30</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- IROutliner.cpp -- Outline Similar Regions ----------------&#42;- C++ -&#42;-===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">/// \\file</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// Implementation for the IROutliner which is used by the IROutliner Pass.</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/ipo/iroutliner-h">llvm/Transforms/IPO/IROutliner.h</a>&quot;</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/irsimilarityidentifier-h">llvm/Analysis/IRSimilarityIdentifier.h</a>&quot;</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h">llvm/IR/Attributes.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h">llvm/IR/DIBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h">llvm/IR/DebugInfoMetadata.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/mangler-h">llvm/IR/Mangler.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h">llvm/IR/PassManager.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/ipo-h">llvm/Transforms/IPO.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &lt;optional&gt;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &lt;vector&gt;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;iroutliner&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/irsimilarity">IRSimilarity</a>;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightComment">// A command flag to be used for debugging to exclude branches from similarity</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightComment">// matching and outlining.</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38" lineLink="/docs/api/namespaces/llvm/#a93b773511cf2c25df41bdd74e8718bd3"><span class="doxyHighlightKeyword">extern</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#a93b773511cf2c25df41bdd74e8718bd3">DisableBranches</a>;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightComment">// A command flag to be used for debugging to indirect calls from similarity</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightComment">// matching and outlining.</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42" lineLink="/docs/api/namespaces/llvm/#a59a51d46c30287fc47551914e29de21e"><span class="doxyHighlightKeyword">extern</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#a59a51d46c30287fc47551914e29de21e">DisableIndirectCalls</a>;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightComment">// A command flag to be used for debugging to exclude intrinsics from similarity</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightComment">// matching and outlining.</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46" lineLink="/docs/api/namespaces/llvm/#a98fea048f88b5fe74294b5bf72acb93c"><span class="doxyHighlightKeyword">extern</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#a98fea048f88b5fe74294b5bf72acb93c">DisableIntrinsics</a>;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace llvm</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightComment">// Set to true if the user wants the ir outliner to run on linkonceodr linkage</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightComment">// functions. This is false by default because the linker can dedupe linkonceodr</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightComment">// functions. Since the outliner is confined to a single module (modulo LTO),</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightComment">// this is off by default. It should, however, be the default behavior in</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightComment">// LTO.</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55" lineLink="#a415af6f4421aa68820b3279b48acd928"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a415af6f4421aa68820b3279b48acd928">EnableLinkOnceODRIROutlining</a>(</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;enable-linkonceodr-ir-outlining&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable the IR outliner on linkonceodr functions&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightComment">// This is a debug option to test small pieces of code to ensure that outlining</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightComment">// works correctly.</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62" lineLink="#a2dfbf70cabc04c37f6f46b2c312b2506"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a2dfbf70cabc04c37f6f46b2c312b2506">NoCostModel</a>(</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;ir-outlining-no-cost&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40ab81f279502bb9ca74e6629cfb62844be">cl::ReallyHidden</a>,</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Debug option to outline greedily, without restriction that &quot;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;calculated benefit outweighs cost&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightComment">/// The OutlinableGroup holds all the overarching information for outlining</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightComment">/// a set of regions that are structurally similar to one another, such as the</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightComment">/// types of the overall function, the output blocks, the sets of stores needed</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightComment">/// and a list of the different regions. This information is used in the</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightComment">/// deduplication of extracted regions with the same structure.</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72" lineLink="/docs/api/structs/outlinablegroup"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &#123;</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightComment">  /// The sections that could be outlined</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74" lineLink="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11"><span class="doxyHighlight">  std::vector&lt;OutlinableRegion &#42;&gt; <a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightComment">  /// The argument types for the function created as the overall function to</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightComment">  /// replace the extracted function for each region.</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78" lineLink="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d"><span class="doxyHighlight">  std::vector&lt;Type &#42;&gt; <a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlightComment">  /// The FunctionType for the overall function.</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80" lineLink="/docs/api/structs/outlinablegroup/#aab2165e523387ae034bc2117b13c5d51"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;<a href="/docs/api/structs/outlinablegroup/#aab2165e523387ae034bc2117b13c5d51">OutlinedFunctionType</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightComment">  /// The Function for the collective overall function.</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82" lineLink="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightComment">  /// Flag for whether we should not consider this group of OutlinableRegions</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightComment">  /// for extraction.</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86" lineLink="/docs/api/structs/outlinablegroup/#a7bf6409b01dd04465404d268beec0898"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/outlinablegroup/#a7bf6409b01dd04465404d268beec0898">IgnoreGroup</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlightComment">  /// The return blocks for the overall function.</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89" lineLink="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> <a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlightComment">  /// The PHIBlocks with their corresponding return block based on the return</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlightComment">  /// value as the key.</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93" lineLink="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> <a href="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6">PHIBlocks</a>;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlightComment">  /// A set containing the different GVN store sets needed. Each array contains</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlightComment">  /// a sorted list of the different values that need to be stored into output</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlightComment">  /// registers.</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98" lineLink="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;ArrayRef&lt;unsigned&gt;</a>&gt; <a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>;</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlightComment">  /// Flag for whether the \\ref ArgumentTypes have been defined after the</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlightComment">  /// extraction of the first region.</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102" lineLink="/docs/api/structs/outlinablegroup/#a9fabb6e6f74e4ef23575f45ea098b827"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/outlinablegroup/#a9fabb6e6f74e4ef23575f45ea098b827">InputTypesSet</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlightComment">  /// The number of input values in \\ref ArgumentTypes.  Anything after this</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlightComment">  /// index in ArgumentTypes is an output argument.</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106" lineLink="/docs/api/structs/outlinablegroup/#aeab6020692f93361cff45734711204fc"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/outlinablegroup/#aeab6020692f93361cff45734711204fc">NumAggregateInputs</a> = 0;</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlightComment">  /// The mapping of the canonical numbering of the values in outlined sections</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlightComment">  /// to specific arguments.</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110" lineLink="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, unsigned&gt;</a> <a href="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25">CanonicalNumberToAggArg</a>;</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlightComment">  /// The number of branches in the region target a basic block that is outside</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlightComment">  /// of the region.</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114" lineLink="/docs/api/structs/outlinablegroup/#a8ef219d66e525d2c9fbb7f54e5869ad3"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/outlinablegroup/#a8ef219d66e525d2c9fbb7f54e5869ad3">BranchesToOutside</a> = 0;</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlightComment">  /// Tracker counting backwards from the highest unsigned value possible to</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlightComment">  /// avoid conflicting with the GVNs of assigned values.  We start at -3 since</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlightComment">  /// -2 and -1 are assigned by the DenseMap.</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119" lineLink="/docs/api/structs/outlinablegroup/#a72b89466c3b2fd45331e2c315e2c33e5"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/outlinablegroup/#a72b89466c3b2fd45331e2c315e2c33e5">PHINodeGVNTracker</a> = -3;</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt;unsigned,</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">           std::pair&lt;std::pair&lt;unsigned, unsigned&gt;, <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;unsigned, 2&gt;</a>&gt;&gt;</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123" lineLink="/docs/api/structs/outlinablegroup/#a704926b49e550b25585651aea32b389b"><span class="doxyHighlight">      <a href="/docs/api/structs/outlinablegroup/#a704926b49e550b25585651aea32b389b">PHINodeGVNToGVNs</a>;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124" lineLink="/docs/api/structs/outlinablegroup/#a78f1513d0fadc0e72c1c7373c2003666"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;hash&#95;code, unsigned&gt;</a> <a href="/docs/api/structs/outlinablegroup/#a78f1513d0fadc0e72c1c7373c2003666">GVNsToPHINodeGVN</a>;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlightComment">  /// The number of instructions that will be outlined by extracting \\ref</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlightComment">  /// Regions.</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128" lineLink="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> = 0;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlightComment">  /// The number of added instructions needed for the outlining of the \\ref</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlightComment">  /// Regions.</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131" lineLink="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> = 0;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlightComment">  /// The argument that needs to be marked with the swifterr attribute.  If not</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlightComment">  /// needed, there is no value.</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135" lineLink="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; <a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a>;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlightComment">  /// For the \\ref Regions, we look at every Value.  If it is a constant,</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlightComment">  /// we check whether it is the same in Region.</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlightComment">  /// \\param &#91;in,out&#93; NotSame contains the global value numbers where the</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlightComment">  /// constant is not always the same, and must be passed in as an argument.</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/outlinablegroup/#a61915f6a6a382f51fd1a8bf3dd188c0c">findSameConstants</a>(<a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> &amp;NotSame);</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlightComment">  /// For the regions, look at each set of GVN stores needed and account for</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlightComment">  /// each combination.  Add an argument to the argument types if there is</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlightComment">  /// more than one combination.</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlightComment">  ///</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlightComment">  /// \\param &#91;in&#93; M - The module we are outlining from.</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/outlinablegroup/#ad67fb96194cff11216803ad74dba5687">collectGVNStoreSets</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M);</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlightComment">/// Move the contents of \\p SourceBB to before the last instruction of \\p</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlightComment">/// TargetBB.</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlightComment">/// \\param SourceBB - the BasicBlock to pull Instructions from.</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlightComment">/// \\param TargetBB - the BasicBlock to put Instruction into.</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156" lineLink="#a3afc8c0c69b0c55edce3be13d5b7cc32"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">moveBBContents</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;SourceBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;TargetBB) &#123;</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">  TargetBB.<a href="/docs/api/classes/llvm/basicblock/#af29f89e91dfd0ae90950f0b1bf49798d">splice</a>(TargetBB.<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(), &amp;SourceBB);</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlightComment">/// A function to sort the keys of \\p Map, which must be a mapping of constant</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlightComment">/// values to basic blocks and return it in \\p SortedKeys</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlightComment">/// \\param SortedKeys - The vector the keys will be return in and sorted.</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlightComment">/// \\param Map - The DenseMap containing keys to sort.</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165" lineLink="#a8ad786f21829d9e92d31cc0b80c53dbb"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a8ad786f21829d9e92d31cc0b80c53dbb">getSortedConstantKeys</a>(std::vector&lt;Value &#42;&gt; &amp;SortedKeys,</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;Map) &#123;</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;VtoBB : Map)</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">    SortedKeys.push&#95;back(VtoBB.first);</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Here we expect to have either 1 value that is void (nullptr) or multiple</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// values that are all constant integers.</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SortedKeys.size() == 1) &#123;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!SortedKeys&#91;0&#93; &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected a single void value.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">stable&#95;sort</a>(SortedKeys, &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected non void values.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;LHSC = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>);</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;RHSC = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LHSC-&gt;<a href="/docs/api/classes/llvm/constantint/#a31e8da5adf63afd38b4ab94bca823150">getLimitedValue</a>() &lt; RHSC-&gt;<a href="/docs/api/classes/llvm/constantint/#a31e8da5adf63afd38b4ab94bca823150">getLimitedValue</a>();</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186" lineLink="/docs/api/structs/llvm/outlinableregion/#a7e03ba3e02776435b130c487f13289be"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/llvm/outlinableregion/#a7e03ba3e02776435b130c487f13289be">OutlinableRegion::findCorrespondingValueIn</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/outlinableregion/#ad3f327e6f6a42e9b7729a16fbba4bc58">OutlinableRegion</a> &amp;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>,</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">                                                  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; GVN = <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;getGVN(V);</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GVN &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No GVN for incoming value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; CanonNum = <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;getCanonicalNum(&#42;GVN);</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; FirstGVN =</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.Candidate-&gt;fromCanonicalNum(&#42;CanonNum);</span></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">  std::optional&lt;Value &#42;&gt; FoundValueOpt = <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.Candidate-&gt;fromGVN(&#42;FirstGVN);</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FoundValueOpt.value&#95;or(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198" lineLink="/docs/api/structs/llvm/outlinableregion/#a84b80673b9748e75da40fa84cca3a630"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/outlinableregion/#a84b80673b9748e75da40fa84cca3a630">OutlinableRegion::findCorrespondingBlockIn</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/outlinableregion/#ad3f327e6f6a42e9b7729a16fbba4bc58">OutlinableRegion</a> &amp;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>,</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;FirstNonPHI = &amp;&#42;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a50909227135ef69932bff39b8ea3f572">getFirstNonPHIOrDbg</a>();</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FirstNonPHI &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;block is empty?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CorrespondingVal = <a href="/docs/api/structs/llvm/outlinableregion/#a7e03ba3e02776435b130c487f13289be">findCorrespondingValueIn</a>(<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>, FirstNonPHI);</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CorrespondingVal)</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CorrespondingBlock =</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(CorrespondingVal)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CorrespondingBlock;</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlightComment">/// Rewrite the BranchInsts in the incoming blocks to \\p PHIBlock that are found</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlightComment">/// in \\p Included to branch to BasicBlock \\p Replace if they currently branch</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlightComment">/// to the BasicBlock \\p Find.  This is used to fix up the incoming basic blocks</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlightComment">/// when PHINodes are included in outlined regions.</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlightComment">/// \\param PHIBlock - The BasicBlock containing the PHINodes that need to be</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlightComment">/// checked.</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlightComment">/// \\param Find - The successor block to be replaced.</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlightComment">/// \\param Replace - The new succesor block to branch to.</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlightComment">/// \\param Included - The set of blocks about to be outlined.</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220" lineLink="#a8e5c4577c64728c435eca5f4f7e163ab"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a8e5c4577c64728c435eca5f4f7e163ab">replaceTargetsFromPHINode</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PHIBlock, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/mc/mcsubtargetinfo-cpp/#a08e140d603b53c440c54cffc85131c8f">Find</a>,</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Replace,</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> &amp;Included) &#123;</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : PHIBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0, PNEnd = PN.getNumIncomingValues(); Idx != PNEnd;</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">         ++Idx) &#123;</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check if the incoming block is included in the set of blocks being</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// outlined.</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/llvm/incoming">Incoming</a> = PN.getIncomingBlock(Idx);</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Included.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>))</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>-&gt;getTerminator());</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Not a branch instruction?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Look over the branching instructions into this block to see if we</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// used to branch to Find in this outlined block.</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Succ = 0, End = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a96b8f11f6f21ca0321294669dab83b35">getNumSuccessors</a>(); Succ != End;</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">           Succ++) &#123;</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If we have found the block to replace, we do so here.</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(Succ) != <a href="/docs/api/files/lib/lib/mc/mcsubtargetinfo-cpp/#a08e140d603b53c440c54cffc85131c8f">Find</a>)</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">        BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(Succ, Replace);</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248" lineLink="/docs/api/structs/llvm/outlinableregion/#a761b3c02cd196cb5f6fb019bcd86866e"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/outlinableregion/#a761b3c02cd196cb5f6fb019bcd86866e">OutlinableRegion::splitCandidate</a>() &#123;</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/structs/llvm/outlinableregion/#a6a1b95a7f7c90784102fd63ffaa0ea00">CandidateSplit</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Candidate already split!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;BackInst = <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;backInstruction();</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;EndInst = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check whether the last instruction is a terminator, if it is, we do</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// not split on the following instruction. We leave the block as it is.  We</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// also check that this is not the last instruction in the Module, otherwise</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the check for whether the current following instruction matches the</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// previously recorded instruction will be incorrect.</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BackInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a7653277511df1034148a37520a585bb5">isTerminator</a>() ||</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">      BackInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != &amp;BackInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a43b79a254fba6ce00adf5b963382a0a4">back</a>()) &#123;</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">    EndInst = <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;end()-&gt;Inst;</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndInst &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected an end instruction?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We check if the current instruction following the last instruction in the</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// region is the same as the recorded instruction following the last</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction. If they do not match, there could be problems in rewriting</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the program after outlining, so we ignore it.</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BackInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a7653277511df1034148a37520a585bb5">isTerminator</a>() &amp;&amp;</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">      EndInst != BackInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a91bd28adea418a08cec78b72413d9d45">getNextNonDebugInstruction</a>())</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;StartInst = (&#42;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;begin()).Inst;</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StartInst &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected a start instruction?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a> = StartInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a> = <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>;</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> BBSet;</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;getBasicBlocks(BBSet);</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We iterate over the instructions in the region, if we find a PHINode, we</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// check if there are predecessors outside of the region, if there are,</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we ignore this region since we are unable to handle the severing of the</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// phi node right now.</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Handle extraneous inputs for PHINodes through variable number of</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// inputs, similar to how outputs are handled.</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> It = StartInst-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a> = BackInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IBlock;</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PHIPredBlock = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EndBBTermAndBackInstDifferent = <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>-&gt;getTerminator() != BackInst;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;&#42;It)) &#123;</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumPredsOutsideRegion = 0;</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0, e = PN-&gt;getNumIncomingValues(); i != e; ++i) &#123;</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BBSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(PN-&gt;getIncomingBlock(i))) &#123;</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">        PHIPredBlock = PN-&gt;getIncomingBlock(i);</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">        ++NumPredsOutsideRegion;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We must consider the case there the incoming block to the PHINode is</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the same as the final block of the OutlinableRegion.  If this is the</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// case, the branch from this block must also be outlined to be valid.</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">      IBlock = PN-&gt;getIncomingBlock(i);</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IBlock == <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a> &amp;&amp; EndBBTermAndBackInstDifferent) &#123;</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">        PHIPredBlock = PN-&gt;getIncomingBlock(i);</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">        ++NumPredsOutsideRegion;</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumPredsOutsideRegion &gt; 1)</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">    </span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">    It++;</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the region starts with a PHINode, but is not the initial instruction of</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the BasicBlock, we ignore this region for now.</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(StartInst) &amp;&amp; StartInst != &amp;&#42;<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>-&gt;begin())</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the region ends with a PHINode, but does not contain all of the phi node</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions of the region, we ignore it for now.</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(BackInst) &amp;&amp;</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">      BackInst != &amp;&#42;std::prev(<a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>-&gt;getFirstInsertionPt()))</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The basic block gets split like so:</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block:                 block:</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   inst1                  inst1</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   inst2                  inst2</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   region1               br block&#95;to&#95;outline</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   region2              block&#95;to&#95;outline:</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   region3          -&gt;    region1</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   region4                region2</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   inst3                  region3</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   inst4                  region4</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                          br block&#95;after&#95;outline</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                        block&#95;after&#95;outline:</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                          inst3</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//                          inst4</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">  std::string OriginalName = <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;getName().str();</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a> = <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;splitBasicBlock(StartInst, OriginalName + </span><span class="doxyHighlightStringLiteral">&quot;&#95;to&#95;outline&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;replaceSuccessorsPhiUsesWith(<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>);</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there was a PHINode with an incoming block outside the region,</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// make sure is correctly updated in the newly split block.</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PHIPredBlock)</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;replaceSuccessorsPhiUsesWith(PHIPredBlock, <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>);</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#a6a1b95a7f7c90784102fd63ffaa0ea00">CandidateSplit</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BackInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a7653277511df1034148a37520a585bb5">isTerminator</a>()) &#123;</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a> = EndInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a> = <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>-&gt;splitBasicBlock(EndInst, OriginalName + </span><span class="doxyHighlightStringLiteral">&quot;&#95;after&#95;outline&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>-&gt;replaceSuccessorsPhiUsesWith(<a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>);</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>-&gt;replaceSuccessorsPhiUsesWith(<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>);</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a> = BackInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/outlinableregion/#ad9bf08399ff5638f26f2f4eac57e03b2">EndsInBranch</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Refind the basic block set.</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">  BBSet.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a16413f1a88d8baca228d0a1b4cc0bfc6">clear</a>();</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;getBasicBlocks(BBSet);</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For the phi nodes in the new starting basic block of the region, we</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reassign the targets of the basic blocks branching instructions.</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlight">  <a href="#a8e5c4577c64728c435eca5f4f7e163ab">replaceTargetsFromPHINode</a>(<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>, BBSet);</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>)</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">    <a href="#a8e5c4577c64728c435eca5f4f7e163ab">replaceTargetsFromPHINode</a>(<a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>, BBSet);</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375" lineLink="/docs/api/structs/llvm/outlinableregion/#af5d7aa7988108e9377f154cf6a22f02b"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/outlinableregion/#af5d7aa7988108e9377f154cf6a22f02b">OutlinableRegion::reattachCandidate</a>() &#123;</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/outlinableregion/#a6a1b95a7f7c90784102fd63ffaa0ea00">CandidateSplit</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Candidate is not split!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The basic block gets reattached like so:</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block:                        block:</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   inst1                         inst1</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   inst2                         inst2</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   br block&#95;to&#95;outline           region1</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block&#95;to&#95;outline:        -&gt;     region2</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   region1                       region3</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   region2                       region4</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   region3                       inst3</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   region4                       inst4</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   br block&#95;after&#95;outline</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block&#95;after&#95;outline:</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   inst3</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   inst4</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a> != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;StartBB for Candidate is not defined!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;getTerminator() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Terminator removed from PrevBB!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure PHINode references to the block we are merging into are</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// updated to be incoming blocks from the predecessor to the current block.</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NOTE: If this is updated such that the outlined block can have more than</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// one incoming block to a PHINode, this logic will have to updated</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to handle multiple precessors instead.</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We only need to update this if the outlined section contains a PHINode, if</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it does not, then the incoming block was never changed in the first place.</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// On the other hand, if PrevBB has no predecessors, it means that all</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// incoming blocks to the first block are contained in the region, and there</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will be nothing to update.</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;StartInst = (&#42;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;begin()).Inst;</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(StartInst) &amp;&amp; !<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;hasNPredecessors(0)) &#123;</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;hasNPredecessorsOrMore(2) &amp;&amp;</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;PrevBB has more than one predecessor. Should be 0 or 1.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BeforePrevBB = <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;getSinglePredecessor();</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;replaceSuccessorsPhiUsesWith(<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>, BeforePrevBB);</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;getTerminator()-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we reattaching after outlining, we iterate over the phi nodes to</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the initial block, and reassign the branch instructions of the incoming</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// blocks to the block we are remerging into.</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a>) &#123;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> BBSet;</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;getBasicBlocks(BBSet);</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">    <a href="#a8e5c4577c64728c435eca5f4f7e163ab">replaceTargetsFromPHINode</a>(<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>, BBSet);</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/llvm/outlinableregion/#ad9bf08399ff5638f26f2f4eac57e03b2">EndsInBranch</a>)</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">      <a href="#a8e5c4577c64728c435eca5f4f7e163ab">replaceTargetsFromPHINode</a>(<a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>, BBSet);</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">  <a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">moveBBContents</a>(&#42;<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>, &#42;<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>);</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PlacementBB = <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>;</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a> != <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>)</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">    PlacementBB = <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>;</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/llvm/outlinableregion/#ad9bf08399ff5638f26f2f4eac57e03b2">EndsInBranch</a> &amp;&amp; PlacementBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a57f1945911ca1e95d0f51d7c3516b529">getUniqueSuccessor</a>() != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a> != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;FollowBB for Candidate is not defined!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PlacementBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Terminator removed from EndBB!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">    PlacementBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">    <a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">moveBBContents</a>(&#42;<a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>, &#42;PlacementBB);</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">    PlacementBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a089e003bb688e55b9a91ed4e7fed3678">replaceSuccessorsPhiUsesWith</a>(<a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>, PlacementBB);</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;replaceSuccessorsPhiUsesWith(<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>);</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure to save changes back to the StartBB.</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a> = <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>;</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion/#a6a1b95a7f7c90784102fd63ffaa0ea00">CandidateSplit</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlightComment">/// Find whether \\p V matches the Constants previously found for the \\p GVN.</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlightComment">/// \\param V - The value to check for consistency.</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlightComment">/// \\param GVN - The global value number assigned to \\p V.</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlightComment">/// \\param GVNToConstant - The mapping of global value number to Constants.</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlightComment">/// \\returns true if the Value matches the Constant mapped to by V and false if</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlightComment">/// it \\p V is a Constant but does not match.</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlightComment">/// \\returns std::nullopt if \\p V is not a Constant.</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::optional&lt;bool&gt;</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463" lineLink="#ac77f2569521257316a0f374b9a2682c5"><span class="doxyHighlight"><a href="#ac77f2569521257316a0f374b9a2682c5">constantMatches</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> GVN,</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, Constant &#42;&gt;</a> &amp;GVNToConstant) &#123;</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See if we have a constants</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CST = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V);</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CST)</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Holds a mapping from a global value number to a Constant.</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, Constant &#42;&gt;::iterator</a> GVNToConstantIt;</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Inserted;</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have a constant, try to make a new entry in the GVNToConstant.</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">  std::tie(GVNToConstantIt, Inserted) =</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">      GVNToConstant.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make&#95;pair(GVN, CST));</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If it was found and is not equal, it is not the same. We do not</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// handle this case yet, and exit early.</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Inserted || (GVNToConstantIt-&gt;second == CST))</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486" lineLink="/docs/api/structs/llvm/outlinableregion/#a086b69a5012fff81b179e92d137aae33"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/structs/llvm/outlinableregion/#a086b69a5012fff81b179e92d137aae33">OutlinableRegion::getBenefit</a>(<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> Benefit = 0;</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Estimate the benefit of outlining a specific sections of the program.  We</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// delegate mostly this task to the TargetTransformInfo so that if the target</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// has specific changes, we can have a more accurate estimate.</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// However, getInstructionCost delegates the code size calculation for</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// arithmetic instructions to getArithmeticInstrCost in</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// include/Analysis/TargetTransformImpl.h, where it always estimates that the</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// code size for a division and remainder instruction to be equal to 4, and</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// everything else to 1  This is not an accurate representation of the</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// division instruction for targets that have a native division instruction.</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// To be overly conservative, we only add 1 to the number of instructions for</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// each division instruction.</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata">IRInstructionData</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> : &#42;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>) &#123;</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FDiv:</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FRem:</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SDiv:</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SRem:</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::UDiv:</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::URem:</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">      Benefit += 1;</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">      Benefit += <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getInstructionCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a>);</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Benefit;</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlightComment">/// Check the \\p OutputMappings structure for value \\p Input, if it exists</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlightComment">/// it has been used as an output for outlining, and has been renamed, and we</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlightComment">/// return the new value, otherwise, we return the same value.</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlightComment">/// \\param OutputMappings &#91;in&#93; - The mapping of values to their renamed value</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlightComment">/// after being used as an output for an outlined region.</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlightComment">/// \\param Input &#91;in&#93; - The value to find the remapped value of, if it exists.</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlightComment">/// \\return The remapped value if it has been renamed, and the same value if has</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlightComment">/// not.</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530" lineLink="#ab0d72084e637eaecbbadd192d547ef8e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#ab0d72084e637eaecbbadd192d547ef8e">findOutputMapping</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> OutputMappings,</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/input">Input</a>) &#123;</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;::const&#95;iterator</a> OutputMapping =</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">      OutputMappings.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/classes/input">Input</a>);</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OutputMapping != OutputMappings.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OutputMapping-&gt;second;</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/input">Input</a>;</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlightComment">/// Find whether \\p Region matches the global value numbering to Constant</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlightComment">/// mapping found so far.</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlightComment">/// \\param Region - The OutlinableRegion we are checking for constants</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlightComment">/// \\param GVNToConstant - The mapping of global value number to Constants.</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlightComment">/// \\param NotSame - The set of global value numbers that do not have the same</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlightComment">/// constant in each region.</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlightComment">/// \\returns true if all Constants are the same in every use of a Constant in \\p</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlightComment">/// Region and false if not</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549" lineLink="#a52a09c04ddc4ec6d039f1f11f01d019e"><span class="doxyHighlight"><a href="#a52a09c04ddc4ec6d039f1f11f01d019e">collectRegionsConstants</a>(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, Constant &#42;&gt;</a> &amp;GVNToConstant,</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> &amp;NotSame) &#123;</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ConstantsTheSame = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Candidate;</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata">IRInstructionData</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> : <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &#123;</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Iterate over the operands in an instruction. If the global value number,</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// assigned by the IRSimilarityCandidate, has been seen before, we check if</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the number has been found to be not the same value in each instance.</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.OperVals) &#123;</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">      std::optional&lt;unsigned&gt; GVNOpt = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getGVN(V);</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GVNOpt &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected a GVN for operand?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> GVN = &#42;GVNOpt;</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check if this global value has been found to not be the same already.</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NotSame.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(GVN)) &#123;</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V))</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">          ConstantsTheSame = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If it has been the same so far, we check the value for if the</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// associated Constant value match the previous instances of the same</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// global value number.  If the global value does not map to a Constant,</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// it is considered to not be the same value.</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">      std::optional&lt;bool&gt; ConstantMatches =</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">          <a href="#ac77f2569521257316a0f374b9a2682c5">constantMatches</a>(V, GVN, GVNToConstant);</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ConstantMatches) &#123;</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&#42;ConstantMatches)</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">          ConstantsTheSame = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// While this value is a register, it might not have been previously,</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// make sure we don&#39;t already have a constant mapped to this global value</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// number.</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GVNToConstant.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(GVN))</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">        ConstantsTheSame = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">      NotSame.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(GVN);</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ConstantsTheSame;</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598" lineLink="/docs/api/structs/outlinablegroup/#a61915f6a6a382f51fd1a8bf3dd188c0c"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/outlinablegroup/#a61915f6a6a382f51fd1a8bf3dd188c0c">OutlinableGroup::findSameConstants</a>(<a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> &amp;NotSame) &#123;</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, Constant &#42;&gt;</a> GVNToConstant;</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &#42;<a href="/docs/api/classes/llvm/region">Region</a> : <a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>)</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">    <a href="#a52a09c04ddc4ec6d039f1f11f01d019e">collectRegionsConstants</a>(&#42;<a href="/docs/api/classes/llvm/region">Region</a>, GVNToConstant, NotSame);</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605" lineLink="/docs/api/structs/outlinablegroup/#ad67fb96194cff11216803ad74dba5687"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/outlinablegroup/#ad67fb96194cff11216803ad74dba5687">OutlinableGroup::collectGVNStoreSets</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &#42;OS : <a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>)</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">    <a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>.insert(OS-&gt;GVNStores);</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are adding an extracted argument to decide between which output path</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to use in the basic block.  It is used in a switch statement and only</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// needs to be an integer.</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>.size() &gt; 1)</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">    <a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>.push&#95;back(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(M.getContext()));</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlightComment">/// Get the subprogram if it exists for one of the outlined regions.</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlightComment">/// \\param &#91;in&#93; Group - The set of regions to find a subprogram for.</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlightComment">/// \\returns the subprogram if it exists, or nullptr.</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620" lineLink="#aac5cfc936b6963f4e848982328d39e8e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;<a href="#aac5cfc936b6963f4e848982328d39e8e">getSubprogramOrNull</a>(<a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group) &#123;</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &#42;OS : Group.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>)</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a018669f7b1d6a21106f47398a087c30a">Call</a>-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>())</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;SP = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getSubprogram())</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SP;</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/function">Function</a> &#42;IROutliner::createFunction(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, OutlinableGroup &amp;Group,</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> FunctionNameSuffix) &#123;</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Function is already defined!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;RetTy = <a href="/docs/api/classes/llvm/type/#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext());</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All extracted functions &#95;should&#95; have the same return type at this point</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// since the similarity identifier ensures that all branches outside of the</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// region occur in the same place.</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NOTE: Should we ever move to the model that uses a switch at every point</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// needed, meaning that we could branch within the region or out, it is</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// possible that we will need to switch to using the most general case all of</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the time.</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (OutlinableRegion &#42;R : Group.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ExtractedFuncType = <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;ExtractedFunction-&gt;getReturnType();</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((RetTy-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>() &amp;&amp; !ExtractedFuncType-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>()) ||</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">        (RetTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>(1) &amp;&amp; ExtractedFuncType-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>(16)))</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">      RetTy = ExtractedFuncType;</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">  Group.<a href="/docs/api/structs/outlinablegroup/#aab2165e523387ae034bc2117b13c5d51">OutlinedFunctionType</a> = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">      RetTy, Group.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// These functions will only be called from within the same module, so</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we can set an internal linkage.</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">  Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> = <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">      Group.<a href="/docs/api/structs/outlinablegroup/#aab2165e523387ae034bc2117b13c5d51">OutlinedFunctionType</a>, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>,</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;outlined&#95;ir&#95;func&#95;&quot;</span><span class="doxyHighlight"> + std::to&#95;string(FunctionNameSuffix), M);</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Transfer the swifterr attribute to the correct function parameter.</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Group.<a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a>)</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">    Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(&#42;Group.<a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a>,</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">                                         Attribute::SwiftError);</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">  Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(Attribute::OptimizeForSize);</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">  Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(Attribute::MinSize);</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there&#39;s a DISubprogram associated with this outlined function, then</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// emit debug info for the outlined function.</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DISubprogram &#42;SP = <a href="#aac5cfc936b6963f4e848982328d39e8e">getSubprogramOrNull</a>(Group)) &#123;</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>;</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We have a DISubprogram. Get its DICompileUnit.</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">    DICompileUnit &#42;CU = SP-&gt;getUnit();</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">    DIBuilder <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>(M, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, CU);</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">    DIFile &#42;<a href="/docs/api/namespaces/anonymous-rustdemangle-cpp-/#a76a6de3bfe4b34e80479b5139aae1ab7a19c562a36aeb455d09534f93b4f5236f">Unit</a> = SP-&gt;getFile();</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">    Mangler Mg;</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Get the mangled name of the function for the linkage name.</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">    std::string <a href="/docs/api/namespaces/llvm/nvptxisd/#ab995b6d422b079c863075e073b2eb96ba7cff9cc4a40fe2b19129ee8e9b0ec645">Dummy</a>;</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">    llvm::raw&#95;string&#95;ostream MangledNameStream(Dummy);</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">    Mg.<a href="/docs/api/classes/llvm/mangler/#aa1c9296fd511eb96bb487befbf5e7cea">getNameWithPrefix</a>(MangledNameStream, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">    DISubprogram &#42;OutlinedSP = <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>.createFunction(</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">        Unit </span><span class="doxyHighlightComment">/&#42; Context &#42;/</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName(), Dummy, Unit </span><span class="doxyHighlightComment">/&#42; File &#42;/</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">        0 </span><span class="doxyHighlightComment">/&#42; Line 0 is reserved for compiler-generated code. &#42;/</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>.createSubroutineType(<a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>.getOrCreateTypeArray(&#123;&#125;)), </span><span class="doxyHighlightComment">/&#42; void type &#42;/</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">        0, </span><span class="doxyHighlightComment">/&#42; Line 0 is reserved for compiler-generated code. &#42;/</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">        DINode::DIFlags::FlagArtificial </span><span class="doxyHighlightComment">/&#42; Compiler-generated code. &#42;/</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42; Outlined code is optimized code by definition. &#42;/</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">        DISubprogram::SPFlagDefinition | DISubprogram::SPFlagOptimized);</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t add any new variables to the subprogram.</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>.finalizeSubprogram(OutlinedSP);</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Attach subprogram to the function.</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;setSubprogram(OutlinedSP);</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We&#39;re done with the DIBuilder.</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>.finalize();</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>;</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlightComment">/// Move each BasicBlock in \\p Old to \\p New.</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlightComment">/// \\param &#91;in&#93; Old - The function to move the basic blocks from.</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlightComment">/// \\param &#91;in&#93; New - The function to move the basic blocks to.</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlightComment">/// \\param &#91;out&#93; NewEnds - The return blocks of the new overall function.</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706" lineLink="#a4047976de351f78967fba27df7a6361f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a4047976de351f78967fba27df7a6361f">moveFunctionData</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;Old, <a href="/docs/api/classes/llvm/function">Function</a> &amp;New,</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;NewEnds) &#123;</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;CurrBB : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(Old)) &#123;</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">    CurrBB.removeFromParent();</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">    CurrBB.insertInto(&amp;New);</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = CurrBB.getTerminator();</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For each block we find a return instruction is, it is a potential exit</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// path for the function.  We keep track of each block based on the return</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value here.</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">      NewEnds.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make&#95;pair(RI-&gt;getReturnValue(), &amp;CurrBB));</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">    std::vector&lt;Instruction &#42;&gt; DebugInsts;</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Val : CurrBB) &#123;</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Since debug-info originates from many different locations in the</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// program, it will cause incorrect reporting from a debugger if we keep</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the same debug instructions. Drop non-intrinsic DbgVariableRecords</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// here, collect intrinsics for removal later.</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">      Val.dropDbgRecords();</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We must handle the scoping of called functions differently than</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// other outlined instructions.</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(&amp;Val)) &#123;</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Remove the debug information for outlined functions.</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">        Val.setDebugLoc(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Loop info metadata may contain line locations. Update them to have no</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// value in the new subprogram since the outlined code could be from</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// several locations.</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> updateLoopInfoLoc = &#91;&amp;New&#93;(<a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;MD) -&gt; <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42; &#123;</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;SP = New.getSubprogram())</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/loc">Loc</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;DILocation&gt;</a>(MD))</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DILocation::get</a>(New.getContext(), <a href="/docs/api/namespaces/llvm/loc">Loc</a>-&gt;getLine(),</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">                                     <a href="/docs/api/namespaces/llvm/loc">Loc</a>-&gt;getColumn(), SP, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MD;</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">        &#125;;</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#aecd4ed57fa6a20d048310d43f5c96da9">updateLoopMetadataDebugLocations</a>(Val, updateLoopInfoLoc);</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// From this point we are only handling call instructions.</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(&amp;Val);</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Collect debug intrinsics for later removal.</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(CI)) &#123;</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">        DebugInsts.push&#95;back(&amp;Val);</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Edit the scope of called functions inside of outlined functions.</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;SP = New.getSubprogram()) &#123;</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/dilocation">DILocation</a> &#42;DI = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DILocation::get</a>(New.getContext(), 0, 0, SP);</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">        Val.setDebugLoc(DI);</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DebugInsts)</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlightComment">/// Find the constants that will need to be lifted into arguments</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlightComment">/// as they are not the same in each instance of the region.</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlightComment">/// \\param &#91;in&#93; C - The IRSimilarityCandidate containing the region we are</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlightComment">/// analyzing.</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlightComment">/// \\param &#91;in&#93; NotSame - The set of global value numbers that do not have a</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlightComment">/// single Constant across all OutlinableRegions similar to \\p C.</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlightComment">/// \\param &#91;out&#93; Inputs - The list containing the global value numbers of the</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlightComment">/// arguments needed for the region of code.</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778" lineLink="#acda959f961048eba09125aba48d1142e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#acda959f961048eba09125aba48d1142e">findConstants</a>(<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> &amp;NotSame,</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">                          std::vector&lt;unsigned&gt; &amp;Inputs) &#123;</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> Seen;</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate over the instructions, and find what constants will need to be</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// extracted into arguments.</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (IRInstructionDataList::iterator IDIt = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.begin(), EndIDIt = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.end();</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">       IDIt != EndIDIt; IDIt++) &#123;</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : (&#42;IDIt).OperVals) &#123;</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Since these are stored before any outlining, they will be in the</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// global value numbering.</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> GVN = &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getGVN(V);</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V))</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NotSame.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(GVN) &amp;&amp; Seen.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(GVN).second)</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">          Inputs.push&#95;back(GVN);</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlightComment">/// Find the GVN for the inputs that have been found by the CodeExtractor.</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlightComment">/// \\param &#91;in&#93; C - The IRSimilarityCandidate containing the region we are</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlightComment">/// analyzing.</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlightComment">/// \\param &#91;in&#93; CurrentInputs - The set of inputs found by the</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlightComment">/// CodeExtractor.</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlightComment">/// \\param &#91;in&#93; OutputMappings - The mapping of values that have been replaced</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlightComment">/// by a new output value.</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlightComment">/// \\param &#91;out&#93; EndInputNumbers - The global value numbers for the extracted</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlightComment">/// arguments.</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806" lineLink="#a9165dd298666d75ed2e5be7d5d8b50e5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a9165dd298666d75ed2e5be7d5d8b50e5">mapInputsToGVNs</a>(<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>,</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;CurrentInputs,</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">                            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">                            std::vector&lt;unsigned&gt; &amp;EndInputNumbers) &#123;</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the Global Value Number for each input.  We check if the Value has been</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// replaced by a different value at output, and use the original value before</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// replacement.</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/input">Input</a> : CurrentInputs) &#123;</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/input">Input</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Have a nullptr as an input&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = OutputMappings.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/classes/input">Input</a>);</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It != OutputMappings.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">      <a href="/docs/api/classes/input">Input</a> = It-&gt;second;</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getGVN(<a href="/docs/api/classes/input">Input</a>) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Could not find a numbering for the given input&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">    EndInputNumbers.push&#95;back(&#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getGVN(<a href="/docs/api/classes/input">Input</a>));</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlightComment">/// Find the original value for the \\p ArgInput values if any one of them was</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlightComment">/// replaced during a previous extraction.</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlightComment">/// \\param &#91;in&#93; ArgInputs - The inputs to be extracted by the code extractor.</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlightComment">/// \\param &#91;in&#93; OutputMappings - The mapping of values that have been replaced</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlightComment">/// by a new output value.</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlightComment">/// \\param &#91;out&#93; RemappedArgInputs - The remapped values according to</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlightComment">/// \\p OutputMappings that will be extracted.</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832" lineLink="#a09e9f16b4a1aaf539000b95bf5442155"><span class="doxyHighlight"><a href="#a09e9f16b4a1aaf539000b95bf5442155">remapExtractedInputs</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value &#42;&gt;</a> ArgInputs,</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;RemappedArgInputs) &#123;</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the global value number for each input that will be extracted as an</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// argument by the code extractor, remapping if needed for reloaded values.</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/input">Input</a> : ArgInputs) &#123;</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = OutputMappings.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/classes/input">Input</a>);</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It != OutputMappings.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">      <a href="/docs/api/classes/input">Input</a> = It-&gt;second;</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">    RemappedArgInputs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/classes/input">Input</a>);</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlightComment">/// Find the input GVNs and the output values for a region of Instructions.</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlightComment">/// Using the code extractor, we collect the inputs to the extracted function.</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlightComment">/// The \\p Region can be identified as needing to be ignored in this function.</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlightComment">/// It should be checked whether it should be ignored after a call to this</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlightComment">/// function.</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlightComment">/// \\param &#91;in,out&#93; Region - The region of code to be analyzed.</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlightComment">/// \\param &#91;out&#93; InputGVNs - The global value numbers for the extracted</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlightComment">/// arguments.</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlightComment">/// \\param &#91;in&#93; NotSame - The global value numbers in the region that do not</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlightComment">/// have the same constant value in the regions structurally similar to</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlightComment">/// \\p Region.</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlightComment">/// \\param &#91;in&#93; OutputMappings - The mapping of values that have been replaced</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlightComment">/// by a new output value after extraction.</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlightComment">/// \\param &#91;out&#93; ArgInputs - The values of the inputs to the extracted function.</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlightComment">/// \\param &#91;out&#93; Outputs - The set of values extracted by the CodeExtractor</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlightComment">/// as outputs.</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863" lineLink="#a48d81e3f58b8db143bc85763d25dbc7a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a48d81e3f58b8db143bc85763d25dbc7a">getCodeExtractorArguments</a>(</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>, std::vector&lt;unsigned&gt; &amp;InputGVNs,</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> &amp;NotSame, <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;ArgInputs, <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;Outputs) &#123;</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Candidate;</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OverallInputs are the inputs to the region found by the CodeExtractor,</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SinkCands and HoistCands are used by the CodeExtractor to find sunken</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allocas of values whose lifetimes are contained completely within the</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// outlined region. PremappedInputs are the arguments found by the</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// CodeExtractor, removing conditions such as sunken allocas, but that</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// may need to be remapped due to the extracted output values replacing</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the original values. We use DummyOutputs for this first run of finding</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// inputs and outputs since the outputs could change during findAllocas,</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the correct set of extracted outputs will be in the final Outputs ValueSet.</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> OverallInputs, PremappedInputs, SinkCands, HoistCands,</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">      DummyOutputs;</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use the code extractor to get the inputs and outputs, without sunken</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allocas or removing llvm.assumes.</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a> &#42;CE = <a href="/docs/api/classes/llvm/region">Region</a>.CE;</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">  CE-&gt;findInputsOutputs(OverallInputs, DummyOutputs, SinkCands);</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/region">Region</a>.StartBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Region must have a start BasicBlock!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;OrigF = <a href="/docs/api/classes/llvm/region">Region</a>.StartBB-&gt;<a href="/docs/api/classes/llvm/regionbase/#a7ed9c79ac80ed5996c7e241814302eab">getParent</a>();</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/codeextractoranalysiscache">CodeExtractorAnalysisCache</a> CEAC(&#42;OrigF);</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dummy = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The region may be ineligible due to VarArgs in the parent function. In this</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// case we ignore the region.</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CE-&gt;isEligible()) &#123;</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/region">Region</a>.IgnoreRegion = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find if any values are going to be sunk into the function when extracted</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">  CE-&gt;findAllocas(CEAC, SinkCands, HoistCands, Dummy);</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">  CE-&gt;findInputsOutputs(PremappedInputs, Outputs, SinkCands);</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Support regions with sunken allocas: values whose lifetimes are</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// contained completely within the outlined region.  These are not guaranteed</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to be the same in every region, so we must elevate them all to arguments</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// when they appear.  If these values are not equal, it means there is some</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Input in OverallInputs that was removed for ArgInputs.</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OverallInputs.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>() != PremappedInputs.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>()) &#123;</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/region">Region</a>.IgnoreRegion = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">  <a href="#acda959f961048eba09125aba48d1142e">findConstants</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, NotSame, InputGVNs);</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">  <a href="#a9165dd298666d75ed2e5be7d5d8b50e5">mapInputsToGVNs</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, OverallInputs, OutputMappings, InputGVNs);</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">  <a href="#a09e9f16b4a1aaf539000b95bf5442155">remapExtractedInputs</a>(PremappedInputs.<a href="/docs/api/classes/llvm/setvector/#a0c7d0dae14eb8a5916fff9f72d8b46d2">getArrayRef</a>(), OutputMappings,</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">                       ArgInputs);</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sort the GVNs, since we now have constants included in the \\ref InputGVNs</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we need to make sure they are in a deterministic order.</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">stable&#95;sort</a>(InputGVNs);</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlightComment">/// Look over the inputs and map each input argument to an argument in the</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlightComment">/// overall function for the OutlinableRegions.  This creates a way to replace</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlightComment">/// the arguments of the extracted function with the arguments of the new</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlightComment">/// overall function.</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlightComment">/// \\param &#91;in,out&#93; Region - The region of code to be analyzed.</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlightComment">/// \\param &#91;in&#93; InputGVNs - The global value numbering of the input values</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlightComment">/// collected.</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlightComment">/// \\param &#91;in&#93; ArgInputs - The values of the arguments to the extracted</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlightComment">/// function.</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934" lineLink="#a9148948069532c9a5e1b59e3668b8cc3"><span class="doxyHighlight"><a href="#a9148948069532c9a5e1b59e3668b8cc3">findExtractedInputToOverallInputMapping</a>(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">                                        std::vector&lt;unsigned&gt; &amp;InputGVNs,</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;ArgInputs) &#123;</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Candidate;</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This counts the argument number in the overall function.</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TypeIndex = 0;</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This counts the argument number in the extracted function.</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OriginalIndex = 0;</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find the mapping of the extracted arguments to the arguments for the</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// overall function. Since there may be extra arguments in the overall</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function to account for the extracted constants, we have two different</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// counters as we find extracted arguments, and as we come across overall</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// arguments.</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Additionally, in our first pass, for the first extracted function,</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we find argument locations for the canonical value numbering.  This</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// numbering overrides any discovered location for the extracted code.</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> InputVal : InputGVNs) &#123;</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">    std::optional&lt;unsigned&gt; CanonicalNumberOpt = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getCanonicalNum(InputVal);</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CanonicalNumberOpt &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Canonical number not found?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CanonicalNumber = &#42;CanonicalNumberOpt;</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">    std::optional&lt;Value &#42;&gt; InputOpt = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.fromGVN(InputVal);</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InputOpt &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Global value number not found?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/input">Input</a> = &#42;InputOpt;</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, unsigned&gt;::iterator</a> AggArgIt =</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">        Group.<a href="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25">CanonicalNumberToAggArg</a>.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(CanonicalNumber);</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Group.<a href="/docs/api/structs/outlinablegroup/#a9fabb6e6f74e4ef23575f45ea098b827">InputTypesSet</a>) &#123;</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">      Group.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>.push&#95;back(<a href="/docs/api/classes/input">Input</a>-&gt;getType());</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the input value has a swifterr attribute, make sure to mark the</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// argument in the overall function.</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/input">Input</a>-&gt;isSwiftError()) &#123;</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">            !Group.<a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a> &amp;&amp;</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">            </span><span class="doxyHighlightStringLiteral">&quot;Argument already marked with swifterr for this OutlinableGroup!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">        Group.<a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a> = TypeIndex;</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if we have a constant. If we do add it to the overall argument</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// number to Constant map for the region, and continue to the next input.</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CST = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(<a href="/docs/api/classes/input">Input</a>)) &#123;</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AggArgIt != Group.<a href="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25">CanonicalNumberToAggArg</a>.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant.insert(std::make&#95;pair(AggArgIt-&gt;second, CST));</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">        Group.<a href="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25">CanonicalNumberToAggArg</a>.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">            std::make&#95;pair(CanonicalNumber, TypeIndex));</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant.insert(std::make&#95;pair(TypeIndex, CST));</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">      TypeIndex++;</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// It is not a constant, we create the mapping from extracted argument list</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to the overall argument list, using the canonical location, if it exists.</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ArgInputs.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(<a href="/docs/api/classes/input">Input</a>) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Input cannot be found!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AggArgIt != Group.<a href="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25">CanonicalNumberToAggArg</a>.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OriginalIndex != AggArgIt-&gt;second)</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/region">Region</a>.ChangedArgOrder = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedArgToAgg.insert(</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">          std::make&#95;pair(OriginalIndex, AggArgIt-&gt;second));</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.insert(</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">          std::make&#95;pair(AggArgIt-&gt;second, OriginalIndex));</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">      Group.<a href="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25">CanonicalNumberToAggArg</a>.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">          std::make&#95;pair(CanonicalNumber, TypeIndex));</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedArgToAgg.insert(std::make&#95;pair(OriginalIndex, TypeIndex));</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.insert(std::make&#95;pair(TypeIndex, OriginalIndex));</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">    OriginalIndex++;</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">    TypeIndex++;</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the function type definitions for the OutlinableGroup holding the region</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have not been set, set the length of the inputs here.  We should have the</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// same inputs for all of the different regions contained in the</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OutlinableGroup since they are all structurally similar to one another.</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Group.<a href="/docs/api/structs/outlinablegroup/#a9fabb6e6f74e4ef23575f45ea098b827">InputTypesSet</a>) &#123;</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">    Group.<a href="/docs/api/structs/outlinablegroup/#aeab6020692f93361cff45734711204fc">NumAggregateInputs</a> = TypeIndex;</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">    Group.<a href="/docs/api/structs/outlinablegroup/#a9fabb6e6f74e4ef23575f45ea098b827">InputTypesSet</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/region">Region</a>.NumExtractedInputs = OriginalIndex;</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlightComment">/// Check if the \\p V has any uses outside of the region other than \\p PN.</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlightComment">/// \\param V &#91;in&#93; - The value to check.</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlightComment">/// \\param PHILoc &#91;in&#93; - The location in the PHINode of \\p V.</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlightComment">/// \\param PN &#91;in&#93; - The PHINode using \\p V.</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlightComment">/// \\param Exits &#91;in&#93; - The potential blocks we exit to from the outlined</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlightComment">/// region.</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlightComment">/// \\param BlocksInRegion &#91;in&#93; - The basic blocks contained in the region.</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlightComment">/// \\returns true if \\p V has any use soutside its region other than \\p PN.</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036" lineLink="#a84e785627d5ab55370b5fa402ad7193f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a84e785627d5ab55370b5fa402ad7193f">outputHasNonPHI</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PHILoc, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN,</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 1&gt;</a> &amp;Exits,</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> &amp;BlocksInRegion) &#123;</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We check to see if the value is used by the PHINode from some other</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predecessor not included in the region.  If it is, we make sure</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to keep it as an output.</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/namespaces/llvm/#adc4eb8be6f7a12ede962987fb9cabb47">llvm::seq&lt;unsigned&gt;</a>(0, PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>()),</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">             &#91;PHILoc, &amp;PN, V, &amp;BlocksInRegion&#93;(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx) &#123;</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">               return (Idx != PHILoc &amp;&amp; V == PN.getIncomingValue(Idx) &amp;&amp;</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">                       !BlocksInRegion.contains(PN.getIncomingBlock(Idx)));</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">             &#125;))</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if the value is used by any other instructions outside the region.</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(V-&gt;users(), &#91;&amp;Exits, &amp;BlocksInRegion&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">    Instruction &#42;I = dyn&#95;cast&lt;Instruction&gt;(U);</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">    if (!I)</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">      return false;</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the use of the item is inside the region, we skip it.  Uses</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// inside the region give us useful information about how the item could be</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// used as an output.</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">    BasicBlock &#42;Parent = I-&gt;getParent();</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">    if (BlocksInRegion.contains(Parent))</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">      return false;</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If it&#39;s not a PHINode then we definitely know the use matters.  This</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// output value will not completely combined with another item in a PHINode</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as it is directly reference by another non-phi instruction</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">    if (!isa&lt;PHINode&gt;(I))</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">      return true;</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have a PHINode outside one of the exit locations, then it</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// can be considered an outside use as well.  If there is a PHINode</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// contained in the Exit where this values use matters, it will be</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// caught when we analyze that PHINode.</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">    if (!Exits.contains(Parent))</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">      return true;</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">    return false;</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlightComment">/// Test whether \\p CurrentExitFromRegion contains any PhiNodes that should be</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlightComment">/// considered outputs. A PHINodes is an output when more than one incoming</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlightComment">/// value has been marked by the CodeExtractor as an output.</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlightComment">/// \\param CurrentExitFromRegion &#91;in&#93; - The block to analyze.</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlightComment">/// \\param PotentialExitsFromRegion &#91;in&#93; - The potential exit blocks from the</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlightComment">/// region.</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlightComment">/// \\param RegionBlocks &#91;in&#93; - The basic blocks in the region.</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlightComment">/// \\param Outputs &#91;in, out&#93; - The existing outputs for the region, we may add</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlightComment">/// PHINodes to this as we find that they replace output values.</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlightComment">/// \\param OutputsReplacedByPHINode &#91;out&#93; - A set containing outputs that are</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlightComment">/// totally replaced  by a PHINode.</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlightComment">/// \\param OutputsWithNonPhiUses &#91;out&#93; - A set containing outputs that are used</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlightComment">/// in PHINodes, but have other uses, and should still be considered outputs.</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093" lineLink="#a882dcfc2455d525e78a8bbf46863ace2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a882dcfc2455d525e78a8bbf46863ace2">analyzeExitPHIsForOutputUses</a>(</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CurrentExitFromRegion,</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 1&gt;</a> &amp;PotentialExitsFromRegion,</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> &amp;RegionBlocks, <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;Outputs,</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Value &#42;&gt;</a> &amp;OutputsReplacedByPHINode,</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Value &#42;&gt;</a> &amp;OutputsWithNonPhiUses) &#123;</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : CurrentExitFromRegion-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Find all incoming values from the outlining region.</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;unsigned, 2&gt;</a> IncomingVals;</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = PN.getNumIncomingValues(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RegionBlocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(PN.getIncomingBlock(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)))</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">        IncomingVals.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not process PHI if there are no predecessors from region.</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumIncomingVals = IncomingVals.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumIncomingVals == 0)</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there is one predecessor, we mark it as a value that needs to be kept</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as an output.</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NumIncomingVals == 1) &#123;</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = PN.getIncomingValue(&#42;IncomingVals.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>());</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">      OutputsWithNonPhiUses.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(V);</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">      OutputsReplacedByPHINode.<a href="/docs/api/classes/llvm/detail/densesetimpl/#af972d87e15b5f6ed61bd5c3956c5213d">erase</a>(V);</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This PHINode will be used as an output value, so we add it to our list.</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">    Outputs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(&amp;PN);</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Not all of the incoming values should be ignored as other inputs and</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// outputs may have uses in outlined region.  If they have other uses</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// outside of the single PHINode we should not skip over it.</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx : IncomingVals) &#123;</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = PN.getIncomingValue(Idx);</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a84e785627d5ab55370b5fa402ad7193f">outputHasNonPHI</a>(V, Idx, PN, PotentialExitsFromRegion, RegionBlocks)) &#123;</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">        OutputsWithNonPhiUses.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(V);</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">        OutputsReplacedByPHINode.<a href="/docs/api/classes/llvm/detail/densesetimpl/#af972d87e15b5f6ed61bd5c3956c5213d">erase</a>(V);</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OutputsWithNonPhiUses.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(V))</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">        OutputsReplacedByPHINode.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(V);</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlightComment">// Represents the type for the unsigned number denoting the output number for</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlightComment">// phi node, along with the canonical number for the exit block.</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141" lineLink="#ad0fabe111fc0db047a04c21481fa6aab"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="#ad0fabe111fc0db047a04c21481fa6aab">ArgLocWithBBCanon</a> = std::pair&lt;unsigned, unsigned&gt;;</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlightComment">// The list of canonical numbers for the incoming values to a PHINode.</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143" lineLink="#a69893e3a4e9fbee5b5aa9ac4b036dc5c"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="#a69893e3a4e9fbee5b5aa9ac4b036dc5c">CanonList</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;unsigned, 2&gt;</a>;</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlightComment">// The pair type representing the set of canonical values being combined in the</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlightComment">// PHINode, along with the location data for the PHINode.</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146" lineLink="#a0389cc3001a985e14dcff4067684ad70"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="#a0389cc3001a985e14dcff4067684ad70">PHINodeData</a> = std::pair&lt;ArgLocWithBBCanon, CanonList&gt;;</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlightComment">/// Encode \\p PND as an integer for easy lookup based on the argument location,</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlightComment">/// the parent BasicBlock canonical numbering, and the canonical numbering of</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlightComment">/// the values stored in the PHINode.</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlightComment">/// \\param PND - The data to hash.</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlightComment">/// \\returns The hash code of \\p PND.</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154" lineLink="#a652d50395284a0dec463c533709bc231"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/hash-code">hash&#95;code</a> <a href="#a652d50395284a0dec463c533709bc231">encodePHINodeData</a>(<a href="#a0389cc3001a985e14dcff4067684ad70">PHINodeData</a> &amp;PND) &#123;</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#add71474638430694c84640146383fc44">llvm::hash&#95;combine</a>(</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a0e2e479cf4860dc8a00614e36ee3d5e9">llvm::hash&#95;value</a>(PND.first.first), <a href="/docs/api/namespaces/llvm/#a0e2e479cf4860dc8a00614e36ee3d5e9">llvm::hash&#95;value</a>(PND.first.second),</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#af80edfc5e42059e045aa7bf7fe42bee3">llvm::hash&#95;combine&#95;range</a>(PND.second.begin(), PND.second.end()));</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlightComment">/// Create a special GVN for PHINodes that will be used outside of</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlightComment">/// the region.  We create a hash code based on the Canonical number of the</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlightComment">/// parent BasicBlock, the canonical numbering of the values stored in the</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlightComment">/// PHINode and the aggregate argument location.  This is used to find whether</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlightComment">/// this PHINode type has been given a canonical numbering already.  If not, we</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlightComment">/// assign it a value and store it for later use.  The value is returned to</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlightComment">/// identify different output schemes for the set of regions.</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlightComment">/// \\param Region - The region that \\p PN is an output for.</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlightComment">/// \\param PN - The PHINode we are analyzing.</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlightComment">/// \\param Blocks - The blocks for the region we are analyzing.</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlightComment">/// \\param AggArgIdx - The argument \\p PN will be stored into.</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlightComment">/// \\returns An optional holding the assigned canonical number, or std::nullopt</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlightComment">/// if there is some attribute of the PHINode blocking it from being used.</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174" lineLink="#a1c7b2c4c8824cfb8d35c97f6923c3fe2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::optional&lt;unsigned&gt; <a href="#a1c7b2c4c8824cfb8d35c97f6923c3fe2">getGVNForPHINode</a>(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN,</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> &amp;Blocks,</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">                                                </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AggArgIdx) &#123;</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;Cand = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Candidate;</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PHIBB = PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">  <a href="#a69893e3a4e9fbee5b5aa9ac4b036dc5c">CanonList</a> PHIGVNs;</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/llvm/incoming">Incoming</a>;</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IncomingBlock;</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0, EIdx = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); Idx &lt; EIdx; Idx++) &#123;</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/incoming">Incoming</a> = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(Idx);</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">    IncomingBlock = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(Idx);</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we cannot find a GVN, and the incoming block is included in the region</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this means that the input to the PHINode is not included in the region we</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// are trying to analyze, meaning, that if it was outlined, we would be</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// adding an extra input.  We ignore this case for now, and so ignore the</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// region.</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">    std::optional&lt;unsigned&gt; OGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a3ffe65f27fa3355ffd96fbcd0bb1cbb9">getGVN</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OGVN &amp;&amp; Blocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(IncomingBlock)) &#123;</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/region">Region</a>.IgnoreRegion = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the incoming block isn&#39;t in the region, we don&#39;t have to worry about</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this incoming value.</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Blocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(IncomingBlock))</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Collect the canonical numbers of the values in the PHINode.</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> GVN = &#42;OGVN;</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">    OGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ae6b404a6e77e0349378afa8ae7ce0e4a">getCanonicalNum</a>(GVN);</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OGVN &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No GVN found for incoming value?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlight">    PHIGVNs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#42;OGVN);</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Find the incoming block and use the canonical numbering as well to define</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the hash for the PHINode.</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">    OGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a3ffe65f27fa3355ffd96fbcd0bb1cbb9">getGVN</a>(IncomingBlock);</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there is no number for the incoming block, it is because we have</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// split the candidate basic blocks.  So we use the previous block that it</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// was split from to find the valid global value numbering for the PHINode.</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OGVN) &#123;</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ae22d915fa9ab51e40345773c663ebdeb">getStartBB</a>() == IncomingBlock &amp;&amp;</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Unknown basic block used in exit path PHINode.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PrevBlock = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Iterate over the predecessors to the incoming block of the</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// PHINode, when we find a block that is not contained in the region</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we know that this is the first block that we split from, and should</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// have a valid global value numbering.</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(IncomingBlock))</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Blocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(Pred)) &#123;</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">          PrevBlock = Pred;</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PrevBlock &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected a predecessor not in the reigon!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">      OGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a3ffe65f27fa3355ffd96fbcd0bb1cbb9">getGVN</a>(PrevBlock);</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">    GVN = &#42;OGVN;</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">    OGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ae6b404a6e77e0349378afa8ae7ce0e4a">getCanonicalNum</a>(GVN);</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OGVN &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No GVN found for incoming block?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">    PHIGVNs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#42;OGVN);</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we have the GVNs for the incoming values, we are going to combine</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them with the GVN of the incoming bock, and the output location of the</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHINode to generate a hash value representing this instance of the PHINode.</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;hash&#95;code, unsigned&gt;::iterator</a> GVNToPHIIt;</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, PHINodeData&gt;::iterator</a> PHIToGVNIt;</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; BBGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a3ffe65f27fa3355ffd96fbcd0bb1cbb9">getGVN</a>(PHIBB);</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BBGVN &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Could not find GVN for the incoming block!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">  BBGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ae6b404a6e77e0349378afa8ae7ce0e4a">getCanonicalNum</a>(&#42;BBGVN);</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BBGVN &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Could not find canonical number for the incoming block!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a pair of the exit block canonical value, and the aggregate</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// argument location, connected to the canonical numbers stored in the</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHINode.</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">  <a href="#a0389cc3001a985e14dcff4067684ad70">PHINodeData</a> TemporaryPair =</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">      std::make&#95;pair(std::make&#95;pair(&#42;BBGVN, AggArgIdx), PHIGVNs);</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/hash-code">hash&#95;code</a> PHINodeDataHash = <a href="#a652d50395284a0dec463c533709bc231">encodePHINodeData</a>(TemporaryPair);</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for and create a new entry in our connection between canonical</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// numbers for PHINodes, and the set of objects we just created.</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">  GVNToPHIIt = Group.<a href="/docs/api/structs/outlinablegroup/#a78f1513d0fadc0e72c1c7373c2003666">GVNsToPHINodeGVN</a>.find(PHINodeDataHash);</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GVNToPHIIt == Group.<a href="/docs/api/structs/outlinablegroup/#a78f1513d0fadc0e72c1c7373c2003666">GVNsToPHINodeGVN</a>.end()) &#123;</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Inserted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">    std::tie(PHIToGVNIt, Inserted) = Group.<a href="/docs/api/structs/outlinablegroup/#a704926b49e550b25585651aea32b389b">PHINodeGVNToGVNs</a>.insert(</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">        std::make&#95;pair(Group.<a href="/docs/api/structs/outlinablegroup/#a72b89466c3b2fd45331e2c315e2c33e5">PHINodeGVNTracker</a>, TemporaryPair));</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">    std::tie(GVNToPHIIt, Inserted) = Group.<a href="/docs/api/structs/outlinablegroup/#a78f1513d0fadc0e72c1c7373c2003666">GVNsToPHINodeGVN</a>.insert(</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">        std::make&#95;pair(PHINodeDataHash, Group.<a href="/docs/api/structs/outlinablegroup/#a72b89466c3b2fd45331e2c315e2c33e5">PHINodeGVNTracker</a>--));</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> GVNToPHIIt-&gt;second;</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlightComment">/// Create a mapping of the output arguments for the \\p Region to the output</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlightComment">/// arguments of the overall outlined function.</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlightComment">/// \\param &#91;in,out&#93; Region - The region of code to be analyzed.</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlightComment">/// \\param &#91;in&#93; Outputs - The values found by the code extractor.</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276" lineLink="#a4eb66b98a828331ed6cb79ae82c0336f"><span class="doxyHighlight"><a href="#a4eb66b98a828331ed6cb79ae82c0336f">findExtractedOutputToOverallOutputMapping</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;Outputs) &#123;</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Candidate;</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;&gt;</a> BE;</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> BlocksInRegion;</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getBasicBlocks(BlocksInRegion, BE);</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find the exits to the region.</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 1&gt;</a> Exits;</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : BE)</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>))</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BlocksInRegion.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(Succ))</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">        Exits.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Succ);</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// After determining which blocks exit to PHINodes, we add these PHINodes to</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the set of outputs to be processed.  We also check the incoming values of</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the PHINodes for whether they should no longer be considered outputs.</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Value &#42;&gt;</a> OutputsReplacedByPHINode;</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Value &#42;&gt;</a> OutputsWithNonPhiUses;</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBB : Exits)</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">    <a href="#a882dcfc2455d525e78a8bbf46863ace2">analyzeExitPHIsForOutputUses</a>(ExitBB, Exits, BlocksInRegion, Outputs,</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">                                 OutputsReplacedByPHINode,</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">                                 OutputsWithNonPhiUses);</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This counts the argument number in the extracted function.</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OriginalIndex = <a href="/docs/api/classes/llvm/region">Region</a>.NumExtractedInputs;</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This counts the argument number in the overall function.</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TypeIndex = Group.<a href="/docs/api/structs/outlinablegroup/#aeab6020692f93361cff45734711204fc">NumAggregateInputs</a>;</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> TypeFound;</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> AggArgsUsed;</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate over the output types and identify if there is an aggregate pointer</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// type whose base type matches the current output type. If there is, we mark</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that we will use this output register for this value. If not we add another</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// type to the overall argument type list. We also store the GVNs used for</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stores to identify which values will need to be moved into an special</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block that holds the stores to the output registers.</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;Output : Outputs) &#123;</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">    TypeFound = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We can do this since it is a result value, and will have a number</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that is necessarily the same. BUT if in the future, the instructions</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// do not have to be in same order, but are functionally the same, we will</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// have to use a different scheme, as one-to-one correspondence is not</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// guaranteed.</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ArgumentSize = Group.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>.size();</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the output is combined in a PHINode, we make sure to skip over it.</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OutputsReplacedByPHINode.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(Output))</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AggArgIdx = 0;</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Jdx = TypeIndex; Jdx &lt; ArgumentSize; Jdx++) &#123;</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PointerType&gt;</a>(Group.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>&#91;Jdx&#93;))</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AggArgsUsed.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(Jdx).second)</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">      TypeFound = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedArgToAgg.insert(std::make&#95;pair(OriginalIndex, Jdx));</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.insert(std::make&#95;pair(Jdx, OriginalIndex));</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">      AggArgIdx = Jdx;</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We were unable to find an unused type in the output type set that matches</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the output, so we add a pointer type to the argument types of the overall</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// function to handle this output and create a mapping to it.</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TypeFound) &#123;</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">      Group.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>.push&#95;back(<a href="/docs/api/classes/llvm/pointertype/#a8d7f800be5fd53dcfcdcbdc6fd9ccfe3">PointerType::get</a>(Output-&gt;getContext(),</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">          M.getDataLayout().getAllocaAddrSpace()));</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Mark the new pointer type as the last value in the aggregate argument</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// list.</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ArgTypeIdx = Group.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>.size() - 1;</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">      AggArgsUsed.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(ArgTypeIdx);</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedArgToAgg.insert(</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">          std::make&#95;pair(OriginalIndex, ArgTypeIdx));</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.insert(</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">          std::make&#95;pair(ArgTypeIdx, OriginalIndex));</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">      AggArgIdx = ArgTypeIdx;</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Adapt to the extra input from the PHINode.</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Output);</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">    std::optional&lt;unsigned&gt; GVN;</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PN &amp;&amp; !BlocksInRegion.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())) &#123;</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Values outside the region can be combined into PHINode when we</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// have multiple exits. We collect both of these into a list to identify</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// which values are being used in the PHINode. Each list identifies a</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// different PHINode, and a different output. We store the PHINode as it&#39;s</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// own canonical value.  These canonical values are also dependent on the</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// output argument it is saved to.</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If two PHINodes have the same canonical values, but different aggregate</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// argument locations, then they will have distinct Canonical Values.</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">      GVN = <a href="#a1c7b2c4c8824cfb8d35c97f6923c3fe2">getGVNForPHINode</a>(<a href="/docs/api/classes/llvm/region">Region</a>, PN, BlocksInRegion, AggArgIdx);</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!GVN)</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we do not have a PHINode we use the global value numbering for the</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// output value, to find the canonical number to add to the set of stored</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// values.</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">      GVN = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getGVN(Output);</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">      GVN = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getCanonicalNum(&#42;GVN);</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Each region has a potentially unique set of outputs.  We save which</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// values are output in a list of canonical values so we can differentiate</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// among the different store schemes.</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/region">Region</a>.GVNStores.push&#95;back(&#42;GVN);</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">    OriginalIndex++;</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">    TypeIndex++;</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We sort the stored values to make sure that we are not affected by analysis</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// order when determining what combination of items were stored.</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">stable&#95;sort</a>(<a href="/docs/api/classes/llvm/region">Region</a>.GVNStores);</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> IROutliner::findAddInputsOutputs(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> &amp;NotSame) &#123;</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><span class="doxyHighlight">  std::vector&lt;unsigned&gt; Inputs;</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">  SetVector&lt;Value &#42;&gt; ArgInputs, Outputs;</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">  <a href="#a48d81e3f58b8db143bc85763d25dbc7a">getCodeExtractorArguments</a>(Region, Inputs, NotSame, OutputMappings, ArgInputs,</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">                            Outputs);</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.IgnoreRegion)</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Map the inputs found by the CodeExtractor to the arguments found for</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the overall function.</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">  <a href="#a9148948069532c9a5e1b59e3668b8cc3">findExtractedInputToOverallInputMapping</a>(Region, Inputs, ArgInputs);</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Map the outputs found by the CodeExtractor to the arguments found for</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the overall function.</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">  <a href="#a4eb66b98a828331ed6cb79ae82c0336f">findExtractedOutputToOverallOutputMapping</a>(M, Region, Outputs);</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlightComment">/// Replace the extracted function in the Region with a call to the overall</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlightComment">/// function constructed from the deduplicated similar regions, replacing and</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlightComment">/// remapping the values passed to the extracted function as arguments to the</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlightComment">/// new arguments of the overall function.</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlightComment">/// \\param &#91;in&#93; M - The module to outline from.</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlightComment">/// \\param &#91;in&#93; Region - The regions of extracted code to be replaced with a new</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlightComment">/// function.</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlightComment">/// \\returns a call instruction with the replaced function.</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429" lineLink="#a7e2cad7ab18db9a3c940afc609c223dc"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="#a7e2cad7ab18db9a3c940afc609c223dc">replaceCalledFunction</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">  std::vector&lt;Value &#42;&gt; NewCallArgs;</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, unsigned&gt;::iterator</a> ArgPair;</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/classes/llvm/region">Region</a>.Call;</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Call to replace is nullptr?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;AggFunc = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>;</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AggFunc &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Function to replace with is nullptr?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the arguments are the same size, there are not values that need to be</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// made into an argument, the argument ordering has not been change, or</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// different output registers to handle.  We can simply replace the called</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function in this case.</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/region">Region</a>.ChangedArgOrder &amp;&amp; AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() == <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;arg&#95;size()) &#123;</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Replace call to &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with call to &quot;</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">                      &lt;&lt; &#42;AggFunc &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with same number of arguments\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setCalledFunction(AggFunc);</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We have a different number of arguments than the new function, so</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we need to use our previously mappings off extracted argument to overall</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function argument, and constants to overall function argument to create the</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// new argument list.</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AggArgIdx = 0; AggArgIdx &lt; AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>(); AggArgIdx++) &#123;</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AggArgIdx == AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() - 1 &amp;&amp;</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">        Group.<a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>.size() &gt; 1) &#123;</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we are on the last argument, and we need to differentiate between</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// output blocks, add an integer to the argument list to determine</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// what block to take</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Set switch block argument to &quot;</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlight">                        &lt;&lt; <a href="/docs/api/classes/llvm/region">Region</a>.OutputBlockNum &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlight">      NewCallArgs.push&#95;back(ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(M.getContext()),</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/region">Region</a>.OutputBlockNum));</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">    ArgPair = <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.find(AggArgIdx);</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgPair != <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.<a href="/docs/api/classes/llvm/regionbase/#a9b0ebfeb3f47f1ad763e5b184dcb4e03">end</a>()) &#123;</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;ArgumentValue = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getArgOperand(ArgPair-&gt;second);</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we found the mapping from the extracted function to the overall</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// function, we simply add it to the argument list.  We use the same</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// value, it just needs to honor the new order of arguments.</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Setting argument &quot;</span><span class="doxyHighlight"> &lt;&lt; AggArgIdx &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to value &quot;</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlight">                        &lt;&lt; &#42;ArgumentValue &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlight">      NewCallArgs.push&#95;back(ArgumentValue);</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If it is a constant, we simply add it to the argument list as a value.</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant.<a href="/docs/api/classes/llvm/regionbase/#a75479f44e7157d1a8592231addb67c9c">contains</a>(AggArgIdx)) &#123;</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CST = <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant.find(AggArgIdx)-&gt;second;</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Setting argument &quot;</span><span class="doxyHighlight"> &lt;&lt; AggArgIdx &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to value &quot;</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">                        &lt;&lt; &#42;CST &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlight">      NewCallArgs.push&#95;back(CST);</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add a nullptr value if the argument is not found in the extracted</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// function.  If we cannot find a value, it means it is not in use</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for the region, so we should not pass anything to it.</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Setting argument &quot;</span><span class="doxyHighlight"> &lt;&lt; AggArgIdx &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to nullptr\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">    NewCallArgs.push&#95;back(<a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/pointertype">PointerType</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(AggArgIdx)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())));</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Replace call to &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with call to &quot;</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">                    &lt;&lt; &#42;AggFunc &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with new set of arguments\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the new call instruction and erase the old one.</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#a21075305f0e463b24aafc2fb99514ace">getFunctionType</a>(), AggFunc, NewCallArgs, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">                          <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getIterator());</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is possible that the call to the outlined function is either the first</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction is in the new block, the last instruction, or both.  If either</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of these is the case, we need to make sure that we replace the instruction</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in the IRInstructionData struct with the new call.</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;OldCall = <a href="/docs/api/classes/llvm/region">Region</a>.Call;</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/region">Region</a>.NewFront-&gt;Inst == OldCall)</span></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/region">Region</a>.NewFront-&gt;Inst = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/region">Region</a>.NewBack-&gt;Inst == OldCall)</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/region">Region</a>.NewBack-&gt;Inst = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Transfer any debug information.</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">  <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setDebugLoc(<a href="/docs/api/classes/llvm/region">Region</a>.Call-&gt;getDebugLoc());</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Since our output may determine which branch we go to, we make sure to</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// propagate this new call value through the module.</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">  OldCall-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>);</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove the old instruction.</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">  OldCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/region">Region</a>.Call = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure that the argument in the new function has the SwiftError</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// argument.</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Group.<a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a>)</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;addParamAttr(&#42;Group.<a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a>, Attribute::SwiftError);</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlightComment">/// Find or create a BasicBlock in the outlined function containing PhiBlocks</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlightComment">/// for \\p RetVal.</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlightComment">/// \\param Group - The OutlinableGroup containing the information about the</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlightComment">/// overall outlined function.</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlightComment">/// \\param RetVal - The return value or exit option that we are currently</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlightComment">/// evaluating.</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlightComment">/// \\returns The found or newly created BasicBlock to contain the needed</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlightComment">/// PHINodes to be used as outputs.</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540" lineLink="#af30ff2458bb283e423c1fc242a468579"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="#af30ff2458bb283e423c1fc242a468579">findOrCreatePHIBlock</a>(<a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group, <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetVal) &#123;</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;::iterator</a> PhiBlockForRetVal,</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlight">      ReturnBlockForRetVal;</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">  PhiBlockForRetVal = Group.<a href="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6">PHIBlocks</a>.find(RetVal);</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">  ReturnBlockForRetVal = Group.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>.find(RetVal);</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ReturnBlockForRetVal != Group.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>.end() &amp;&amp;</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Could not find output value!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ReturnBB = ReturnBlockForRetVal-&gt;second;</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find if a PHIBlock exists for this return value already.  If it is</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the first time we are analyzing this, we will not, so we record it.</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">  PhiBlockForRetVal = Group.<a href="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6">PHIBlocks</a>.find(RetVal);</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PhiBlockForRetVal != Group.<a href="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6">PHIBlocks</a>.end())</span></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PhiBlockForRetVal-&gt;second;</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we did not find a block, we create one, and insert it into the</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// overall function and record it.</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Inserted = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PHIBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(ReturnBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), </span><span class="doxyHighlightStringLiteral">&quot;phi&#95;block&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">                                            ReturnBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlight">  std::tie(PhiBlockForRetVal, Inserted) =</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlight">      Group.<a href="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6">PHIBlocks</a>.insert(std::make&#95;pair(RetVal, PHIBlock));</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We find the predecessors of the return block in the newly created outlined</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function in order to point them to the new PHIBlock rather than the already</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// existing return block.</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BranchInst &#42;, 2&gt;</a> BranchesToChange;</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(ReturnBB))</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">    BranchesToChange.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Pred-&gt;getTerminator()));</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now we mark the branch instructions found, and change the references of the</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// return block to the newly created PHIBlock.</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI : BranchesToChange)</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Succ = 0, End = BI-&gt;getNumSuccessors(); Succ &lt; End; Succ++) &#123;</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;getSuccessor(Succ) != ReturnBB)</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">      BI-&gt;setSuccessor(Succ, PHIBlock);</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(ReturnBB, PHIBlock);</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PhiBlockForRetVal-&gt;second;</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlightComment">/// For the function call now representing the \\p Region, find the passed value</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlightComment">/// to that call that represents Argument \\p A at the call location if the</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlightComment">/// call has already been replaced with a call to the  overall, aggregate</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlightComment">/// function.</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlightComment">/// \\param A - The Argument to get the passed value for.</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlightComment">/// \\param Region - The extracted Region corresponding to the outlined function.</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlightComment">/// \\returns The Value representing \\p A at the call site.</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593" lineLink="#ad69884d9bf751011f8f9049542bbbd01"><span class="doxyHighlight"><a href="#ad69884d9bf751011f8f9049542bbbd01">getPassedArgumentInAlreadyOutlinedFunction</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>,</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we don&#39;t need to adjust the argument number at all (since the call</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// has already been replaced by a call to the overall outlined function)</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we can just get the specified argument.</span></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/region">Region</a>.Call-&gt;getArgOperand(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getArgNo());</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlightComment">/// For the function call now representing the \\p Region, find the passed value</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlightComment">/// to that call that represents Argument \\p A at the call location if the</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlightComment">/// call has only been replaced by the call to the aggregate function.</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlightComment">/// \\param A - The Argument to get the passed value for.</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlightComment">/// \\param Region - The extracted Region corresponding to the outlined function.</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlightComment">/// \\returns The Value representing \\p A at the call site.</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609" lineLink="#a202f8ebe30581a7e75bcedc9dee531af"><span class="doxyHighlight"><a href="#a202f8ebe30581a7e75bcedc9dee531af">getPassedArgumentAndAdjustArgumentLocation</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>,</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ArgNum = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getArgNo();</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If it is a constant, we can look at our mapping from when we created</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the outputs to figure out what the constant value is.</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant.count(ArgNum))</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant.find(ArgNum)-&gt;second;</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If it is not a constant, and we are not looking at the overall function, we</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// need to adjust which argument we are looking at.</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">  ArgNum = <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.find(ArgNum)-&gt;second;</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/region">Region</a>.Call-&gt;getArgOperand(ArgNum);</span></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlightComment">/// Find the canonical numbering for the incoming Values into the PHINode \\p PN.</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlightComment">/// \\param PN &#91;in&#93; - The PHINode that we are finding the canonical numbers for.</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlightComment">/// \\param Region &#91;in&#93; - The OutlinableRegion containing \\p PN.</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlightComment">/// \\param OutputMappings &#91;in&#93; - The mapping of output values from outlined</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlightComment">/// region to their original values.</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlightComment">/// \\param CanonNums &#91;out&#93; - The canonical numbering for the incoming values to</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><span class="doxyHighlightComment">/// \\p PN paired with their incoming block.</span></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlightComment">/// \\param ReplacedWithOutlinedCall - A flag to use the extracted function call</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlightComment">/// of \\p Region rather than the overall function&#39;s call.</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634" lineLink="#a26b0639ceb3f28de2e6a283098c525b2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a26b0639ceb3f28de2e6a283098c525b2">findCanonNumsForPHI</a>(</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt;std::pair&lt;unsigned, BasicBlock &#42;&gt;&gt; &amp;CanonNums,</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ReplacedWithOutlinedCall = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate over the incoming values.</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0, EIdx = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); Idx &lt; EIdx; Idx++) &#123;</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;IVal = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(Idx);</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IBlock = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(Idx);</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have an argument as incoming value, we need to grab the passed</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value from the call itself.</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(IVal)) &#123;</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ReplacedWithOutlinedCall)</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">        IVal = <a href="#ad69884d9bf751011f8f9049542bbbd01">getPassedArgumentInAlreadyOutlinedFunction</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/region">Region</a>);</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">        IVal = <a href="#a202f8ebe30581a7e75bcedc9dee531af">getPassedArgumentAndAdjustArgumentLocation</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/region">Region</a>);</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Get the original value if it has been replaced by an output value.</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">    IVal = <a href="#ab0d72084e637eaecbbadd192d547ef8e">findOutputMapping</a>(OutputMappings, IVal);</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Find and add the canonical number for the incoming value.</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlight">    std::optional&lt;unsigned&gt; GVN = <a href="/docs/api/classes/llvm/region">Region</a>.Candidate-&gt;getGVN(IVal);</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GVN &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No GVN for incoming value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">    std::optional&lt;unsigned&gt; CanonNum = <a href="/docs/api/classes/llvm/region">Region</a>.Candidate-&gt;getCanonicalNum(&#42;GVN);</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CanonNum &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No Canonical Number for GVN&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlight">    CanonNums.push&#95;back(std::make&#95;pair(&#42;CanonNum, IBlock));</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlightComment">/// Find, or add PHINode \\p PN to the combined PHINode Block \\p OverallPHIBlock</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlightComment">/// in order to condense the number of instructions added to the outlined</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlightComment">/// function.</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlightComment">/// \\param PN &#91;in&#93; - The PHINode that we are finding the canonical numbers for.</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlightComment">/// \\param Region &#91;in&#93; - The OutlinableRegion containing \\p PN.</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlightComment">/// \\param OverallPhiBlock &#91;in&#93; - The overall PHIBlock we are trying to find</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlightComment">/// \\p PN in.</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlightComment">/// \\param OutputMappings &#91;in&#93; - The mapping of output values from outlined</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlightComment">/// region to their original values.</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlightComment">/// \\param UsedPHIs &#91;in, out&#93; - The PHINodes in the block that have already been</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlightComment">/// matched.</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlightComment">/// \\return the newly found or created PHINode in \\p OverallPhiBlock.</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a>&#42;</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678" lineLink="#a556a77d9b9acf322358b2c4131986b13"><span class="doxyHighlight"><a href="#a556a77d9b9acf322358b2c4131986b13">findOrCreatePHIInBlock</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OverallPhiBlock,</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">                       <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;PHINode &#42;&gt;</a> &amp;UsedPHIs) &#123;</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A list of the canonical numbering assigned to each incoming value, paired</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with the incoming block for the PHINode passed into this function.</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;unsigned, BasicBlock &#42;&gt;</a>&gt; PNCanonNums;</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We have to use the extracted function since we have merged this region into</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the overall function yet.  We make sure to reassign the argument numbering</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// since it is possible that the argument ordering is different between the</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// functions.</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlight">  <a href="#a26b0639ceb3f28de2e6a283098c525b2">findCanonNumsForPHI</a>(&amp;PN, <a href="/docs/api/classes/llvm/region">Region</a>, OutputMappings, PNCanonNums,</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">                      </span><span class="doxyHighlightComment">/&#42; ReplacedWithOutlinedCall = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &#42;FirstRegion = Group.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;;</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A list of the canonical numbering assigned to each incoming value, paired</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with the incoming block for the PHINode that we are currently comparing</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the passed PHINode to.</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;unsigned, BasicBlock &#42;&gt;</a>&gt; CurrentCanonNums;</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find the Canonical Numbering for each PHINode, if it matches, we replace</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the uses of the PHINode we are searching for, with the found PHINode.</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;CurrPN : OverallPhiBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this PHINode has already been matched to another PHINode to be merged,</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we skip it.</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsedPHIs.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(&amp;CurrPN))</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">    CurrentCanonNums.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">    <a href="#a26b0639ceb3f28de2e6a283098c525b2">findCanonNumsForPHI</a>(&amp;CurrPN, &#42;FirstRegion, OutputMappings, CurrentCanonNums,</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">                        </span><span class="doxyHighlightComment">/&#42; ReplacedWithOutlinedCall = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the list of incoming values is not the same length, then they cannot</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// match since there is not an analogue for each incoming value.</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PNCanonNums.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != CurrentCanonNums.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>())</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FoundMatch = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We compare the canonical value for each incoming value in the passed</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in PHINode to one already present in the outlined region.  If the</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// incoming values do not match, then the PHINodes do not match.</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We also check to make sure that the incoming block matches as well by</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// finding the corresponding incoming block in the combined outlined region</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for the current outlined region.</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0, Edx = PNCanonNums.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); Idx &lt; Edx; ++Idx) &#123;</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">      std::pair&lt;unsigned, BasicBlock &#42;&gt; ToCompareTo = CurrentCanonNums&#91;Idx&#93;;</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">      std::pair&lt;unsigned, BasicBlock &#42;&gt; ToAdd = PNCanonNums&#91;Idx&#93;;</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ToCompareTo.first != ToAdd.first) &#123;</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">        FoundMatch = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CorrespondingBlock =</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/region">Region</a>.findCorrespondingBlockIn(&#42;FirstRegion, ToAdd.second);</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CorrespondingBlock &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Found block is nullptr&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CorrespondingBlock != ToCompareTo.second) &#123;</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">        FoundMatch = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If all incoming values and branches matched, then we can merge</span></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// into the found PHINode.</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FoundMatch) &#123;</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">      UsedPHIs.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(&amp;CurrPN);</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;CurrPN;</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we&#39;ve made it here, it means we weren&#39;t able to replace the PHINode, so</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we must insert it ourselves.</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(PN.<a href="/docs/api/classes/llvm/instruction/#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>());</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">  NewPN-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(OverallPhiBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0, Edx = NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); Idx &lt; Edx;</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">       Idx++) &#123;</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;IncomingVal = NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(Idx);</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IncomingBlock = NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(Idx);</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Find corresponding basic block in the overall function for the incoming</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block.</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BlockToUse =</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/region">Region</a>.findCorrespondingBlockIn(&#42;FirstRegion, IncomingBlock);</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">    NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a5ba57877c55dfdbe6e3bbfdacd9ef8c1">setIncomingBlock</a>(Idx, BlockToUse);</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have an argument we make sure we replace using the argument from</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the correct function.</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(IncomingVal)) &#123;</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getArgNo());</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlight">      NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(Idx, Val);</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlight">    </span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Find the corresponding value in the overall function.</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlight">    IncomingVal = <a href="#ab0d72084e637eaecbbadd192d547ef8e">findOutputMapping</a>(OutputMappings, IncomingVal);</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = <a href="/docs/api/classes/llvm/region">Region</a>.findCorrespondingValueIn(&#42;FirstRegion, IncomingVal);</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Val &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Value is nullptr?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;::iterator</a> RemappedIt =</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlight">        FirstRegion-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#aa6e8e852e322a0a5383c6f0fce17daa2">RemappedArguments</a>.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Val);</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RemappedIt != FirstRegion-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#aa6e8e852e322a0a5383c6f0fce17daa2">RemappedArguments</a>.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlight">      Val = RemappedIt-&gt;second;</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlight">    NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(Idx, Val);</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NewPN;</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlightComment">// Within an extracted function, replace the argument uses of the extracted</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlightComment">// region with the arguments of the function for an OutlinableGroup.</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlightComment">/// \\param &#91;in&#93; Region - The region of extracted code to be changed.</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlightComment">/// \\param &#91;in,out&#93; OutputBBs - The BasicBlock for the output stores for this</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlightComment">/// region.</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlightComment">/// \\param &#91;in&#93; FirstFunction - A flag to indicate whether we are using this</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlightComment">/// function to define the overall outlined function for all the regions, or</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlightComment">/// if we are operating on one of the following regions.</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800" lineLink="#a96b5bd50d8e96b4c76ffc26508ce774d"><span class="doxyHighlight"><a href="#a96b5bd50d8e96b4c76ffc26508ce774d">replaceArgumentUses</a>(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;OutputBBs,</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FirstFunction = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlight">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Region has no extracted function?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;DominatingFunction = <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction;</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstFunction)</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlight">    DominatingFunction = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>;</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> DT(&#42;DominatingFunction);</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;PHINode &#42;&gt;</a> UsedPHIs;</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ArgIdx = 0; ArgIdx &lt; <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction-&gt;arg&#95;size();</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlight">       ArgIdx++) &#123;</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/region">Region</a>.ExtractedArgToAgg.<a href="/docs/api/classes/llvm/regionbase/#a75479f44e7157d1a8592231addb67c9c">contains</a>(ArgIdx) &amp;&amp;</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;No mapping from extracted to outlined?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AggArgIdx = <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedArgToAgg.find(ArgIdx)-&gt;second;</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;AggArg = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(AggArgIdx);</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;Arg = <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction-&gt;getArg(ArgIdx);</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The argument is an input, so we can simply replace it with the overall</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// argument value</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ArgIdx &lt; <a href="/docs/api/classes/llvm/region">Region</a>.NumExtractedInputs) &#123;</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Replacing uses of input &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Arg &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; in function &quot;</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">                        &lt;&lt; &#42;<a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;AggArg</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; in function &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">      Arg-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(AggArg);</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/classes/llvm/region">Region</a>.Call-&gt;getArgOperand(ArgIdx);</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/region">Region</a>.RemappedArguments.insert(std::make&#95;pair(V, AggArg));</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we are replacing an output, we place the store value in its own</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// block inside the overall function before replacing the use of the output</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in the function.</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Arg-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Output argument can only have one use&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/user">User</a> &#42;InstAsUser = Arg-&gt;<a href="/docs/api/classes/llvm/value/#a46db903db2484e1ef5062d094d6b0854">user&#95;back</a>();</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InstAsUser &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;User is nullptr!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(InstAsUser);</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 4&gt;</a> Descendants;</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">    DT.<a href="/docs/api/classes/llvm/dominatortreebase/#a406e4a6b7277aab7efd423ae30a9fb12">getDescendants</a>(BB, Descendants);</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EdgeAdded = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Descendants.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 0) &#123;</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">      EdgeAdded = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">      DT.<a href="/docs/api/classes/llvm/dominatortreebase/#a51145a3ae24ea73b3692a17088edea7b">insertEdge</a>(&amp;DominatingFunction-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>(), BB);</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">      DT.<a href="/docs/api/classes/llvm/dominatortreebase/#a406e4a6b7277aab7efd423ae30a9fb12">getDescendants</a>(BB, Descendants);</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Iterate over the following blocks, looking for return instructions,</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// if we find one, find the corresponding output block for the return value</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and move our store instruction there.</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DescendBB : Descendants) &#123;</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(DescendBB-&gt;getTerminator());</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RI)</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetVal = RI-&gt;<a href="/docs/api/classes/llvm/returninst/#a6c2dee0852138a5cb8a4fef5883db9ec">getReturnValue</a>();</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> VBBIt = OutputBBs.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(RetVal);</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VBBIt != OutputBBs.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Could not find output value!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this is storing a PHINode, we must make sure it is included in the</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// overall function.</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;ValueOperand = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand();</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;NewI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;clone());</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">      NewI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OutputBB = VBBIt-&gt;second;</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">      NewI-&gt;<a href="/docs/api/classes/llvm/instruction/#afcd9d2ea284c4d90541291ff9c47d332">insertInto</a>(OutputBB, OutputBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Move store for instruction &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to &quot;</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">                        &lt;&lt; &#42;OutputBB &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this is storing a PHINode, we must make sure it is included in the</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// overall function.</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(ValueOperand) ||</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/region">Region</a>.Candidate-&gt;getGVN(ValueOperand).has&#95;value()) &#123;</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstFunction)</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;CorrVal =</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/region">Region</a>.findCorrespondingValueIn(&#42;Group.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;, ValueOperand);</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CorrVal &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Value is nullptr?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">        NewI-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, CorrVal);</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand());</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If it has a value, it was not split by the code extractor, which</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// is what we are looking for.</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/region">Region</a>.Candidate-&gt;getGVN(PN))</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We record the parent block for the PHINode in the Region so that</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we can exclude it from checks later on.</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/region">Region</a>.PHIBlocks.insert(std::make&#95;pair(RetVal, PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()));</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If this is the first function, we do not need to worry about mergiing</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// this with any other block in the overall outlined function, so we can</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// just continue.</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstFunction) &#123;</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PHIBlock = PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">        Group.<a href="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6">PHIBlocks</a>.insert(std::make&#95;pair(RetVal, PHIBlock));</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We look for the aggregate block that contains the PHINodes leading into</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// this exit path. If we can&#39;t find one, we create one.</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OverallPhiBlock = <a href="#af30ff2458bb283e423c1fc242a468579">findOrCreatePHIBlock</a>(Group, RetVal);</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For our PHINode, we find the combined canonical numbering, and</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// attempt to find a matching PHINode in the overall PHIBlock.  If we</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// cannot, we copy the PHINode and move it into this new block.</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN = <a href="#a556a77d9b9acf322358b2c4131986b13">findOrCreatePHIInBlock</a>(&#42;PN, <a href="/docs/api/classes/llvm/region">Region</a>, OverallPhiBlock,</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">                                              OutputMappings, UsedPHIs);</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">      NewI-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, NewPN);</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we added an edge for basic blocks without a predecessor, we remove it</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// here.</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EdgeAdded)</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">      DT.<a href="/docs/api/classes/llvm/dominatortreebase/#ab0f09aefdf088f84a0bff7cba86454b4">deleteEdge</a>(&amp;DominatingFunction-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>(), BB);</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Replacing uses of output &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Arg &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; in function &quot;</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">                      &lt;&lt; &#42;<a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;AggArg</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; in function &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">    Arg-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(AggArg);</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlightComment">/// Within an extracted function, replace the constants that need to be lifted</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlightComment">/// into arguments with the actual argument.</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlightComment">/// \\param Region &#91;in&#93; - The region of extracted code to be changed.</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934" lineLink="#ace02ac07a3f704ffd345301bff92e5a8"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ace02ac07a3f704ffd345301bff92e5a8">replaceConstants</a>(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate over the constants that need to be elevated into arguments</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (std::pair&lt;unsigned, Constant &#42;&gt; &amp;Const : <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant) &#123;</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AggArgIdx = Const.first;</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;OutlinedFunction = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>;</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFunction &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Overall Function is not defined?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CST = Const.second;</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;Arg = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(AggArgIdx);</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Identify the argument it will be elevated to, and replace instances of</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that constant in the function.</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: If in the future constants do not have one global value number,</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// i.e. a constant 1 could be mapped to several values, this check will</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// have to be more strict.  It cannot be using only replaceUsesWithIf.</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Replacing uses of constant &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;CST</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; in function &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;OutlinedFunction &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with &quot;</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">                      &lt;&lt; &#42;Arg &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">    CST-&gt;<a href="/docs/api/classes/llvm/value/#a7e8dad1701aa6445be4a29f654b0473c">replaceUsesWithIf</a>(Arg, &#91;OutlinedFunction&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) &#123;</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U.getUser()))</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction() == OutlinedFunction;</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlightComment">/// It is possible that there is a basic block that already performs the same</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlightComment">/// stores. This returns a duplicate block, if it exists</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlightComment">/// \\param OutputBBs &#91;in&#93; the blocks we are looking for a duplicate of.</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlightComment">/// \\param OutputStoreBBs &#91;in&#93; The existing output blocks.</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlightComment">/// \\returns an optional value with the number output block if there is a match.</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967" lineLink="#af714eb55aced0ac27294c881d8be6ecb"><span class="doxyHighlight">std::optional&lt;unsigned&gt; <a href="#af714eb55aced0ac27294c881d8be6ecb">findDuplicateOutputBlock</a>(</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;OutputBBs,</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlight">    std::vector&lt;<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a>&gt; &amp;OutputStoreBBs) &#123;</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Mismatch = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MatchingNum = 0;</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We compare the new set output blocks to the other sets of output blocks.</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If they are the same number, and have identical instructions, they are</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// considered to be the same.</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;CompBBs : OutputStoreBBs) &#123;</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">    Mismatch = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;VToB : CompBBs) &#123;</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;::iterator</a> OutputBBIt =</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">          OutputBBs.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(VToB.first);</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OutputBBIt == OutputBBs.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlight">        Mismatch = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CompBB = VToB.second;</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OutputBB = OutputBBIt-&gt;second;</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CompBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>() - 1 != OutputBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>()) &#123;</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">        Mismatch = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> NIt = OutputBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;CompBB) &#123;</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isIdenticalTo(&amp;(&#42;NIt))) &#123;</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">          Mismatch = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">        NIt++;</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Mismatch)</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MatchingNum;</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">    MatchingNum++;</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlightComment">/// Remove empty output blocks from the outlined region.</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlightComment">/// \\param BlocksToPrune - Mapping of return values output blocks for the \\p</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlightComment">/// Region.</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlightComment">/// \\param Region - The OutlinableRegion we are analyzing.</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022" lineLink="#a57d54880afa1fb74833cc7c43ad33377"><span class="doxyHighlight"><a href="#a57d54880afa1fb74833cc7c43ad33377">analyzeAndPruneOutputBlocks</a>(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;BlocksToPrune,</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">                            <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllRemoved = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetValueForBB;</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB;</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a>;</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate over the output blocks created in the outlined section.</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;VtoBB : BlocksToPrune) &#123;</span></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">    RetValueForBB = VtoBB.first;</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">    NewBB = VtoBB.second;</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are no instructions, we remove it from the module, and also</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// mark the value for removal from the return value to output block mapping.</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>() == 0) &#123;</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">      NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a>.push&#95;back(RetValueForBB);</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">    </span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Mark that we could not remove all the blocks since they were not all</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// empty.</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">    AllRemoved = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove the return value from the mapping.</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a>)</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">    BlocksToPrune.<a href="/docs/api/classes/llvm/densemapbase/#a1eb8504bab5f794778d82db6ac829923">erase</a>(V);</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Mark the region as having the no output scheme.</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AllRemoved)</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/region">Region</a>.OutputBlockNum = -1;</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AllRemoved;</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlightComment">/// For the outlined section, move needed the StoreInsts for the output</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlightComment">/// registers into their own block. Then, determine if there is a duplicate</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlightComment">/// output block already created.</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlightComment">/// \\param &#91;in&#93; OG - The OutlinableGroup of regions to be outlined.</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlightComment">/// \\param &#91;in&#93; Region - The OutlinableRegion that is being analyzed.</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><span class="doxyHighlightComment">/// \\param &#91;in,out&#93; OutputBBs - the blocks that stores for this region will be</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlightComment">/// placed in.</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlightComment">/// \\param &#91;in&#93; EndBBs - the final blocks of the extracted function.</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlightComment">/// \\param &#91;in&#93; OutputMappings - OutputMappings the mapping of values that have</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlightComment">/// been replaced by a new output value.</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlightComment">/// \\param &#91;in,out&#93; OutputStoreBBs - The existing output blocks.</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069" lineLink="#a4fcb90c9c38b3381765a891d0a61c1ea"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a4fcb90c9c38b3381765a891d0a61c1ea">alignOutputBlockWithAggFunc</a>(</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">    <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;OG, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;OutputBBs,</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;EndBBs,</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">    std::vector&lt;<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a>&gt; &amp;OutputStoreBBs) &#123;</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If none of the output blocks have any instructions, this means that we do</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// not have to determine if it matches any of the other output schemes, and we</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// don&#39;t have to do anything else.</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a57d54880afa1fb74833cc7c43ad33377">analyzeAndPruneOutputBlocks</a>(OutputBBs, <a href="/docs/api/classes/llvm/region">Region</a>))</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine is there is a duplicate set of blocks.</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; MatchingBB =</span></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">      <a href="#af714eb55aced0ac27294c881d8be6ecb">findDuplicateOutputBlock</a>(OutputBBs, OutputStoreBBs);</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is, we remove the new output blocks.  If it does not,</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we add it to our list of sets of output blocks.</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MatchingBB) &#123;</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Set output block for region in function&quot;</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">                      &lt;&lt; <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;MatchingBB);</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/region">Region</a>.OutputBlockNum = &#42;MatchingBB;</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;VtoBB : OutputBBs)</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">      VtoBB.second-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/region">Region</a>.OutputBlockNum = OutputStoreBBs.size();</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetValueForBB;</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB;</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">  OutputStoreBBs.push&#95;back(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a>());</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;VtoBB : OutputBBs) &#123;</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">    RetValueForBB = VtoBB.first;</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">    NewBB = VtoBB.second;</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;::iterator</a> VBBIt =</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">        EndBBs.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(RetValueForBB);</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Create output block for region in&quot;</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">                      &lt;&lt; <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to &quot;</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">                      &lt;&lt; &#42;NewBB);</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(VBBIt-&gt;second, NewBB);</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">    OutputStoreBBs.back().insert(std::make&#95;pair(RetValueForBB, NewBB));</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlightComment">/// Takes in a mapping, \\p OldMap of ConstantValues to BasicBlocks, sorts keys,</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlightComment">/// before creating a basic block for each \\p NewMap, and inserting into the new</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlightComment">/// block. Each BasicBlock is named with the scheme &quot;&lt;basename&gt;&#95;&lt;key&#95;idx&gt;&quot;.</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><span class="doxyHighlightComment">/// \\param OldMap &#91;in&#93; - The mapping to base the new mapping off of.</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlightComment">/// \\param NewMap &#91;out&#93; - The output mapping using the keys of \\p OldMap.</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlightComment">/// \\param ParentFunc &#91;in&#93; - The function to put the new basic block in.</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlightComment">/// \\param BaseName &#91;in&#93; - The start of the BasicBlock names to be appended to</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlightComment">/// by an index value.</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124" lineLink="#a8120984c169f2ea17e785e7c6887702a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a8120984c169f2ea17e785e7c6887702a">createAndInsertBasicBlocks</a>(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;OldMap,</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;NewMap,</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/function">Function</a> &#42;ParentFunc, <a href="/docs/api/classes/llvm/twine">Twine</a> BaseName) &#123;</span></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0;</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">  std::vector&lt;Value &#42;&gt; SortedKeys;</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><span class="doxyHighlight">  <a href="#a8ad786f21829d9e92d31cc0b80c53dbb">getSortedConstantKeys</a>(SortedKeys, OldMap);</span></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;RetVal : SortedKeys) &#123;</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</span></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlight">        ParentFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>(),</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/twine">Twine</a>(BaseName) + <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;&#95;&quot;</span><span class="doxyHighlight">) + <a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(Idx++)),</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><span class="doxyHighlight">        ParentFunc);</span></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlight">    NewMap.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make&#95;pair(RetVal, NewBB));</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlightComment">/// Create the switch statement for outlined function to differentiate between</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlightComment">/// all the output blocks.</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlightComment">/// For the outlined section, determine if an outlined block already exists that</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><span class="doxyHighlightComment">/// matches the needed stores for the extracted section.</span></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlightComment">/// \\param &#91;in&#93; M - The module we are outlining from.</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlightComment">/// \\param &#91;in&#93; OG - The group of regions to be outlined.</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlightComment">/// \\param &#91;in&#93; EndBBs - The final blocks of the extracted function.</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlightComment">/// \\param &#91;in,out&#93; OutputStoreBBs - The existing output blocks.</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150" lineLink="#ae86fef7fc5831c2514bff95bdf784d09"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ae86fef7fc5831c2514bff95bdf784d09">createSwitchStatement</a>(</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;OG, <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;EndBBs,</span></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlight">    std::vector&lt;<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a>&gt; &amp;OutputStoreBBs) &#123;</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We only need the switch statement if there is more than one store</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// combination, or there is more than one set of output blocks.  The first</span></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will occur when we store different sets of values for two different</span></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// regions.  The second will occur when we have two outputs that are combined</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in a PHINode outside of the region in one outlined instance, and are used</span></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// seaparately in another. This will create the same set of OutputGVNs, but</span></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will generate two different output schemes.</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OG.<a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>.size() &gt; 1) &#123;</span></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;AggFunc = OG.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>;</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a final block for each different return block.</span></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> ReturnBBs;</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlight">    <a href="#a8120984c169f2ea17e785e7c6887702a">createAndInsertBasicBlocks</a>(OG.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>, ReturnBBs, AggFunc, </span><span class="doxyHighlightStringLiteral">&quot;final&#95;block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;RetBlockPair : ReturnBBs) &#123;</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><span class="doxyHighlight">      std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;OutputBlock =</span></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlight">          &#42;OG.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>.find(RetBlockPair.first);</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ReturnBlock = RetBlockPair.second;</span></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EndBB = OutputBlock.second;</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Term = EndBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Move the return value to the final block instead of the original exit</span></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// stub.</span></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">      Term-&gt;moveBefore(&#42;ReturnBlock, ReturnBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Put the switch statement in the old end basic block for the function</span></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// with a fall through to the new return block.</span></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Create switch statement in &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;AggFunc &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for &quot;</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><span class="doxyHighlight">                        &lt;&lt; OutputStoreBBs.<a href="/docs/api/classes/llvm/function/#a969eb757b1e43b455d4a8d0f603e695b">size</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;SwitchI =</span></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/switchinst/#a3c1416226bed5e92acb74aebe8e20f5a">SwitchInst::Create</a>(AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() - 1),</span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">                             ReturnBlock, OutputStoreBBs.<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>(), EndBB);</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0;</span></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;OutputStoreBB : OutputStoreBBs) &#123;</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;::iterator</a> OSBBIt =</span></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><span class="doxyHighlight">            OutputStoreBB.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(OutputBlock.first);</span></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OSBBIt == OutputStoreBB.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = OSBBIt-&gt;second;</span></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">        SwitchI-&gt;<a href="/docs/api/classes/llvm/switchinst/#a62abc2475d09c01d583ba24a487898fd">addCase</a>(</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">            ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(M.getContext()), Idx), BB);</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">        Term = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">        Term-&gt;setSuccessor(0, ReturnBlock);</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><span class="doxyHighlight">        Idx++;</span></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutputStoreBBs.size() &lt; 2 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Different store sets not handled!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there needs to be stores, move them from the output blocks to their</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// corresponding ending block.  We do not check that the OutputGVNCombinations</span></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is equal to 1 here since that could just been the case where there are 0</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// outputs. Instead, we check whether there is more than one set of output</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// blocks since this is the only case where we would have to move the</span></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stores, and erase the extraneous blocks.</span></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OutputStoreBBs.size() == 1) &#123;</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Move store instructions to the end block in &quot;</span></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlight">                      &lt;&lt; &#42;OG.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> OutputBlocks = OutputStoreBBs&#91;0&#93;;</span></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;VBPair : OutputBlocks) &#123;</span></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;::iterator</a> EndBBIt =</span></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><span class="doxyHighlight">          EndBBs.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(VBPair.first);</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndBBIt != EndBBs.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Could not find end block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EndBB = EndBBIt-&gt;second;</span></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OutputBB = VBPair.second;</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Term = OutputBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><span class="doxyHighlight">      Term-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">      Term = EndBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">      <a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">moveBBContents</a>(&#42;OutputBB, &#42;EndBB);</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">      Term-&gt;moveBefore(&#42;EndBB, EndBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><span class="doxyHighlight">      OutputBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</span></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlightComment">/// Fill the new function that will serve as the replacement function for all of</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlightComment">/// the extracted regions of a certain structure from the first region in the</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><span class="doxyHighlightComment">/// list of regions.  Replace this first region&#39;s extracted function with the</span></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><span class="doxyHighlightComment">/// new overall function.</span></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlightComment">/// \\param &#91;in&#93; M - The module we are outlining from.</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlightComment">/// \\param &#91;in&#93; CurrentGroup - The group of regions to be outlined.</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlightComment">/// \\param &#91;in,out&#93; OutputStoreBBs - The output blocks for each different</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><span class="doxyHighlightComment">/// set of stores needed for the different functions.</span></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlightComment">/// \\param &#91;in,out&#93; FuncsToRemove - Extracted functions to erase from module</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><span class="doxyHighlightComment">/// once outlining is complete.</span></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><span class="doxyHighlightComment">/// \\param &#91;in&#93; OutputMappings - Extracted functions to erase from module</span></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlightComment">/// once outlining is complete.</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243" lineLink="#a4e06ebf129ddfb3b33a64f1a456cfc24"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a4e06ebf129ddfb3b33a64f1a456cfc24">fillOverallFunction</a>(</span></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;CurrentGroup,</span></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><span class="doxyHighlight">    std::vector&lt;<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a>&gt; &amp;OutputStoreBBs,</span></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">    std::vector&lt;Function &#42;&gt; &amp;FuncsToRemove,</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings) &#123;</span></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &#42;CurrentOS = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;;</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Move first extracted function&#39;s instructions into new function.</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Move instructions from &quot;</span></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><span class="doxyHighlight">                    &lt;&lt; &#42;CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to instruction &quot;</span></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><span class="doxyHighlight">                    &lt;&lt; &#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">  <a href="#a4047976de351f78967fba27df7a6361f">moveFunctionData</a>(&#42;CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a>,</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><span class="doxyHighlight">                   &#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>, CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>);</span></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Transfer the attributes from the function to the new function.</span></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/attribute">Attribute</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#a7477aafbbe989ad35b96fac186d8e9fd">getAttributes</a>().getFnAttrs())</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a new set of output blocks for the first extracted function.</span></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> NewBBs;</span></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><span class="doxyHighlight">  <a href="#a8120984c169f2ea17e785e7c6887702a">createAndInsertBasicBlocks</a>(CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>, NewBBs,</span></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">                             CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>, </span><span class="doxyHighlightStringLiteral">&quot;output&#95;block&#95;0&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">  CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a262d2672038afdeba85e23a30ea4c22d">OutputBlockNum</a> = 0;</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><span class="doxyHighlight">  <a href="#a96b5bd50d8e96b4c76ffc26508ce774d">replaceArgumentUses</a>(&#42;CurrentOS, NewBBs, OutputMappings, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><span class="doxyHighlight">  <a href="#ace02ac07a3f704ffd345301bff92e5a8">replaceConstants</a>(&#42;CurrentOS);</span></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We first identify if any output blocks are empty, if they are we remove</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them. We then create a branch instruction to the basic block to the return</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block for the function for each non empty output block.</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a57d54880afa1fb74833cc7c43ad33377">analyzeAndPruneOutputBlocks</a>(NewBBs, &#42;CurrentOS)) &#123;</span></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><span class="doxyHighlight">    OutputStoreBBs.push&#95;back(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a>());</span></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;VToBB : NewBBs) &#123;</span></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;::iterator</a> VBBIt =</span></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><span class="doxyHighlight">          CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>.find(VToBB.first);</span></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EndBB = VBBIt-&gt;second;</span></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(EndBB, VToBB.second);</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlight">      OutputStoreBBs.back().insert(VToBB);</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace the call to the extracted function with the outlined function.</span></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><span class="doxyHighlight">  CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a018669f7b1d6a21106f47398a087c30a">Call</a> = <a href="#a7e2cad7ab18db9a3c940afc609c223dc">replaceCalledFunction</a>(M, &#42;CurrentOS);</span></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We only delete the extracted functions at the end since we may need to</span></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reference instructions contained in them for mapping purposes.</span></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">  FuncsToRemove.push&#95;back(CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a>);</span></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> IROutliner::deduplicateExtractedSections(</span></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/module">Module</a> &amp;M, OutlinableGroup &amp;CurrentGroup,</span></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><span class="doxyHighlight">    std::vector&lt;Function &#42;&gt; &amp;FuncsToRemove, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &amp;OutlinedFunctionNum) &#123;</span></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><span class="doxyHighlight">  createFunction(M, CurrentGroup, OutlinedFunctionNum);</span></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><span class="doxyHighlight">  std::vector&lt;DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;&gt; OutputStoreBBs;</span></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><span class="doxyHighlight">  OutlinableRegion &#42;CurrentOS;</span></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><span class="doxyHighlight">  <a href="#a4e06ebf129ddfb3b33a64f1a456cfc24">fillOverallFunction</a>(M, CurrentGroup, OutputStoreBBs, FuncsToRemove,</span></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><span class="doxyHighlight">                      OutputMappings);</span></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><span class="doxyHighlight">  std::vector&lt;Value &#42;&gt; SortedKeys;</span></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 1; Idx &lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size(); Idx++) &#123;</span></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><span class="doxyHighlight">    CurrentOS = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;Idx&#93;;</span></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><span class="doxyHighlight">    AttributeFuncs::mergeAttributesForOutlining(&#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>,</span></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><span class="doxyHighlight">                                               &#42;CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a>);</span></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a set of BasicBlocks, one for each return block, to hold the</span></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// needed store instructions.</span></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><span class="doxyHighlight">    DenseMap&lt;Value &#42;, BasicBlock &#42;&gt; NewBBs;</span></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><span class="doxyHighlight">    <a href="#a8120984c169f2ea17e785e7c6887702a">createAndInsertBasicBlocks</a>(</span></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><span class="doxyHighlight">        CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>, NewBBs, CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>,</span></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;output&#95;block&#95;&quot;</span><span class="doxyHighlight"> + Twine(</span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(Idx)));</span></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><span class="doxyHighlight">    <a href="#a96b5bd50d8e96b4c76ffc26508ce774d">replaceArgumentUses</a>(&#42;CurrentOS, NewBBs, OutputMappings);</span></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><span class="doxyHighlight">    <a href="#a4fcb90c9c38b3381765a891d0a61c1ea">alignOutputBlockWithAggFunc</a>(CurrentGroup, &#42;CurrentOS, NewBBs,</span></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><span class="doxyHighlight">                                CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>, OutputMappings,</span></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><span class="doxyHighlight">                                OutputStoreBBs);</span></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><span class="doxyHighlight">    CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a018669f7b1d6a21106f47398a087c30a">Call</a> = <a href="#a7e2cad7ab18db9a3c940afc609c223dc">replaceCalledFunction</a>(M, &#42;CurrentOS);</span></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><span class="doxyHighlight">    FuncsToRemove.push&#95;back(CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a>);</span></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create a switch statement to handle the different output schemes.</span></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><span class="doxyHighlight">  <a href="#ae86fef7fc5831c2514bff95bdf784d09">createSwitchStatement</a>(M, CurrentGroup, CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>, OutputStoreBBs);</span></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><span class="doxyHighlight">  OutlinedFunctionNum++;</span></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><span class="doxyHighlightComment">/// Checks that the next instruction in the InstructionDataList matches the</span></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><span class="doxyHighlightComment">/// next instruction in the module.  If they do not, there could be the</span></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><span class="doxyHighlightComment">/// possibility that extra code has been inserted, and we must ignore it.</span></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><span class="doxyHighlightComment">/// \\param ID - The IRInstructionData to check the next instruction of.</span></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><span class="doxyHighlightComment">/// \\returns true if the InstructionDataList and actual instruction match.</span></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337" lineLink="#a3bc949e06e148a6d2879eb45ca164146"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a3bc949e06e148a6d2879eb45ca164146">nextIRInstructionDataMatchesNextInst</a>(<a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata">IRInstructionData</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>) &#123;</span></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We check if there is a discrepancy between the InstructionDataList</span></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and the actual next instruction in the module.  If there is, it means</span></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that an extra instruction was added, likely by the CodeExtractor.</span></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Since we do not have any similarity data about this particular</span></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction, we cannot confidently outline it, and must discard this</span></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// candidate.</span></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><span class="doxyHighlight">  IRInstructionDataList::iterator NextIDIt = std::next(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getIterator());</span></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NextIDLInst = NextIDIt-&gt;Inst;</span></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NextModuleInst = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst-&gt;isTerminator())</span></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><span class="doxyHighlight">    NextModuleInst = <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst-&gt;getNextNonDebugInstruction();</span></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NextIDLInst != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><span class="doxyHighlight">    NextModuleInst =</span></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><span class="doxyHighlight">        &amp;&#42;NextIDIt-&gt;Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;instructionsWithoutDebug().begin();</span></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NextIDLInst &amp;&amp; NextIDLInst != NextModuleInst)</span></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IROutliner::isCompatibleWithAlreadyOutlinedCode(</span></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</span></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><span class="doxyHighlight">  IRSimilarityCandidate &#42;IRSC = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate;</span></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StartIdx = IRSC-&gt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ada960ccf6a96ca62ce5db3af1b7bf7f5">getStartIdx</a>();</span></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EndIdx = IRSC-&gt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a5fd2e1a8a3658307e8c0d87a153d8c24">getEndIdx</a>();</span></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A check to make sure that we are not about to attempt to outline something</span></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that has already been outlined.</span></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = StartIdx; Idx &lt;= EndIdx; Idx++)</span></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Outlined.contains(Idx))</span></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We check if the recorded instruction matches the actual next instruction,</span></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if it does not, we fix it in the InstructionDataList.</span></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;backInstruction()-&gt;isTerminator()) &#123;</span></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;NewEndInst =</span></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;backInstruction()-&gt;getNextNonDebugInstruction();</span></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewEndInst &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Next instruction is a nullptr?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;end()-&gt;Inst != NewEndInst) &#123;</span></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><span class="doxyHighlight">      IRInstructionDataList &#42;IDL = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;front()-&gt;IDL;</span></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><span class="doxyHighlight">      IRInstructionData &#42;NewEndIRID = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> (InstDataAllocator.Allocate())</span></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><span class="doxyHighlight">          IRInstructionData(&#42;NewEndInst,</span></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><span class="doxyHighlight">                            InstructionClassifier.visit(&#42;NewEndInst), &#42;IDL);</span></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Insert the first IRInstructionData of the new region after the</span></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// last IRInstructionData of the IRSimilarityCandidate.</span></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><span class="doxyHighlight">      IDL-&gt;<a href="/docs/api/classes/llvm/simple-ilist/#a7f4bd492b552181942252ccddc0db26e">insert</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;end(), &#42;NewEndIRID);</span></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(&#42;IRSC, &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(IRInstructionData &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>) &#123;</span></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a3bc949e06e148a6d2879eb45ca164146">nextIRInstructionDataMatchesNextInst</a>(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>))</span></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !this-&gt;InstructionClassifier.visit(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst);</span></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> IROutliner::pruneIncompatibleRegions(</span></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><span class="doxyHighlight">    std::vector&lt;IRSimilarityCandidate&gt; &amp;CandidateVec,</span></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><span class="doxyHighlight">    OutlinableGroup &amp;CurrentGroup) &#123;</span></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PreviouslyOutlined;</span></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sort from beginning to end, so the IRSimilarityCandidates are in order.</span></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">stable&#95;sort</a>(CandidateVec, &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> IRSimilarityCandidate &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</span></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><span class="doxyHighlight">                               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> IRSimilarityCandidate &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</span></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.getStartIdx() &lt; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.getStartIdx();</span></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><span class="doxyHighlight">  IRSimilarityCandidate &amp;FirstCandidate = CandidateVec&#91;0&#93;;</span></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Since outlining a call and a branch instruction will be the same as only</span></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// outlinining a call instruction, we ignore it as a space saving.</span></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FirstCandidate.getLength() == 2) &#123;</span></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(FirstCandidate.front()-&gt;Inst) &amp;&amp;</span></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(FirstCandidate.back()-&gt;Inst))</span></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CurrentEndIdx = 0;</span></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (IRSimilarityCandidate &amp;IRSC : CandidateVec) &#123;</span></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><span class="doxyHighlight">    PreviouslyOutlined = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StartIdx = IRSC.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ada960ccf6a96ca62ce5db3af1b7bf7f5">getStartIdx</a>();</span></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EndIdx = IRSC.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a5fd2e1a8a3658307e8c0d87a153d8c24">getEndIdx</a>();</span></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &amp;FnForCurrCand = &#42;IRSC.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#abfc4581d38f96e5833319a3d1ad24c1c">getFunction</a>();</span></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = StartIdx; Idx &lt;= EndIdx; Idx++)</span></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Outlined.contains(Idx)) &#123;</span></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><span class="doxyHighlight">        PreviouslyOutlined = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PreviouslyOutlined)</span></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check over the instructions, and if the basic block has its address</span></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// taken for use somewhere else, we do not outline that block.</span></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BBHasAddressTaken = <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(IRSC, &#91;&#93;(IRInstructionData &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>)&#123;</span></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst-&gt;getParent()-&gt;hasAddressTaken();</span></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BBHasAddressTaken)</span></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FnForCurrCand.<a href="/docs/api/classes/llvm/function/#a9c38a8cc0a38636c95bd2826de9d72d4">hasOptNone</a>())</span></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FnForCurrCand.<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(</span><span class="doxyHighlightStringLiteral">&quot;nooutline&quot;</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;... Skipping function with nooutline attribute: &quot;</span></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><span class="doxyHighlight">               &lt;&lt; FnForCurrCand.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IRSC.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#af79c3d65a39c004b7517e811db43522c">front</a>()-&gt;<a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata/#a8f280453f9963266308cb61e428f5268">Inst</a>-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/globalvalue/#ae28d149d03a6ae88267f649bc1dbe42c">hasLinkOnceODRLinkage</a>() &amp;&amp;</span></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><span class="doxyHighlight">        !OutlineFromLinkODRs)</span></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Greedily prune out any regions that will overlap with already chosen</span></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// regions.</span></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurrentEndIdx != 0 &amp;&amp; StartIdx &lt;= CurrentEndIdx)</span></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> BadInst = <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(IRSC, &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(IRInstructionData &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>) &#123;</span></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a3bc949e06e148a6d2879eb45ca164146">nextIRInstructionDataMatchesNextInst</a>(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>))</span></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !this-&gt;InstructionClassifier.visit(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst);</span></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BadInst)</span></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><span class="doxyHighlight">    OutlinableRegion &#42;OS = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> (RegionAllocator.Allocate())</span></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><span class="doxyHighlight">        OutlinableRegion(IRSC, CurrentGroup);</span></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><span class="doxyHighlight">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.push&#95;back(OS);</span></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><span class="doxyHighlight">    CurrentEndIdx = EndIdx;</span></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><span class="doxyHighlight">IROutliner::findBenefitFromAllRegions(OutlinableGroup &amp;CurrentGroup) &#123;</span></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><span class="doxyHighlight">  InstructionCost RegionBenefit = 0;</span></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (OutlinableRegion &#42;Region : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</span></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><span class="doxyHighlight">    TargetTransformInfo &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> = getTTI(&#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>-&gt;StartBB-&gt;getParent());</span></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We add the number of instructions in the region to the benefit as an</span></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// estimate as to how much will be removed.</span></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><span class="doxyHighlight">    RegionBenefit += <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>-&gt;getBenefit(<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Adding: &quot;</span><span class="doxyHighlight"> &lt;&lt; RegionBenefit</span></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; saved instructions to overfall benefit.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RegionBenefit;</span></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><span class="doxyHighlightComment">/// For the \\p OutputCanon number passed in find the value represented by this</span></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><span class="doxyHighlightComment">/// canonical number. If it is from a PHINode, we pick the first incoming</span></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><span class="doxyHighlightComment">/// value and return that Value instead.</span></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><span class="doxyHighlightComment">/// \\param Region - The OutlinableRegion to get the Value from.</span></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><span class="doxyHighlightComment">/// \\param OutputCanon - The canonical number to find the Value from.</span></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><span class="doxyHighlightComment">/// \\returns The Value represented by a canonical number \\p OutputCanon in \\p</span></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><span class="doxyHighlightComment">/// Region.</span></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504" lineLink="#ab4b0641c5ffeeb3249b4ce9bb98c1a2d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#ab4b0641c5ffeeb3249b4ce9bb98c1a2d">findOutputValueInRegion</a>(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</span></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OutputCanon) &#123;</span></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><span class="doxyHighlight">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;CurrentGroup = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</span></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the value is greater than the value in the tracker, we have a</span></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PHINode and will instead use one of the incoming values to find the</span></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// type.</span></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OutputCanon &gt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a72b89466c3b2fd45331e2c315e2c33e5">PHINodeGVNTracker</a>) &#123;</span></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a704926b49e550b25585651aea32b389b">PHINodeGVNToGVNs</a>.find(OutputCanon);</span></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It != CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a704926b49e550b25585651aea32b389b">PHINodeGVNToGVNs</a>.end() &amp;&amp;</span></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Could not find GVN set for PHINode number!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It-&gt;second.second.size() &gt; 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;PHINode does not have any values!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><span class="doxyHighlight">    OutputCanon = &#42;It-&gt;second.second.begin();</span></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; OGVN =</span></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/region">Region</a>.Candidate-&gt;fromCanonicalNum(OutputCanon);</span></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OGVN &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Could not find GVN for Canonical Number?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><span class="doxyHighlight">  std::optional&lt;Value &#42;&gt; OV = <a href="/docs/api/classes/llvm/region">Region</a>.Candidate-&gt;fromGVN(&#42;OGVN);</span></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OV &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Could not find value for GVN?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;OV;</span></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><span class="doxyHighlight">IROutliner::findCostOutputReloads(OutlinableGroup &amp;CurrentGroup) &#123;</span></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><span class="doxyHighlight">  InstructionCost OverallCost = 0;</span></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (OutlinableRegion &#42;Region : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</span></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><span class="doxyHighlight">    TargetTransformInfo &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> = getTTI(&#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>-&gt;StartBB-&gt;getParent());</span></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Each output incurs a load after the call, so we add that to the cost.</span></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OutputCanon : <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>-&gt;GVNStores) &#123;</span></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#ab4b0641c5ffeeb3249b4ce9bb98c1a2d">findOutputValueInRegion</a>(&#42;Region, OutputCanon);</span></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><span class="doxyHighlight">      InstructionCost LoadCost =</span></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.<a href="/docs/api/classes/llvm/targettransforminfo/#a34c987c590db0e5cff66d9869a34c556">getMemoryOpCost</a>(Instruction::Load, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType(), <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a>(1), 0,</span></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a>);</span></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Adding: &quot;</span><span class="doxyHighlight"> &lt;&lt; LoadCost</span></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; instructions to cost for output of type &quot;</span></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><span class="doxyHighlight">                        &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><span class="doxyHighlight">      OverallCost += LoadCost;</span></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OverallCost;</span></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><span class="doxyHighlightComment">/// Find the extra instructions needed to handle any output values for the</span></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><span class="doxyHighlightComment">/// region.</span></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><span class="doxyHighlightComment">/// \\param &#91;in&#93; M - The Module to outline from.</span></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><span class="doxyHighlightComment">/// \\param &#91;in&#93; CurrentGroup - The collection of OutlinableRegions to analyze.</span></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><span class="doxyHighlightComment">/// \\param &#91;in&#93; TTI - The TargetTransformInfo used to collect information for</span></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><span class="doxyHighlightComment">/// new instruction costs.</span></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><span class="doxyHighlightComment">/// \\returns the additional cost to handle the outputs.</span></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556" lineLink="#a8b12ae89227758cb5684cc7cf25a7f43"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="#a8b12ae89227758cb5684cc7cf25a7f43">findCostForOutputBlocks</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M,</span></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><span class="doxyHighlight">                                               <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;CurrentGroup,</span></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> OutputCost = 0;</span></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumOutputBranches = 0;</span></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;FirstRegion = &#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;;</span></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;Candidate = &#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;-&gt;Candidate;</span></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> CandidateBlocks;</span></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><span class="doxyHighlight">  Candidate.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a93f165686cbc3ed0554ec8431f9c9b21">getBasicBlocks</a>(CandidateBlocks);</span></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Count the number of different output branches that point to blocks outside</span></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the region.</span></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> FoundBlocks;</span></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata">IRInstructionData</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> : Candidate) &#123;</span></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst))</span></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.OperVals) &#123;</span></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(V);</span></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CandidateBlocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(BB) &amp;&amp; FoundBlocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(BB).second)</span></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><span class="doxyHighlight">        NumOutputBranches++;</span></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><span class="doxyHighlight">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8ef219d66e525d2c9fbb7f54e5869ad3">BranchesToOutside</a> = NumOutputBranches;</span></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;unsigned&gt;</a> &amp;OutputUse :</span></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><span class="doxyHighlight">       CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>) &#123;</span></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OutputCanon : OutputUse) &#123;</span></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="#ab4b0641c5ffeeb3249b4ce9bb98c1a2d">findOutputValueInRegion</a>(FirstRegion, OutputCanon);</span></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> StoreCost =</span></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getMemoryOpCost(Instruction::Load, V-&gt;getType(), <a href="/docs/api/structs/llvm/align">Align</a>(1), 0,</span></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a>);</span></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// An instruction cost is added for each store set that needs to occur for</span></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// various output combinations inside the function, plus a branch to</span></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// return to the exit block.</span></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Adding: &quot;</span><span class="doxyHighlight"> &lt;&lt; StoreCost</span></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; instructions to cost for output of type &quot;</span></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><span class="doxyHighlight">                        &lt;&lt; &#42;V-&gt;getType() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><span class="doxyHighlight">      OutputCost += StoreCost &#42; NumOutputBranches;</span></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> BranchCost =</span></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getCFInstrCost(Instruction::Br, <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a>);</span></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Adding &quot;</span><span class="doxyHighlight"> &lt;&lt; BranchCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to the current cost for&quot;</span></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; a branch instruction\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><span class="doxyHighlight">    OutputCost += BranchCost &#42; NumOutputBranches;</span></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is more than one output scheme, we must have a comparison and</span></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branch for each different item in the switch statement.</span></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>.size() &gt; 1) &#123;</span></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ComparisonCost = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getCmpSelInstrCost(</span></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><span class="doxyHighlight">        Instruction::ICmp, <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(M.getContext()),</span></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(M.getContext()), <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD&#95;ICMP&#95;PREDICATE</a>,</span></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a>);</span></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> BranchCost =</span></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getCFInstrCost(Instruction::Br, <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a>);</span></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DifferentBlocks = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>.size();</span></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> TotalCost = ComparisonCost &#42; BranchCost &#42; DifferentBlocks;</span></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Adding: &quot;</span><span class="doxyHighlight"> &lt;&lt; TotalCost</span></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; instructions for each switch case for each different&quot;</span></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; output path in a function\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><span class="doxyHighlight">    OutputCost += TotalCost &#42; NumOutputBranches;</span></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OutputCost;</span></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> IROutliner::findCostBenefit(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, OutlinableGroup &amp;CurrentGroup) &#123;</span></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><span class="doxyHighlight">  InstructionCost RegionBenefit = findBenefitFromAllRegions(CurrentGroup);</span></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><span class="doxyHighlight">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> += RegionBenefit;</span></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Current Benefit: &quot;</span><span class="doxyHighlight"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><span class="doxyHighlight">  InstructionCost OutputReloadCost = findCostOutputReloads(CurrentGroup);</span></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><span class="doxyHighlight">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> += OutputReloadCost;</span></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Current Cost: &quot;</span><span class="doxyHighlight"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><span class="doxyHighlight">  InstructionCost AverageRegionBenefit =</span></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><span class="doxyHighlight">      RegionBenefit / CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size();</span></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OverallArgumentNum = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>.size();</span></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumRegions = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size();</span></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><span class="doxyHighlight">  TargetTransformInfo &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> =</span></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><span class="doxyHighlight">      getTTI(&#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;-&gt;Candidate-&gt;getFunction());</span></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We add one region to the cost once, to account for the instructions added</span></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// inside of the newly created function.</span></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Adding: &quot;</span><span class="doxyHighlight"> &lt;&lt; AverageRegionBenefit</span></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; instructions to cost for body of new function.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><span class="doxyHighlight">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> += AverageRegionBenefit;</span></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Current Cost: &quot;</span><span class="doxyHighlight"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For each argument, we must add an instruction for loading the argument</span></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// out of the register and into a value inside of the newly outlined function.</span></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Adding: &quot;</span><span class="doxyHighlight"> &lt;&lt; OverallArgumentNum</span></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; instructions to cost for each argument in the new&quot;</span></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; function.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><span class="doxyHighlight">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> +=</span></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><span class="doxyHighlight">      OverallArgumentNum &#42; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>;</span></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Current Cost: &quot;</span><span class="doxyHighlight"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Each argument needs to either be loaded into a register or onto the stack.</span></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Some arguments will only be loaded into the stack once the argument</span></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// registers are filled.</span></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Adding: &quot;</span><span class="doxyHighlight"> &lt;&lt; OverallArgumentNum</span></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; instructions to cost for each argument in the new&quot;</span></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; function &quot;</span><span class="doxyHighlight"> &lt;&lt; NumRegions &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; times for the &quot;</span></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;needed argument handling at the call site.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><span class="doxyHighlight">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> +=</span></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><span class="doxyHighlight">      2 &#42; OverallArgumentNum &#42; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a> &#42; NumRegions;</span></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Current Cost: &quot;</span><span class="doxyHighlight"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><span class="doxyHighlight">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> += <a href="#a8b12ae89227758cb5684cc7cf25a7f43">findCostForOutputBlocks</a>(M, CurrentGroup, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</span></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Current Cost: &quot;</span><span class="doxyHighlight"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> IROutliner::updateOutputMapping(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</span></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value &#42;&gt;</a> Outputs,</span></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI) &#123;</span></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For and load instructions following the call</span></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Operand = LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>();</span></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; OutputIdx;</span></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find if the operand it is an output register.</span></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ArgIdx = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.NumExtractedInputs;</span></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><span class="doxyHighlight">       ArgIdx &lt; Region.Call-&gt;arg&#95;size(); ArgIdx++) &#123;</span></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Operand == <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Call-&gt;getArgOperand(ArgIdx)) &#123;</span></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><span class="doxyHighlight">      OutputIdx = ArgIdx - <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.NumExtractedInputs;</span></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we found an output register, place a mapping of the new value</span></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to the original in the mapping.</span></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OutputIdx)</span></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OutputMappings.contains(Outputs&#91;&#42;OutputIdx&#93;)) &#123;</span></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Mapping extracted output &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;LI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to &quot;</span></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><span class="doxyHighlight">                      &lt;&lt; &#42;Outputs&#91;&#42;OutputIdx&#93; &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><span class="doxyHighlight">    OutputMappings.insert(std::make&#95;pair(LI, Outputs&#91;&#42;OutputIdx&#93;));</span></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Orig = OutputMappings.find(Outputs&#91;&#42;OutputIdx&#93;)-&gt;second;</span></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Mapping extracted output &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Orig &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to &quot;</span></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><span class="doxyHighlight">                      &lt;&lt; &#42;Outputs&#91;&#42;OutputIdx&#93; &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><span class="doxyHighlight">    OutputMappings.insert(std::make&#95;pair(LI, Orig));</span></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IROutliner::extractSection(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</span></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><span class="doxyHighlight">  SetVector&lt;Value &#42;&gt; ArgInputs, Outputs, SinkCands;</span></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.StartBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;StartBB for the OutlinableRegion is nullptr!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;InitialStart = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.StartBB;</span></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;OrigF = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.StartBB-&gt;getParent();</span></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><span class="doxyHighlight">  CodeExtractorAnalysisCache CEAC(&#42;OrigF);</span></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.ExtractedFunction =</span></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.CE-&gt;extractCodeRegion(CEAC, ArgInputs, Outputs);</span></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the extraction was successful, find the BasicBlock, and reassign the</span></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OutlinableRegion blocks</span></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.ExtractedFunction) &#123;</span></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;CodeExtractor failed to outline &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.StartBB</span></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.reattachCandidate();</span></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the block containing the called branch, and reassign the blocks as</span></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// necessary.  If the original block still exists, it is because we ended on</span></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a branch instruction, and so we move the contents into the block before</span></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and assign the previous block correctly.</span></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a8f9bfe9d1345237cb3b2b205864da075">User</a> &#42;InstAsUser = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.ExtractedFunction-&gt;user&#95;back();</span></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;RewrittenBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(InstAsUser)-&gt;getParent();</span></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.PrevBB = RewrittenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.PrevBB &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;PrevBB is nullptr?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.PrevBB == InitialStart) &#123;</span></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;NewPrev = InitialStart-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;BI = NewPrev-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</span></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><span class="doxyHighlight">    BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><span class="doxyHighlight">    <a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">moveBBContents</a>(&#42;InitialStart, &#42;NewPrev);</span></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.PrevBB = NewPrev;</span></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><span class="doxyHighlight">    InitialStart-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</span></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.StartBB = RewrittenBB;</span></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.EndBB = RewrittenBB;</span></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The sequences of outlinable regions has now changed.  We must fix the</span></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// IRInstructionDataList for consistency.  Although they may not be illegal</span></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions, they should not be compared with anything else as they</span></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// should not be outlined in this round.  So marking these as illegal is</span></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allowed.</span></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><span class="doxyHighlight">  IRInstructionDataList &#42;IDL = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;front()-&gt;IDL;</span></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;BeginRewritten = &amp;&#42;RewrittenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;EndRewritten = &amp;&#42;RewrittenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</span></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.NewFront = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> (InstDataAllocator.Allocate()) IRInstructionData(</span></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><span class="doxyHighlight">      &#42;BeginRewritten, InstructionClassifier.visit(&#42;BeginRewritten), &#42;IDL);</span></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.NewBack = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> (InstDataAllocator.Allocate()) IRInstructionData(</span></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><span class="doxyHighlight">      &#42;EndRewritten, InstructionClassifier.visit(&#42;EndRewritten), &#42;IDL);</span></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert the first IRInstructionData of the new region in front of the</span></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// first IRInstructionData of the IRSimilarityCandidate.</span></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><span class="doxyHighlight">  IDL-&gt;<a href="/docs/api/classes/llvm/simple-ilist/#a7f4bd492b552181942252ccddc0db26e">insert</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;begin(), &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.NewFront);</span></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert the first IRInstructionData of the new region after the</span></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// last IRInstructionData of the IRSimilarityCandidate.</span></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><span class="doxyHighlight">  IDL-&gt;<a href="/docs/api/classes/llvm/simple-ilist/#a7f4bd492b552181942252ccddc0db26e">insert</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;end(), &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.NewBack);</span></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove the IRInstructionData from the IRSimilarityCandidate.</span></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><span class="doxyHighlight">  IDL-&gt;<a href="/docs/api/classes/llvm/simple-ilist/#a4b588a868b58f1ac0917a59e7c48b5cc">erase</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;begin(), std::prev(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;end()));</span></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RewrittenBB != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> &amp;&amp;</span></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Could not find a predecessor after extraction!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate over the new set of instructions to find the new call</span></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction.</span></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;RewrittenBB)</span></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CallInst &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.ExtractedFunction == CI-&gt;getCalledFunction())</span></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Call = CI;</span></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoadInst &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><span class="doxyHighlight">      updateOutputMapping(Region, Outputs.<a href="/docs/api/classes/llvm/setvector/#a0c7d0dae14eb8a5916fff9f72d8b46d2">getArrayRef</a>(), LI);</span></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.reattachCandidate();</span></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IROutliner::doOutline(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</span></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find the possible similarity sections.</span></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><span class="doxyHighlight">  InstructionClassifier.EnableBranches = !<a href="/docs/api/namespaces/llvm/#a93b773511cf2c25df41bdd74e8718bd3">DisableBranches</a>;</span></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><span class="doxyHighlight">  InstructionClassifier.EnableIndirectCalls = !<a href="/docs/api/namespaces/llvm/#a59a51d46c30287fc47551914e29de21e">DisableIndirectCalls</a>;</span></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><span class="doxyHighlight">  InstructionClassifier.EnableIntrinsics = !<a href="/docs/api/namespaces/llvm/#a98fea048f88b5fe74294b5bf72acb93c">DisableIntrinsics</a>;</span></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><span class="doxyHighlight">  IRSimilarityIdentifier &amp;<a href="/docs/api/namespaces/llvm/object/#a42e5b6ee6f67085d2115b2ea44588c47acfaaa2f9ff08c82a08d647efc1a2964b">Identifier</a> = getIRSI(M);</span></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/irsimilarity/#a1e2d2e59b2467bacdc6db54dcc9bc4a1">SimilarityGroupList</a> &amp;SimilarityCandidates = &#42;<a href="/docs/api/namespaces/llvm/object/#a42e5b6ee6f67085d2115b2ea44588c47acfaaa2f9ff08c82a08d647efc1a2964b">Identifier</a>.getSimilarity();</span></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sort them by size of extracted sections</span></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OutlinedFunctionNum = 0;</span></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we only have one SimilarityGroup in SimilarityCandidates, we do not have</span></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to sort them by the potential number of instructions to be outlined</span></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SimilarityCandidates.size() &gt; 1)</span></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(SimilarityCandidates,</span></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><span class="doxyHighlight">                      &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::vector&lt;IRSimilarityCandidate&gt; &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</span></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><span class="doxyHighlight">                         </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::vector&lt;IRSimilarityCandidate&gt; &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</span></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>&#91;0&#93;.getLength() &#42; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.size() &gt;</span></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><span class="doxyHighlight">                               <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>&#91;0&#93;.getLength() &#42; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.size();</span></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><span class="doxyHighlight">                      &#125;);</span></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Creating OutlinableGroups for each SimilarityCandidate to be used in</span></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// each of the following for loops to avoid making an allocator.</span></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><span class="doxyHighlight">  std::vector&lt;OutlinableGroup&gt; PotentialGroups(SimilarityCandidates.size());</span></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><span class="doxyHighlight">  DenseSet&lt;unsigned&gt; NotSame;</span></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><span class="doxyHighlight">  std::vector&lt;OutlinableGroup &#42;&gt; NegativeCostGroups;</span></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><span class="doxyHighlight">  std::vector&lt;OutlinableRegion &#42;&gt; OutlinedRegions;</span></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iterate over the possible sets of similarity.</span></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> PotentialGroupIdx = 0;</span></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/irsimilarity/#a2198f86ce16da838bdeea4de7e59ef31">SimilarityGroup</a> &amp;CandidateVec : SimilarityCandidates) &#123;</span></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><span class="doxyHighlight">    OutlinableGroup &amp;CurrentGroup = PotentialGroups&#91;PotentialGroupIdx++&#93;;</span></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remove entries that were previously outlined</span></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><span class="doxyHighlight">    pruneIncompatibleRegions(CandidateVec, CurrentGroup);</span></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We pruned the number of regions to 0 to 1, meaning that it&#39;s not worth</span></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// trying to outlined since there is no compatible similar instance of this</span></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// code.</span></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size() &lt; 2)</span></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Determine if there are any values that are the same constant throughout</span></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// each section in the set.</span></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><span class="doxyHighlight">    NotSame.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1fbf4d66a9eeaa9ade03e8febee097ee">clear</a>();</span></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><span class="doxyHighlight">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a61915f6a6a382f51fd1a8bf3dd188c0c">findSameConstants</a>(NotSame);</span></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a7bf6409b01dd04465404d268beec0898">IgnoreGroup</a>)</span></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create a CodeExtractor for each outlinable region. Identify inputs and</span></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// outputs for each section using the code extractor and create the argument</span></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// types for the Aggregate Outlining Function.</span></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><span class="doxyHighlight">    OutlinedRegions.clear();</span></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (OutlinableRegion &#42;OS : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</span></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Break the outlinable region out of its parent BasicBlock into its own</span></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// BasicBlocks (see function implementation).</span></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><span class="doxyHighlight">      OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a761b3c02cd196cb5f6fb019bcd86866e">splitCandidate</a>();</span></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// There&#39;s a chance that when the region is split, extra instructions are</span></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// added to the region. This makes the region no longer viable</span></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to be split, so we ignore it for outlining.</span></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a6a1b95a7f7c90784102fd63ffaa0ea00">CandidateSplit</a>)</span></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;BasicBlock &#42;&gt;</a> BE;</span></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><span class="doxyHighlight">      DenseSet&lt;BasicBlock &#42;&gt; BlocksInRegion;</span></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><span class="doxyHighlight">      OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a93f165686cbc3ed0554ec8431f9c9b21">getBasicBlocks</a>(BlocksInRegion, BE);</span></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><span class="doxyHighlight">      OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a06ee910ecb16eaaab4f069fa05c2a95a">CE</a> = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> (ExtractorAllocator.Allocate())</span></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><span class="doxyHighlight">          CodeExtractor(BE, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;outlined&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><span class="doxyHighlight">      findAddInputsOutputs(M, &#42;OS, NotSame);</span></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a737734321cd2dd3896e64015cab7ab95">IgnoreRegion</a>)</span></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><span class="doxyHighlight">        OutlinedRegions.push&#95;back(OS);</span></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We recombine the blocks together now that we have gathered all the</span></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// needed information.</span></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><span class="doxyHighlight">      OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#af5d7aa7988108e9377f154cf6a22f02b">reattachCandidate</a>();</span></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><span class="doxyHighlight">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a> = std::move(OutlinedRegions);</span></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.empty())</span></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><span class="doxyHighlight">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ad67fb96194cff11216803ad74dba5687">collectGVNStoreSets</a>(M);</span></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CostModel)</span></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><span class="doxyHighlight">      findCostBenefit(M, CurrentGroup);</span></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we are adhering to the cost model, skip those groups where the cost</span></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// outweighs the benefits.</span></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &gt;= CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> &amp;&amp; CostModel) &#123;</span></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><span class="doxyHighlight">      OptimizationRemarkEmitter &amp;ORE =</span></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><span class="doxyHighlight">          getORE(&#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;-&gt;Candidate-&gt;getFunction());</span></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><span class="doxyHighlight">      ORE.<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><span class="doxyHighlight">        IRSimilarityCandidate &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;-&gt;Candidate;</span></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><span class="doxyHighlight">        OptimizationRemarkMissed <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;WouldNotDecreaseSize&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><span class="doxyHighlight">                                   <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;frontInstruction());</span></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;did not outline &quot;</span></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><span class="doxyHighlight">          &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(std::to&#95;string(CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size()))</span></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><span class="doxyHighlight">          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; regions due to estimated increase of &quot;</span></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><span class="doxyHighlight">          &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;InstructionIncrease&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><span class="doxyHighlight">                     CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> - CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a>)</span></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><span class="doxyHighlight">          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; instructions at locations &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a2145da5bde7663d745e9c3ade392809f">interleave</a>(</span></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><span class="doxyHighlight">            CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.begin(), CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.end(),</span></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><span class="doxyHighlight">            &#91;&amp;R&#93;(OutlinableRegion &#42;Region) &#123;</span></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><span class="doxyHighlight">              R &lt;&lt; ore::NV(</span></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><span class="doxyHighlight">                  </span><span class="doxyHighlightStringLiteral">&quot;DebugLoc&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><span class="doxyHighlight">                  Region-&gt;Candidate-&gt;frontInstruction()-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><span class="doxyHighlight">            &#125;,</span></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><span class="doxyHighlight">            &#91;&amp;R&#93;() &#123; R &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &quot;</span><span class="doxyHighlight">; &#125;);</span></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>;</span></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><span class="doxyHighlight">    NegativeCostGroups.push&#95;back(&amp;CurrentGroup);</span></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><span class="doxyHighlight">  ExtractorAllocator.DestroyAll();</span></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NegativeCostGroups.size() &gt; 1)</span></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">stable&#95;sort</a>(NegativeCostGroups,</span></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><span class="doxyHighlight">                &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> OutlinableGroup &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> OutlinableGroup &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</span></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;Benefit - <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;Cost &gt; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;Benefit - <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;Cost;</span></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><span class="doxyHighlight">                &#125;);</span></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><span class="doxyHighlight">  std::vector&lt;Function &#42;&gt; FuncsToRemove;</span></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (OutlinableGroup &#42;CG : NegativeCostGroups) &#123;</span></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><span class="doxyHighlight">    OutlinableGroup &amp;CurrentGroup = &#42;CG;</span></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><span class="doxyHighlight">    OutlinedRegions.clear();</span></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (OutlinableRegion &#42;Region : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</span></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We check whether our region is compatible with what has already been</span></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// outlined, and whether we need to ignore this item.</span></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isCompatibleWithAlreadyOutlinedCode(&#42;Region))</span></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><span class="doxyHighlight">      OutlinedRegions.push&#95;back(Region);</span></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OutlinedRegions.size() &lt; 2)</span></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reestimate the cost and benefit of the OutlinableGroup. Continue only if</span></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we are still outlining enough regions to make up for the added cost.</span></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><span class="doxyHighlight">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a> = std::move(OutlinedRegions);</span></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CostModel) &#123;</span></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><span class="doxyHighlight">      CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> = 0;</span></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><span class="doxyHighlight">      CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> = 0;</span></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><span class="doxyHighlight">      findCostBenefit(M, CurrentGroup);</span></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &gt;= CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a>)</span></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><span class="doxyHighlight">    OutlinedRegions.clear();</span></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (OutlinableRegion &#42;Region : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</span></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>-&gt;splitCandidate();</span></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>-&gt;CandidateSplit)</span></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><span class="doxyHighlight">      OutlinedRegions.push&#95;back(Region);</span></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><span class="doxyHighlight">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a> = std::move(OutlinedRegions);</span></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size() &lt; 2) &#123;</span></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (OutlinableRegion &#42;R : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>)</span></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;reattachCandidate();</span></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Outlining regions with cost &quot;</span><span class="doxyHighlight"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a></span></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; and benefit &quot;</span><span class="doxyHighlight"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create functions out of all the sections, and mark them as outlined.</span></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><span class="doxyHighlight">    OutlinedRegions.clear();</span></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (OutlinableRegion &#42;OS : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</span></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;BasicBlock &#42;&gt;</a> BE;</span></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><span class="doxyHighlight">      DenseSet&lt;BasicBlock &#42;&gt; BlocksInRegion;</span></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><span class="doxyHighlight">      OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a93f165686cbc3ed0554ec8431f9c9b21">getBasicBlocks</a>(BlocksInRegion, BE);</span></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><span class="doxyHighlight">      OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a06ee910ecb16eaaab4f069fa05c2a95a">CE</a> = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> (ExtractorAllocator.Allocate())</span></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><span class="doxyHighlight">          CodeExtractor(BE, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><span class="doxyHighlight">                        </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;outlined&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FunctionOutlined = extractSection(&#42;OS);</span></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FunctionOutlined) &#123;</span></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StartIdx = OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ada960ccf6a96ca62ce5db3af1b7bf7f5">getStartIdx</a>();</span></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EndIdx = OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a5fd2e1a8a3658307e8c0d87a153d8c24">getEndIdx</a>();</span></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = StartIdx; Idx &lt;= EndIdx; Idx++)</span></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><span class="doxyHighlight">          Outlined.insert(Idx);</span></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><span class="doxyHighlight">        OutlinedRegions.push&#95;back(OS);</span></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Outlined &quot;</span><span class="doxyHighlight"> &lt;&lt; OutlinedRegions.size()</span></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; with benefit &quot;</span><span class="doxyHighlight"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a></span></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; and cost &quot;</span><span class="doxyHighlight"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><span class="doxyHighlight">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a> = std::move(OutlinedRegions);</span></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.empty())</span></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><span class="doxyHighlight">    OptimizationRemarkEmitter &amp;ORE =</span></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><span class="doxyHighlight">        getORE(&#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;-&gt;Call-&gt;getFunction());</span></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><span class="doxyHighlight">    ORE.<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><span class="doxyHighlight">      IRSimilarityCandidate &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;-&gt;Candidate;</span></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><span class="doxyHighlight">      OptimizationRemark <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;Outlined&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;front()-&gt;Inst);</span></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;outlined &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(std::to&#95;string(CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size()))</span></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><span class="doxyHighlight">        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; regions with decrease of &quot;</span></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><span class="doxyHighlight">        &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;Benefit&quot;</span><span class="doxyHighlight">, CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> - CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a>)</span></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><span class="doxyHighlight">        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; instructions at locations &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a2145da5bde7663d745e9c3ade392809f">interleave</a>(</span></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><span class="doxyHighlight">          CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.begin(), CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.end(),</span></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><span class="doxyHighlight">          &#91;&amp;R&#93;(OutlinableRegion &#42;Region) &#123;</span></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><span class="doxyHighlight">            R &lt;&lt; ore::NV(</span><span class="doxyHighlightStringLiteral">&quot;DebugLoc&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><span class="doxyHighlight">                         Region-&gt;Candidate-&gt;frontInstruction()-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><span class="doxyHighlight">          &#125;,</span></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><span class="doxyHighlight">          &#91;&amp;R&#93;() &#123; R &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &quot;</span><span class="doxyHighlight">; &#125;);</span></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>;</span></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><span class="doxyHighlight">    deduplicateExtractedSections(M, CurrentGroup, FuncsToRemove,</span></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><span class="doxyHighlight">                                 OutlinedFunctionNum);</span></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Function &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : FuncsToRemove)</span></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OutlinedFunctionNum;</span></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013" lineLink="/docs/api/classes/llvm/iroutliner/#adc7588dad82317423eb5949ca4bac107"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/iroutliner/#adc7588dad82317423eb5949ca4bac107">IROutliner::run</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</span></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><span class="doxyHighlight">  CostModel = !<a href="#a2dfbf70cabc04c37f6f46b2c312b2506">NoCostModel</a>;</span></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><span class="doxyHighlight">  OutlineFromLinkODRs = <a href="#a415af6f4421aa68820b3279b48acd928">EnableLinkOnceODRIROutlining</a>;</span></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> doOutline(M) &gt; 0;</span></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020" lineLink="/docs/api/classes/llvm/iroutlinerpass/#a5b9a8fe2c3b6834817b2c12b08441cff"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/iroutlinerpass/#a5b9a8fe2c3b6834817b2c12b08441cff">IROutlinerPass::run</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/namespaces/llvm/#af9c9208365fd9ce11392b4d79485e259">ModuleAnalysisManager</a> &amp;AM) &#123;</span></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a> = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/namespaces/llvm/#a4143e067711d3c7795276b225a8d6eb9">FunctionAnalysisManagerModuleProxy</a>&gt;(M).getManager();</span></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><span class="doxyHighlight">  std::function&lt;<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GTTI =</span></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><span class="doxyHighlight">      &#91;&amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>&#93;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; &#123;</span></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.getResult&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><span class="doxyHighlight">  std::function&lt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilarityidentifier">IRSimilarityIdentifier</a> &amp;(<a href="/docs/api/classes/llvm/module">Module</a> &amp;)&gt; GIRSI =</span></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><span class="doxyHighlight">      &#91;&amp;AM&#93;(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) -&gt; <a href="/docs/api/classes/llvm/irsimilarity/irsimilarityidentifier">IRSimilarityIdentifier</a> &amp; &#123;</span></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/irsimilarityanalysis">IRSimilarityAnalysis</a>&gt;(M);</span></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><span class="doxyHighlight">  std::unique&#95;ptr&lt;OptimizationRemarkEmitter&gt; ORE;</span></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><span class="doxyHighlight">  std::function&lt;<a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GORE =</span></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><span class="doxyHighlight">      &#91;&amp;ORE&#93;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &amp; &#123;</span></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><span class="doxyHighlight">    ORE.reset(</span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</span></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;ORE;</span></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/iroutliner">IROutliner</a>(GTTI, GIRSI, GORE).<a href="/docs/api/classes/llvm/iroutlinerpass/#a5b9a8fe2c3b6834817b2c12b08441cff">run</a>(M))</span></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a03797a73044a81cbc6a3409d6c72ee8f">PreservedAnalyses::none</a>();</span></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
